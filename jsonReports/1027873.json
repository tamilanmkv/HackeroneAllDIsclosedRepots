{"id":1027873,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDI3ODcz","url":"https://hackerone.com/reports/1027873","title":"Ability to potentially hit internal NGINX locations on *.myshopify.com by making use of the `X-Accel-Redirect` header via a configured App Proxy","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2020-11-06T00:57:41.281Z","submitted_at":"2020-11-06T00:57:41.300Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"francisbeaudoin","url":"/francisbeaudoin","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-02-11T20:28:28.527Z","bug_reporter_agreed_on_going_public_at":"2021-02-11T20:28:28.440Z","team_member_agreed_on_going_public_at":"2021-02-11T19:59:21.427Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"By making use of the [Shopify App Proxy](https://shopify.dev/tutorials/display-data-on-an-online-store-with-an-application-proxy-app-extension) and the [**X-Accel** feature of NGINX](https://www.nginx.com/resources/wiki/start/topics/examples/x-accel/), it is possible to hit any configured `internal` NGINX location as your current configuration is not ignoring the `X-Accel-Redirect` header response from an upstream service. \n\nThe way it works is that NGINX allows internal redirection to a location determined by that header returned from a backend - in our case being the configured **App Proxy** backend controlled by the attacker.\n\nFor example, the following request would ends up hitting `http://private-service/flag`\n{F1067100}\n\nHowever, I did some very basic fuzzing and wasn't able to hit anything but still reporting and will let you guys assess the risk.\n\n## Steps to reproduce\n### Create a service that return a X-Accel-Redirect header\nFirst step, is to create a server that is returning a response with the `X-Accel-Redirect` header.\n1. Open [mocky.io](https://designer.mocky.io/design)\n2. Within the **HTTP Headers** section, enter:\n```\n{\n\t\"X-Accel-Redirect\": \"/collections/all\"\n}\n```\n3. Scroll down and click **Generate my HTTP response** and copy the **Mock URL**\n\nOtherwise, you can simply use https://run.mocky.io/v3/d7cdfcbc-6994-4f3b-a323-fe8377535507 which is already configured per above steps\n\n### Setup the App Proxy\n1. Within Shopify Partners, create a new private application and install it on your shop\n1. From that application setup, go to **Extensions \u003e Online Store** and setup an **App proxy**\n1. From that **App proxy** configuration, set the following values:\n\t1. Subpath prefix: `a`\n\t1. Subpath `apps`\n\t1. Proxy URL `https://run.mocky.io/v3/d7cdfcbc-6994-4f3b-a323-fe8377535507` or enter your own mock URL \n1. Within your browser, open your `https://{shop}.myshopify.com/a/apps` by taking care of replacing the `{shop}` placeholder with your actual shop name on which you installed the application\n\nAs a result, you are being proxied your current shop `/collections/all` page proving that your current NGINX configuration follows the `X-Accel-Redirect` directive. \n\n## Mitigation\nTo mitigate this issue, a `proxy_ignore_headers X-Accel-Redirect` directive should be set in your NGINX configuration as described in the [NGINX documentation](https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ignore_headers)\n\n## Impact\n\nAs mentioned, I wasn't actually able to hit any of your internal routes but that could only mean that my URL fuzzing wasn't good enough or that you actually do not have any configured internal routes on that proxy.","bounty_amount":"500.0","formatted_bounty":"$500","original_report_id":null,"original_report_url":null,"attachments":[{"id":1067100,"file_name":"SS.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/9ztqExFaPbAAcYY9kmZzZxZF?response-content-disposition=attachment%3B%20filename%3D%22SS.png%22%3B%20filename%2A%3DUTF-8%27%27SS.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVJI3TZP5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T131739Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJHMEUCIDDOenL7uY4or83Q1QkoD3xFl3uQkVICTxz%2FSDsIuWn2AiEA6%2FBWebe5fWUS9x04VtqSrFyJrrJX9Wzed2z5QiFgezgqgwQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDH%2Fcd6CfZMtsGgbHGSrXAymgqTqfvaCT83Vkk5pwapbWccEe%2BTtGThweNvSHf8FWkbmUnw2%2BMW8gqDcDNfGz7tEqv52qONc53GYs0r8D4W05T9cQ0uJtgIqBt4OmGkISCOluU2WykgPIXNEjqYkmh5zHooyqwoU4aWAvfbkbpMVL9O0nweFS83%2BqHqg3OXHtztd3WIO7FAtaIQ%2BDUZpyi%2B0a6zYS63Ic2i25q%2F413QAdfE21IQe9RLjfzNve6b8NLPdujPpkD5MvBg8opZAcnhH3rst0f02RrXBCwMAlbK6eiAdI%2FzxadkB6vJ9FtNU65o45iqF45d%2BYmfZJlOFMAVeS2pbeBJdGI7Fl7Z2hiMv0eHtvGwtxj3crYZJWjN69sMxNPs09KcOtApNPAFwGOGCcmDvm1areMVntxdnNYOlBWv0Aq3wyIXZsHHz8lX9tMjmv61dmZYvcByrfDvKW9exhQBN91h%2F%2BbxVbw80KEhIU5ipL2I5om6%2B6BoUggVA6Zd8rRJTc%2Fnn4LxgieuXFRKE4YsS3SCif0QZM6U80f0hPAJ0yiZeJUwXPDeGE0VCDJ5xmoacd5KWtjrjLbalrb5cz74c83ZZVOwv00icAbZKCzCMp4PLt5n7snHsnET8g6Tc7A6HNeDDY0ZCLBjqlARSrOasljqaSB8W9wmwFFWOUexc%2FyrrCODPiZEQKPd3A4ujWW2tnvxuhmbVhX2LLKdYUWL%2BqV7PXCjSBr8z9e13VbLgHltUO2EekXZyt0zUO0YHMr%2B%2B3y2ykh6QETPea4u6xBc1fOLSy9BKwigrMcXLVPZQgcLcQ07YofmFon1WVZYXr3Y0Iu6F%2Fi5W2fPKhu6dNiq1Z9eaTAlzThXI9e%2BPtktaqIg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4745d1aab4008a6994e02f4eed259aca1e38e17d79b20939bc1420ff0388b63d","file_size":82199,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":19,"voters":["drsniper","ldionmarcil","ali","mattberg","ms-13","0nlymohammed","exbrazily","dastan_9408","h4x0r_dz","xyber_wolf","and 9 more..."],"severity":{"rating":"none","score":0.0,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9740657,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-11-06T01:09:00.007Z","updated_at":"2020-11-06T01:09:00.007Z","additional_data":{"old_title":"Ability to hit internal NGINX configured locations on *shop.myshopify.com by making use of the `X-Accel-Redirect` header via a configured App Proxy","new_title":"Ability to potentially hit internal NGINX locations on *.myshopify.com by making use of the `X-Accel-Redirect` header via a configured App Proxy"},"actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9751912,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @francisbeaudoin,\n\nThank you for your report. We're still looking into this and will follow up with you next week.\n\nCheers.","automated_response":false,"created_at":"2020-11-06T22:20:30.200Z","updated_at":"2020-11-06T22:20:30.200Z","actor":{"username":"leanne_shapton","cleared":false,"url":"/leanne_shapton","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9817679,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @francisbeaudoin,\n\nThank you for your report and sorry for the delay. We have deployed a fix for this issue. For this reason, we'll close this report as Resolved. We will get back to you as soon as we come to a decision on bounty eligibility.","automated_response":false,"created_at":"2020-11-13T17:54:31.770Z","updated_at":"2020-11-13T17:54:31.770Z","actor":{"username":"benoit_cotejodoin","cleared":false,"url":"/benoit_cotejodoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/470/019/97f3be894b8bd3c19e2bcc22458e02b30349bd60_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9836172,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No worries for delay - given that I haven't been able to actually discover internal routes by myself I was expecting it to take some time. \n\nI would be curious to know whether something sensitive could have been hit there, if you don't mind sharing :)\n\nOther than that, just made some test and the fix looks good!\n\n","automated_response":false,"created_at":"2020-11-16T19:25:54.023Z","updated_at":"2020-11-16T19:25:54.023Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9849220,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @francisbeaudoin,\n\nThanks again for your report! We had a closer look at this issue, and found that there were a handful of internal routes defined, but none of them were usable without authentication. As a result, this issue had no confidentiality, integrity or availability impact, resulting in a CVSS score of 0.0. However, we felt that this issue could potentially have led to security impact in the future, and so we're awarding a $500 bonus.","automated_response":false,"created_at":"2020-11-17T22:02:46.310Z","updated_at":"2020-11-17T22:02:46.310Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"500.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9849225,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We look forward to hearing from you again in the future. Happy hacking!","automated_response":false,"created_at":"2020-11-17T22:04:39.517Z","updated_at":"2020-11-17T22:04:39.517Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9855623,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your transparency and for the bounty, much appreciated!","automated_response":false,"created_at":"2020-11-18T13:56:32.428Z","updated_at":"2020-11-18T13:56:32.428Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10478333,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2021-01-26T00:26:27.006Z","updated_at":"2021-01-26T00:26:27.006Z","additional_data":{"old_severity":null,"new_severity":"None (0.0)","old_severity_id":null,"new_severity_id":967152},"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10649595,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-02-11T19:59:21.455Z","updated_at":"2021-02-11T19:59:21.455Z","first_to_agree":true,"actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10649761,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-02-11T20:28:28.468Z","updated_at":"2021-02-11T20:28:28.468Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10649762,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-02-11T20:28:28.558Z","updated_at":"2021-02-11T20:28:28.558Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":25520,"category":"team","content":"@francisbeaudoin reported an issue where the [accelerated redirect](https://www.nginx.com/resources/wiki/start/topics/examples/x-accel/) functionality of Nginx could be used by an [App Proxy](https://shopify.dev/tutorials/display-data-on-an-online-store-with-an-application-proxy-app-extension) to return the content of pages other than the one indicated by the URL. We were unable to determine any current security impact as a result of this behaviour, but awarded a $500 bonus in recognition of potential future impact.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":164342,"username":"jack_mccracken","name":"Jack McCracken","bio":"","cleared":false,"website":null,"location":"","created_at":"2017-05-01T15:33:44.372Z","url":"https://hackerone.com/jack_mccracken","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}