{"id":10563,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDU2Mw==","url":"https://hackerone.com/reports/10563","title":"CSRF on \"Set as primary\" option on the accounts page","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-05-02T01:24:48.948Z","submitted_at":"2014-05-02T01:24:48.948Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"anshuman_bh","url":"/anshuman_bh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":104,"url":"https://hackerone.com/coinbase","handle":"coinbase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Coinbase","twitter_handle":"","website":"https://coinbase.com/security","about":"Creating an open financial system for the world"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2014-07-26T00:27:57.634Z","bug_reporter_agreed_on_going_public_at":"2014-06-26T00:27:56.376Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"On navigating to the Accounts page, a Coinbase user can create multiple accounts.\r\nThe user can then make any of these accounts as their primary account.\r\nThere are also other options of renaming and deleting these accounts.\r\n\r\nAlthough there is a CSRF token being sent as a POST parameter for the delete operation, there is no such CSRF token for the \"set as primary\" operation. Infact, this request is a GET request. Similar CSRF controls should be implemented for the \"Set as primary\" operation as well.\r\n\r\nAlso, the account number/id is not something that is trivial for an attacker to predict. But, since it is sent as a GET request, it gets cached in the browser history, proxies, logs, etc. So, once the attacker gets hold of such an account number of a legitimate coinbase user, he can exploit a CSRF attack by framing a URL which looks as simple as this:\r\n\r\nhttps://coinbase.com/accounts/\u003caccount_number\u003e/set_as_primary\r\n\r\nThe attacker can then trick the legitimate user to switch his primary account without the user's intention.\r\n\r\nPlease see the screenshot attached which shows that a GET request was sent requesting to switch the primary account. All that is required for it to be successfully processed is the session cookie.","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":8102,"file_name":"Screen_Shot_2014-05-01_at_9.23.19_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/008/102/f35246636142aac9ebc96229b94d791050f7af21/Screen_Shot_2014-05-01_at_9.23.19_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-05-01_at_9.23.19_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-05-01_at_9.23.19_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6MYV3CHR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132002Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIBVc7UqCa%2BVw3HmItaBtS64sAYD%2BBoHcwKfllPiNzq%2FxAiBo2eFNkA5%2FxHrIhwiI9FDD1%2Ba7UqqgOgiyG%2BuMIvbOdSqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMoOkcTD8B2dtn8AkPKtcDbEewBDI277tRSWrAN69Jl0t3EcZIiYIs39znmb95v1ezRO4qoCRYjoYKF%2BL8zl11f6rmPsIK0l5iVxeTPzMQ1Vl2cSKYozzzcgfpORBtyNNxP4WDxPnWR2zqjPWc5IdUwV7YSP1he4h9xde%2F0My9qYFCni2vFgg15kCza5s3zkENaSBtpFNGgcNv9FDJUvw3x0uKDZMmVHbsy6nuy%2Bs6zRmD9JlUhWulZnkqml9yDfk4x2nrTPmv%2BFePCv4mwmAqf74CHZKRbp27eqZ24qqkaloEkEg%2BlghFLMmkTVQg6xzP%2FceYILDjLMnNXEl9ndCd5lFXYHr3Cmsr7jgn6ZnFFUvoMtDn%2F5OMpNvt7WGAujFzQfYjUxHg69raOkZWHBRQFHuVWEj4B8DHyJnDalAQnJSSIMnN7KvlfAlbiWQ73qmq05HTOcDtxBR711T9Gtc1m0788UFlGQDeJ86AZ30%2Bx8j3dPvEe0onISobg5IOAWshsvDdzDGtVD%2FvYxSX%2BziElN2A%2FUqvG7Dhi49NYboGBQG1%2BYqUuT8NXDX4L3tUMg0XiM9fNxHWCx6n7eQNuSG2lgWdCoy1p4SbTI1o3RxxpnRt7%2BeScPyJV1Z81TP8KSt04l3muI3EMKDVkIsGOqYBUy%2FWqHs3RjqM07iVOq9l8k1v0scrGG9QEGG%2FPPB3NC4W2hNPTSGT2Qq5PtdI5%2FMpQHRRg2ha7Z4nHK2CNk7Crnr6CE6XWCkJuXW%2Bp%2Bn%2BE%2Fx2eNmmH4CM1GSE17N99rS83MSANfISOOR2XHdUnGLuWhDaLe%2FtbPgJAZTpTIt75cbPaTKHYPbsqYyEpEyT7StxzT7frW9Hz9UnY7v2iGbMwf8fbsrJyQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c92e4f7cef318f0353d6b4594922f9b55ced800a47264c9c50182b2fc396e9ee","file_size":76670,"type":"image/png"}],"allow_singular_disclosure_at":"2014-07-26T00:27:56.726Z","allow_singular_disclosure_after":-227623925.3280292,"singular_disclosure_allowed":true,"vote_count":2,"voters":["sw33tlie","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":43193,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I also want to point out that Coinbase does not validate the Host header either. This can be considered as a separate finding all together.\n\nBut, the point is that if the above request is sent using an invalid host header, it potentially leaks the account number to that invalid host. So, the attacker does not necessarily need to access the user's workstation or the proxy/logs to retrieve the account number. \n\nSee attached pic where I changed the Host header to test.com and a request was sent to mylikes.com with that account number and \"set_as_primary\" function in the URL. ","automated_response":false,"created_at":"2014-05-02T04:32:00.948Z","updated_at":"2014-05-02T04:32:00.948Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":8105,"filename":"Screen_Shot_2014-05-02_at_12.17.05_AM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/008/105/24caeea2bb1405524a3e7b0333dd9d9c17ae4f7d/Screen_Shot_2014-05-02_at_12.17.05_AM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-05-02_at_12.17.05_AM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-05-02_at_12.17.05_AM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6MYV3CHR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132002Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIBVc7UqCa%2BVw3HmItaBtS64sAYD%2BBoHcwKfllPiNzq%2FxAiBo2eFNkA5%2FxHrIhwiI9FDD1%2Ba7UqqgOgiyG%2BuMIvbOdSqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMoOkcTD8B2dtn8AkPKtcDbEewBDI277tRSWrAN69Jl0t3EcZIiYIs39znmb95v1ezRO4qoCRYjoYKF%2BL8zl11f6rmPsIK0l5iVxeTPzMQ1Vl2cSKYozzzcgfpORBtyNNxP4WDxPnWR2zqjPWc5IdUwV7YSP1he4h9xde%2F0My9qYFCni2vFgg15kCza5s3zkENaSBtpFNGgcNv9FDJUvw3x0uKDZMmVHbsy6nuy%2Bs6zRmD9JlUhWulZnkqml9yDfk4x2nrTPmv%2BFePCv4mwmAqf74CHZKRbp27eqZ24qqkaloEkEg%2BlghFLMmkTVQg6xzP%2FceYILDjLMnNXEl9ndCd5lFXYHr3Cmsr7jgn6ZnFFUvoMtDn%2F5OMpNvt7WGAujFzQfYjUxHg69raOkZWHBRQFHuVWEj4B8DHyJnDalAQnJSSIMnN7KvlfAlbiWQ73qmq05HTOcDtxBR711T9Gtc1m0788UFlGQDeJ86AZ30%2Bx8j3dPvEe0onISobg5IOAWshsvDdzDGtVD%2FvYxSX%2BziElN2A%2FUqvG7Dhi49NYboGBQG1%2BYqUuT8NXDX4L3tUMg0XiM9fNxHWCx6n7eQNuSG2lgWdCoy1p4SbTI1o3RxxpnRt7%2BeScPyJV1Z81TP8KSt04l3muI3EMKDVkIsGOqYBUy%2FWqHs3RjqM07iVOq9l8k1v0scrGG9QEGG%2FPPB3NC4W2hNPTSGT2Qq5PtdI5%2FMpQHRRg2ha7Z4nHK2CNk7Crnr6CE6XWCkJuXW%2Bp%2Bn%2BE%2Fx2eNmmH4CM1GSE17N99rS83MSANfISOOR2XHdUnGLuWhDaLe%2FtbPgJAZTpTIt75cbPaTKHYPbsqYyEpEyT7StxzT7frW9Hz9UnY7v2iGbMwf8fbsrJyQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=bdeee4933fb928bc2b0611678a6bd7c45f078f8442971fa59ee8a83e4def42d3"}],"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":43462,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"How would you enumerate the account number for the account you are performing the CSRF for? I'm not seeing how this is exploitable as they would have to first know the account number ahead of time correct?\n\nAs far as the host header, that is not really exploitable as an attacker would have to modify the header on behalf of a victim. As far as I'm aware there is not a way to do this in JavaScript or other means?","automated_response":false,"created_at":"2014-05-02T20:20:31.027Z","updated_at":"2014-05-02T20:20:31.027Z","actor":{"username":"mandatory","cleared":false,"url":"/mandatory","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":43480,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"1. The account number can be retrieved because it is in the GET request. It is the same as passing sensitive information as URL QueryString parameters and why it is not recommended to do so because of security reasons. \n\nIf the Access Vector is considered local, then the attacker can retrieve the account number from the browser history. If the Access Vector is considered Adjacent Network, then it can be possibly retrieved if it is getting cached in proxies or logs. \n\n2. Exploiting Host header is not trivial, I agree. Please see https://hackerone.com/reports/7357 and https://twitter.com/jcran/status/460943000739131393. There is a some discussion going on at these links as to why it should be fixed. The attacker does not NECESSARILY have to do it on behalf of a victim. That is just a PoC to show that Host header is not being validated which might potentially result in unwanted behavior. \n\nI also have a question for you:\nWhy is there no CSRF protection for this particular operation when it is present for other operations? Is there a justification that this operation is not sensitive enough? It is changing the state of the application on the server so it should be protected against CSRF, correct?\n\n\nIf you still believe that the above justifications does not warrant a fix, let me know. I can try to see if account numbers can be enumerated in any other trivial way. ","automated_response":false,"created_at":"2014-05-02T20:33:56.945Z","updated_at":"2014-05-02T20:33:56.945Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":46458,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Hi - this was fixed in an earlier report, and we rewarded a defense in depth bounty since this wasn't exploitable. Changing a primary account has no negative impact to a user. Thanks for the submission!","automated_response":false,"created_at":"2014-05-07T21:32:42.091Z","updated_at":"2014-05-07T21:32:42.091Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":67862,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I just saw that this was reported in a much later report than mine - https://hackerone.com/reports/10829. I am curious to know how mine was deemed duplicate?","automated_response":false,"created_at":"2014-06-06T13:49:02.992Z","updated_at":"2014-06-06T13:49:02.992Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":79224,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Hi - Yep, just reviewed this and you were the second to report. We're going to match the first and second since we should have remembered them.","automated_response":false,"created_at":"2014-06-25T23:32:06.542Z","updated_at":"2014-06-25T23:32:06.542Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":79225,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2014-06-25T23:32:14.236Z","updated_at":"2014-06-25T23:32:14.236Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"anshuman_bh","url":"/anshuman_bh"},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":79226,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2014-06-25T23:32:22.108Z","updated_at":"2014-06-25T23:32:22.108Z","actor":{"url":"/coinbase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Coinbase"}},"bounty_amount":"100.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"coinbase","collaborator":{"username":"anshuman_bh","url":"/anshuman_bh"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":79243,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks much. Appreciate the transparency!!","automated_response":false,"created_at":"2014-06-26T00:27:56.394Z","updated_at":"2014-06-26T00:27:56.394Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":96369,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2014-07-26T00:27:57.647Z","updated_at":"2014-07-26T00:27:57.647Z","actor":{"url":"/coinbase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Coinbase"}},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}