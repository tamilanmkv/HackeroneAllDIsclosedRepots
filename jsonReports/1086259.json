{"id":1086259,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDg2MjU5","url":"https://hackerone.com/reports/1086259","title":"Proxy-Authorization header carried to a new host on a redirect","state":"Closed","substate":"not-applicable","severity_rating":"medium","readable_substate":"N/A","created_at":"2021-01-25T02:37:39.824Z","submitted_at":"2021-01-25T02:37:39.879Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dftrace","url":"/dftrace","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":35663,"url":"https://hackerone.com/curl","handle":"curl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"curl","twitter_handle":"","website":"https://curl.se","about":"cURL is a computer software project providing a library and command-line tool for transferring data using various protocols."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-03-08T08:25:39.680Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-01-25T15:59:31.587Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"hi cURL team\n\nI am not entirely sure this is an issue, please feel free to close of it isn't.\n\nI noticed that when making an HTTP GET request with Proxy-Authorization header, together with the \"-L\" flag to follow redirects\n\n curl -H \"Authorization-Proxy: Basic xxx==\" http://host:8000 -L\n\nIf the remote web server redirects to an alternate host/port, cURL  will carry over the Proxy-Authorization header to the redirected new host along with the secret.\n\nIf Authorization header is used (vs Proxy-Authentication) then the header gets stripped as it should.\n\nClient  sends GET request with Proxy-Authorization header to Server 1:8080\nServer1 Redirects cURL to Server2:8081\nServer2:8081 Receives the Proxy-Authorization header\nThis was reproducible in the following version:\n\ncurl 7.64.1 (x86_64-apple-darwin20.0) libcurl/7.64.1 (SecureTransport) LibreSSL/2.8.3 zlib/1.2.11 nghttp2/1.41.0\nRelease-Date: 2019-03-27\n\nI believe the expected behaviour is that Proxy-Authorization header should be stripped upon a server redirection, since its not within the same domain origin.\n\nI also noticed a similar issue was opened 3 years ago regarding Authorization header: https://curl.se/docs/CVE-2018-1000007.html\n\n## Impact\n\nIf the password is sent via HTTPS, the server may redirect it to over unencrypted protocols if sent to an HTTP web server, making the Interception of the password possible.","weakness":{"id":34,"name":"Cleartext Transmission of Sensitive Information"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["salahhasoneh"],"severity":{"rating":"medium","score":4.4,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":18844,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/curl/curl","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10467042,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To reproduce:\n\n1. Setup Server1 to redirect / to another host (e.g. Server2:8081)\n\nServer 1 example Flask config:\n\n\n```\nfrom flask import Flask, redirect, request\napp = Flask(__name__)\n@app.route('/')\ndef hello():\n    print(request.__dict__)\n    return redirect('http://server2:8081/')\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8000)\n```\n\nOn Server2, use netcat to listen on port 8081\n`nc -l 8081`\n\nThen issue the following command:\n`curl -H \"Authorization-Proxy: Basic xxx==\" http://Server1:8000 -L`\n\nOn Server2, the request from the Client will include the Proxy-Authorization header\n\n\n\n\n\n","automated_response":false,"created_at":"2021-01-25T03:40:19.898Z","updated_at":"2021-01-25T03:41:32.960Z","actor":{"username":"dftrace","cleared":false,"url":"/dftrace","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10468663,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"How is this not just the user asking for this to happen?","automated_response":false,"created_at":"2021-01-25T08:39:04.830Z","updated_at":"2021-01-25T08:39:04.830Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/y9xzl5ayi7du4kz3l6pa6sff2ha5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22final-12-1000x1000.jpg%22%3B%20filename%2A%3DUTF-8%27%27final-12-1000x1000.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132336Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e20537a5320a97fe13cc58e460172b25fe95a784c2b3691247d7150c1364c3c1"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10472454,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is a valid point, an edge case I see is if a client is using proxy server DNS that has changed or the proxy's IP has recycled (e.g. AWS IP that was re-assigned).\n\nIt is not a probable scenario, but I did go ahead and check other client behaviours just for comparison:\n\nThe following http clients strip Proxy-Auth on redirection:\n1. Python http-requests \n2. HTTPie \n\nAnd these clients don't seem to strip:\n1. wget\n2. Go-http library\n\nFeel free to close if it's not worth addressing in curl","automated_response":false,"created_at":"2021-01-25T13:48:13.856Z","updated_at":"2021-01-25T13:48:13.856Z","actor":{"username":"dftrace","cleared":false,"url":"/dftrace","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10473717,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"If a user wanted to send that header to a proxy they would also specify a proxy with `-x` or another way to make sure a proxy is used, and then the header would get sent over the connection to that proxy.\n\nIf a user wanted to be **really sure** that the header it passes to curl is indeed only sent to a proxy, then `-H` is the wrong option. curl features `--proxy-header` for this, to make sure that the header is never sent to the wrong party.\n\nI honestly cannot see a security problem here on curl's behalf.","automated_response":false,"created_at":"2021-01-25T15:59:21.685Z","updated_at":"2021-01-25T15:59:21.685Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/y9xzl5ayi7du4kz3l6pa6sff2ha5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22final-12-1000x1000.jpg%22%3B%20filename%2A%3DUTF-8%27%27final-12-1000x1000.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132336Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e20537a5320a97fe13cc58e460172b25fe95a784c2b3691247d7150c1364c3c1"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10473723,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-01-25T15:59:31.649Z","updated_at":"2021-01-25T15:59:31.649Z","first_to_agree":true,"actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/y9xzl5ayi7du4kz3l6pa6sff2ha5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22final-12-1000x1000.jpg%22%3B%20filename%2A%3DUTF-8%27%27final-12-1000x1000.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132336Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e20537a5320a97fe13cc58e460172b25fe95a784c2b3691247d7150c1364c3c1"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10910772,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2021-03-08T08:25:39.610Z","updated_at":"2021-03-08T08:25:39.610Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/y9xzl5ayi7du4kz3l6pa6sff2ha5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22final-12-1000x1000.jpg%22%3B%20filename%2A%3DUTF-8%27%27final-12-1000x1000.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132336Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e20537a5320a97fe13cc58e460172b25fe95a784c2b3691247d7150c1364c3c1"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}