{"id":1183302,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTgzMzAy","url":"https://hackerone.com/reports/1183302","title":"Default Nextcloud allows http federated shares","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2021-05-03T21:13:30.007Z","submitted_at":"2021-05-03T21:13:30.101Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rtod","url":"/rtod","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-05-11T11:38:49.919Z","bug_reporter_agreed_on_going_public_at":"2021-05-11T11:33:35.937Z","team_member_agreed_on_going_public_at":"2021-05-11T11:38:49.835Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"1. userA on serverA runs on http only\n2. userA sends a federated share to userB on serverB\n3. userB is a normal user so he has no clue that there is no secure transport used and accepts the share\n4. all the data written to and read from is now no longer protected by TLS\n\n## Impact\n\nWhile maybe a bit far fetched. But this would allow for man in the middle attacks. Nextcloud just seems to allow plain http communication by default.\nIt is in my opinion not sensible at all to expect end users to know the difference here.\n\nI propose:\n\n1. Allow only https by default (certificates are easy and cheap these days)\n2. If it is for local debugging then only allow http when debugging\n3. If really needed for some edge case make this explicit opt in in config.php","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["wi11","ekgaribadmi","dneha"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11604647,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-05-03T21:13:30.681Z","updated_at":"2021-05-03T21:13:30.681Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11614972,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Looking at the code here, by default Federated Sharing does use the HTTPS protocol unless the sharer specifies the target domain actually as HTTP.\n\nhttps://github.com/nextcloud/server/blob/9de329a4c2327767d86bd7f594b232eb56af0d01/apps/federatedfilesharing/lib/Notifications.php#L329-L360\n\nBased on the logic sharing to `lukas@example.com` should use `https://example.com`. `lukas@http://example.com` shares to `http://example.com`.\n \nSo whilst this still allows a user to use an insecure connection, this seems to need an explicit action by the user. I agree however that it is worthwhile to show some warning in the UI in case someone initiates such a share, I've filed https://github.com/nextcloud/server/issues/26872  for this.\n\nUnless there is a case in which we by default establish a HTTP connection (which would allow downgrade attacks), we'd probably prefer handling this issue on GitHub.","automated_response":false,"created_at":"2021-05-04T16:06:57.293Z","updated_at":"2021-05-04T16:06:57.293Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11616613,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"So the issue in my opinion is a bit different.\n\nit is not about outgoing federated shares. But incoming ones.\n\nSo as described above. If userB thinks their data is secure because they have a properly secured connection to their own server. However their data that they put in the share with userA is transmitted over plain HTTP.\nThe only time this is shown to userB is when they receive the federated share. However like I said most users don't know this stuff and just press accept. But then it just shows up as a normal folder. Without any indication this is an insecure connection.\n\nI do get your argument to handle it on github. Which is of course fine by me.","automated_response":false,"created_at":"2021-05-04T18:37:28.372Z","updated_at":"2021-05-04T18:37:28.372Z","actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11696804,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thanks for your feedback :) - Let's handle this on GitHub and make sure to address this. We look forward to your future submissions :)","automated_response":false,"created_at":"2021-05-11T10:53:41.112Z","updated_at":"2021-05-11T10:53:41.112Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11697229,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"All good!","automated_response":false,"created_at":"2021-05-11T11:33:35.959Z","updated_at":"2021-05-11T11:33:35.959Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11697302,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-11T11:38:49.859Z","updated_at":"2021-05-11T11:38:49.859Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11697303,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-05-11T11:38:49.959Z","updated_at":"2021-05-11T11:38:49.959Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}