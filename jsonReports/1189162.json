{"id":1189162,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTg5MTYy","url":"https://hackerone.com/reports/1189162","title":"End to end encryption public key is not properly verified on Desktop and Android","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2021-05-08T19:22:20.438Z","submitted_at":"2021-05-08T19:22:20.483Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rtod","url":"/rtod","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-09-23T12:25:34.076Z","bug_reporter_agreed_on_going_public_at":"2021-08-24T12:25:30.993Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Since last time when I reported something on multiple platforms you seems to prefer handling it in 1 spot. I now just do one. Let me know if You want me to fill separate for android as well. This issue does not seem to happen on iOS as there a test string is encrypted and decrypted, in short binding the keypair.\n\nSo the attack vector results in weird behavior but that seems to be due to random bugs in the end to end encryption implementations (because I also ran into those when just messing around with the end to end encryption). In any case there should be a big error if this happens. \n\n1. userA has an account on serverA\n2. End2End encryption is enabled on serverA\n3. userA setups device1 and enabled end to end encryption. Stores the nonce. Uploads some data. All is good.\n4. Now an attacker obtains access to the server, for sake of argument assume there is an evil Admin.\n5. They replace the public key of userA with their own\n6. userA now setups device2\n7, userA enters the nonce\n8. userA uploads more data\n9. the evil admin now has access to the uploaded data\n\n## Impact\n\nIn short it breaks the whole premise of your end to end encryption. An evil admin is able to make the device encrypt to their key.\n\nIt is even in the RFC: https://github.com/nextcloud/end_to_end_encryption_rfc/blob/master/RFC.md#further-devices\n\"Client checks if private key belongs to previously downloaded public certificate.\"\n\nRecommendations:\n1. the clients should verify that the private key matches with the public key and if not  throw a big error\n\nThis is especially important because somebody is clearly doing something they are not supposed to if this happens.","bounty_amount":"1500.0","formatted_bounty":"$1,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-09-23T12:25:31.050Z","allow_singular_disclosure_after":-1559119.802158766,"singular_disclosure_allowed":true,"vote_count":9,"voters":["woff","alp","superpwd","chal13w1zz","cybkam","indianblackparrot","mockera123","meispi","mudejar"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":77,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"Desktop Client","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11672062,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-05-08T19:22:20.902Z","updated_at":"2021-05-08T19:22:20.902Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11678748,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks again for your reports :)\nI filled a report internally and we'll get back to you once we have more information.","automated_response":false,"created_at":"2021-05-10T06:49:55.737Z","updated_at":"2021-05-10T06:49:55.737Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11805772,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $1500.\n\nThanks a lot for making the internet a safer place and keep hacking. Please keep in mind that we didn't patch the vulnerability yet, so please do not share this information with any third-parties.","automated_response":false,"created_at":"2021-05-19T12:11:43.954Z","updated_at":"2021-05-19T12:11:43.954Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"rtod","url":"/rtod"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11878688,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This should potentially be resolved with https://github.com/nextcloud/desktop/pull/3338 and https://github.com/nextcloud/android/pull/8438.","automated_response":false,"created_at":"2021-05-25T15:10:39.661Z","updated_at":"2021-05-25T15:10:39.661Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11900107,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks about right indeed","automated_response":false,"created_at":"2021-05-27T09:23:39.758Z","updated_at":"2021-05-27T09:23:39.758Z","actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12223863,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"With those merged I assume this can be closed and disclosed soon.","automated_response":false,"created_at":"2021-06-23T18:22:20.766Z","updated_at":"2021-06-23T18:22:20.766Z","actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12272555,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I've talked to the product teams here and they told me that they are aiming to release a patched Desktop release at the end of July.\n\nThe draft advisories are at:\n\n- [Android](https://github.com/nextcloud/security-advisories/security/advisories/GHSA-5v33-r9cm-7736)\n- [Desktop](https://github.com/nextcloud/security-advisories/security/advisories/GHSA-f5fr-5gcv-6cc5)","automated_response":false,"created_at":"2021-06-28T14:10:10.157Z","updated_at":"2021-06-28T14:10:10.157Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12805016,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be fixed with 3.3.0 released today.","automated_response":false,"created_at":"2021-08-03T14:14:51.238Z","updated_at":"2021-08-03T14:14:51.238Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rtod","url":"/rtod"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13144464,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-24T12:25:31.018Z","updated_at":"2021-08-24T12:25:31.018Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":13595508,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-09-23T12:25:34.115Z","updated_at":"2021-09-23T12:25:34.115Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}