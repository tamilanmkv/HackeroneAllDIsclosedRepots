{"id":1192470,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTkyNDcw","url":"https://hackerone.com/reports/1192470","title":"Clients do not verify server public key","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2021-05-11T19:53:21.305Z","submitted_at":"2021-05-11T19:53:21.365Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rtod","url":"/rtod","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-09-23T12:25:24.232Z","bug_reporter_agreed_on_going_public_at":"2021-08-24T12:25:17.491Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"So this is related to https://hackerone.com/reports/1189162 but also to your RFC\n\nBear with me because there is going to be some hand waving here and there. Since not everything is implemented yet from your RFC.\n\nRight now what happens is: https://github.com/nextcloud/end_to_end_encryption_rfc/blob/master/RFC.md#initial-device\nThe missing step there is that the returned certificate in step 4 is verified by the client to be signed by the actual server.\n\nThis serves multiple purposes.\n\n1. It will allow clients to detect (more easily) if the server has been compromised. For example if public key changed\n2. The sharing described there does require the client to check the certificate of another user against the servers certificate. However without making sure that is the same certificate as your key this check is not that useful\n\n(This is for now ignoring the fact that a compromised server can issue any cert they want, HSM and CT would really help a lot here!)\n\nTo summarize. Clients should:\n\n1. on initial setup verify that their certificate is signed by the public key of the server\n2. on adding a new device they should also verify their obtained public key is signed by the server\n\n## Impact\n\nCurrently there is nothing stopping a compromised server from sending each client a different public key for the server. And upon sharing (once implemented) people would not even notice that both their keys are signed by a different server CA.\n\nI believe this check is somewhat implied in the RFC but not made explicit. And hence non of the clients do this.\nCurrently I do not see a big impact. But this should be fixed to make your end to end encryption more robust and less prone to be broken in the future.","bounty_amount":"250.0","formatted_bounty":"$250","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-09-23T12:25:17.548Z","allow_singular_disclosure_after":-1559153.074497844,"singular_disclosure_allowed":true,"vote_count":15,"voters":["alp","ali","sudi","h4x0r_dz","concerberus","dronr168","m0rt_s3c","real_vivek","mr_tadoo","rkyadav1277","and 5 more..."],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":70612,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/end_to_end_encryption","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11706444,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-05-11T19:53:22.041Z","updated_at":"2021-05-11T19:53:22.041Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11709393,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks once again for your report :)\nI have informed the team that wrote the RFC and the client teams. And we'll get back to you once we have more info.","automated_response":false,"created_at":"2021-05-12T06:52:55.742Z","updated_at":"2021-05-12T06:52:55.742Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11805638,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The potential patch for the Android app can be found at https://github.com/nextcloud/android/pull/8438","automated_response":false,"created_at":"2021-05-19T11:55:38.072Z","updated_at":"2021-05-19T11:55:38.072Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11805830,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $250.\n\nThanks a lot for making the internet a safer place and keep hacking. Please keep in mind that we didn't patch the vulnerability yet, so please do not share this information with any third-parties.","automated_response":false,"created_at":"2021-05-19T12:17:50.272Z","updated_at":"2021-05-19T12:17:50.272Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"rtod","url":"/rtod"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12272572,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The potential patch for the Desktop client can be found at https://github.com/nextcloud/desktop/pull/3494","automated_response":false,"created_at":"2021-06-28T14:11:43.969Z","updated_at":"2021-06-28T14:11:43.969Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12805251,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be fixed in the latest releases for the Desktop and Android app. As there's no current big security impact we have not filed an advisory for it. But feel free to request disclosure here on HackerOne :-)","automated_response":false,"created_at":"2021-08-03T14:27:33.358Z","updated_at":"2021-08-03T14:27:33.358Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rtod","url":"/rtod"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13144462,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-24T12:25:17.517Z","updated_at":"2021-08-24T12:25:17.517Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":13595507,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-09-23T12:25:24.477Z","updated_at":"2021-09-23T12:25:24.477Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}