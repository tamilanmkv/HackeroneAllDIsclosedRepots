{"id":1193321,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTkzMzIx","url":"https://hackerone.com/reports/1193321","title":"Scoped apptokens can be changed by that very apptoken","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2021-05-12T11:09:51.926Z","submitted_at":"2021-05-12T11:09:52.009Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rtod","url":"/rtod","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-32688"],"singular_disclosure_disabled":false,"disclosed_at":"2021-07-15T19:10:01.824Z","bug_reporter_agreed_on_going_public_at":"2021-06-15T19:09:55.053Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I noticed that there is the possibility to limit apptokens to not be able to access the filesystem.\n\n1. Create a new apptoken in `https://server/settings/user/security`\n2. Click the .. of your new apptoken and make it not allowed to access the filesystem\n3. Log out\n4. Navigate to `https://server/remote.php/dav` and login with your username + apptoken\n5. Navigate again to `https://server/settings/user/security`\n6. You won't be able to access the apptoken data\n7. Obtain the CSRF token\n8. Send a PUT request to `https://server/settings/personal/authtokens/ID` chaging the scope\n\nNow the ID you do not know. However even on a decent sized system it is not hard to iterate this as there is no rate limiting or throttling at all.\nAnd voila. You have filesystem access.\n\nYou could also remove other apptokens of the same user (if you'd want).\n\n## Impact\n\nLeaked scoped tokens could be used to gain full access to all your data. Defeating the whole purpose of scoped tokens.\n\nI recommend.\n\n1. Only allow tokens that result from a real login (so user+pass+2fa) to modify/delete tokens\n2. Do not allow the current token in use to edit itself","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-07-15T19:09:55.167Z","allow_singular_disclosure_after":-7582880.424951648,"singular_disclosure_allowed":true,"vote_count":35,"voters":["obsesif","run_win","fqdn","ibring","khizer47","not_khun_myat","akashhamal0x01","ganofins","phantomin","grmx","and 25 more..."],"severity":{"rating":"high","score":8.7,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11714252,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-05-12T11:09:52.533Z","updated_at":"2021-05-12T11:09:52.533Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11714717,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report.\nWe could verify the issue and filled an internal ticket. We'll get back to you once we have more information.","automated_response":false,"created_at":"2021-05-12T12:01:32.814Z","updated_at":"2021-05-12T12:01:32.814Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11805838,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $1000.\n\nThanks a lot for making the internet a safer place and keep hacking. Please keep in mind that we didn't patch the vulnerability yet, so please do not share this information with any third-parties.","automated_response":false,"created_at":"2021-05-19T12:18:27.973Z","updated_at":"2021-05-19T12:18:27.973Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"rtod","url":"/rtod"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11807334,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This will be resolved in our next maintenance releases and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","automated_response":false,"created_at":"2021-05-19T14:51:55.163Z","updated_at":"2021-05-19T14:51:55.163Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"rtod","url":"/rtod"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11810992,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Name: rtod\nEmail: robottod@protonmail.com","automated_response":false,"created_at":"2021-05-19T19:20:57.989Z","updated_at":"2021-05-19T19:20:57.989Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11938669,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"As per the GitHub commits the patches for these will be included in the next release. Cancelling disclosure for now until we are closer to the release dates.","automated_response":false,"created_at":"2021-05-31T14:15:00.454Z","updated_at":"2021-05-31T14:15:00.454Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12131916,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-06-15T19:09:55.114Z","updated_at":"2021-06-15T19:09:55.114Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12138807,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Draft advisory is at https://github.com/nextcloud/security-advisories/security/advisories/GHSA-48m7-7r2r-838r","automated_response":false,"created_at":"2021-06-16T08:55:34.414Z","updated_at":"2021-06-16T08:55:34.414Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12369190,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2021-07-06T11:39:10.853Z","updated_at":"2021-07-06T11:39:10.853Z","cve_ids":["CVE-2021-32688"],"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12518261,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-07-15T19:10:01.926Z","updated_at":"2021-07-15T19:10:01.926Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}