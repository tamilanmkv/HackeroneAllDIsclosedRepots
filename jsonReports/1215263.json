{"id":1215263,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjE1MjYz","url":"https://hackerone.com/reports/1215263","title":"Download of file with arbitrary extension via injection into attachment header","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2021-06-02T10:31:29.334Z","submitted_at":"2021-06-02T10:31:29.465Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-32679"],"singular_disclosure_disabled":false,"disclosed_at":"2021-08-11T09:15:26.776Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-07-12T09:15:20.347Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Description\n-----------\n\nWhen downloading mail attachments, the app fails to properly escape quotes in the content disposition header. Because of this, an attacker can send a victim a file with a benign extension such as `.txt` or `.png` which when downloaded will be stored with a malicious extension such as `.bat` or `.docm`. \n\nThis vulnerability can for example be exploited in the following scenarios:\n\n- It allows bypassing of extension-based attachment filtering by email providers (or other intermediate email systems), as is common in many networks.\n- As the attachment is displayed as a benign file in Nextcloud, a user may incorrectly trust it to be a benign file.\n\n\nPOC\n---\n\n- Send a mail to an email address that is connected to Nextcloud Mail with an attached file called `test.bat\".png`. \n- open the mail -\u003e click on the attachment icon -\u003e click on the download icon. While Nextcloud correctly displays the file as a benign `.png` file, it will be downloaded as `test.bat` instead.  \n\nTested with Firefox under Windows.\n\nAs alternative to `.bat` files (which may be prevented from executing by Microsoft Defender SmartScreen), an attacker can also send other malicious files such as for example `.vbs` files, as well as `.docm` files containing macro viruses.\n\n\nRequest\n-------\n\n```\n    GET /nextcloud/index.php/apps/mail/api/messages/26/attachment/2 HTTP/1.1\n    Host: 192.168.0.101\n\n    HTTP/1.1 200 OK\n    [...]\n    Content-Disposition: attachment; filename=\"test.bat\".png\"\n    [...]\n    Content-Type: application/octet-stream\n\n    C:\\Windows\\system32\\calc.exe\n```\n\nSolution\n--------\n\nQuotes should be properly escaped before being inserted into the Content-Disposition header.\n\n## Impact\n\nOffering malicious files for download, leading to code execution on the computer of the victim if they download and open the file.","bounty_amount":"125.0","formatted_bounty":"$125","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-08-11T09:15:20.501Z","allow_singular_disclosure_after":-5285850.076279446,"singular_disclosure_allowed":true,"vote_count":6,"voters":["obsesif","ali","cryptographer","kingston93","sakpase","cr0wsj"],"severity":{"rating":"medium","score":4.7,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"changed","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":45132,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/mail","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11958716,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-06-02T10:31:30.334Z","updated_at":"2021-06-02T10:31:30.334Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11962680,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Nice catch! I've file a ticket for the product team.","automated_response":false,"created_at":"2021-06-02T16:35:54.440Z","updated_at":"2021-06-02T16:35:54.440Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11963000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"https://github.com/nextcloud/server/pull/27354 should potentially patch this. ","automated_response":false,"created_at":"2021-06-02T17:02:55.119Z","updated_at":"2021-06-02T17:02:55.119Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11963083,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @lukasreschkenc,\n\nI can confirm that the fix works, and that I wasn't able to find a bypass for it.\n\nBest,\nFoobar7","automated_response":false,"created_at":"2021-06-02T17:09:11.525Z","updated_at":"2021-06-02T17:09:11.525Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12042558,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This will be resolved in our next maintenance releases next month (19.0.13, 20.0.11, 21.0.3) and we're working on the advisories at the moment.\n\nIf you have a GitHub account please let us know the username, and we will associate it with the advisory.\n","automated_response":false,"created_at":"2021-06-09T18:57:15.257Z","updated_at":"2021-06-09T18:57:15.257Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12042576,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $125 as the risk is minimal.\n\nThanks a lot for making the internet a safer place and keep hacking. Please keep in mind that we didn't patch the vulnerability yet, so please do not share this information with any third-parties.","automated_response":false,"created_at":"2021-06-09T18:59:51.361Z","updated_at":"2021-06-09T18:59:51.361Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"125.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12042677,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Draft advisory at https://github.com/nextcloud/security-advisories/security/advisories/GHSA-3hjp-26x8-mhf6. If you share your username with us, we can grant you early access to it.","automated_response":false,"created_at":"2021-06-09T19:11:53.138Z","updated_at":"2021-06-09T19:11:53.138Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12044393,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2021-06-09T22:21:35.436Z","updated_at":"2021-06-09T22:21:35.436Z","cve_ids":["CVE-2021-32679"],"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12139390,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @lukasreschkenc ,\n\nthanks for the bounty!\n\nMy github account: https://github.com/foobar7\n\nBest,\nFoobar7","automated_response":false,"created_at":"2021-06-16T09:42:18.550Z","updated_at":"2021-06-16T09:42:18.550Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12446836,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-07-12T09:15:20.380Z","updated_at":"2021-07-12T09:15:20.380Z","first_to_agree":true,"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12927106,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-08-11T09:15:26.997Z","updated_at":"2021-08-11T09:15:26.997Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}