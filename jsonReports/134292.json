{"id":134292,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzQyOTI=","url":"https://hackerone.com/reports/134292","title":"Attacker can delete (and read) private project webhooks","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-24T23:08:05.147Z","submitted_at":"2016-04-24T23:08:05.147Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-05-03T01:00:03.985Z","bug_reporter_agreed_on_going_public_at":"2016-05-03T00:55:06.369Z","team_member_agreed_on_going_public_at":"2016-05-03T01:00:03.868Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability details\nAn attacker can delete and read webhooks that are configured for all projects on a GitLab instance. This includes private projects. This is a bad vulnerability because these webhooks contain private (API) tokens most of the time.\n\n# Proof of concept\nAs a victim, create a project and a webhook. Make sure you know the unique ID of the webhook. You can find this by looking at the \"Test hook\" button. In this example, the ID is `1`. Now as the attacker, which doesn't have access to the webhook, create another project. Since the attacker is the owner of this project, it can send API requests to `/projects/:id` and access its sub resources. By executing the following cURL request command, the webhook of the victim can be destroyed and read:\n\n```bash\ncurl -X DELETE --header \"PRIVATE-TOKEN: XXXXXXXXXXX\" \"http://gitlab-instance/api/v3/projects/2/hooks/1\"\n```\n\nThe attacker has access to project with ID 2, but the webhook with ID 1 belongs to a different project (see the response below). The response leaks the private webhook URL and on which events it would be fired. The request deletes the webhook, but the attacker can now keep digging with the leaked webhook URL.\n\n```json\n{\n  \"id\":1,\n  \"url\":\"http://secret.com/\",\n  \"project_id\":24,\n  \"created_at\":\"2016-04-24T22:16:58.044Z\",\n  \"updated_at\":\"2016-04-24T22:16:58.044Z\",\n  \"service_id\":null,\n  \"push_events\":true,\n  \"issues_events\":false,\n  \"merge_requests_events\":false,\n  \"tag_push_events\":false,\n  \"note_events\":false,\n  \"enable_ssl_verification\":true,\n  \"build_events\":false\n}\n```\n\n# Fix\nThe problem arises from `lib/api/project_hooks.rb:104`. Instead of calling `user_project.hooks.find`, it searches in all project hooks to fetch the object: `ProjectHook.find`. I attached the fix for this problem.","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":89269,"file_name":"project-hook-fix.diff","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/089/269/a8e6040b2cfc1e93d1c362e2e215346d3809062f/project-hook-fix.diff?response-content-disposition=attachment%3B%20filename%3D%22project-hook-fix.diff%22%3B%20filename%2A%3DUTF-8%27%27project-hook-fix.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T133842Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f97214519ae16bd8243b09bad7a4d40ffdb011dcc4e75b9c9161c3f43d408835","file_size":479,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2016-06-02T00:55:06.472Z","allow_singular_disclosure_after":-169130615.56847963,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","xaleraf4ra","spetr0x","dyabla","cryptosector"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":925321,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@jobert Thanks for the report. I've opened https://gitlab.com/gitlab-org/gitlab-ce/issues/15576 which is currently confidential. I'll try to make sure we include a fix for this in the next set of security patches which we currently plan to announce Monday and release Wednesday, to give admins time to schedule the upgrade.\n\nAs always I'll keep you updated here on the progress of this issue.","automated_response":false,"created_at":"2016-04-24T23:15:41.651Z","updated_at":"2016-04-24T23:15:41.651Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":925322,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2016-04-24T23:15:49.115Z","updated_at":"2016-04-24T23:15:49.115Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937751,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@jobert The patches that include a fix for this issue [have been released](https://about.gitlab.com/2016/05/02/cve-2016-4340-patches/) and the [acknowledgements page](https://about.gitlab.com/vulnerability-acknowledgements/) has been updated.\n\nFeel free to request public disclosure for this report if you'd like.\n\nThank you again!","automated_response":false,"created_at":"2016-05-03T00:52:55.495Z","updated_at":"2016-05-03T00:52:55.495Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937767,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-05-03T00:55:06.407Z","updated_at":"2016-05-03T00:55:06.407Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":937787,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-05-03T01:00:03.905Z","updated_at":"2016-05-03T01:00:03.905Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937788,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-05-03T01:00:04.022Z","updated_at":"2016-05-03T01:00:04.022Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}