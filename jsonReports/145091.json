{"id":145091,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDUwOTE=","url":"https://hackerone.com/reports/145091","title":"Stored XSS from ticket messages in admin table in SupportFlow","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-06-16T05:10:25.085Z","submitted_at":"2016-06-16T05:10:25.085Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"whitehatter","url":"/whitehatter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":162,"url":"https://hackerone.com/iandunn-projects","handle":"iandunn-projects","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/162/2b148a5580e8f7c45d676df7576fb8b11b4de9ad_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/162/2b148a5580e8f7c45d676df7576fb8b11b4de9ad_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ian Dunn","twitter_handle":"","website":"","about":"I'm a WordPress developer who maintains several small open source projects."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-06-28T19:44:03.912Z","bug_reporter_agreed_on_going_public_at":"2016-06-28T19:44:03.736Z","team_member_agreed_on_going_public_at":"2016-06-28T19:39:39.003Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"SupportFlow containers a stored XSS vulnerability in how it generates the admin table of tickets at _SupportFlow -\u003e All Tickets_ (`/wp-admin/edit.php?post_type=sf_ticket`).\n\nAny ticket can be created with an XSS payload like this:\n\n```\n\u003cscript\u003ealert('XSS');\u003c/script\u003e\n```\n\nWhen an admin goes to view the table of tickets, XSS is triggered, because the value is never escaped here:\n\nhttps://github.com/SupportFlow/supportflow/blob/71a6053848c523f7b50b61a1f3770013badc76c0/classes/class-supportflow-admin.php#L1175\n\nI've attached a screenshot demonstrating the XSS payload - please let me know if there are any questions.","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":99686,"file_name":"Screen_Shot_2016-06-15_at_11.07.55_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/099/686/8a4fc0a3a86e45ce2d06e4f67fbc83a710a29ed2/Screen_Shot_2016-06-15_at_11.07.55_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2016-06-15_at_11.07.55_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2016-06-15_at_11.07.55_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134207Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4a5c7de463716d259b91353c9f1a99c5e58a556f788fac31f28af0e28ec11311","file_size":170533,"type":"image/png"}],"allow_singular_disclosure_at":"2016-07-28T19:39:39.104Z","allow_singular_disclosure_after":-164224948.62449038,"singular_disclosure_allowed":true,"vote_count":5,"voters":["whitehatter","eveeez","drstache","dyabla","arice"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1017783,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the report, it looks valid. I'll take a closer look today and work on a fix.","automated_response":false,"created_at":"2016-06-16T18:22:22.853Z","updated_at":"2016-06-16T18:22:22.853Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1018239,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, just wanted to let you know that it looks like I'll need a few days to get a patch ready. I'll give you an update sometime next week.","automated_response":false,"created_at":"2016-06-16T23:30:26.451Z","updated_at":"2016-06-16T23:30:26.451Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1018435,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update!","automated_response":false,"created_at":"2016-06-17T02:44:13.900Z","updated_at":"2016-06-17T02:44:13.900Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1019787,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can you describe more about how you achieved this? So far the only way I've been able to reproduce it was to manually enter the payload into the database.\n\nThe ticket bodies are passed through `sanitize_ticket_reply()` [when new emails are recieved from external customers](https://github.com/SupportFlow/supportflow/blob/d76d1168d556eca850b40f8fcaa20fb2a396f5c1/classes/class-supportflow-email-replies.php#L312), and also [when admins create new tickets](https://github.com/SupportFlow/supportflow/blob/71a6053848c523f7b50b61a1f3770013badc76c0/classes/class-supportflow-admin.php#L1292).\n","automated_response":false,"created_at":"2016-06-17T18:31:29.759Z","updated_at":"2016-06-17T18:31:29.759Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1019892,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I embedded the ticket form into a regular page using the shortcode `[supportflow_submissionform]`, then submitted the resulting form with the XSS payload in the message textarea.\n\nThen I went to the list of tickets in the admin area, and the `alert` popped up.\n\nI was logged in when I submitted the form (haven't tried logged out).","automated_response":false,"created_at":"2016-06-17T19:03:37.602Z","updated_at":"2016-06-17T19:03:37.602Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1019921,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also should report that this was done on the `wordpress-default` (latest stable) site from VVV, on the twentysixteen theme without any customizations, with SupportFlow as installed from the WP Plugins repository.","automated_response":false,"created_at":"2016-06-17T19:11:34.245Z","updated_at":"2016-06-17T19:11:34.245Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1019994,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, ok, I see that now, thanks! The attached diff should fix it.\n\nIt looks like it requires an admins or editor role to bypass the filtering.\n\nSince this one doesn't require `run_wptextureize` to be turned off, I think the CVSS score is [4.8](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N), which also corresponds to $50. You'll be credited in the changelog for this one too.\n\nI'll let you know once the beta for `0.7` is ready. Thanks again for the reports!","automated_response":false,"created_at":"2016-06-17T19:49:02.409Z","updated_at":"2016-06-17T19:49:02.409Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":100074,"filename":"145091.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/100/074/63b45169bed3db808a579c3af17f12e6c2d5a34c/145091.diff?response-content-disposition=attachment%3B%20filename%3D%22145091.diff%22%3B%20filename%2A%3DUTF-8%27%27145091.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSH757YA2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134207Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIF9aqUhLetvML58mN4ogxy%2B6UPAqSKeMxtrKXgCruxpyAiAZA4LyH08LiK63%2BX3j%2FL%2BE8K04lFCAfpkj2U3L%2F%2BQ0JiqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMPZUukqFla3jg3W%2FAKtcDd88OJINrkl7oo%2BDUkLwt6ub0eHL%2FOpOUpfWlA1Tbc4efx1n1oBI%2B782zqkT%2FldKyEkGMp9Cul2tobYxJfnwMz94jkctq%2FsU%2F%2FsKu2u4wJOSL%2FhvUUC%2B9dp45qZlfD69Bsxw4jQBxwq9J8VXp7mEHR0cbPtfww3zed%2BrCOrnLZ6WBmxu6LKSVMCkUhYQm4EiPnez%2F%2BYYVx4AE2%2BbmbWrewptlfyoDdDbyAyfrq8ppNQP%2BSsMbx3AzwuED6a4C5Ya%2Fdm4tvhTG%2F0BUmosdYLHOziWnvsJpEceS7siWOsUUfupiOHUkWueayqYg0pmTBcnvdmB5rtzHIj0f2kXDYFsf9IfYISyRCniiEFFT6gEnN8n6KJJe%2B5kjqIxzIeZnI0Em9oDQCZNpEcFyD5U%2BzPSV1Pbpjn%2BlPGwKacEk1aO6qQjd%2FHZxtQwWd4GzIN6emwVGDYc1paF8W2MQmpSdcXM5T2QlwouBtY1bW61Q%2BNePDl1OQXIhUF5ROSV%2BKnJ1I49w5PGrTXPk9zOCQ0kt%2BJHgSxdAVo5zPOiGwk6FxcOMM%2BSM%2BhB4T29cxb8GeuOCIC9TRrVbKKZ6XDPDM2WqvCWH6Jjp9Hd9yDZiOP%2FWzkaVd82x0UOYQxT3MOPSkIsGOqYBz3ul30JH9OvCSPYzPeCTIBpZTInOnLX5bhiDKmHJWhMstXLQTLPoVlUbg9pGF3Y%2Bn1xSdW1bFES8JWXDl9x82qGMnPWOSQ54RiaN4omqCUXa4mFgetTXSuxwLVSJ%2Fi7QI9UyvZ9RwnLX5Flf8%2FJDbb6PDowZ5LaC786wrj6gOPmdLWaLB1lp13l%2BSWHU7pqATocJ2a%2B0QX99cjPRF0McSf7VWk%2Fbfw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e4cb1748b102e08fdca3278a41010c1eb623849b5fa8258c6b2e7b7235d421ba"}],"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1019998,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2016-06-17T19:49:36.112Z","updated_at":"2016-06-17T19:49:36.112Z","actor":{"url":"/iandunn-projects","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/162/2b148a5580e8f7c45d676df7576fb8b11b4de9ad_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Ian Dunn"}},"bounty_amount":"50.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"iandunn-projects","collaborator":{"username":"whitehatter","url":"/whitehatter"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1020176,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fix looks good - I might suggest using `esc_html()` instead of `strip_tags()`, as it also has the benefit of removing invalid UTF-8 characters at the same time. This will fix the XSS as-is though.\n\nhttps://developer.wordpress.org/reference/functions/esc_html/","automated_response":false,"created_at":"2016-06-17T21:10:10.880Z","updated_at":"2016-06-17T21:10:29.893Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1020287,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, that's a good point, I'll use that instead. Thanks :)","automated_response":false,"created_at":"2016-06-17T21:44:27.311Z","updated_at":"2016-06-17T21:44:27.311Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1043879,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"`0.7` is [now available](https://wordpress.org/plugins/supportflow/). Thanks for the reports!","automated_response":false,"created_at":"2016-06-28T19:38:14.759Z","updated_at":"2016-06-28T19:38:14.759Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"whitehatter","url":"/whitehatter"},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1043886,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-06-28T19:39:39.025Z","updated_at":"2016-06-28T19:39:39.025Z","first_to_agree":true,"actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1043904,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-06-28T19:44:03.778Z","updated_at":"2016-06-28T19:44:03.778Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1043905,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-06-28T19:44:03.941Z","updated_at":"2016-06-28T19:44:03.941Z","actor":{"username":"whitehatter","cleared":true,"url":"/whitehatter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/358/2c8b65e6a1929dcd9bd6a214857909ea5d127f88_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}