{"id":152591,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTI1OTE=","url":"https://hackerone.com/reports/152591","title":"Stored XSS on invoice, executing on any subdomain","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-20T16:16:19.688Z","submitted_at":"2016-07-20T16:16:19.688Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"eboda","url":"/eboda","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":237,"url":"https://hackerone.com/harvest","handle":"harvest","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/237/ce650f9fba222040127528a7c95dab237f8a9734_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/237/ce650f9fba222040127528a7c95dab237f8a9734_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Harvest","twitter_handle":"","website":"http://getharvest.com","about":"Harvest is a leader in online time tracking and invoicing. Work better, and make smarter decisions for your business."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-09-10T22:00:18.072Z","bug_reporter_agreed_on_going_public_at":"2016-08-11T22:00:10.477Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Summary\n-----------\n\nThere is a stored XSS vulnerability, which can execute on any subdomain as the vulnerability lies in an invoice. You are filtering HTML and js, but you neglect to filter out Flash objects, which can execute javascript.\n\nSteps to reproduce\n-------------\n\n1. Create an invoice and add a flash file which executes javascript as an attachment. \n\n    You can use F106128, it is from this site: https://soroush.secproject.com/blog/2012/11/xss-by-uploadingincluding-a-swf-file/ . It will execute whatever javascript you provide in the `js` parameter.\n\n2. Now share the link to your report and the XSS will execute. You can use any subdomain you like. Here are some examples which will execute `alert(document.domain)`:\n\n    https://asdf.harvestapp.com/attachments/171020?client_key=a143393e99114b677ce6450cf9861c3bde60f817\u0026js=alert%28document.domain%29\n\n    https://abcdefghijklmnopqrstuvwxyz.harvestapp.com/attachments/171020?client_key=a143393e99114b677ce6450cf9861c3bde60f817\u0026js=alert%28document.domain%29\n\nImpact\n--------------\n\nThis is a stored XSS effecting all applications/subdomains on harvest. Notice that of course you can create a flash file which directly executes a payload, without the need for the `js` parameter like in my proof of concept.\n\n","bounty_amount":"350.0","formatted_bounty":"$350","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":106128,"file_name":"xss.swf","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/106/128/b255db20d8c11fb9a0d0dbbd1e1de90131f982a0/xss.swf?response-content-disposition=attachment%3B%20filename%3D%22xss.swf%22%3B%20filename%2A%3DUTF-8%27%27xss.swf\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQR4FQPWNR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134526Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJIMEYCIQCqPrnmIM9wXCdiARyRx5Ax4KzkUTX%2BAA9yp0xp0y3hpwIhAJK%2BGpTIPJ74OaDkXCOQ%2BpTihtprvqS4V5mSUh1y2wU%2FKoMECO3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5Igy0%2FlqLwuvawX3UvDsq1wNbthFe3Azfq%2BVrGAAwOW8v13OVbNefIJYMQ5kDsdlb5HJ08yM0BsqcWahF7IL7L7TYky4BDMksLsE9wim6VKGfrGDkJ2xqf6UemXKLHJTFQYvHptU%2F3szZKR%2FC8LR7%2B6tRZxpqeGaKto06xRg8SdPXPwQ5CCa3sr9z%2FRmk5muNSDIunhQbQtOQkGLdzMqVk6VVPeOXhqlyzAfgT3e83vUfoaaCwfF%2FmCbKBDohDMfithPIZLVroT9vBesKP4IjDlzzfZIO7DWiMOSLRzcTHppAapAKQrTx1YmME3lbOKb0RTUhLkV7At9vcRO6%2FkbRxqMqOEJXCe%2BVL%2BrE6bHoa9n8eWt30xCcMDYrLw%2BgUNiWBz8a2WpzU2sJrhEjHnblMQuWDILIalYkMM7YJoCj0JDvimbFcx%2F8UVUXt3vpIX5YNFVB51MFFGtDIlsnHK31GKw%2BwfgWXHTLxmfkdgOmVicYoRI3iUQD%2BjUHVCHtG%2FOyyW6Jh5Ak5SkV4EnucCAmKjnYxfYTVHvx%2F2qHha2gE7PzO9S1%2F2RLePd%2FBkPMLWvvWtpXghc8EXbG%2FOcrKChbXt0T0mlkm27MvkNDjxxQNHnexQvh%2FlyuMHSSQOsIkoZOkQVEAyb5lyww%2FNOQiwY6pAGOxBpxoNSZNy2UBY4lVVkbrwne8yRQlwxEU8lrQJyCH4OggAZ%2By54oO2xX0ZphtYPfkO82%2FzIZHhgLijH2QZ577nmbTN71zYTVaaML3DYqRqLSP9C1%2F2P5bqIcLRlJSM4rutBebgnwegaTqBmzBoQRinHGD5EkmFos1mfkXnqKw3NLMPoOGBtwvSmsJGplUQJI0wq%2BrRsXTMf9szojjKVaxpuAeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3f637c2c89597d41426f1e75eb30bd33fe8e57f6b7980be35ab440ee5a48752c","file_size":1053,"type":"application/x-shockwave-flash"}],"allow_singular_disclosure_at":"2016-09-10T22:00:10.542Z","allow_singular_disclosure_after":-160415116.36742994,"singular_disclosure_allowed":true,"vote_count":15,"voters":["yaworsk","metawolf","ysx","zee_shan","malcolmx","ymy","jens","fantam1","spetr0x","ruisilva","and 5 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1079603,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi Edgar,\n\nThanks again for the detailed report!\n\nVery nicely done, you found a good one with this, the only downside is that you need to have Flash installed, but no vulnerability is perfect :) \nI'll triage the report and will get back to you soon!\n\nRegards,\nJorge","automated_response":false,"created_at":"2016-07-21T08:21:46.246Z","updated_at":"2016-07-21T08:21:46.246Z","actor":{"username":"jorgeleria","cleared":false,"url":"/jorgeleria","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/680/84ed9b9afaf2905ae339b479cf97d7161fd1ae64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1080358,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello Jorge,\n\nI just realized the filter can be more easily bypassed, without the need to have Flash installed. No more downside now :P\n\n1. Upload an attachment and in the request remove the line containing the `Content-Type`:\n    ```\n    Content-Type: image/svg+xml\n```\n\n    so the request should look similar to:\n    ```{bash}\nContent-Disposition: form-data; name=\"asset[data]\"; filename=\"test\"\n\n\n    \u003cscript\u003ealert(document.domain)\u003c/script\u003e\n```\n\n2.  Now share the link you got, and the server will not send a `Content-Type` header, letting the browser guess the content type:\n\n    https://asdfasdfasdf.harvestapp.com/attachments/171407?client_key=171536e6aa8206bf39ea43a5f9443e7a145ed657\n\n\nNotice you can also force a content-type on the browser. In this attachment: https://qwerty.harvestapp.com/attachments/171410?client_key=171536e6aa8206bf39ea43a5f9443e7a145ed657  I have like mixed content and as you can see the browser does not interpret it as html. But if we instead use a link with a `.html`:\n\nhttps://qwerty.harvestapp.com/attachments/171410.html?client_key=171536e6aa8206bf39ea43a5f9443e7a145ed657\n\nwe get XSS again (this trick only works on Firefox, does not seem to work on Chrome).","automated_response":false,"created_at":"2016-07-21T14:51:13.274Z","updated_at":"2016-07-21T14:51:13.274Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1085462,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Edgar,\n\nThanks for the second report, we are very impressed and we are looking into it!\nAbout the first one, I messed up with the avalanche of reports and someone reported it a few hours before you, I'm very sorry about it.\n\nI will get back to you soon!\nCheers,\nJorge\n\n","automated_response":false,"created_at":"2016-07-25T10:58:12.376Z","updated_at":"2016-07-25T10:58:12.376Z","actor":{"username":"jorgeleria","cleared":false,"url":"/jorgeleria","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/680/84ed9b9afaf2905ae339b479cf97d7161fd1ae64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1103672,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Jorge,\n\nthese issues seem to be fixed now. Any update on it?","automated_response":false,"created_at":"2016-08-03T08:40:54.515Z","updated_at":"2016-08-03T08:40:54.515Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1113537,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi Edgar,\n\nAs you said now it is fixed. Going to close the report, and we'll be awarding a bounty in a few days.\nThanks for your patience!\n\nBest regards,\nJorge","automated_response":false,"created_at":"2016-08-08T21:01:36.732Z","updated_at":"2016-08-08T21:01:36.732Z","actor":{"username":"jorgeleria","cleared":false,"url":"/jorgeleria","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/680/84ed9b9afaf2905ae339b479cf97d7161fd1ae64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"eboda","url":"/eboda"},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1119550,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping make Harvest more secure!","automated_response":false,"created_at":"2016-08-11T15:29:55.116Z","updated_at":"2016-08-11T15:29:55.116Z","actor":{"url":"/harvest","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/237/ce650f9fba222040127528a7c95dab237f8a9734_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Harvest"}},"bounty_amount":"350.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"harvest","collaborator":{"username":"eboda","url":"/eboda"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1120523,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great stuff, thank you for the bounty! Mind disclosing this report?","automated_response":false,"created_at":"2016-08-11T21:58:37.772Z","updated_at":"2016-08-11T21:58:37.772Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1120530,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-08-11T22:00:10.509Z","updated_at":"2016-08-11T22:00:10.509Z","first_to_agree":true,"actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1186769,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-09-10T22:00:18.135Z","updated_at":"2016-09-10T22:00:18.135Z","actor":{"url":"/harvest","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/237/ce650f9fba222040127528a7c95dab237f8a9734_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Harvest"}},"genius_execution_id":null,"team_handle":"harvest","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}