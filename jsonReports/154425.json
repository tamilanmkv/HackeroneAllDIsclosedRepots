{"id":154425,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTQ0MjU=","url":"https://hackerone.com/reports/154425","title":"Subdomain takeover on http://fastly.sc-cdn.net/","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-27T18:52:56.828Z","submitted_at":"2016-07-27T18:52:56.828Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ebrietas","url":"/ebrietas","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/020/235/f0a8477c33580e48c0a7371a25431f08adf50ad6_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":513,"url":"https://hackerone.com/snapchat","handle":"snapchat","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Snapchat","twitter_handle":"","website":"https://www.snapchat.com/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-08-22T19:46:06.530Z","bug_reporter_agreed_on_going_public_at":"2016-08-18T22:37:14.234Z","team_member_agreed_on_going_public_at":"2016-08-22T19:46:06.380Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey team,\n\nI've found a snapchat cdn domain here which had a test instance of fastly setup but did not remove the dns record when the service was cancelled. This allowed me to create a Fastly instance to take it over. I've confirmed this is a snapchat property via Censys (https://censys.io/certificates/65ba2e172a1eb85eb1071c9fd7a4e8371ef12625409890507c89a54978305558) though the risk here seems minimal at best as this domain does not appear to be used anywhere on any snapchat properties.\n\nRepro steps:\n\n* Visit http://fastly.sc-cdn.net/takeover.html\n\nRecommended fix:\nRemoval of this record is recommended.\n","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-09-17T22:37:14.600Z","allow_singular_disclosure_after":-159808128.25337327,"singular_disclosure_allowed":true,"vote_count":107,"voters":["r4d1kal","arneswinnen","shubs","xpathmaster","michiel","bogdantcaciuc","spam404","zseano","yaworsk","ebrietas","and 97 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1095931,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@ebrietas\n\nThank you for your report. We are looking into this and will keep you updated with our progress.","automated_response":false,"created_at":"2016-07-29T17:32:01.765Z","updated_at":"2016-07-29T17:32:01.765Z","actor":{"username":"divya","cleared":false,"url":"/divya","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1106772,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey all,\n\nA quick update here, it seems that this domain is actually in use somewhere by Snapchat.\n\nMy server has the following logs:\n\n```\nroot@localhost:~# cat /var/log/apache2/access.log |  grep -v server-status | grep snapchat -i\n\n23.235.39.33 - - [02/Aug/2016:18:28:25 +0000] \"GET /bq/story_blob?story_id=fRaYutXlQBosonUmKavo1uA\u0026t=2\u0026mt=0 HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.1 (iPad2,5; iOS 9.1; gzip)\"\n23.235.39.43 - - [02/Aug/2016:18:28:25 +0000] \"GET /bq/story_blob?story_id=f3gHI7yhW-Q7TeACCzc2nKQ\u0026t=2\u0026mt=0 HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.1 (iPad2,5; iOS 9.1; gzip)\"\n23.235.46.45 - - [03/Aug/2016:02:40:48 +0000] \"GET /bq/story_blob?story_id=fKGG6u9zG4juOFT7-k0PNWw\u0026t=2\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (Nexus 7; Android 5.1.1#1836172#22; gzip)\"\n23.235.46.23 - - [03/Aug/2016:02:40:49 +0000] \"GET /bq/story_blob?story_id=fco3gXZkbBCyGc_Ym8UhK2g\u0026t=2\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (Nexus 7; Android 5.1.1#1836172#22; gzip)\"\n43.249.75.20 - - [03/Aug/2016:12:39:03 +0000] \"GET /discover/dsnaps?edition_id=4527366714425344\u0026dsnap_id=5651565881327616\u0026hash=66e61fa7787383c08a76a131e96915eec2d8b3019a3a96af66496003c9a9b1c1\u0026publisher=Refinery29\u0026quality=android_med9to16-android_med9to16 HTTP/1.1\" 404 455 \"-\" \"Snapchat/9.21.1.0 (GT-I9300; Android 4.3#I9300XWUGML4#18; gzip)\"\n43.249.75.24 - - [03/Aug/2016:12:39:03 +0000] \"GET /bq/story_blob?story_id=ftzqLQky4KJ_B6Jebus2Paw\u0026t=2\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (GT-I9300; Android 4.3#I9300XWUGML4#18; gzip)\"\n43.249.75.22 - - [03/Aug/2016:12:39:03 +0000] \"GET /bq/story_blob?story_id=fEXbJ2SDn3Os8m4aeXs-7Cg\u0026t=2\u0026mt=0 HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (GT-I9300; Android 4.3#I9300XWUGML4#18; gzip)\"\n23.235.46.21 - - [03/Aug/2016:14:46:18 +0000] \"GET /bq/story_blob?story_id=fu8jKJ_5yF71_WEDi8eiMuQ\u0026t=1\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.1 (iPhone5,2; iOS 9.2; gzip)\"\n23.235.46.28 - - [03/Aug/2016:14:46:19 +0000] \"GET /bq/story_blob?story_id=flWVBXvBXToy-vhsBdze11g\u0026t=1\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.1 (iPhone5,2; iOS 9.2; gzip)\"\n23.235.44.35 - - [04/Aug/2016:05:57:37 +0000] \"GET /bq/story_blob?story_id=fuZO-2ouGdvbCSggKAWGTaw\u0026t=0\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (SAMSUNG-SGH-I537; Android 5.0.1#I537UCUCOC7#21; gzip)\"\n23.235.44.46 - - [04/Aug/2016:05:57:37 +0000] \"GET /bq/story_blob?story_id=fa3DTt_mL0MhekUS9ZXg49A\u0026t=0\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.0 (SAMSUNG-SGH-I537; Android 5.0.1#I537UCUCOC7#21; gzip)\"\n185.31.18.21 - - [04/Aug/2016:19:50:01 +0000] \"GET /bq/story_blob?story_id=fDL270uTcFhyzlRENPVPXnQ\u0026t=0\u0026mt=1\u0026encoding=compressed HTTP/1.1\" 404 453 \"-\" \"Snapchat/9.21.1.1 (iPhone7,1; iOS 9.3.2; gzip)\"    \n```\n\nIt appears as if I'd be able to just add content and serve it to whichever app is still in use here. \n\nLet me know if I can assist with anything at all from my end.\n\nThanks,\nEbrietas\n","automated_response":false,"created_at":"2016-08-05T00:07:07.634Z","updated_at":"2016-08-05T00:07:07.634Z","actor":{"username":"ebrietas","cleared":true,"url":"/ebrietas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/235/f0a8477c33580e48c0a7371a25431f08adf50ad6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1113329,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@ebrietas  we are working on this and will update you with our progress. Thanks for your report!","automated_response":false,"created_at":"2016-08-08T18:53:01.562Z","updated_at":"2016-08-08T18:53:01.562Z","actor":{"username":"divya","cleared":false,"url":"/divya","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1118181,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @ebrietas,\n\nThank you again for submitting this report.  We have mitigated the issue and you should no longer be able to control the subdomain or receive client requests.  The requests to this domain were not authenticated and therefore did not expose access tokens or cookies.  However, as you pointed out, clients could have potentially been served malicious content.  Can you please confirm that the fix resolves the issue?\n\nThank you!\n\nAndrew","automated_response":false,"created_at":"2016-08-10T21:53:21.735Z","updated_at":"2016-08-10T21:53:21.735Z","actor":{"username":"andrew_hill","cleared":false,"url":"/andrew_hill","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/067/926/c7568eb05964a9b74f986f5bd18a1fe7790c6c8f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1118203,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @andrew_hill ,\n\nThanks for the additional info, I was quite curious as to how far I could have gone.  I can confirm that this fix is legit and I can no longer takeover this domain as it's now pointing to a resource you control. \n\nThanks,\nEbrietas","automated_response":false,"created_at":"2016-08-10T22:00:32.883Z","updated_at":"2016-08-10T22:00:32.883Z","actor":{"username":"ebrietas","cleared":true,"url":"/ebrietas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/235/f0a8477c33580e48c0a7371a25431f08adf50ad6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1132322,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! The panel has decided to award you $3000 for your bug report. We appreciate your efforts - thanks, and good luck on your future bug hunting!","automated_response":false,"created_at":"2016-08-17T17:13:33.340Z","updated_at":"2016-08-17T17:13:33.340Z","actor":{"url":"/snapchat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Snapchat"}},"bounty_amount":"3000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"snapchat","collaborator":{"username":"ebrietas","url":"/ebrietas"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1132325,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2016-08-17T17:13:50.687Z","updated_at":"2016-08-17T17:13:50.687Z","actor":{"username":"andrew_hill","cleared":false,"url":"/andrew_hill","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/067/926/c7568eb05964a9b74f986f5bd18a1fe7790c6c8f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ebrietas","url":"/ebrietas"},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1135437,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @ebrietas,\n\nCongratulations again.  Just wanted to expand on what could have happened.  A very small subset of users using an old client that had not checked-in following the CDN trial period would have reached out for static, unauthenticated content (no sensitive media).  Shortly after, the clients would have refreshed their configuration and reached out to the correct endpoint.  In theory, alternate media could have been served to this very small set of users on this client version for a brief period of time.\n\nThank you again,\n\nAndrew","automated_response":false,"created_at":"2016-08-18T21:01:46.826Z","updated_at":"2016-08-18T21:01:46.826Z","actor":{"username":"andrew_hill","cleared":false,"url":"/andrew_hill","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/067/926/c7568eb05964a9b74f986f5bd18a1fe7790c6c8f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1138915,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hey @andrew_hill,\n\nThanks for giving more insight into this issue and for the bounty! I feel this was handled extremely well by Snapchat and would like to disclose this issue if at all possible. \n\nRegards,\nEbrietas","automated_response":false,"created_at":"2016-08-18T22:37:14.397Z","updated_at":"2016-08-18T22:37:14.397Z","first_to_agree":true,"actor":{"username":"ebrietas","cleared":true,"url":"/ebrietas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/235/f0a8477c33580e48c0a7371a25431f08adf50ad6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1145705,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-08-22T19:46:06.423Z","updated_at":"2016-08-22T19:46:06.423Z","actor":{"username":"divya","cleared":false,"url":"/divya","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1145706,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-08-22T19:46:06.566Z","updated_at":"2016-08-22T19:46:06.566Z","actor":{"username":"divya","cleared":false,"url":"/divya","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}