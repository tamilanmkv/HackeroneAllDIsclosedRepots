{"id":157270,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTcyNzA=","url":"https://hackerone.com/reports/157270","title":"CSRF vulnerability that allows an attacker to purge plugin metric data","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-06T22:47:20.418Z","submitted_at":"2016-08-06T22:47:20.418Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"martijn","url":"/martijn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-05T08:48:08.879Z","bug_reporter_agreed_on_going_public_at":"2016-11-05T08:48:07.990Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability details\nA (seemingly) minor CSRF vulnerability exists in the endpoint that purges plugin metric data. When an admin visits the Agent overview of its account, it will show a button for each plugin that allows the admin to purge the data. This button links to a `GET` requests that is vulnerable to a CSRF attack.\n\n# Proof of concept\nThe attack is not super likely to be successfully pulled off, given the fact that the attacker needs to know the account ID and the plugin ID. However, in theory, it's possible and guessable, since the IDs are auto incrementing. To get the combination of both correct with a brute force attach is pretty low in my mind, but it could be interesting to abuse this in a more targeted attack (for example when a \"normal user\" tricks another user into visiting a certain link that purges the cache).\n\nTo reproduce the issue, sign in as an account admin. Make sure the account has a plugin installed. Now go to https://rpm.newrelic.com/accounts/411552/agents, where `411552` is the account ID. Copy the agent ID from the \"Purge metric data\" and append it to the agent URL: https://rpm.newrelic.com/accounts/411552/agents/12345. Now prepare the exploit:\n\n```\n\u003cimg src=\"https://rpm.newrelic.com/accounts/411552/agents/12345\" /\u003e\n```\n\nStore the code example above in a file and serve it to the victim. It'll fire a `GET` request as the person that is currently signed into rpm.newrelic.com. If that user has access to the account and agent ID, it'll purge the metric data for that agent without any interaction (besides visiting the rogue site) of the victim.","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-12-05T08:48:08.016Z","allow_singular_disclosure_after":-153032307.78764296,"singular_disclosure_allowed":true,"vote_count":7,"voters":["michiel","leet-boy","eveeez","japz","sumit7","spetr0x","martijn"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1113593,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2016-08-08T21:28:37.259Z","updated_at":"2016-08-08T21:28:37.259Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1113618,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nThank you for the detailed and pragmatic report. We agree that would be pretty difficult to exploit but think we should fix it anyway. We've created a ticket for the responsible engineering team and they'll begin addressing the issue according to our vulnerability rating system. \n\nWe'll update this ticket when the issue has been addressed for you to verify the fix.\n\nCheers,\nMatthew","automated_response":false,"created_at":"2016-08-08T21:38:40.989Z","updated_at":"2016-08-08T21:38:40.989Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1114080,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks for the quick reply! ","automated_response":false,"created_at":"2016-08-09T04:05:28.300Z","updated_at":"2016-08-09T04:05:28.300Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1118238,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nWe're unable to reproduce this issue. The steps we follow were:\n- Used an agent w/ a plugin to generate metric data (ensuring that data indeed showed up in the application)\n- Created an html file containing \u003cimg src=\"https://rpm.newrelic.com/accounts/\u003cacctID\u003e/agents/\u003cpluginID\u003e\"/\u003e\n- Loaded the html file in a browser\n\nHowever, we did not see any change with the metric data for that account/plugin. Can you provide some more detail (network captures, etc), for us to diagnose this issue further.\n\nThank you,\nMatthew","automated_response":false,"created_at":"2016-08-10T22:25:14.497Z","updated_at":"2016-08-10T22:25:14.497Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1121102,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlapworth - sorry about that. I screwed up on the PoC. The correct URL for the `src` attribute has to be `https://rpm.newrelic.com/accounts/411552/agents/12345/purge_metrics`. My bad! Let me know if that works.","automated_response":false,"created_at":"2016-08-12T04:46:29.870Z","updated_at":"2016-08-12T04:46:29.870Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1123302,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks Martijn. We'll re-test now and let you know how it goes.","automated_response":false,"created_at":"2016-08-12T15:37:24.567Z","updated_at":"2016-08-12T15:37:24.567Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1169339,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlapworth, did you verify the issue. Let me know if you need any help.","automated_response":false,"created_at":"2016-09-02T09:50:32.200Z","updated_at":"2016-09-02T09:50:32.200Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1180192,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn, we have successfully reproduced the issue. I have created a task with the engineering team responsible for that functionality and they're working on it according to our vulnerability rating system. I'll update this ticket once we've engineered a fix so you can re-test.\n\nSorry for the slow response!\n\nCheers,\nMatthew","automated_response":false,"created_at":"2016-09-07T15:02:50.432Z","updated_at":"2016-09-07T15:02:50.432Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1180202,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem, happy to hear you were able to reproduce the issue.","automated_response":false,"created_at":"2016-09-07T15:06:15.093Z","updated_at":"2016-09-07T15:06:15.093Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1281236,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nThe fix for this issue has been deployed to production. Can you verify the fix?\n\nThank you,\nMatthew\n","automated_response":false,"created_at":"2016-11-02T21:34:57.866Z","updated_at":"2016-11-02T21:34:57.866Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1282205,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update. I can confirm this is fixed. It now fires a `POST` request.","automated_response":false,"created_at":"2016-11-03T12:44:18.324Z","updated_at":"2016-11-03T12:44:18.324Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1285360,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for reporting the issue Martijn ! We appreciate your help in keeping New Relic secure ! ","automated_response":false,"created_at":"2016-11-04T22:39:03.083Z","updated_at":"2016-11-04T22:39:03.083Z","actor":{"username":"imelven","cleared":false,"url":"/imelven","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/153/809e507ea6cd7c5c120920d1d4ce70336974d422_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"martijn","url":"/martijn"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1285727,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-11-05T08:48:08.003Z","updated_at":"2016-11-05T08:48:08.003Z","first_to_agree":true,"actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1340775,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-12-05T08:48:08.895Z","updated_at":"2016-12-05T08:48:08.895Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2694217,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2018-05-03T03:28:31.641Z","updated_at":"2018-05-03T03:28:31.641Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}