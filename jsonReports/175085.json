{"id":175085,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzUwODU=","url":"https://hackerone.com/reports/175085","title":"URI scheme bypass in mail app lead to HTML content spoof and opener control","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-10-11T07:59:08.673Z","submitted_at":"2016-10-11T07:59:08.673Z","is_member_of_team?":false,"reporter":{"disabled":true,"username":"unknowns132","url":"/unknowns132","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-01-12T20:02:32.175Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-12-13T20:02:30.609Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Bug\nWhen we load a HTML mail from mailbox via api, etc\n`http://nextcloud/index.php/apps/mail/accounts/\u003caccountID\u003e/folders/SU5CT1g=/messages/\u003cmailID\u003e/html`\nOur content will be passed to HTML Purifier to strip malicious XSS patterns.\nAfter that, an filter will apply to transform acceptable URI schemes `http, https, ftp, cid` to redirect/proxy service. \nThere's a bug in here, only `http, https, cid` scheme are filtered.\nSo we can add `src` attribute or `href` from url with scheme `ftp` or `NULL` (like `'../../abc/xyz'`) . We can easily bypass image filter (also Content-Security-Policy)\nNotice that there's a filter that append `target=_blank` to all `\u003ca\u003e` tag. This can lead to opener bug [https://mathiasbynens.github.io/rel-noopener/#hax] (https://mathiasbynens.github.io/rel-noopener/#hax) that I learned from [124620] (https://hackerone.com/reports/124620).\nAnd finally it can leak accountID of user\n\n## PoC\n* Attacker create a shared link of a image\n\n`http://192.168.200.117/nextcloud/index.php/s/HUw7Cwa40Phlt8v/download`\n* Attacker start a ftp server and create a html page.\n\n`ftp://chim:chim@localhost/test.html`\n* Attacker send a HTML email\n\n```\n\u003ch1\u003etest schema\u003c/h1\u003e\n\u003cp\u003e\n\t\u003ca href=\"http://file.trich.im\"\u003eLink via redirect\u003c/a\u003e\u003cbr\u003e\n\t\u003ca href='ftp://chim:chim@localhost/hihi.html'\u003eBypass link\u003c/a\u003e\n\u003c/p\u003e\n\n\u003cp\u003e\n\tFiltered img\u003cimg src='http://192.168.200.117/nextcloud/index.php/s/HUw7Cwa40Phlt8v/download'\u003e\u003cbr\u003e\n\tBypass img \u003cimg src='/nextcloud/index.php/s/HUw7Cwa40Phlt8v/download'\u003e\n\u003c/p\u003e\n```\n\n## Video Demo https://www.youtube.com/watch?v=BdOD49gokdI","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":127148,"file_name":"shareimg.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/127/148/dc4ae41388280f99ef2b563d0a498bbe5661f215/shareimg.png?response-content-disposition=attachment%3B%20filename%3D%22shareimg.png%22%3B%20filename%2A%3DUTF-8%27%27shareimg.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135242Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=edd2967b0590267fa10d2b317b8b2fd2aeda05f42a13ff1761ba6b02b0d049bb","file_size":134793,"type":"image/png"},{"id":127149,"file_name":"send.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/127/149/800b78fc460926ea711623876dac82d52755df36/send.png?response-content-disposition=attachment%3B%20filename%3D%22send.png%22%3B%20filename%2A%3DUTF-8%27%27send.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135242Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b3f725f151a5802592269b425dd45459daea4be3d17d114a9380cea8a2481857","file_size":137336,"type":"image/png"}],"allow_singular_disclosure_at":"2017-01-12T20:02:30.638Z","allow_singular_disclosure_after":-149709011.84306902,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","khizer47","japz","spetr0x","bbisawdr"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1241653,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2016-10-11T07:59:08.788Z","updated_at":"2016-10-11T07:59:08.788Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1241727,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report. I'll escalate this to the developer of the mail app and get back to you once we've more information.","automated_response":false,"created_at":"2016-10-11T08:42:06.487Z","updated_at":"2016-10-11T08:42:06.487Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1271219,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2016-10-27T16:24:42.756Z","updated_at":"2016-10-27T16:24:42.756Z","actor":{"username":"christophwurst","cleared":false,"url":"/christophwurst","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1297054,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@christophwurst Any update on this?","automated_response":false,"created_at":"2016-11-13T16:07:38.080Z","updated_at":"2016-11-13T16:07:38.080Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1308346,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi and thanks for your report.\nI created PR https://github.com/nextcloud/mail/pull/188 and https://github.com/nextcloud/mail/pull/187 to fix the reported problems.","automated_response":false,"created_at":"2016-11-19T19:07:57.989Z","updated_at":"2016-11-19T19:07:57.989Z","actor":{"username":"christophwurst","cleared":false,"url":"/christophwurst","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1362479,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in the Nextcloud Mail 0.6.2 release and the update is available via the Nextcloud app store: https://apps.nextcloud.com/apps/mail","automated_response":false,"created_at":"2016-12-13T20:01:54.848Z","updated_at":"2016-12-13T20:01:54.848Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"unknowns132","url":"/unknowns132"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1362480,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Since this is bug in an optional app for Nextcloud this is not covered by our monetary rewards.","automated_response":false,"created_at":"2016-12-13T20:02:26.176Z","updated_at":"2016-12-13T20:02:26.176Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1362481,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-13T20:02:30.624Z","updated_at":"2016-12-13T20:02:30.624Z","first_to_agree":true,"actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1416797,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-01-12T20:02:32.191Z","updated_at":"2017-01-12T20:02:32.191Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}