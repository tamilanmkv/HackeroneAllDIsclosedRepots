{"id":178293,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzgyOTM=","url":"https://hackerone.com/reports/178293","title":"Misconfiguration in Two Factor Authorisation","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-10-26T21:12:21.852Z","submitted_at":"2016-10-26T21:12:21.852Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dhaval","url":"/dhaval","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-12-17T02:49:54.815Z","bug_reporter_agreed_on_going_public_at":"2016-12-17T02:49:54.767Z","team_member_agreed_on_going_public_at":"2016-12-16T21:07:51.938Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey\n\nThere seems to be a weird misconfiguration which leads to bypass of two factor authorisation\n\n#### Scenario\n\n1. Let's assume you have setup Two Factor Authorisation with Google Authenticator\n\n2. You now activate `Google Apps` from `Login services` at https://shop-1.myshopify.com/admin/settings/account\n\n3. Now your try to \"Sign In with Google\" `https://shop-1.myshopify.com/admin/auth/login?google_apps=1`\n\nWhat's weird is no two factor code is required and you directly land in Admin Panel\n\n#### Issue\n\nIssue here is Two Factor Authorisation is disabled as soon as you \"Sign In with Google\" and now you cannot even enable it because you can't see any Two Factor Authenticator Tab in Accounts\n\nAnd now when you try to simple login with correct credentials you can access Admin Panel without Two Factor Code from Google Authenticator at `https://shop-1.myshopify.com/admin/auth/login`\n\nAlso there is no indication to via mail or notification that Two Factor Authorisation has been disabled when Two Factor Authorisation is disabled\nWhile it shouldn't be disabled in the first place\n","bounty_amount":"1500.0","formatted_bounty":"$1,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":31,"voters":["sameoldstory","dullink","drsniper","bogdantcaciuc","flashdisk","dilawer01","ayoubfathi_","mpz","kingragnar","eveeez","and 21 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1269902,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\r\n\r\nOur team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don't worry, we'll get to yours!\r\n\r\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!","automated_response":true,"created_at":"2016-10-26T21:12:22.065Z","updated_at":"2016-10-26T21:12:22.065Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1269937,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Thank you for your report.\n\nThis authentication mechanism is working as intended. If you switch your shop to use Google Apps as your login service, then authentication is handled through your Google account, and you would need to configure your Google account to require two-factor authentication.","automated_response":false,"created_at":"2016-10-26T21:26:06.412Z","updated_at":"2016-10-26T21:26:06.412Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1269991,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@clayton Then why is Username and password still working even after setting up \"Sign In with Google\" ?\n\nI don't get it, If what you are saying is correct only \"Sign In with Google\" should work after configuring it, while simple username and password should be disabled\n\nCurrently :\n1. I use username and password with Two Factor Authorisation\n2. Setup \"Google Apps\"\n3. Anyone who knows my password can login into my account\n4. Where did Google's two-factor-authentication come into play ?","automated_response":false,"created_at":"2016-10-26T21:50:36.858Z","updated_at":"2016-10-26T22:02:10.097Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1271290,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @clayton @shopify\nIt's very disappointing when program does not read the full report and closes it as **N/A** and then ignores the comments\n\n\u003e If you switch your shop to use Google Apps as your login service, then authentication is handled through your Google account\n\nThis is quite incomplete reply and makes almost no sense\n\nHere's my last attempt on describing the bug report while expecting a decent reply\n\n#### Proof of Concept\n \n**At this point there is no Google Apps activated in that store**\n1. Victim A uses victim@googapps.com with password and 2FA to login (Thinks he is secure).\n\n2. Victim A then activates \"Sign In with Google\" for his store.\n3. Victim A logs in with Google (Still thinks he is secure, But he is not because Shopify's 2FA gets disabled without letting user know)\n\n4. Now Attacker B who by chance knows the password of `victim@googapps.com` can login into the Admin Panel without 2FA **or access to Victim A's Google Account**\n\n**Please note Attacker B does not require access to Google account, Just Email and Password of Shopify** because Email and Password is still valid even after activating \"Sign In with Google\"\n\n**Also this is valid for accounts which once used Email and Password to login and then migrated to \"Sign In with Google\"**\n\n#### Why ?\n1. Because Shopify's 2FA gets disabled when you login with \"Sign In with Google\"\n2. Traditional login with Email and Password does not get disabled when you activate \"Sign In with Google\"\n\n#### Fix\n\n1. If you are depending on Google Apps for security, Disable login with Email and Password for that store\n2. Don't disable Shopify's 2FA when someone logs in with \"Sign In with Google\"\n\n","automated_response":false,"created_at":"2016-10-27T17:10:22.167Z","updated_at":"2016-10-27T17:14:24.002Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1271354,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Thank you for the clarification. We will have a look at this again.","automated_response":false,"created_at":"2016-10-27T17:45:26.660Z","updated_at":"2016-10-27T17:45:26.660Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1278848,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks again for your report, and sorry for the confusion. Our engineering team is investigating the issue.","automated_response":false,"created_at":"2016-11-01T17:27:20.395Z","updated_at":"2016-11-01T17:27:20.395Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1313332,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@clayton Anything here ?","automated_response":false,"created_at":"2016-11-22T18:40:16.260Z","updated_at":"2016-11-22T18:40:16.260Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1313362,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We're still working on this, and will contact you as soon as we have an update. Thank you for your patience.","automated_response":false,"created_at":"2016-11-22T18:50:03.229Z","updated_at":"2016-11-22T18:50:03.229Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1365634,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@clayton \nThis is taking longer than usual","automated_response":false,"created_at":"2016-12-15T03:04:39.327Z","updated_at":"2016-12-15T03:04:39.327Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1367141,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. We recently deployed a fix for this issue.\n\nOur next round of bounty decisions will take place within two weeks, so we will be in touch with you again soon.","automated_response":false,"created_at":"2016-12-15T17:58:18.596Z","updated_at":"2016-12-15T17:58:18.596Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dhaval","url":"/dhaval"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370278,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify! This issue has been resolved.","automated_response":false,"created_at":"2016-12-16T21:07:46.022Z","updated_at":"2016-12-16T21:07:46.022Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"1500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"dhaval","url":"/dhaval"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370279,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-16T21:07:51.951Z","updated_at":"2016-12-16T21:07:51.951Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370783,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-17T02:49:54.790Z","updated_at":"2016-12-17T02:49:54.790Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370784,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-12-17T02:49:54.831Z","updated_at":"2016-12-17T02:49:54.831Z","actor":{"username":"dhaval","cleared":false,"url":"/dhaval","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/088/d590a389d8f9d5d48c6ee71b2c3283f6407ceaf2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}