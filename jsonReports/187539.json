{"id":187539,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODc1Mzk=","url":"https://hackerone.com/reports/187539","title":"Null pointer dereference due to bug in codegen with negation of floats","state":"Closed","substate":"duplicate","readable_substate":"Duplicate","created_at":"2016-12-02T00:35:38.948Z","submitted_at":"2016-12-02T00:35:38.948Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"haquaman","url":"/haquaman","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-12-17T20:49:37.414Z","bug_reporter_agreed_on_going_public_at":"2016-12-17T20:14:27.419Z","team_member_agreed_on_going_public_at":"2016-12-17T20:49:37.381Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Similar to bug #187536 but with floats, not ints.\n\nCrash is:\n\n```\np *case\n  when nil\n    -0.0\n    nil\nend\n```\n\n```\n$ ./dev/bin/mruby crash.rb\ncrash.rb:1:3: '*' interpreted as argument prefix\nSegmentation fault: 11\n```\n\n```\n$ lldb ./dev/bin/mruby crash.rb\n(lldb) target create \"./dev/bin/mruby\"\nCurrent executable set to './dev/bin/mruby' (x86_64).\n(lldb) settings set -- target.run-args  \"crash.rb\"\n(lldb) r\nProcess 95703 launched: './dev/bin/mruby' (x86_64)\ncrash.rb:1:3: '*' interpreted as argument prefix\nProcess 95703 stopped\n* thread #1: tid = 0x85d077b, 0x000000010000278b mruby`ary_concat + 27, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x18)\n    frame #0: 0x000000010000278b mruby`ary_concat + 27\nmruby`ary_concat:\n-\u003e  0x10000278b \u003c+27\u003e: movl   0x18(%rdx), %ecx\n    0x10000278e \u003c+30\u003e: addl   -0x1c(%rbp), %ecx\n    0x100002791 \u003c+33\u003e: movl   %ecx, -0x20(%rbp)\n    0x100002794 \u003c+36\u003e: movq   -0x8(%rbp), %rdi\n(lldb) bt\n* thread #1: tid = 0x85d077b, 0x000000010000278b mruby`ary_concat + 27, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x18)\n  * frame #0: 0x000000010000278b mruby`ary_concat + 27\n    frame #1: 0x0000000100002766 mruby`mrb_ary_concat + 70\n    frame #2: 0x000000010004451f mruby`mrb_vm_exec + 25439\n    frame #3: 0x000000010003e1a7 mruby`mrb_vm_run + 135\n    frame #4: 0x0000000100046604 mruby`mrb_top_run + 100\n    frame #5: 0x0000000100071adf mruby`load_exec + 1183\n    frame #6: 0x0000000100071623 mruby`mrb_load_file_cxt + 67\n    frame #7: 0x00000001000017d8 mruby`main + 904\n    frame #8: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n(lldb) register read\nGeneral Purpose Registers:\n       rax = 0x000000010100f030\n       rbx = 0x0000000000000000\n       rcx = 0x0000000000000000\n       rdx = 0x0000000000000000\n       rdi = 0x0000000100400390\n       rsi = 0x0000000000000000\n       rbp = 0x00007fff5fbfca00\n       rsp = 0x00007fff5fbfc9e0\n        r8 = 0x0000000000000000\n        r9 = 0x000000000000010e\n       r10 = 0x0000000000000002\n       r11 = 0x0000000000f83160\n       r12 = 0x0000000000000000\n       r13 = 0x0000000000000000\n       r14 = 0x0000000000000000\n       r15 = 0x0000000000000000\n       rip = 0x000000010000278b  mruby`ary_concat + 27\n    rflags = 0x0000000000010202\n        cs = 0x000000000000002b\n        fs = 0x0000000000000000\n        gs = 0x0000000000000000\n\n(lldb) q\nQuitting LLDB will kill one or more processes. Do you really want to proceed: [Y/n] y\n\n```\n\n```\n$ ./bin/sandbox crash.rb\n./bin/sandbox:20: [BUG] Segmentation fault at 0x00000000000018\nruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-darwin15]\n\n-- Crash Report log information --------------------------------------------\n   See Crash Report log file under the one of following:\n     * ~/Library/Logs/CrashReporter\n     * /Library/Logs/CrashReporter\n     * ~/Library/Logs/DiagnosticReports\n     * /Library/Logs/DiagnosticReports\n   for more details.\nDon't forget to include the above Crash Report log file in bug reports.\n\n-- Control frame information -----------------------------------------------\nc:0003 p:---- s:0011 e:000010 CFUNC  :sandbox_eval\nc:0002 p:0214 s:0006 E:0007f0 EVAL   ./bin/sandbox:20 [FINISH]\nc:0001 p:0000 s:0002 E:001680 (none) [FINISH]\n\n-- Ruby level backtrace information ----------------------------------------\n./bin/sandbox:20:in `\u003cmain\u003e'\n./bin/sandbox:20:in `sandbox_eval'\n\n-- Machine register context ------------------------------------------------\n rax: 0x000000010adab0f0 rbx: 0x000000010ae02c28 rcx: 0x0000000000000003\n rdx: 0x000000010adab0f0 rdi: 0x000000010ada3440 rsi: 0x0000000000000000\n rbp: 0x00007fff558abf50 rsp: 0x00007fff558abf20  r8: 0x0000000000000000\n  r9: 0x000000010ada4d60 r10: 0x000000010adb5a88 r11: 0x0000000000000020\n r12: 0x000000010ada3460 r13: 0x0000000000000000 r14: 0x0000000000000000\n r15: 0x0000000000000000 rip: 0x000000010ac7d97d rfl: 0x0000000000010206\n\n-- C level backtrace information -------------------------------------------\n0   ruby                                0x000000010a4f05d4 rb_vm_bugreport + 388\n1   ruby                                0x000000010a392023 rb_bug_context + 483\n2   ruby                                0x000000010a465653 sigsegv + 83\n3   libsystem_platform.dylib            0x00007fff9826d52a _sigtramp + 26\n4   mruby_engine.bundle                 0x000000010ac7d97d mrb_ary_concat + 29\n5   ???                                 0x000000010ada3440 0x0 + 4477039680\n\n-- Other runtime information -----------------------------------------------\n\n* Loaded script: ./bin/sandbox\n\n* Loaded features:\n\n    0 enumerator.so\n    1 thread.rb\n    2 rational.so\n    3 complex.so\n\u003csnip various gems\u003e\n  185 /Users/\u003csnip\u003e/mruby-engine/lib/mruby_engine/mruby_engine.bundle\n  186 /Users/\u003csnip\u003e/mruby-engine/lib/mruby_engine.rb\n\n[NOTE]\nYou may have encountered a bug in the Ruby interpreter or extension libraries.\nBug reports are welcome.\nFor details: http://www.ruby-lang.org/bugreport.html\n\nAbort trap: 6\n\n```\n\nPatch to fix is:\n\n```\ndiff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c\nindex 553baa1..9d0b979 100644\n--- a/mrbgems/mruby-compiler/core/codegen.c\n+++ b/mrbgems/mruby-compiler/core/codegen.c\n@@ -2227,7 +2227,7 @@ codegen(codegen_scope *s, node *tree, int val)\n           int off = new_lit(s, mrb_float_value(s-\u003emrb, -f));\n \n           genop(s, MKOP_ABx(OP_LOADL, cursp(), off));\n-          push();\n+          if (val) push();\n         }\n         break;\n \n```\n\nCheers,\n\nHugh","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":187536,"original_report_url":"https://hackerone.com/reports/187536","attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["eveeez","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1335386,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Crash and patch files.","automated_response":false,"created_at":"2016-12-02T00:36:13.769Z","updated_at":"2016-12-02T00:36:13.769Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":139573,"filename":"crash-187539.rb","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/139/573/9a7bc0484b5b3e604b61edd903a9f16f26be3236/crash-187539.rb?response-content-disposition=attachment%3B%20filename%3D%22crash-187539.rb%22%3B%20filename%2A%3DUTF-8%27%27crash-187539.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJF6VFL6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135639Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCID1So1KYRjOmBFJqLsqO1j9SSUCF9kJ%2FHqahOyDLmrnJAiAr2q5Z8bAgCyaCmyDSz7xwtmUTDOoz04myJOluBHRCeyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMvFUMWX6P00RsVarQKtcDflFFNScU3coA1YbnKy4lPXtwGDNsJcqhfcCTaePuAuK6nWvl5xRbjzjOBPvBHaTAnb2Iw%2B6Jdj2uyjmRMn%2F5%2F5AzD5di2wWOcC0am9iLaFmORG4VIVXTc8aAiiwqjNAu7dH2hTUNL9bwPzYUBq3%2FjwvNZUM%2FmpdXfugOwAP%2FP3w9e9PqozA16XzrwGIunimlg58HKZfOM0xp%2FESLFXRHAssX6DaYqQQyV5%2F0triAQeOx328GOBUjfGTiAl1aoS1J0%2FqN%2BmywXW%2FqqkEfAQ2n2f18dX2dkbwMnyQ4F47zR6jJw3CdBkeCPRDbbhcu8YGu2%2F%2BzzM9B4uguhR76M3KYB3dr919eRp%2F%2BcOfUxc8TC3gXMmp1jh0ywwC27sBrzUgZdh%2B2g4artPxRaRZPHbQvC%2F1OZ0MxZYsQmEItbUc65WqfO6PSdLbymEFDMyN5ona14j%2BaQHfp1MWNaO02I2WPYO5mZIsPuHjCO5MYUldcsrZMP7pydKVo87gkO2fPB2orxw1RGazxVwGy5R2PDIV7HsKH4KSOqhGLTTYcSjZvxzmTWIy013yrXhU3CEdFUoB7QifSN1bUli2cMIaUe7sr75onhlaNnQxqLv%2By7jqQ9RiOHvcMM4XIMInwkIsGOqYBzgDHFUI%2FtkToYUBHsGsXyI9vGkS81IUV4PSjgSfvCFIGR%2BPjro3EYi30Oc%2FQZijhik3H1oI82Vno5zo%2BVnueR7%2BkGCloKvMkJAe%2F77e%2BPPRDClquvRG9ERm7ELsd6WvljYOJTmuP4pWPW%2B2d%2BQu26lThNein0I5abJKiu%2FYvnXDmBeYAgLMwbyg9Lq3qT5qMKsr3i1aOgHcGHtYldnzNcLqwaNJYhw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ab2c862e98adb5beef13f9f039fc08ac6557de571ffeb0196d109bb28038cdcb"},{"id":139572,"filename":"bug-187539.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/139/572/9199c3e6cb1de141d747f0e33df30b587c3d782f/bug-187539.patch?response-content-disposition=attachment%3B%20filename%3D%22bug-187539.patch%22%3B%20filename%2A%3DUTF-8%27%27bug-187539.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJF6VFL6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135639Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCID1So1KYRjOmBFJqLsqO1j9SSUCF9kJ%2FHqahOyDLmrnJAiAr2q5Z8bAgCyaCmyDSz7xwtmUTDOoz04myJOluBHRCeyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMvFUMWX6P00RsVarQKtcDflFFNScU3coA1YbnKy4lPXtwGDNsJcqhfcCTaePuAuK6nWvl5xRbjzjOBPvBHaTAnb2Iw%2B6Jdj2uyjmRMn%2F5%2F5AzD5di2wWOcC0am9iLaFmORG4VIVXTc8aAiiwqjNAu7dH2hTUNL9bwPzYUBq3%2FjwvNZUM%2FmpdXfugOwAP%2FP3w9e9PqozA16XzrwGIunimlg58HKZfOM0xp%2FESLFXRHAssX6DaYqQQyV5%2F0triAQeOx328GOBUjfGTiAl1aoS1J0%2FqN%2BmywXW%2FqqkEfAQ2n2f18dX2dkbwMnyQ4F47zR6jJw3CdBkeCPRDbbhcu8YGu2%2F%2BzzM9B4uguhR76M3KYB3dr919eRp%2F%2BcOfUxc8TC3gXMmp1jh0ywwC27sBrzUgZdh%2B2g4artPxRaRZPHbQvC%2F1OZ0MxZYsQmEItbUc65WqfO6PSdLbymEFDMyN5ona14j%2BaQHfp1MWNaO02I2WPYO5mZIsPuHjCO5MYUldcsrZMP7pydKVo87gkO2fPB2orxw1RGazxVwGy5R2PDIV7HsKH4KSOqhGLTTYcSjZvxzmTWIy013yrXhU3CEdFUoB7QifSN1bUli2cMIaUe7sr75onhlaNnQxqLv%2By7jqQ9RiOHvcMM4XIMInwkIsGOqYBzgDHFUI%2FtkToYUBHsGsXyI9vGkS81IUV4PSjgSfvCFIGR%2BPjro3EYi30Oc%2FQZijhik3H1oI82Vno5zo%2BVnueR7%2BkGCloKvMkJAe%2F77e%2BPPRDClquvRG9ERm7ELsd6WvljYOJTmuP4pWPW%2B2d%2BQu26lThNein0I5abJKiu%2FYvnXDmBeYAgLMwbyg9Lq3qT5qMKsr3i1aOgHcGHtYldnzNcLqwaNJYhw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=237e7c4b23edf56b5c7ba123d0000bb7fafcd777f2a9a332b9fb618c2eff17e0"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1336734,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Thank you for your report. Both this and your previous report #187536 stem from a single bug in the codegen for `NODE_NEGATE`, so we are closing this as a duplicate.","automated_response":false,"created_at":"2016-12-02T16:02:19.427Z","updated_at":"2016-12-02T16:02:19.427Z","original_report_id":187536,"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1337061,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeh was debating just filing both as one ticket because of that reason! I couldn't work out how to get it going down the default case branch but that may be an issue as well","automated_response":false,"created_at":"2016-12-02T18:07:37.719Z","updated_at":"2016-12-02T18:07:37.719Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1371666,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Care to disclose?","automated_response":false,"created_at":"2016-12-17T20:14:27.446Z","updated_at":"2016-12-17T20:14:27.446Z","first_to_agree":true,"actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1371703,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-12-17T20:49:37.402Z","updated_at":"2016-12-17T20:49:37.402Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1371704,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-12-17T20:49:37.429Z","updated_at":"2016-12-17T20:49:37.429Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}