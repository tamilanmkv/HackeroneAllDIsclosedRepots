{"id":195140,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTUxNDA=","url":"https://hackerone.com/reports/195140","title":"Users with guest access can post notes to private merge requests, issues, and snippets","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-01-01T20:46:09.325Z","submitted_at":"2017-01-01T20:46:09.325Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-01-23T23:09:37.689Z","bug_reporter_agreed_on_going_public_at":"2017-01-23T20:47:09.489Z","team_member_agreed_on_going_public_at":"2017-01-23T23:09:37.637Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability details\nA user with guest access to a group / project can post notes to private merge requests, issues, and snippets.\n\n# Impact\nIt seems it only allows an attacker to post notes to objects that the user doesn't have access to. I tried creating notes with slash commands, but unfortunately that didn't work. The hypothesis was to assign myself to an issue or merge request, and then access the object through the API. I'm unsure whether this is a security bug, but when a user is assigned to a merge request, it cannot access the MR through the web application, but it can access the MR through the API.\n\n# Proof of concept\n1. As a group / project owner, invite someone with guest access\n2. As the same user, create a merge request (or issue or snippet, they all work) - this MR is not accessible by users with guest access\n3. Accept the invitation as a new user and create an API token for your account\n4. Now send a `POST` request to the notes API with a reference to the `MR`:\n\n**Request**\n```\ncurl -X POST -H \"Private-Token: XXXX\" http://gitlab-instance/api/v3/projects/1/merge_requests/2/notes -d 'body=Hello+world'\n```\n\n**Response**\n```json\n{\n  \"id\": 1,\n  \"body\": \"Hello world\",\n  \"attachment\": null,\n  \"author\": {\n    \"name\": \"Jobert Abma\",\n    \"username\": \"jobertabma\",\n    \"id\": 1,\n    \"state\": \"active\",\n    \"avatar_url\": \"...\",\n    \"web_url\": \"...\"\n  },\n  \"created_at\": \"2017-01-01T20:33:44.360Z\",\n  \"updated_at\": \"2017-01-01T20:33:44.360Z\",\n  \"system\": false,\n  \"noteable_id\": 2,\n  \"noteable_type\": \"MergeRequest\",\n  \"upvote?\": false,\n  \"downvote?\": false\n}\n```\n\nWhen requesting the discussion page of the private MR, you'll notice that the note was posted, even though the user does not have permissions to do so.\n\n{F148594}\n\n# Remediation\nMake sure the correct ACL is checked before creating the note.","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":148594,"file_name":"Screen_Shot_2017-01-01_at_21.45.42.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/148/594/0e77dcfc146d776c6fb2b7742247cb4179043e50/Screen_Shot_2017-01-01_at_21.45.42.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-01-01_at_21.45.42.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-01-01_at_21.45.42.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ37UF4D7L%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135905Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDcM3lUhy%2FyutAdh7f9Zl5mn2Zda9VBqjjsjW3Kqrv9QwIgUJ2GHCBNkuHHHes2KRvisdQVMMh95CwiTU1b1a8oiokqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHKDnseTm0Y%2FhEGv3yrXA%2FXiDUmXXuSyACHOE8HgYRKJ853f1jlwT5AZyK%2Bn5Rt9XrHAopi0fcxoVA3YLQiUzIRWerqTfQlxKYwQmwbXGaNCwOPcuqFnbA0BdiKSoxDZE9%2BAkspI1mhMQLJ5wo08jfzFr75Qd1ChW9WiheW%2FVktOteHAt9aVxqi8Jvt13Vf4hmtjfTIpZbkNbUwjNFSoAAwBiHX%2BPEoNCL2q146kWmH7JQAs46LWWfXpHtaLM0X3j2%2F6OQqcpbbmgNP0iT6G9a5CgaIGBxJLuLkH61YbKPWXwaC8TDE%2FcU3kcKLfZT6PzgvqrUkbtY5Kq12QUSQPRc2p%2F86btY7j%2BbuW2LsLo%2BL8HwPZQqX0Iwg4kPN1oiWkCvCy4C8hJ68%2FJ8V55%2FQGsfNluyoo9N2h%2FImpLRFogGkjCwXw%2FgUm6fVgz6E210lLzFwkpnwSJZD%2FmcaRmUjl0tSuVxctc0XFzksnocu0a7yIDYpb5K7QrxkzD9IKguldIb6P28mU%2Fl%2BNGbXsLagjza5LYY9EpOydfi%2FbJ8psqdp5cmRFbVoWgz8FXZfOtIY%2FL3SbVyc%2FP82wug%2BNvDZV%2F2QhkY%2F5Fq39DFzTJIx0r5IdBfCunO3HvICfVBNCYCOfN%2FEieFXqKzCx75CLBjqlAcuPL4Bcyw7zjajAhspfsc9g22ftBZvRbPtEOifPINRBbT8HbfsijeCJ%2FT7%2BiuoRxWH6OAFtoz80KZDnQALizDt0DzDKgU%2BjEVmWT15an6I5BVjXF4imwZ56XB97AG2TQY%2BkX%2BOj43cXPZZUP6Xqk6lMktc4Sg6T1MBZFmFR8tg4anCMnG6QFQm48IyEtEycWqfvTMqOwqddlUOWnUeoAp%2FGIOm9YQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=02f675852af9156828393441120b768dd5402556c77cd1316cc019ed4b8c2061","file_size":43570,"type":"image/png"}],"allow_singular_disclosure_at":"2017-02-22T20:47:09.522Z","allow_singular_disclosure_after":-146164315.90779364,"singular_disclosure_allowed":true,"vote_count":9,"voters":["ysx","ayoubfathi_","mpz","eveeez","japz","secdoor","spetr0x","arice","clars"],"severity":{"rating":"medium","score":4.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1393994,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks Jobert! (I need a macro for this)\n\nI've opened the confidential issue https://gitlab.com/gitlab-org/gitlab-ce/issues/26250 and will keep you informed of our progress.","automated_response":false,"created_at":"2017-01-02T00:51:05.143Z","updated_at":"2017-01-02T00:51:05.143Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1437148,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"A patch for this vulnerability is scheduled to go out in a security release tomorrow. I'll update the issue here when it does. Thanks for the report!","automated_response":false,"created_at":"2017-01-22T18:11:21.141Z","updated_at":"2017-01-22T18:11:21.141Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439314,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We've released a patch for this vulnerability today: https://about.gitlab.com/2017/01/23/gitlab-8-dot-16-dot-1-security-release/\n\nThanks again!","automated_response":false,"created_at":"2017-01-23T20:45:32.354Z","updated_at":"2017-01-23T20:45:32.354Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439318,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-01-23T20:47:09.506Z","updated_at":"2017-01-23T20:47:09.506Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439693,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-01-23T23:09:37.659Z","updated_at":"2017-01-23T23:09:37.659Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439694,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-01-23T23:09:37.707Z","updated_at":"2017-01-23T23:09:37.707Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}