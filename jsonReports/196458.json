{"id":196458,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTY0NTg=","url":"https://hackerone.com/reports/196458","title":"apps.shopify.com - CSRF token leakage through Google Analytics","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-01-07T00:59:41.646Z","submitted_at":"2017-01-07T00:59:41.646Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zombiehelp54","url":"/zombiehelp54","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-02-07T01:32:16.100Z","bug_reporter_agreed_on_going_public_at":"2017-02-07T01:32:16.065Z","team_member_agreed_on_going_public_at":"2017-02-07T01:28:49.978Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"#Description:\nWhen a user tries to send a support a message to an app developer in `apps.shopify.com` , he will be asked to login and once he is logged in , he will be redirected to `apps.shopify.com/[app_id]?authenticity_token=[current_user_authenticity_token]`. \nDevelopers can track their app page view in `apps.shopify.com` by adding a google tracking code while editing their app.\n\nWith that said , here is how now attacker can steal someone's CSRF token and use it to submit requests on behalf of that user:\n- Attacker tricks the victim to visit an HTML page that he has control over it\n- The HTML page opens a new window that redirects to `https://apps.shopify.com/[attacker's_app]/support_interactions/new`\n- The victim will be redirected to `https://apps.shopify.com/#login` once he is logged in , he will be redirected to `https://apps.shopify.com/[attacker's_app]?authenticity_token=[victim's_token]` \n- The attacker can now see the victim's authenticity token by checking Real-Time analytics at his google analytics dashboard\n- The attacker can use the victim's CSRF token to forge HTML requests that edit the victim's app listing by issuing requests to `https://apps.shopify.com/services/shopify_applications/edit` , if the victim has a shopify application or he can use it to submit reviews,support messages ..etc\n\n\n#Steps to reproduce:\n1. Go to `https://app.shopify.com/services/partners/api_clients/new` to create a new application then after creating it click **Edit App Listing** and at **Google analytics code** field enter your google analytics code.\n2. Go to `https://apps.shopify.com/[your_app_id]/support_interactions/new` , you'll be redirected to the login page , enter your shop domain then login.\n3. After logging in you'll be redirected to `https://apps.shopify.com/img-src-x-onerror-prompt2?reveal_support=true?authenticity_token=[Your_CSRF_TOKEN]\u0026utf8=%E2%9C%93` \n4. Now go to your google analytics dashboard `https://analytics.google.com/analytics/web/` -\u003e **Real Time** analytics , and you'll see the whole URL with the authenticity token disclosed.\n\n{F149974}\n\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":149974,"file_name":"csrf-token-analytics.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/149/974/144643bf2bf7c50d6e0935147fb5fa5f429fcd6d/csrf-token-analytics.png?response-content-disposition=attachment%3B%20filename%3D%22csrf-token-analytics.png%22%3B%20filename%2A%3DUTF-8%27%27csrf-token-analytics.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUWIS6VCD%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135928Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQD5qsiIq7Ck1i9U3MTr1Jo1%2F3EDxH2PPmsZwQtKB8ZKHgIhAJ3GPiydxb4RL1gx8xsJzOsLrxI5jwwj0tTnFObt0P14KoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgzIOEXrWQ9u1AQUX0Uq1wOcZjaNugHMVKWeqymcjzBFh6Y1k6CMr8RU%2By%2FCZ4rv9GZiC2wT8OmGhsgt00HKgFWK1MpUtynFdgo25n2Z3Hw%2BIbYI8vc1JJdIjhuurHucoJNgsKCs02JzKj8GyJUC61pv0yaDJyGUVPN694UkMEyn%2FPWTQr%2BUTeBhbmczKhCGUj%2FpPN2iIbYsRZixR6LxxOf2cvjX2jSZkAk%2FSVsApfA8g%2BhlsBjDUA9%2B8YRWNjxfWtxQ%2Foo1xWaWyO6R0C2NxkUOjfjpECLEYEQ7vJ%2Bmu27ctvQxX8DIgxS97NsRC7LzasVsLHVmntXBAZ7PuEI4sWc5xs%2Fk66Q906%2BB%2BzvloL3Axk31g5hiymuem0csQnadqDxLt8p2LjIDw8YcQPN5NH0kGSb6mQrkldEFgJqP84RMAJRIxUJWDd%2B%2BPuzQFsioIExGAI0yAK1L2jOitJOooOZlWfFIzjDUn7dj9xSziPydE91tqmI514stzkBU2GFbRIrklzPo3g7n0zD%2FNL7OLEHlmYWBTM9ot%2B6bu4Bck8DrV4VVi9QHnC5ukEnqLU7NSIQGPaibC1SdOVjM2Iv6X9PdR0rR6F07TM%2FRs9G%2B%2BYIK1kHXDHgTN6Tqa9Kn%2B8BfoEt%2BZqnCJGYwv%2ByQiwY6pAFugzNge1CtFW4ATDcRX3hNOdndjPYZIsRGJutSgqHjCwxt8awsI7yZQ6vRxlp6LSSmoSK%2BkQ3evRcXC09cJ%2F1e4JrEeYASE3WVsCxAQVnPVIMtkim2T%2BFMB87kfQL6qAH6iiBO2KVli0mZ4%2BX%2ByxoxRVipnwQh%2B2l8LEnW1ug4kWwPqBp1%2F3G0D3IViaM%2F6KEe0O675l3jsd9YY%2BgtdY9L6zl0yg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d3d39596c2ff2cc5068f5f92ac25916238a87b0d57a7d7c101a9e53893f0ed50","file_size":131006,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":46,"voters":["arneswinnen","drsniper","michiel","inhibitor181","bogdantcaciuc","spam404","hph","flashdisk","jon_bottarini","vijay_kumar","and 36 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1405684,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nOur team is busy triaging and fixing HackerOne reports, and it may take us up to 3 weeks (or more) to triage any given issue. Don't worry, we'll get to yours!\n\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!","automated_response":true,"created_at":"2017-01-07T00:59:41.921Z","updated_at":"2017-01-07T00:59:41.921Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1430183,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. Our engineering team is investigating the issue.","automated_response":false,"created_at":"2017-01-19T14:40:44.068Z","updated_at":"2017-01-19T14:40:44.068Z","actor":{"username":"lalith-shopify","cleared":false,"url":"/lalith-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1452753,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. We recently deployed a fix for this issue.\n\nOur next round of bounty decisions will take place within three weeks, so we will be in touch with you again soon.","automated_response":false,"created_at":"2017-01-30T22:01:51.938Z","updated_at":"2017-01-30T22:01:51.938Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zombiehelp54","url":"/zombiehelp54"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1467368,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify!","automated_response":false,"created_at":"2017-02-07T01:28:42.663Z","updated_at":"2017-02-07T01:28:42.663Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"zombiehelp54","url":"/zombiehelp54"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467369,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-02-07T01:28:49.991Z","updated_at":"2017-02-07T01:28:49.991Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467381,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-02-07T01:32:16.080Z","updated_at":"2017-02-07T01:32:16.080Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1467382,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-02-07T01:32:16.113Z","updated_at":"2017-02-07T01:32:16.113Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}