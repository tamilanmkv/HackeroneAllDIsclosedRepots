{"id":198494,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTg0OTQ=","url":"https://hackerone.com/reports/198494","title":"Lack of Controls Allowing for Card and PIN Enumeration Leading to Fraud","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-01-15T02:39:58.133Z","submitted_at":"2017-01-15T02:39:58.133Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kylecolson","url":"/kylecolson","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-07-01T02:15:32.468Z","bug_reporter_agreed_on_going_public_at":"2017-06-01T02:15:26.948Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nThe pages https://www.starbucks.com/account/card/addcard and https://www.starbucks.com/account/card/Balance do not properly enforce security controls to limit POST requests. This bug allows attackers to successfully hijack a loaded Starbucks card and transfer all the funds into their own account. Cards linked with auto-reload features could exponentially increase fraud. \n*NOTE: You will need to pass primary authentication before testing these pages. I have set up a temporary account for this purpose.*\n\n**Card Enumeration:**\nIn a POST request to the above https://www.starbucks.com/account/card/addcard URL, if an attacker sets the Register.MyCard attribute to “FALSE” they can enumerate the 16-digit Card Number without limits. \nAnother important note is all Starbucks locations have unactivated cards at their registers. It is highly possible for a threat actor to obtain a 16-digit card number from the next card in line, and sit on the account until it has been loaded up. Furthermore, in my research I've discovered each card only increments a singular digit in their 16-digit number. Because of this, a threat actor can easily discern which cards are about to be purchased, as well as which cards have been recently purchased.\n{F152532}\n\n**PIN Enumeration:**\nIn a POST request to the second https://www.starbucks.com/account/card/Balance URL, an attacker can check the PIN of a card they’ve already added via the previous /addcard Card Enumeration method. \nIf an attacker already knows the 16-digit card number (via Starbucks stores), with the original POST request to the https://www.starbucks.com/account/card/addcard URL, if an attacker sets the Register.MyCard attribute to “TRUE” they can enumerate the 8-digit PIN number without limits.\nDue to this, an attacker is able to successfully test every PIN number against 16-digit card data.\n{F152533}\n{F152534}\n\n**Fraud/Risk:**\nIf an attacker is able to successfully validate PIN and Card information, they now have full access to all funds in the account. At this point they are able to commit fraudulent purchases and even migrate funds off the account onto their own card. Cards linked with auto-reload features could exponentially increase fraud damages. \n{F152535}\n\n**Documentation:**\nMy test card was used in this demonstration. On the attached image, you can see the card number ending in 4769 was successfully processed. In the second image, you can see the PIN correctly enumerating once the PIN ending in 89 was processed.\n\n**Remediation:**\nMy recommendation is to add velocity checks to both the /addcard and /Balance pages when attempting to add a Starbucks gift card. Additionally, CAPTCHA can be used as another authorization process. \n\nPlease let me know if you need additional information to help triage this bug.\nThanks!\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-07-01T02:15:26.977Z","allow_singular_disclosure_after":-135085488.1403221,"singular_disclosure_allowed":true,"vote_count":18,"voters":["cdl","reactors08","jskiba","alyssa_herrera","xyodh","geeknik","eveeez","r3y","silv3rpoision","spetr0x","and 8 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1425420,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Thanks for sending this in! We are currently reviewing this submission and we'll notify you once we have more information to share with you.","automated_response":false,"created_at":"2017-01-17T18:30:57.334Z","updated_at":"2017-01-17T18:30:57.334Z","original_report_id":194318,"actor":{"username":"sharpie","cleared":false,"url":"/sharpie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/093/272/b7429121474103e01ac6fabf477ddb52ed91556d_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1425489,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @sharpie! I'm confused as to why this was marked as a duplicate and closed, but then you mentioned you are reviewing it. \nPlease note, while similar in nature, this is a different attack vector than (#194318) and should be considered an additional security bug. \n\nPlease let me know if you need anything in the meantime! :)","automated_response":false,"created_at":"2017-01-17T18:47:59.736Z","updated_at":"2017-01-17T18:47:59.736Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1425554,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"My apologies, that duplicate was made on accident. We are still investigating if this issue is unique with our team internally. ","automated_response":false,"created_at":"2017-01-17T19:06:30.220Z","updated_at":"2017-01-17T19:06:30.220Z","actor":{"username":"sharpie","cleared":false,"url":"/sharpie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/093/272/b7429121474103e01ac6fabf477ddb52ed91556d_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439627,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@kylecolson, Thank you very much for your patience.\n\nI do not think one can determine card numbers are sequential solely based on the the response code of 200. Can you please provide more evidence by registering the sequential cards to the account? Please also provide the corresponding PIN values for those cards.\n\nThanks,\n@verona","automated_response":false,"created_at":"2017-01-23T22:59:42.068Z","updated_at":"2017-01-23T22:59:42.068Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1440041,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @verona. No disrespect, but I believe you misunderstood my original report. In my image, I am **not** stating each one of those card numbers are valid cards. The 200 response code is of no concern. The image simply shows card enumeration, with the last attempt being a valid number.\n\n-------\n**In detail:**\n\nThe issue I am reporting is not sequential cards but the lack of controls allowing me to enumerate any card number. The sequential nature of the cards only makes the matter worse, as I can identify which cards are before and after mine. I have attached another image to help better understand. \n\nAs you can see in the attached image, the 12th digit is incrementing for each card. At this point, _I only need to enumerate the last four digits to identify the correct card number._ This reduces the potential combinations from 10^16 to 10^4 (from 10,000,000,000,000,000 to 10,000 combinations). This issue allows an attacker to identify the next card number, or the previous card number, in a very small window of time. \n\nIn the first image I posted, the response code of 200 is of no concern; the identifier is response length.\nThe card number I tested in the enumeration process was █████. As you can see in my first image, once I was able to successfully identify the card number, the length of the page changed because this was now in my account. \n\n-------\n\nThis scenario only describes card enumeration. Once a card is identified, the attacker can then pivot to PIN enumeration, as outlined in my report. After successful identification of Card Number and PIN - an attacker is then granted full access to funds in the account. Once more, due to the sequential nature of cards, the ability to guess past and future cards greatly increases the risk of fraud.  \n","automated_response":false,"created_at":"2017-01-24T02:13:16.107Z","updated_at":"2017-07-03T04:46:13.348Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1462413,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update?","automated_response":false,"created_at":"2017-02-04T05:42:10.114Z","updated_at":"2017-02-04T05:42:10.114Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1495954,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kylecolson, Thanks for patience on this one.\n\nIt took some time as we were trying to validate your claim of sequential card numbers. We found that response length can't be solely used for determining validity of card number as our tests yielded same response lengths for valid and invalid card numbers. We had also added rate limiting for add card and balance queries too, which should resolve the risk. Can you please validate?\n\nThanks,\n@verona ","automated_response":false,"created_at":"2017-02-21T01:27:34.056Z","updated_at":"2017-02-21T01:27:34.056Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1513714,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @verona -- thank you for the update. I'm not sure where the disconnect is occurring, as I'm seeing a pretty clear difference in response length for valid and invalid cards.\n\nEither way, this is a moot point, as I'm no longer able to perform card enumeration :) \n\nConfirmed, your latest patch now prevents my previous attacks against add card and balance queries. \nGreat work!","automated_response":false,"created_at":"2017-03-01T16:48:31.205Z","updated_at":"2017-03-01T16:48:31.205Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1514615,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@kylecolson, Thank you very much for validation.\n\nPlease allow us some time for closing this report as we want to review it internally with other ones.\n\n@verona","automated_response":false,"created_at":"2017-03-02T00:17:20.467Z","updated_at":"2017-03-02T00:17:20.467Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1568076,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @verona and @starbucks \n\nSince this ticket is still open, I wanted to reiterate the danger of these vulnerabilities. As of late, an attack called GiftGhostBot has been seen in the wild exploiting the exact vulnerabilities I've submitted:\n\nhttps://www.grahamcluley.com/giftghostbot-malicious-bot-attempting-compromise-gift-cards-across-1000-websites/\nAnd\nhttps://www.theregister.co.uk/2017/03/24/giftghostbot_harvests_giftcard_creds/\n\nI ask you again to consider this in scope so other vulnerable endpoints may be discovered. \nEither way, if you need anything else from me to close this ticket, please let me know. \nThanks!","automated_response":false,"created_at":"2017-03-28T15:52:09.082Z","updated_at":"2017-03-28T15:52:09.082Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1576242,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @kylecolson for additional details. Please allow us little more time for getting back to you.\n\nThanks,\n@verona","automated_response":false,"created_at":"2017-03-31T22:11:25.408Z","updated_at":"2017-03-31T22:11:25.408Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1661649,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @verona and @starbucks\nThere has been no additional activity on this ticket for about a month now. May we go ahead and disclose, or are you still investigating this issue?","automated_response":false,"created_at":"2017-05-08T21:59:02.961Z","updated_at":"2017-05-08T21:59:02.961Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1671233,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks @kylecolson for the patience. You may go ahead with the disclosure as the risk is fixed.","automated_response":false,"created_at":"2017-05-12T23:14:51.058Z","updated_at":"2017-05-12T23:14:51.058Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"kylecolson","url":"/kylecolson"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1671234,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2017-05-12T23:15:06.268Z","updated_at":"2017-05-12T23:15:06.268Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1719088,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-06-01T02:15:26.960Z","updated_at":"2017-06-01T02:15:26.960Z","first_to_agree":true,"actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1756871,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Public disclosure?","automated_response":false,"created_at":"2017-06-15T01:40:21.295Z","updated_at":"2017-06-15T01:40:21.295Z","actor":{"username":"kylecolson","cleared":false,"url":"/kylecolson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/151/91865ceef70a6e3af12de78f340f873f87eaa00d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1795828,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-07-01T02:15:32.490Z","updated_at":"2017-07-01T02:15:32.490Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}