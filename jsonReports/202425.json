{"id":202425,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDI0MjU=","url":"https://hackerone.com/reports/202425","title":"Two-factor authentication bypass on Grab Android App","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-01-31T18:45:16.840Z","submitted_at":"2017-01-31T18:45:16.840Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sp1d3rs","url":"/sp1d3rs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1659,"url":"https://hackerone.com/grab","handle":"grab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/659/d5a2e407a772cb09a7ef57167580acf021c9c407_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/659/d5a2e407a772cb09a7ef57167580acf021c9c407_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Grab","twitter_handle":"GrabSG","website":"https://grab.com","about":"Grab is Southeast Asia's #1 ride-hailing app, food delivery service and cashless payment solution."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-12T19:19:02.464Z","bug_reporter_agreed_on_going_public_at":"2017-08-13T19:18:58.952Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Description\nI found the endpoint using android app `https://p.grabtaxi.com/api/passenger/v2/profiles/edit` which allow me to bypass 2FA (sms code) due to lack of rate limiting\\code expiration after unsuccessful attempts.\nThe root cause of the problem it that facts: no rate limiting+ no code expiration. Since code has 4 digits, attacker just need to count all possible combinations from 1000 to 9999.\nWhat happens if we do the wrong request to `https://p.grabtaxi.com/api/passenger/v2/profiles/edit` endpoint? Let's take a look:\n\n```\nPUT /api/passenger/v2/profiles/edit HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\nx-mts-ssid: [current session id, its too long so i removed it for report space economy]\nx-request-id: 3b609418-0e40-4f86-8ff6-4f23dfac420f\nHost: p.grabtaxi.com\nContent-Length: 26\nAccept-Encoding: gzip\nConnection: Keep-Alive\n\nprofileActivationCode=3122\n```\n\nResponse (bad request):\n\n```\nHTTP/1.1 400 Bad Request\nContent-Encoding: gzip\nContent-Type: application/json; charset=utf-8\nDate: Tue, 31 Jan 2017 17:45:43 GMT\nX-Api-Source: grabapi\nX-Request-Id: 01800ddb-fb58-4b53-aecc-97473225f732\nContent-Length: 47\nConnection: keep-alive\n\n{\"status\":400,\"code\":4000}\n```\nAnd what when code will be correct?\nResponse (correct request):\n\n```\nHTTP/1.1 204 No Content\nContent-Type: application/json; charset=utf-8\nDate: Tue, 31 Jan 2017 17:45:43 GMT\nX-Api-Source: grabapi\nX-Request-Id: 9d0eae1a-9c16-4aa5-8b40-01105a7cb994\nConnection: keep-alive\n```\nI looked to it, and wrote a simple C# tool which sends all possible codes combinations, until it finds a correct code. Source code and POC tool included to the report (it requires at least Windows 7 and NET 4.0 to run).\n\n## Impact\nThe attacker can bypass 2FA authentication on Grab android app. Attacker can succeed in the account takeover, changing email, phone number of the victim who use Google Auth on the app etc.\n\n## Steps To Reproduce:\n1. Login to your Grab Android app using Google with valid phone number (2FA on the phone login option is correctly implemented, and not vulnerable).\n2. Edit your profile name and press Save.\n3. The 4-digit sms code will be send to your phone. Dont look to it now:)\n4.  Use my POC tool (written on C#, requires .NET 4.0). You need a one header from the any app web request (`x-mts-ssid`) for proper testing. You can extract it from the any request from Android app, using some Web Proxy.\nIf you have troubles with extracting x-mts-ssid session header from the web request - let me know. It can be tricky thing (i used android emulator, connected to Charles Web Proxy, for request monitoring).\nOpen the program, paste the x-mts-ssid in the text field and press \"Start\". Wait till process will ends (correct code will be found).\n5. Compare code from the tool, and code that you received on the phone earlier - they must be equal. Also i wrote a POC video (https://drive.google.com/file/d/0B8dmpoHKDZsZSFI5WXY2RzRYT00/view?usp=sharing).\n\n## Mitigation/Remediation Steps:\nI suggest you implement a rate-limiting on this endpoint, or force 2FA code expiring after, for example, 5 wrong attempts (or both of this for better security).\n\n\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":156385,"file_name":"tool.zip","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/156/385/4c49cddbfc38c8fd42090e730bfcbd424edff183/tool.zip?response-content-disposition=attachment%3B%20filename%3D%22tool.zip%22%3B%20filename%2A%3DUTF-8%27%27tool.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVIDF5ZMX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140140Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDQQQUuKj8T5pdoqR2Krp3zajoi1gg54vXvD2Ne1FwhmAIhAKKfb3UfAQbrUu4HHC%2B4UyMY7m5fBTHvtLlTV0hUevF7KoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5Igy%2F64SgTlh6KUEnD5Uq1wMsL4Z6ljP60c3R7lO1zjypi9biR2g5iQoP%2FT3s6lOKdbpGuE3RHjMeja9YKKN7goc11u6bYdonocyi6RU8RN2An2aRnhfVo3l%2FZlMwpffUbu5JHc7OKmtZqUXTysPRszIl1CCSQ50yZBwtNWg%2Fxavv6bNKeHjCjYNwQxGBqC%2ByBW24czUMzGzaD5uFMoYGAMoWIxFJ6iHFG8UfXfoB1shKsZ3jkdkCp2MI12RtkuUec%2F0QW%2BSUqdLWUg2p3%2B1H%2FJaoFmNN5Utibk4elkj5kRmoejx7EnpbtxcHN1J6Ccb1mMlapHFqvmkcjE8fLu3vLMoRZX0qMhHcbtwHM4mmdbMGDcLaK4ZzuGUfKK3tlGfzyb%2BJEOYnCFd1OBdp9DB9bhiSMWyc1JifbNweT%2F1X1i3QMSQ%2BviuXf%2Bxvep9dRJ8nErGx9JdRp3yS8jCqdzkSh9FhreaRloo4jHkFXz72rd1zbbphih0VnX1T1kREihWx9RKRGpfOf2ct6w59fDThEMiXM7%2B1ZWMP1qPO2XDz8hAqeQqURPDe5AmiGn%2FZKFThe%2F8xzj0%2B5M2W36t3rKudZmsfzk9t0V0gZgIgIqXzHYE871rDImxmRy6q2HeWGIt10F1JC%2Fc9vpEwvO6QiwY6pAFAIHM092pG3M%2B23%2BPi00SqMMlTN%2FebpZH7d1Rq7%2BpDNNT62MHysMiTIJwmN0mj3cgRIiDLQKqFPlp97hcSQcDzJF%2F5WJ%2FSpWbDFtqVjRTP9eZ3KoMBEOEbvq2IGUFF14lCJNIXEj03clafpnnHjjr5akYILvb51xnKlHai4iTUO00TgVrv5%2FXDjYcFV06nU8YCB3mUWnDHCpTI6c%2BltGO9Yt9pxQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=bb76069ffa3f6d55b96bf893f7ee3d4ba40660f32a472260a38d750bd0bec737","file_size":85985,"type":"application/zip"}],"allow_singular_disclosure_at":"2017-09-12T19:18:59.027Z","allow_singular_disclosure_after":-128716961.31020316,"singular_disclosure_allowed":true,"vote_count":36,"voters":["bogdantcaciuc","bl4de","cablej","yumi","johndoe1492","anovg","ysx","cuso4","gamliel","eveeez","and 26 more..."],"severity":{"rating":"medium","score":4.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1454689,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"P.S. you can change the phone number in the Step 2 instead profile name to best impact demonstration. After finding the 2FA code by my tool (it not only found it, but submit too) do logout from the account, and then do login by Google again - and you will see that phone number was changed.\n\nP.P.S. tool has one bug - it continue working after finding correct code, so i suggest to terminate the tool process from Task Manager after POC checking, or before another start of the tool.\n\nIf you will have trouble reproducing - let me know, i will write extended video POC.","automated_response":false,"created_at":"2017-01-31T19:08:54.496Z","updated_at":"2017-01-31T19:19:10.124Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1455511,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"HI @sp1d3rs,\n\nThanks for your report.\n\nJust wanted to check if using this bruteforce and authenticated Token x-mts-ssid, you are able to change only your profile or are you also able to use this method to horizontally escalate and change other user's profile.","automated_response":false,"created_at":"2017-02-01T04:41:40.251Z","updated_at":"2017-02-01T04:41:40.251Z","actor":{"username":"grabsecurity","cleared":false,"url":"/grabsecurity","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1455759,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi, x-mts-ssid header is unique for each authenticated user, so i checked, and it seems like with my x-mts-ssid it is impossible to affect other user (only me). \nHowever, if attacker will somehow intercept this token from the victim (for example, get physical access to device where the victim is logged on by Google) - he can succeed in the account takeover by changing account phone and email using 2FA bypass.\n\nHorizontal escalating could be possible on \"Login with mobile number\" option (because there are no x-mts-ssid header), but this option with endpoint `https://p.grabtaxi.com/api/passenger/v2/profiles/activate` is secured and has a rate limiting and limit of allowed attempts, so not vulnerable.\n\n","automated_response":false,"created_at":"2017-02-01T09:14:17.727Z","updated_at":"2017-02-01T09:23:28.186Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1455777,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-02-01T09:27:35.173Z","updated_at":"2017-02-01T09:27:35.173Z","additional_data":{"old_severity":"Medium (6.5)","new_severity":"Medium (4.3)","old_severity_id":22691,"new_severity_id":22819},"actor":{"username":"grabsecurity","cleared":false,"url":"/grabsecurity","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1455781,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We have reviewed your bug report and would like to inform you that your submission is valid. We would request you give us some time while our teams are working on the fix. We will update you once the issue has been fixed so that we can verify the same.\n\nWe appreciate your help in keeping Grab and our customers safe and secure.","automated_response":false,"created_at":"2017-02-01T09:28:38.886Z","updated_at":"2017-02-01T09:28:38.886Z","actor":{"username":"grabsecurity","cleared":false,"url":"/grabsecurity","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1470714,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi ,\n\nCan you verify if this issue has been fixed?","automated_response":false,"created_at":"2017-02-08T10:20:37.663Z","updated_at":"2017-02-08T10:20:37.663Z","actor":{"username":"grabsecurity","cleared":false,"url":"/grabsecurity","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1470754,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, endpoint has rate limiting now, and code brutforce now will result to\n```\n{\n\t\"status\": 429\n}\n```\nafter some unsuccessful attempts, and all next requests will wail with the same status code. So it can be considered as fixed.","automated_response":false,"created_at":"2017-02-08T10:43:42.451Z","updated_at":"2017-02-08T10:47:10.932Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1470759,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for your working with us and helping us in resolving this issue. Your bounty will be processed shortly.","automated_response":false,"created_at":"2017-02-08T10:46:36.622Z","updated_at":"2017-02-08T10:46:36.622Z","actor":{"username":"grabsecurity","cleared":false,"url":"/grabsecurity","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sp1d3rs","url":"/sp1d3rs"},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1470995,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-02-08T12:48:40.379Z","updated_at":"2017-02-08T12:48:40.379Z","actor":{"url":"/grab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/659/d5a2e407a772cb09a7ef57167580acf021c9c407_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Grab"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"grab","collaborator":{"username":"sp1d3rs","url":"/sp1d3rs"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1471019,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the generous bounty!","automated_response":false,"created_at":"2017-02-08T12:58:16.667Z","updated_at":"2017-02-08T12:58:16.667Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1924939,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-13T19:18:58.984Z","updated_at":"2017-08-13T19:18:58.984Z","first_to_agree":true,"actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1992425,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-09-12T19:19:02.528Z","updated_at":"2017-09-12T19:19:02.528Z","actor":{"url":"/grab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/659/d5a2e407a772cb09a7ef57167580acf021c9c407_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Grab"}},"genius_execution_id":null,"team_handle":"grab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":3330,"category":"researcher","content":"I found a two-factor authentication bypass on the endpoint, used by Grab Android App.\nThe team was very responsible and fixed the issue fast.\nThanks to the Grab team for the great experience and the bounty!\n\nI escalated similar issue to the **any user account takeover** by unauthenticated attacker in #205000 report (disclosure will be requested after clearing the private info). In this report i mentioned, that \"Login with mobile number\" endpoint is secure, and not vulnerable, but later i challenged myself, and discovered a way to bypass OTP code (not 2FA like in this report) there too.\n\nI will disclose #205000 as soon as sensitive info there will be redacted.\n\nP.S. the POC tool did not check the codes, which was starting from 0*** (my bad) - fortunately, it did not affect triage process. The attached tool also can be rewritten for the any other case. Yeah, it's probably the time to learn Python:)\n\n###Used tools and apps:\n1) Nox App Player (android emulator), proxied through web debugging proxy.\n2) Tested application - https://play.google.com/store/apps/details?id=com.grabtaxi.passenger (app allows registration from any country)\n3) Custom C# code bruteforcer, attached below in the report.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":79690,"username":"sp1d3rs","name":"Dr. Jones","bio":"Human. Possibly","cleared":true,"website":"https://xp.ht","location":"Xen","created_at":"2016-05-23T03:07:23.595Z","url":"https://hackerone.com/sp1d3rs","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"hacker_resume_enabled":true,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}