{"id":221432,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjE0MzI=","url":"https://hackerone.com/reports/221432","title":"CSRF-Token leak by request forgery","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-04-16T18:18:57.745Z","submitted_at":"2017-04-16T18:18:57.745Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"naure","url":"/naure","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-10-09T12:14:52.030Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-09-09T12:14:37.267Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI found the following issue in my own Gitlab installation.\nThis is a request forgery that reveals the Rails `authenticity_token` remotely, which in turn allows mounting state-changing CSRF attacks.\n\n# Vulnerability\n\nThe web app code relies on `location.pathname` in a number of places to create new relative URLs.\n\nHere is one:\nhttps://gitlab.com/gitlab-org/gitlab-ce/blob/f78ecda55d5431f9a74ab2892b516ecb45f24d80/app/assets/javascripts/environments/folder/environments_folder_view.js#L21\n\nAnd below, it sends a request to such a URL:\nhttps://gitlab.com/gitlab-org/gitlab-ce/blob/f78ecda55d5431f9a74ab2892b516ecb45f24d80/app/assets/javascripts/environments/folder/environments_folder_view.js#L86\n\nNow, a forged link containing `//namespace/repo/` will make these URLs absolute because of the leading double slashes. I was able to create an `attack.com` namespace which translates to `https://attack.com/repo/`.\nThe app will then send a request including the anti-CSRF token to an attacker controlled domain. Which it definitely should not, ever (see point 2. below).\n\n# Impact\n\nA malicious web page and the coordinated server will be able to perform actions through the victim's browser in a second.\n\nIn addition, this opens up a new attack surface as the app will process untrusted replies as trusted content. There is high risk of injecting javascript somewhere, maybe here:\nhttps://gitlab.com/gitlab-org/gitlab-ce/blob/f78ecda55d5431f9a74ab2892b516ecb45f24d80/app/assets/javascripts/environments/components/environment_terminal_button.js#L33\n\n# Recommendations\n\nIssues of this kind should be fixed globally, since the code is recent and developers are likely to introduce more `document.location` dependencies regularly.\n\n1. Validate or normalize requested URLs against //, /../, and co. This can be done in Rails or in JS, or both.\n\n2. Forbid cross-domain requests in all `Vue.http` and `$.ajax` helpers, like this one:\nhttps://gitlab.com/gitlab-org/gitlab-ce/blob/f78ecda55d5431f9a74ab2892b516ecb45f24d80/app/assets/javascripts/vue_shared/vue_resource_interceptor.js#L21\n\nBest regards,\nAurel","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-10-09T12:14:37.331Z","allow_singular_disclosure_after":-126409947.25638169,"singular_disclosure_allowed":true,"vote_count":4,"voters":["eveeez","cr4xerbik4sh","secdoor","cryptphi"],"severity":{"rating":"medium","score":6.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1615461,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @naure,\n\nThanks for the report! I've opened a confidential for investigation and discussion: https://gitlab.com/gitlab-org/gitlab-ce/issues/31045\n\nThat issue will be opened to the public when a patch is released. I'll keep you updated on our progress here.","automated_response":false,"created_at":"2017-04-17T14:05:29.260Z","updated_at":"2017-04-17T14:05:29.260Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1765702,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @naure,\n\nWe're still working on a fix for this vulnerability. Sorry for the delay!","automated_response":false,"created_at":"2017-06-19T16:46:52.309Z","updated_at":"2017-06-19T16:46:52.309Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1878506,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @naure,\n\nWe're still working on a fix but I've made this a priority. We hope to have something ready soon. Thanks for your patience.","automated_response":false,"created_at":"2017-07-30T22:16:07.635Z","updated_at":"2017-07-30T22:16:07.635Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1967038,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @naure,\n\nWe have a fix ready to go out with our next security release, which should be out in the next few days. I'll let you know when it's released. Thanks again for the report!","automated_response":false,"created_at":"2017-08-30T18:12:38.170Z","updated_at":"2017-08-30T18:12:38.170Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1981024,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @naure,\n\nDo you have a preferred profile link we can include when we publicly credit you for this finding? We typically use HackerOne profile links, Twitter feeds, Facebook profiles, etc., whatever you prefer.","automated_response":false,"created_at":"2017-09-06T21:13:52.426Z","updated_at":"2017-09-06T21:13:52.426Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1982373,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Briann,\n\nthanks for your consideration.\nHere is my Twitter profile:Â https://twitter.com/aurelcode","automated_response":false,"created_at":"2017-09-07T10:21:49.590Z","updated_at":"2017-09-07T10:21:49.590Z","actor":{"username":"naure","cleared":false,"url":"/naure","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1984005,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @naure,\n\nA patch for this vulnerability was included with our security release today: https://about.gitlab.com/2017/09/07/gitlab-9-dot-5-dot-4-security-release/\n\nWe've added you to our Vulnerability Acknowledgements page: https://about.gitlab.com/vulnerability-acknowledgements/\n\nLet me know if you'd like a swag code for some free GitLab swag!","automated_response":false,"created_at":"2017-09-07T23:00:50.671Z","updated_at":"2017-09-07T23:00:50.671Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"naure","url":"/naure"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1985078,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good thing, thanks.\nSwag is always nice of course!\nCheers","automated_response":false,"created_at":"2017-09-08T14:12:08.852Z","updated_at":"2017-09-08T14:12:08.852Z","actor":{"username":"naure","cleared":false,"url":"/naure","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1986006,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here you are: âââ\n\nPlease let me know once you've copied that swag code so I can redact it and open this report to the public. ","automated_response":false,"created_at":"2017-09-08T21:37:24.600Z","updated_at":"2017-09-09T12:14:29.485Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1986576,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Done, thanks.","automated_response":false,"created_at":"2017-09-09T09:19:49.018Z","updated_at":"2017-09-09T09:19:49.018Z","actor":{"username":"naure","cleared":false,"url":"/naure","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1986699,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-09-09T12:14:37.296Z","updated_at":"2017-09-09T12:14:37.296Z","first_to_agree":true,"actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2053201,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-10-09T12:14:52.057Z","updated_at":"2017-10-09T12:14:52.057Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}