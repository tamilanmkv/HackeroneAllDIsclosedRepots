{"id":227102,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjcxMDI=","url":"https://hackerone.com/reports/227102","title":"Two Error-Based SQLi in courses.aspx on ██████████","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-05-09T06:13:58.202Z","submitted_at":"2017-05-09T06:13:58.202Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tcpiplab","url":"/tcpiplab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/113/049/692d3d0775ad3998c4e2aee97daa865a1827cfb7_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://bit.ly/2Rt5QhM","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-02T18:54:52.174Z","bug_reporter_agreed_on_going_public_at":"2019-01-23T02:51:50.312Z","team_member_agreed_on_going_public_at":"2019-12-02T18:54:52.054Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nThe server at ████ contains two SQL injection vulnerabilities in the `courses.aspx` file. These are error-based SQLi vulnerabilities. The resulting errors reveal seven lines of C# code, including inline SQL which reveals internal database information. Note that this is one of two reports I'm going to submit for error-based SQLi; I'm grouping them by their vulnerable source code file.\n\n**Description:**\nThe `crs_id` parameter, when sent with a `GET` to `courses.aspx`, triggers an **Unhandled Exception** if its value is set to either `%0a` or `0`. The vulnerable code is on lines 174 and 177, respectively.\n\n## Impact\n1. Leakage of:\n   * Database table names and column names.\n   * Seven lines of C# code, including inline SQL.\n   * Server and framework version information.\n1. Unhandled exceptions containing SQL errors are attractive indicators that hackers look for. Even though these vulnerabilities do not allow an attacker to execute arbitrary SQL, the errors do make for a much larger and more promising attack surface. Combining parts of the two error outputs reveals seven lines of C# code, with some inline SQL:\n   \n   ```c\nLine 173:        sqlcrs = CCommonServices.GetCourseSQL(Request.QueryString(\"crs_id\"))\nLine 174:        rscrs.open(sqlcrs, connectionString)\nLine 175:        sqlCrcf = \"SELECT Career_Field.CF_Name FROM Career_CORE_PLUS Join Career_Field on Career_Field.CF_ID = Career_CORE_PLUS.CF_ID join CRS_Detail on CRS_Detail.ID = Career_CORE_PLUS.CRS_ID where Career_CORE_PLUS.CRS_ID =\" + Request.QueryString(\"crs_id\")\nLine 176:        rsCrcf.Open(sqlCrcf, ConfigurationManager.ConnectionStrings(\"VbConnect\").ToString())\nLine 177:        crs = rscrs(\"crs_header\").value\nLine 178:        crs_id_print = Request.QueryString(\"crs_id\")\nLine 179:        rsData = oCommonServices.getCLPbyCOURSE(Request.QueryString(\"crs_id\"))\n```\n\n   The SQL from line 175, revealing the names of tables and columns, is most interesting to an attacker:\n   ```sql\n   SELECT Career_Field.CF_Name\n   FROM Career_CORE_PLUS\n   Join Career_Field on Career_Field.CF_ID = Career_CORE_PLUS.CF_ID\n   join CRS_Detail on CRS_Detail.ID = Career_CORE_PLUS.CRS_ID\n   where Career_CORE_PLUS.CRS_ID =\n   ```\n\n## Step-by-step Reproduction Instructions\n\n1. Send a `GET` request to `http://████████/onlinecatalog/courses.aspx?crs_id=%0a`\n1. The server returns the following error: `Error converting data type varchar to numeric.` and indicates line 174 of `C:\\Web_Data\\iCatalog\\onlinecatalog\\courses.aspx`.\n   ██████\n1. Send a `GET` request to `http://██████/onlinecatalog/courses.aspx?crs_id=0`\n1. The server returns the following error: `Either BOF or EOF is True, or the current record has been deleted. Requested operation requires a current record.` and indicates line 177 of the same file.\n   ███\n\n## Product, Version, and Configuration (If applicable)\n* Microsoft .NET Framework Version:4.0.30319\n* ASP.NET Version:4.6.1590.0 \n* IIS 7.5\n\n## Suggested Mitigation/Remediation Actions\n1. Add code to validate that the value of the `crs_id` parameter is an integer.\n1. Add code to return a `404` error page if the value of the `crs_id` parameter does not reference a valid object. Alternatively, you could set a default value to that of a known-good object reference.\n1. Add code to return something other than the familiar `Invalid name parameter` error when the `crs_id` parameter is set to an invalid character. E.g., setting the value to `ä`:\n\n   `http://██████████/onlinecatalog/courses.aspx?crs_id=%C3%A4`\n\nReturns this terse error:\n```\nInvalid name parameterä\n```\nAlthough seemingly a less sensitive error message, I found this behavior useful. It gave me a fourth option when distinguishing between various behaviors based on my fuzzing of the aforementioned parameter:\n* `200/OK` and a proper page render when the parameter is set to a valid value.\n* TCP reset sent when the web application firewall (WAF) blocks a known-malicious value like `ORDER BY`.\n* Unhandled exceptions by the application code (as shown above).\n* Invalid input caught and appended to the `Invalid name parameter` message.\n\nMy recommendations, generally, are that you modify the source code of the `courses.aspx` file so that you can eliminate these latter two behaviors.\n\nPlease let me know if you have any questions.","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1662331,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","automated_response":true,"created_at":"2017-05-09T06:13:58.342Z","updated_at":"2017-05-09T06:13:58.342Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1663200,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-05-09T13:53:25.700Z","updated_at":"2017-05-09T13:53:25.700Z","additional_data":{"old_severity":null,"new_severity":"Medium","old_severity_id":null,"new_severity_id":41242},"actor":{"username":"bwluebberthill","cleared":false,"url":"/bwluebberthill","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1663201,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2017-05-09T13:53:37.645Z","updated_at":"2017-05-09T13:53:37.645Z","actor":{"username":"bwluebberthill","cleared":false,"url":"/bwluebberthill","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1666881,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Somehow I neglected to include important information in the section \"Suggested Mitigation/Remediation Actions\". Please append this to my minimum recommendations:\n\n1. A better solution is to parameterize user input values that will become part of SQL statements. You can find a short code example in this StackExchange question: [parameterized sql query - asp.net / c#](http://stackoverflow.com/questions/13600179/parameterized-sql-query-asp-net-c-sharp).\n1. One way to accomplish the aforementioned parameterization is to use Object Relational Mapping (ORM). ASP.NET has the built-in [Entity Framework](https://msdn.microsoft.com/en-us/data/ee712907.aspx), but there are many other ORMs to choose from.\n\nProbably the quickest way to get context and details about all these suggestions is to read all the answers to this excellent StackOverflow question [parameterized queries vs. SQL injection\n](http://stackoverflow.com/questions/17509169/parameterized-queries-vs-sql-injection\n).\n\nIf you're a one-man-band infosec guy who has to fix this on your own, ASAP, then begin at the top of my list of suggestions. But if your leadership/budget/time/staffing allow you to do things like this the right way, then I recommend that you read the OWASP [SQL Injection Prevention Cheat Sheet](https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet) first.\n\nEither way, when trying to decide which mitigation to implement, your decision making process will be greatly clarified by reading the OWASP [SQL Injection Prevention Cheat Sheet](https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet).\n\n\nGood luck. Please let me know if you have any questions.","automated_response":false,"created_at":"2017-05-10T22:29:54.598Z","updated_at":"2017-05-10T22:29:54.598Z","actor":{"username":"tcpiplab","cleared":false,"url":"/tcpiplab","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/113/049/692d3d0775ad3998c4e2aee97daa865a1827cfb7_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2941330,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2018-06-27T15:27:36.349Z","updated_at":"2018-06-27T15:27:36.349Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"tcpiplab","url":"/tcpiplab"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4021681,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-01-23T02:51:50.340Z","updated_at":"2019-01-23T02:51:50.340Z","first_to_agree":true,"actor":{"username":"tcpiplab","cleared":false,"url":"/tcpiplab","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/113/049/692d3d0775ad3998c4e2aee97daa865a1827cfb7_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6450505,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Approved for disclosure. Thanks for your participation in the DoD Vulnerability Disclosure Program (VDP). Please follow us on Twitter @DC3VDP","automated_response":false,"created_at":"2019-12-02T18:54:52.072Z","updated_at":"2019-12-02T18:54:52.072Z","actor":{"username":"agent-1","cleared":false,"url":"/agent-1","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/379/490/775a471f25ef037fbf277e8b5d5a50bbb9e9ab56_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6450506,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-12-02T18:54:52.193Z","updated_at":"2019-12-02T18:54:52.193Z","actor":{"username":"agent-1","cleared":false,"url":"/agent-1","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/379/490/775a471f25ef037fbf277e8b5d5a50bbb9e9ab56_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}