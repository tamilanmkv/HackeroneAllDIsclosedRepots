{"id":236607,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzY2MDc=","url":"https://hackerone.com/reports/236607","title":"Remote Code Execution in the Import Channel function","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-06-05T15:17:34.888Z","submitted_at":"2017-06-05T15:17:34.888Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"strukt","url":"/strukt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":265,"url":"https://hackerone.com/expressionengine","handle":"expressionengine","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"ExpressionEngine","twitter_handle":"eecms","website":"https://expressionengine.com/","about":"ExpressionEngine is a robust and flexible open-source Content Management System."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-04-04T16:36:38.276Z","bug_reporter_agreed_on_going_public_at":"2018-04-04T16:12:09.563Z","team_member_agreed_on_going_public_at":"2018-04-04T16:36:38.201Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nAdministrators are allow to import channels by visiting http://HOST/PATH_TO_EE/admin.php?/cp/channels/sets and uploading .zip archives that contain the information about the channels to be imported. The archives are then extracted into temporary directories, which are kept in the `/system/user/cache/cset/` directory. The problem is that, if the archive doesn't have all the required files for the import to be successful, the extracted files remain in their folders and an error is thrown to the administrator stating that a file doesn't exist in the archive.\n\nThis allows an administrator to upload .php scripts to the server, which is not allowed by default in ExpressionEngine as far as I can see.\n\n###Steps to reproduce:\n1- Download the attached .zip archive and browse to http://HOST/PATH_TO_EE/admin.php?/cp/channels/sets\n2- Try to upload the zip file you just downloaded as the imported channel\n3- Navigate to http://HOST/PATH_TO_EE/system/user/cache/cset/, which will show a directory listing of all the temporary directories, this is a problem by itself\n4- If this is your first time trying this, you should find a single directory, click the directory's name and then click the test.php file and edit the URL in the address bar by adding \"?cmd=whoami\" to the URL\n5- Notice that the command has executed and that the information is returned in the page\n\nRegards,","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":7,"voters":["sp1d3rs","eveeez","apapedulimu","hassham","tortberre","saiinfosec","japz"],"severity":{"rating":"medium","score":5.7,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1730559,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Excuse me, I forgot to attach the zip archive.","automated_response":false,"created_at":"2017-06-05T15:19:52.764Z","updated_at":"2017-06-05T15:19:52.764Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":191348,"filename":"test.zip","type":"application/zip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/191/348/55250ab0d4fb378154cd7e57d8a9f391b49094fe/test.zip?response-content-disposition=attachment%3B%20filename%3D%22test.zip%22%3B%20filename%2A%3DUTF-8%27%27test.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2T6DG5UU%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T141126Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQCyGt%2F6wKTb7WdhbTEehok3geSSNypgF1jy9glhzjfqmQIhAN%2FZ96OUsxT3l%2FcNh%2BJaiqKBQp%2B0XefuAf%2BhfC%2FmhMZBKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxZblqGtDqM2dUzvNgq1wMBRL4HwjcRdARKHRTYG1WTOwsUnNm5pyWIDl6UX7cxu3S9pxhLAGamITa%2Bry536DE0dNafGhdIyPeponbLp8FxjTVDEDmVrSlc3vq07ilX%2FsvaFMPbfLwUFwN8DcJVAZSLYZA6zDdeKNCgrZ1ISy%2BuSl%2F8sa9Nj%2FKFffdAxrEzWdcbmnUnTxt6PFvOqigHySvKHcRU1WUlzR%2BJNQhShWoYk3WMwt3lGEOyDeyEBa1PjWzXfwU5hwfOCygWSHeqe3rws%2Fy%2FAjcJ4Igs3dp7VWi2gpey9dMnBlv29eq43WYKyQ6K0q%2FC9l73EFZqlsoZAnNWCF%2BaMWp%2FSNCQCoi6LiyTT3H7xbPsVAE%2F%2B6%2B%2Fmd5o4HWlwOrPWTPapPHw%2BSF0OGtEIdy9BSNcjjpsTprmH3CxZWrOiVUBzDRDrImWT3QqtKWRETxE5UkMEesELPvS1Vr78fUKmIPG33W64ks49siCJg%2BYlvii52MslCAhwi8OBai4EvmsepnSL4Y7WjbGc31Zh7uWP1tOMXaSXgoK4ZXpbX9aNZgfinEq%2FEdjmz1acLqkVL8LTALuORrCaSQNzbL1VsrMHnDQY5Ip6UHG9W3WhTLOB2rMmAx%2FYtqF%2F2HrLRQRuA5lXPow%2F4aRiwY6pAFiuHIrJ99Gk48YedhIWLylCmpLudXTrjRTQ5%2BPJgz8sHy%2FJL%2BbYgchWh7RyeRvXCGWkecfBiAUWkHftxJlLxZP3R4oliu1hG1pnP80N0SBXLpKCFAQqqhncEnNPuXaqUaPMjKqpRRMw76WlTCCpu34SiacreJDZDO6dLymqMm3OX1OpD5Y13L2IbUTLcllZFway4EkA3FPk2PKaxAARwJYsWedpQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=14c7b3fb673c9f5460cde7c0fb0b45716392ed23da852db229d34c7cf14dd5a7"}],"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744533,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any news about this and the other new reports ?","automated_response":false,"created_at":"2017-06-09T14:49:39.716Z","updated_at":"2017-06-09T14:49:39.716Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744770,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @strukt, sorry for the delay, many of us were out this week and are just getting back today.\n\nThank you for reporting this, yes looks like there were a few oversights! I've just made the following changes:\n\n1. We won't even extract the archive if we see there's a PHP file inside.\n2. The cset directory is now created with an index.html file to prevent indexes.\n3. Files are now properly cleaned up after import success/failure.\n\nI think that should take care of everything. I'll look at your other reports today as well.","automated_response":false,"created_at":"2017-06-09T16:33:47.254Z","updated_at":"2017-06-09T16:33:47.254Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744836,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kevincupp Thank you very much, yes these changes seem to fix the issue.","automated_response":false,"created_at":"2017-06-09T16:57:23.681Z","updated_at":"2017-06-09T16:57:23.681Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1761516,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Fixed in 3.5.8","automated_response":false,"created_at":"2017-06-16T17:26:46.650Z","updated_at":"2017-06-16T17:26:46.650Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"strukt","url":"/strukt"},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565052,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-04T16:12:09.602Z","updated_at":"2018-04-04T16:12:09.602Z","first_to_agree":true,"actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565109,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-04-04T16:35:12.628Z","updated_at":"2018-04-04T16:35:12.628Z","additional_data":{"old_severity":"Critical","new_severity":"Medium (5.7)","old_severity_id":48259,"new_severity_id":135782},"actor":{"username":"djones","cleared":false,"url":"/djones","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565111,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-04T16:36:38.222Z","updated_at":"2018-04-04T16:36:38.222Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565112,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-04-04T16:36:38.296Z","updated_at":"2018-04-04T16:36:38.296Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}