{"id":246794,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDY3OTQ=","url":"https://hackerone.com/reports/246794","title":"XSS on \"widgets.shopifyapps.com\" via \"stripping\" attribute and \"shop\" parameter","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2017-07-07T07:06:08.957Z","submitted_at":"2017-07-07T07:06:08.957Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bored-engineer","url":"/bored-engineer","profile_picture_urls":{"small":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/xh0k94drzpd2d2z4bz9b1kbzngbh/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c?response-content-disposition=inline%3B%20filename%3D%22IMG_0330%20%25281%2529.jpg%22%3B%20filename%2A%3DUTF-8%27%27IMG_0330%2520%25281%2529.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T142935Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e72c8dd8261cf81b68868ee3a8746373a3133a4f04159a2e1988ccf717e4632d"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-04-03T19:44:37.398Z","bug_reporter_agreed_on_going_public_at":"2018-04-03T19:44:37.271Z","team_member_agreed_on_going_public_at":"2018-04-03T18:12:57.907Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Description\nShopify allows developers to embed widgets (containing product info) on third-party websites via \"widgets.shopifyapps.com\". When the widget is rendered the `shop` attribute is not filtered allowing any website (not just Shopify shops) to be specified. By providing an attacker controlled domain and serving a specially crafted payload containing the `stripping` object attribute HTML escaping will be disabled resulting in XSS on \"widgets.shopifyapps.com\".\n\n# Technical Details\nThis issue occurs in [/assets/widgets/product/application.js](https://widgets.shopifyapps.com/assets/widgets/product/application.js). The `Framework.Models.Collection` class (used for fetching collections of objects) defines a special `parse` method which automatically escapes all strings. This escaping is provided by `Framework.Helpers.stripHTMLForObject` which looks like this (prettified):\n```js\nFramework.Helpers.stripHTMLForObject = function(obj) {\n  obj.stripping = true;\n  var idx, val;\n  for (idx in obj) {\n    if (obj.hasOwnProperty(idx)) {\n      var val = obj[inx]\n      if(\"string\" == typeof val) {\n        obj[idx] = Framework.Helpers.stripHTML(val) \n      } else {\n        if(null != val \u0026\u0026 \"object\" == typeof val \u0026\u0026 null == val.stripping) {\n          obj[idx] = this.stripHTMLForObject(val)\n        }\n     }\n   }\n   delete obj.stripping;\n   return obj;\n}\n``` \nThe `Framework.Helpers.stripHTML` function seems to be a implementation of the [Caja compiler](https://developers.google.com/caja/) which we can assume is safe, however by crafting a object with a `stripping` attribute HTML escaping will be disabled. An example product would look like this:\n```json\n{\n\t\"product\": {\n\t\t\"variants\": [{\n\t\t\t\"stripping\": false,\n\t\t\t\"title\": \"\u003coption/\u003e\u003cselect/\u003e\u003cimg src=xx: onerror=alert('bored-engineer')\u003e\"\n\t\t}, {}],\n\t\t\"options\": [],\n\t\t\"images\": [{}],\n\t\t\"image\": {}\n\t}\n}\n```\nI've hosted this file (and the other required `meta.json` file) on [attackerdoma.in](https://attackerdoma.in).\n\n# Proof of Concept\nOpen [widgets.shopifyapps.com/products/stripping-xss?shop=attackerdoma.in](https://widgets.shopifyapps.com/products/stripping-xss?shop=attackerdoma.in)\n\n# Exploitability\nOnce you locate the escaping issue it's relatively trivial to exploit and requires to user interaction as shown in the PoC.\n\n# Remediation\nThe application should not allow shops/servers to disable HTML escaping via the `stripping` attribute.","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":31,"voters":["jokebookservice1","sp1d3rs","drsniper","bl4de","ta8ahi","riramar","thisishrsh","supernatural","eveeez","an0nym0us","and 21 more..."],"severity":{"rating":"none","author_type":"Team"},"structured_scope":{"databaseId":10803,"asset_type":"OTHER","asset_identifier":"Other","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1814239,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. Our engineering team is investigating the issue.","automated_response":false,"created_at":"2017-07-07T13:56:09.905Z","updated_at":"2017-07-07T13:56:09.905Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1863981,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report.\n\nIt appears that the `null == val.stripping` check was unnecessary, so we resolved the issue by removing it from the application.js files in which that check was used.\n\nOur next round of bounty decisions will take place later this week, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-07-24T19:19:37.244Z","updated_at":"2017-07-24T19:19:37.244Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bored-engineer","url":"/bored-engineer"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1891283,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again for the report @bored-engineer. We are awarding a higher amount than usual for this report based on the quality of the report and the level of difficulty involved in finding this type of logic issue. We're looking forward to more more reports like this one.","automated_response":false,"created_at":"2017-08-03T20:43:55.437Z","updated_at":"2017-08-03T20:43:55.437Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"bored-engineer","url":"/bored-engineer"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2560029,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-03T18:12:57.952Z","updated_at":"2018-04-03T18:12:57.952Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2560314,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-03T19:44:37.311Z","updated_at":"2018-04-03T19:44:37.311Z","actor":{"username":"bored-engineer","cleared":false,"url":"/bored-engineer","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/xh0k94drzpd2d2z4bz9b1kbzngbh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22IMG_0330%20%25281%2529.jpg%22%3B%20filename%2A%3DUTF-8%27%27IMG_0330%2520%25281%2529.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T142936Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=780fbc6aa2da754a87d4649182c45d6c591173290ea72fdba36bb8e1c28bdddc"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2560315,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-04-03T19:44:37.428Z","updated_at":"2018-04-03T19:44:37.428Z","actor":{"username":"bored-engineer","cleared":false,"url":"/bored-engineer","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/xh0k94drzpd2d2z4bz9b1kbzngbh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22IMG_0330%20%25281%2529.jpg%22%3B%20filename%2A%3DUTF-8%27%27IMG_0330%2520%25281%2529.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T142936Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=780fbc6aa2da754a87d4649182c45d6c591173290ea72fdba36bb8e1c28bdddc"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2890059,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2018-06-15T18:58:44.633Z","updated_at":"2018-06-15T18:58:44.633Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"Other","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}