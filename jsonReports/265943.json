{"id":265943,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjU5NDM=","url":"https://hackerone.com/reports/265943","title":"Stealing SSO Login Tokens (snappublisher.snapchat.com)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-09-05T07:03:06.903Z","submitted_at":"2017-09-05T07:03:06.903Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"coolboss","url":"/coolboss","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":513,"url":"https://hackerone.com/snapchat","handle":"snapchat","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Snapchat","twitter_handle":"","website":"https://www.snapchat.com/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-07-29T22:37:09.907Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-11-04T11:14:57.449Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Description\nAttacker can steal SSO login tokens for snappublisher.snapchat.com by chaining different flaws in SSO and Snapchat’s Snappublisher tool. Detailed attack flow is as follows.\n\n# Attack Flow\n1.. Snapchat fetches a `SSO LOGIN TOKEN` from `accounts.snapchat.com` to login into different products of Snapchat i.e. SnapPublisher, Ads Manager, Business Manager, etc. provided that user is logged into `accounts.snapchat.com`.\neg. To login into SnapPublisher following requests are made …\n1] https://accounts.snapchat.com/accounts/login?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/sso_continue\n2] 302 redirect to\nhttps://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https%3A%2F%2Fsnappublisher.snapchat.com%2Fsso_continue\n3] again 302 redirect to \nhttps://snappublisher.snapchat.com/sso_continue?ticket=redacted\n\nSo, a SSO login token `ticket` is sent from `accounts.snapchat.com` to `snappublisher.snapchat.com` which is used to login the user. And is also used in `Authorization header` when making requests to API.\n\nNow, we are going to steal this SSO login token `ticket` which will allow us to login and control victim’s account.\n\n2.. On `snappublisher.snapchat.com`, I was able to upload a `svg` image to google cloud storage, using which I run my javascript code.\nNote: Use `import from site` functionality via `https://snappublisher.snapchat.com/snaps/create/new` and import my `xss-svg` image from here (███████/tokenstealer.svg). This alerts and logs `#hashfragment` in the console. \nI have already did this in my POC so this is just for understanding purpose. My image URL is `https://snappublisher.snapchat.com/api/v1/media/████████/file/somthine.svg?%23pranav`\n\n3.. Now, other flaws in SSO …\n1] In this URL \n`https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/api/v1/media/████████/file/somthine.svg?%23pranav`\n\n`referrer` parameter can be controlled and any `snappublisher.snapchat.com` URL is allowed.\nAlso, `%23pranav`, this `#hashfragment` is allowed in `referrer ` parameter. \n\nI take advantage of both these flaws to flow the `SSO login token` to my website or land to a page which I control.\nNote: `#hashfragment` is send further by browser for `302` / `307` redirects.\n\n\n4.. CSRF Login flaw\nSSO functionality is vulnerable to CSRF attack so I can login other people into my account. I use this functionality to login user into my account.\n\n5.. Token doesn’t expire flaw \nOnce the SSO login token is used, it doesn’t expire and can be reused multiple times.\n\nSo, simple attack flow is as follows :\n1. User is logged into `accounts.snapchat.com`.\n2. Attacker logs user into his/her `snappublisher.snapchat.com` account via CSRF login flaw.\n3. Now, attacker makes a request to fetch SSO login token `https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/api/v1/media/█████████/file/somthine.svg?%23pranav` and redirects the token in `#hashfragment` to `https://snappublisher.snapchat.com/api/v1/media/█████/file/somthine.svg?%23pranav`\n4. `https://snappublisher.snapchat.com/api/v1/media/████/file/somthine.svg?%23pranav` this redirects with `307` status code to `storage.googleapis.com/creativesuite-prod-media/*` with `SSO login token ticket` in  `#hashfragment` carried forward by browser.\n5. Svg image executes my js code and alerts and logs the `SSO login token ticket` in the console.\n6. I can use the `ticket` to login into victim’s account. Via `https://snappublisher.snapchat.com/sso_continue?ticket=\u003cstolen token\u003e`\n\n# Proof Of Concept\n\nVideo POC : █████████(Unlisted video on youtube)\n\n1. Login into your account on `accounts.snapchat.com`.\n2. Login into your SnapPublisher account `snappublisher.snapchat.com`.\n3. Visit (█████) which fetches `user’s SSO login token` which can be used to login. (This alerts and logs the `token` in console.)\n4. Use the token via `https://snappublisher.snapchat.com/sso_continue?ticket=\u003cstolen token\u003e`\n\n\n# Impact \n1. Gain unauthorized access to Snappublisher account.\n2. Can use the SSO login token to make API requests.\n\n# Recommendations\n\n1. For SSO functionality …\n1] Add `state` param to prevent `CSRF login` on `https://snappublisher.snapchat.com/sso_continue?ticket=\u003ctoken\u003e` \n2] In `referrer` param of the following URL \n`https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/api/v1/media/██████████/file/somthine.svg?%23pranav` disallow `#hashfragments` to be included.\n3] Make the `referrer` param of the following URL \n`https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/api/v1/media/███████/file/somthine.svg?%23pranav` more specific and restricted similar to your OAuth2 adsapi.\n4] SSO login token should be one time use and should not be able to use it again and again.\n\n2. For SnapPublisher\n1] I observed you are using Google Cloud Storage, so blocking `svg` images or disallowing any uploads of `svg-xss` images will further enhance security. Otherwise, one can easily get `xss` on `storage.google`\n\n\nLet me know if you need any help. :-)\n\nRegards,\nPranav Hivarekar\n","bounty_amount":"7500.0","formatted_bounty":"$7,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":188,"voters":["wi11","theranger","kadialjohani","arm4nd0","mass0ma","obsesif","zoz_","pyrrhon","jensec","d0xing","and 178 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":11824,"asset_type":"URL","asset_identifier":"snappublisher.snapchat.com","max_severity":"high"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1978316,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-09-05T20:52:40.020Z","updated_at":"2017-09-05T20:52:40.020Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978527,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We received an earlier report about the login CSRF and a fix is on the way, hopefully ready by the end of the week. That will break that link in this attack chain.  We'll look closer at this report to see if there are other new actionable info that can help secure Snap.","automated_response":false,"created_at":"2017-09-05T22:28:40.532Z","updated_at":"2017-09-05T22:28:40.532Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978976,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update.","automated_response":false,"created_at":"2017-09-06T05:33:19.677Z","updated_at":"2017-09-06T05:33:19.677Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1986271,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The login CSRF from the other, earlier report should be fixed now and should also break the corresponding link in the attack chain here. The ticket-after-fragment bug is still pending, though arguably this has no security impact, since Javascript would just use window.location.href to get the URL (with query string values) and parse it for the ticket rather than parsing window.location.hash. There was another report on SVG issues, and I'll see if this is a duplicate of that (or by how much).","automated_response":false,"created_at":"2017-09-09T00:05:49.527Z","updated_at":"2017-09-09T00:05:49.527Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1986410,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for keeping me updated. It seems CSRF-login bug temporarily patches the attack mentioned in this report.\n\nI would like to provide more information on the flaws I chained here. My report aims to be more concentrated towards flaws in your OAuth, so I would like you to pay more attention towards it.\n\nSimple attack was to steal `SSO login token` to a third party domain and from third party domain to attacker’s domain which is not part of `*.snapchat.com`.\n\nFor example, look at the following SSO login URL which I modified ...\n`https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/api/v1/media/██████████/file/somthine.svg?%23pranav`\nHere, I am forcing the `SSO login token` to be sent to \n`https://snappublisher.snapchat.com/api/v1/media/██████/file/somthine.svg?#pranav\u0026ticket=redacted`\n\nI want to highlight that I used the SVG-xss to steal the token. This is just one way to do so. Whereas attacker can find a simple open redirector and then form an URL like `https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/myopenredirector` which will directly send the token to `open redirector` page and from there to attacker’s domain.\n\nIn my attack, I CSRF-login the victim into my account, so victim can access my svg file(https://snappublisher.snapchat.com/api/v1/media/████/file/somthine.svg) uploaded on my account. And using the svg file I am able to steal the token.\n\n\n\u003ethe ticket-after-fragment bug is still pending, though arguably this has no security impact, since Javascript would just use window.location.href to get the URL (with query string values) and parse it for the ticket rather than parsing window.location.hash.\n\n-- Here, I am redirecting the victim to `https://snappublisher.snapchat.com/api/v1/media/██████/file/somthine.svg?%23pranav` which decodes to `https://snappublisher.snapchat.com/api/v1/media/█████████/file/somthine.svg?#pranav\u0026ticket=redacted`\n\nHere, `https://snappublisher.snapchat.com/api/v1/media/██████████/file/somthine.svg?%23pranav` redirects with `307` status code to `https://storage.googleapis.com/creativesuite-prod-media/███/file?GoogleAccessId=creativesuite-prod@appspot.gserviceaccount.com\u0026Expires=1504936648\u0026Signature=███████%3D%3D\u0026response-content-disposition=inline%3Bfilename%3D%22somthine.svg%22#pranav\u0026ticket=redacted`. Please note that this is different domain that `*.snapchat.com`.\n\nSo, in order to steal `SSO login tokens` which are sent as query parameters (?ticket=something). It is nearly impossible to make browser forward query params from `snappublisher.snapchat.com` to `storage.googleapis.com`. I have used the browser’s behavior of forwarding `#hash-fragments` for `307 redirects`. So, for this URL `https://snappublisher.snapchat.com/api/v1/media/███████/file/somthine.svg?%23pranav` browser carries through the token with 307 redirect to `https://storage.googleapis.com/creativesuite-prod-media/█████/file?GoogleAccessId=creativesuite-prod@appspot.gserviceaccount.com\u0026Expires=1504936648\u0026Signature=██████%3D%3D\u0026response-content-disposition=inline%3Bfilename%3D%22somthine.svg%22#pranav\u0026ticket=redacted`  and then I am using the XSS to get the token.\n\nYou cannot get the `token` using `window.location.href` as you won’t be able to fetch the `SSO login token` to the SVG-XSS page on `storage.googleapis.com`.\n\nIn order to patch the whole OAuth flow, you will need to address all the vulnerabilities/flaws I highlighted in this report, otherwise one can again get the similar kind of account hijacking bugs using different open redirector or related flaws.\n\nSorry, for lengthy reply, but I hope I got my point through. :)\n\nRegards,\nPranav\n","automated_response":false,"created_at":"2017-09-09T05:29:12.886Z","updated_at":"2020-11-04T11:02:46.090Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1990456,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the clarification. I was thinking you were able to host XSS on the snapchat domain and extract the query parameters that way. Of course, that would be a whole additional set of problems!  We are working on cleaning up the referrer= parameter handling to properly understand/handle URL fragments, so hopefully the use of this bug with redirects will be closed soon.","automated_response":false,"created_at":"2017-09-11T21:59:19.279Z","updated_at":"2017-09-11T21:59:19.279Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1991003,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cool. Thanks for the update. Would love to check the functionality after patch.","automated_response":false,"created_at":"2017-09-12T05:54:50.745Z","updated_at":"2017-09-12T05:54:50.745Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2033009,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just wanted to know, when can I expect bounty decision on this particular bug report?","automated_response":false,"created_at":"2017-09-29T16:25:55.591Z","updated_at":"2017-09-29T16:25:55.591Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2033459,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry about the delay.  We need to get some paperwork done to transfer additional funds to H1, and that's taking longer than expected.","automated_response":false,"created_at":"2017-09-29T17:50:39.456Z","updated_at":"2017-09-29T17:50:39.456Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2035172,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem about it. I was just asking so that I know how your program operates and how bounties are paid out after triage, before fix or after fix. ","automated_response":false,"created_at":"2017-09-30T06:25:58.634Z","updated_at":"2017-09-30T06:25:58.634Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2038629,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! While some of the bugs used in the attack chain were duplicates and thus do not qualify for an award, we applaud the creativity with which they were combined with new bugs to form the attack chain and appreciate the level of clarity and detail in the report writeup. The panel has decided to award you $7500.\n\nWe appreciate your efforts - thanks, and good luck on your future bug hunting!","automated_response":false,"created_at":"2017-10-02T18:23:23.792Z","updated_at":"2017-10-02T18:23:23.792Z","actor":{"url":"/snapchat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Snapchat"}},"bounty_amount":"7500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"snapchat","collaborator":{"username":"coolboss","url":"/coolboss"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2038651,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oh, re: whether we assign awards before or after the fix, the answer is \"it depends\" :-)  If the bug is clear and the fix is understood/on the way, we can assign awards before the fix is deployed; however, sometimes we delay until the fix is completely done and tested, etc, because, as the adage goes, \"the devil is in the details\" — and the impact of the bug won't really be understood until the fix is done.\n\nAnd then, of course, there's the paperwork elephant in the room.","automated_response":false,"created_at":"2017-10-02T18:27:33.130Z","updated_at":"2017-10-02T18:27:33.130Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2038811,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Bennet,\n\nFirst of all thanks for answering all my questions. :-) \n\nSecondly, thanks for the reward. I guess there's an admin panel or some `only snap-employees` functionality on snappublisher for which I believe you raised the reward. It is higher than expected with all the duplicates filtered out from my report. \n\nI appreciate your transparency in the bug triage process and bugbounty program as a whole. Also, answering every single question that comes up. :)\n\nGlad to work with you. \n\nRegards,\nPranav Hivarekar \n\n","automated_response":false,"created_at":"2017-10-02T19:00:01.507Z","updated_at":"2017-10-02T19:00:01.507Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2063670,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @bsy ,\n\nCan you please check my other report #273615 ? I didn't receive proper response. It was closed after being triaged and reproduced withOUT proper understanding and verification of the issue. I replied back with more details but didn't receive any response yet.\n\nCan you check it out?\n\nRegards,\nPranav","automated_response":false,"created_at":"2017-10-13T10:17:36.650Z","updated_at":"2017-10-13T10:17:36.650Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2116019,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fixes for the issues discovered should have been deployed now. Could you please take a look?","automated_response":false,"created_at":"2017-10-30T23:46:51.667Z","updated_at":"2017-10-30T23:46:51.667Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2116540,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Bennet,\n\nI see you are not allowing any `#hashfragment` in the `referrer` param of SSO login URL which will forbid anyone to carry `ticket` in #hashfragment and will definitely strengthen the security all your other services which uses SSO login.\n\nOnly concern is that anyone is still able to redirect to any URL for a particular client. For example, I can still use https://accounts.snapchat.com/accounts/sso?client_id=creativesuite-prod\u0026referrer=https://snappublisher.snapchat.com/thisispage and send the `ticket` to that specific page of the app. If you are able to restrict `referrer` param to certain specific URL then it will be more secure.\n\nGiven that this bug is fixed but cannot guarantee that, other attacks may evolve until you place strict redirect URLs for the apps.\n\nRegards,\nPranav\n\n","automated_response":false,"created_at":"2017-10-31T07:00:11.260Z","updated_at":"2017-10-31T07:00:11.260Z","actor":{"username":"coolboss","cleared":true,"url":"/coolboss","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/GcQXHyfvnbR42mccVCF6Qk3s/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2138282,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"I agree that being able to have a whitelist of all allowed referrer URLs would be better. Unfortunately, the team feels that operationally the coordination would be too difficult, at least to the level needed to quickly add whitelist entries if/when new clients are needed due to new development, etc.  It's a trade-off, and we may be revisiting this decision in the future.  Thanks for your hard work, and good luck on your future bug hunting!","automated_response":false,"created_at":"2017-11-06T21:20:06.828Z","updated_at":"2017-11-06T21:20:06.828Z","actor":{"username":"bsy","cleared":false,"url":"/bsy","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"coolboss","url":"/coolboss"},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9723006,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @coolboss, thank you again for your participation in our BugBounty program!\nWould you be ok with a public disclosure of this report?","automated_response":false,"created_at":"2020-11-04T11:14:57.477Z","updated_at":"2020-11-04T11:14:57.477Z","first_to_agree":true,"actor":{"username":"apfeifer_sc","cleared":false,"url":"/apfeifer_sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9803609,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2020-11-12T15:51:49.716Z","updated_at":"2020-11-12T15:51:49.716Z","actor":{"username":"apfeifer_sc","cleared":false,"url":"/apfeifer_sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"snappublisher.snapchat.com","genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9803610,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2020-11-12T15:51:49.815Z","updated_at":"2020-11-12T15:51:49.815Z","additional_data":{"old_severity":"Critical","new_severity":"High","old_severity_id":73114,"new_severity_id":904418},"actor":{"username":"apfeifer_sc","cleared":false,"url":"/apfeifer_sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12742795,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2021-07-29T22:37:09.805Z","updated_at":"2021-07-29T22:37:09.805Z","actor":{"username":"quanyang-sc","cleared":false,"url":"/quanyang-sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":25258,"category":"team","content":"@coolboss was able to chain multiple security issues, which allowed him to extract SSO tokens from Snapchat users by sending them to a malicious website. ","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":293963,"username":"apfeifer_sc","name":"Ansgar Pfeifer","bio":"","cleared":false,"website":null,"location":"","created_at":"2018-06-18T21:45:07.172Z","url":"https://hackerone.com/apfeifer_sc","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"legacy","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","xtralarge":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}