{"id":270999,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNzA5OTk=","url":"https://hackerone.com/reports/270999","title":"[Markdown] Stored XSS via character encoding parser bypass","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-09-22T20:33:25.117Z","submitted_at":"2017-09-22T20:33:25.117Z","is_member_of_team?":false,"reporter":{"disabled":true,"username":"ysx","url":"/ysx","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-10-18T12:24:50.694Z","bug_reporter_agreed_on_going_public_at":"2017-10-18T06:15:54.370Z","team_member_agreed_on_going_public_at":"2017-10-18T12:24:50.620Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi @briann and team,\n\nA carefully crafted injection used against the Markdown input parser can be leveraged to store and execute arbitrary JavaScript on GitLab 10.0 hosts. Given the nature of this injection, which makes use of a rather esoteric filter bypass, the scope for exploitation may vary.\n\n## Proof of concept\nI have been able to exploit the following vulnerability within project Wiki pages. Consequently, prior to reproducing this issue please set up a test GitLab 10.0 instance with a Markdown-formatted project wiki. For ease of exploitation, the use of a web intercept proxy (e.g. Burp Suite) is recommended.\n\n1. Please proceed to access your Wiki, then select \"Edit\" on the homepage (or create a new Markdown page).\n\n2. Next, please activate your web intercept proxy. After doing so, enter generic text into the \"Content\" field and select the \"Save Changes\" button.\n\n3. Return to your web intercept proxy, and identify the POST request to the `wikis` endpoint. Within this request, please identify the `content ` parameter and replace this with the below payload.\n\n4. Finally, please POST the request and disable your web intercept proxy. Upon arriving on the updated Wiki page, please select the hyperlink to execute the JavaScript payload.\n\n### Markdown parser payload\n\n```\n%3Ca+href%3D%22%01java%03script%3Aconfirm%28document.domain%29%22%3EClick+to+execute%3Ca%3E%0D%0A\n```\n\n### Supporting evidence\n\n{F223200}\n\n## Verified conditions\n\nAt the time of testing, I have successfully confirmed exploitability in the following environment:\n\n* Firefox 55.0.3 stable (32-bit) on Ubuntu 16.04.3 LTS\n* Fresh GitLab 10.0.0 CE install\n\nThanks,\n\nYasin","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":223200,"file_name":"GitLab_Markdown_XSS.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/223/200/38834376c20f81a352e3a12941c603030563481d/GitLab_Markdown_XSS.png?response-content-disposition=attachment%3B%20filename%3D%22GitLab_Markdown_XSS.png%22%3B%20filename%2A%3DUTF-8%27%27GitLab_Markdown_XSS.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143506Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a5df0127bf75ad7a1abd883c11866ee2b534bc2d468b157135b758f0d0833b53","file_size":61359,"type":"image/png"}],"allow_singular_disclosure_at":"2017-11-17T06:15:54.425Z","allow_singular_disclosure_after":-123063552.10017702,"singular_disclosure_allowed":true,"vote_count":20,"voters":["sp1d3rs","michiel","bl4de","spam404","aroly","flashdisk","edoverflow","mpz","gamliel","geeknik","and 10 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2016802,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi again @ysx,\n\nAnother good find. I've verified the vulnerability and opened a confidential issue for discussion and remediation: https://gitlab.com/gitlab-org/gitlab-ce/issues/38272. That link will be opened to the public when a patch is released. As usual we'll be in touch here and feel free to contact us for more information. Thanks!","automated_response":false,"created_at":"2017-09-22T21:38:00.822Z","updated_at":"2017-09-22T21:38:00.822Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2017472,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem @briann, and thanks very much for the fast reply.","automated_response":false,"created_at":"2017-09-23T07:52:17.763Z","updated_at":"2017-09-23T07:52:17.763Z","actor":{"username":"ysx","cleared":false,"url":"/ysx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2027601,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@ysx We've got a fix implemented and it will be included in an upcoming security release. We'll keep you updated here on the timing of that.\n\nNice find, and thanks for the report!","automated_response":false,"created_at":"2017-09-27T15:15:34.993Z","updated_at":"2017-09-27T15:15:34.993Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2027625,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great to hear, thank you @rspeicher! Look forward to testing :)","automated_response":false,"created_at":"2017-09-27T15:18:25.181Z","updated_at":"2017-09-27T15:18:25.181Z","actor":{"username":"ysx","cleared":false,"url":"/ysx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2074521,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @ysx,\n\nA patch for this vulnerability has been included with our 10.0.4 security release: https://about.gitlab.com/2017/10/17/gitlab-10-dot-0-dot-4-security-release/.\n\nThanks again for another great report!","automated_response":false,"created_at":"2017-10-17T23:59:33.297Z","updated_at":"2017-10-17T23:59:33.297Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ysx","url":"/ysx"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2076032,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks very much @briann! Would it be possible to publicly disclose this report please?","automated_response":false,"created_at":"2017-10-18T06:15:54.393Z","updated_at":"2017-10-18T06:15:54.393Z","first_to_agree":true,"actor":{"username":"ysx","cleared":false,"url":"/ysx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2077877,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Sure thing.","automated_response":false,"created_at":"2017-10-18T12:24:50.652Z","updated_at":"2017-10-18T12:24:50.652Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2077878,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-10-18T12:24:50.713Z","updated_at":"2017-10-18T12:24:50.713Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":5605,"category":"researcher","content":"A carefully crafted injection could be leveraged to achieve persistent XSS. This affected all locations where the Markdown parser was deployed. The Project Wiki feature was used to present a suitable proof of concept. Thanks again to @briann and the GitLab team for the swift remediation.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":47082,"username":"ysx","name":"","bio":"","cleared":false,"website":"","location":"","created_at":"2015-12-20T12:11:13.354Z","url":"https://hackerone.com/ysx","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"legacy","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","xtralarge":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"}}}]}