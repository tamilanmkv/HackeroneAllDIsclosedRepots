{"id":300879,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDA4Nzk=","url":"https://hackerone.com/reports/300879","title":"User to Admin privilege escalation in Infrastructure Conditions - /v2/accounts/1835740/alerts/conditions","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-12-28T00:31:46.306Z","submitted_at":"2017-12-28T00:31:46.306Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"michiel","url":"/michiel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-17T03:28:02.859Z","bug_reporter_agreed_on_going_public_at":"2018-08-06T15:38:20.862Z","team_member_agreed_on_going_public_at":"2018-08-17T03:28:02.725Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Details\nThe endpoints `POST /v2/accounts/:account_id/alerts/conditions` (create new) and `PUT /v2/accounts/:account_id/alerts/conditions/:condition_id` (update existing) on `infrastructure-alert.service.newrelic.com` are vulnerable to privilege escalation.\n\nAs per the screenshot below, an account with regular User privileges is informed that only Admins can create new infrastructure alert conditions:\n\n{F249820}\n\nHowever, a regular User without special privileges can forge a request to the aforementioned endpoints to create a new alert condition or update an existing one. \n\n## Reproduction\n### Prerequisites:\n- Make sure you invite one regular user to your account and do not award ANY special permissions.\n\n{F249822}\n- Ensure you have an intercepting proxy like Burp Suite so you can easily capture the request to forge later.\n\n### Steps to reproduce\nFirst, as the admin go to https://infrastructure.newrelic.com/accounts/ACCOUNT_ID/settings/alerts and create a new alert condition. Make sure this request is captured in Burp Suite. It should be a POST request to https://infrastructure-alert.service.newrelic.com/v2/accounts/1835740/alerts/conditions.\n\nCopy this request so that it is easy for you to edit. For example, you could use the Burp Suite Repeater feature or simply use something like cURL.\n\nNow in Burp Suite, replace the cookies with those of a regular user to proof the endpoint will let a regular, unprivileged user create infrastructure condition alerts.\n\nThe forged request can be seen in Burp Suite Pro below:\n{F249821}\n(The blurred cookie is a cookie of a regular user with no special permissions.)\n\nAs a regular user it is also easy to update an infra condition alert using the same method. The only additional parameter you need to know as an attacker is the ID of the condition. But since a regular, unprivileged user has sufficient permissions to view existing conditions, they can use this method to obtain the ID of the condition they would want to forge an update request for.\n\nIn this case, the forged request will have to go to`/v2/accounts/1835740/alerts/conditions/721518` and it must be a PUT request.\n\n## Impact\n\nRegular, unprivileged users with no additional roles can create and update infrastructure condition alerts. These two actions should only be allowed by admins or users with \"Infrastructure manager\" role.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":249820,"file_name":"admin-only-feature.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/249/820/62f857d96a9f472bd745597c4ecdc5e983d11f2d/admin-only-feature.png?response-content-disposition=attachment%3B%20filename%3D%22admin-only-feature.png%22%3B%20filename%2A%3DUTF-8%27%27admin-only-feature.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144121Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=789c8a22342956205d4e2884ef997f58a47b7a5f919e2d9a7f2a49336d508976","file_size":16659,"type":"image/png"},{"id":249821,"file_name":"forged-request.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/249/821/70da5dc46b03ee36ac15bc7895036e7f58b5b1c5/forged-request.png?response-content-disposition=attachment%3B%20filename%3D%22forged-request.png%22%3B%20filename%2A%3DUTF-8%27%27forged-request.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144121Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d68737a9c4263ea9657e25641700a123bee81d5fe7b2d86af7ce085846ce042d","file_size":81243,"type":"image/png"},{"id":249822,"file_name":"no-perms.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/249/822/d70e9d6161b6bdc9574d36bf911938e9941a2f57/no-perms.png?response-content-disposition=attachment%3B%20filename%3D%22no-perms.png%22%3B%20filename%2A%3DUTF-8%27%27no-perms.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144121Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=09b9fa03cee6981136e61e45ebd49244477f93842aaca8391032c8e76c71917a","file_size":135572,"type":"image/png"}],"allow_singular_disclosure_at":"2018-09-05T15:38:20.989Z","allow_singular_disclosure_after":-97801380.96926165,"singular_disclosure_allowed":true,"vote_count":18,"voters":["spam404","ali","eveeez","apapedulimu","kunal94","naategh","khizer47","grampae","sup3r-b0y","mefkan","and 8 more..."],"severity":{"rating":"medium","score":5.4,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":4407,"asset_type":"URL","asset_identifier":"*.infrastructure.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2250961,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for submitting this.  This looks pretty good, but I am still confirming.  Having some discussions with the infrastructure team.  We added some RBAC roles recently and (many) of our public APIs are being changed to check the RBAC roles.  So there is some gap in the roles and APIs. Intuitively, one would assume that the 'Alerts Manager' role should be required for this API. The problem is that our public (documented) API for infrastructure is `https://infra-api.newrelic.com/v2`.  However, the `infrastructure-alert.service.newrelic.com` is still used and available.  \n\nGetting more information on this.  Really great write-up and find.","automated_response":false,"created_at":"2017-12-28T21:04:32.690Z","updated_at":"2017-12-28T21:04:32.690Z","actor":{"username":"nrjensen","cleared":false,"url":"/nrjensen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/048/502/de292f03830249c4d1b24742734cc80dfd4f3b8e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2251062,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We are going to look at it.  Looks like most of these are not using are RBAC model.","automated_response":false,"created_at":"2017-12-28T21:47:34.152Z","updated_at":"2017-12-28T21:47:34.152Z","actor":{"username":"nrjensen","cleared":false,"url":"/nrjensen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/048/502/de292f03830249c4d1b24742734cc80dfd4f3b8e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2251067,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-12-28T21:48:34.302Z","updated_at":"2017-12-28T21:48:34.302Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"michiel","url":"/michiel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2251075,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the fast response and the bounty @nrjensen! I guess I could go look for other endpoints using the older `/v2` API but I guess that's going to be pretty pointless since you now know the root cause and can correct any other remaining vectors using the same patch.","automated_response":false,"created_at":"2017-12-28T21:51:26.638Z","updated_at":"2017-12-28T21:51:26.638Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2308767,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We believe this issue to be resolved. Thank you for your help in keeping New Relic secure!","automated_response":false,"created_at":"2018-01-23T00:57:39.076Z","updated_at":"2018-01-23T00:57:39.076Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"michiel","url":"/michiel"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3151525,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This was originally reported when the @newrelic bug bounty program was still private. But since it's now public, would you mind public disclosure of this report? ","automated_response":false,"created_at":"2018-08-06T15:38:20.923Z","updated_at":"2018-08-06T15:38:20.923Z","first_to_agree":true,"actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3207065,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-08-17T03:28:02.780Z","updated_at":"2018-08-17T03:28:02.780Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3207066,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-08-17T03:28:02.914Z","updated_at":"2018-08-17T03:28:02.914Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}