{"id":302289,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDIyODk=","url":"https://hackerone.com/reports/302289","title":"// (double slash) inside es6 template literals interpreted as an inline comment by the auto-minifier","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-01-04T04:07:48.771Z","submitted_at":"2018-01-04T04:07:48.771Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"veggie","url":"/veggie","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41,"url":"https://hackerone.com/cloudflare","handle":"cloudflare","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Cloudflare Vulnerability Disclosure","twitter_handle":"cloudflare","website":"https://www.cloudflare.com/disclosure","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-03-17T22:32:39.419Z","bug_reporter_agreed_on_going_public_at":"2018-02-15T22:32:35.555Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The following is valid javascript:\n\n    var a = `//`;\n\nSo is this:\n\n    var url = `https://hackerone.com`;\n\nHowever, Cloudflare's auto-minifier removes the parts of both lines including and after the `//`, meaning in production, they look like this:\n\n    var a = `\n    var url = `https:\n\nThis can either straight up break or introduce sneaky bugs in production that don't show up in development (development mode turns off minification, and in local dev, this obviously doesn't happen) since those strings never get closed. There's also no way to get around this other than to stop using template literals for strings containing `//`.\n\nHere's a relatively contrived proof of concept of code that behaves differently in dev and production without any errors:\n\n    var subreddit = 'cloudflare';\n    var url = `https://www.reddit.com/r/${subreddit}`;\n    `;console.log('what is up'); // this shouldn't run! `;\n\nMinified, it becomes:\n\n    var subreddit='cloudflare';var url=`https:`;console.log('what is up');\n\nwhich prints \"what is up\" to console. It's live here: https://jli.host/cloudflare-bug/\n\n## Impact\n\nThis requires either access to the source code, or a really badly misconfigured website that dynamically builds scripts and injects user input. There's hardly a security impact, but there's definitely still a bug that's causing unintended behavior.","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-17T22:32:35.772Z","allow_singular_disclosure_after":-112637342.03864156,"singular_disclosure_allowed":true,"vote_count":7,"voters":["jokebookservice1","kapytein","bl4de","gerben_javado","edoverflow","eveeez","apapedulimu"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2261959,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for this, a ticket will be opened and I will investigate further!","automated_response":false,"created_at":"2018-01-04T15:34:55.300Z","updated_at":"2018-01-04T15:34:55.300Z","actor":{"username":"higcf","cleared":false,"url":"/higcf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/225/738/e1bf67bce170313b0984233d5f46a010718ead67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2262519,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, that's great to hear! This issue also extends to C style comments, `/* ... */` if there's a matching pair of those (from my minimal testing, you need both), meaning entire lines can disappear. For example,\n\n    var domain = 'hackerone';\n    var url = `www.${domain}.com/*`;\n    console.log(url);\n    var other_url = `www.${domain}.com/*/`;\n\nNotice the `/*` on line 2 and `*/` on line 4, which are perfectly normal looking strings that behave as you'd expect unminified. However, the entire last two lines and the `/*` on line 2 are omitted from output after minification:\n\n    var domain='hackerone';var url=`www.${domain}.com`;\n\nLive: https://jli.host/cloudflare-bug/c-style","automated_response":false,"created_at":"2018-01-04T18:34:52.509Z","updated_at":"2018-01-04T18:47:57.816Z","actor":{"username":"veggie","cleared":false,"url":"/veggie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2307970,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for submission. I have escalated your report to our engineers for review.","automated_response":false,"created_at":"2018-01-22T19:33:57.141Z","updated_at":"2018-01-22T19:33:57.141Z","actor":{"username":"higcf","cleared":false,"url":"/higcf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/225/738/e1bf67bce170313b0984233d5f46a010718ead67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2371361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just to let you know that this bug is queued up for the Engineering team so there should be a response soon.","automated_response":false,"created_at":"2018-02-10T21:06:00.089Z","updated_at":"2018-02-10T21:06:00.089Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388102,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We have pushed out a new version of the affected code. As far as we can tell from testing this bug has now been fixed and is no longer reproducable. As a result I am going to close this report.\n\nIf you find that this is not the case, please let me know and iIll re-open it.","automated_response":false,"created_at":"2018-02-15T22:19:02.585Z","updated_at":"2018-02-15T22:19:02.585Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"veggie","url":"/veggie"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388137,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks! It looks to be fixed.\n\nBy the way, is this bug eligible for that sweet t-shirt?","automated_response":false,"created_at":"2018-02-15T22:32:35.628Z","updated_at":"2018-02-15T22:32:35.628Z","first_to_agree":true,"actor":{"username":"veggie","cleared":false,"url":"/veggie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388217,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"Absolutely. Make sure you fill out your details into hackerone.","automated_response":false,"created_at":"2018-02-15T23:06:57.436Z","updated_at":"2018-02-15T23:06:57.436Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"reporter":{"username":"veggie","url":"/veggie"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2502346,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-03-17T22:32:39.460Z","updated_at":"2018-03-17T22:32:39.460Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}