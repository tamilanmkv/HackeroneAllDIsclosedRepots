{"id":304115,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDQxMTU=","url":"https://hackerone.com/reports/304115","title":"Integer Underflow @ ossl_cipher_pkcs5_keyivgen ","state":"Closed","substate":"informative","severity_rating":"none","readable_substate":"Informative","created_at":"2018-01-11T20:55:21.152Z","submitted_at":"2018-01-11T20:55:21.152Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"finb","url":"/finb","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7724,"url":"https://hackerone.com/ruby","handle":"ruby","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ruby","twitter_handle":"","website":"https://www.ruby-lang.org","about":"A Programmer's Best Friend"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-23T07:18:57.620Z","bug_reporter_agreed_on_going_public_at":"2018-01-12T13:38:42.880Z","team_member_agreed_on_going_public_at":"2018-02-23T07:18:57.553Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Integer Underflow @ ossl_cipher_pkcs5_keyivgen \nfile : ext/openssl/ossl_cipher.c\naffected parameter: iterations\n\nINFO\nGenerates and sets the key/IV based on a password.\ncall-seq:\n```\ncipher.pkcs5_keyivgen(pass, salt = nil, iterations = 2048, digest = \"MD5\") -\u003e nil\n```\n\n\nANALYSIS\niter(int) in ossl_cipher_pkcs5_keyivgen  which holds iterations value is not validated before use.\ntherefore passed on to openssl library function EVP_BytesToKey which loops over\niter(iterations) using count\n```\nfor (i = 1; i \u003c (unsigned int)count; i++) {\n  if (!EVP_DigestInit_ex(c, md, NULL))\n  [code redacted]\n]\n```\nif count aka iterations is negative this loop runs forever and therefore causing \nruby to hang and eat up memory since allocation are performed during \nthis loop and \"i\" can never be greater than count\n\nPOC\n```\nrequire 'digest'\nrequire 'openssl'\nrequire 'base64'\n\ndata = 'abc'\nkey = '1234567887654321'\niv = key[0..7]\ncipher = OpenSSL::Cipher::Cipher.new('DES-EDE3-CBC') # or any other algorithm?\n\ncipher.encrypt\ncipher.pkcs5_keyivgen(key, iv, -1)\noutput = cipher.update(data)\noutput \u003c\u003c cipher.final\n```\n\nCONFIGURATIONS\n./ruby -v\nruby 2.6.0dev (2018-01-11 trunk 61764) [x86_64-linux]\n\nopenssl version\nOpenSSL 1.0.1t  3 May 2016\n\n## Impact\n\nThis result in a DDOS Attack","weakness":{"id":16,"name":"Integer Underflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"none","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2279432,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e if count aka iterations is negative this loop runs forever and therefore causing \nruby to hang and eat up memory since allocation are performed during \nthis loop and \"i\" can never be greater than count\n\nCorrection: technically the loop does not run forever since [the variable \"i\" is declared as an \"unsigned int\"](https://github.com/openssl/openssl/blob/a41a6120cdcb7e883481bc1bed55e7157c9255c4/crypto/evp/evp_key.c#L82). Also, the memory consumption is not proportional to the iteration count.\n\nWhile it is certainly a bug that OpenSSL::Cipher#pkcs5_keyivgen accepts a non-positive number as the iteration count, this is not considered a security issue. Applications passing user input as the iteration count are vulnerable to DoS attack without this bug, by accepting a large number.","automated_response":false,"created_at":"2018-01-12T02:26:54.105Z","updated_at":"2018-01-12T02:26:54.105Z","actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2279869,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-01-12T10:35:04.007Z","updated_at":"2018-01-12T10:35:04.007Z","additional_data":{"old_severity":"Medium","new_severity":"None","old_severity_id":107297,"new_severity_id":107420},"actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2279870,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Patch: https://github.com/ruby/openssl/pull/184","automated_response":false,"created_at":"2018-01-12T10:35:13.908Z","updated_at":"2018-01-12T10:35:13.908Z","actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2280112,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem \nThanks for the quick feedback.\n\nThanks","automated_response":false,"created_at":"2018-01-12T13:37:40.982Z","updated_at":"2018-01-12T13:37:40.982Z","actor":{"username":"finb","cleared":false,"url":"/finb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2280116,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-01-12T13:38:42.914Z","updated_at":"2018-01-12T13:38:42.914Z","first_to_agree":true,"actor":{"username":"finb","cleared":false,"url":"/finb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2424146,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-02-23T07:18:57.583Z","updated_at":"2018-02-23T07:18:57.583Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/dx6z1zqthgan1c4rv9ppn4jx3832/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%222eUvHh_4_400x400.png%22%3B%20filename%2A%3DUTF-8%27%272eUvHh_4_400x400.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144155Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=32170a41cc9efd1d87a803cd9f4b4bad95d1778849b0f294a050ac0140bba444"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2424147,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-02-23T07:18:57.642Z","updated_at":"2018-02-23T07:18:57.642Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/dx6z1zqthgan1c4rv9ppn4jx3832/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%222eUvHh_4_400x400.png%22%3B%20filename%2A%3DUTF-8%27%272eUvHh_4_400x400.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144155Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=32170a41cc9efd1d87a803cd9f4b4bad95d1778849b0f294a050ac0140bba444"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}