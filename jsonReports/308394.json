{"id":308394,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDgzOTQ=","url":"https://hackerone.com/reports/308394","title":"CSRF token fixation and potential account takeover","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-01-23T21:10:54.327Z","submitted_at":"2018-01-23T21:10:54.327Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"co0nan","url":"/co0nan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":134,"url":"https://hackerone.com/khanacademy","handle":"khanacademy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Khan Academy","twitter_handle":"","website":"https://www.khanacademy.org/","about":"Start learning now. Completely free, forever."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-19T22:39:54.470Z","bug_reporter_agreed_on_going_public_at":"2018-04-19T22:39:54.383Z","team_member_agreed_on_going_public_at":"2018-04-18T23:12:44.597Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi Team,\n\n### Details:\nI have found that the csrf_token ( fkey parameter )which prevent CSRF attacks is fixed in same browser and didn't changed even user login or logout , a lot of users can use the same CSRF_token , this can be exploited such 2 ways :\n \n### Shared computers:\n- attacker open \"https://www.khanacademy.org\" and login to his account\n- attacker copied the value of \"fkey parameter\" then he will logout\n- victim will logged in his account with the same CSRF_token value (fkey parameter)\n- now attacker forced the victim to change his email address to attacker emails , since he already have the valid CSRF_token\n\n### XSS:\n- due to XSS vulnerability. Attacker knows the CSRF_token for the victim so he can use this in any actions behind the victim , for example :  change user email address   \n\nCSRF PoC to takeover user account by linked the attacker email address:\n\n```\n\u003chtml\u003e\n  \u003cbody\u003e\n    \u003cform action=\"https://www.khanacademy.org/settings/linkemail\" method=\"POST\"\u003e\n      \u003cinput type=\"hidden\" name=\"fkey\" value=\"CSRF_token\" /\u003e\n      \u003cinput type=\"hidden\" name=\"email\" value=\"[attacker-email-address]\" /\u003e\n      \u003cinput type=\"submit\" value=\"Submit request\" /\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n## Impact\n\nAs i described above this can be exploited to takeover another account\n\nLet me know if there is anything unclear","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-05-18T23:12:44.685Z","allow_singular_disclosure_after":-107278183.70064038,"singular_disclosure_allowed":true,"vote_count":8,"voters":["alyssa_herrera","generaleg","co0nan","eveeez","apapedulimu","khaledibnalwalid","4xrhd","shkhsbsbsbsbs"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2314953,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"CSRF_token which used to prevent CSRF attacks must generated randomly and new token per request","automated_response":false,"created_at":"2018-01-24T23:26:59.756Z","updated_at":"2018-01-24T23:26:59.756Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2317459,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report! I've made an issue for this in our internal tracker so we can look into doing it; it will be prioritized according to its severity and how difficult it ends up being for us to implement.\n\nIf you send me your Khan Academy account email or username I'd be happy to give you our Friendly Hacker badge.","automated_response":false,"created_at":"2018-01-25T16:38:11.254Z","updated_at":"2018-01-25T16:38:11.254Z","actor":{"username":"briangenisioka","cleared":false,"url":"/briangenisioka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2317461,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-01-25T16:38:30.414Z","updated_at":"2018-01-25T16:38:30.414Z","actor":{"username":"briangenisioka","cleared":false,"url":"/briangenisioka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2317484,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for response , it is good news :D\nhere is my email address on Khan Academy { ████ }\n","automated_response":false,"created_at":"2018-01-25T16:43:31.039Z","updated_at":"2018-04-19T22:07:40.745Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2321097,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Done.  Thank you!","automated_response":false,"created_at":"2018-01-26T15:59:32.592Z","updated_at":"2018-01-26T15:59:32.592Z","actor":{"username":"briangenisioka","cleared":false,"url":"/briangenisioka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2321106,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"is it resolved ?","automated_response":false,"created_at":"2018-01-26T16:02:23.059Z","updated_at":"2018-01-26T16:03:00.276Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2321181,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"oh , you said done about the badge :D\nThanks you.","automated_response":false,"created_at":"2018-01-26T16:27:16.416Z","updated_at":"2018-01-26T16:27:16.416Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2378802,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @briangenisioka ,\n\nAny updates ?","automated_response":false,"created_at":"2018-02-13T15:06:42.558Z","updated_at":"2018-02-13T15:06:42.558Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2379921,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello, we have this issue tracked internally and we will be sure to post here once it is resolved. Thank you for your report!","automated_response":false,"created_at":"2018-02-13T19:16:02.675Z","updated_at":"2018-02-13T19:16:02.675Z","actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2625938,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks, this should now be fixed – can you confirm? CSRF should reset on logout.\n\nbest,\nDave","automated_response":false,"created_at":"2018-04-17T20:56:08.239Z","updated_at":"2018-04-17T20:56:08.239Z","actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"co0nan","url":"/co0nan"},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2625971,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes , i can confirm this has been fixed, CSRF token expired after logout. Good job.","automated_response":false,"created_at":"2018-04-17T21:06:49.440Z","updated_at":"2018-04-17T21:06:49.440Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2625973,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you don't mind. Can we disclosure this one ?","automated_response":false,"created_at":"2018-04-17T21:07:59.235Z","updated_at":"2018-04-17T21:07:59.235Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2630717,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Sure!","automated_response":false,"created_at":"2018-04-18T23:12:44.629Z","updated_at":"2018-04-18T23:12:44.629Z","first_to_agree":true,"actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2630730,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can you delete my Email before we disclose this one ? Thanks","automated_response":false,"created_at":"2018-04-18T23:15:29.694Z","updated_at":"2018-04-18T23:16:31.144Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2639379,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My email address above. can you just delete it from the report ?","automated_response":false,"created_at":"2018-04-19T21:11:06.559Z","updated_at":"2018-04-19T21:11:06.559Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2639480,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Done! Thanks again for the report.\n\nDave","automated_response":false,"created_at":"2018-04-19T22:08:06.962Z","updated_at":"2018-04-19T22:08:06.962Z","actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2639566,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-19T22:39:54.415Z","updated_at":"2018-04-19T22:39:54.415Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2639567,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-04-19T22:39:54.498Z","updated_at":"2018-04-19T22:39:54.498Z","actor":{"username":"co0nan","cleared":false,"url":"/co0nan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/3y7LBR7dbTNeKHgXjKDPJzGL/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}