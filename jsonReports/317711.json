{"id":317711,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTc3MTE=","url":"https://hackerone.com/reports/317711","title":"twofactor_auth bypassable if provider fails to load","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-02-20T01:00:10.407Z","submitted_at":"2018-02-20T01:00:10.407Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cyphar","url":"/cyphar","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2018-16465"],"singular_disclosure_disabled":false,"disclosed_at":"2018-09-27T10:10:19.480Z","bug_reporter_agreed_on_going_public_at":"2018-09-27T10:10:19.418Z","team_member_agreed_on_going_public_at":"2018-09-25T10:12:49.042Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"(Just want to preface this by saying that this is probably not a significant\nvulnerability, as it requires that the server either have recently been\nincorrectly upgraded or otherwise misconfigured. However in the administration\nof my own personal NextCloud instance I have hit this several times.)\n\nThis is a general trait of 2FA provider failures. If you enable 2FA for any\ngiven user on NextCloud, and the 2FA provider fails to by enabled for whatever\nreason (such as an upgrade which made the 2FA provider incompatible, or the 2FA\nprovider source code was removed or corrupted somehow) then 2FA will be\nbypassable for all accounts on the system.\n\nWhile this may not seem like a significant issue, since twofactor_auth\nproviders are not part of the main NextCloud server source, upgrading the main\nserver (either through the official updater app, or manually) will result in\ntwofactor_auth being disabled if the provider has not been updated. Thus there\nis a window around upgrading the NextCloud server where an attacker can bypass\n2FA.\n\nUltimately the solution to this problem would be to *always* require 2FA if 2FA\nhas been enabled, and if a provider is not available you must require that the\nuser enter one of their backup codes. I'm not sure how backup codes are\ncurrently implemented, but if they're implemented in the server (rather than\nindividually by each 2FA provider) this should not be overly complicated to\nimplement.\n\nI have only tested this with the TOTP 2FA provider, but I would be surprised if\nit didn't affect all 2FA providers.\n\n## Impact\n\nAttackers being able to bypass 2FA means that keyloggers or other tools could\nbe used to steal the users' passphrase, and then the attacker could gain access\nwhile the user would expect the attacker to require access to their 2FA token.","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-10-25T10:12:49.165Z","allow_singular_disclosure_after":-93501105.75286327,"singular_disclosure_allowed":true,"vote_count":8,"voters":["ali","eveeez","japz","cryptographer","unknowed21","ricky__99","rayhanuddinakhand","jatacheers"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2405651,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2018-02-20T01:00:10.782Z","updated_at":"2018-02-20T01:00:10.782Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2407098,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-02-20T10:51:23.012Z","updated_at":"2018-02-20T10:51:23.012Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2672235,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates? With the latest update (13.0.2) this problem still persists (I just did the upgrade and hit the same issue, and verified after I fixed up the `twofactor_totp` install by disabling it and noticing that TOTP wasn't required on my next logins). However the addition of `twofactor_backupcodes` in the core project appears to indicate that the plan is to require usage of a backup code if no other `twofactor_*` authenticator is loaded (which is what I recommended)? It appears that this still doesn't work though.","automated_response":false,"created_at":"2018-04-27T11:27:15.351Z","updated_at":"2018-04-27T11:27:36.620Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2753176,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nWe have verified the issue. Right now our 2FA code is pretty stateless. But this indeed means that if there are no 2FA providers we fall back to nothing. We are discussing internally how to best solve this and how to migrate existing setups. We'll get back to you.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-05-16T19:43:23.602Z","updated_at":"2018-05-16T19:43:23.602Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2808516,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nTo keep you updated. We are working on a fix that should make this more robust.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-05-29T07:35:40.843Z","updated_at":"2018-05-29T07:35:40.843Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2938027,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $50.\n\nThanks a lot for making the internet a safer place and keep hacking. Please keep in mind that we didn't patch the vulnerability yet, so please do not share this information with any third-parties.","automated_response":false,"created_at":"2018-06-26T20:25:53.685Z","updated_at":"2018-06-26T20:25:53.685Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"cyphar","url":"/cyphar"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2941892,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved and will be released in Nextcloud 14. We are working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)","automated_response":false,"created_at":"2018-06-27T18:08:18.424Z","updated_at":"2018-06-27T18:08:18.424Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"cyphar","url":"/cyphar"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2943058,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Name: Aleksa Sarai\nEmail Address: cyphar@cyphar.com\nWebsite: https://www.cyphar.com/\nCompany: SUSE Linux GmbH\n\nThanks.","automated_response":false,"created_at":"2018-06-28T00:19:54.257Z","updated_at":"2018-06-28T00:20:14.994Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2943062,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"(Obviously I don't expect it to be public before Nextcloud 14 is shipped.)","automated_response":false,"created_at":"2018-06-28T00:20:37.413Z","updated_at":"2018-06-28T00:20:37.413Z","first_to_agree":true,"actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2943745,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We will disclose this publicly once NC14 has been released for a few weeks.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-06-28T05:49:39.264Z","updated_at":"2018-06-28T05:49:39.264Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3095261,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","automated_response":false,"created_at":"2018-07-25T05:48:34.298Z","updated_at":"2018-07-25T05:48:34.298Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3095263,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nI opened and closed again so the report is not disclosed in a week.\nI'll make sure to disclose once 14 is out for a few weeks.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-07-25T05:49:33.512Z","updated_at":"2018-07-25T05:49:33.512Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"cyphar","url":"/cyphar"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3099354,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cheers.","automated_response":false,"created_at":"2018-07-25T23:10:50.607Z","updated_at":"2018-07-25T23:11:05.776Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3384435,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-09-25T10:12:49.061Z","updated_at":"2018-09-25T10:12:49.061Z","first_to_agree":true,"actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3396291,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-09-27T10:10:19.445Z","updated_at":"2018-09-27T10:10:19.445Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3396292,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-09-27T10:10:19.500Z","updated_at":"2018-09-27T10:10:19.500Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3583779,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is still a problem -- I just upgraded to 14.0.3 and I can still bypass two factor in the same manner. I just ran `./occ upgrade`.\nIn addition, I looked and I couldn't find the disclosure on https://nextcloud.com/security/advisories/ -- am I looking in the wrong place?","automated_response":false,"created_at":"2018-11-04T12:02:39.222Z","updated_at":"2018-11-04T12:04:49.808Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3583833,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Did you upgrade from 13 to 14.0.3?\nBecause pre 14 we did not keep state. So the state needs to be populated. Which happens once you login with the providers enabled on 14 the first time.","automated_response":false,"created_at":"2018-11-04T12:05:16.680Z","updated_at":"2018-11-04T12:05:16.680Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3583951,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, okay -- yeah, I upgraded from 13.x. (I haven't gotten the providers enabled yet, I've had some other upgrade issues but that's a different topic).","automated_response":false,"created_at":"2018-11-04T12:12:40.600Z","updated_at":"2018-11-04T12:12:40.600Z","actor":{"username":"cyphar","cleared":false,"url":"/cyphar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/917/bd74a4522430f83679b11339078e5fd280c98481_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}