{"id":341925,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDE5MjU=","url":"https://hackerone.com/reports/341925","title":"invalid handling of redirect_uri at o2.mail.ru/jsapi/button","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2018-04-23T06:59:52.847Z","submitted_at":"2018-04-23T06:59:52.847Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"chaosbolt","url":"/chaosbolt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-05-22T15:10:08.293Z","bug_reporter_agreed_on_going_public_at":"2018-05-04T02:23:44.749Z","team_member_agreed_on_going_public_at":"2018-05-22T15:10:08.163Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"o2.mail.ru/jsapi/button gets embedded as login window in website that using o2 oauth. parameter redirect_uri by default may have either value of white listed domain from particular app by clientId either it may lead to *.mail.ru, then it contacts with parent window via postmessages. Other domains as value of redirect_uri resulting 403. The way /jsapi/button counts *.mail.ru as a whitelisted domain for redirect_uri is dangerous because it may be used bypass 403 to other domains like in this example:\n\nredirect_uri=evil.com?a=.mail.ru , then button will send postmessages to evil.com with **any client Id**\n\nDomain, site, application\n--\no2.mail.ru/jsapi/button\n\nSteps to reproduce\n--\n1. \u003ciframe src=\"https://o2.mail.ru/jsapi/button?client_id=de6cefc49cbc44eea5a5a65e8de15b88\u0026redirect_uri=https://notmail.com?a=.mail.ru\u0026ui=login_as%20userpic\"\u003e \n2. replace client_id for id of your application\n\nActual results\n--\nPostMessages will be sent to attacker controlled domain. Currently there is only info may be stolen about is victim logged in for specific client id or not, but if you will extend button possibilities in future this may cause a risk for oauth implementation.\n\nExpected results, security impact description and recommendations\n--\nvalidate subdomain part for \"?\" \"#\" \"@\" and other url confusing symbols when redirect uri is pointing to mail.ru subdomain\n\nPoC, exploit code, screenshots, video, references, additional resources\n--\n\u003ciframe src=\"https://o2.mail.ru/jsapi/button?client_id=de6cefc49cbc44eea5a5a65e8de15b88\u0026redirect_uri=https://notmail.com?a=.mail.ru\u0026ui=login_as%20userpic\"\u003e\n\n## Impact\n\nbypass redirect_uri whitelist of /jsapi/button","bounty_amount":"150.0","formatted_bounty":"$150","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-06-03T02:23:44.847Z","allow_singular_disclosure_after":-105971063.77538103,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","whitesector","c37hun","japz","testinghacker0x01"],"structured_scope":{"databaseId":255,"asset_type":"URL","asset_identifier":"o2.mail.ru","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2653061,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\nWe are currently reviewing your submission and will be back in touch soon.","automated_response":false,"created_at":"2018-04-23T11:05:08.375Z","updated_at":"2018-04-23T11:05:08.375Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2664388,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Привет, вознаграждение за найденную уязвимость начислено на твой аккаунт. На странице https://hackerone.com/settings/bounties можно выбрать желаемый метод выплаты. \n\nСпасибо и ждем от тебя новых багрепортов!\n\nP.S. работа по устранению уязвимости пока продолжается.","automated_response":false,"created_at":"2018-04-25T15:19:25.459Z","updated_at":"2018-04-25T15:19:25.459Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Mail.ru"}},"bounty_amount":"150.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"chaosbolt","url":"/chaosbolt"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2672300,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This bug has been fixed! \nPlease confirm that you are no longer able to reproduce the issue. ","automated_response":false,"created_at":"2018-04-27T11:55:40.194Z","updated_at":"2018-04-27T11:55:40.194Z","actor":{"username":"yngwie","cleared":false,"url":"/yngwie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/185/1b6bf6046f42c100e3793d87a8410bc07178fa8f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"chaosbolt","url":"/chaosbolt"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2672343,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Fixed.","automated_response":false,"created_at":"2018-04-27T12:19:56.735Z","updated_at":"2018-04-27T12:19:56.735Z","actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2698346,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-05-04T02:23:44.791Z","updated_at":"2018-05-04T02:23:44.791Z","first_to_agree":true,"actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2779265,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-05-22T15:10:08.198Z","updated_at":"2018-05-22T15:10:08.198Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2779266,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-05-22T15:10:08.326Z","updated_at":"2018-05-22T15:10:08.326Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":7596,"category":"researcher","content":"It was possible to embed login button on site that is not whitelisted for a specific app the button was created for. Problem was caused because button had *.mail.ru as whitelisted domain, playing around this I found out that \"example.com/?a=.mail.ru\" was actually valid value for parameter and button getting successfully embeded resulting in postMessage steal / login to external app on attacker's website, revealing some user information.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":191587,"username":"chaosbolt","name":"1","bio":"","cleared":true,"website":null,"location":"","created_at":"2017-08-14T03:46:53.007Z","url":"https://hackerone.com/chaosbolt","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}