{"id":363680,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjM2ODA=","url":"https://hackerone.com/reports/363680","title":"Constant-time comparison is not always implemented; critical areas are vulnerable to key-timing attacks","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-06-09T08:51:57.047Z","submitted_at":"2018-06-09T08:51:57.047Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"anonimal","url":"/anonimal","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7731,"url":"https://hackerone.com/monero","handle":"monero","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Monero","twitter_handle":"monero","website":"https://getmonero.org","about":" Monero: the secure, private, untraceable cryptocurrency"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-06T15:13:53.417Z","bug_reporter_agreed_on_going_public_at":"2018-07-27T10:55:40.203Z","team_member_agreed_on_going_public_at":"2018-08-06T15:13:53.306Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"In my most superficial of reviews, constant-time comparison appears to not be globally implemented (at a glance, only implemented within the ref10 implementation).\n\nWith that said, the following areas either appear to be vulnerable, or are potentially vulnerable, to key-timing attacks:\n\n1. Containers used for RingCT (in particular, the key struct) as deployed throughout RingCT\n2. The definition and implementations of `CRYPTO_MAKE_COMPARABLE`\n3. `equalKeys` in rctOps.cpp, whose comparison speed appears to be relative to its available hardware\n\nFor points 1 and 2, as a steadfast rule; do **NOT** use `memcmp` when comparing cryptographic secrets (or any cryptographic material for that matter). For point 3, be careful with conditional branches which can be optimized or subject to speculative execution. One possible fix for point 3 is to perform an XOR of all the bytes in both buffers, and then compare the result (see kovri below).\n\nAs the literature states, key timing vulnerabilities can range from somewhat-trivial to extremely-difficult to exploit. For this report, I cannot assess a difficulty. For an active attack, monero has a very simple yet friendly network layer which I *imagine* could make remote execution *somewhat* easier (depending on the context and application) but, I don't have PoC. Now, at the local level for, let's say, a malicious node that wants to forge X before sending to the next peer, the results could be easier to attain (again, no PoC).\n\nThis was only the most superficial of reviews - so please forgive any assumptions or inaccuracies on my part. If I had more time with this issue, I would love to look deeper in order to provide a more details and to assert a monero PoC. Unfortunately, I am too busy with kovri - but I hope that this report will at least raises awareness.\n\nMitigation:\n\n- Use a function which provides constant-time comparison. For example, [kovri has a crypto++ solution](https://github.com/monero-project/kovri/issues/895) at its disposal.\n\n## Impact\n\nAt first glance, a forged RingCT signature - but the extent of the problem could be possibly extended to other areas (to be determined).","weakness":{"id":39,"name":"Missing Required Cryptographic Step"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-08-26T10:55:40.318Z","allow_singular_disclosure_after":-98682937.04541734,"singular_disclosure_allowed":true,"vote_count":6,"voters":["ali","apapedulimu","cryptographer","anomalroil","misspan","jrballi"],"severity":{"rating":"critical","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2871540,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-06-11T22:10:39.429Z","updated_at":"2018-06-11T22:10:39.429Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2900446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"There's a patch in https://github.com/monero-project/monero/pull/3999, though it's a bit overeager maybe, I'm not sure checking all these types is really required. It might also have non negligible effect on performance. Additionally, performance tests don't show much effect in comparing equal or unequal-on-every-byte keys with memcmp.","automated_response":false,"created_at":"2018-06-18T10:05:35.830Z","updated_at":"2018-06-18T10:05:35.830Z","actor":{"username":"moneromooo","cleared":false,"url":"/moneromooo","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2926277,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003eAdditionally, performance tests don't show much effect in comparing equal or unequal-on-every-byte keys with memcmp\n\nThe environment may need to be specialized, meaning something that wouldn't be detected with either the current performance tests or with the hardware that you are using with said tests. I don't know, TBD.\n\nEither way, thanks for patching.","automated_response":false,"created_at":"2018-06-23T23:54:06.258Z","updated_at":"2018-06-23T23:54:06.258Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3105121,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This has been resolved in https://github.com/monero-project/monero/pull/3999.\n\nConsidering my position, I'm opting out of receiving any bounty payout. May the bounty fund live long and prosper.","automated_response":false,"created_at":"2018-07-27T10:55:27.658Z","updated_at":"2018-07-27T10:55:27.658Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"anonimal","url":"/anonimal"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3105122,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-07-27T10:55:40.247Z","updated_at":"2018-07-27T10:55:40.247Z","first_to_agree":true,"actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3151411,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Setting to disclosed as as requested.","automated_response":false,"created_at":"2018-08-06T15:13:53.334Z","updated_at":"2018-08-06T15:13:53.334Z","actor":{"username":"moneromooo","cleared":false,"url":"/moneromooo","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3151412,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-08-06T15:13:53.445Z","updated_at":"2018-08-06T15:13:53.445Z","actor":{"username":"moneromooo","cleared":false,"url":"/moneromooo","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}