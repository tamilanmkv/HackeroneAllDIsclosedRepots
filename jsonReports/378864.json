{"id":378864,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzg4NjQ=","url":"https://hackerone.com/reports/378864","title":"Torrent extension: Cross-origin downloading + \"URL spoofing\" + CSP-blocked XSS","state":"Closed","substate":"duplicate","severity_rating":"medium","readable_substate":"Duplicate","created_at":"2018-07-07T14:50:05.579Z","submitted_at":"2018-07-07T14:50:05.579Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"metnew","url":"/metnew","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/038/544/baa5f77ccb2413a76bf96b3253ba88024ab50a33_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15688,"url":"https://hackerone.com/brave","handle":"brave","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/688/2aad5641af643ee4f4402896e4747293f6e9c5ca_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/688/2aad5641af643ee4f4402896e4747293f6e9c5ca_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Brave Software","twitter_handle":"brave","website":"https://brave.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-09-24T23:40:38.734Z","bug_reporter_agreed_on_going_public_at":"2018-09-19T16:20:30.341Z","team_member_agreed_on_going_public_at":"2018-09-24T23:40:38.607Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n\n\u003e \\#378809 allows navigating to `chrome-extension://`\n\u003e \\#378805 allows displaying alert windows on `chrome-extension://` origin\n\nAs I said in #378809, navigation to `chrome-extension://` allows attacking dependencies/components of extensions.\n\nBrave has only 3 extensions installed by default (w\\o Metamask):\n- Brave Sync - according to my observations, it doesn't have vulnerable components\n- PDF\n- Torrent\n\n### Torrent\n\n#### \"Save Torrent File...\"\n\nWe need alert modal from #378805 to ask a user to click \"Save Torrent File\" button.\n\"Save Torrent File\" initiates navigation using `a [rel=noopener] [download]` to `location.hash.slice(1)`\n\n#### `http://www.google.com` - \"URL spoofing\"\n\nOmnibox in Torrent extension displays only `location.hash.slice(1)`. Hence, `chrome-extension://fmdpfempfmekjkcfdehndghogpnpjeno/webtorrent.html#https://www.google.com` will be shown in the address bar as `https://www.google.com`. \n\u003e In reality, it's hard to leverage this bug, but that looks like bad behavior. \n\n#### `http://www.google.com` - websites downloading\n\nAs I said, \"Save Torrent File\" initiates downloading. CORS page downloads are forbidden.\nHowever, click on \"Save Torrent File\" in `chrome-extension://fmdpfempfmekjkcfdehndghogpnpjeno/webtorrent.html#https://www.google.com` downloads `www.google.com`.\n \n\u003e Because of Torrent extension privileges\n\n#### `file:///etc/passwd` - local files downloading\n\n**URL:** `chrome-extension://fmdpfempfmekjkcfdehndghogpnpjeno/webtorrent.html#file:///etc/passwd`\n\nClick on \"Save Torrent File\" initiates downloading of local files.\nSame \"useless URL spoofing\". (`file://etc/passwd` in omnibox)\n\n#### `ssh://`\n\nTorrent can't trigger ssh sessions without confirmation (like privileged `about:blank`). Not interesting.\n\n#### `javascript:` - CSP-blocked XSS\n\nThe most interesting case. \n**URL:** `chrome-extension://fmdpfempfmekjkcfdehndghogpnpjeno/webtorrent.html#javascript:alert()`\nAs of `a` element initiates navigation, it's possible navigating to `javascript:` URI to initiate code execution.\nUnfortunately, this XSS is blocked by CSP :(\n\n## Products affected: \n\nBrave: 0.23.31 \nV8: 6.7.288.46 \nrev: 3148acef36dba0fce89108638bb27927c4937f90 \nMuon: 7.1.5 \nOS Release: 17.6.0 \nUpdate Channel: Release \nOS Architecture: x64 \nOS Platform: macOS \nNode.js: 7.9.0 \nBrave Sync: v1.4.2 \nlibchromiumcontent: 67.0.3396.103\n\n## Steps To Reproduce:\n\n1. Start ftp server (sample ftp server attached, `npm i ftpd \u0026\u0026 node ftp-server.js`)\n2. Open ftp://localhost:7002/exploit.html\n\n## Impact\n\nAn attacker could init an alert modal to trick the user into pressing \"Save Torrent file\" button using #378805.\n\nIt's possible to download local files and files from the web (websites too) using \"Save Torrent file\" in Torrent extension (requires user gesture).\n\nIt's also possible to initiate CSP-blocked XSS by clicking on \"Save Torrent File\".","original_report_id":378805,"original_report_url":"https://hackerone.com/reports/378805","attachments":[{"id":316851,"file_name":"ftp-server.js","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/316/851/1b57af3bce15953c31b9e9c6d89532c6ee5ac2a4/ftp-server.js?response-content-disposition=attachment%3B%20filename%3D%22ftp-server.js%22%3B%20filename%2A%3DUTF-8%27%27ftp-server.js\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145251Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8feffc424982dac2be9e54dc6bb1c6a923025093bb811a47617b84108659fd1d","file_size":1321,"type":"text/plain"},{"id":316852,"file_name":"exploit.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/316/852/75dd6a9b63f7aa0c8c196f6eb09a8620d253c151/exploit.html?response-content-disposition=attachment%3B%20filename%3D%22exploit.html%22%3B%20filename%2A%3DUTF-8%27%27exploit.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145251Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=293408333046b93ec6d667c1b1e664818be6ac7afd31687b8c715e99746c1708","file_size":647,"type":"text/html"}],"allow_singular_disclosure_at":null,"vote_count":12,"voters":["foobar7","dawgyg","bl4de","sameerphad72","ali","eveeez","an0nym0us","japz","cryptographer","0x08","and 2 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":7933,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/brave/browser-laptop","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3024443,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @metnew,\n\nThanks for your submission. We are currently reviewing your report and will get back to you once we have additional information to share.\n\nKind regards,\n@tescoramen ","automated_response":false,"created_at":"2018-07-10T12:24:11.276Z","updated_at":"2018-07-10T12:24:11.276Z","actor":{"username":"tescoramen","cleared":false,"url":"/tescoramen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/244/189/f2b53e3efa1954fe7559ee89019c00b13eb29c5b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3080225,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Hi,\n\nWe have decided that the root cause of this behaviour is the same as #378805 so we will be merging these two reports.\n\nBest regards,\n@thefrog\n\nSecurity Analyst\n**HackerOne**","automated_response":false,"created_at":"2018-07-21T20:12:25.583Z","updated_at":"2018-07-21T20:12:25.583Z","original_report_id":378805,"actor":{"username":"thefrog","cleared":false,"url":"/thefrog","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/246/015/2eead02646771af4df7aa20c21edb7d5dc99d3da_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3080470,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@thefrog @tescoramen \n1. That's a completely different component (#378805 - brave/muon repo, this report - torrent extension in brave/brave-laptop).\n2. This report only leverages `ftp-\u003echrome-extension` navigation. However, the actual problem lays in torrent extension. Loading a maliciously crafted url(e.g., by copy-pasting to address bar) leads to described above problems.\n\nI think that marking this report as duplicate is incorrect.","automated_response":false,"created_at":"2018-07-21T23:01:24.409Z","updated_at":"2018-07-21T23:01:24.409Z","actor":{"username":"metnew","cleared":true,"url":"/metnew","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/544/baa5f77ccb2413a76bf96b3253ba88024ab50a33_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3359074,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-09-19T16:20:30.385Z","updated_at":"2018-09-19T16:20:30.385Z","first_to_agree":true,"actor":{"username":"metnew","cleared":true,"url":"/metnew","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/544/baa5f77ccb2413a76bf96b3253ba88024ab50a33_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3382947,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-09-24T23:40:38.645Z","updated_at":"2018-09-24T23:40:38.645Z","actor":{"username":"toml","cleared":false,"url":"/toml","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/717/56ea9edd04176aa3f29b215291bbc0b656699f67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3382948,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-09-24T23:40:38.769Z","updated_at":"2018-09-24T23:40:38.769Z","actor":{"username":"toml","cleared":false,"url":"/toml","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/717/56ea9edd04176aa3f29b215291bbc0b656699f67_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"brave","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}