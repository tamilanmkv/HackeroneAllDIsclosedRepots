{"id":423073,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjMwNzM=","url":"https://hackerone.com/reports/423073","title":"Improper UUID validation results in bypass of #419896","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-12T19:18:06.645Z","submitted_at":"2018-10-12T19:18:06.645Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"popeax","url":"/popeax","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/062/350/7af44ed51419e756a0f92b59a8f66ae3285cf890_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-10-25T22:38:41.919Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-10-25T22:38:35.207Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This was found while evaluating the vulnerability and patch identified in #419896.  I determined the deployed patch to be effective.  However, I noticed tracer values could be sent which didn't conform to the UUID specification as characters outside of the a-f and 0-9 ranges could be used.  For example, a value such as \"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzzzz\" was accepted by the server as valid.  Likely this indicates a problem with a regex filter that needs to be slightly changed.  \n\nSteps\n1. Navigate to a program which allows anonymous submissions.\n2. Open the report submission form and add an attachment.\n3. Observe the request sent to /attachments includes a client side generated UUID in the tracer field.\n4. Replay the request from step 3.  Use an invalid UUID (e.g. \"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzzzz\") for the tracer and observe the server accepts the value.\n\n## Impact\n\nThe impact is unknown, but it is believed to have a cascading side effect.  I was asked to submit this by @jobert.","bounty_amount":"7500.0","formatted_bounty":"$7,500","weakness":{"id":107,"name":"Improper Input Validation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-11-24T22:38:35.307Z","allow_singular_disclosure_after":-90865214.888877,"singular_disclosure_allowed":true,"vote_count":77,"voters":["jokebookservice1","arneswinnen","sp1d3rs","europa","bogdantcaciuc","sameerphad72","spam404","leetboi","mik317","flashdisk","and 67 more..."],"severity":{"rating":"high","score":7.7,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":3,"asset_type":"URL","asset_identifier":"https://hackerone.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3472481,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2018-10-12T19:19:10.998Z","updated_at":"2018-10-12T19:19:10.998Z","additional_data":{"old_title":"Invalid tracer value","new_title":"Invalid UUID tracer value"},"actor":{"username":"popeax","cleared":true,"url":"/popeax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/062/350/7af44ed51419e756a0f92b59a8f66ae3285cf890_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3533787,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-10-25T17:21:21.197Z","updated_at":"2018-10-25T17:21:21.197Z","additional_data":{"old_severity":"Medium (6.1)","new_severity":"High (7.7)","old_severity_id":223676,"new_severity_id":229277},"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3533791,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2018-10-25T17:22:02.733Z","updated_at":"2018-10-25T17:22:02.733Z","additional_data":{"old_title":"Invalid UUID tracer value","new_title":"Improper UUID validation results in bypass of #419896"},"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3533851,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @popeax - thanks for submitting this to us and your patience with us. After you completed the retest for #419896 we realized that your comment was actually a bypass for the original fix. Because of the input validation we used for the other endpoint we determined that this had something to do with the way the null bytes were (incorrectly) interpreted. However, when we looked into another endpoint that was vulnerable to the same issue, we determined that this was not the case. Here's a technical writeup what happened exactly and why your comment bypassed the fix.\n\nConsider the following controller method:\n\n```ruby\ndef some_method\n  return unless params[:something].present?\n\n  SomeObject.where something: params[:something]\nend\n```\n\nThe `SomeObject` model is implemented as the code shown below. Notice that the `something` column is of type `uuid`.\n\n```ruby\nclass SomeObject \u003c ApplicationRecord\nend\n\n# == Schema Information\n#\n# Table name: some_objects\n#\n#  id                        :integer          not null, primary key\n#  something                 :uuid\n```\n\nAt first sight, it seems that there's no way the `where` method call would ever execute the following query due to the `present?` check:\n\n```sql\nSELECT some_objects.* FROM some_objects WHERE something IS NULL\n```\n\nIt turns out that `uuid` columns behaves different from a `text`, `int`, or `varchar` column. ActiveRecord determines whether the user input is actually a valid UUID format. In case it isn't, it'll coerce the input to nil, which causes the constructed query to execute an `IS NULL` query instead of an exact text match on the given value.\n\nHere's a copy from a Rails console to show this behavior:\n\n```\n[1] pry(main)\u003e SomeObject.where(something: \"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaaaa\").to_sql\n=\u003e \"SELECT \\\"some_objects\\\".* FROM \\\"some_objects\\\" WHERE \\\"some_objects\\\".\\\"something\\\" = 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaaaa'\"\n[2] pry(main)\u003e SomeObject.where(something: \"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzzzz\").to_sql\n=\u003e \"SELECT \\\"some_objects\\\".* FROM \\\"some_objects\\\" WHERE \\\"some_objects\\\".\\\"something\\\" IS NULL\"\n```\n\nThis was rather unexpected. The regular expression that we implemented matched on `a-z0-9` instead of `a-f0-9`, so an attacker could've picked any valid UUID and changed a single character to a `z` to fool the input validation, invalidate the UUID, and then execute the `IS NULL` query.\n\nAll in all, this was a valid bypass for the original security vulnerability, which is why we'll be awarding you with a $7,500 bounty. Thanks for your thorough review of the security fix, it's much appreciated!","automated_response":false,"created_at":"2018-10-25T17:23:54.106Z","updated_at":"2018-10-25T17:23:54.106Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"popeax","url":"/popeax"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3533852,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2018-10-25T17:24:21.332Z","updated_at":"2018-10-25T17:24:21.332Z","additional_data":{"added_weaknesses":[{"id":107,"name":"Improper Input Validation"}],"removed_weaknesses":[{"id":65,"name":"Business Logic Errors"}]},"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3535824,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-10-25T22:38:15.090Z","updated_at":"2018-10-25T22:38:15.090Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"bounty_amount":"7500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"popeax","url":"/popeax"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3535825,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-10-25T22:38:35.229Z","updated_at":"2018-10-25T22:38:35.229Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3535826,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2018-10-25T22:38:41.883Z","updated_at":"2018-10-25T22:38:41.883Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}