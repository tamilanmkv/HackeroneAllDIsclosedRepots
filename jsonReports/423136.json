{"id":423136,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjMxMzY=","url":"https://hackerone.com/reports/423136","title":"H1514 Session Fixation on multiple shopify-built apps on *.shopifycloud.com and *.shopifyapps.com","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2018-10-12T21:39:08.264Z","submitted_at":"2018-10-12T21:39:08.264Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-04-25T02:39:59.145Z","bug_reporter_agreed_on_going_public_at":"2019-04-25T02:39:59.072Z","team_member_agreed_on_going_public_at":"2019-04-24T20:50:03.622Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi team!,\n\nI'm reporting a Session Fixation issue on multiple shopify-built apps hosted on *.shopifycloud.com and *.shopifyapps.com. Normally Session Fixation is boring but I discovered a way to simply use by-design XSS to authenticate as a user on those affected apps.\n\n#Details\nAs the policy pointed out XSS on *.shopifycloud.com and *.shopifyapps.com are N/A. That means finding XSS on them should be fairly trivial. Anyway after the XSS on embedded SDK I started to think what I can do with it. I played around some other shopify-built apps and discovered that some of them use signed session and the other use session id. Looking further I realized some which use session id do not generate a new session id after logging in. They are basically assigning the login status in whatever session id you provide in the cookie header. A straight-out Session Fixation. For example, in Shopify Flow, when you hit the index page, a `_flow_session` cookie is assigned. When you log in (/auth/callback), the session doesn't change. As an attacker, if I can write my session id cookie to your browser and you log in, I can use the session id to authenticate as you.\n\nSo the attack goes like this:\n1. Attacker goes to Shopify Flow and copies the session id it generates\n2. Attacker uses XSS on *.shopifycloud.com and writes the cookie scoped to all subdomain to victim `document.cookie='_flow_session=EVIL;domain=.shopifycloud.com;path=/';`\n3. Attacker forces victim to log into Shopify Flow (i.e. https://www.shopify.com/admin/apps/flow which redirects to VICTIM_STORE.shopify.com/admin/apps/flow which triggers the login flow)\n4. Attacker can now use the session to authenticate as victim\n\n#Steps to Reproduce\n1. Be logged into your store as an admin and have Shopify Flow installed\n2. Navigate to https://poorvictim.myshopify.com/products/canvas\n3. After a while it should redirect to the Shopify Flow page\n4. (Attacker) Use another browser, go to https://flow.shopifycloud.com/robots.txt and run this code in console `document.cookie='_flow_session=7b2f6c606fab4186d7be385aa66d53d9'`\n5. (Attacker) Navigate to https://flow.shopifycloud.com/?shop=YOUR_STORE.myshopify.com and you should see your (Victim) data for a split second (you are supposed to use this in iframe) (Remember to change the YOUR_STORE in the URL)\n\n## Impact\n\nAn attacker can authenticate as the victim.\n\nI have found Session Fixation on the following apps:\n* Shopify Flow\n* Transporter \n* Launchpad\n\nThere are probably some others I haven't tested or forgotten. Let me know if you want me to list them all.\n\nI'm also looking if there's some subdomains on *.shopify.com that suffer from it.","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":47,"name":"Session Fixation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":136,"voters":["samengmg","msultan","battle_angel","yxw21","vavkamil","drsniper","hunter","base_64","bogdantcaciuc","ninetynine","and 126 more..."],"structured_scope":{"databaseId":37198,"asset_type":"OTHER","asset_identifier":"Shopify Developed Apps","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3475150,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I took the liberty to check some more apps affected:\n* Order Printer\n* Instagram\n* Facebook Commence \n* Facebook Ads\n\nOnly midway through.","automated_response":false,"created_at":"2018-10-13T12:12:03.689Z","updated_at":"2018-10-13T12:12:41.776Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3475408,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Some more:\n\n* Amazon channel\n* Pinterest channel\n* Google Shopping\n* Advanced Cash on Delivery\n* Messenger","automated_response":false,"created_at":"2018-10-13T14:13:45.690Z","updated_at":"2018-10-13T14:13:45.690Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3476834,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-10-13T23:25:51.506Z","updated_at":"2018-10-13T23:25:51.506Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"5000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3476836,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-10-13T23:26:09.025Z","updated_at":"2018-10-13T23:26:09.025Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3476845,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @filedescriptor,\n\nThank you for your report. We have reproduced this issue, and our engineering team is investigating this issue. Most of the Shopify owned apps are embedded apps which load response in an admin iframe. Because of this, modifying `session_id` cookie value in some of the apps requires victim to login into attacker store which breaks the exploit chain. Nevertheless there are few pages which are not rendered in the Shopify admin app iframe and are considered vulnerable to this issue. After considering these implications across all the effected apps, we have decided to award $5000 bounty.","automated_response":false,"created_at":"2018-10-13T23:29:39.973Z","updated_at":"2018-10-13T23:29:39.973Z","actor":{"username":"lalith-shopify","cleared":false,"url":"/lalith-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3478801,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the bounty! I am sorry if my PoC was not clear enough, but it shouldn't require victim to login into attacker store. After forcing the app's session cookies to the victim, I can then redirect them directly to `VICTIM.myshopify.com/admin/oauth/authorize?client_id=` which redirects to the login endpoint (`/auth/callback`), and the whole process will not involve framing.\n\nCould you let me know in which scenario it broke? I would like to create a PoC for such cases.","automated_response":false,"created_at":"2018-10-14T13:56:55.558Z","updated_at":"2018-10-14T13:56:55.558Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4532787,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report @filedescriptor, and sorry for the long delay in responding. Addressing this took some time, as many teams were involved. We've now deployed fixes for all the apps you identified.\n\nWe look forward to hearing from you again soon!","automated_response":false,"created_at":"2019-04-10T20:31:15.013Z","updated_at":"2019-04-10T20:31:15.013Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4637041,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-24T20:50:03.645Z","updated_at":"2019-04-24T20:50:03.645Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4638447,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-25T02:39:59.092Z","updated_at":"2019-04-25T02:39:59.092Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4638448,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-04-25T02:39:59.159Z","updated_at":"2019-04-25T02:39:59.159Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7147416,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2020-02-25T14:50:57.739Z","updated_at":"2020-02-25T14:50:57.739Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"Shopify Developed Apps","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":15381,"category":"team","content":"*Note: This report was submitted during our [H1-514 live hacking event](https://www.hackerone.com/blog/Shopify-Awards-116000-Hackers-Canada-h1-514-Recap), which had an expanded scope compared to our public bug bounty program. Some of the apps mentioned in this report are not currently in scope for our public program.*\n\n@filedescriptor noticed that several add-on applications built by Shopify were vulnerable to session fixation because they did not generate a fresh session cookie during the OAuth2 callback phase. This could have allowed an attacker to gain access to a victim's app session if certain conditions were met.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":19166,"username":"clayton","name":"Clayton Smith","bio":"","cleared":false,"website":null,"location":"","created_at":"2015-03-19T21:02:17.272Z","url":"https://hackerone.com/clayton","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}