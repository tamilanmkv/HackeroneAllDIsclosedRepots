{"id":463695,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NjM2OTU=","url":"https://hackerone.com/reports/463695","title":"Certificate warnings and similar UI elements in Web protection of Anti-Virus products family are susceptible to clickjacking","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-12-17T10:02:35.319Z","submitted_at":"2018-12-17T10:02:35.319Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"palant","url":"/palant","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2379,"url":"https://hackerone.com/kaspersky","handle":"kaspersky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kaspersky","twitter_handle":"kaspersky","website":"http://www.kaspersky.com","about":"Kaspersky is the world’s largest privately-held vendor of endpoint protection and cybersecurity solutions for business and consumers."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-28T17:54:56.804Z","bug_reporter_agreed_on_going_public_at":"2019-07-29T17:54:50.586Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary**\nClickjacking can be used to trick users into overriding certificate warnings, disabling Safe Money functionality or phishing alerts.\n\n**Description**\nOn certificate warning pages, a single click is sufficient to trigger overriding a wrong certificate. While an additional warning is displayed outside of the browser, the message is very generic and won't really tell users what they are agreeing to. This allows attackers who can MiTM user's connections (e.g. on a public WiFi) to attack SSL-protected connections. The issue reported under https://hackerone.com/reports/461780 makes matters worse here because certificates can be overridden even for high-profile websites like Google.\n\n**Environment**\n- Scope: Application\n- Product name: Kaspersky Internet Security\n- Product version: example: 19.0.0.1088\n- OS name and version (incl SP): Windows 10.0.17134, tested browsers are Firefox 64, Internet Explorer 11, Microsoft Edge\n- Attack type: Clickjacking\n- Maximum user privileges needed to reproduce your issue: no privileges\n\n**Steps to reproduce**\n1. Edit the file %WINDIR%\\sysnative\\drivers\\etc\\hosts as administrator and add the following line: `93.184.216.34 www.google.com` (that's the IP address of example.com to simulate a MitM attack).\n2. Go to https://www.google.com/ in your browser - note how Kaspersky will display a certificate error page.\n3. Now download the attached certerror_clickjacking.html and open it in your browser (can be opened directly from the file system).\n4. The page masquerades as a warning from Kaspersky about your network not being protected, which is probably true if the attackers managed to show you this page. Click the \"I understand the risks and wish to continue\" link. Note: this has been tested with the English version of Kaspersky, there is a slight chance that this link won't be positioned correctly with other languages.\n5. An additional warning by Kaspersky opens saying: \"You are about to go to an insecure web resource. Are you sure you want to continue?\" That warning is in line with what you already saw, so you click \"Continue.\"\n6. Now go to https://www.google.com/ again. Note how the site loads now (shows \"Not Found\"), the certificate error is gone.\n\nThe link you clicked on in step 4 didn't belong to the certerror_clickjacking.html page but rather to the certificate error page for www.google.com. So when you clicked it you actually confirmed to override the wrong certificate of www.google.com.\n\nOther warning pages displayed by Kaspersky are similarly affected by clickjacking. So the attackers could trick you into clicking the link which disables Safe Money protection for your bank for example. Or the link that permanently overrides the phishing warning for almost-my-bank.com. Both these actions would have worked without an additional confirmation, so no social engineering required - the user merely needs to click somewhere on the attacker's page.\n\n**Recommendations**\nBrowsers' certificate error pages are resilient to clickjacking. Both Firefox and Chrome will require **two** clicks on **different** parts of the page to override a certificate: first \"Advanced\" button, then the actual override. This approach is also advisable for other reasons: technical details only confuse the general population, the important information being that they should leave the page which is not secure. Only people who are technical enough to look at the advanced section should see the override possibility.\n\nAlso, the additional confirmation message displayed by Kaspersky should be made less generic. At the very least, it should mention the website that the user is overriding the certificate for.\n\nFinally, there is no valid reason for the Safe Money prompt to appear within a frame, so this could be prevented using X-Frame-Options HTTP header.\n\n## Impact\n\nOn a public network, attackers might redirect user's unencrypted (plain HTTP) traffic to their server and display a message to them that they would plausibly want to override. If the user clicks the override link then, they will have unwittingly overridden the wrong certificate warning for some SSL-protected website and will have given attackers the possibility to hijack this connection.","weakness":{"id":74,"name":"UI Redressing (Clickjacking)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-08-28T17:54:50.641Z","allow_singular_disclosure_after":-66949671.62062801,"singular_disclosure_allowed":true,"vote_count":10,"voters":["foobar7","mik317","zayn1337","0-1","what_web","cryptographer","awesomeninja","saharuzzaman","sp1der","henry742689"],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3838643,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Wladimir.\n\nThx for the report. I'll get back to you soon.","automated_response":false,"created_at":"2018-12-17T13:32:35.562Z","updated_at":"2018-12-17T13:32:35.562Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3838645,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-12-17T13:32:46.947Z","updated_at":"2018-12-17T13:32:46.947Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3870555,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We understand the concern here related to the described scenario. We notify user about visiting an untrusted website in a secure desktop alert and we believe it’s an adequate security measure in this scenario. The bounty bug for reporting such issue is not awarded. However, we will take this into account when working on the next product releases. Thank you for your help in making our products secure.","automated_response":false,"created_at":"2018-12-20T11:23:48.895Z","updated_at":"2018-12-20T11:23:48.895Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3870606,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e We notify user about visiting an untrusted website in a secure desktop alert and we believe it’s an adequate security measure in this scenario.\n\nI strongly disagree. This alert is displayed without any context information whatsoever, malicious websites are free to remove the real context and replace it by whatever context they like. In this situation, most users will choose to accept the warning. This reduces security considerably compared to the certificate warning pages implemented by the browsers where it is impossible for the user to override the certificate without seeing the context.\n\nAlso, while this is the most critical scenario, other pages with override links displayed by Kaspersky are similarly affected. Same issue also applies to anti-phishing warnings for example, no additional confirmation being required there.","automated_response":false,"created_at":"2018-12-20T11:37:21.611Z","updated_at":"2018-12-20T11:37:21.611Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3870621,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This alert will be improved in the future product releases, that's why I wrote we take this issue into account.","automated_response":false,"created_at":"2018-12-20T11:44:02.741Z","updated_at":"2018-12-20T11:44:02.741Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3870629,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, so you acknowledge the issue and will fix it but not pay for the report because things are good enough as they are. Makes total sense...","automated_response":false,"created_at":"2018-12-20T11:47:38.629Z","updated_at":"2018-12-20T11:47:38.629Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3871756,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Do I see this correctly that, if this isn't considered a vulnerability, there is no reason why I cannot write about it?","automated_response":false,"created_at":"2018-12-20T15:41:25.571Z","updated_at":"2018-12-20T15:41:25.571Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3871858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wladimir, we support responsible disclosure, please give us some time to think how we can resolve this situation in our common interests.","automated_response":false,"created_at":"2018-12-20T16:11:11.278Z","updated_at":"2018-12-20T16:11:11.278Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3876690,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Dear Wladimir. Thanks again for your efforts to make our products secure. We have always had helpful cooperation with you and now we really appreciate information that you provided. We take seriously issues you posted before (like #435618, #463915) and regard them in scope of our program. We cannot award Bug Bounty for your report according to our BB program, because it refers to a low probability security risk, not a vulnerability in our product.","automated_response":false,"created_at":"2018-12-21T15:09:06.196Z","updated_at":"2018-12-21T15:09:06.196Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3877000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"So what's the answer to:\n\n\u003e Do I see this correctly that, if this isn't considered a vulnerability, there is no reason why I cannot write about it?","automated_response":false,"created_at":"2018-12-21T16:22:48.728Z","updated_at":"2018-12-21T16:22:48.728Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3886731,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We've concluded that scenario of its exploitation is similar to case #469372 (that in scope of bug bounty program), but severity is lower. Could you please don't publish information about this issue before we release the fix.","automated_response":false,"created_at":"2018-12-24T15:26:32.283Z","updated_at":"2018-12-24T15:27:31.940Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4657002,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi man!\n\nA fix was released. Check it out (KIS 19 Patch E). You just need to update installed KIS 19 product to the latest version. I'll update rest of your tickets soon.","automated_response":false,"created_at":"2019-04-28T17:11:51.880Z","updated_at":"2019-04-28T17:11:51.880Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"palant","url":"/palant"},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4657004,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-04-28T17:12:01.088Z","updated_at":"2019-04-28T17:12:01.088Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":263248,"new_severity_id":359395},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4660236,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Seeing that Patch E was released three weeks ago already, all of the issues resolved can be written about?","automated_response":false,"created_at":"2019-04-29T09:25:32.767Z","updated_at":"2019-04-29T09:25:32.767Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4660244,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm btw. that the clickjacking issue is resolved, even though the links are still predictable.","automated_response":false,"created_at":"2019-04-29T09:28:26.155Z","updated_at":"2019-04-29T09:28:26.155Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5455827,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-07-29T17:54:50.605Z","updated_at":"2019-07-29T17:54:50.605Z","first_to_agree":true,"actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5554308,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just making sure you know: as discussed in #470547, I plan to publish a blog article on this issue next Monday (2019-08-19).","automated_response":false,"created_at":"2019-08-12T09:36:15.172Z","updated_at":"2019-08-12T09:36:15.172Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5603540,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"FYI: https://palant.de/2019/08/19/kaspersky-in-the-middle-what-could-possibly-go-wrong/","automated_response":false,"created_at":"2019-08-19T08:18:13.866Z","updated_at":"2019-08-19T08:18:13.866Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5685372,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-08-28T17:54:56.820Z","updated_at":"2019-08-28T17:54:56.820Z","actor":{"url":"/kaspersky","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kaspersky"}},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6438495,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-11-30T17:20:47.067Z","updated_at":"2019-11-30T17:20:47.067Z","additional_data":{"old_title":"Certificate warnings and similar UI elements are susceptible to clickjacking","new_title":"Certificate warnings and similar UI elements in Web protection of Anti-Virus products family are susceptible to clickjacking"},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}