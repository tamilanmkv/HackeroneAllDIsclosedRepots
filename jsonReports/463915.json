{"id":463915,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NjM5MTU=","url":"https://hackerone.com/reports/463915","title":"URL Advisor component in KIS products family is vulnerable to Universal XSS","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-12-17T14:00:58.680Z","submitted_at":"2018-12-17T14:00:58.680Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"palant","url":"/palant","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2379,"url":"https://hackerone.com/kaspersky","handle":"kaspersky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kaspersky","twitter_handle":"kaspersky","website":"http://www.kaspersky.com","about":"Kaspersky is the worldâ€™s largest privately-held vendor of endpoint protection and cybersecurity solutions for business and consumers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-28T17:54:25.462Z","bug_reporter_agreed_on_going_public_at":"2019-07-29T17:54:20.126Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary**\nIn Microsoft Edge, URL Advisor UI is served as first-party content on every domain. So the XSS vulnerability I found in this UI automatically applies to all websites, it allows running code in the context of *any* domain.\n\n**Description**\nURL Advisor frame is located under https://www.google.com/\u003cINJECT_ID\u003e/ua/url_advisor_balloon.html and https://www.yahoocom/\u003cINJECT_ID\u003e/ua/url_advisor_balloon.html in Microsoft Edge (always the same INJECT_ID value). It gets its content from a message sent via `window.postMessage()` without validating message origin. Under some circumstances it will assign that data as link target, so a malicious website can make that link point to a javascript: URL. Clickjacking then allows making the user click that link - while sites like google.com use X-Frame-Options header to disallow framing, no such restrictions are in place for the url_advisor_balloon.html frame.\n\n**Environment**\n- Scope: Application\n- Product name: Kaspersky Internet Security\n- Product version: 19.0.0.1088\n- OS name and version (incl SP): Windows 10.0.17134\n- Attack type: Universal XSS\n- Maximum user privileges needed to reproduce your issue: no privileges\n\n**Steps to reproduce**\n1. Download attached `server.py` and `universal_xss.html` to some directory on your computer and run `server.py` (Python 3 required). This is a very rudimentary HTTP server running on http://localhost:5000/, you could use some other web server as well.\n2. Edit the file %WINDIR%\\sysnative\\drivers\\etc\\hosts as administrator and add the following line: `127.0.0.1 www.google.example.com`. Normally, you would just use a subdomain of a domain you own - the host name has to start with \"www.google.\" for URL Advisor to apply to it.\n3. Open Microsoft Edge and go to http://www.google.example.com:5000/universal_xss.html\n4. As advised by the page, move your mouse and click somewhere on the page.\n\nYou will see an alert message saying: \"Hi, this is JavaScript code running on www.google.com.\" That's the result of the code `alert('Hi, this JavaScript code is running on ' + document.domain)` executing in the context of the Google website. Injecting code into any other domain would have been easily possible as well.\n\n**Recommendation**\nThis user interface should never be served as first-party, even once the vulnerability here is fixed. Any XSS vulnerability in Kaspersky code automatically elevates to Universal XSS otherwise, this is too dangerous. Frankly, I don't see why it is done in this way with Microsoft Edge - in Firefox and Internet Explorer the same UI is always served via kis.v2.scr.kaspersky-labs.com, so vulnerabilities here don't affect other websites.\n\n## Impact\n\nA malicious website can easily make users click by pretending to be a game. And while the user clicks, they will be allowing the attackers to inject code into various internet domains and exfiltrating data in the background.","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-08-28T17:54:20.221Z","allow_singular_disclosure_after":-66949705.02204507,"singular_disclosure_allowed":true,"vote_count":64,"voters":["ikuamike","sp1d3rs","foobar7","sameerphad72","spam404","s_p_q_r","mik317","ali","macasun","dhakal_bibek","and 54 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3866440,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Wladimir.\n\nThx for your new report. A preliminary timeline for the fix is about 90 days. I'll get back to you later with our decision about payout.","automated_response":false,"created_at":"2018-12-19T13:50:27.485Z","updated_at":"2018-12-19T13:50:27.485Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3866441,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-12-19T13:50:40.497Z","updated_at":"2018-12-19T13:50:40.497Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3922145,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Dear Palant, \nWe would like to thank you for this report. Your help is appreciated for us.\nYour research and your reports will allow to make our products better.\nWe have decided to award you a bounty for your contribution to kaspersky labs product security.\nThank you.","automated_response":false,"created_at":"2019-01-03T22:12:32.285Z","updated_at":"2019-01-03T22:12:32.285Z","actor":{"url":"/kaspersky","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kaspersky"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kaspersky","collaborator":{"username":"palant","url":"/palant"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4540645,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-04-11T16:03:32.346Z","updated_at":"2019-04-11T16:03:32.346Z","additional_data":{"old_severity":"Critical","new_severity":"High","old_severity_id":263471,"new_severity_id":344440},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4659440,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The vulnerability was patched. To check the fix, install KIS 19 and update it to the latest release (Patch E).","automated_response":false,"created_at":"2019-04-29T08:27:46.889Z","updated_at":"2019-04-29T08:27:46.889Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"palant","url":"/palant"},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4660380,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm that the URL from the message is being ignored now. Otherwise no relevant changes.","automated_response":false,"created_at":"2019-04-29T09:55:03.634Z","updated_at":"2019-04-29T09:55:03.634Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5455822,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-07-29T17:54:20.165Z","updated_at":"2019-07-29T17:54:20.165Z","first_to_agree":true,"actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5554313,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just making sure you know: as discussed in #470547, I plan to publish a blog article on this issue next Monday (2019-08-19).","automated_response":false,"created_at":"2019-08-12T09:36:32.805Z","updated_at":"2019-08-12T09:36:32.805Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5591738,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello, Palant,\nCould you share with us a draft of your a blog article (its probably ready now) in the form, that is now?\nYou can use vulnerability@kaspersky.com mailbox for it.\nThank you in advance.","automated_response":false,"created_at":"2019-08-16T15:01:02.014Z","updated_at":"2019-08-16T15:01:02.014Z","actor":{"username":"shmol","cleared":false,"url":"/shmol","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5593121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You can see the draft under https://palant.de:5000/s3UpiDLH4h46H1q/.","automated_response":false,"created_at":"2019-08-16T18:07:41.573Z","updated_at":"2019-08-16T18:07:41.573Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5599147,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you.","automated_response":false,"created_at":"2019-08-18T08:02:57.810Z","updated_at":"2019-08-18T08:02:57.810Z","actor":{"username":"shmol","cleared":false,"url":"/shmol","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5603536,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"FYI: https://palant.de/2019/08/19/kaspersky-in-the-middle-what-could-possibly-go-wrong/","automated_response":false,"created_at":"2019-08-19T08:17:41.569Z","updated_at":"2019-08-19T08:17:41.569Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5685369,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-08-28T17:54:26.396Z","updated_at":"2019-08-28T17:54:26.396Z","actor":{"url":"/kaspersky","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kaspersky"}},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5963121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@palant Could you please remove PoC from this report and from other reports already were disclosed or will have been disclosed in the future.","automated_response":false,"created_at":"2019-10-04T22:43:21.775Z","updated_at":"2019-10-04T22:43:21.775Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5963985,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I don't think that I can edit anything here, no way to remove attachments on my end.","automated_response":false,"created_at":"2019-10-05T08:05:05.176Z","updated_at":"2019-10-05T08:05:05.176Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6438460,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-11-30T17:12:31.375Z","updated_at":"2019-11-30T17:12:31.375Z","additional_data":{"old_title":"Opening up a Universal XSS vulnerability in Microsoft Edge","new_title":"URL Advisor component in KIS products family is vulnerable to Universal XSS"},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}