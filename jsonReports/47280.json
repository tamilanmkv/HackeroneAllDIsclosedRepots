{"id":47280,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzI4MA==","url":"https://hackerone.com/reports/47280","title":"JSON keys are not properly escaped","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2015-02-10T01:00:04.032Z","submitted_at":"2015-02-10T01:00:04.032Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"einstein_","url":"/einstein_","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2015-3226"],"singular_disclosure_disabled":false,"disclosed_at":"2015-06-16T19:38:34.244Z","bug_reporter_agreed_on_going_public_at":"2015-06-16T19:38:33.941Z","team_member_agreed_on_going_public_at":"2015-06-16T19:17:21.898Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Rails does not escape hash keys properly in `to_json` when generating json.\r\n\r\nValues are escaped as expected\r\n```ruby\r\nirb(main):001:0\u003e {\"a\"=\u003e\"\u003c\u003e\"}.to_json\r\n=\u003e \"{\\\"a\\\":\\\"\\\\u003c\\\\u003e\\\"}\"\r\n```\r\n\r\nHowever keys are not:\r\n```ruby\r\nirb(main):002:0\u003e {\"\u003c\u003e\"=\u003e\"a\"}.to_json\r\n=\u003e \"{\\\"\u003c\u003e\\\":\\\"a\\\"}\"\r\n```\r\n\r\nThis is because the `json` gem calls `.to_s` on the keys [here](https://github.com/flori/json/blob/259dee6c9bdda08ed0c1fc2e69bfbb2d377faba0/ext/json/ext/generator/generator.c#L738) which transforms the `EscapedString` back into a simple `String` so it doesn't go through the escaping process that values go through [here](https://github.com/EiNSTeiN-/rails/blob/3820788e4c2825dd77c779ba5b3bc29689e04e1d/activesupport/lib/active_support/json/encoding.rb#L54-L60).\r\n\r\n**Security consideration**: this issue is a vector for XSS when an arbitrary value is used as a key and reflected in a javascript tag. Consider this piece of code:\r\n```ruby\r\njavascript_tag \"var json=#{params.to_json}\"\r\n```\r\nWhen params is something like `{\"\u003c/script\u003e\u003cscript\u003ealert(1)//\"=\u003e\"xss\"}` then `\u003c\u003e` are not escaped as they should and the javascript tag looks like this:\r\n```html\r\n\u003cscript\u003e\r\n//\u003c![CDATA[\r\nvar json={\"\u003c/script\u003e\u003cscript\u003ealert(1)//\":\"xss\"}\r\n//]]\u003e\r\n\u003c/script\u003e\r\n```\r\nThe `\u003c/script\u003e` inside the json object will terminate the opening script tag because it has precedence over everything else, and `alert(1)` is executed.\r\n\r\nI believe this issue also applies to 4.2-stable and master.\r\n\r\nNote that I opened a PR for a related issue in the json gem (https://github.com/flori/json/pull/235) which occurs when `ActiveSupport.escape_html_entities_in_json = false` because the forward slash is never escaped (neither in rails nor in the json gem). It might be worth fixing this in rails as well.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-07-16T19:17:22.246Z","allow_singular_disclosure_after":-196890371.19685,"singular_disclosure_allowed":true,"vote_count":6,"voters":["jensec","eveeez","khizer47","cr4xerbik4sh","cryptographer","spetr0x"],"severity":{"rating":"high","score":7.2,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":328789,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's a patch for 4.1-stable:\n\n```patch\ndiff --git a/activesupport/lib/active_support/json/encoding.rb b/activesupport/lib/active_support/json/encoding.rb\nindex f29d422..d0f67b1 100644\n--- a/activesupport/lib/active_support/json/encoding.rb\n+++ b/activesupport/lib/active_support/json/encoding.rb\n@@ -58,6 +58,10 @@ def to_json(*)\n                 super.gsub ESCAPE_REGEX_WITHOUT_HTML_ENTITIES, ESCAPED_CHARS\n               end\n             end\n+\n+            def to_s\n+              self\n+            end\n           end\n \n           # Mark these as private so we don't leak encoding-specific constructs\ndiff --git a/activesupport/test/json/encoding_test.rb b/activesupport/test/json/encoding_test.rb\nindex c4283ee..b75c67c 100644\n--- a/activesupport/test/json/encoding_test.rb\n+++ b/activesupport/test/json/encoding_test.rb\n@@ -143,6 +143,13 @@ def test_hash_encoding\n     assert_equal %({\\\"a\\\":\\\"b\\\",\\\"c\\\":\\\"d\\\"}), sorted_json(ActiveSupport::JSON.encode(:a =\u003e :b, :c =\u003e :d))\n   end\n \n+  def test_hash_keys_encoding\n+    ActiveSupport.escape_html_entities_in_json = true\n+    assert_equal \"{\\\"\\\\u003c\\\\u003e\\\":\\\"\\\\u003c\\\\u003e\\\"}\", ActiveSupport::JSON.encode(\"\u003c\u003e\" =\u003e \"\u003c\u003e\")\n+  ensure\n+    ActiveSupport.escape_html_entities_in_json = false\n+  end\n+\n   def test_utf8_string_encoded_properly\n     result = ActiveSupport::JSON.encode('€2.99')\n     assert_equal '\"€2.99\"', result\n```","automated_response":false,"created_at":"2015-02-10T01:00:35.596Z","updated_at":"2015-02-10T01:00:35.596Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":329060,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @einstein_, just to confirm we got your report and we agree with the proposed solution. We will prepare the advisory and post it back to review.","automated_response":false,"created_at":"2015-02-10T13:58:34.484Z","updated_at":"2015-02-10T13:58:34.484Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":338590,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I was researching the impact and possible workarounds for this XSS vulnerability and found that it is only possible due to `javascript_tag` marking the content as HTML safe by default. I'm missing any case where this issue can also lead XSS?\n\nAlso I can't think in any possible workaround, do you have any in mind?","automated_response":false,"created_at":"2015-02-23T19:56:33.110Z","updated_at":"2015-02-23T19:56:33.110Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":338616,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is the first draft of the advisory and the patches for 4.1.9 and 4.2.0. I'm planning to release 4.1.9.1 and 4.2.0.1 including just security releases and 4.2.1 and 4.1.10 with bug fixes and the security patches.\n\nLet me know what you think.\n\n@einstein_ about the credits how do you want it? We usually do \"Thanks to XXX of Company for reporting the vulnerability to us and working closely with us on a fix.\"","automated_response":false,"created_at":"2015-02-23T20:20:26.206Z","updated_at":"2015-02-23T20:20:26.206Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":30156,"filename":"4-1-to_json_xss.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/030/156/3102adeed80cffbb4db0ff5619475afa49041f3c/4-1-to_json_xss.patch?response-content-disposition=attachment%3B%20filename%3D%224-1-to_json_xss.patch%22%3B%20filename%2A%3DUTF-8%27%274-1-to_json_xss.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3dee855e8437ff03b1d54ef07249dc01e94a8ea5e81f5800d29ae697bc9b58ab"},{"id":30157,"filename":"4-2-to_json_xss.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/030/157/7097fd92c3502cf09b8f610d14f0825c1c767b25/4-2-to_json_xss.patch?response-content-disposition=attachment%3B%20filename%3D%224-2-to_json_xss.patch%22%3B%20filename%2A%3DUTF-8%27%274-2-to_json_xss.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0f681c5164b6db5479c28beaf630d318e5efef445c4d4dedf2d4230a5982bf39"},{"id":30158,"filename":"advisory.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/030/158/e9c498ca457fcb9e717053026c4a8f64a2f9072e/advisory.txt?response-content-disposition=attachment%3B%20filename%3D%22advisory.txt%22%3B%20filename%2A%3DUTF-8%27%27advisory.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ce7568531000c7c3d732c67f384775edfdc97e980306bf222cb87c21927ef838"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":338668,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The javascript_tag use case might very well be the only one, I didn't look for other vectors since our specific use case was inside a javascript_tag call too. The example form my report would lead to a XSS only inside of a `\u003cscript\u003e` tag because of the precedence of `\u003c/script\u003e` over anything else.\n\nWe ended up monkey-patching `content_tag_string` like below in order to prevent this from happening in the future, because `\u003c/script\u003e` is never a valid sequence in a script tag no matter how it got there:\n\n```ruby\nmodule ActionView\n  module Helpers\n    module TagHelper\n\n      private\n\n      alias_method :orig_content_tag_string, :content_tag_string\n      def content_tag_string(name, content, options, escape = true)\n        if name.to_s.downcase == \"script\" \u0026\u0026 content =~ /\\\u003c\\s*\\/\\s*script[^\\\u003e]*\u003e/i\n          raise ArgumentError, \"Blocked XSS: string \u003c/script\u003e found inside tag content.\"\n        end\n        orig_content_tag_string(name, content, options, escape)\n      end\n    end\n  end\nend\n```\n\nwith the following tests:\n```ruby\nrequire 'test_helper'\n\nclass ActionViewContentTagTest \u003c ActiveSupport::TestCase\n  include ActionView::Helpers::TagHelper\n  include ActionView::Helpers::JavaScriptHelper\n\n  test \"script tags cannot contain \u003c/script\u003e\" do\n    assert_raise ArgumentError do\n      javascript_tag \"foo\u003c/script\u003ebar\"\n    end\n  end\n\n  test \"script tags cannot contain malformed \u003c/script\u003e\" do\n    assert_raise ArgumentError do\n      javascript_tag \"foo\u003c   /    script\u003ebar\"\n    end\n    assert_raise ArgumentError do\n      javascript_tag \"foo\u003c / script   bla\u003ebar\"\n    end\n  end\n\n  test \"script tags can contain \u003c/script\u003e when forward slash is escaped\" do\n    assert_nothing_raised do\n      javascript_tag \"foo\u003c\\\\/script\u003ebar\"\n    end\n  end\nend\n```\n\nI'm not sure this is something you'd want in rails, but I don't see a better way to protect against this.\n\nAlso note that the provided patch (my original patch as well as your official ones) offers no protection when `ActiveSupport.escape_html_entities_in_json = false`. That would require encoding the forward slash character in [ESCAPE_REGEX_WITHOUT_HTML_ENTITIES](https://github.com/rails/rails/blob/88b334ec696ffe1fa08b934780f4ab27030c5c76/activesupport/lib/active_support/json/encoding.rb#L49) (i.e. encode `/` as `\\/`). That would protect against the `\u003c/script\u003e` vector even when `ActiveSupport.escape_html_entities_in_json = false` until https://github.com/flori/json/pull/235 is merged.\n","automated_response":false,"created_at":"2015-02-23T21:11:36.993Z","updated_at":"2015-02-23T21:23:01.397Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338670,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"For the credit: \"Thanks to Francois Chagnon of Shopify\"","automated_response":false,"created_at":"2015-02-23T21:12:02.438Z","updated_at":"2015-02-23T21:12:02.438Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338750,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm not sure if we should care about `escape_html_entities_in_json` being `false`. It is true by default and it is a good practice to keep it true.\n\nFor example, even with your patch, if `escape_html_entities_in_json` is false, we still have the same problem:\n\n```\n\u003cscript\u003e\n  var foo = \u003c%= params.to_json.html_safe %\u003e\n\u003c/script\u003e","automated_response":false,"created_at":"2015-02-23T22:39:03.871Z","updated_at":"2015-02-23T22:39:03.871Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":338768,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Escaping `/` as `\\/` will fix this xss vector in all cases since `params.to_json.html_safe` would look like `{'foo': '\u003c\\/script\u003e'}` when `escape_html_entities_in_json=false`. I think the proper place to fix this is in the `json` lib, but I thought it was worth mentioning since both issues are somewhat related. The forward slash not being escaped is is a slightly different issues from the one I originally reported here, the only link between them is that they are both exploitable with the string `\u003c/script\u003e`. Escaping html entities successfully prevents this xss vector, but if either json or rails had escaped `/`, this would not have been a security issue in the first place (it might still have been a escaping bug, but not a security issue).\n","automated_response":false,"created_at":"2015-02-23T23:03:52.163Z","updated_at":"2015-02-23T23:03:52.163Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338773,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm sorry if I misunderstood your last message, were you talking about the `content_tag_string` patch? Indeed it does nothing when javascript_tag is not used. This patch is useful in case someone does the following for example:\n```erb\n\u003c%= javascript_tag do %\u003e\n  var foo = \"\u003c%= foo.gsub('\"', '\\\"') %\u003e\";\n\u003c% end %\u003e\n```\nThis does successfully prevent the javascript string from being terminated when `foo='\";alert'`, but does nothing when `foo=\"\u003c/script\u003e\"`. I agree this would be a terrible way to escape strings, and I don't see why anyone would do this, but the monkey patch will save the day in case someone tries really hard to roll out their own way of escaping strings.\n","automated_response":false,"created_at":"2015-02-23T23:21:21.736Z","updated_at":"2015-02-23T23:27:04.574Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338799,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"So you are right, the `javascript_tag` patch is not a viable workaround for this issue, it's an additional patch that fixes the problem in a different scenario.\n\nWould this work as a workaround? Suggest that people add this monkey patch as an initializer:\n```ruby\nmodule ActiveSupport\n  module JSON\n    module Encoding\n      private\n      class EscapedString\n        def to_s\n          self\n        end\n      end\n    end\n  end\nend\n```","automated_response":false,"created_at":"2015-02-24T00:03:29.958Z","updated_at":"2015-02-24T00:03:29.958Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338806,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Should the impact section mention this is a xss vulnerability only when to_json.html_safe is used inside of a script tag?\n\nFor example:\n\nImpact\n------\nThis helper, or its indirect call `Hash#to_json`, in combination with `html_safe` is vulnerable to an XSS attack when used inside a `\u003cscript\u003e` element.\n","automated_response":false,"created_at":"2015-02-24T00:21:19.940Z","updated_at":"2015-02-24T00:24:09.693Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":339192,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think we should also include the `javascript_tag` case in the impact section.\n\nThat monkey patch can be a good workaround.\n\nMaybe we should also apply a fix in `javascript_tag` to always escape `\u003c/script\u003e`. I'll take a look.","automated_response":false,"created_at":"2015-02-24T16:13:15.402Z","updated_at":"2015-02-24T16:13:15.402Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":367675,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Rafael, do you have a tentative date for the release of a advisory/fix?","automated_response":false,"created_at":"2015-04-01T19:59:00.625Z","updated_at":"2015-04-01T19:59:00.625Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":376571,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'll request the CVE today and I believe next week we can release. I'll update here the updated advisory and patches.","automated_response":false,"created_at":"2015-04-09T20:54:33.999Z","updated_at":"2015-04-09T20:54:33.999Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":376785,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here updated version of patches and advisory","automated_response":false,"created_at":"2015-04-09T23:33:53.310Z","updated_at":"2015-04-09T23:33:53.310Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":34141,"filename":"advisory.txt","type":"text/x-ruby","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/034/141/8b13476ea74a82abbb0c519da686ce994a6d577d/advisory.txt?response-content-disposition=attachment%3B%20filename%3D%22advisory.txt%22%3B%20filename%2A%3DUTF-8%27%27advisory.txt\u0026response-content-type=text%2Fx-ruby\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f34d36447f4129f55600a8b74a9da86048e961ba1af55d26723e5190bc117ea9"},{"id":34140,"filename":"4-2-to_json_xss.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/034/140/1ccfd1e07bc6e3b508d05a6ac48a6bda03eb3655/4-2-to_json_xss.patch?response-content-disposition=attachment%3B%20filename%3D%224-2-to_json_xss.patch%22%3B%20filename%2A%3DUTF-8%27%274-2-to_json_xss.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=5d0b6090f4e926353b98563e028faa516b910e4452270026c81325473e96af0e"},{"id":34139,"filename":"4-1-to_json_xss.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/034/139/edc2e536f650f5adf207ca24d36ac0d965797888/4-1-to_json_xss.patch?response-content-disposition=attachment%3B%20filename%3D%224-1-to_json_xss.patch%22%3B%20filename%2A%3DUTF-8%27%274-1-to_json_xss.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0186c45027a4e89ca6fd467bb5222b9dfb472ce1444323b82c11911a0913f44e"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":376821,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I reworded the advisory with some inputs of the Rails Core members","automated_response":false,"created_at":"2015-04-10T01:54:20.225Z","updated_at":"2015-04-10T01:54:20.225Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":34152,"filename":"advisory.txt","type":"text/x-ruby","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/034/152/8fa933257dfa8c99eff5ff7e7a49d375ec873154/advisory.txt?response-content-disposition=attachment%3B%20filename%3D%22advisory.txt%22%3B%20filename%2A%3DUTF-8%27%27advisory.txt\u0026response-content-type=text%2Fx-ruby\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150333Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=544d04db232540bb6c0312174f9069dac1b2e4b0a6a85d1cce9c10d1171f6d19"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":376916,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The advisory and patches look good. One small thing, there is a typo: `directely` should read `directly`\n","automated_response":false,"created_at":"2015-04-10T05:06:46.667Z","updated_at":"2015-04-10T05:06:46.667Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":473006,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2015-06-15T17:22:54.405Z","updated_at":"2015-06-15T17:22:54.405Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":473009,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2015-06-15T17:22:54.916Z","updated_at":"2015-06-15T17:22:54.916Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":474500,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2015-06-16T19:17:13.709Z","updated_at":"2015-06-16T19:17:13.709Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"einstein_","url":"/einstein_"},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":474501,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-06-16T19:17:21.937Z","updated_at":"2015-06-16T19:17:21.937Z","first_to_agree":true,"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":474535,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-06-16T19:38:33.999Z","updated_at":"2015-06-16T19:38:33.999Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":474536,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-06-16T19:38:34.292Z","updated_at":"2015-06-16T19:38:34.292Z","actor":{"username":"einstein_","cleared":false,"url":"/einstein_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2202445,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-12-05T18:40:17.501Z","updated_at":"2017-12-05T18:40:17.501Z","additional_data":{"old_severity":null,"new_severity":"High (7.2)","old_severity_id":null,"new_severity_id":99524},"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2202446,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-12-05T18:40:38.186Z","updated_at":"2017-12-05T18:40:38.186Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Ruby on Rails"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"rails","collaborator":{"username":"einstein_","url":"/einstein_"},"actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":166,"category":"team","content":"XSS Vulnerability in ActiveSupport::JSON.encode \n\nThere is an XSS vulnerability in the ActiveSupport::JSON.encode method in Ruby on Rails. \nThis vulnerability has been assigned the CVE identifier CVE-2015-3226. \n\nVersions Affected:  3.0.x, 3.1.x, 3.2.x, 4.1.x, 4.2.x. \nNot affected:       4.0.x. \nFixed Versions:     4.2.2, 4.1.11 \n\nImpact \n------ \nWhen a `Hash` containing user-controlled data is encode as JSON (either through \n`Hash#to_json` or `ActiveSupport::JSON.encode`), Rails does not perform adequate \nescaping that matches the guarantee implied by the `escape_html_entities_in_json` \noption (which is enabled by default). If this resulting JSON string is subsequently \ninserted directly into an HTML page, the page will be vulnerable to XSS attacks. \n\nFor example, the following code snippet is vulnerable to this attack: \n\n    \u003c%= javascript_tag \"var data = #{user_supplied_data.to_json};\" %\u003e \n\nSimilarly, the following is also vulnerable: \n\n    \u003cscript\u003e \n      var data = \u003c%= ActiveSupport::JSON.encode(user_supplied_data).html_safe %\u003e; \n    \u003c/script\u003e \n\nAll applications that renders JSON-encoded strings that contains user-controlled \ndata in their views should either upgrade to one of the FIXED versions or use \nthe suggested workaround immediately. \n\nReleases \n-------- \nThe FIXED releases are available at the normal locations. \n\nWorkarounds \n----------- \nTo work around this problem add an initializer with the following code: \n\n    module ActiveSupport \n      module JSON \n        module Encoding \n          private \n          class EscapedString \n            def to_s \n              self \n            end \n          end \n        end \n      end \n    end \n\nPatches \n------- \nTo aid users who aren't able to upgrade immediately we have provided patches for the two \nsupported release series.  They are in git-am format and consist of a single changeset. \n\n* 4-1-to_json_xss.patch - Patch for 4.1 series \n* 4-2-to_json_xss.patch - Patch for 4.2 series \n\nPlease note that only the 4.1.x and 4.2.x series are supported at present. \nUsers of earlier unsupported releases are advised to upgrade as soon as possible as we cannot \nguarantee the continued availability of security fixes for unsupported releases. \n\nCredits \n------- \n\nThanks to Francois Chagnon of Shopify for reporting the vulnerability to us, and working \nwith us on a fix. \n","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":20,"username":"arice","name":"Alex Rice","bio":"hackerone | internet bug bounty","cleared":false,"website":"https://twitter.com/senorarroz","location":"","created_at":"2013-06-18T19:55:34.230Z","url":"https://hackerone.com/arice","anc_triager":false,"hackerone_triager":false,"hackerone_employee":true,"user_type":"legacy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}