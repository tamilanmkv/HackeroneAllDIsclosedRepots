{"id":502758,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDI3NTg=","url":"https://hackerone.com/reports/502758","title":"RCE and Complete Server Takeover of http://www.█████.starbucks.com.sg/","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-02-27T10:58:19.039Z","submitted_at":"2019-02-27T10:58:19.039Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"spaceraccoon","url":"/spaceraccoon","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-04-10T19:29:08.098Z","bug_reporter_agreed_on_going_public_at":"2019-04-04T00:35:09.876Z","team_member_agreed_on_going_public_at":"2019-04-10T19:29:07.913Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","bounty_amount":"4000.0","formatted_bounty":"$4,000","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-05-04T00:35:10.004Z","allow_singular_disclosure_after":-77034702.26652837,"singular_disclosure_allowed":true,"vote_count":525,"voters":["lmy375","danielmgm","0x541","th3hidd3nmist","thiezn","kekkegenkai","dninjadave","zzero","daehee","spaceraccoon","and 515 more..."],"severity":{"rating":"critical","score":10.0,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":13008,"asset_type":"OTHER","asset_identifier":"Other non domain specific items","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4223428,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-02-27T10:59:47.310Z","updated_at":"2019-04-10T19:21:56.654Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4223455,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-02-27T11:10:47.896Z","updated_at":"2019-02-27T11:10:47.896Z","actor":{"username":"still","cleared":false,"url":"/still","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/390/243/51ce849c0c189ad15dade380626c7b85a3fb9332_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4223490,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-02-27T11:20:27.268Z","updated_at":"2019-02-27T11:20:27.268Z","additional_data":{},"actor":{"username":"still","cleared":false,"url":"/still","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/390/243/51ce849c0c189ad15dade380626c7b85a3fb9332_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4223491,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-02-27T11:20:36.415Z","updated_at":"2019-02-27T11:20:36.415Z","actor":{"username":"still","cleared":false,"url":"/still","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/390/243/51ce849c0c189ad15dade380626c7b85a3fb9332_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4225115,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-02-27T17:40:13.932Z","updated_at":"2019-02-27T17:40:13.932Z","actor":{"username":"coldbr3w","cleared":false,"url":"/coldbr3w","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/109/209/dd6ef3a28f555d97d4d9c90c41c908d9b11daf47_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4285103,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-03-08T12:24:56.914Z","updated_at":"2019-04-10T19:21:56.646Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4361307,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2019-03-20T17:50:30.435Z","updated_at":"2019-03-20T17:50:30.435Z","actor":{"username":"coldbr3w","cleared":false,"url":"/coldbr3w","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/109/209/dd6ef3a28f555d97d4d9c90c41c908d9b11daf47_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"spaceraccoon","url":"/spaceraccoon"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4363228,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-03-20T21:52:53.835Z","updated_at":"2019-03-20T21:52:53.835Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4406693,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-03-27T21:24:44.298Z","updated_at":"2019-03-27T21:24:44.298Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4458852,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-04-03T15:00:55.846Z","updated_at":"2019-04-03T15:00:55.846Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4467766,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-04-03T22:40:29.767Z","updated_at":"2019-04-03T22:40:29.767Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"bounty_amount":"4000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"starbucks","collaborator":{"username":"spaceraccoon","url":"/spaceraccoon"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4468637,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2019-04-03T23:48:02.656Z","updated_at":"2019-04-03T23:48:02.656Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4468692,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-04T00:35:09.906Z","updated_at":"2019-04-04T00:35:09.906Z","first_to_agree":true,"actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4532435,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2019-04-10T19:10:41.594Z","updated_at":"2019-04-10T19:10:41.594Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"Other assets","new_scope":"Other non domain specific items","genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4532514,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-10T19:29:07.988Z","updated_at":"2019-04-10T19:29:07.988Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4532515,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-04-10T19:29:08.128Z","updated_at":"2019-04-10T19:29:08.128Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":15114,"category":"team","content":"This report from @spaceraccoon demonstrated a valid attack resulting in RCE and full compromise of the target. The detailed and thorough report was especially helpful throughout the triage process, and ultimately helped us reproduce and resolve the issue as quickly as possible. The vulnerable site has been taken offline.\n\nWe'd like to thank @spaceraccoon for the submission, and hope to continue to see reports like this in the future.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":241256,"username":"shadegrown","name":"","bio":"","cleared":false,"website":null,"location":"","created_at":"2018-02-13T17:38:01.397Z","url":"https://hackerone.com/shadegrown","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"legacy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ1dFIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e19b0e8f388c7bfe78415637181283f2c69aa949/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lOTWpZd2VESTJNRDRHT2daRlZBPT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--7e37b612eb3c91a96f98ad01ca9fbe53cab870dd/bughunter-avatars_0004_Doppio.png"}}},{"id":14956,"category":"researcher","content":"## Chaining CVEs: From a 404 Page to RCE\n\n### Initial Recon\n\nI first got to this subdomain via the usual subdomain enumeration. It looked unpromising: a 404 page that said “this website is not in use,” a little picture, and nothing else. Running path discovery for the usual pages turned up nothing, not even a useful `robots.txt`. However, I took a closer look at the footer. It said something like `Copyright 2010 | Built on xxxx CMS` (not the real CMS name). That was promising because it told me that the site was both old and built on a custom CMS, meaning it was far more likely to be vulnerable. Google searching for the CMS turned up nothing, it was that obscure.\n\nThat was when I had the idea to try the path `website.com/xxxx` (entering the name of the CMS into the path). I was immediately redirected to `/josso/signin` (approximate path since the site has been taken offline) which has a login form. Bingo!\n\n### The Red Herring \n\nI tried the usual trick: entering the username and password `admin`. My excitement went through the roof when a “success” message popped up, but it seemed to hit an error. There must have been something wrong on the backend, because all I got was an empty page. Nothing else worked and the credentials also seemed to be disabled after the first login. It was a red herring.\n\n### The First CVE\n\nHowever, messing around further with the URL path suddenly gave me an Apache Tomcat stack trace that revealed the version number: 5.5.20. On some specific (mis)configurations, Tomcat could be vulnerable to [CVE-2007-0450](https://nvd.nist.gov/vuln/detail/CVE-2007-0450), a medium-level directory traversal vulnerability in the `mod_proxy` plug-in. You trigger it by adding some special characters to the path (read the CVE for more info). So I tried `site.com/josso/%5C../` and bingo! I was redirected to a Jboss web console page. It seemed like I had bypassed the internal proxy directly to the Jboss instance running on `localhost`.\n\n### The Second CVE\n\nI wasn’t familiar with Jboss, but doing some reading up informed me that it was a Red Hat app server that served Java applets. In addition, I found [CVE-2007-1036](https://nvd.nist.gov/vuln/detail/CVE-2007-1036), a High vulnerability that said that the Jboss web console needed to be protected to prevent unauthenticated server admin requests. As it turned out, thanks to the traversal CVE, I had managed to bypass the local proxy and get direct web access to the Jboss web console, which also wasn’t password-protected.\n\n### Remote. Code. Execution!\n\nFrom then on, RCE was quick. There are many attacks you can use, but I used the [jexboss](https://github.com/joaomatosf/jexboss) tool that allowed me to quickly gain RCE by exploiting Java deserialization vulnerabilities. One twist was that since I needed to bypass the local proxy, instead of attacking `/web-console`, I had to send all requests to `/josso/%5C../web-console`. I could then do anything I wanted on the server: modify the home page, check out other hosts on the local network, and view a useful backup SQL dump...\n\n### Lessons\n\nI took away a few things from this: sometimes, a 404 or redirect isn’t the end of the road. See if the server still has some pages left lying around that you can exploit. Furthermore, think about how you can chain vulnerabilities to hit the RCE holy grail. Next, back up your RCE by looking for sensitive information or horizontal escalation opportunities on the server. Are there other hosts on the network? Clues in `/etc/passwd`? The opportunities are endless.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":442757,"username":"spaceraccoon","name":"spaceraccoon","bio":"Here to learn!","cleared":true,"website":"https://spaceraccoon.dev/","location":"Singapore","created_at":"2018-12-20T11:15:48.390Z","url":"https://hackerone.com/spaceraccoon","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}