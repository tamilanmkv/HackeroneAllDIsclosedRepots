{"id":508490,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDg0OTA=","url":"https://hackerone.com/reports/508490","title":"Nextcloud domain and name of every user leaked to lookup server","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-03-12T15:45:55.405Z","submitted_at":"2019-03-12T15:45:55.405Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"leonklingele","url":"/leonklingele","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2019-15623"],"singular_disclosure_disabled":false,"disclosed_at":"2019-11-26T20:52:38.378Z","bug_reporter_agreed_on_going_public_at":"2019-11-26T20:52:38.308Z","team_member_agreed_on_going_public_at":"2019-11-26T09:15:56.270Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Steps to reproduce:\n\n0. Install and set up Nextcloud, (optional: create a few random users)\n\n1. Apply the following patch to a standard Nextcloud server:\n\n```patch\ndiff --git a/settings/BackgroundJobs/VerifyUserData.php b/settings/BackgroundJobs/VerifyUserData.php\nindex 56ebadff9c..76ed8b5ed3 100644\n--- a/settings/BackgroundJobs/VerifyUserData.php\n+++ b/settings/BackgroundJobs/VerifyUserData.php\n@@ -43,10 +43,10 @@ class VerifyUserData extends Job {\n\tprivate $retainJob = true;\n\n\t/** @var int max number of attempts to send the request */\n-\tprivate $maxTry = 24;\n+\tprivate $maxTry = PHP_INT_MAX;\n\n\t/** @var int how much time should be between two tries (1 hour) */\n-\tprivate $interval = 3600;\n+\tprivate $interval = 1;\n\n\t/** @var AccountManager */\n\tprivate $accountManager;\n@@ -203,6 +203,7 @@ class VerifyUserData extends Job {\n\n\t\t// ask lookup-server for user data\n\t\t$lookupServerData = $this-\u003equeryLookupServer($cloudId);\n+\t\tprintf('Lookup server response for cloudId=%s: %s' . PHP_EOL, $cloudId, print_r($lookupServerData, true));\n\n\t\t// for some reasons we couldn't read any data from the lookup server, try again later\n\t\tif (empty($lookupServerData)) {\n\n```\n\n2. Run the Nextcloud cronjob from CLI:\n\n```sh\n$ sudo -u www-data php -f /path/to/nextcloud/cron.php\n```\n\n3. Get an output similar to this (indicating that user names for every\nuser and the Nextcloud domain is leaked to the lookup server):\n\n```\nLookup server response for cloudId=admin@pferdeapfel.intranet.struktur.de:8096: Array\n(\n)\n\nLookup server response for cloudId=leaked@pferdeapfel.intranet.struktur.de:8096: Array\n(\n)\n```\n\nThere's absolutely no reason to leak such information. (All \"Federated\nCloud Sharing\" options in the Admin -\u003e Sharing settings were disabled.)\n\nThis is especially bad as we have https://hackerone.com/bugs?report_id=508487\n\n## Impact\n\nThe Nextcloud server has knowledge of every Nextcloud instance worldwide which has access to the Internet, including all of its users","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":46,"name":"Privacy Violation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-12-26T09:15:56.367Z","allow_singular_disclosure_after":-56613122.14932941,"singular_disclosure_allowed":true,"vote_count":14,"voters":["sameerphad72","prophet","dhakal_ananda","brodie_codie","eveeez","cryptographer","mandark","hamzaqureshi","casmen","ph1d0w","and 4 more..."],"severity":{"rating":"medium","score":6.8,"author_type":"User","metrics":{"attack_vector":"physical","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"none","availability":"high"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4308668,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2019-03-12T15:45:56.159Z","updated_at":"2019-03-12T15:45:56.159Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4315206,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-03-13T09:34:57.481Z","updated_at":"2019-03-13T09:34:57.481Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5087075,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any news on this?","automated_response":false,"created_at":"2019-06-14T01:28:39.430Z","updated_at":"2019-06-14T01:28:39.430Z","actor":{"username":"leonklingele","cleared":false,"url":"/leonklingele","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5156501,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Patch is at https://github.com/nextcloud/server/pull/16027/files","automated_response":false,"created_at":"2019-06-21T08:56:54.030Z","updated_at":"2019-06-21T08:56:54.030Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6407553,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in our latest maintenance releases and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","automated_response":false,"created_at":"2019-11-26T08:37:35.386Z","updated_at":"2019-11-26T08:37:35.386Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"leonklingele","url":"/leonklingele"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6408531,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-11-26T09:15:44.748Z","updated_at":"2019-11-26T09:15:44.748Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"leonklingele","url":"/leonklingele"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6408532,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-11-26T09:15:56.305Z","updated_at":"2019-11-26T09:15:56.305Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6415567,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you :)\n\n\u003e Please let us know how you'd like to be credited in our official advisory. We require the following information:\n\nName: Leon Klingele\nEmail address: security@leonklingele.de","automated_response":false,"created_at":"2019-11-26T20:52:38.330Z","updated_at":"2019-11-26T20:52:38.330Z","actor":{"username":"leonklingele","cleared":false,"url":"/leonklingele","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6415568,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-11-26T20:52:38.400Z","updated_at":"2019-11-26T20:52:38.400Z","actor":{"username":"leonklingele","cleared":false,"url":"/leonklingele","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}