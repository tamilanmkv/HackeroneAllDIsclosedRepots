{"id":526570,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MjY1NzA=","url":"https://hackerone.com/reports/526570","title":"Bypassing push rules via MRs created by Email","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-04-04T14:31:52.538Z","submitted_at":"2019-04-04T14:31:52.538Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"xanbanx","url":"/xanbanx","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-10-01T11:03:04.209Z","bug_reporter_agreed_on_going_public_at":"2019-10-01T11:03:04.136Z","team_member_agreed_on_going_public_at":"2019-10-01T09:14:57.166Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi GitLab Security Team,\n\nGitLab EE has the feature of so-called push rules. An administrator, or more fine-grained per project, the owner can create certain push rules. The goal of these push rules is avoiding to push certain commits to the repository, which violate one of the push rules. If a commit violating one of the push rules is pushed to the repository, a pre-check gets executed, which decides a commit attempt should be rejected. Therefore, the user gets an error message indicating the commit does not follow the rules.\n\nOn the other hand, GitLab supports creating merge requests by writing an email address to a special address. If the email contains a `.patch` file as an attachment, the commits from this patch file are applied and pushed to the Repo. \n\nHowever, this step does not check for the push rules. This allows creating commits with content, that violates the configured push rules. It allows for example to push commits violating the commit message syntax, pushing an unsigned commit, pushing unwanted content (blacklisted secret files or bypassing regex), commits from unverified users, ...\n\n## Steps to reproduce\n\nTested on GitLab.com 11.9.4-ee with a Gold Trial.\n\n1. Create a repository with a Readme initialized\n2. You then have to create one dummy merge request, e.g, by pushing some branch and create a new MR. The only purpose is that the empty state of `https://example.gitlab.com/\u003cnamespace\u003e/\u003cproject\u003e/merge_requests` does not show the incoming merge request email, which is required for the later steps.\n3. Go to `https://example.gitlab.com/\u003cnamespace\u003e/\u003cproject\u003e/merge_requests`. At the bottom, there is a link opening a modal, which shows you the incoming merge request email. This email address looks similar to `incoming+\u003cnamespace\u003e-\u003cproject-name\u003e-\u003cproject-id\u003e-\u003ctoken\u003e-request@incoming.example.gitlab.com`\n4. Configure the push rules of the project under `https://example.gitlab.com/\u003cnamespace\u003e/\u003cproject\u003e/settings/repository`\n   * Check `Committer restriction`\n   * Check `Reject unsigned commits`\n   * Check `Check whether author is a GitLab user`\n   * Check `Prevent committing secrets to Git`\n   * Change `Commit message` to `Fixes \\d+\\..*`\n   * Change `Commit message negative match` to `ssh\\:\\/\\`\n   * Change `Commit author's email` to `@example.com$`\n   * Change `Prohibited file names` to `(jar|exe)$`\n5. Now clone the repo locally\n6. In the local repo, create a branch named `bypass`, create a new file `test.exe` and a new file `id_dsa`\n7. Add all created file to the git repo and commit it (unsigned) with the commit message `Bypassing push rules ssh://foo.bar`\n8. Create a git patch of the last commit by using the command `git format-patch -n HEAD^`\n9. Open the patch file and change the `From` line to e.g. `Lin Jen \u003clin@yen.com\u003e`. Of course, you could also change the commit auther and commiter email git before. \n10. Create and send a new Email with the following content\n  * Recipient address: Merge email address from above (Step 3)\n  * Subject: bypass\n  * Body: MR bypassing the push rules\n  * Attachment: The patch file created before\n11. The email created a new merge request with\n  * a commit, which is unsigned \u003c- violating the rule that othe commit message rulere accepted\n  * a commit from Lin Jen (lin@yen.com) \u003c- violating the author's email rule\n  * a commit from Lin Jen (lin@yen.com) \u003c- violating the rule that only verified emails can be used in pushed commits\n  * a commit from Lin Jen (lin@yen.com) \u003c- violating the rule whether the author is a GitLab user\n  * a commit with message `Bypassing push rules ssh://foo.bar` \u003c- violating the commit message rule\n  * a commit with message `Bypassing push rules ssh://foo.bar` \u003c- violating the commit message negative match\n  * a file `test.exe` \u003c- violating the prohibited file names rule\n  * a file `id_dsa` \u003c- violating the secrets rule\n\nThe only push rule, which seems to be enforced is the branch name push rule.\n\n## Expected behavior\n\nPush rules are enforced also for commits created by an email. The email should be rejected since it violates at least one push rule.\n\nBest regards,\nXanbanx\n\n## Impact\n\nThis allows anyone to bypass push rules set up by an administrator or project owner. This can lead to secrets being pushed to the repo, commits created by unknown users, etc","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":33,"voters":["ras-it","sameerphad72","spam404","ali","puppykok","vaib25vicky","cr4xerbik4sh","maruthi12","cryptographer","roskyfrosky","and 23 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4477899,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @xanbanx,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 20 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-04-04T15:20:47.165Z","updated_at":"2019-04-04T15:20:47.165Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4478397,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"After thinking about it, I think it is more a medium one but I let you decide.","automated_response":false,"created_at":"2019-04-04T16:16:06.936Z","updated_at":"2019-04-04T16:16:06.936Z","actor":{"username":"xanbanx","cleared":false,"url":"/xanbanx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4636059,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-04-24T18:27:25.496Z","updated_at":"2019-04-24T18:27:25.496Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":334445,"new_severity_id":357200},"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4636145,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab-ee/issues/11302.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-04-24T18:42:32.703Z","updated_at":"2019-04-24T18:42:32.703Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4645994,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @xanbanx,\n\nThe GitLab issue created from your report is currently scheduled for 2019-07-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-04-26T06:41:52.964Z","updated_at":"2019-04-26T06:41:52.964Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5508458,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @xanbanx,\n\nThe GitLab issue created from your report is currently scheduled for 2019-08-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-08-06T04:31:37.084Z","updated_at":"2019-08-06T04:31:37.084Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5543274,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @xanbanx,\n\nThe GitLab issue created from your report is currently scheduled for 2019-09-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-08-10T04:22:23.937Z","updated_at":"2019-08-10T04:22:23.937Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5594882,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThank you again for the report! Your finding has been reviewed and we are awarding a bounty. Apparently this issue had been fixed indirectly in previous versions of GitLab, but we're adding a more robust fix in the upcoming security release.\n\nWe will continue to keep you updated via HackerOne as a fix is scheduled.\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-08-16T23:21:00.328Z","updated_at":"2019-08-16T23:21:00.328Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5594883,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-08-16T23:21:19.744Z","updated_at":"2019-08-16T23:21:19.744Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"3000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"xanbanx","url":"/xanbanx"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5606670,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks \u003c3","automated_response":false,"created_at":"2019-08-19T12:24:00.194Z","updated_at":"2019-08-19T12:24:00.194Z","actor":{"username":"xanbanx","cleared":false,"url":"/xanbanx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5722640,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you again for reporting this issue! Your finding has been patched in GitLab version 12.2.3.\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-09-03T21:14:35.611Z","updated_at":"2019-09-03T21:14:35.611Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"xanbanx","url":"/xanbanx"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5928443,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-10-01T09:14:57.190Z","updated_at":"2019-10-01T09:14:57.190Z","first_to_agree":true,"actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5929855,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-10-01T11:03:04.166Z","updated_at":"2019-10-01T11:03:04.166Z","actor":{"username":"xanbanx","cleared":false,"url":"/xanbanx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5929856,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-10-01T11:03:04.236Z","updated_at":"2019-10-01T11:03:04.236Z","actor":{"username":"xanbanx","cleared":false,"url":"/xanbanx","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}