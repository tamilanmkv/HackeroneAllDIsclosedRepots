{"id":565883,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NjU4ODM=","url":"https://hackerone.com/reports/565883","title":"Bypass Email Verification -- Able to Access Internal Gitlab Services that use Login with Gitlab and Perform Check on email domain","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-05-04T05:48:45.353Z","submitted_at":"2019-05-04T05:48:45.353Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ngalog","url":"/ngalog","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/074/607/68068f139c99d98e3e8baf0a51f219c29ade1769_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2019-5473"],"singular_disclosure_disabled":true,"disclosed_at":"2019-08-30T22:54:54.002Z","bug_reporter_agreed_on_going_public_at":"2019-08-30T22:54:53.951Z","team_member_agreed_on_going_public_at":"2019-08-30T22:53:19.679Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\nHi, I found the new SCIM provisioning function allows any group owner in gitlab to create any user with verified email address. i.e. I can create user with email address ngalog@gitlab.com, and gitlab.com will think ngalog@gitlab.com is verified already.\n\nThis will bring problem to the client app that uses Gitlab as Identity Provider, and check if the user's email domain matches `@gitlab.com`, then using this email verification bypass, we can access the service now.\n\nI used to have a list of internal services/sites of gitlab uses gitlab.com to sign in and check if the signed in user has @gitlab.com as their email domain. But I can't find them any more, I am sure gitlab security team know what are those services. And exposure of those services would bring a high security impact to gitlab infrastructure.\n\n### Steps to reproduce\n- In gitlab.com, upgrade your Group plan to gold\n- Visit `https://gitlab.com/groups/GROUP_PATH/-/saml` and setup the SAML SSO as documented\n- Same page, create SCIM token\n- Use the same SCIM token to issue the request below\n\n```\nPOST /api/scim/v2/groups/YOUR_GROUP_NAME/Users HTTP/1.1\nHost: gitlab.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:66.0) Gecko/20100101 Firefox/66.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/scim+json\nAuthorization: Bearer YOUR_SCIM_TOKEN\nContent-Length: 291\n\n{\"externalId\":\"REPLACE_ME\",\"active\":null,\"userName\":\"anyusernamewilldo\",\"emails\":[{\"primary\":true,\"type\":\"work\",\"value\":\"ANYGITLABEMAIL@gitlab.com\"}],\"name\":{\"formatted\":\"Test User\",\"familyName\":\"User\",\"givenName\":\"Test3\"},\"schemas\":[\"urn:ietf:params:scim:schemas:core:2.0:User\"],\"meta\":{\"resourceType\":\"User\"}}\n```\n\n- And open a new private window and use https://gitlab.com/groups/GROUP_NAME/-/saml/sso?token=xqz82m-b to login using the externalId specified in the POST JSON body\n- Now you are logged in as the newly created user and bypassed the email verification process\n\n\n\n### Impact\n\nI used to have a list of internal services/sites of gitlab uses gitlab.com to sign in and check if the signed in user has @gitlab.com as their email domain. But I can't find them any more, I am sure gitlab security team know what are those services. And exposure of those services would bring a high security impact to gitlab infrastructure.\n\n### Examples\n\nCheck the user username4 on gitlab.com, you will see his email address is ngalog@gitlab.com and verified.\n\n### What is the current *bug* behavior?\n\nEmail is verified without going through the verification process\n\n### What is the expected *correct* behavior?\n\nEmail should not be verified using this method\n\n### Relevant logs and/or screenshots\n\n{F484033}\n\nThis bug happens on GitLab.com\n\n#### Results of GitLab environment info\n\nThis bug happens on GitLab.com)\n\n## Impact\n\nsee above","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":133,"name":"Reliance on Untrusted Inputs in a Security Decision"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":484033,"file_name":"Screen_Shot_2019-05-04_at_5.47.01_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/033/a83081d9ef1a03cb22e98f8d6aa2e120946cc15f/Screen_Shot_2019-05-04_at_5.47.01_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2019-05-04_at_5.47.01_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2019-05-04_at_5.47.01_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXEQ3VCGF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151114Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCNbr25hK1JC2i73IX5uE08m1agZwA%2BCyxTPtXmxpZHFAIgA9v21iU9rOtKWjxfMHo7kqQOL4Y8ABbAnucRVLpaC9cqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDOyim%2FBwzSkIWBPCWirXA1TUfPlTIAz6iDfoaiiMP8hivTDD8uDyRJ%2FoAF5UW%2F6cSrWHj2Mtt%2Fx8tKTYSGoQiyhUdi%2BFdxLY35ZRGqE5k10GcpBa5q9ivBUHzTLtIbzvkVLjo0GDs33RjPyv8lT8%2BIT3cR1GpHz5sKugzk1wJHpaXHIGV7TsNZTez5PsxRWLAbodD46%2Bv0aY9dXICvo8Bld1OIiDoUsI3sX2R7SAEjL0B45opfmY7Hh4KKVF9KyCf7etmcGEL0U%2Bjij5TfmuHRxoVJXFKR4WbBKoHXN3cL5AQhAkGBE5bmE6cTsvfhMkCltMfmR1OmQtt1QK7fs2YWSyJhNNnjgzseVzroJk8qcktNvGQQNtmAz%2F0hi%2BbLDdR3r35MBTZtRPxGxwfYKfk%2Blyikhar%2F%2FfPxr6sJoQhbcKSjiziR8cFwFPC97f3qfgH6sVJVvH5AClhLDj9FMqequ01uI1FMQI%2BQ1BJ1t%2Bl3dX7D09OZCMRrk3HvidiN7al4fmx5e0pKMz7tbb23gSzvgiMJbXeHgATiARA8dz6JIoLosFubesB7ZLWq9owsMVaP42CuihB%2Br9J9vu1HkgY4lcWvgRt8bqCjXjWDPBzlNcnc9D32bMJUDfp2BWdJ0BCnpEi4XjrDCyiJGLBjqlAbw%2BQzzkBo5pgpwg2B9K3Kb9khz80zQhxWTR4UFlyZpApeXe135MxtRrVWf1VeEC8qBZynSiicNEE5qSEPmd%2FKNSihzfYJ9PmbUkfZN9yFsrIArapjiCpWMywbnOVNeLSHMFFv8xtfh0sOTI4VetTtHS5BxyHny%2BvnXM6Hjudg5tfOAvbwkv9j%2BTfq0Y0YGFWvyUNrCeX3Y3zQ5t8ked%2FqOvxUSYeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a2e1e5d31dec97c52b182d3210cbb2ec4494946c092386aeaf8785a011bb4074","file_size":139145,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":229,"voters":["sky003","xypex","j4v40n654n","spaceraccoon","c1phy","karma7","securitychops","mashoud1122","fqdn","inhibitor181","and 219 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4740024,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ngalog,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 20 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-05-04T06:22:16.596Z","updated_at":"2019-05-04T06:22:16.596Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4866397,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2019-05-17T11:33:24.473Z","updated_at":"2019-05-17T11:33:24.473Z","additional_data":{"added_weaknesses":[{"id":133,"name":"Reliance on Untrusted Inputs in a Security Decision"}],"removed_weaknesses":[]},"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4866619,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab-ee/issues/11643.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-05-17T12:41:19.234Z","updated_at":"2019-05-17T12:41:19.234Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4951936,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @ngalog,\n\nThe GitLab issue created from your report is currently scheduled for 2019-09-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-05-30T04:39:50.049Z","updated_at":"2019-05-30T04:39:50.049Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4958077,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @ngalog,\n\nThe GitLab issue created from your report is currently scheduled for 2019-07-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-05-31T05:27:06.716Z","updated_at":"2019-05-31T05:27:06.716Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5594841,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-08-16T23:10:02.663Z","updated_at":"2019-08-16T23:10:02.663Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":376093,"new_severity_id":494669},"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5594842,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThank you again for the report! Your finding has been patched in GitLab version 12.1.2 and we are awarding a $3000 bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-08-16T23:10:13.829Z","updated_at":"2019-08-16T23:10:13.829Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ngalog","url":"/ngalog"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5594843,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-08-16T23:10:22.915Z","updated_at":"2019-08-16T23:10:22.915Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"3000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"ngalog","url":"/ngalog"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5701572,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hello @ngalog,\n\nNow that it has been 30 days since a fix was released for this finding, we would like to publicly disclose this report.\n\nPlease note that [the GitLab issue](https://gitlab.com/gitlab-org/gitlab-ee/issues/11643) for this report has now been set to public. If you see any sensitive information that needs to be redacted or removed in that GitLab issue or this report, please let me know here.\n\nThanks again for helping make GitLab more secure.\n\nHave a great day,\nAndrew\nSecurity Team | GitLab","automated_response":false,"created_at":"2019-08-30T22:53:19.707Z","updated_at":"2019-08-30T22:53:19.707Z","first_to_agree":true,"actor":{"username":"akelly","cleared":false,"url":"/akelly","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5701582,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Let’s do it","automated_response":false,"created_at":"2019-08-30T22:54:43.000Z","updated_at":"2019-08-30T22:54:43.000Z","actor":{"username":"ngalog","cleared":true,"url":"/ngalog","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/074/607/68068f139c99d98e3e8baf0a51f219c29ade1769_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5701585,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-08-30T22:54:53.974Z","updated_at":"2019-08-30T22:54:53.974Z","actor":{"username":"ngalog","cleared":true,"url":"/ngalog","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/074/607/68068f139c99d98e3e8baf0a51f219c29ade1769_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5701586,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-08-30T22:54:54.023Z","updated_at":"2019-08-30T22:54:54.023Z","actor":{"username":"ngalog","cleared":true,"url":"/ngalog","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/074/607/68068f139c99d98e3e8baf0a51f219c29ade1769_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}