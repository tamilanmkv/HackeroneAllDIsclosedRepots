{"id":629879,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82Mjk4Nzk=","url":"https://hackerone.com/reports/629879","title":"loader.js is not secure","state":"Closed","substate":"not-applicable","readable_substate":"N/A","created_at":"2019-06-26T07:59:20.338Z","submitted_at":"2019-06-26T07:59:20.338Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cdpython","url":"/cdpython","profile_picture_urls":{"small":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ2VjIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--3719e68b5fe165900dbf0bba51bdce48d42d3ba3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxOako0TmpKZUJqc0hWRG9KWTNKdmNFa2lEall5ZURZeUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--5a32c5e1066e20d71d20163dc760c4822febc2cd/%EB%A1%9C%EA%B3%A0.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22984,"url":"https://hackerone.com/nodejs","handle":"nodejs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Node.js","twitter_handle":"nodejs","website":"https://nodejs.org","about":"The Node.js JavaScript Runtime"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-06-11T12:19:49.586Z","bug_reporter_agreed_on_going_public_at":"2020-06-11T12:19:49.543Z","team_member_agreed_on_going_public_at":"2020-01-14T23:42:26.713Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n\nNode.js `loader.js` can be exploited by an attacker \n\n## The vulnerability\n\n`https://github.com/nodejs/node/blob/a33c3c6d33fa81fa59a5aa95246d7f599e6abdd3/lib/internal/modules/cjs/loader.js#L892`\n\n```js\nModule._initPaths = function() {\n  var homeDir;\n  var nodePath;\n  if (isWindows) {\n    homeDir = process.env.USERPROFILE; //It can be vulnerable!\n    nodePath = process.env.NODE_PATH;\n  } else {\n    homeDir = safeGetenv('HOME');\n    nodePath = safeGetenv('NODE_PATH');\n  }\n\n  var prefixDir;\n\n  if (isWindows) {\n    prefixDir = path.resolve(process.execPath, '..');\n  } else {\n    prefixDir = path.resolve(process.execPath, '..', '..');\n  }\n  var paths = [path.resolve(prefixDir, 'lib', 'node')];\n\n  //can be easily exploited  \n  if (homeDir) {\n    paths.unshift(path.resolve(homeDir, '.node_libraries'));\n    paths.unshift(path.resolve(homeDir, '.node_modules'));\n  }\n\n  if (nodePath) {\n    paths = nodePath.split(path.delimiter).filter(function pathsFilterCB(path) {\n      return !!path;\n    }).concat(paths);\n  }\n\n  modulePaths = paths;\n\n  Module.globalPaths = modulePaths.slice(0);\n};\n```\n\n`loader.js` added `%userprofile\\.node_moduels` and `%userprofile\\.node_libraries` to globalPaths.\n\nIt means following behavior can occur easily when tries to `require`\n\nyou can test like below\n\n```js\nC:\\Users\\cdpyt\\OneDrive\\Desktop\\rce\u003enode -v\nv12.4.0\n\nC:\\Users\\cdpyt\\OneDrive\\Desktop\\rce\u003enode\nWelcome to Node.js v12.4.0.\nType \".help\" for more information.\n\u003e require('a')\nThrown:\nError: Cannot find module 'a'\nRequire stack:\n- \u003crepl\u003e\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:623:15)\n    at Function.Module._load (internal/modules/cjs/loader.js:527:27)\n    at Module.require (internal/modules/cjs/loader.js:681:19)\n    at require (internal/modules/cjs/helpers.js:16:16) {\n  code: 'MODULE_NOT_FOUND',\n  requireStack: [ '\u003crepl\u003e' ]\n}\n\u003e\n```\n\nIt looks like normal behavior. \n\nBut some side effect exists.\n\nF516992\n\nlet's test like below\n\n```cmd\nmkdir %userprofile%\\.node_modules\ncd %userprofile%\\.node_modules\necho const { exec } = require('child_process').exec(\"notepad\") \u003e a.js\n\nC:\\Users\\cdpyt\\.node_modules\u003edir\n C 드라이브의 볼륨에는 이름이 없습니다.\n 볼륨 일련 번호: 1AAF-F852\n\n C:\\Users\\cdpyt\\.node_modules 디렉터리\n\n2019-06-26  오후 04:01    \u003cDIR\u003e          .\n2019-06-26  오후 04:01    \u003cDIR\u003e          ..\n2019-06-26  오후 04:01                60 a.js\n               1개 파일                  60 바이트\n```\n\nrun node and `require('a')`\n\nF516991\n\nIt is a really serious bug because many software uses nodes on Windows systems!\n\n`node` will attempt to install the library file under the node_modules in the current path or in the initialized path using `npm init`.\n\na special case is global installation with `npm install -g [package names]`\n\nglobal installation uses `%appdata%\\npm` path.\n\n```cmd\nC:\\Users\\cdpyt\\.node_modules\u003ewhere eslint\nC:\\Users\\cdpyt\\AppData\\Roaming\\npm\\eslint\nC:\\Users\\cdpyt\\AppData\\Roaming\\npm\\eslint.cmd\n```\n\nSo, on a Windows system, `node` does not need to use `%userprofile\\.node_modules` and `%userprofile\\.node_libraries` paths in general cases.\n\n`node` has really powerful features on Windows. \n\nIf this bug is exploited by malicious code, AV can be easily bypassed.\n\n\n## Steps To Reproduce:\n\n  1. installation node latest version(v12.4.0) on windows\n  2. copy and paste below commands to `cmd.exe`\n        ``` cmd\n        mkdir %userprofile%\\.node_modules\n        cd %userprofile%\\.node_modules\n        echo const { exec } = require('child_process').exec(\"notepad\") \u003e a.js\n        ```\n  3. run node and type `requrie('a')`\n  4. notpad.exe will be poped!\n\n\n## Suggested fix\n\n- Fix the `loader.js` \n```js\nif (isWindows) {\n    //homeDir = process.env.USERPROFILE;\n    nodePath = process.env.NODE_PATH;\n  } else {\n    homeDir = safeGetenv('HOME');\n    nodePath = safeGetenv('NODE_PATH');\n  }\n```\n\n## Supporting Material/References:\nThe executables were downloaded from the official web site.\n\n```cmd\nC:\\Users\\cdpyt\\.node_modules\u003enode -v\nv12.4.0\n```\n\n## Impact\n\nIf `require` does not find the current path of the module, the node tries to search the global path.\n\n`%userprofile%` path allows you to create a new JavaScript file.\n\nIf the target application uses `node` or` electron` and does not do absolute path checking before `require` every time, it is dangerous for potential attacks.\n\nAttackers should target applications that fail to load library files. However, these behaviors are easy to find.\n\nAn attacker can create JavaScript files in a variety of ways. This is a more safe way to create pe files.\n\nAfter the creation to a specific path a javascript file, the target system will permanently infect.","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":516991,"file_name":"notepad.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/516/991/f7dde5320f2a286081f5e24887f7e1588ceb0d0e/notepad.PNG?response-content-disposition=attachment%3B%20filename%3D%22notepad.PNG%22%3B%20filename%2A%3DUTF-8%27%27notepad.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151332Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8a8330c62d960ba087731c32b36ad0ad6fc52b2a05ea488267c4ca0f36da813d","file_size":9370,"type":"image/png"},{"id":516992,"file_name":"notfound.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/516/992/00270d740eb1095ef7ce9b383e84c211706e2347/notfound.PNG?response-content-disposition=attachment%3B%20filename%3D%22notfound.PNG%22%3B%20filename%2A%3DUTF-8%27%27notfound.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151332Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=28e03b90ad2d9d60b47bdb73ea495f22414dc874c50d4d954bf599a37ca314cb","file_size":115430,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["brahim_boufakri01","h2x0","weebcunt"],"structured_scope":{"databaseId":666,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/nodejs/node","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5200978,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm not understanding how this is a security problem, since there appears to be no privilege escalation. If an attacker has write-access to the user's directories, don't they already have total control? The attackers can replace the node executable, they can replace any of the js files that comprise the application's source (instead of putting js files into the default require path as you demonstrate). Also, an attacker that controls the startup environment already has the ability to inject arbitrary code via NODE_OPTIONS. \n```\n% echo 'console.log(\"attack!\")' \u003e r.js\n% node -e 'console.log(\"wave\")'\nwave\n% NODE_OPTIONS=\"-r ./r.js\" node -e 'console.log(\"wave\")'\nattack!\nwave\n```\n","automated_response":false,"created_at":"2019-06-26T17:21:09.325Z","updated_at":"2019-06-26T17:21:09.325Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5201241,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"hello! \nI'm not good at English. Please consider it.\n\nI understand and agree with your opinion. `node.js` itself is not a problem.\nHowever, many users use many applications built with `Electron`.\nand they use tons of third-party libraries.\nIn case, one of the libraries has a wrong code like\n```js\nxxx.js\n// doesn't exists current path `mytest.js`\nconst {awsome} = require('mytest');\n```\nabove code tries to search `%userprofile%\\.node_modules`. \nThis is because loader.js added the path.\n```js\n //can be easily exploited  \n  if (homeDir) {\n    paths.unshift(path.resolve(homeDir, '.node_libraries'));\n    paths.unshift(path.resolve(homeDir, '.node_modules'));\n  }\n```\nand then if i wrote  a file`%userprofile%\\.node_modules\\mytest.js`\n````js\necho const { exec } = require('child_process').exec(\"notepad\")\n```\nIn this case, you can continue to run arbitrary JavaScript code unlike adding environment variables.\n\non Windows system, ES5+ syntax javascript based malware does not exist.\nand the node.js has a powerful feature to interact with OS.\n\nI think can have a big problem in the node.js client ecosystem.\nYou can inject JavaScript code into software such as `slack, discord, vscode`\nBecause node.js already added  `%userprofile%\\.node_modules` and `%userprofile%\\.node_libraries` \n\nIf this software is installed in the path under `%ProgramFiles%` can be safer.\nWindows has a DACL\n\n```cmd\nC:\\Users\\cdpyt\u003eicacls %userprofile%\nC:\\Users\\cdpyt NT AUTHORITY\\SYSTEM:(OI)(CI)(F)\n               BUILTIN\\Administrators:(OI)(CI)(F)\n               DESKTOP-H9K1B8N\\cdpyt:(OI)(CI)(F)\n               Everyone:(RX)\n```\n\n%userprofile% is writeable with `DESKTOP-H9K1B8N\\cdpyt:(OI)(CI)(F)` permission\n\n```\nC:\\Users\\cdpyt\u003eicacls \"%ProgramFiles%\"\nC:\\Program Files NT SERVICE\\TrustedInstaller:(F)\n                 NT SERVICE\\TrustedInstaller:(CI)(IO)(F)\n                 NT AUTHORITY\\SYSTEM:(M)\n                 NT AUTHORITY\\SYSTEM:(OI)(CI)(IO)(F)\n                 BUILTIN\\Administrators:(M)\n                 BUILTIN\\Administrators:(OI)(CI)(IO)(F)\n                 BUILTIN\\Users:(RX)\n                 BUILTIN\\Users:(OI)(CI)(IO)(GR,GE)\n                 CREATOR OWNER:(OI)(CI)(IO)(F)\n                 APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(RX)\n                 APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(OI)(CI)(IO)(GR,GE)\n                 APPLICATION PACKAGE AUTHORITY\\모든 제한된 응용 프로그램 패키지:(RX)\n                 APPLICATION PACKAGE AUTHORITY\\모든 제한된 응용 프로그램 패키지:(OI)(CI)(IO)(GR,GE)\n```\nCurrent user is `BUILTIN\\Users:(RX)` so I can't write under %ProgramFiles% path before gain administrator privileges.\n\nabove software are trying load to the module from the current installation path.\n\nin these cases, an attacker can not inject javascript code.\n\nbecause if an attacker writes to file under `%ProgramFiles%`, they need to bypass UAC.\n\nbut `node`  added `%userprofile%\\.node_modules` and `%userprofile%\\.node_libraries` \n\nso an attacker can write a file without UAC bypass.\n\nI've attached simple PoC.\n\nThank you.  \n\n\n\n","automated_response":false,"created_at":"2019-06-26T18:20:59.638Z","updated_at":"2019-06-26T18:20:59.638Z","actor":{"username":"cdpython","cleared":false,"url":"/cdpython","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ2VjIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--3719e68b5fe165900dbf0bba51bdce48d42d3ba3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/%EB%A1%9C%EA%B3%A0.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":517321,"filename":"node.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/321/8d97267e70fb98193d7aff281d88b92a12df0657/node.mp4?response-content-disposition=attachment%3B%20filename%3D%22node.mp4%22%3B%20filename%2A%3DUTF-8%27%27node.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151332Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=26e426889ad838f453ca475a08b2e00d09d1730931b4b79256bca6394888ded7"}],"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5201728,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Your English is perfectly understandable.\n\nTo be clear, this behaviour is documented and has existed for years: https://nodejs.org/api/modules.html#modules_loading_from_the_global_folders\n\n\u003e \"I understand and agree with your opinion. node.js itself is not a problem. However, many users use many applications built with Electron.\"\n\nYou reported this to the Node.js project, not the Electron project. Shouldn't you report this as described in https://github.com/electron/electron/blob/master/SECURITY.md? They patch node, and could remove the global module paths.\n\n\u003e I think can have a big problem in the node.js client ecosystem.\n\u003e You can inject JavaScript code into software such as slack, discord, vscode\n\nYou cannot inject, not until the following unlikely scenario is arranged:\n1. A package exists that has an invalid (misspelled) require call\n2. The invalid require was never noticed, somehow. Global resolution occurs only if local resolution fails. On machines without the attack js in the global directories, both global and local resolution fails, and a fatal exception is thrown. How did this fatal exception not get noticed?\n3. An attacker has write access to the target user's home directories, and knows they are running an app with this problem.\n","automated_response":false,"created_at":"2019-06-26T20:04:11.047Z","updated_at":"2019-06-26T20:04:11.047Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5202987,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good Morning! \n\nI already know an attacker without permission to a victim system cannot create javascript code. \n`Arbitrary file Write` is another vulnerability.\n\nBut I think this is a potential threat to the Windows node client.\nIt is similar to traditional Window DLL Hijacking.\n\nSo I just want to fix this issue. because this is can be exploited like my POC. F517321\n\nin Windows can do like this \nhttps://support.microsoft.com/en-au/help/2389418/secure-loading-of-libraries-to-prevent-dll-preloading-attacks\n```c\nDWORD retval = SearchPath(NULL, \"schannel\", \".dll\", err, result, NULL); \nHMODULE handle = LoadLibrary(result);\n```\n\nI think node also can do this before just added path.\n\n```js\nif (homeDir) {\n    [path.resolve(homeDir, '.node_libraries'),path.resolve(homeDir, '.node_modules')].map(\n\t(p) =\u003e fs.existsSync(p) ? \n                   paths.unshift(p) : \n                   console.log(`${p} is dosn't exsist on the system.`)\n    )\n}\n```\nabove code is safer because it verifies that the path exists before adding it.\n\nand I didn't know Electron has a deal with Security Issue.\n\nI will consider sending this issue to `Electron`\n\nthank you.","automated_response":false,"created_at":"2019-06-27T02:30:06.392Z","updated_at":"2019-06-27T02:30:06.392Z","actor":{"username":"cdpython","cleared":false,"url":"/cdpython","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ2VjIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--3719e68b5fe165900dbf0bba51bdce48d42d3ba3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/%EB%A1%9C%EA%B3%A0.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5206340,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Hi @cdpython,\n\nBased on your initial description, there do not appear to be any security implications as a direct result of this behavior. As already stated, this is a feature of Nodejs.\n\nYour effort is nonetheless appreciated and we wish that you'll continue to research and submit any future security issues you find. If you disagree, please reply with additional information describing your reasoning.\n\nKind regards,\n@beagle ","automated_response":false,"created_at":"2019-06-27T14:01:55.743Z","updated_at":"2019-06-27T14:01:55.743Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6772331,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-14T23:42:26.734Z","updated_at":"2020-01-14T23:42:26.734Z","first_to_agree":true,"actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8262997,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-11T12:19:49.565Z","updated_at":"2020-06-11T12:19:49.565Z","actor":{"username":"cdpython","cleared":false,"url":"/cdpython","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ2VjIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--3719e68b5fe165900dbf0bba51bdce48d42d3ba3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/%EB%A1%9C%EA%B3%A0.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8262998,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-06-11T12:19:49.612Z","updated_at":"2020-06-11T12:19:49.612Z","actor":{"username":"cdpython","cleared":false,"url":"/cdpython","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBZ2VjIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--3719e68b5fe165900dbf0bba51bdce48d42d3ba3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/%EB%A1%9C%EA%B3%A0.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}