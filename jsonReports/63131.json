{"id":63131,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MzEzMQ==","url":"https://hackerone.com/reports/63131","title":"Changeable model ids on vanilla update can lead to severely bad side-effects","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2015-05-20T19:16:40.094Z","submitted_at":"2015-05-20T19:16:40.094Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zachaysan","url":"/zachaysan","profile_picture_urls":{"small":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxOako0TmpKZUJqc0hWRG9KWTNKdmNFa2lEall5ZURZeUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--5a32c5e1066e20d71d20163dc760c4822febc2cd/me_square.jpg"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-02-12T18:05:34.617Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2015-06-08T17:45:33.066Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Proof of concept\r\n\r\n`User.find(1).update!(id: 1701)`\r\n\r\n\u003e But strong params!\r\n\r\nDisagree. There are cases where less experienced users will allow \"id\" as a param for a subnested resource and then copy and past that code into that subnested resource's own controller, forgetting to remove the \"id\".\r\n\r\nI consider this bug extremely severe since it is a very common pattern in most Rails JSON APIs and by setting the id to the maximum value may lead to the database to refuse to create new records OR in better databases like Postgres, an attacker can continue to stay just ahead of of the id sequence which will issue this error:\r\n\r\n`DETAIL:  Key (id)=(1701) already exists.`\r\n\r\nThis effectively stops any new content from being created with a very small number of attackers.\r\n\r\nI have also tried to think of a way that a user could gain access to information with this, but I think that it would have to be in a very weird way. For example a multiple associations table where both tables save their associations to each other then one of them gets deleted. Too unlikely to be a major concern.\r\n\r\nProposed solution:\r\n\r\nMake a special flag or special method for updating a model with a model id, but by default ignore \"id\" as a param. The reason I say \"ignore\" and not \"raise exception\" is that it is more convenient to not have to strip ids out of everything.","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-07-08T17:45:33.347Z","allow_singular_disclosure_after":-197587688.3465505,"singular_disclosure_allowed":true,"vote_count":3,"voters":["sw33tlie","cryptographer","arifbastian2017"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":426059,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, I have confirmed that it works through the params. So doing a `PATCH` to `/users/1` with a body of `\"user\": { \"id\": 1701 }` will successfully change the user id.","automated_response":false,"created_at":"2015-05-21T18:39:40.247Z","updated_at":"2015-05-21T18:39:40.247Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":426084,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also note that even if this is intended behaviour (which while I disagree with, I could maybe think of other areas where you would need to update primary ids and areas where rails apps currently use update instead of a different method) then it also breaks AMS or AR (note that \"dividers\" does not actually include the changed id, it contains the previous id):\n\nhttps://gist.github.com/zachaysan/20be5fae27f61ac282e7\n\nThinking about this more, I'm starting to think that there shouldn't be a way to change ids once they have been set. There might be cases where a resource needs something to complete on a different machine and saves both a nil \"real\" id and a temporary id, but once something saves I'm having trouble thinking of a reason why you would need to change an id. And even in some messed up case, like say a unique constraint wasn't enforced, I could see those more being done in a migration context than a production code context.","automated_response":false,"created_at":"2015-05-21T19:00:21.013Z","updated_at":"2015-05-21T19:00:21.013Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":426094,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, I have another thought about how I would detect compromisable systems out in the wild:\n\nInstead of saving the resource with an arbitrarily large number which may be picked up by a data analyst or something, I would systematically create resources, get the id of each resource, then create a replacement resource and attempt to save it with the previous resource's id. If successful, I'm decently assured that the system is compromisable. This information could be stored and saved for a coordinated attack on multiple systems during a critical time with ransom demands sent to the site operators all at once. ","automated_response":false,"created_at":"2015-05-21T19:09:51.804Z","updated_at":"2015-05-21T19:09:51.804Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":426280,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Zach! Thanks for the report.\n\n`less experienced users will allow \"id\" as a param for a subnested resource`\n\nGot an example of this? I'm not sure I've seen that technique. Maybe someone transitioning from `attr_accessible`?\n\nThe update pattern is documented pretty clearly @ http://edgeapi.rubyonrails.org/classes/ActionController/StrongParameters.html, but strong params can certainly be used weakly. Def worth correcting any docs (or old practices) that steer users toward vulnerable usage.","automated_response":false,"created_at":"2015-05-21T21:41:08.372Z","updated_at":"2015-05-21T21:41:08.372Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":440832,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @zachaysan thank you for the report.\n\nI agree with @jeremy that the reported case if a misusage of the feature. To take an example, \"less experienced\" users can also allow \"admin\" as a params for a nested resource that also will lead to security problems.\n\nSo we should fix any documentation to be clear about the security implications of using strong parameters weakly, but I don't think we should deal with this as a security bug.\n\n","automated_response":false,"created_at":"2015-06-04T17:16:03.866Z","updated_at":"2015-06-04T17:16:03.866Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":440842,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Marking this as Won't fix. But fell free to keep discussing about how we can improve the documentation. \n\nThank you again for the report.","automated_response":false,"created_at":"2015-06-04T17:22:36.655Z","updated_at":"2015-06-04T17:22:36.655Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":441078,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey sorry for falling off, I'm in the midst of getting a product ready for launch. I think the core difference between \"admin\" as a param and \"id\" as a param is that \"id\" is frequently listed as a param when doing nested updates with frameworks like Ember. Furthermore I do not see the upside of allowing users to trivially change things like id. Also, it should be fairly easy to write a crawler to find Rails apps using Ember-like frameworks. I canvassed my friends in the Toronto Ember / Rails community and 100% of them agree that this mistake is quite possible to make and many of them were shocked that id was changeable (something that wasn't possible in previous versions of Rails).\n\nThat being said, I get that you guys made the call while fully understanding the problem. Maybe I'm biased in that I don't use Rails *without* a frontend framework. I'm going to forward it to my sec friends / blog about it. Thanks for taking the time to read this report and for the work you guys are doing.","automated_response":false,"created_at":"2015-06-04T20:18:39.664Z","updated_at":"2015-06-04T20:18:39.664Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":441080,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, can we mark this bug as public so I can share this link?","automated_response":false,"created_at":"2015-06-04T20:19:28.650Z","updated_at":"2015-06-04T20:19:28.650Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":444751,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@zachaysan I think we can still consider ways to address this problem discussing it openly so people affected by this patch can jump in the thread and give their inputs, and we don't introduce breaking changes in stable releases.\n\nDoes this plan sounds good to you? Could you open an issue in the Rails issue tracker or work in a PR?\n\nMeanwhile, I'm going to mark this report as public so we can link to it on the issue.","automated_response":false,"created_at":"2015-06-08T17:45:22.353Z","updated_at":"2015-06-08T17:45:22.353Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":444752,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-06-08T17:45:33.119Z","updated_at":"2015-06-08T17:45:33.119Z","first_to_agree":true,"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":444855,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@rafaelfranca I'm going to make it a priority to work on open source a set number of hours a week once I get this project out the door (end of this month hopefully). In the meantime I'm too busy to put together a pull request, but I'm very happy to open this as an issue so that others become aware of it.","automated_response":false,"created_at":"2015-06-08T18:34:18.875Z","updated_at":"2015-06-08T18:34:18.875Z","actor":{"username":"zachaysan","cleared":false,"url":"/zachaysan","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbE1UIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--7ed05c69c562401d6dd939baf28b3fc2de7e8460/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--77c08f2719fd83c761685e25b4e275ffff9dba3e/me_square.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":474476,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2015-06-16T19:04:15.611Z","updated_at":"2015-06-16T19:04:15.611Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Ruby on Rails"}},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":796028,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2016-02-12T18:05:34.432Z","updated_at":"2016-02-12T18:05:34.432Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}