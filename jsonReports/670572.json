{"id":670572,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NzA1NzI=","url":"https://hackerone.com/reports/670572","title":"Uncontrolled Resource Consumption in any Markdown field using Mermaid","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-08-09T13:54:02.818Z","submitted_at":"2019-08-09T13:54:02.818Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ryhmnlfj","url":"/ryhmnlfj","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2019-15584","CVE-2019-9220"],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-20T07:15:12.672Z","bug_reporter_agreed_on_going_public_at":"2019-12-20T07:15:12.572Z","team_member_agreed_on_going_public_at":"2019-12-13T13:20:25.196Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nI found a bypass for the mitigation of [DoS via Mermaid (CVE-2019-9220)](https://hackerone.com/reports/470067).\nAs the mitigation for [CVE-2019-9220](https://hackerone.com/reports/470067), the input limit of 5000 characters is currently applied to a Mermaid code block, but it can be bypassed by simply splitting the longer payload to **many** code blocks.\n\n### Steps to reproduce\n\n1. Sign in to GitLab.\n2. Open any page where you can input Markdown text using Mermaid into the form.\n3. Copy and paste the contents of the attached file (**\"payload-5Kchars-x-100blocks.txt\"**) to the input form.\n4. Save the Markdown text on the page you opened. (For example, click \"Comment\" on \"Issue\" page. Please see \"Example_on_Issue_page_Firefox.png\")\n5. Wait a few seconds for **many** Mermaid graphs to begin rendering.\n\n{F551168}\n\n### What is the current *bug* behavior?\n\nWhen rendering of the Mermaid graphs starts, the browser tab displaying the page freezes.\nThis behavior prevents browsing and editing the page that have been added the Mermaid graphs.\nAlso, the resources used by the browser tab will increase as rendering continues. In the worst case, the entire browser also freezes or crashes.\n\n### What is the expected *correct* behavior?\n\nWe need a mechanism to stop rendering in advance by detecting if the user's input contains a large number of Mermaid code blocks.\n\n### Relevant logs and/or screenshots\n\n* \"payload-5Kchars-x-100blocks.txt\" : This text contains 100 sets of Mermaid code blocks. Each code block contains approximately 5000 characters.\n* \"Example_on_Issue_page_Firefox.png\" : Screenshot when pasting the payload on \"Issue\" page.\n\n### Output of checks\n\nThis bug happens on the official Docker installation of GitLab Enterprise Edition `12.1.4-ee`.\nThe browsers used for testing are `Firefox 68` and `Chromium 76` on Ubuntu.\n\n#### Results of GitLab environment info\n\nOutput of `sudo gitlab-rake gitlab:env:info`:\n```\nSystem information\nSystem:\t\t\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.3p62\nGem Version:\t2.7.9\nBundler Version:1.17.3\nRake Version:\t12.3.2\nRedis Version:\t3.2.12\nGit Version:\t2.21.0\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.1.4-ee\nRevision:\t4ea82400e72\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.7\nURL:\t\thttp://gitlab.example.com\nHTTP Clone URL:\thttp://gitlab.example.com/some-group/some-project.git\nSSH Clone URL:\tgit@gitlab.example.com:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers: \n\nGitLab Shell\nVersion:\t9.3.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nThis vulnerability is effective not only on Issue pages but also on **all pages using Markdown with Mermaid**.\n\nThe following impacts exist on the attacked page:\n\n* All users can not view the attacked page. (In some situations, the users may see incomplete rendering of the attacked page, but the user's viewing is still significantly blocked.)\n* All users can not take any action on the attacked page.\n* Depending on the user's environment, crashing or freezing the entire browser may cause user data being edited to be lost.\n\nThese impacts are almost the same as [CVE-2019-9220](https://hackerone.com/reports/470067).\nThese are more malicious than other issues that can be handled with 500 errors.","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":551167,"file_name":"payload-5Kchars-x-100blocks.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/4F9hQLdVjjy3JMJK3suaanLc?response-content-disposition=attachment%3B%20filename%3D%22payload-5Kchars-x-100blocks.txt%22%3B%20filename%2A%3DUTF-8%27%27payload-5Kchars-x-100blocks.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTQR22CE2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151628Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHylhpFJOF4pRe7XlaDX6z3BLEup%2BswnNkaACr%2Fwjwr8AiASjuyeD0TYwrZA5sOldf5eC6UQrO8hSHC9jNR%2BVNumhyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMfK%2BofD1wJOHYcOUJKtcDnC3f8Y3jglGs7z8YlxF9bdYkYlsSrPxEkx9hDqtH%2BQ3u1daZrwyM6F3WHlk0a%2BWNezGk%2FnRxFWuvgXlXXAEBaCUWEe1UXv97gs6KKr%2F4fZ92%2FH3VXeVMioYLi220Z8qDdmiwSK2Z%2FPfK0nlRhO3v9Ee3r3C7BMq5B4DRnfxp0cJyzU%2FHbMNzQNjyO%2BlGzreHCzcyKBe%2FoFAr2W6xbLokCINrIUxMnvI9Mxs7SraD%2FF2sZw8Ln4uZ6aJweQoOPwsnYKkrRjb370Lt%2FREkrEj9pcgae0C9R5BTZegZaqNN6CzMkZfNHB7RmNrhJFg6j7%2BfPYLcWFNxzvJV9dbVJdocqrM5Jmi3hE47KOBrMSGuFrCha2vRk9P64hqfhM1GdDtMLFZZn5VqOJgdyVWZ8bTrZpmlBP%2FJ6YiHIaMTH8G%2FRndaRrVRAR8iOSqWok%2FikWajxMvcVA29H%2F5RznwCFPkLrSbv34tOiWcwVp50Yy3HjkGq4LnY67LMRRRIwThQ9vc%2BM3G9xlb7TwO6%2F3vE5U6azDCH6hDFQ3Xi8ZJVYrTOOWINnf%2BC3BIhvL8Uql%2FhI1vUmbQiAR01xN%2FdEQ9ReTSo0pfJ3SDSXhBXiwUW0IRKspJO189rJyI3MImNkYsGOqYBwdOGh60JXyl1FPj8jwEbnfg6var6H0hyaUwn%2B%2FnamMWODqDwoSJI6f0Q6RJHnQJo2gfc6OFgj1W2B%2FGcJDL4gMvwPBD8bBDDMSaZ3x1nqw%2FhzMwsaQP%2BTnUJEKAVQSe3o5Yvwzg%2FSvpNP%2By981FbIZs9aWoGNPHY48ZIUNdNLCWPS2PxNm9xHrAxEcqn8ib1XLvQQS%2FALl2CG36%2BewUP2tPIf%2BIPmw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=fa90eb73e5228c9a933af13efb70ba986caa72fc2ea466be7d232b2fd80164c4","file_size":501100,"type":"text/plain"},{"id":551168,"file_name":"Example_on_Issue_page_Firefox.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/kXYdEFvkD2gL5nZ8YWJjDnGh?response-content-disposition=attachment%3B%20filename%3D%22Example_on_Issue_page_Firefox.png%22%3B%20filename%2A%3DUTF-8%27%27Example_on_Issue_page_Firefox.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTQR22CE2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151628Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHylhpFJOF4pRe7XlaDX6z3BLEup%2BswnNkaACr%2Fwjwr8AiASjuyeD0TYwrZA5sOldf5eC6UQrO8hSHC9jNR%2BVNumhyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMfK%2BofD1wJOHYcOUJKtcDnC3f8Y3jglGs7z8YlxF9bdYkYlsSrPxEkx9hDqtH%2BQ3u1daZrwyM6F3WHlk0a%2BWNezGk%2FnRxFWuvgXlXXAEBaCUWEe1UXv97gs6KKr%2F4fZ92%2FH3VXeVMioYLi220Z8qDdmiwSK2Z%2FPfK0nlRhO3v9Ee3r3C7BMq5B4DRnfxp0cJyzU%2FHbMNzQNjyO%2BlGzreHCzcyKBe%2FoFAr2W6xbLokCINrIUxMnvI9Mxs7SraD%2FF2sZw8Ln4uZ6aJweQoOPwsnYKkrRjb370Lt%2FREkrEj9pcgae0C9R5BTZegZaqNN6CzMkZfNHB7RmNrhJFg6j7%2BfPYLcWFNxzvJV9dbVJdocqrM5Jmi3hE47KOBrMSGuFrCha2vRk9P64hqfhM1GdDtMLFZZn5VqOJgdyVWZ8bTrZpmlBP%2FJ6YiHIaMTH8G%2FRndaRrVRAR8iOSqWok%2FikWajxMvcVA29H%2F5RznwCFPkLrSbv34tOiWcwVp50Yy3HjkGq4LnY67LMRRRIwThQ9vc%2BM3G9xlb7TwO6%2F3vE5U6azDCH6hDFQ3Xi8ZJVYrTOOWINnf%2BC3BIhvL8Uql%2FhI1vUmbQiAR01xN%2FdEQ9ReTSo0pfJ3SDSXhBXiwUW0IRKspJO189rJyI3MImNkYsGOqYBwdOGh60JXyl1FPj8jwEbnfg6var6H0hyaUwn%2B%2FnamMWODqDwoSJI6f0Q6RJHnQJo2gfc6OFgj1W2B%2FGcJDL4gMvwPBD8bBDDMSaZ3x1nqw%2FhzMwsaQP%2BTnUJEKAVQSe3o5Yvwzg%2FSvpNP%2By981FbIZs9aWoGNPHY48ZIUNdNLCWPS2PxNm9xHrAxEcqn8ib1XLvQQS%2FALl2CG36%2BewUP2tPIf%2BIPmw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e33baf799b97193b234b32bb1aba2fbf057350e9c83dc5ca9f3b40df8bb5ffcc","file_size":58797,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":29,"voters":["base_64","sameerphad72","calderpwn","y000","cryptographer","0x08","klau5","sufyan2","k2decompiler","caprisun44","and 19 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5541852,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ryhmnlfj,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 7 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-08-09T22:19:55.268Z","updated_at":"2019-08-09T22:19:55.268Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5573463,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @ryhmnlfj,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab-ce/issues/66031. This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-08-14T09:55:34.076Z","updated_at":"2019-08-14T09:55:34.076Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5589770,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf,\nThank you for triaging!","automated_response":false,"created_at":"2019-08-16T09:43:54.459Z","updated_at":"2019-08-16T09:43:54.459Z","actor":{"username":"ryhmnlfj","cleared":false,"url":"/ryhmnlfj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5623411,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @ryhmnlfj,\n\nThe GitLab issue created from your report is currently scheduled for 2019-09-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-08-21T04:21:03.531Z","updated_at":"2019-08-21T04:21:03.531Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5948857,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello @ryhmnlfj,\n\nThank you again for the report! Your finding has been patched in GitLab version 12.3.2 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-10-03T07:33:35.500Z","updated_at":"2019-10-03T07:33:35.500Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ryhmnlfj","url":"/ryhmnlfj"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5948859,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-10-03T07:33:58.711Z","updated_at":"2019-10-03T07:33:58.711Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"ryhmnlfj","url":"/ryhmnlfj"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5974673,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf,\nThank you for bounty!","automated_response":false,"created_at":"2019-10-07T09:42:27.638Z","updated_at":"2019-10-07T09:42:27.638Z","actor":{"username":"ryhmnlfj","cleared":false,"url":"/ryhmnlfj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6541627,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-13T13:20:25.232Z","updated_at":"2019-12-13T13:20:25.232Z","first_to_agree":true,"actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6593910,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf,\nThanks for requesting disclosure. Let's disclose this report.","automated_response":false,"created_at":"2019-12-20T07:14:52.684Z","updated_at":"2019-12-20T07:14:52.684Z","actor":{"username":"ryhmnlfj","cleared":false,"url":"/ryhmnlfj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6593911,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-20T07:15:12.597Z","updated_at":"2019-12-20T07:15:12.597Z","actor":{"username":"ryhmnlfj","cleared":false,"url":"/ryhmnlfj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6593912,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-12-20T07:15:12.700Z","updated_at":"2019-12-20T07:15:12.700Z","actor":{"username":"ryhmnlfj","cleared":false,"url":"/ryhmnlfj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/564/715/09a17da22e888e053764acd1492f67b09d455e84_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}