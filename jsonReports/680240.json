{"id":680240,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82ODAyNDA=","url":"https://hackerone.com/reports/680240","title":"Stored XSS at Synthetics private locations (planted through location label or description)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-08-23T11:26:39.717Z","submitted_at":"2019-08-23T11:26:39.717Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skavans","url":"/skavans","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-13T15:29:51.085Z","bug_reporter_agreed_on_going_public_at":"2020-08-11T09:39:15.955Z","team_member_agreed_on_going_public_at":"2020-08-13T15:29:50.959Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey team,\n\nI've discovered stored XSS at Synthetics private locations list. The `Private locations` page contains a script with private locations metadata inside and the user-input of location label and description aren't properly escaped as you can see below:\n```html\n\u003cscript type=\"text/javascript\"\u003e\n        window._nr = {\"config\":{\"enforceBillingMultiplier\":2.0,\"environment\":\"production\",\"gaDates\":{\"infrastructure\":\"2016-11-16T00:00:00+00:00\"}, ... \"privateLocations\":{\"available\":true,\"successful\":true,\"privateLocations\":[{\"highSecurityMode\":false,\"private\":true,\"name\":\"2385914-xf8xssimg_srcxf8xss-F77\",\"label\":\"'\\\"xf8xss\u003e\u003cimg src=xf8xss\u003e\",\"slug\":\"2385914-xf8xssimg_srcxf8xss-F77\",\"shortCode\":\"xf8xssimg_srcxf8xss\",\"available\":true,\"deprecated\":false,\"aliased\":false,\"description\":\"\u003c/script\u003e\u003cscript\u003ealert(document.domain)\u003c/script\u003e\"}]},\"userId\":2552670,\"isNREmployee\":false}};\n      \u003c/script\u003e\n```\nSo, attacker (a user having access to private locations) can craft malicious private location and inject a payload into its label or description. Then, when the victim visits the private locations page, the payload will be executed.\n\n##Steps to reproduce\n1) Sign into the Synthetics app with account having access to Private Locations\n2) Add new private location with name `test` and description `test`\n3) Open this private location editing page **at the separate browser tab** and keep it open (it is needed because the payload breaks the legitimate page JS and the page becomes unusable, you could fix this later by editing this private location back at this saved tab)\n4) Open **one more** private location editing page (at other browser tab) and change private location description to `\u003c/script\u003e\u003cscript\u003ealert(document.domain)\u003c/script\u003e`\n5) Navigate to private locations list again and make sure the alert box is popped up\n{F563051}\n6) Change the malicious description back using a browser tab opened at step 3\n\n##Mitigation\nYou should properly escape the private location metadata before injecting them into the page.\n\n## Impact\n\nStored XSS","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":563051,"file_name":"______________2019-08-23___14.14.59.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/FZWXuGzR3nV4yoBuCrPsa7mb?response-content-disposition=attachment%3B%20filename%3D%22______________2019-08-23___14.14.59.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-08-23___14.14.59.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151709Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=7717f8bd56ce763591a222d2106f84bbea474db85e82e0c6d2fe71ea8fae4f4e","file_size":61599,"type":"image/png"}],"allow_singular_disclosure_at":"2020-09-10T09:39:15.991Z","allow_singular_disclosure_after":-34234673.9966053,"singular_disclosure_allowed":true,"vote_count":8,"voters":["wi11","sameerphad72","ali","cryptographer","pkhadka","036467383637","r7le","mr0bart"],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":4411,"asset_type":"URL","asset_identifier":"synthetics.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5647224,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-08-23T11:28:57.386Z","updated_at":"2019-08-23T11:28:57.386Z","additional_data":{"old_title":"Stored XSS at Synthetics private locations","new_title":"Stored XSS at Synthetics private locations (planted through location label or description)"},"actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5667645,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Found out while I was testing some of the other pages that you can totally break the synthetics UI if you use the payload `alert()\u003c/script\u003e\u003cscript` for the location label. Had to have the back end team rename the private location for me. Let me know if you run into any similar issues, so we can get them fixed for you. Always love your work, @skavans!","automated_response":false,"created_at":"2019-08-26T16:17:24.600Z","updated_at":"2019-08-26T16:17:24.600Z","actor":{"username":"jmcaleer","cleared":false,"url":"/jmcaleer","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5667665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @jmcaleer,\n\nI've tried to warn you about this behavior, I'm sorry if it was not clear enough :(\n\u003e3) Open this private location editing page at the **separate browser tab** and keep it open (it is needed because the payload breaks the legitimate page JS and the page becomes unusable, you could fix this later by editing this private location back at this saved tab)\n\nI've fixed this by myself, thanks ;)","automated_response":false,"created_at":"2019-08-26T16:20:29.243Z","updated_at":"2019-08-26T16:20:29.243Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5667764,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@skavans, your reproduction steps were on par! It was when I started messing around with the label of the locations that it broke (since that can't be changed). It was all on me, and I got a good laugh at having to ask the team to help me. Just wanted to let you know you can absolutely reach out to us if you find yourself in one of those predicaments.","automated_response":false,"created_at":"2019-08-26T16:34:30.033Z","updated_at":"2019-08-26T16:34:30.033Z","actor":{"username":"jmcaleer","cleared":false,"url":"/jmcaleer","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5667773,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@jmcaleer, ok, thank you :)","automated_response":false,"created_at":"2019-08-26T16:35:48.144Z","updated_at":"2019-08-26T16:35:48.144Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5667971,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Excellent work! Come again!\n\n{F567042}","automated_response":false,"created_at":"2019-08-26T17:04:14.326Z","updated_at":"2019-08-26T17:04:14.326Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","attachments":[{"id":567042,"filename":"break_the_piggy.gif","type":"image/gif","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/n8UmkamCtyGask3uVdJnfR4L?response-content-disposition=attachment%3B%20filename%3D%22break_the_piggy.gif%22%3B%20filename%2A%3DUTF-8%27%27break_the_piggy.gif\u0026response-content-type=image%2Fgif\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151710Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=761fd53844b93e6317797cb902ae45cda12cdcf683abbfaac1964bad0da033d2"}],"genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"skavans","url":"/skavans"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5741143,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The synthetics private location description is now HTML encoded, and the name can only be set to `A-Za-z0-9-_`. When you try to save the name with invalid characters the response will return 400, but it's not clear in the UI that it is a bad name. I've commented this in the ticket and hopefully the devs will fix it. But at least, there doesn't seem to be a security vulnerability anymore. ¯\\\\\\_(ツ)_/¯ \n\nI would see if they didn't encode the description in all the places. I checked around a bit, but I may have missed something.","automated_response":false,"created_at":"2019-09-05T17:29:59.739Z","updated_at":"2019-09-05T17:29:59.739Z","actor":{"username":"jmcaleer","cleared":false,"url":"/jmcaleer","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"skavans","url":"/skavans"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8902624,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-11T09:39:15.975Z","updated_at":"2020-08-11T09:39:15.975Z","first_to_agree":true,"actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8923170,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can we disclose this?","automated_response":false,"created_at":"2020-08-13T08:30:54.839Z","updated_at":"2020-08-13T08:30:54.839Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8927863,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-13T15:29:51.008Z","updated_at":"2020-08-13T15:29:51.008Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8927864,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-13T15:29:51.122Z","updated_at":"2020-08-13T15:29:51.122Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}