{"id":685491,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82ODU0OTE=","url":"https://hackerone.com/reports/685491","title":"Persistent XSS on favorite via filename","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-08-31T11:38:01.777Z","submitted_at":"2019-08-31T11:38:01.777Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-12-12T09:42:51.382Z","bug_reporter_agreed_on_going_public_at":"2019-12-12T09:42:51.343Z","team_member_agreed_on_going_public_at":"2019-12-05T08:44:12.276Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"CVSS\n----\n\nMedium 6.4 [CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)\n\nDescription\n-----------\n\nThe name of a file is echoed without encoding when favoring the file, leading to persistent XSS. \n\nPOC\n---\n\nTo place the payload:\n\n- Create a file called `test'\"\u003e\u003cimg src=x onerror=alert(document.location)\u003e.pdf` and upload it. \n\nTo trigger the payload:\n\n- click on ... next to the file followed by \"add to favorites\". The payload will trigger here.\n\n## Impact\n\nWith a successful attack, an attacker can access all data the attacked user has access to, as well as perform arbitrary requests in the name of the attacked user.","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-01-04T08:44:12.363Z","allow_singular_disclosure_after":-55838006.38862026,"singular_disclosure_allowed":true,"vote_count":3,"voters":["cryptographer","makatini","min4tor"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5704381,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2019-08-31T11:38:02.202Z","updated_at":"2019-08-31T11:38:02.202Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5710664,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I cant see the content being triggered,\nI just see that removing from favorites fails with:\n\n```\n Error: Syntax error, unrecognized expression: [data-dir=\"/test'\"\u003e\u003cimg src=x onerror=alert(document.location)\u003e.txt\"]\n```","automated_response":false,"created_at":"2019-09-02T08:41:58.884Z","updated_at":"2019-09-02T08:41:58.884Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5710674,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-09-02T08:42:41.582Z","updated_at":"2019-09-02T08:42:41.582Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5710849,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nickvergessen Right, you can't unfavor these files (which imho is a very low-level DOS issue). \n\nFor testing purposes, it might be easier to use a file named `\u003cimg src=x onerror=alert(1)\u003e.txt`. It triggers the same issue, but it can be unfavored. \n\nIs the CSP maybe blocking execution for you? The issue should be reproducible in any current version of Internet Explorer, or in a setup where an upstream system changes or removes the CSP (or for testing purposes, Firefox with csp disabled in about:config).","automated_response":false,"created_at":"2019-09-02T09:12:45.587Z","updated_at":"2019-09-02T09:12:45.587Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5711202,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Same thing here.\nWhat nextcloud version are you using please? :)","automated_response":false,"created_at":"2019-09-02T09:51:17.333Z","updated_at":"2019-09-02T09:51:17.333Z","actor":{"username":"brthnc","cleared":false,"url":"/brthnc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5711222,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@brthnc 16.0.3. I just saw that you released 16.0.4 already, but I sadly can't check that version right now as I'm  on vacation in a location with a bad internet connection.\n\nSorry about that! I'll get back to you on this at the end of the week at the latest.","automated_response":false,"created_at":"2019-09-02T09:57:19.605Z","updated_at":"2019-09-02T09:57:19.605Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5711319,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nickvergessen  ██████████████████████\n\n███████\n\nBest,\nFoobar7","automated_response":false,"created_at":"2019-09-02T10:15:04.023Z","updated_at":"2019-12-05T09:45:39.772Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5711617,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Sorry about that! I'll get back to you on this at the end of the week at the latest.\n\nNo worries!\nBecause I cannot reproduce any of the alert here. Only a js syntax error when remmoving from favourites :)\nI'll let you update this ticket when you're available again!","automated_response":false,"created_at":"2019-09-02T11:18:56.069Z","updated_at":"2019-09-02T11:18:56.069Z","actor":{"username":"brthnc","cleared":false,"url":"/brthnc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5725748,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@foobar7 if you dont mind, please report this as a separate issue, thanks :)","automated_response":false,"created_at":"2019-09-04T08:13:49.117Z","updated_at":"2019-09-04T08:13:49.117Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5726235,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nickvergessen done: #687630 :)","automated_response":false,"created_at":"2019-09-04T08:34:36.505Z","updated_at":"2019-09-04T08:34:36.505Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5752589,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @brthnc ,\n\nI can confim that the XSS issue was fixed in Nextcloud 16.0.4 already. The vulnerable line was in `/apps/files/js/tagsplugin.js:106`:\n\n    innerTagA.innerHTML = appName;\n\nWhich was replaced with:\n\n    innerTagA.innerHTML = _.escape(appName);\n\nThe very low-level DOS issue (can't unfavor certain files) still exists in 16.0.4 in the same file on line 72:\n    \n    $(listULElements).find('[data-dir=\"' + apppath + '\"]').remove();\n\nThe issue can be fixed by applying `_.escape` here as well:\n\n    $(listULElements).find('[data-dir=\"' + _.escape(apppath) + '\"]').remove();\n\nBest,\nFoobar7","automated_response":false,"created_at":"2019-09-07T08:32:12.692Z","updated_at":"2019-09-07T08:32:12.692Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5771218,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @foobar7,\n\nThanks for verifying it is fixed already in 16.0.4\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2019-09-10T13:21:50.981Z","updated_at":"2019-09-10T13:21:50.981Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5771219,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2019-09-10T13:22:06.200Z","updated_at":"2019-09-10T13:22:06.200Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5771224,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah I see the second one is still pending. Let me see what we can do there.","automated_response":false,"created_at":"2019-09-10T13:22:56.605Z","updated_at":"2019-09-10T13:22:56.605Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6471756,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Pull request at https://github.com/nextcloud/server/pull/18241","automated_response":false,"created_at":"2019-12-05T08:40:49.914Z","updated_at":"2019-12-05T08:40:49.914Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6471778,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in our latest maintenance releases.","automated_response":false,"created_at":"2019-12-05T08:42:43.841Z","updated_at":"2019-12-05T08:42:43.841Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6471785,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-05T08:44:12.304Z","updated_at":"2019-12-05T08:44:12.304Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6472055,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen ,\n\ncan you redact [this comment](https://hackerone.com/reports/685491#activity-5711319) before disclosure as it's related to an issue that isn't fixed yet?\n\nThanks!\nFoobar7","automated_response":false,"created_at":"2019-12-05T09:35:09.451Z","updated_at":"2019-12-05T09:35:09.451Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6472133,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It was quite a hassle as I can only copy single line strings, but it worked.","automated_response":false,"created_at":"2019-12-05T09:46:10.856Z","updated_at":"2019-12-05T09:46:10.856Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6530457,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"thanks!","automated_response":false,"created_at":"2019-12-12T09:42:51.358Z","updated_at":"2019-12-12T09:42:51.358Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6530458,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-12-12T09:42:51.396Z","updated_at":"2019-12-12T09:42:51.396Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}