{"id":689245,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82ODkyNDU=","url":"https://hackerone.com/reports/689245","title":"SSRF In plantuml (on plantuml.pre.gitlab.com)","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-09-06T00:02:52.414Z","submitted_at":"2019-09-06T00:02:52.414Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"plazmaz","url":"/plazmaz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-17T13:55:48.552Z","bug_reporter_agreed_on_going_public_at":"2019-09-10T17:39:21.873Z","team_member_agreed_on_going_public_at":"2020-08-17T13:55:48.419Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"\u003e NOTE! Thanks for submitting a report! Please replace *all* the (parenthesized) sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to triage and respond quickly, so be sure to take your time filling out the report!\n\n### Summary\n\nThe site https://plantuml.pre.gitlab.com is vulnerable to SSRF. While I haven't spun up an instance to test if gitlab's integration with plantuml is vulnerable to this, it seems feasible that it is, given a few facotrs:\n#1 The SSRF is due to a feature in plantuml\n#2 A PlantUML integration exists for gitlab community edition\n#3 Due to conversation in gitlab (https://gitlab.com/gitlab-org/release/framework/issues/448, https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/2163/) I believe this is a staging server for plantuml\n\n### Steps to reproduce\n\n(Step-by-step guide to reproduce the issue, including:)\n1. Visit the following link:\nhttps://plantuml.pre.gitlab.com/uml/Aov9B2hXKW02AvTyXUByt5I5ufBIj3Hhi9XYPbvoJcbAga96IKc1bRw-eP6vdW4G6bfP65WOS1MNv1TO0m00\n2. Note that the UML of the website is included\n\nNote: It seems that while I was testing, access to instance metadata (169.254.169.254) was blocked (or limited), as the server now returns an error after timing out for the following uml, where previously it returned information:\n```\n@startuml\nstart\n    :Do some stuff;\n    !include http://169.254.169.254/\nstop;\n@enduml\n```\n\n\n### Impact\nThis allows attackers to access internal endpoints and data. Additionally, had the instance metadata not been restricted, accessing that information would be feasible. Additionally, this will likely allow for bypassing of the block of /proxy mentioned in this issue: https://gitlab.com/gitlab-org/release/framework/issues/457\n\n### What is the current *bug* behavior?\n\nThe plantuml server returns data from internal addresses:\nhttps://plantuml.pre.gitlab.com/png/Aov9B2hXKW02AvTyXUByt5I5ufBIj3Hhi9XYPbvoJcbAga96IKc1bRw-eP6vdW4G6bfP65WOw7CLb-GNM0C0\n\n### What is the expected *correct* behavior?\nThe plantuml server does not allow link-local network includes via the `include` statement\n\n## Impact\n\nIt's difficult to say, but given the default plantuml installation allows for this SSRF, it's likely multiple on-premises installations would open a risk for SSRF once plantuml is enabled. This site also allows for accessing other resources on its network in its current state","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":12,"voters":["sky003","s3asarv3sh","ali","xko2x","naategh","khizer47","sa1tama0","cryptographer","enessltk","hodiecras","and 2 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5743469,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @plazmaz,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 10 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-09-06T00:19:50.389Z","updated_at":"2019-09-06T00:19:50.389Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5745496,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @plazamaz,\n\nThank you for this report.\nThere are indeed network controls that should restrict access to metadata information.\n\nGiven the point above and that plantuml is not yet available in production, we consider that there is no security impact today (pre.gitlab.com is a test infrastructure without any production data and out of scope of our bug bounty program).\n\nWe offer you to self-close this report within the next 3 days before we close it as `Informative`.\nPlease feel free to check again when plantuml is available in production.\n\nBest regards,\nGitLab Security Team\n","automated_response":false,"created_at":"2019-09-06T09:03:16.998Z","updated_at":"2019-09-06T09:03:16.998Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5748860,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Actually, plantuml is available in production, just not enabled in the cloud installation. This is something that can be enabled after GitLab 8.16: https://docs.gitlab.com/ee/administration/integration/plantuml.html. While that server may not be in scope, local gitlab installations **are**. Restricting network access within your servers is a bandaid fix for something that will impact customer installations.","automated_response":false,"created_at":"2019-09-06T16:47:34.345Z","updated_at":"2019-09-06T16:47:34.345Z","actor":{"username":"plazmaz","cleared":false,"url":"/plazmaz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5757126,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you truly feel this is not a risk to you, would you have any problem with me discussing the technique publicly? I feel that the use of plantuml as an attack vector is an interesting approach that I would like to talk about.","automated_response":false,"created_at":"2019-09-08T16:59:54.378Z","updated_at":"2019-09-08T16:59:54.378Z","actor":{"username":"plazmaz","cleared":false,"url":"/plazmaz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5759262,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @plazmaz,\n\nI have added this point to the agenda of our security team meeting tomorrow. I will come back to you with the result of our discussion.\n\nBest regards,\nGitLab Security Team\n\n\n","automated_response":false,"created_at":"2019-09-09T07:45:26.067Z","updated_at":"2019-09-09T07:45:26.067Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5773086,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hello @plazmaz,\n\nThank you again for the report. \nWe will address it by a documentation update to advice on mitigating SSRF risks. \nWe are awarding a corresponding bounty. Congratulations!\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n\n\n\n","automated_response":false,"created_at":"2019-09-10T17:22:14.695Z","updated_at":"2019-09-10T17:22:14.695Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"plazmaz","url":"/plazmaz"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5773201,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Closing report, documentation issue tracked at https://gitlab.com/gitlab-org/gitlab-ee/issues/18085","automated_response":false,"created_at":"2019-09-10T17:30:32.918Z","updated_at":"2019-09-10T17:30:32.918Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"plazmaz","url":"/plazmaz"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5773256,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Great, thanks. Requesting disclosure.","automated_response":false,"created_at":"2019-09-10T17:39:21.911Z","updated_at":"2019-09-10T17:39:21.911Z","first_to_agree":true,"actor":{"username":"plazmaz","cleared":false,"url":"/plazmaz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5834086,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @plazmaz,\n\nWe generally accept disclosure once the corresponding [issue](https://gitlab.com/gitlab-org/gitlab/issues/18085) is made public after it is closed.\n\nBest regards,\nGitLab Security Team\n\n","automated_response":false,"created_at":"2019-09-18T09:55:45.947Z","updated_at":"2019-09-18T09:55:45.947Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5837607,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yep, familiar with that policy, figured I'd request it so you can accept it once you're ready. Thanks!","automated_response":false,"created_at":"2019-09-18T16:57:04.522Z","updated_at":"2019-09-18T16:57:04.522Z","actor":{"username":"plazmaz","cleared":false,"url":"/plazmaz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8958292,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @plazmaz,\n\nWe added information in the documentation to bring attention to the SSRF risks of running PlantUML for self-hosted customers. It's available at https://docs.gitlab.com/ee/administration/integration/plantuml.html#security.\n\nI'm going to accept the disclosure request.\n\nThanks again for your report,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-08-17T13:55:48.445Z","updated_at":"2020-08-17T13:55:48.445Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8958293,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-17T13:55:48.584Z","updated_at":"2020-08-17T13:55:48.584Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":18174,"category":"researcher","content":"A staging server on gitlab supported rendering of PlantUML. I was able to use PlantUML to make internal network requests on this server. While this was not technically in scope, gitlab.com relies on network configuration to mitigate the SSRF risk plantuml presents via the `!include` function(which allows including remote resources). However, their standard setup instructions did not make it clear that this was a risk, and it is unlikely users configuring self-hosted gitlab instances would know to restrict network access to their PlantUML instance.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":84353,"username":"plazmaz","name":"Dylan Katz","bio":"https://twitter.com/Plazmaz","cleared":false,"website":"https://dylankatz.com","location":"","created_at":"2016-06-11T19:49:15.702Z","url":"https://hackerone.com/plazmaz","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/QggdQvoxRajRsjpzJJKMnuVh/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}