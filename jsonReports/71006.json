{"id":71006,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MTAwNg==","url":"https://hackerone.com/reports/71006","title":"authenticity_token is not random across page loads","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-06-15T21:59:03.591Z","submitted_at":"2015-06-15T21:59:03.591Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"alokmenghrajani","url":"/alokmenghrajani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1080,"url":"https://hackerone.com/airbnb","handle":"airbnb","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/080/0db09b4e448421e22dda1d9785fb6621a93f06e8_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/080/0db09b4e448421e22dda1d9785fb6621a93f06e8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Airbnb","twitter_handle":"","website":"https://www.airbnb.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-08-12T23:20:44.184Z","bug_reporter_agreed_on_going_public_at":"2015-07-13T23:20:31.066Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"In order to protect against the Breach attack, the authenticity token needs to be unique on every page load.\r\n\r\nA simple fix is to mask the token with some random bytes, which is what ruby on rails did in version 4.2.0 (the exact patch is here: https://github.com/rails/rails/pull/16570/files).\r\n\r\nairbnb.com seems vulnerable to this issue because I fetched the following random page multiple times:\r\nhttps://www.airbnb.com/rooms/1931946?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026s=ghzz\r\n\r\nand I got the same token value each time (V4$.airbnb.com$oUioAIJPa2w$X2TbhzBK2YeqJ_qslG6OAwiCVxcSjVzCD2-7LFNHuSs=).\r\n\r\nMy exact curl request was:\r\n`curl 'https://www.airbnb.com/rooms/1931946?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026s=ghzz' -H 'If-None-Match: W/\"d60ad9aa4e89657f0447a804518c1a29\"' -H 'Accept-Encoding: gzip, deflate, sdch' -H 'Accept-Language: en-US,en;q=0.8,fr;q=0.6' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Referer: https://www.airbnb.com/s/San-Francisco--CA--United-States?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026source=bb\u0026ss_id=gkjsa763' -H 'Cookie: mdr_browser=desktop; _gat=1; _csrf_token=V4%24.airbnb.com%24oUioAIJPa2w%24X2TbhzBK2YeqJ_qslG6OAwiCVxcSjVzCD2-7LFNHuSs%3D; li=1; roles=0; _airbed_session_id=cd371d2a26ad4577194a9bbc739724dc; __ssid=ad7458b1-5d5c-4cbe-acda-80f1f9a45f1b; _user_attributes=%7B%22curr%22%3A%22USD%22%2C%22guest_exchange%22%3A1%2C%22id%22%3A35902910%2C%22hash_user_id%22%3A%225579d181d8a70998cabac2dffa30357f276c2b7b%22%2C%22eid%22%3A%22TbtlRjB_yMfScyo6T2_3iBW8nitm7S3r_KddwmpQ4QsRRf9Hm9E8qxM2ArXBhoeW%22%2C%22num_msg%22%3A0%2C%22num_notif%22%3A1%2C%22num_h%22%3A0%2C%22name%22%3A%22%22%2C%22is_admin%22%3Afalse%2C%22can_access_photography%22%3Afalse%2C%22can_see_notifications%22%3Atrue%7D; flags=268439552; _pt=1--WyI1NTc5ZDE4MWQ4YTcwOTk4Y2FiYWMyZGZmYTMwMzU3ZjI3NmMyYjdiIl0%3D--6664eba4c9b01b58021e3e7ae2bde26168bb07c1; _ga=GA1.2.1614844616.1434404924; bev=1434404923_Iq4GK%2FBpvT8K5KAg; EPISODES=s=1434405205163\u0026r=https%3A%2F%2Fwww.airbnb.com%2Frooms%2F1931946%3Fcheckin%3D06%252F16%252F2015%26checkout%3D06%252F18%252F2015%26s%3Dghzz' -H 'Connection: keep-alive' -H 'Cache-Control: max-age=0' --compressed`\r\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-08-12T23:20:31.452Z","allow_singular_disclosure_after":-194543933.4096148,"singular_disclosure_allowed":true,"vote_count":1,"voters":["meispi"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":473391,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wanted to mention that the Breach attack allows an attacker to gain information about specific cipher text (e.g. csrf tokens) by looking at the compression ratio of various pages. The attack can be leveraged on https connection because even though tls 1.2 disabled compression, the web server usually compresses responses. An attacker needs to be able to either observe response page sizes or perform accurate timing measurements and deduct page sizes.\n\nYou can read more about Breach here: https://media.blackhat.com/us-13/US-13-Prado-SSL-Gone-in-30-seconds-A-BREACH-beyond-CRIME-Slides.pdf","automated_response":false,"created_at":"2015-06-15T22:21:35.557Z","updated_at":"2015-06-15T22:21:35.557Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":475508,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report.\n\nAs you mentioned, we are not using TLS compression in our SSL configuration, which I believe is required for the BREACH attack.  Simply using the same CSRF token for a particular page or action does not inherently make a site vulnerable to BREACH.  If you can provide additional evidence that we are vulnerable, we would be very interested to see it.  However, theoretical attacks (\"you MAY be vulnerable to XYZ\") are generally not in considered in scope for this program.\n\nThanks and good luck with your future bug hunting.","automated_response":false,"created_at":"2015-06-17T17:44:38.077Z","updated_at":"2015-06-17T17:44:38.077Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":475527,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"In the case of the csrf token, having compression enabled at the web server layer (http compression) is enough to leverage the attack.\n\nWhy do you think facebook.com, ruby on rails, github.com, hackerone.com, etc. all bother to randomize their csrf tokens? I'm highly confident that the work done at the tls compression layer is applicable in the http compression case.","automated_response":false,"created_at":"2015-06-17T17:58:45.456Z","updated_at":"2015-06-17T18:00:19.582Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":475754,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"A lack of randomized CSRF tokens is not in-an-of itself evidence of a sites's vulnerability to the BREACH attack. Randomizing CSRF tokens is one possible mitigation for this attack IF the vulnerability exists.  A different mitigation might be to disable HTTP compression altogether, or you add garbage values to the compressed response body to obfuscate the actual length of the response, or you take simply not have user input reflected int the response body, or one of several other methods.  A lack of any one of them does not indicate a vulnerability.\n\nThe are several requirements for exploitation of this vulnerability:\n1. The application must support HTTP compression and the length of the response must be the same with each page load.\n2. The response should reflect back some user controlled input.  If user input is not reflected, there is no possible way to mount a chosen plaintext attack and measure the size of the responses.\n3. The response should have some sensitive information (i.e. the CSRF token) in the body\n\nIf you can demonstrate that an authenticated page on this site meets all of these requirements and that there are no additional mechanisms in place to mitigate a BREACH attack, then please provide a proof of concept.  \n\nThanks, and good luck with your future bug hunting.","automated_response":false,"created_at":"2015-06-17T20:23:08.151Z","updated_at":"2015-06-17T20:23:08.151Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":475859,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"1- airbnb.com supports HTTP compression. Proof:\ncurl 'https://www.airbnb.com/rooms/1931946?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026s=ghzz\u0026x=foobar' -H 'Pragma: no-cache' -H 'Accept-Encoding: gzip, deflate, sdch' -H 'Accept-Language: en-US,en;q=0.8,fr;q=0.6' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Cache-Control: no-cache' -H 'Cookie: __ssid=e0841bf9-35c3-46c1-beb3-c7630641beb7; _pt=1--WyIwODg5OTY5ZjlmMmFhNjU2NmVmZGEwNzg2ZTI4NWU0MzZlYWM4MDc3Il0%3D--f3f015ea0bffde7d657c25abde152e7aaacfdf47; _csrf_token=V4%24.airbnb.com%24NxrT0S96TiA%2472utwUttwg2FJh980_peFBXJ6BsYSPvpHIIyCNJovX0%3D; _user_attributes=%7B%22curr%22%3A%22USD%22%2C%22guest_exchange%22%3A1%7D; mdr_browser=desktop; _gat=1; _ga=GA1.2.1759723632.1432186475; bev=1432186475_B85ypB1UqTI6K0fS; flags=268439552; EPISODES=s=1434577305346\u0026r=https%3A%2F%2Fwww.airbnb.com%2Frooms%2F1931946%3Fcheckin%3D06%252F16%252F2015%26checkout%3D06%252F18%252F2015%26s%3Dghzz%26x%3Dfoobar' -H 'Connection: keep-alive'\n\nreturns gzipped data.\n\n2- the page reflects back the URL, so there is user controlled input in the page.\ncurl 'https://www.airbnb.com/rooms/1931946?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026s=ghzz\u0026x=foobar' -H 'Pragma: no-cache' -H 'Accept-Encoding: gzip, deflate, sdch' -H 'Accept-Language: en-US,en;q=0.8,fr;q=0.6' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Cache-Control: no-cache' -H 'Cookie: __ssid=e0841bf9-35c3-46c1-beb3-c7630641beb7; _pt=1--WyIwODg5OTY5ZjlmMmFhNjU2NmVmZGEwNzg2ZTI4NWU0MzZlYWM4MDc3Il0%3D--f3f015ea0bffde7d657c25abde152e7aaacfdf47; _csrf_token=V4%24.airbnb.com%24NxrT0S96TiA%2472utwUttwg2FJh980_peFBXJ6BsYSPvpHIIyCNJovX0%3D; _user_attributes=%7B%22curr%22%3A%22USD%22%2C%22guest_exchange%22%3A1%7D; mdr_browser=desktop; _gat=1; _ga=GA1.2.1759723632.1432186475; bev=1432186475_B85ypB1UqTI6K0fS; flags=268439552; EPISODES=s=1434577305346\u0026r=https%3A%2F%2Fwww.airbnb.com%2Frooms%2F1931946%3Fcheckin%3D06%252F16%252F2015%26checkout%3D06%252F18%252F2015%26s%3Dghzz%26x%3Dfoobar' -H 'Connection: keep-alive' --compressed | grep \"foobar\"\n\n3- the response page contains the csrf token.\ncurl 'https://www.airbnb.com/rooms/1931946?checkin=06%2F16%2F2015\u0026checkout=06%2F18%2F2015\u0026s=ghzz\u0026x=foobar' -H 'Pragma: no-cache' -H 'Accept-Encoding: gzip, deflate, sdch' -H 'Accept-Language: en-US,en;q=0.8,fr;q=0.6' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Cache-Control: no-cache' -H 'Cookie: __ssid=e0841bf9-35c3-46c1-beb3-c7630641beb7; _pt=1--WyIwODg5OTY5ZjlmMmFhNjU2NmVmZGEwNzg2ZTI4NWU0MzZlYWM4MDc3Il0%3D--f3f015ea0bffde7d657c25abde152e7aaacfdf47; _csrf_token=V4%24.airbnb.com%24NxrT0S96TiA%2472utwUttwg2FJh980_peFBXJ6BsYSPvpHIIyCNJovX0%3D; _user_attributes=%7B%22curr%22%3A%22USD%22%2C%22guest_exchange%22%3A1%7D; mdr_browser=desktop; _gat=1; _ga=GA1.2.1759723632.1432186475; bev=1432186475_B85ypB1UqTI6K0fS; flags=268439552; EPISODES=s=1434577305346\u0026r=https%3A%2F%2Fwww.airbnb.com%2Frooms%2F1931946%3Fcheckin%3D06%252F16%252F2015%26checkout%3D06%252F18%252F2015%26s%3Dghzz%26x%3Dfoobar' -H 'Connection: keep-alive' --compressed | grep \"authenticity_token\"","automated_response":false,"created_at":"2015-06-17T21:43:12.451Z","updated_at":"2015-06-17T21:44:20.930Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":507721,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2015-07-13T22:36:32.574Z","updated_at":"2015-07-13T22:36:32.574Z","actor":{"username":"jen_rice","cleared":false,"url":"/jen_rice","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"alokmenghrajani","url":"/alokmenghrajani"},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":507814,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-07-13T23:20:31.101Z","updated_at":"2015-07-13T23:20:31.101Z","first_to_agree":true,"actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":546530,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-08-12T23:20:44.221Z","updated_at":"2015-08-12T23:20:44.221Z","actor":{"url":"/airbnb","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/080/0db09b4e448421e22dda1d9785fb6621a93f06e8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Airbnb"}},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2753029,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"This report is being closed as ineligible for bounty as it was submitted to our Vulnerability Disclosure Program prior to converting our Public Program to Bug Bounty on March 5, 2018. We look forward to receiving your submissions moving forward.","automated_response":false,"created_at":"2018-05-16T19:21:49.159Z","updated_at":"2018-05-16T19:21:49.159Z","actor":{"url":"/airbnb","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/080/0db09b4e448421e22dda1d9785fb6621a93f06e8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Airbnb"}},"genius_execution_id":null,"team_handle":"airbnb","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":530,"category":"researcher","content":"https://www.facebook.com/alok/posts/10153879581346840","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":8663,"username":"alokmenghrajani","name":"Alok Menghrajani","bio":"\"\u003e\u003cmarquee\u003e","cleared":false,"website":"http://square.com","location":"\"\u003e\u003cmarquee\u003e","created_at":"2014-08-06T18:39:36.913Z","url":"https://hackerone.com/alokmenghrajani","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"legacy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}