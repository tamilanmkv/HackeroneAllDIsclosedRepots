{"id":725307,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MjUzMDc=","url":"https://hackerone.com/reports/725307","title":"Unchecked URL in attachment datasource","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-10-30T09:47:28.950Z","submitted_at":"2019-10-30T09:47:28.950Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zhutyra","url":"/zhutyra","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-02-20T10:46:28.487Z","bug_reporter_agreed_on_going_public_at":"2020-02-20T10:46:28.427Z","team_member_agreed_on_going_public_at":"2020-02-19T13:41:20.951Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Implementation of *com.openexchange.url.mail.attachment* datasource does no validation of *url* parameter. Any URL supported by Java's *URLConnection* can be read.\n\nAttached is an exploit which reads */etc/hostname* file from sandbox server.\n\n## Impact\n\nAny URL supported by Java's *URLConnection* can be read.","bounty_amount":"850.0","formatted_bounty":"$850","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":621306,"file_name":"ox-urlatt.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/YpcZX3RYrMBgUb3qg9arSh9Y?response-content-disposition=attachment%3B%20filename%3D%22ox-urlatt.py%22%3B%20filename%2A%3DUTF-8%27%27ox-urlatt.py\u0026response-content-type=text%2Fx-python\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152032Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cd307b7b8d18f98647e968114547e61b002af695d843309fd4a56b2dfa77a5a4","file_size":2075,"type":"text/x-python"}],"allow_singular_disclosure_at":null,"vote_count":15,"voters":["a_d_a_m","ali","an0nym0us","ahmedelmalky","younes___","exception","01alsanosi","cryptographer","meraki07","thiggh3r","and 5 more..."],"severity":{"rating":"medium","score":6.5,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":551,"asset_type":"URL","asset_identifier":"sandbox.open-xchange.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6171834,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @zhutyra \nCan you provide more steps to produce the bug?\nRegards,\n@bugseeker ","automated_response":false,"created_at":"2019-10-30T10:18:07.332Z","updated_at":"2019-10-30T10:18:07.332Z","actor":{"username":"bugseeker","cleared":false,"url":"/bugseeker","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/MQSo6h7swJUBC1NdjKCT4ZYe/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6172250,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm sorry, I should have mention that it is in AJAX API. I'm new to OX, but I don't think these fields are exposed in UI.\n\nOnly way I know at the moment is to use custom client and there just specify arbitrary URL in the call. Provided program does exactly that, so steps to reproduce would be to run it. You may need to install python requests library first (pip3 install requests).\n\nIt creates new Task, attaches an attachment with file:// URL and then reads the attachment back. The file to attach/read is specified at the top of script, so you can change it to /etc/passwd or anything more recognizable than /etc/hostname if you wish.","automated_response":false,"created_at":"2019-10-30T11:08:12.050Z","updated_at":"2019-10-30T11:08:12.050Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6173151,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @zhutyra,\n\nWe need more details about the vulnerability, for instance you need to mention the vulnerable endpoints and how to achieve file read step by step, we need details to completely understand the root cause of the problem and how to reproduce it.\n\nRegards,\n@princeofpersia","automated_response":false,"created_at":"2019-10-30T13:08:47.696Z","updated_at":"2019-10-30T13:08:47.696Z","actor":{"username":"princeofpersia","cleared":false,"url":"/princeofpersia","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/663/153/2664a34113403db9945207030f723e4f93a511b0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6174034,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I apologize again, I expected it to go directly to vendor familiar with the product.\n\n*OX* has concept of *Data Sources* which produce data based on given parameters.\n\nThrough **/ajax/attachment?action=attach** endpoint it is possible to create an attachment (to whatever accepts attachments, like Tasks or Mails) and specify its data source. Request body could look like this:\n\n```json\n{\n    \"module\": 0,\n    \"folder\": 1,\n    \"attached\": 2,\n    \"datasource\": {\n        \"identifier\": \"com.openexchange.url.mail.attachment\",\n        \"url\": \"file:///etc/hostname\"\n    }\n}\n```\n\nHandling of such request in source code is implemented here:\n\n```\nbackend/com.openexchange.server/src/com/openexchange/ajax/Attachment.java\nbackend/com.openexchange.server/src/com/openexchange/ajax/request/AttachmentRequest.java\n```\n\nOne of possible data sources is **com.openexchange.url.mail.attachment** which accepts single parameter **url** and\nreturns content of that URL.\n\nIn source code it is implemented here:\n```\nbackend/com.openexchange.url.mail.attachment/src/com/openexchange/url/mail/attachment/URLMailAttachmentDataSource.java\n```\nThe specified URL is not validated so any URL supported by Java's URLConnection can be read and its content used as attachment. Supported protocols are jar, ftp(s), http(s), file, and maybe more.\n\nSimple demo exploit which attaches content of */etc/hostname* file to a Task is attached in initial report.\n\nHopefully it is clearer now :)\n","automated_response":false,"created_at":"2019-10-30T15:08:20.951Z","updated_at":"2019-10-30T15:08:20.951Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6179423,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @zhutyra, we're looking into this report now.","automated_response":false,"created_at":"2019-10-31T07:50:47.423Z","updated_at":"2019-10-31T07:50:47.423Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6179471,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for reporting this vulnerability to us. We take your feedback very serious and started the process of resolving and delivering a solution to our users. Please note that we will take care about public disclosure of the vulnerability and give our users a chance to update to a fixed version before. Therefor, please handle this finding with discretion until we publicly disclosed it.\n\nWe'll discuss the matter of bounty for this finding soon and will update you shortly. Would you like to be included in our advisories \"researcher credits\"?","automated_response":false,"created_at":"2019-10-31T08:00:33.094Z","updated_at":"2019-10-31T08:00:33.094Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6187706,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\nI don't want to be credited in the advisory.\nThank you.","automated_response":false,"created_at":"2019-10-31T19:44:31.080Z","updated_at":"2019-10-31T19:44:31.080Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6230976,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-11-06T11:59:05.782Z","updated_at":"2019-11-06T11:59:05.782Z","additional_data":{"old_severity":"High","new_severity":"Medium (6.5)","old_severity_id":551548,"new_severity_id":557499},"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6230977,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We solved this vulnerability internally and will provide a backport to in-production releases during the next weeks.","automated_response":false,"created_at":"2019-11-06T11:59:09.374Z","updated_at":"2019-11-06T11:59:09.374Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zhutyra","url":"/zhutyra"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6230978,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-11-06T11:59:15.919Z","updated_at":"2019-11-06T11:59:15.919Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"850.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"zhutyra","url":"/zhutyra"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6231812,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nthank you very much for the bounty.\n\nBut are you sure it's just a Medium? I mean, the content can be read back and may be a file, which has previously qualified as a higher severity.","automated_response":false,"created_at":"2019-11-06T14:31:06.617Z","updated_at":"2019-11-06T14:31:06.617Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6239175,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your comment, \"medium\" is the label H1 choose based on our CVSS of 6.5, which i would not consider \"medium\". We considered this finding a \"high\" severity rating for the confidentiality criteria:\n\n\u003e High: There is total loss of confidentiality, resulting in all resources within the impacted component being divulged to the attacker. Alternatively, access to only some restricted information is obtained, but the disclosed information presents a direct, serious impact.","automated_response":false,"created_at":"2019-11-07T08:33:29.712Z","updated_at":"2019-11-07T08:33:29.712Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7090504,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-02-19T13:41:20.971Z","updated_at":"2020-02-19T13:41:20.971Z","first_to_agree":true,"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7099003,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-02-20T10:46:28.448Z","updated_at":"2020-02-20T10:46:28.448Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7099004,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-02-20T10:46:28.508Z","updated_at":"2020-02-20T10:46:28.508Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}