{"id":729341,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MjkzNDE=","url":"https://hackerone.com/reports/729341","title":"Double linking cause XSS (but blokeced by CSP in gitlab.com)","state":"Closed","substate":"not-applicable","severity_rating":"low","readable_substate":"N/A","created_at":"2019-11-04T21:17:49.157Z","submitted_at":"2019-11-04T21:17:49.157Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ooooooo_q","url":"/ooooooo_q","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/012/811/4b35334fa2fcf93b2e510174e09470fb42bbf03a_original.gif/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-01-20T12:40:04.087Z","bug_reporter_agreed_on_going_public_at":"2019-12-17T22:24:24.009Z","team_member_agreed_on_going_public_at":"2020-01-20T12:40:03.999Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nURL display on Gitlab.com is currently broken.\n\nThere is a risk of XSS due to double conversion of URLs into links.\nHowever, 12.5 incorporating the fix has not yet been released and is blocked by CSP at gitlab.com.\n\n\n### Steps to reproduce\n\n1. Login to gitlab.com\n2. Create new project\n3. Create a file with the following contents as `Gemfile`\n4. Previe the  `Gemfile`\n5. You can see in the developer tool that javascript execution has been blocked by CSP.\n\n```ruby\ngem '\u003cimg/src/onerror=alert(location)\u003e', '2'\n```\n\n\n### Examples\n\nThe above code is converted to HTML as shown below and connected to XSS via the img tag.\n\n```html\n\u003cspan class=\"s1\"\u003e'\u003ca href=\"\u003ca href=\" https:=\"\" rubygems.org=\"\" gems=\"\" \"=\"\"\u003ehttps://rubygems.org/gems/\u003c/a\u003e\u003cimg src=\"\" onerror=\"alert(location)\"\u003e\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"\u0026gt;\u0026lt;img/src/onerror=alert(location)\u0026gt;'\u003c/span\u003e\n```\n\n### What is the current *bug* behavior?\n\nThere is a problem with this MR (https://gitlab.com/gitlab-org/gitlab/merge_requests/18305/diffs) that was captured by Milestone 12.5.\n\nThe issue is here. https://gitlab.com/gitlab-org/gitlab/issues/35120\n\n### What is the expected *correct* behavior?\n\nIt is expected that there will be no processing that links the URL in the screen twice.\nProbably this MR. https://gitlab.com/gitlab-org/gitlab/merge_requests/19464\n\n\n### Relevant logs and/or screenshots\n\n{F625771}\n\nscreenshots https://gitlab.com/gitlab-org/gitlab/blob/master/Gemfile\n\n### Output of checks\n\nThis bug only occurs on GitLab.com .\n\n#### Results of GitLab environment info\n\nThe 12.5 version has not yet been released and will not occur in other environments.\n\n## Impact\n\nSince gitlab.com is blocked by CSP, there is almost no risk as XSS.\nThere are dangers of HTML injection and CSS injection.\n\nIf this issue is not fixed and a 12.5 release is made, XSS can occur in Gitlab CE / EE.","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":625771,"file_name":"__________2019-11-05_6.10.27.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/WVahpHZKginPoxYyFGZEGhLY?response-content-disposition=attachment%3B%20filename%3D%22__________2019-11-05_6.10.27.png%22%3B%20filename%2A%3DUTF-8%27%27__________2019-11-05_6.10.27.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQX46P3UGI%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152059Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIGvlFSN4tPhAu4V7v5pc7%2F6eSiik7IhHLLD01kiqhVWYAiB5Dz9ea%2BLZD%2BpLtagj4O%2BjrW%2FPBVXyOw%2FvfPhYOWnLJyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMy2N4EHiSo%2FA9G2F0KtcDeo3CuylmH%2BuFka3rGPAArFX7PEojyq8EAAWPijF4XtZGXNXpmeQR1pzTOcI0Rm%2Fvja%2BwHd%2F8TxJsGVWeh%2Flk5vjiIRZT9GPW9u3ZycCrjqMci9iGhBM6uwkYQOmABA3poTj0CyTV9vU5PwMEPHFcEacwKutRiCveofJe7f8Tu4WHR%2BNU7KEmxqtXpvAXj8hQLxFVDU25WgaPgk2b4mSQSaY%2FPywLP4TuBkCMbSNVoBG2JTX5CaBeJN5iElkzZ62K%2FGVGXrbaaNyPhn%2BB8rXIjbw78eQJEkHjvT8OqfCHAYP5f%2B4IhYfTll35nE7LIUoMiLvBq6tkN5BWqoopu%2Fpju60lSqB656qlcZeAK9f5orDqJzDwlKMnoVzqvkUrUy9bmk%2BkxGW97VVmeHZ1t0v3wof%2BrT0QSrWeBO35JesCQ%2BdFE8O%2BxosSdP7tU4A%2BDPpxwomZQHAAcNR9Aywt%2FQ8Qbv894mkGzt9WDwY%2FFN8jeU3O6C%2BmyqjrgMf7nGycFeD87%2Bsgs8CikLj6%2BhBYFpskae2EppYXvqHFDwWaJKFLdI8X3NNsrRpCnIXL5GUe8p%2BBySjVvE4SnyaxoJD5sUMGcJj0QQyQGgO22eUI1ATV1DsO%2BN%2BaLLxtMPqIkYsGOqYBTa91vvmG%2BK28LWqLSYG8vhMxYQ%2Fxj6PD70iq5MyM9pLPu1bgCyqJfX2mwm9fHA6UDqgGoerI%2Bnp3Q6V4OYY0E3hEAx7T8Q%2FppO8G%2BTgH7gaNlLC%2Fng4%2BkFoIuXyVGb7q1PCueRn4pqAqwTocflxXYcQQGudKiKkzrNHGy4UeULO76lDgSIcMEtI1vIJ76b2MxFEJwq4lWhln09Xn3ksb8maUXRDeCg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=6160d45f2ff7a7564bac64d5df8fdbe7b79ff95cac863e3f66ee8f50fd0583ae","file_size":575319,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":6,"voters":["ali","0xelkomy","dark_warlord14","exception","zimmer75","root_hunterho"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6216162,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ooooooo_q,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 14 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-11-04T22:10:32.669Z","updated_at":"2019-11-04T22:10:32.669Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6225000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I noticed that MR diff (https://gitlab.com/gitlab-org/gitlab/merge_requests/19464/diffs) is insufficient as a vulnerability countermeasure.\n\n```javascript\nblobLinkRegex = /(?\u003c!\u003ca href=\")https?:\\/\\/[^\"\u003c\u003e\\\\^`{|}\\s]+/g;\n\nblobLinkRegex.test('\u003ca href=\"https://aa')\n\u003e false\n\nblobLinkRegex.test('\u003ca href=\"https://aahttps://aaa\"')\n\u003e true\n```\n\nThe following code may be able to attack\n\n```ruby\ngem 'rails/https://example.com/\u003cimg/src/onerror=alert(location)\u003e', '5.2.3'\n```","automated_response":false,"created_at":"2019-11-05T21:57:34.260Z","updated_at":"2019-11-05T21:57:34.260Z","actor":{"username":"ooooooo_q","cleared":false,"url":"/ooooooo_q","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/811/4b35334fa2fcf93b2e510174e09470fb42bbf03a_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6331777,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @ooooooo_q,\n\nThank you for this report.\nI have been trying to reproduce this issue with the latest nightly Docker image (12.5.0-pre e2a1b56cdc5), but when  previewing the Gemfile the XSS doesn't trigger nor creates CSP alerts in Firefox 70.0.1 web Console.\n\nCould you try reproducing it on your side with the `gitlab/gitlab-ee:nightly` Docker omnibus image ?\n\nBest regards,\nGitLab Security Team","automated_response":false,"created_at":"2019-11-18T09:41:33.079Z","updated_at":"2019-11-18T09:41:33.079Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6332565,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello @jmatos_bgtvf,\n\nThe problem commits have been reverted, so there seems to be no problem now.\nhttps://gitlab.com/gitlab-org/gitlab/merge_requests/19887\n","automated_response":false,"created_at":"2019-11-18T11:01:46.963Z","updated_at":"2019-11-18T11:01:46.963Z","actor":{"username":"ooooooo_q","cleared":false,"url":"/ooooooo_q","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/811/4b35334fa2fcf93b2e510174e09470fb42bbf03a_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6332729,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for the quick and detailed feedback.\nWouldn't you mind self-closing the report and opening it again if this issue finally makes its way through ?\n\nBest regards,\nGitLab Security Team\n","automated_response":false,"created_at":"2019-11-18T11:25:59.305Z","updated_at":"2019-11-18T11:25:59.305Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6332767,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"","automated_response":false,"created_at":"2019-11-18T11:38:21.339Z","updated_at":"2019-11-18T11:38:21.339Z","actor":{"username":"ooooooo_q","cleared":false,"url":"/ooooooo_q","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/811/4b35334fa2fcf93b2e510174e09470fb42bbf03a_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6574285,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-17T22:24:24.023Z","updated_at":"2019-12-17T22:24:24.023Z","first_to_agree":true,"actor":{"username":"ooooooo_q","cleared":false,"url":"/ooooooo_q","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/811/4b35334fa2fcf93b2e510174e09470fb42bbf03a_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6816792,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-20T12:40:04.016Z","updated_at":"2020-01-20T12:40:04.016Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6816793,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-01-20T12:40:04.104Z","updated_at":"2020-01-20T12:40:04.104Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}