{"id":761975,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NjE5NzU=","url":"https://hackerone.com/reports/761975","title":"Keychain data persistence may lead to account takeover","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2019-12-19T23:00:36.457Z","submitted_at":"2019-12-19T23:00:36.457Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"0x3c3e","url":"/0x3c3e","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":215,"url":"https://hackerone.com/qiwi","handle":"qiwi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"QIWI","twitter_handle":"QiwiRussia","website":"https://qiwi.com","about":"The QIWI brand is a family brand that consolidates several directions: kiosks, wallet, bank and even terminals of goods delivery."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-09-07T14:47:57.336Z","bug_reporter_agreed_on_going_public_at":"2020-08-14T10:10:50.766Z","team_member_agreed_on_going_public_at":"2020-09-07T14:47:57.237Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\nWhen user deletes Qiwi iOS application Keychain isn't wiped and on first Qiwi launch after re-installation Keychain isn't wiped as well. It allows an attacker (possible buyer of second hand Iphone) to takeover account.\n\n## Steps to reproduce\n1. Find somebody who uses Qiwi (phone enumeration may help I guess) and desires to sell his Iphone (on Avito per example)\n1. Meet up with the seller and check that Iphone isn't wiped to factory settings\n1. Check that Qiwi app is deleted (seller isn't technically educated and thinks that if he have deleted an app, he is fine and safe)\n1. Navigate to Settings and type Qiwi, this way you can find that the user previously had Qiwi app installed (it was surprise for me, but this way Apple returns empty line with \"QIWI\" as text, but without an icon)\n1. Buy the Iphone and hope that the seller forgot to logout from Qiwi\n1. Install Qiwi\n1. If Qiwi asks to enter PIN, continue, either you can't get in (probably, because I have checked if Keychain wiped after log-out)\n1. Jailbreak Iphone and attach Frida or Cydia to the app\n1. Locate the function which checks PIN and find correct PIN (it was stored somewhere in class data in plaintext)\n1. Login to QIWI with found PIN\n\n## Mitigation\nWipe Keychain on first launch of application.\n\n## References\n* https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06d-testing-data-storage#data-protection-api (scroll to Keychain Data Persistence)\n\n\u003e There's no iOS API that developers can use to force wipe data when an application is uninstalled. Instead, developers should take the following steps to prevent Keychain data from persisting between application installations:\n* When an application is first launched after installation, wipe all Keychain data associated with the application. This will prevent a device's second user from accidentally gaining access to the previous user's accounts.\n\n## Notes\nIf it's possible do not close the report as N/A, I have thought if I should to send the report for about a month or two (in that period developers added and removed Jailbreak detection, I don't know why), messaged to somebody from Qiwi security team, but got no response. (thanks for reading)\n\n## Impact\n\nAs it's a bank application, in my opinion developers should be extra careful about user security. So I think in this way security \u003e UI (it isn't so hard to get SMS and enter it to login after re-installation of an app).","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":90,"name":"Insufficient Session Expiration"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-09-13T10:10:50.829Z","allow_singular_disclosure_after":-33974011.766300716,"singular_disclosure_allowed":true,"vote_count":4,"voters":["arwildo","atpugsec","iamcoolcat","valluvarsploit"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":18746,"asset_type":"APPLE_STORE_APP_ID","asset_identifier":"ru.qiwi.QIWI","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6592696,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Actually the attacker may install Qiwi when he checks Iphone before buying, he should be tricky, but I guess it's possible scenario. \nAlso, in my experience Qiwi is the only app with persistent keychain. Can you evaluate why you decided to not wipe it (especially in case if the report will be closed as N/A or Informative)?\n\nFew typos:\n*  (probably, because *I have* checked if Keychain wiped after log-out) -- \u003e  (probably, because *I haven't* checked if Keychain wiped after log-out)\n* Jailbreak Iphone and attach Frida or *Cydia* to the app -- \u003e Jailbreak Iphone and attach Frida or *Cycript* to the app","automated_response":false,"created_at":"2019-12-19T23:07:01.580Z","updated_at":"2019-12-19T23:13:52.189Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6592789,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I emailed to VIDENS@qiwi.com (пт, 25 окт., 22:22) with following text:\n\u003e Привет, у меня вопрос по скоупу bb программы https://hackerone.com/qiwi. Входит ли в скоуп физический доступ к девайсу? Например, к мобильному телефону.\nБыло бы круто, если подобная деталь была прописана в scope, либо в no-scope.\nЗаранее спасибо,\nАрсений","automated_response":false,"created_at":"2019-12-19T23:34:52.527Z","updated_at":"2019-12-19T23:34:52.527Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6611022,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello.\n\nThank you for the report, we will look into it.","automated_response":false,"created_at":"2019-12-23T09:20:11.735Z","updated_at":"2019-12-23T09:20:11.735Z","actor":{"username":"gmedian","cleared":false,"url":"/gmedian","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6612290,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, if I remember correctly QIWI iOS app uses UIWebView to render pdf files and something like this (even real pages, it's also possible to open custom urls from QIWI app not related to QIWI, but it's tricky). That view is deprecated https://developer.apple.com/documentation/uikit/uiwebview (https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#uiwebview). As the best best practices it's better to not use it. ","automated_response":false,"created_at":"2019-12-23T13:48:17.143Z","updated_at":"2019-12-23T13:48:17.143Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6612294,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hello.\n\nWe have checked the scenario with our developers and it occurs the described behaviour is not exploitable. PIN is encrypted and is checked on the backend. Moreover PIN is stored only when FaceID or TouchID is enabled and those make the attack attempts pretty futile.","automated_response":false,"created_at":"2019-12-23T13:48:47.272Z","updated_at":"2019-12-23T13:48:47.272Z","actor":{"username":"gmedian","cleared":false,"url":"/gmedian","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6612305,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, I will try to make PoC, to show that it's possible to extract PIN using Frida.","automated_response":false,"created_at":"2019-12-23T13:50:01.122Z","updated_at":"2019-12-23T13:54:09.159Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6612664,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again, actually you don't need even using Frida, everything is easier.\nPIN is stored in keychain, using `objection` you can dump it. (`ios keychain dump`)\nHere is related article https://habr.com/ru/company/dataart/blog/429196/.\n\nPIN is stored in plaintext (hided last two digits). {F666925}","automated_response":false,"created_at":"2019-12-23T14:48:41.125Z","updated_at":"2019-12-23T15:01:28.574Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":666925,"filename":"photo_2019-12-23_17-49-02.jpg","type":"image/jpeg","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/x16b5i9rcZxbsNoVh1nekeev?response-content-disposition=attachment%3B%20filename%3D%22photo_2019-12-23_17-49-02.jpg%22%3B%20filename%2A%3DUTF-8%27%27photo_2019-12-23_17-49-02.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152422Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=fd86dca8747bb2b23e7ab6b7413977c04435b84bf2325df30357f565977ef844"}],"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6612670,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The PIN is partially checked on backend, I don't know why it's stored in keychain in that case.","automated_response":false,"created_at":"2019-12-23T14:50:09.298Z","updated_at":"2019-12-23T15:02:50.673Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6612682,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Moreover PIN is stored only when FaceID or TouchID is enabled and those make the attack attempts pretty futile.\n\nI don't have FaceID or TouchID enabled on the test device. Also cellular is disabled, I don't know if it's important.","automated_response":false,"created_at":"2019-12-23T14:52:53.370Z","updated_at":"2019-12-23T14:59:51.754Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6612801,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My concern here, that keychain for QIWI is persistent and PIN for some reason is stored in keychain while it's also for some reason checked on backend. I can't get the logic behind it.","automated_response":false,"created_at":"2019-12-23T15:12:21.619Z","updated_at":"2019-12-23T15:12:21.619Z","actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6616452,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Посмотрим еще.","automated_response":false,"created_at":"2019-12-24T06:16:39.211Z","updated_at":"2019-12-24T06:16:39.211Z","actor":{"username":"gmedian","cleared":false,"url":"/gmedian","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6616454,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-12-24T06:16:51.157Z","updated_at":"2019-12-24T06:16:51.157Z","actor":{"username":"gmedian","cleared":false,"url":"/gmedian","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6724548,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-01-09T09:17:51.987Z","updated_at":"2020-01-09T09:17:51.987Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"QIWI"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"qiwi","collaborator":{"username":"0x3c3e","url":"/0x3c3e"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8342851,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello!\nThe issue was fixed in version 7.11\nThank you for your help!","automated_response":false,"created_at":"2020-06-19T13:08:10.382Z","updated_at":"2020-06-19T13:08:10.382Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"0x3c3e","url":"/0x3c3e"},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8936434,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hey, is it possible to disclose the report? ","automated_response":false,"created_at":"2020-08-14T10:10:50.798Z","updated_at":"2020-08-14T10:10:50.798Z","first_to_agree":true,"actor":{"username":"0x3c3e","cleared":false,"url":"/0x3c3e","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qEDbNUXqt1WruDeUswBPo8Qk/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9153597,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-09-07T14:47:57.273Z","updated_at":"2020-09-07T14:47:57.273Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9153598,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-09-07T14:47:57.368Z","updated_at":"2020-09-07T14:47:57.368Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}