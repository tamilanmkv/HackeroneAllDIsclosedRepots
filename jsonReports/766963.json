{"id":766963,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NjY5NjM=","url":"https://hackerone.com/reports/766963","title":"Potential linkage of public/private (anonymous) node addresses","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2020-01-02T04:08:39.991Z","submitted_at":"2020-01-02T04:08:39.991Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ahook","url":"/ahook","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/270/516/931454b97b577c930f46a6b4700371009df43735_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7731,"url":"https://hackerone.com/monero","handle":"monero","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Monero","twitter_handle":"monero","website":"https://getmonero.org","about":" Monero: the secure, private, untraceable cryptocurrency"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-03-11T23:12:37.318Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-03-09T21:58:19.034Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"During the handshake for an incoming connection, the peer id is checked against the local node's peer id only for the specific zone of the incoming peer, in order to avoid linking public addresses to tor addresses:\nhttps://github.com/monero-project/monero/blob/5d7ae2d2791c0244a221872a7ac62627abb81896/src/p2p/net_node.inl#L2343\n\nHowever, on handshakes for outgoing connections, all zones are checked:\nhttps://github.com/monero-project/monero/blob/5d7ae2d2791c0244a221872a7ac62627abb81896/src/p2p/net_node.inl#L1064\n\nIf an attacker wanted to link a specific tor node to a public node, they could potentially connect to as many public nodes as possible, get themselves added to the peer whitelist, maybe stuff some more attacker-owned addresses into the greylist, then disconnect, and for any future incoming connections, respond with the tor node's id in an attempt to link the public/tor addresses.\n\nLow severity since it would probably take a while before they got lucky and the desired public node attempted an outgoing connection. But it would probably make sense to only check the right zone for outgoing handshakes as well to prevent such a possibility.\n\nAlso had another idea when brainstorming ways to link nodes, but it's more theoretical. An attacker could wait until a new release was about to drop, connect to as many nodes as possible, both public and tor, and log when disconnects occur. If a public node and tor node disconnect at the same time, it would be a pretty good indicator that they are the same node which was restarted due to the upgrade. Haven't thought of a way to mitigate such a timing attack yet.\n\n## Impact\n\nExposure of a tor node's public address","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-04-08T21:58:19.096Z","allow_singular_disclosure_after":-47582798.36291162,"singular_disclosure_allowed":true,"vote_count":2,"voters":["cyberunit","dnelsaka"],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6670394,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"```\ndiff --git a/src/p2p/net_node.inl b/src/p2p/net_node.inl\nindex 45bb1059..53d3350a 100644\n--- a/src/p2p/net_node.inl\n+++ b/src/p2p/net_node.inl\n@@ -1058,17 +1058,15 @@ namespace nodetool\n         pi = context.peer_id = rsp.node_data.peer_id;\n         context.m_rpc_port = rsp.node_data.rpc_port;\n         context.m_rpc_credits_per_hash = rsp.node_data.rpc_credits_per_hash;\n-        m_network_zones.at(context.m_remote_address.get_zone()).m_peerlist.set_peer_just_seen(rsp.node_data.peer_id, context.m_remote_address, context.m_pruning_seed, context.m_rpc_port, context.m_rpc_credits_per_hash);\n+        network_zone\u0026 zone = m_network_zones.at(context.m_remote_address.get_zone());\n+        zone.m_peerlist.set_peer_just_seen(rsp.node_data.peer_id, context.m_remote_address, context.m_pruning_seed, context.m_rpc_port, context.m_rpc_credits_per_hash);\n \n         // move\n-        for (auto const\u0026 zone : m_network_zones)\n+        if(rsp.node_data.peer_id == zone.m_config.m_peer_id)\n         {\n-          if(rsp.node_data.peer_id == zone.second.m_config.m_peer_id)\n-          {\n-            LOG_DEBUG_CC(context, \"Connection to self detected, dropping connection\");\n-            hsh_result = false;\n-            return;\n-          }\n+          LOG_DEBUG_CC(context, \"Connection to self detected, dropping connection\");\n+          hsh_result = false;\n+          return;\n         }\n         LOG_INFO_CC(context, \"New connection handshaked, pruning seed \" \u003c\u003c epee::string_tools::to_string_hex(context.m_pruning_seed));\n         LOG_DEBUG_CC(context, \" COMMAND_HANDSHAKE INVOKED OK\");\n```","automated_response":false,"created_at":"2020-01-02T04:19:25.617Z","updated_at":"2020-01-02T04:19:25.617Z","actor":{"username":"ahook","cleared":true,"url":"/ahook","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/270/516/931454b97b577c930f46a6b4700371009df43735_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6721539,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @ahook, thank you for your report and our apologies for a delayed response: it's been the holiday season so we've been out.\n\n\u003eAlso had another idea when brainstorming ways to link nodes, but it's more theoretical...\n\n\"Same time\" would be relative because of the fudge-factor (time) that comes with an overlay network but I see your point. That would be great to see in a PoC, please feel free to open a new report if you come up with anything!","automated_response":false,"created_at":"2020-01-08T22:29:41.672Z","updated_at":"2020-01-08T22:29:41.672Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6728942,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Clever. Looks like a real issue. Thanks.","automated_response":false,"created_at":"2020-01-09T17:26:01.267Z","updated_at":"2020-01-09T17:26:01.267Z","actor":{"username":"moneromooo","cleared":false,"url":"/moneromooo","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6745930,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your patience @ahook. The patch looks sound to me but we're waiting for confirmation from the author of that area of code.\n\nTo clarify, this issue should not be not specific to Tor, correct? Any anonymous zones should be affected, including currently-supported I2P (or any future-supported anonymous zones), correct?","automated_response":false,"created_at":"2020-01-12T00:41:05.937Z","updated_at":"2020-01-12T00:41:05.937Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6745931,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Right, any private zone would be affected","automated_response":false,"created_at":"2020-01-12T00:42:27.800Z","updated_at":"2020-01-12T00:42:27.800Z","actor":{"username":"ahook","cleared":true,"url":"/ahook","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/270/516/931454b97b577c930f46a6b4700371009df43735_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6745935,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-01-12T00:46:18.338Z","updated_at":"2020-01-12T00:46:18.338Z","additional_data":{"old_title":"Potential linkage of public/tor node addresses","new_title":"Potential linkage of public/private (anonymous) node addresses"},"actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6804675,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi again @ahook. I'd like to mark this report as resolved and move to disclose soon after the next release. Your patch has been committed to the codebase in a private repo but will be pull requested closer towards the release date (for obvious security reasons).\n\nThank you again and it's good to see more of your reports :)\n\nPlease paste an XMR address if you wish to receive bounty.","automated_response":false,"created_at":"2020-01-17T23:22:24.016Z","updated_at":"2020-01-17T23:23:16.633Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ahook","url":"/ahook"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6809053,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great, thanks! Hopefully you'll see some more reports from me in the near future :)\n\n48Nox65rPCwLGTLvaWuwFN1LqzAArHJUyPKYxcMTYkUgDWjkBGx1pNdFWiVH1TnDLf2WfDdWK7cunLCSCUf7nPV85wy8SPc","automated_response":false,"created_at":"2020-01-19T03:58:53.380Z","updated_at":"2020-01-19T03:58:53.380Z","actor":{"username":"ahook","cleared":true,"url":"/ahook","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/270/516/931454b97b577c930f46a6b4700371009df43735_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6854951,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I've notified luigi, he should be sending bounty a.s.a.p.","automated_response":false,"created_at":"2020-01-23T22:50:42.558Z","updated_at":"2020-01-23T22:50:42.558Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6855821,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sent 5 XMR: \u003ca6a86964c4aa5cda7fe2adf061958919bd9bd73ce691d1afbedfd993a2649365\u003e","automated_response":false,"created_at":"2020-01-24T03:17:11.876Z","updated_at":"2020-01-24T03:17:11.876Z","actor":{"username":"luigi1111w","cleared":false,"url":"/luigi1111w","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6856139,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","automated_response":false,"created_at":"2020-01-24T05:53:25.692Z","updated_at":"2020-01-24T05:53:25.692Z","actor":{"url":"/monero","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Monero"}},"reporter":{"username":"ahook","url":"/ahook"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7272291,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-03-09T21:58:19.052Z","updated_at":"2020-03-09T21:58:19.052Z","first_to_agree":true,"actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7294192,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"Resolved in v0.15.0.5","automated_response":false,"created_at":"2020-03-11T23:12:37.257Z","updated_at":"2020-03-11T23:12:37.257Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}