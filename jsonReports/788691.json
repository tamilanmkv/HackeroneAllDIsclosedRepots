{"id":788691,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83ODg2OTE=","url":"https://hackerone.com/reports/788691","title":"XSS - Guard - Insufficient escaping of User-IDs from PGP Keys","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-02-04T08:28:47.866Z","submitted_at":"2020-02-04T08:28:47.866Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zhutyra","url":"/zhutyra","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-06-17T15:47:43.405Z","bug_reporter_agreed_on_going_public_at":"2020-06-17T15:47:43.346Z","team_member_agreed_on_going_public_at":"2020-06-17T12:29:45.421Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Vulnerability\n\nPGP user IDs are typically in form of `name \u003caddress\u003e`  and OX Guard properly escapes angle brackets when inserting them to HTML.\n\nBut in the code for displaying a list of keys it inserts IDs into HTML attributes without escaping double quote characters.\n```javascript\n// guard/oxguard-ui/apps/oxguard/pgp/keyDetails.js\n\nfunction getTable(keyRings, tableId, autoCrypt) {\n...\n    var email = getUserIds(keyRings[i].publicRing);\n    email = email.replace(/\u003e/gi, '\u0026gt;').replace(/\u003c/gi, '\u0026lt;');\n    var td1 = $('\u003ctd class=\"oxguard_pubkeylist emailKey\" title=\"' + email + '\"\u003e');\n...\n    var td2 = $('\u003ctd class=\"oxguard_pubkeylist\" title=\"' + email + ' ' + keyRings[i].ids + '\"\u003e');\n```\n\nSo with double quotes it is possible to inject additional HTML attributes to generated HTML.\n```\n               |----------- user id ------------|\n\u003ctd ... title=\"foo\" onevent=\"javascript\" bar=\"baz\"\u003e\n                    |---- injected ----|\n```\n\n## Triggers\n\nThe vulnerable code is triggered in `Settings` when displaying list of all keys, or in `Address Book` when displaying list of keys of individual contacts. Maybe also at other locations that I had not noticed.\n\n## Attack vectors\n\n* Malicious key can be send by email as an attachment or in Autocrypt header. The victim will then be offered an option to import this key.  For Autocrypt keys there is also an option to `Import autocrypt keys without asking` in the settings, in which case it will be imported automatically.\n* Or another user from public/shared address book can import such a key as his key which will be visible to other users too.\n* Guard can also be configured to find PGP keys on external key servers, but I haven't tested it.\n\n## Example key\n\nAttached is example key {F705451} which expands affected `td` element to full screen and displays JavaScript alert on mouse move over it.\n\n```html\nfoo\" onmousemove=\"alert\u0026#40;'XSS'\u0026#41;\" style=\"background-color:red;opacity:0.2; position:fixed;top:0;height:100%;left:-4000px;width:8000px;max-width:8000px;\" data-rest=\"bar\n```\n\n## Steps to reproduce\n\n* Create/send an email with my example key as an attachment\n* View the email and click on `PGP Public Key Found. Click to Import.`\n* Go to Settings / Security / Guard / Advanced / Show advanced settings / Keys / Public keys of recipients\n* Screen should get overlayed with slightly transparent red layer and `XSS` pop up on mouse move\n\n## Impact\n\nAn attacker can execute arbitrary JavaScript in victim's browser and take over his session/data.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":705451,"file_name":"public.asc","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/2UrP2mcx1K78dhTHDSi26zHe?response-content-disposition=attachment%3B%20filename%3D%22public.asc%22%3B%20filename%2A%3DUTF-8%27%27public.asc\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2T6DG5UU%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152753Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQCyGt%2F6wKTb7WdhbTEehok3geSSNypgF1jy9glhzjfqmQIhAN%2FZ96OUsxT3l%2FcNh%2BJaiqKBQp%2B0XefuAf%2BhfC%2FmhMZBKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxZblqGtDqM2dUzvNgq1wMBRL4HwjcRdARKHRTYG1WTOwsUnNm5pyWIDl6UX7cxu3S9pxhLAGamITa%2Bry536DE0dNafGhdIyPeponbLp8FxjTVDEDmVrSlc3vq07ilX%2FsvaFMPbfLwUFwN8DcJVAZSLYZA6zDdeKNCgrZ1ISy%2BuSl%2F8sa9Nj%2FKFffdAxrEzWdcbmnUnTxt6PFvOqigHySvKHcRU1WUlzR%2BJNQhShWoYk3WMwt3lGEOyDeyEBa1PjWzXfwU5hwfOCygWSHeqe3rws%2Fy%2FAjcJ4Igs3dp7VWi2gpey9dMnBlv29eq43WYKyQ6K0q%2FC9l73EFZqlsoZAnNWCF%2BaMWp%2FSNCQCoi6LiyTT3H7xbPsVAE%2F%2B6%2B%2Fmd5o4HWlwOrPWTPapPHw%2BSF0OGtEIdy9BSNcjjpsTprmH3CxZWrOiVUBzDRDrImWT3QqtKWRETxE5UkMEesELPvS1Vr78fUKmIPG33W64ks49siCJg%2BYlvii52MslCAhwi8OBai4EvmsepnSL4Y7WjbGc31Zh7uWP1tOMXaSXgoK4ZXpbX9aNZgfinEq%2FEdjmz1acLqkVL8LTALuORrCaSQNzbL1VsrMHnDQY5Ip6UHG9W3WhTLOB2rMmAx%2FYtqF%2F2HrLRQRuA5lXPow%2F4aRiwY6pAFiuHIrJ99Gk48YedhIWLylCmpLudXTrjRTQ5%2BPJgz8sHy%2FJL%2BbYgchWh7RyeRvXCGWkecfBiAUWkHftxJlLxZP3R4oliu1hG1pnP80N0SBXLpKCFAQqqhncEnNPuXaqUaPMjKqpRRMw76WlTCCpu34SiacreJDZDO6dLymqMm3OX1OpD5Y13L2IbUTLcllZFway4EkA3FPk2PKaxAARwJYsWedpQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=19cfb5e952ee31114a5920b749caf094f97f8d798f084b9e3aeb47755f215a9c","file_size":1219,"type":"text/plain"}],"allow_singular_disclosure_at":null,"vote_count":7,"voters":["secator","lemonoftroy","brahim_boufakri01","ali","bamesjonde","gogeruk","sl33pyp0t4t0"],"severity":{"rating":"medium","score":4.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":551,"asset_type":"URL","asset_identifier":"sandbox.open-xchange.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6958156,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for reporting this vulnerability to us. I liked the very detailed description and observations of potential attack vectors. We take your feedback very serious and started the process of resolving and delivering a solution to our users. Please note that we will take care about public disclosure of the vulnerability and give our users a chance to update to a fixed version before. Therefor, please handle this finding with discretion until we publicly disclosed it.\n\nWe'll discuss the matter of bounty for this finding soon and will update you shortly. Would you like to be included in our advisories \"researcher credits\"?","automated_response":false,"created_at":"2020-02-04T09:27:01.819Z","updated_at":"2020-02-04T09:27:01.819Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6960605,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We solved this vulnerability internally and will provide a backport to in-production releases during the next weeks.","automated_response":false,"created_at":"2020-02-04T14:04:21.192Z","updated_at":"2020-02-04T14:04:21.192Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zhutyra","url":"/zhutyra"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6960611,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-02-04T14:05:39.077Z","updated_at":"2020-02-04T14:05:39.077Z","additional_data":{"old_severity":"Medium","new_severity":"Medium (4.3)","old_severity_id":624519,"new_severity_id":624703},"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6960619,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-02-04T14:06:25.185Z","updated_at":"2020-02-04T14:06:25.185Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"350.0","bounty_currency":"usd","bonus_amount":"150.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"zhutyra","url":"/zhutyra"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6963676,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello, I don't want to be credited in the advisory.\n\nThank you very much for the bounty.","automated_response":false,"created_at":"2020-02-04T21:01:12.288Z","updated_at":"2020-02-04T21:01:12.288Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8319666,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-17T12:29:45.441Z","updated_at":"2020-06-17T12:29:45.441Z","first_to_agree":true,"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8321765,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-17T15:47:43.369Z","updated_at":"2020-06-17T15:47:43.369Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8321766,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-06-17T15:47:43.432Z","updated_at":"2020-06-17T15:47:43.432Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}