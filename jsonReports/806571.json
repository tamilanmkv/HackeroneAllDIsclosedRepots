{"id":806571,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MDY1NzE=","url":"https://hackerone.com/reports/806571","title":"Stored XSS in blob viewer","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-02-27T21:46:40.864Z","submitted_at":"2020-02-27T21:46:40.864Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yvvdwf","url":"/yvvdwf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-04T09:46:28.904Z","bug_reporter_agreed_on_going_public_at":"2020-08-04T08:21:23.426Z","team_member_agreed_on_going_public_at":"2020-08-04T09:46:28.801Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nI found a Stored-XSS in blob viewer when viewing a json file.\n\nIn particular, when viewing an openapi file, [openapi_viewer](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/blob/viewer/index.js#L43) is called to transfer the file's data to [SwaggerUIBundle](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/blob/openapi/index.js#L10) to render.\n\nSwaggerUIBundle does its job when rending graphical representation of the openapi's content. It also allows *html tags and attributes* in the description of the openapi. Although it removes malicious tags and attributes, but this is not enough in gitlab's context:\n\n1. `class` and `style` attributes allow attackers to arbitrarily present their disposition. My demo below uses `class` attribute to create a transparent layer that fulfils the document to intercept any user's clics.\n\n2. `data-*` attributes, under the help of [jquery-ujs](https://gitlab.com/gitlab-org/gitlab/-/blob/master/package.json#L90), allows attackers to create any requests to server when user clicking (not only `GET`, but also, `PUT`, `DELETE`, `HEAD`) with arbitrary parameters\n\n3. The current CSP is easily by passed by [jQuery.globalEval](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/main.js#L54). In my demo below, you should see an `alert` after clicking anywhere\n\n\n### Steps to reproduce\n\n1. In any project, create a file naming `xss-openapi.js`, then put the following content:\n```\n{\n  \"swagger\" : \"2.0\",\n  \"info\" : {\n    \"description\" : \"\u003ca href=https://gitlab.com/yvvdwf/data/-/wikis/alert.md data-type=script style='cursor:default' data-remote=true class='atwho-view select2-drop-mask pika-select'\u003e\u003c/a\u003e\u003cscript\u003ealert(0)\u003c/script\u003e\"\n  }}\n```\n\n2. Click anywhere on the document view, you should see an alert.\n\n### Impact\n\nThere are three impacts as in the Summary above. The most important impact is the stored-XSS allowing attackers to perform any action on behalf of users at the client side.\n\n### Examples\n\n(This repository is in private mode, please let me know if you cannot access it)\nhttps://gitlab.com/yvvdwf/xss/-/blob/master/xss-openapi.json\n\n\n### What is the current *bug* behavior?\n\nGitlab does not check the result generated by SwaggerUIBundle\n\n### What is the expected *correct* behavior?\n\nShould remove any inappropriate html attributes, such as, `data-*`, `style`, `class`.\n\n### Output of checks\n\nThis bug happens on GitLab.com\n\n## Impact\n\nThe stored-XSS allows attackers to perform any action on behalf of users at the client side.","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":34,"voters":["th3hidd3nmist","wi11","xparrot","sky003","ali","aryan2808","rahulkadavil_","trazer","idiablos","khizer47","and 24 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7170205,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yvvdwf,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 14 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-02-27T22:05:54.409Z","updated_at":"2020-02-27T22:05:54.409Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7194249,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @yvvdwf,\n\nThank you for this extra report.\n\nI have created a private project containing `xss-openapi.js` and its content described in Step1.\nBut when I access https://gitlab.com/thenamespace/theproject/-/blob/master/xss-openapi.js, I cannot have the XSS triggered by clicking on the document.\n\nCould you please provide more information about Step2 ?\n\nBest regards,\nGitLab Security Team\n","automated_response":false,"created_at":"2020-03-02T10:43:15.164Z","updated_at":"2020-03-02T10:43:15.164Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7194294,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi,\n\nA mistake in filename, it should be ended by `json`, for example, `xss-openapi.json` (not `xss-openapi.js`)\n\nBest regards,","automated_response":false,"created_at":"2020-03-02T10:50:12.447Z","updated_at":"2020-03-02T10:50:12.447Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7194364,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for the quick feedback, I can now reproduce it.\nBefore assessing the impact, are you able to trigger it without any user interaction, i.e. without clicking ?\n\nBest regards,\nGitLab Security Team","automated_response":false,"created_at":"2020-03-02T10:56:55.601Z","updated_at":"2020-03-02T10:56:55.601Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7194447,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"\u003e are you able to trigger it without any user interaction, i.e. without clicking ?\n\nNo, I see no way to auto trigger js executions (because CSP will block them)","automated_response":false,"created_at":"2020-03-02T11:04:47.280Z","updated_at":"2020-03-02T11:04:47.280Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7195213,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @yvvdwf ,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/issues/208685.  This issue will be made public 30 days following the release of a patch.\n\nWe have temporarily lowered the severity but we will reconsider that when determining the final bounty amount. As per our policy, we are already awarding 1000$.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2020-03-02T12:19:28.928Z","updated_at":"2020-03-02T12:19:28.928Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7195216,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-03-02T12:19:37.278Z","updated_at":"2020-03-02T12:19:37.278Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":645413,"new_severity_id":647686},"actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7195246,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf , Thank you for triaging!!!","automated_response":false,"created_at":"2020-03-02T12:24:07.308Z","updated_at":"2020-03-02T12:24:07.308Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7406006,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @yvvdwf,\n\nThe issue you reported is currently scheduled to be fixed by 2020-06-30.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-03-24T04:06:31.903Z","updated_at":"2020-03-24T04:06:31.903Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8120573,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @yvvdwf,\n\nThank you again for the report! Your finding has been reviewed and we are awarding a bounty prior the release of a patch. Congratulations!\n\nWe will continue to keep you updated via HackerOne as a fix is scheduled.\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2020-05-27T15:43:25.080Z","updated_at":"2020-05-27T15:43:25.080Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8120587,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-05-27T15:45:44.722Z","updated_at":"2020-05-27T15:45:44.722Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"yvvdwf","url":"/yvvdwf"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8120599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome\nThank you for the bounty!","automated_response":false,"created_at":"2020-05-27T15:47:38.036Z","updated_at":"2020-05-27T15:47:38.036Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8120722,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf,\nForgive me about this silly question, but have I the initial awarding 1000$ as you said when triaging?? (or maybe $2000 is the total for the bounty???). thanks","automated_response":false,"created_at":"2020-05-27T15:59:34.618Z","updated_at":"2020-05-27T15:59:34.618Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8120754,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I noticed that I forgot to give you the 1000$ at triage time. Sorry for that.\n2000$ is the total bounty amount.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2020-05-27T16:03:51.730Z","updated_at":"2020-05-27T16:03:51.730Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8526763,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello @yvvdwf,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.1.2. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2020-07-07T12:34:14.653Z","updated_at":"2020-07-07T12:34:14.653Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"yvvdwf","url":"/yvvdwf"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8841595,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @jmatos_bgtvf,\n\nI saw that the internal issue has been made public. Let's disclose this one too!\n\nBest regards,","automated_response":false,"created_at":"2020-08-04T08:21:23.453Z","updated_at":"2020-08-04T08:21:23.453Z","first_to_agree":true,"actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8842565,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-04T09:46:28.828Z","updated_at":"2020-08-04T09:46:28.828Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8842566,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-04T09:46:28.933Z","updated_at":"2020-08-04T09:46:28.933Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}