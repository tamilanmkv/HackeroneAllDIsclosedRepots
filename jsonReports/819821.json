{"id":819821,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MTk4MjE=","url":"https://hackerone.com/reports/819821","title":"Initial mirror user can be assigned by other user even if the mirror was removed","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-03-15T22:22:03.892Z","submitted_at":"2020-03-15T22:22:03.892Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sky003","url":"/sky003","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-26T13:52:40.826Z","bug_reporter_agreed_on_going_public_at":"2020-08-26T10:28:11.778Z","team_member_agreed_on_going_public_at":"2020-08-26T13:52:40.737Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nEven if the mirror was removed, `project.mirror_user` still will be persisted. So any maintainer can create \"pull\" mirror with initial mirror user:\n```\n  # safe_mirror_params.rb\n\n  def valid_mirror_user?(mirror_params)\n    return true unless mirror_params[:mirror_user_id].present?\n\n    default_mirror_users.map(\u0026:id).include?(mirror_params[:mirror_user_id].to_i)\n  end\n\n  def default_mirror_users\n    # mirror is removed, but \"project.mirror_user\" is still presented here\n    [current_user, project.mirror_user].compact.uniq \n  end\n```\n\n### Steps to reproduce\n\n1. Login as the user with \"maintainer\" role (let's call this user \"permanent maintainer\").\n2. Create any \"pull\" mirror for the project.\n3. Remove created mirror.\n4. Login as the other user with \"maintainer\" role (let's call this user \"temporary maintainer\").\n5. Open \"Mirroring repositories\" section in the project settings. \"Temporary maintainer\" can create a new \"pull\" mirror, but with \"permanent maintainer\" as the mirror user. So the below rule is not enforced:\n\n\u003e This user will be the author of all events in the activity feed that are the result of an update, like new branches being created or new commits being pushed to existing branches. **Upon creation or when reassigning you can only assign yourself to be the mirror user.**\n\n### Impact\n\nThis feature can be used as the backdoor. \"Temporary maintainer\" can add controlled repository there, so even if \"temporary maintainer\" will be removed from the project, he still can push the commits to a repository with maintainer privileges (because the mirror user is \"permanent maintainer\"). \n\nAny who use \"pull\" repository mirror feature is vulnerable by this. And of course this guys, because there might at least few cases when someone might need to create \"pull\" repository mirror in gitlab some time before:\n1. Want to test it before move from some other project hosting.\n2. Started by using only gitlab CI (in which case this might be necessary to create \"pull\" mirror in gitlab project; see [\"Benefits\" section here](https://about.gitlab.com/solutions/github/)) and now moved to gitlab\n3. It was just some dev/business requirement.\n\n### What is the current *bug* behavior?\n\n\"project.mirror_user\" relationship is presented even if the project repository mirror is removed. \n\n### What is the expected *correct* behavior?\n\nIf the mirror removed, then \"project.mirror_user\" relationship also should be removed, so no one can create \"pull\" mirror with \"project.mirror_user\" as the mirror user, so this rule can be enforced:\n\n\u003e Upon creation or when reassigning you can only assign yourself to be the mirror user.\n\n## Impact\n\nThis feature can be used as the backdoor. \"Temporary maintainer\" can add a controlled repository there, so even if \"temporary maintainer\" will be removed from the project, he still can push the commits to a repository with maintainer privileges (because the mirror user can be set to \"permanent maintainer\").","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["ali","rizkylabh1","hamcandle77"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7324705,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @sky003,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 10 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-03-16T05:05:34.335Z","updated_at":"2020-03-16T05:05:34.335Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7331117,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @sky003,\n\nThank you for this report.\nI am not yet able to reproduce it: as soon as \"Permanent maintainer\" has defined a pull mirror in project1, \"Temporary maintainer\" (or event Permanent maintainer) can only define a push mirror in project1 (and no more a pull mirror).\n\nCould you please provide detailed step by step instructions ?\n\nBest regards,\nGitLab Security Team","automated_response":false,"created_at":"2020-03-16T15:44:32.035Z","updated_at":"2020-03-16T15:44:32.035Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7338416,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello @jmatos_bgtvf,\n\nThank you for the quick response!\n\nYou probably missed point #3:\n\u003e Remove created mirror.\n\nI recorded the screen to show how to reproduce the bug. Hope this will help you. Please find it attached.\n\nSo basically, what is happening here:\n1. \"Permanent maintainer\" create a project, and then create a pull mirror for the project.\n2. \"Permanent maintainer\" remove the pull mirror (the same could also be done by \"temporary maintainer\" btw).\n3. \"Permanent maintainer\" add \"temporary maintainer\" to the project members.\n4.\"Temporary maintainer\" create a pull mirror for the project with \"permanent maintainer\" as the mirror user. So now  this pull mirror can be used as backdoor: even if \"temporary maintainer\" will be removed from the project members, \"temporary maintainer\" still can push to \"project\" repository with \"permanent maintainer\" privileges using controlled repository (repository owned by temporary maintainer).\n\n\u003e Upon creation or when reassigning you can only assign yourself to be the mirror user.\n\nSo the above rule doesn't work because \"permanent maintainer\" is still related to `project.mirror_user`, and can be used as the mirror user upon mirror creation by any other maintainer.\n\nPlease let me know if you have any questions.\n\nThanks","automated_response":false,"created_at":"2020-03-16T21:54:09.777Z","updated_at":"2020-03-16T22:02:41.589Z","actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":750084,"filename":"how-to-reproduce-bug.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/X4VAUWumnSS16C9i285xy2gY?response-content-disposition=attachment%3B%20filename%3D%22how-to-reproduce-bug.mp4%22%3B%20filename%2A%3DUTF-8%27%27how-to-reproduce-bug.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f1a400af8890e4b027f587e9118302c52687b545350121589cc509083b254e51"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7344433,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @sky003,\n\nThank you for the video.\n\nI tried to reproduce it in a real world scenario: doing a pull mirror of a repository that is not empty, i.e. has content in the master branch. It does not succeed because the master branch is protected by default: as explained in this [documentation](https://docs.gitlab.com/ee/user/project/protected_branches.html#overview), \"it prevents anyone from force pushing to the branch\" and mirroring uses force push. Because of master protection, the sync fails and all other unprotected branches are not mirrored either.\n\nTo make your scenario successful, temporary maintainer has to unprotect the master branch. While being maintainer, he has the right to do so but this can be identified by the permanent maintainer if he looks at the repository settings. Permanent maintainer can also see in the repository settings that there is a mirror configured from a malicious url. Furthermore, the commits are not made in the name of Permanent maintainer, but under the name of Temporary maintainer which should make Permanent maintainer aware something malicious has been configured.\n\nAre you able to provide a Proof of Concept covering all those points\n* real content in the master branch of project being pulled by Permanent maintainer\n* keeping master branch protected\n* spoofing the identity of Permanent maintainer\n\nBest regards,\nGitLab Security Team","automated_response":false,"created_at":"2020-03-17T15:04:55.349Z","updated_at":"2020-03-17T15:04:55.349Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7348591,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello @jmatos_bgtvf,\n\nThank you for the detailed answer.\n\n\u003e I tried to reproduce it in a real world scenario: doing a pull mirror of a repository that is not empty, i.e. has content in the master branch. It does not succeed because the master branch is protected by default: as explained in this documentation, \"it prevents anyone from force pushing to the branch\" and mirroring uses force push. Because of master protection, the sync fails and all other unprotected branches are not mirrored either.\n\nBut you can easily avoid the force push, so you don't have to unprotect any branch:\n1. Clone the project repository.\n2. Push the cloned project repository to the mirror repository.\n3. Add a commit you want to the mirror repository, and wait while the mirror sync.\n\n\u003e Permanent maintainer can also see in the repository settings that there is a mirror configured from a malicious url.\n\nYes, and in the project page. But permanent maintainer also might just not see it, or just didn't pay attention to it. There might be 3rd party software that manage the project members (therefore working via gitlab api), so the one who responsible for this do not even open those pages. \n\nOK, let me prepare some Proof of Concept for you.\n\n## PoC #1 Push commits under the name of permanent maintainer\n\n#### Prepare your environment.\n\nI did the same setup as shown in the video. Just one difference there: check \"Trigger pipelines for mirror updates\" box when setup the mirror for project. This will be useful for PoC #2.\n\n.1. Master branch is protected, as it configured by default.\n{F751306}\n\n.2. The project repository is not empty. Just added any files to it.\n{F751307}\n\n#### Exploitation\n\n.1. Clone the project repository as temporary maintainer.\n```\n$ git clone http://192.168.0.15:3000/permanent_maintainer/project.git\n```\n{F751305}\n\n.2. Add mirror's remote.\n```\n$ git remote add origin-mirror http://192.168.0.15:3000/temporary_maintainer/project-mirror-owned-by-temporary-maintainer.git\n```\n\n.3. Commit any changes pretending by permanent maintainer.\n``` \n$ nano .gitlab-ci.yml\n$ git add .\n$ GIT_COMMITTER_NAME=\"Permanent Maintainer\" GIT_COMMITTER_EMAIL=\"permanent_maintainer@example.com\u003e\" git commit -m \"This commit was actually done by Temporary Maintainer\" --author=\"Permanent Maintainer \u003cpermanent_maintainer@example.com\u003e\"\n```\n\nHere's also the content of `.gitlab-ci.yml`. I'm gonna use this for one more PoC. You can commit this to save some time later.\n```\nimage: alpine:3\n\nsteal_ci_job_token:\n  script:\n    - echo \"GITLAB_USER_NAME -\u003e $GITLAB_USER_NAME\"\n    - echo \"Base64 encoded CI_JOB_TOKEN -\u003e `echo $CI_JOB_TOKEN | base64`\"\n    - echo \"Done by Temporary Maintainer\"\n```\n{F751304}\n\n.4. Push the commit to mirror's project.\n```\n$ git push origin-mirror --all\n```\n{F751302}\n\nWait while the project sync with the mirror, or just sync it manually.\n\n.5. Open the project in gitlab. See that the commit is done under the name of permanent maintainer.\n{F751303}\n\nSo the result is clear -- temporary maintainer can commit under the name of permanent maintainer.\n\n## PoC #2 Steal CI_JOB_TOKEN of permanent maintainer.\n\nIMPORTANT: Make sure you checked \"Trigger pipelines for mirror updates\" box.\n\n.1. Push `.gitlab-ci.yml` config to mirror's project pretending by permanent maintainer (you may did this already).\n\n`.gitlab-ci.yml` content:\n```\nimage: alpine:3\n\nsteal_ci_job_token:\n  script:\n    - echo \"GITLAB_USER_NAME -\u003e $GITLAB_USER_NAME\"\n    - echo \"Base64 encoded CI_JOB_TOKEN -\u003e `echo $CI_JOB_TOKEN | base64`\"\n    - echo \"Done by Temporary Maintainer\"\n```\n\n``` \n$ nano .gitlab-ci.yml\n$ git add .\n$ GIT_COMMITTER_NAME=\"Permanent Maintainer\" GIT_COMMITTER_EMAIL=\"permanent_maintainer@example.com\u003e\" git commit -m \"This commit was actually done by Temporary Maintainer\" --author=\"Permanent Maintainer \u003cpermanent_maintainer@example.com\u003e\"\n\n$ git push origin-mirror --all\n```\n{F751302}\n\n.2. Wait while the project sync with the mirror, or just sync it manually.\n\n.3.  Check the job log. It must be run under the name of permanent maintainer. You should see the base64 encoded job token.\n{F751330}\n\nPermanent maintainer's CI_JOB_TOKEN can be stolen. According to the [docs](https://docs.gitlab.com/ee/user/project/new_ci_build_permissions_model.html#job-token):\n\u003e A unique job token is generated for each job and provides the user read access all projects that would be normally accessible to the user creating that job.\n\nPlease let me know if you have any questions.\n\nThanks","automated_response":false,"created_at":"2020-03-18T00:15:45.765Z","updated_at":"2020-03-18T00:18:41.936Z","actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":751330,"filename":"job-log.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/ESSfccAGR9D7uEnnWwJQo7wH?response-content-disposition=attachment%3B%20filename%3D%22job-log.png%22%3B%20filename%2A%3DUTF-8%27%27job-log.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b6cd5f7fc98f3747ef876163df69f1a8340180bc27c5cb9020037f41b448c81a"},{"id":751307,"filename":"repository-is-not-empty.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/65ziC5tpVcf24tt5dx7qx47w?response-content-disposition=attachment%3B%20filename%3D%22repository-is-not-empty.png%22%3B%20filename%2A%3DUTF-8%27%27repository-is-not-empty.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4095631f90e95c6a1bbfa199cd5ba759b6429b52b0ee07fb3128307d73193842"},{"id":751306,"filename":"protected-master-branch.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/ELzNVqXoDiK5QitJ8Airg4cL?response-content-disposition=attachment%3B%20filename%3D%22protected-master-branch.png%22%3B%20filename%2A%3DUTF-8%27%27protected-master-branch.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=519db9382f55138b2d6702ba8843642757d3c011837a1c913ccbc6c2a1368162"},{"id":751305,"filename":"clone-project-repository.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/w8DK9HpN1aZ84921BWzkym8v?response-content-disposition=attachment%3B%20filename%3D%22clone-project-repository.png%22%3B%20filename%2A%3DUTF-8%27%27clone-project-repository.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=efdaf4178cc4286728a2b086358f33a2bcba0020daf4d06ee0b455c1c202e63b"},{"id":751304,"filename":"add-remote-and-commit.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/4eWcJvN8SP25C86YCe15Z626?response-content-disposition=attachment%3B%20filename%3D%22add-remote-and-commit.png%22%3B%20filename%2A%3DUTF-8%27%27add-remote-and-commit.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=78d6e79db55183f639ad200fb65324027e4edb0de74c3b7abb75a0d1910ab4b4"},{"id":751303,"filename":"the-result-of-mirroring.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/o9CipXRizGPJbUYuPCYZfS3S?response-content-disposition=attachment%3B%20filename%3D%22the-result-of-mirroring.png%22%3B%20filename%2A%3DUTF-8%27%27the-result-of-mirroring.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=582e978474cfc5501bd3e439906e5d41c1a0cd0e9cba9ecf76601f5262dd82c6"},{"id":751302,"filename":"push-to-mirror.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/xoL64sFLCbFynzFDKEbGG9M6?response-content-disposition=attachment%3B%20filename%3D%22push-to-mirror.png%22%3B%20filename%2A%3DUTF-8%27%27push-to-mirror.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e7120fbc6d82879408ba37882c5b8c6872111c21497da558324ebaf2a41b7843"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7355647,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @sky003,\n\nThank you for those details.\nYet I am confused by PoC1:\n* If Temporary Maintainer configures in \"Mirroring repositories\" a pull repository (pulling from his own project B to project A owned by Permanent Maintainer), pull fails because master branch is protected in project A\n* Changing the commit username/email via git settings is different than what was mentioned originally in this report: it is no more selecting Permanent Maintainer when Temporary recreates a pull mirror. And it is how git handles identity (we had many closed reports on this topic as social engineering, commit signing can protect from that).\n\nConcerning PoC2: We also had several reports about accessing `CI_JOB_TOKEN` variable which were considered social engineering and hence out of scope.\n\nCould you please provide very detailed step by step instructions (clear project names and content, who creates what and when, when temporary maintainer is granted access and when he is removed, etc ...) abusing the fact that \"Initial mirror user can be assigned by other user even if the mirror was removed\" (i.e. abusing what is described in this report title) ?\n\n Best regards,\nGitLab Security Team","automated_response":false,"created_at":"2020-03-18T13:31:27.983Z","updated_at":"2020-03-18T13:31:27.983Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7362301,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello @jmatos_bgtvf,\n\nThank you for the answer. I'll try to prepare everything for you.\n\n\u003e Changing the commit username/email via git settings is different than what was mentioned originally in this report\n\nThis is just the way to be more silent, no more no less. To avoid what you mentioned in the other comment:\n\n\u003e Furthermore, the commits are not made in the name of Permanent maintainer, but under the name of Temporary maintainer which should make Permanent maintainer aware something malicious has been configured.\n\nThe important here is how gitlab handle this internally (gitlab consider \"permanent_user\" as the real committer of \"temporary_user\" commit; see also below PoC: you can compare their ids to check this).\n\n\u003e  commit signing can protect from that\n\nYes, I agree with you. But let's be honest. In the real world, how often do you see that someone sign their commits? I saw this like maybe twice :)\n\n\u003e it is no more selecting Permanent Maintainer when Temporary recreates a pull mirror\n\nYes, correct.  But does this really change the things? Ability to do this only once might be enough for an attacker.\n\n\nAlright, I prepared two videos for you. Hope this will help you. \n\n## who-is-vulnerable.mp4\n\nThis is show how a user can became vulnerable to this.\n\n1. Login as the user with maintainer permissions. Let it be \"permanent_maintainer\" user.\n2. Create a new project called \"Project\".\n3. Add any file to the project.\n4. Add any \"pull\" mirror to the project. For PoC it doen't matter whether the mirror is valid or not.\n5. Remove the mirror we just created. Let's assume we no longer need it. \n\nRESULT: The user who did the above is now vulnerable.\n\n## poc.mp4\n\nShow PoC in all details. The process there is not very efficient (video about 17 mins long), because it was at night, so excuse me for that\n\n_1. Login as \"permanent_maintainer\" user.\n_2. Add another maintainer to the project members. Let it be \"temporary_maintainer\" user.\n_3. Login as \"temporary_maintainer\" user that we just added to the project members.\n_4. Create a new mirror, controlled by \"temporary_maintainer\" user, so nothing fails as you will see:\n__a) Create a new project called \"Project Mirror\".\n__b) Clone \"Project\", and then push \"Project\" content to \"Project Mirror\".\n__c) Set \"Project Mirror\" as \"pull\" mirror for \"Project\" with \"permanent_maintainer\" as the mirror user.\n_5. Push some code to the mirror (\"Project Mirror\"), whatever you want. For example, this `.gitlab-ci.yml`:\n\n```\nimage: alpine:3\n\nsteal_ci_job_token:\n  script:\n    - echo \"GITLAB_USER_ID -\u003e $GITLAB_USER_ID\"\n    - echo \"GITLAB_USER_NAME -\u003e $GITLAB_USER_NAME\"\n    - echo \"Base64 encoded CI_JOB_TOKEN -\u003e `echo $CI_JOB_TOKEN | base64`\"\n    - echo \"Done by Temporary Maintainer\"\n``` \n\n_6. Sync \"Project\" with its mirror (\"Project Mirror\").\n\nRESULT: \"temporary_maintainer\" can commit to \"Project\", and Gitlab think that \"permanent_maintainer\" is the committer here. So we probably can call this a successful spoofing attack. \"temporary_maintainer\" can commit having all \"permanent_maintainer\" permissions. And this is not just changed committer name. Gitlab really think that this is \"permanent_maintainer\" user did this commit (see \"$GITLAB_USER_ID\" value, it's equal to \"permanent_maintainer\" user id).\nAnd there's no any social engineering tricks at all since being \"temporary_maintainer\" I don't have to interact with \"permanent_maintainer\" in any way (like ask (or wait while \"permanent_maintainer\" do this) \"permanent_maintainer\" to add some commits upon my malformed commit that should stole their CI_JOB_TOKEN). I can do all this myself just being \"temporary_maintainer\" user. This also can be done on the separated branch, so I can remove this branch... and no one will ever know.\n\n1. Login as \"permanent_maintainer\" user.\n2. Remove \"temporary_maintainer\" from \"Project\" members.\n3. Commit any code to \"Project Mirror\". Let's use \"permanent_maintainer\" name/email (the one from git config) just to be more silent. For example, push this `.gitlab-ci.yml`:\n\n```\nimage: alpine:3\n\nsteal_ci_job_token:\n  script:\n    - echo \"GITLAB_USER_ID -\u003e $GITLAB_USER_ID\"\n    - echo \"GITLAB_USER_NAME -\u003e $GITLAB_USER_NAME\"\n    - echo \"Base64 encoded CI_JOB_TOKEN -\u003e `echo $CI_JOB_TOKEN | base64`\"\n    - echo \"Done by Temporary Maintainer that is no project member, again\"\n```\n\nRESULT: \"temporary_maintainer\" still able to commit to \"Project\" repository. And Gitlab think that the commit was done by \"permanent_maintainer\" (see \"$GITLAB_USER_ID\" value). \"temporary_maintainer\" was able to assign other user as the mirror user -- and that the result. But without this bug the mirroring would just fail, because \"temporary_maintainer\" can only assign yourself as the mirror user, so their commits will not be pulled from the mirror (technically, pushed) because \"temporary_maintainer\" is not a project member.\n\nLet me know if you have any questions.\n\nThanks","automated_response":false,"created_at":"2020-03-18T23:38:15.470Z","updated_at":"2020-03-18T23:38:15.470Z","actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":752636,"filename":"poc.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/RLPw3YKKjtbAoncCfWQAujcR?response-content-disposition=attachment%3B%20filename%3D%22poc.mp4%22%3B%20filename%2A%3DUTF-8%27%27poc.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ce3f1c07050bd4779005640dac31f1158ef9d3c81ee422654e303d84b7678867"},{"id":752635,"filename":"who-is-vulnerable.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/T55HTFnhauQAn3nf5CqKhsjB?response-content-disposition=attachment%3B%20filename%3D%22who-is-vulnerable.mp4%22%3B%20filename%2A%3DUTF-8%27%27who-is-vulnerable.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153150Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e3de4c8a40c9bf1c8eea38f41fc39a94222b628a141f9e96b1d47c9fc3a7f9c0"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7377923,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @sky003 ,\n\nThank you for submitting this very detailed report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/211940.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2020-03-20T13:07:11.226Z","updated_at":"2020-03-20T13:07:11.226Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7377925,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-03-20T13:07:22.861Z","updated_at":"2020-03-20T13:07:22.861Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"sky003","url":"/sky003"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7378129,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @jmatos_bgtvf,\n\nPerfect, thank you! I'll wait for the updates.\n\nThanks","automated_response":false,"created_at":"2020-03-20T13:36:18.723Z","updated_at":"2020-03-20T13:36:18.723Z","actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7566232,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @sky003,\n\nThe issue you reported is currently scheduled to be fixed by 2020-05-31.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-04-07T04:06:42.509Z","updated_at":"2020-04-07T04:06:42.509Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8145578,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello @sky003,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.0.1 and we will soon be awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2020-05-29T14:14:45.647Z","updated_at":"2020-05-29T14:14:45.647Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sky003","url":"/sky003"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8155592,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @jmatos_bgtvf,\n\nThank you for the update!\n\nI tested it on the patched gitlab version and I'm no longer able to reproduce the bug. There's also a proper error message. Great job with the fix!\n\nThanks","automated_response":false,"created_at":"2020-05-30T13:12:47.978Z","updated_at":"2020-05-30T13:12:47.978Z","actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8175584,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-06-02T07:58:51.418Z","updated_at":"2020-06-02T07:58:51.418Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"sky003","url":"/sky003"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9043478,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hello,\n\nJust want to request for disclosure.\n\nThanks","automated_response":false,"created_at":"2020-08-26T10:28:11.806Z","updated_at":"2020-08-26T10:28:11.806Z","first_to_agree":true,"actor":{"username":"sky003","cleared":false,"url":"/sky003","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9045235,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-26T13:52:40.767Z","updated_at":"2020-08-26T13:52:40.767Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9045236,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-26T13:52:40.849Z","updated_at":"2020-08-26T13:52:40.849Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}