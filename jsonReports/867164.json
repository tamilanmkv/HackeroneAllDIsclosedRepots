{"id":867164,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NjcxNjQ=","url":"https://hackerone.com/reports/867164","title":"External storage app saves password for all users in the database","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-05-06T13:13:40.888Z","submitted_at":"2020-05-06T13:13:40.888Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"alacn1","url":"/alacn1","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8296"],"singular_disclosure_disabled":false,"disclosed_at":"2021-03-01T11:01:47.786Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-03-01T11:01:09.488Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"External storage (files_external) app save passwords of all users to database table \"oc_credentials\" even when \"Log-in credentials, save in database\" option is not used.\n\nIt's a security risk that allow password extraction of all users.\n\nA local system admin that has access to database and nextcloud config file could decrypt any user password.\n\n### Steps to reproduce\n1. Enable app \"External storage support\" (files_external).\n2. Login to nextcloud.\n3. User recoverable password will be saved to table \"oc_credentials\" at \"password::logincredentials/credentials\".\n\n### Expected behaviour\nDon't save user password to table \"oc_credentials\" unless user has a mount with \"Log-in credentials, save in database\" option.\n\n### Actual behaviour\nPasswords of all users is saved to table \"oc_credentials\" when files_external app is enabled.\n\n### Tested with\nNextcloud 18.0.4 + External storage 1.9.0\nNextcloud 17.0.5 + External storage 1.8.0\n\n## Impact\n\nA local system admin could recover any user password.","weakness":{"id":22,"name":"Storing Passwords in a Recoverable Format"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-03-31T11:01:09.592Z","allow_singular_disclosure_after":-16778102.97097781,"singular_disclosure_allowed":true,"vote_count":3,"voters":["salahhasoneh","wet_spark","sch4m4l4y4"],"severity":{"rating":"high","score":7.9,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7912554,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2020-05-06T13:13:41.267Z","updated_at":"2020-05-06T13:13:41.267Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7912659,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"the password is saved by:\napps/files_external/lib/Lib/Auth/Password/LoginCredentials.php:\nOCA\\Files_External\\Lib\\Auth\\Password\\LoginCredentials::authenticate()\n\nthere is no check if the user has any mount with \"Log-in credentials, save in database\" option.","automated_response":false,"created_at":"2020-05-06T13:26:33.242Z","updated_at":"2020-05-06T13:26:33.242Z","actor":{"username":"alacn1","cleared":false,"url":"/alacn1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7927370,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I forwarded your report to the correct people.","automated_response":false,"created_at":"2020-05-07T14:58:11.578Z","updated_at":"2020-05-07T14:58:11.578Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7939374,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nyou are correct that the credentials should only be saved when a relevant mount is configured.\n\nOne issue I can see is that this means that a newly configured storage wont be usable in background jobs/cli for the applicable users until they are active again. Which can lead to unexpected behaviour if an admin tries to do something like running the filescanner for a newly configured mount.\n\nI'll look into the best way to fix this issue and come back once I have some code","automated_response":false,"created_at":"2020-05-08T15:00:53.532Z","updated_at":"2020-05-08T15:00:53.532Z","actor":{"username":"icewind1991","cleared":false,"url":"/icewind1991","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/107/400/e3b3c7296f065943af1d48f6f64756e1a36ad4d6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7956695,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2020-05-11T06:38:02.754Z","updated_at":"2020-05-11T06:38:02.754Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8119910,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Pull request: https://github.com/nextcloud/server/pull/21037","automated_response":false,"created_at":"2020-05-27T14:51:42.729Z","updated_at":"2020-05-27T14:51:42.729Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8119925,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"The issue is not eligible for a bounty because it was reported publicly before:\nhttps://github.com/nextcloud/server/issues/17439","automated_response":false,"created_at":"2020-05-27T14:52:58.033Z","updated_at":"2020-05-27T14:52:58.033Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10547554,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Sorry, forgot to close this.\n\nThanks a lot for your report again. This has been resolved in our maintenance release from June 2020 and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","automated_response":false,"created_at":"2021-02-02T08:50:13.533Z","updated_at":"2021-02-02T08:50:13.533Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"alacn1","url":"/alacn1"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10548171,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Name: Anderson Luiz Alves\nEmail: alacn1@gmail.com","automated_response":false,"created_at":"2021-02-02T09:56:51.729Z","updated_at":"2021-02-02T09:56:51.729Z","actor":{"username":"alacn1","cleared":false,"url":"/alacn1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10633772,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2021-02-10T11:33:30.746Z","updated_at":"2021-02-10T11:33:30.746Z","additional_data":{"old_title":"files_external app save passwords of all users to database","new_title":"External storage app saves password for all users in the database"},"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10633815,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Pending SA: https://nextcloud.com/security/advisory/?id=NC-SA-2021-006\nPending CVE: CVE-2020-8296\nScheduled date: 22nd Feb\n","automated_response":false,"created_at":"2021-02-10T11:39:01.983Z","updated_at":"2021-02-10T11:39:01.983Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10837529,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-03-01T11:01:09.513Z","updated_at":"2021-03-01T11:01:09.513Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10837535,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2021-03-01T11:01:47.690Z","updated_at":"2021-03-01T11:01:47.690Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}