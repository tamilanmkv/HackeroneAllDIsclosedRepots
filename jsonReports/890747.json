{"id":890747,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTA3NDc=","url":"https://hackerone.com/reports/890747","title":"PIN OK attack","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-06-04T11:40:13.603Z","submitted_at":"2020-06-04T11:40:13.603Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"timyun","url":"/timyun","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":215,"url":"https://hackerone.com/qiwi","handle":"qiwi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"QIWI","twitter_handle":"QiwiRussia","website":"https://qiwi.com","about":"The QIWI brand is a family brand that consolidates several directions: kiosks, wallet, bank and even terminals of goods delivery."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-02-17T08:57:19.337Z","bug_reporter_agreed_on_going_public_at":"2021-02-08T18:54:33.015Z","team_member_agreed_on_going_public_at":"2021-02-17T08:57:19.261Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"PIN OK attack is an attack when a wedge-device (created for MiTM) is used to substitute the response from the card during an offline-PIN check and say that PIN was correct.\nReproduction steps:\n* An attacker with a stolen card without the correct PIN knowledge can use either a so-called wedge device for carrying out the \"man-in-the-middle\" attack and to use attended/unattended terminals or their own terminals which work only with DDA modes.\n* An attacker is making a payment for £100 using a chip. The card sends to the terminal its CVM list. The first rule in the CVM list for your card is \"4201 Encrypted PIN online\", which is correct and the CVM list should be protected with CDA. However if DDA is chosen, it's possible to conduct the CVM Tampering and to change the first CVM rule to the \"offline PIN\".\n* When Offline PIN was used but no PIN provided, your card sets \"Byte 2 Bit 3 = 1, Byte 2 Bit 2 = 1\" in IAD/CVR field indicating failed PIN verification, which can be used for detection of a fraudulent transaction on the processing side\n* And fraudulent Qiwi transaction has been authorised at 04 June 2020 10:37 GMT on the issuer's side even though there is no \"Offline PIN Verification Successful\" in IAD and no online PIN was presented.\n\nThe account is +79999913370, Card *0760\n\nFix:\nEven if cards like yours support CDA for EMV, for terminals that don't support them, you should check in CVR that PIN was correctly presented AND checked on the card. Default settings here would be:\nWhen your card actually verified PIN offline, the chip will set CVR\nByte 1 Bit 1 = 1 Offline PIN Verification Successful\n\nBut when no offline PIN verification was made, it will set\nByte 4 Bit 6 = 1 Offline PIN Verification Not Performed\n\nIf a wrong PIN was entered:\nByte 1 Bit 3 = 1 Offline PIN Verification Performed\nByte 1 Bit 2 = 1 Offline Encrypted PIN Verification Performed\nByte 4 Bit 5 = 1 Offline PIN Verification Failed\n\n## Impact\n\nThe attacker also can use lost\u0026stolen cards to conduct fraudulent payments without the PIN knowledge.","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-03-10T18:54:33.077Z","allow_singular_disclosure_after":-18564250.48233656,"singular_disclosure_allowed":true,"vote_count":39,"voters":["whybee","organdonor","secator","hunter","maxarr","romesful","ali","theappsec","catferq","rahulkadavil_","and 29 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8200408,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello!\nThank you for your report, we will take a look closer into the issue.","automated_response":false,"created_at":"2020-06-04T13:30:24.260Z","updated_at":"2020-06-04T13:30:24.260Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8298126,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет!\nИзвиняюсь за задержку в ответе. \n**1.** Можешь подсказать, что вернула тебе карта в 9f10 ? \n\n**2.** \u003e\u003eWhen Offline PIN was used but no PIN provided, your card sets \"Byte 2 Bit 3 = 1, Byte 2 Bit 2 = 1\" in IAD/CVR field indicating failed PIN verification,\n\nв процессинге видим \n9f101406010A03A6A000 и 9f101406010A03A6A010\nгде в обоих случаях\nByte 2 Bit 3 = 1 Offline PIN Verification Performed\nByte 2 Bit 2 = 1 Offline Encrypted PIN Verification Performed\nт.е. последовательность от приведенной тобой отличается, не ясно почему (другая спецификация?)\n\n**3.** Из странного только \nByte 4 Bits 8-5 Issuer Script Commands processed on last transaction = 0\nпо спеке это Byte 4: bits 8–5: Number of Issuer Script Commands\nThis check is mandatory if Issuer Script processing is supported. It provides the issuer\nwith a count of the number of Issuer Script Commands and indicates whether script\nprocessing failed.\nС этим разбираемся, но подозрения, что это не относится именно к верификации пина. ","automated_response":false,"created_at":"2020-06-15T18:10:59.121Z","updated_at":"2020-06-15T18:10:59.121Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8298803,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Коллеги из другого банка подсказали что по картам виза именно такая ситуация - байт 2 (A6), биты 2 и 3- являются индикатором того, что верификация ПИН провалилась. В случае корректной оффлайн верификации ваша карта выставляет только:\n    |-Cryptogram Information Data (9F27)\n    |    80 - .\n    |\n    |-Application Transaction Counter (ATC) (9F36)\n    |    0017 - ..\n    |\n    |-Application Cryptogram (9F26)\n    |    06267033F576C97C - .\u0026p3.v.|\n    |\n    |-Issuer Application Data (9F10)\n    |    06010A03A42000 - .......\n\nByte 2 Bit 3 = 1 Offline PIN Verification Performed\n\nРекомендую обратиться к вендору который выпускает карты.\nЕсли не удастся найти эту транзакцию с ATC 0017 - пишите, попробую повторно провести.","automated_response":false,"created_at":"2020-06-15T19:24:42.219Z","updated_at":"2020-06-15T19:24:42.219Z","actor":{"username":"timyun","cleared":false,"url":"/timyun","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8331808,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Спасибо за помощь!\nСумма выплаты связана со сложностью проведения атаки.\nАтака возможна только на терминалы, но покупка каких-то товаров по карте с напаенным чипом или с серьезным обвесом, будет слишком палевной.\nПлюс не все экваеры могут принять оффлайн-платеж.\n\nСам баг собираемся устранить в ближайшее время.","automated_response":false,"created_at":"2020-06-18T13:37:46.325Z","updated_at":"2020-06-18T13:37:46.325Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"QIWI"}},"bounty_amount":"1337.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"qiwi","collaborator":{"username":"timyun","url":"/timyun"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8332561,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-06-18T15:07:15.818Z","updated_at":"2020-06-18T15:07:15.818Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"QIWI"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"663.0","genius_execution_id":null,"team_handle":"qiwi","collaborator":{"username":"timyun","url":"/timyun"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10348302,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2021-01-13T08:36:33.368Z","updated_at":"2021-01-13T08:36:33.368Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"timyun","url":"/timyun"},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10615611,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-02-08T18:54:33.043Z","updated_at":"2021-02-08T18:54:33.043Z","first_to_agree":true,"actor":{"username":"timyun","cleared":false,"url":"/timyun","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10694608,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-02-17T08:57:19.281Z","updated_at":"2021-02-17T08:57:19.281Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10694609,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-02-17T08:57:19.356Z","updated_at":"2021-02-17T08:57:19.356Z","actor":{"username":"vankyver","cleared":false,"url":"/vankyver","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}