{"id":895730,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTU3MzA=","url":"https://hackerone.com/reports/895730","title":"Contacts menu (not app) fails to restrict (to local groups) for contacts from federated servers","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2020-06-11T00:03:52.909Z","submitted_at":"2020-06-11T00:03:52.909Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"nursoda","url":"/nursoda","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/bFsX9j1QPxJy2tMEmvC1NXts/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-07-25T08:10:36.069Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-06-25T08:10:24.331Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"In two Nextclouds A and B, in settings/admin/sharing, these settings are enabled:\n* Restrict users to only share with users in their groups\n* Restrict username autocompletion to users within the same groups\n* Add server automatically once a federated share was created successfully\n\nSome user on A now shares something to some other user on B → federation for that server is established and green on both NCs.\n\nOn B, add a new group with a new user N. That user is the only user in that new, separate group. Log in as N. Click on contacts menu (next to the user menu). One sees all contacts of A. One shouldn't see any.\n\nThis is relevant since it is unexpected and NC lacks a means to restrict viewing of such contact data. This may lead to a GDPR relevant data breach. (In my case, it did!) IF data were COPIED to B (cached?, not sure), this would be even worse.\n\nDeleting the federation solves the issue (but breaks functionality otherwise desired). I propose to add further restriction selections (for contacts from federated servers) to sharing.\n\nSidenote: The way it is now also has a functional glitch: If one clicks in the info \"i\" next to one contact from a federated server, the \"contacts\" app opens and shows an error \"No such contact found\"…\n\n## Impact\n\nWell, what SECURITY impact? It's a PRIVACY impact. But since Nextcloud strives to be the privacy-friendly alternative to big players…\n\nOK: Impact is simple contact information disclosure. But to make clear what dimensions this could lead to: Imagine all business contact information in A (in my case \u003e1000 contacts), readable to completely unrelated people on another instance.","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-07-25T08:10:24.405Z","allow_singular_disclosure_after":-38302154.465787865,"singular_disclosure_allowed":true,"vote_count":3,"voters":["sa1tama0","cryptographer","indexphp"],"severity":{"rating":"low","score":3.2,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"changed","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8258649,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2020-06-11T00:03:53.262Z","updated_at":"2020-06-11T00:03:53.262Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8269827,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Add server automatically once a federated share was created successfully\n\nFrom my understanding this is the expected behaviour with this configuration, also the description of the trusted server section is pretty clear:\n\n\u003e ### Trusted servers\n\u003e \n\u003e Federation allows you to connect with other trusted servers to exchange the user directory. For example this will be used to auto-complete external users for federated sharing.\n\nMaybe the \"restrict sharing/autocomplete\" settings description need adjustment to make clear that they only apply to local users/groups. Otherwise this also makes no sense really. Why would you trust a server to ease autocomplete, when no one can autocomplete?\n\nSo to fix your case, you should remove the trusted server and then disable `Add server automatically once a federated share was created successfully`\n\nPS: This is just my quick feedback and I will ping the sharing expert to confirm this.","automated_response":false,"created_at":"2020-06-12T07:26:45.617Z","updated_at":"2020-06-12T07:26:45.617Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8271636,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"First of all: Thanks for looking into this, much appreciated. I disagree your reasoning, even if documented. Primary function of federation is to be able to share files to other clouds, not autocompletion. At least, there should be a warning to the admins on both sides. I'd even urge Nextcloud to implement an Opt-In for sharing contacts on both sides. This may be \"none\" (default), \"these groups\" […] and \"all\" (maybe along with a warning).\n\nNextcloud is about sharing files but there are use cases where it is desirable to share CERTAIN files easily (including autocompletion of CERTAIN contacts) but in far fewer use cases it is desirable or required to see ALL contacts stored in the contacs app. The admin usually doesn't know what users store there, and the users may not know about federation!","automated_response":false,"created_at":"2020-06-12T10:26:59.973Z","updated_at":"2020-06-12T10:26:59.973Z","actor":{"username":"nursoda","cleared":false,"url":"/nursoda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/bFsX9j1QPxJy2tMEmvC1NXts/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8290418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Primary function of federation is to be able to share files to other clouds, not autocompletion. At least, there should be a warning to the admins on both sides. I'd even urge Nextcloud to implement an Opt-In for sharing contacts on both sides. This may be \"none\" (default), \"these groups\" […] and \"all\" (maybe along with a warning).\n\nThis is the case. The following setting is opt-in:\n`Add server automatically once a federated share was created successfully`\n\nIt also states pretty clear that the only use case of trusted servers is to exchange user directories, to autocomplete users. If you don't want this, don't opt in on the setting and remove all trusted servers. A server does not need to be trusted to do a federated share.","automated_response":false,"created_at":"2020-06-15T06:42:31.059Z","updated_at":"2020-06-15T06:42:31.059Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":868276,"filename":"trusted-server-settings.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/JFyhW3j11xFqxg3jHyXocwLY?response-content-disposition=attachment%3B%20filename%3D%22trusted-server-settings.png%22%3B%20filename%2A%3DUTF-8%27%27trusted-server-settings.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153938Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b0e0e4f32673b0d6d0663df34098f03201f30aa82ed46c571ebd731ce78a1df3"}],"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8292715,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Agreed. Maybe a clarification that this is NOT necessary to do a federated share is helpful, in the \"automatically add\" setting AND in the \"manually add\" section. (At least I was under the impression that trust was necessary.)\n\nBut please be specific on this (I reuse A and B from my initial description): Does the ADMIN of A need to allow trust to B to share his user directory (user directory EXPORT RESTRICTION) – or is it shared as soon as the admin of B allows to (automatically or manually) trust A (which resembles an IMPORT FILTER)?","automated_response":false,"created_at":"2020-06-15T09:55:01.865Z","updated_at":"2020-06-15T09:55:01.865Z","actor":{"username":"nursoda","cleared":false,"url":"/nursoda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/bFsX9j1QPxJy2tMEmvC1NXts/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8403351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e But please be specific on this (I reuse A and B from my initial description): Does the ADMIN of A need to allow trust to B to share his user directory (user directory EXPORT RESTRICTION) – or is it shared as soon as the admin of B allows to (automatically or manually) trust A (which resembles an IMPORT FILTER)?\n\nNo, only after both instances added the other instance as trusted server, a sync token is exchanged between the two instances.\nAfter this the addressbook is sync using this token.","automated_response":false,"created_at":"2020-06-25T08:09:10.041Z","updated_at":"2020-06-25T08:09:10.041Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8403354,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The description has been adjusted with:\nhttps://github.com/nextcloud/server/pull/21582","automated_response":false,"created_at":"2020-06-25T08:09:40.071Z","updated_at":"2020-06-25T08:09:40.071Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"nursoda","url":"/nursoda"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8403359,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"As the resulting code change is just a better description in the UI, it is not eligible for a bounty.","automated_response":false,"created_at":"2020-06-25T08:10:18.966Z","updated_at":"2020-06-25T08:10:18.966Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8403360,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-25T08:10:24.349Z","updated_at":"2020-06-25T08:10:24.349Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8408282,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"THANK you for looking into this, and sorry if that should have been reported elsewhere (forum/issue/PR).","automated_response":false,"created_at":"2020-06-25T15:52:00.074Z","updated_at":"2020-06-25T15:52:00.074Z","actor":{"username":"nursoda","cleared":false,"url":"/nursoda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/bFsX9j1QPxJy2tMEmvC1NXts/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8750547,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-07-25T08:10:36.088Z","updated_at":"2020-07-25T08:10:36.088Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}