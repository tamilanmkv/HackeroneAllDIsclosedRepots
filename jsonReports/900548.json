{"id":900548,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MDA1NDg=","url":"https://hackerone.com/reports/900548","title":"Buffer over read from `smtp_command_parse_parameters`","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2020-06-17T11:59:56.022Z","submitted_at":"2020-06-17T11:59:56.022Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"catenacyber","url":"/catenacyber","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-09-21T09:15:00.505Z","bug_reporter_agreed_on_going_public_at":"2020-09-18T18:49:59.094Z","team_member_agreed_on_going_public_at":"2020-09-21T09:15:00.400Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Function `smtp_command_parse_parameters` calls `uni_utf8_get_char_n` with length parameter `(size_t)(p - parser-\u003eend)`when the parameter should be `(size_t)(parser-\u003eend - p)`\n\nTo reproduce, send as input to the smtp server 8191 spaces followed by the beginning of one unicode character\n`printf ' %8190s\\xdc' \" \"  | nc localhost 25`\n\nFound by oss-fuzz :\nhttps://bugs.chromium.org/p/oss-fuzz/issues/detail?id=23513\n\nPatch is simply\n```\ndiff --git a/src/lib-smtp/smtp-command-parser.c b/src/lib-smtp/smtp-command-parser.c\nindex d57896393e..2a7cdf63ed 100644\n--- a/src/lib-smtp/smtp-command-parser.c\n+++ b/src/lib-smtp/smtp-command-parser.c\n@@ -181,7 +181,7 @@ static int smtp_command_parse_parameters(struct smtp_command_parser *parser)\n                if (parser-\u003eauth_response)\n                        ch = *p;\n                else {\n-                       nch = uni_utf8_get_char_n(p, (size_t)(p - parser-\u003eend),\n+                       nch = uni_utf8_get_char_n(p, (size_t)(parser-\u003eend - p),\n                                                  \u0026ch);\n                }\n                if (nch == 0)\n```\n\n## Impact\n\nThis can result in a crash for smtp server, or leaking private information (if we are in valid memory)","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":9,"name":"Buffer Over-read"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":9,"voters":["secator","aporlorxl23","mohanapriyan23","faizan20","bovgbhpuvun","besthacker12345","abhavsec","shmitydd","thaojoker"],"severity":{"rating":"none","score":0.0,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":42899,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/dovecot/core","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8319598,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=23514 is solved by the same patch","automated_response":false,"created_at":"2020-06-17T12:22:52.735Z","updated_at":"2020-06-17T12:22:52.735Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8328601,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I don't seem to have access to that bug tracker you linked.","automated_response":false,"created_at":"2020-06-18T08:30:29.240Z","updated_at":"2020-06-18T08:30:29.240Z","actor":{"username":"sbosch","cleared":false,"url":"/sbosch","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8328746,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The mail oss-fuzz@open-xchange.com is registered to get access there, cf https://github.com/google/oss-fuzz/blob/master/projects/dovecot/project.yaml#L3","automated_response":false,"created_at":"2020-06-18T08:40:44.023Z","updated_at":"2020-06-18T08:40:44.023Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8335776,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This bug looks significant to me, but I'll defer to Aki for a more thorough analysis of the security impact.","automated_response":false,"created_at":"2020-06-18T20:21:39.336Z","updated_at":"2020-06-18T20:21:39.336Z","actor":{"username":"sbosch","cleared":false,"url":"/sbosch","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366888,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2020-06-22T08:30:20.963Z","updated_at":"2020-06-22T08:30:20.963Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8447185,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @akituomi \nI saw that you acted on some reports last week, thanks.\nSo I just wanted to let you know that this one ticket is the most important in my humble opinion.","automated_response":false,"created_at":"2020-06-29T18:44:49.483Z","updated_at":"2020-06-29T18:44:49.483Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8447294,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks. Ill look at this.","automated_response":false,"created_at":"2020-06-29T18:57:10.535Z","updated_at":"2020-06-29T18:57:10.535Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8831920,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-08-03T08:04:13.419Z","updated_at":"2020-08-03T08:04:13.419Z","additional_data":{"old_severity":"Medium (6.5)","new_severity":"High (7.5)","old_severity_id":752248,"new_severity_id":807884},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8831953,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"I don't think you can actually leak memory to caller, also:\n\n220 dev04.dovecot.net Dovecot ready.\n500 5.5.2 Line too long\n\nit is already prevented by actual input parser, so I am not sure if code is actually reachable?","automated_response":false,"created_at":"2020-08-03T08:08:58.283Z","updated_at":"2020-08-03T08:08:58.283Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9021743,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @akituomi \nThanks for your feedback.\nI am indeed not sure about the actual exploitability of this. At least, it is definitely simpler to fix this bug than to exploit it ;-)\n\n\u003e I don't think you can actually leak memory to caller, also:\n\nThat said, the `smtp_command_parse_parameters` is very generic and can be called with all possible commands. So, if you want to make sure there is no leaking possible, you need to check that each command does not leak memory...\n\n\u003e it is already prevented by actual input parser, so I am not sure if code is actually reachable?\nWhat do you mean by actual input parser ?\n\nA difference may be the 8192 number which seems to come from `IO_BLOCK_SIZE` set by the fuzz target in `iostream_pump_copy`. I am not sure how big the buffer is in the real case.","automated_response":false,"created_at":"2020-08-24T11:42:14.276Z","updated_at":"2020-08-24T11:42:14.276Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9030152,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry, with actual input parser, I mean of course the login input stream, which imposes already limits on how much you can send input to begin with. ","automated_response":false,"created_at":"2020-08-25T05:46:20.394Z","updated_at":"2020-08-25T05:46:20.394Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9030502,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes `LOGIN_MAX_INBUF_SIZE` seems smaller than `IO_BLOCK_SIZE`\n\nBut I think this bug can also happen after login (even if its impact is smaller)","automated_response":false,"created_at":"2020-08-25T06:45:40.637Z","updated_at":"2020-08-25T06:45:40.637Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9030522,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, the impact will likely be exactly one user. =)","automated_response":false,"created_at":"2020-08-25T06:48:11.503Z","updated_at":"2020-08-25T06:48:11.503Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9187563,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-11T06:16:55.367Z","updated_at":"2020-09-11T06:16:55.367Z","additional_data":{"old_severity":"High (7.5)","new_severity":"None (0.0)","old_severity_id":807884,"new_severity_id":843002},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9187568,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"If the user can crash his process, it's not really a CVE.","automated_response":false,"created_at":"2020-09-11T06:17:25.275Z","updated_at":"2020-09-11T06:17:25.275Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9187575,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank you for the good report!","automated_response":false,"created_at":"2020-09-11T06:17:47.127Z","updated_at":"2020-09-11T06:17:47.127Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"catenacyber","url":"/catenacyber"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9187577,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-09-11T06:18:21.314Z","updated_at":"2020-09-11T06:18:21.314Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"catenacyber","url":"/catenacyber"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9260963,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-09-18T18:49:59.114Z","updated_at":"2020-09-18T18:49:59.114Z","first_to_agree":true,"actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9274802,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-09-21T09:15:00.426Z","updated_at":"2020-09-21T09:15:00.426Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9274803,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-09-21T09:15:00.535Z","updated_at":"2020-09-21T09:15:00.535Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}