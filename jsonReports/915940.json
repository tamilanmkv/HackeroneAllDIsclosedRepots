{"id":915940,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MTU5NDA=","url":"https://hackerone.com/reports/915940","title":"Script Editor preview token still working with uninstalled application, even for unpublished script","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2020-07-05T16:02:24.404Z","submitted_at":"2020-07-05T16:02:24.404Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"francisbeaudoin","url":"/francisbeaudoin","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-25T21:34:33.512Z","bug_reporter_agreed_on_going_public_at":"2020-08-25T21:34:33.463Z","team_member_agreed_on_going_public_at":"2020-08-25T21:33:13.100Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Within the Script Editor application, it is possible to preview a script on the storefront and proceed to purchase. Once the user click on the preview link, it opens `https://{shop}.myshopify.com/admin/scripts/preview?script_id={script_id}` which then generate a preview token to be used by the storefront. As an example, it redirects back the user to `https://{shop}.myshopify.com/cart?preview_script_id={preview_script_id}`. Per my testing, that token doesn't seem to be expiring and can still be used even if the Script Editor application has been uninstalled. \n\nTaking that into consideration, a malicious user could've created an unpublished script applying discounts to carts and if he has access, even uninstall the app. That could be done by a malicious hired Shopify Developer/Collaborator which had to do some work on a given store.\n\nOn the other hand, if a script has been applied to an order, a clickable `Script name was run on this order (Script Editor)` message is left on its **Timeline** so the admin can better understand why a discount has been applied. That said, it is possible to update a script name to an \"empty\" character resulting in the user not being able to deep-link from the order timeline to the Script Editor. By doing so, the user is also unable to edit the script as the application itself uses an hyperlink on the script name to open the edit page - meaning that the only way to edit the script would be to directly open the script editor page located at `https://script-editor.shopifycloud.com/scripts/{id}`.\n\n## Steps to reproduce - Updating a script name to an empty character\n1. Open the **Script Editor** application and create a new script \n1. By clicking **Save draft**, a request will be made to  `PATCH https://script-editor.shopifycloud.com/scripts/{id}`\n1. Intercept the request and/or replay it by updating the `name` property to an empty character. A zero-widthspace character can be copied from https://qwerty.dev/whitespace/\n\n**Order timeline - Hyperlink suppressed as script name is using empty character**\n{F894857}\n\n**Script Editor Application - Unable to edit the script**\n{F894858}\n\n## Impact\n\nA malicious user which had access to the store admin at some point, could've created unpublished script to apply discounts to carts which become a bit invisible to the admin if the application is uninstalled and/or using empty character for the script name.\n\nFor example, someone selling its store in the marketplace could make use of this.\n\nTo mitigate the issue, introducing a time based  expiration of the `preview_script_id` might do it.","bounty_amount":"2000.0","formatted_bounty":"$2,000","original_report_id":null,"original_report_url":null,"attachments":[{"id":894857,"file_name":"Order_-_Timeline_no_hyperlink.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/CMJsfFwn4wMpauwKbmMsgeN5?response-content-disposition=attachment%3B%20filename%3D%22Order_-_Timeline_no_hyperlink.png%22%3B%20filename%2A%3DUTF-8%27%27Order_-_Timeline_no_hyperlink.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXEQ3VCGF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154155Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCNbr25hK1JC2i73IX5uE08m1agZwA%2BCyxTPtXmxpZHFAIgA9v21iU9rOtKWjxfMHo7kqQOL4Y8ABbAnucRVLpaC9cqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDOyim%2FBwzSkIWBPCWirXA1TUfPlTIAz6iDfoaiiMP8hivTDD8uDyRJ%2FoAF5UW%2F6cSrWHj2Mtt%2Fx8tKTYSGoQiyhUdi%2BFdxLY35ZRGqE5k10GcpBa5q9ivBUHzTLtIbzvkVLjo0GDs33RjPyv8lT8%2BIT3cR1GpHz5sKugzk1wJHpaXHIGV7TsNZTez5PsxRWLAbodD46%2Bv0aY9dXICvo8Bld1OIiDoUsI3sX2R7SAEjL0B45opfmY7Hh4KKVF9KyCf7etmcGEL0U%2Bjij5TfmuHRxoVJXFKR4WbBKoHXN3cL5AQhAkGBE5bmE6cTsvfhMkCltMfmR1OmQtt1QK7fs2YWSyJhNNnjgzseVzroJk8qcktNvGQQNtmAz%2F0hi%2BbLDdR3r35MBTZtRPxGxwfYKfk%2Blyikhar%2F%2FfPxr6sJoQhbcKSjiziR8cFwFPC97f3qfgH6sVJVvH5AClhLDj9FMqequ01uI1FMQI%2BQ1BJ1t%2Bl3dX7D09OZCMRrk3HvidiN7al4fmx5e0pKMz7tbb23gSzvgiMJbXeHgATiARA8dz6JIoLosFubesB7ZLWq9owsMVaP42CuihB%2Br9J9vu1HkgY4lcWvgRt8bqCjXjWDPBzlNcnc9D32bMJUDfp2BWdJ0BCnpEi4XjrDCyiJGLBjqlAbw%2BQzzkBo5pgpwg2B9K3Kb9khz80zQhxWTR4UFlyZpApeXe135MxtRrVWf1VeEC8qBZynSiicNEE5qSEPmd%2FKNSihzfYJ9PmbUkfZN9yFsrIArapjiCpWMywbnOVNeLSHMFFv8xtfh0sOTI4VetTtHS5BxyHny%2BvnXM6Hjudg5tfOAvbwkv9j%2BTfq0Y0YGFWvyUNrCeX3Y3zQ5t8ked%2FqOvxUSYeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=266a4a085d9ade37677699479c2013eb1c5521a1a4855279f6f20e7fb4d75389","file_size":112938,"type":"image/png"},{"id":894858,"file_name":"Script_Editor_App_-_No_hyperlink_to_edit.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/AaKSVbQVDiwBQhRnNBvwfaEs?response-content-disposition=attachment%3B%20filename%3D%22Script_Editor_App_-_No_hyperlink_to_edit.png%22%3B%20filename%2A%3DUTF-8%27%27Script_Editor_App_-_No_hyperlink_to_edit.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXEQ3VCGF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154155Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCNbr25hK1JC2i73IX5uE08m1agZwA%2BCyxTPtXmxpZHFAIgA9v21iU9rOtKWjxfMHo7kqQOL4Y8ABbAnucRVLpaC9cqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDOyim%2FBwzSkIWBPCWirXA1TUfPlTIAz6iDfoaiiMP8hivTDD8uDyRJ%2FoAF5UW%2F6cSrWHj2Mtt%2Fx8tKTYSGoQiyhUdi%2BFdxLY35ZRGqE5k10GcpBa5q9ivBUHzTLtIbzvkVLjo0GDs33RjPyv8lT8%2BIT3cR1GpHz5sKugzk1wJHpaXHIGV7TsNZTez5PsxRWLAbodD46%2Bv0aY9dXICvo8Bld1OIiDoUsI3sX2R7SAEjL0B45opfmY7Hh4KKVF9KyCf7etmcGEL0U%2Bjij5TfmuHRxoVJXFKR4WbBKoHXN3cL5AQhAkGBE5bmE6cTsvfhMkCltMfmR1OmQtt1QK7fs2YWSyJhNNnjgzseVzroJk8qcktNvGQQNtmAz%2F0hi%2BbLDdR3r35MBTZtRPxGxwfYKfk%2Blyikhar%2F%2FfPxr6sJoQhbcKSjiziR8cFwFPC97f3qfgH6sVJVvH5AClhLDj9FMqequ01uI1FMQI%2BQ1BJ1t%2Bl3dX7D09OZCMRrk3HvidiN7al4fmx5e0pKMz7tbb23gSzvgiMJbXeHgATiARA8dz6JIoLosFubesB7ZLWq9owsMVaP42CuihB%2Br9J9vu1HkgY4lcWvgRt8bqCjXjWDPBzlNcnc9D32bMJUDfp2BWdJ0BCnpEi4XjrDCyiJGLBjqlAbw%2BQzzkBo5pgpwg2B9K3Kb9khz80zQhxWTR4UFlyZpApeXe135MxtRrVWf1VeEC8qBZynSiicNEE5qSEPmd%2FKNSihzfYJ9PmbUkfZN9yFsrIArapjiCpWMywbnOVNeLSHMFFv8xtfh0sOTI4VetTtHS5BxyHny%2BvnXM6Hjudg5tfOAvbwkv9j%2BTfq0Y0YGFWvyUNrCeX3Y3zQ5t8ked%2FqOvxUSYeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=bade540fa25150d83adc85db1b9898c0e1bff30deb15c88e2140237f526b7241","file_size":133691,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":33,"voters":["drsniper","prophet","ali","aryan2808","mattberg","rahulkadavil_","footstep","saltymermaid","sa1tama0","imprince_007","and 23 more..."],"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8527992,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThank you for the report and for your patience while we investigate this ticket. Shopify has a company-wide hackathon this week so we will not be triaging non-critical tickets until Monday. Thanks for understanding, and we will get back to you as soon as we can.\n\n- Jack","automated_response":false,"created_at":"2020-07-07T14:27:06.990Z","updated_at":"2020-07-07T14:27:06.990Z","actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8587940,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @francisbeaudoin,\n\nThank you for your report. \n\nShopify Scripts are applied on a shop and can be edited using the Script Editor application. This is why when you remove the application the scripts stay installed on the shop. This behavior might be confusing, but it is working as expected.\n\nAs for the preview token, we agree that this token should have an expiration. For this reason, we are triaging your report. Our engineering team is working on a fix.","automated_response":false,"created_at":"2020-07-13T21:58:51.671Z","updated_at":"2020-07-13T21:58:51.671Z","actor":{"username":"benoit_cotejodoin","cleared":false,"url":"/benoit_cotejodoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/470/019/97f3be894b8bd3c19e2bcc22458e02b30349bd60_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8623844,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again for your report. We're awarding a $2,000 bounty under the \"Circumvention of user permission model\" category for Shopify Core. This falls near the middle of the range for the category because the ability to execute an unpublished script could have financial repercussions for a store, but the attacker would need to have access to Shopify Scripts at some point to obtain a preview token.\n\nWe'll be in touch again once the issue is resolved.","automated_response":false,"created_at":"2020-07-16T22:30:06.229Z","updated_at":"2020-07-16T22:30:06.229Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8624161,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks!","automated_response":false,"created_at":"2020-07-16T23:19:56.820Z","updated_at":"2020-07-16T23:19:56.820Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8728063,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @francisbeaudoin,\n\nThanks again for your report. We recently deployed a fix that added expiration to the preview token. It should not longer be possible to use a token after 1 day. Your previous tokens should also no longer work. \n\nThank you for making Shopify more secure!","automated_response":false,"created_at":"2020-07-23T19:16:10.651Z","updated_at":"2020-07-23T19:16:10.651Z","actor":{"username":"benoit_cotejodoin","cleared":false,"url":"/benoit_cotejodoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/470/019/97f3be894b8bd3c19e2bcc22458e02b30349bd60_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9038675,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-25T21:33:13.123Z","updated_at":"2020-08-25T21:33:13.123Z","first_to_agree":true,"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9038681,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-25T21:34:33.484Z","updated_at":"2020-08-25T21:34:33.484Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9038682,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-25T21:34:33.537Z","updated_at":"2020-08-25T21:34:33.537Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}