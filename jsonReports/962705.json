{"id":962705,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NjI3MDU=","url":"https://hackerone.com/reports/962705","title":"The “payload” Field of Transactions in a Block Reveals the Private Data to All Peers ","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2020-08-19T18:48:25.272Z","submitted_at":"2020-08-19T18:48:25.281Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"swang1994","url":"/swang1994","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22522,"url":"https://hackerone.com/hyperledger","handle":"hyperledger","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/522/14a496059824de0648d5d65966e9ab4dd8c8e715_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/522/14a496059824de0648d5d65966e9ab4dd8c8e715_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Hyperledger","twitter_handle":"hyperledger","website":"https://www.hyperledger.org/","about":"An industry-wide open source initiative to advance blockchain technology, governed by The Linux Foundation."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":true,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-03-30T20:30:07.046Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-03-30T18:20:53.428Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"To whom it may concern, \n \nWe are a research group conducting research on Hyperledger Fabric 2.0. We find a design flaw about the “payload” field of transactions, which can reveal the Private Data to all peers in one channel.  \n \nWhen a client invokes a function to read the private data, the \u003ckey, version\u003e is stored in the read set and the value is returned in the “payload” field of transactions. In the private data related transaction workflow, to avoid revealing private data, only the hash of the read-write set is stored in transactions. However, we find that the “payload” in a transaction holds the original value of the private data. Since all transactions will be bundled into blocks and distributed to all peers in one channel, all peers including private data collection non-member peers can see the private data by fetching the specific transaction. This seriously violates the design principles of the private data collection which is shared by only a subset of peers in one channel. \n \nWe test the private data example “marbles02_private” in official documents [1]. In this example, only peer0.org1 is the member of PDC “collectionMarblePrivateDetails”. Peer0.org1 invokes the function readMarblePrivateDetails(). The generated transaction has a “payload” containing the private data {\"docType\":\"marblePrivateDetails\",\"name\":\"marble1\",\"price\":99} and is stored into the blockchain. Peer0.org2 is not the owner of this private data, but can find the actual private data in its local blockchain. Please note that we use the ‘invoke’ CLI, not the ‘query’ CLI. \n \nWe recommend that original values of private data should not appear in transactions. More restrictions on “payload” are needed. \n \nReferences \n \n[1] Hyperledger Fabric Official Docs, Tutorials\u003e\u003e Using Private Data in Fabric, https://hyperledger-fabric.readthedocs.io/en/release-2.0/private_data_tutorial.html?highlight=using%20private%20data \n \nPlease let me know if you have any questions or concerns. If you think it is necessary, we can give you a briefing on the issues. Look forward to your reply! \n \nBest Regards, \n \nShan Wang, Southeast University, University of Massachusetts Lowell , email: shanwang1994@gmail.com\nYue Zhang, Jinan University, University of Massachusetts Lowell \nXinwen Fu, University of Massachusetts Lowell\n\n## Impact\n\nThis design flaw seriously violates the design principles of the private data collection which is shared by only a subset of peers in one channel.","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["khizer47","ekgaribadmi","kc147"],"structured_scope":{"databaseId":2994,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/hyperledger/fabric","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8987659,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We have actually already accounted for this.  Any data / parameters needed by chaincode which you do not want to reveal in the transaction can be sent using the transient data field.  This way only the members of the collection who need to endorse the chaincode will ever see this data.   See https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data-arch.html#how-to-pass-private-data-in-a-chaincode-proposal for more details.","automated_response":false,"created_at":"2020-08-20T11:15:56.835Z","updated_at":"2020-08-20T11:15:56.835Z","actor":{"username":"mastersingh24","cleared":false,"url":"/mastersingh24","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8994995,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mastersingh24 We know the \"transient\" data field and performed experiments. However, we are not reporting issues on the transient data field in the transaction proposal, but the \"payload\" field in the transaction response that the endorsers return to the client. When a client sends a proposal to read the private data, the endorsers need return the results to the client in the transaction response. Note: the results of the read operation contain two parts: (i) the hash of the \u003ckey, version\u003e in the read-write set in transaction response; (ii) the value in the “payload” in the transaction response. We find there is a security and privacy issue here: the value in the “payload” contains the actual private data. Therefore, when the transaction is put into blocks and distributed to every peer, every peer including private data collection non-members can see it.\n\nThe attached file includes the chaincode project file and guideline file to demonstrate the design flaw. When a client uses the transient field to send proposal, the \"payload\" field in transaction response still contains the actual private data value.","automated_response":false,"created_at":"2020-08-20T22:55:36.951Z","updated_at":"2020-08-20T22:58:36.556Z","actor":{"username":"swang1994","cleared":false,"url":"/swang1994","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":957497,"filename":"DesignFlawDemo_'payload'.rar","type":"application/vnd.rar","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/KxXourUzTArgtUpCkVs8YczA?response-content-disposition=attachment%3B%20filename%3D%22DesignFlawDemo_%2527payload%2527.rar%22%3B%20filename%2A%3DUTF-8%27%27DesignFlawDemo_%2527payload%2527.rar\u0026response-content-type=application%2Fvnd.rar\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154558Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=96cc639ab928fce92f80c712a3b85fbfbcdf76d222c3c030e5f05409d02cce66"}],"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9147000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, @mastersingh24\n\nDid you receive our reply? Can you confirm what we reported is actually a vulnerability? Thanks.\n\nShan","automated_response":false,"created_at":"2020-09-06T15:12:50.136Z","updated_at":"2020-09-06T15:12:50.136Z","actor":{"username":"swang1994","cleared":false,"url":"/swang1994","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9152585,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Why would you submit a query transaction for ordering?\nThere is no need to do that.","automated_response":false,"created_at":"2020-09-07T12:49:27.465Z","updated_at":"2020-09-07T12:49:27.465Z","actor":{"username":"mastersingh24","cleared":false,"url":"/mastersingh24","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9152604,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Perhaps it’s because we don’t really have a query operation ... but just because you call invoke to perform a query,\nIt does not mean that you’d submit the transaction for ordering and commit to the ledger.","automated_response":false,"created_at":"2020-09-07T12:51:14.752Z","updated_at":"2020-09-07T12:51:14.752Z","actor":{"username":"mastersingh24","cleared":false,"url":"/mastersingh24","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9159988,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mastersingh24 ,\n \nWe believe there is a legitimate reason why people would submit a query transaction for ordering. Sometimes, for sensitive data (e.g. intellectual property), we want to put who performs the query into the ledger. I guess there are many other examples. \n\nThis is also what the hyperledger documents suggest. According to the sub-section \"Query\" in the section \"Glossary\" in the official documents (https://hyperledger-fabric.readthedocs.io/en/release-2.0/glossary.html), “Although not typical, the client application can choose to submit the read-only transaction for ordering, validation, and commit, for example if the client wants auditable proof on the ledger chain that it had knowledge of specific ledger state at a certain point in time.”\n \nAccording to our experiments, when the CLI \"invoke\" is used or the SDK API submitTransaction(name,[args]) is used, the transaction will be automatically sent to the orderers and put into the ledger. So we do not know what you meant by \"but because you call invoke to perform a query, it does not mean that you'd submit the transaction for ordering and commit to the ledger.\" When “invoke” or “submitTransaction(name,[args])” is used, are there some APIs we can use to choose not to submit the read-only transaction for ordering?\n \nThanks.","automated_response":false,"created_at":"2020-09-08T13:05:33.136Z","updated_at":"2020-09-08T13:05:33.136Z","actor":{"username":"swang1994","cleared":false,"url":"/swang1994","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9639169,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"As designed","automated_response":false,"created_at":"2020-10-26T17:44:31.993Z","updated_at":"2020-10-26T17:44:31.993Z","actor":{"username":"ryjones","cleared":false,"url":"/ryjones","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/190/898/16fe922a06ceb4649331e21bb3e89674e236554b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11100418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Documentation has been clarified here:\nhttps://hyperledger-fabric.readthedocs.io/en/latest/private-data-arch.html#protecting-private-data-responses\n\"Chaincode can return any data to a client application in the proposal response payload field. For read-only chaincode functions that query private data and which will not get submitted as transactions to the ordering service, private data may be returned in the proposal response payload field to the requesting client. For chaincode functions that propose private data writes however, take care not to include private data in the proposal response payload field, since this field will get included in the transaction which all channel members can access.\"","automated_response":false,"created_at":"2021-03-24T05:29:37.922Z","updated_at":"2021-03-24T05:29:37.922Z","actor":{"username":"denyeart","cleared":false,"url":"/denyeart","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11105568,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorInvited","message":null,"automated_response":false,"created_at":"2021-03-24T14:23:36.110Z","updated_at":"2021-03-24T14:23:36.110Z","actor":{"username":"swang1994","cleared":false,"url":"/swang1994","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"email":"xi**************om","genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11105974,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorJoined","message":"","automated_response":false,"created_at":"2021-03-24T14:59:01.325Z","updated_at":"2021-03-24T14:59:01.325Z","actor":{"username":"xinwenfu","cleared":false,"url":"/xinwenfu","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11187303,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-03-30T18:20:53.446Z","updated_at":"2021-03-30T18:20:53.446Z","first_to_agree":true,"actor":{"username":"ryjones","cleared":false,"url":"/ryjones","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/190/898/16fe922a06ceb4649331e21bb3e89674e236554b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11189933,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2021-03-30T20:30:06.953Z","updated_at":"2021-03-30T20:30:06.953Z","actor":{"username":"denyeart","cleared":false,"url":"/denyeart","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hyperledger","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}