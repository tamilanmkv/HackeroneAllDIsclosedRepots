{"id":293359,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTMzNTk=","url":"https://hackerone.com/reports/293359","title":"The Uber Promo Customer Endpoint Does Not Implement Multifactor Authentication, Blacklisting or Rate Limiting","state":"Closed","substate":"informative","severity_rating":"high","readable_substate":"Informative","created_at":"2017-11-28T03:34:12.182Z","submitted_at":"2017-11-28T03:34:12.182Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"gregoryvperry","url":"/gregoryvperry","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":314,"url":"https://hackerone.com/uber","handle":"uber","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Uber","twitter_handle":"","website":"https://www.uber.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-12-24T20:20:01.989Z","bug_reporter_agreed_on_going_public_at":"2017-12-11T16:54:14.140Z","team_member_agreed_on_going_public_at":"2017-12-24T20:20:01.923Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\nThe https://cn-sjc1.uber.com/rt/users/apply-clients-promotions customer endpoint used to apply Uber promotions does not implement multifactor authentication, IP address blacklisting for multiple failed attempts, or IP address-based rate limiting to prevent brute force bearer token enumeration.\n\n## Security Impact\nIssued x-uber-tokens are able to be enumerated at rates only limited by an attacker's available bandwidth.\n\n## Reproduction Steps\nA massively parallel Golang application was configured to spawn thousands of concurrent HTTP request workers, each with a PRNG-derived  token. Unlike other endpoints within the Uber architecture, https://cn-sjc1.uber.com/rt/users/apply-clients-promotions only requires an x-uber-token and promo code to assess whether the token and/or promo code is valid. By using a valid promo code in conjunction with a randomly-derived x-uber-token, more than a million brute force attempts at enumerating valid bearer tokens was able to be accomplished in a matter of minutes, without any type of IP address blacklisting or rate limiting controls preventing the attack. \n\n## Specifics\n* No account was needed for this brute force enumeration attack against the https://cn-sjc1.uber.com/rt/users/apply-clients-promotions customer endpoint, only a valid promo code\n\n## Impact\n\nAn attacker with sufficient bandwidth could enumerate valid x-uber-tokens at high rates of speed, in turn resulting in compromise of privileged account information and hijacking of user sessions associated with those x-uber-tokens.","weakness":{"id":31,"name":"Brute Force"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["fa1rlight","dareuun","gregoryvperry"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2187452,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@gregperry,\n\nThanks for the report -- we'll take a look and follow-up when we've got more details.\n\nThanks,\nRob","automated_response":false,"created_at":"2017-11-28T20:05:05.959Z","updated_at":"2017-11-28T20:05:05.959Z","actor":{"username":"fletcher","cleared":false,"url":"/fletcher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/090/8b777383ddc3ab23063609c8beb1cb1f689a75c1_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2194042,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Python POC, to demonstrate the lack of multifactor authentication and ability to enumerate access tokens with a valid promo code:\n\n```\n#!/usr/bin/python\n\nimport sys, getopt, requests\n\ndef main(argv):\n   token = ''\n   code = ''\n   try:\n      opts, args = getopt.getopt(argv,\"ht:c:\",[\"token=\",\"code=\"])\n   except getopt.GetoptError:\n      print 'promo.py -t \u003caccess token\u003e -c \u003cpromo code\u003e'\n      sys.exit(2)\n   for opt, arg in opts:\n      if opt == '-h':\n         print 'promo.py -t \u003caccess token\u003e -c \u003cpromo code\u003e'\n         sys.exit()\n      elif opt in (\"-t\", \"--token\"):\n         token = arg\n      elif opt in (\"-c\", \"--code\"):\n         code = arg\n   requests.packages.urllib3.disable_warnings()\n   response = requests.post(\n      'https://cn-sjc1.uber.com/rt/users/apply-clients-promotions',\n       headers={                                                                    \n                                                                           'x-uber-token': token},\n    json={'code': code}, verify=False\n)\n\n   print(response.text)\n\nif __name__ == \"__main__\":\n   main(sys.argv[1:])\n```\n$ python promo.py -t asdfasdfasdf -c gloriac2991ue\n{\"code\":\"rtapi.unauthorized\",\"message\":\"Unauthorized\"}\n\n$ python promo.py -t da2e6490-6680-45aa-90c8-86e0c4aace55 -c gloriac2991ue\n{\"message\":\"Another invite promotion was already applied\",\"code\":\"rtapi.users.promotion_error\",\"errorKey\":\"promotion_invite_code_after_promo_applied\",\"data\":{\"detailedMessage\":\"\"}}","automated_response":false,"created_at":"2017-12-01T16:55:02.366Z","updated_at":"2017-12-01T16:55:02.366Z","actor":{"username":"gregoryvperry","cleared":false,"url":"/gregoryvperry","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2202570,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"@gregperry — we would consider the lack of multi-factor authentication a best practices concern, out of scope for our bug bounty program. Additionally, Uber tokens (UUIDs) are made up of 128-bit highly entropic values, making them very difficult to guess or brute force. We’ll be closing this report `Informative`, as this does not pose a security risk in itself. We wish you the best of luck on your next report! ","automated_response":false,"created_at":"2017-12-05T19:28:25.994Z","updated_at":"2017-12-05T19:28:25.994Z","actor":{"username":"lindsey-uber","cleared":false,"url":"/lindsey-uber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2203031,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there Lindsay,\n\nThe real impact with this vulnerability is the lack of rate limiting and/or IP address blacklisting for multiple successive failed authentication attempts, both issues of which were not mentioned within your summary dismissal of the report. Further, without exhaustive entropy analysis of the PRNG that feeds your token generation process, hand waving about 128 bits is meaningless if there are any discernible patterns that can be picked up in the PRNG. Further, given the fact that at least one of your system architects were apparently high when they designed and implemented your bearer token assignment process without any ability to programmatically expire tokens, you have millions of bearer tokens floating around out there waiting to be discovered with this type of enumeration method, and with a bit more digging into your Oauth2 token assignment process I am confident that I can dump a few million of those unexpired tokens with a side project focused on modeling your PRNG output with a generative deep neural network after I capture a few hundred thousand Oauth2 tokens from your password reset process.\n\nI will not, however, be submitting those results to the Uber Bug Bounty program, but will instead humorously make those findings public including sample code with PyTorch, to drum up some consulting publicity on the tail of Uber’s recent and continuing bad press in the security realm. Because Uber is not a 501(c)(3), nor am I your indentured servant.\n \nOr to punctuate all of the above with a more salient, albeit colorful description, Uber’s use of a public bug bounty program with a guaranteed minimum award to attract pro bono security analysis services, but without actually paying any minumum bounties by attributing undisclosed hazards such as this as “out of scope” to skirt payment, is complete bullshit. \n\nNot completely unexpected though, given the caliber of talent utilized by Uber such as the “security” group that you hail from. You would do well in government security consulting, for sure.\n\nCheers\n\nGregory Perry\n\n\n\n","automated_response":false,"created_at":"2017-12-05T23:20:30.266Z","updated_at":"2017-12-05T23:20:30.266Z","actor":{"username":"gregoryvperry","cleared":false,"url":"/gregoryvperry","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2203160,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oh my God. \n\nAre you seriously the Program Manager for Uber's Security Division, with a 2013 psych degree and zero relevant industry experience other than technical recruiting?\n\nLULZ","automated_response":false,"created_at":"2017-12-06T01:20:15.690Z","updated_at":"2017-12-06T01:20:15.690Z","actor":{"username":"gregoryvperry","cleared":false,"url":"/gregoryvperry","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2210270,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greg,\n\nI’m sorry to see our conversation turn into a series of personal attacks, but I understand emotions can run hot sometimes, especially when there’s disagreement. A core tenet of our bug bounty program is assume best intent, so we’re happy to provide additional details on our assessment if you’re willing to commit to maintaining a professional dialogue moving forward. \n\nThanks.","automated_response":false,"created_at":"2017-12-08T20:43:36.887Z","updated_at":"2017-12-08T20:43:36.887Z","actor":{"username":"lindsey-uber","cleared":false,"url":"/lindsey-uber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2214578,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@gregperry,\n\nAfter further review, this will be your one and only warning -- if you continue to be hostile and abusive, we will move forward with a program ban.\n\nI'd recommend you practice being a nicer person.\n\n-Rob","automated_response":false,"created_at":"2017-12-11T15:44:03.868Z","updated_at":"2017-12-11T15:44:03.868Z","actor":{"username":"fletcher","cleared":false,"url":"/fletcher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/090/8b777383ddc3ab23063609c8beb1cb1f689a75c1_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2214783,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-12-11T16:54:14.176Z","updated_at":"2017-12-11T16:54:14.176Z","first_to_agree":true,"actor":{"username":"gregoryvperry","cleared":false,"url":"/gregoryvperry","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2214791,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"December 8, 2017 comment that was apparently deleted by Uber's staff:\n-----\nHello Lindsey,\n\nNot a personal attack at all. Seems like your staff lacks the security expertise to identify flaws within Uber's architecture without getting defensive and adversarial. Not my first rodeo, I've done this countless times and if the corporate culture is one of assessing blame or pointing fingers then it's the security consultant to blame.\n\nTo narrow the issue, I wouldn't have expended time and resources on testing areas of Uber's network footprint that were out of scope or irrelevant to your mission. Your team did not properly identify any of those issues on the Uber Bug Bounty page or Treasure Map, so logic seems to dictate that those issues would be ripe for analysis and testing.\n\nIf I can find a security flaw or vulnerability that maps to a well known, publicly accepted taxonomy of attacks such as CVE or OWASP, and that security flaw or vulnerability is in use on Uber's enterprise network but without being publicly disclosed on your Bug Bounty or Treasure Map page, then the minimum bounty should be paid for that discovery. Seems simple.\n\nGreg","automated_response":false,"created_at":"2017-12-11T16:56:04.782Z","updated_at":"2017-12-11T16:56:04.782Z","actor":{"username":"gregoryvperry","cleared":false,"url":"/gregoryvperry","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2245227,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-12-24T20:20:01.954Z","updated_at":"2017-12-24T20:20:01.954Z","actor":{"username":"fletcher","cleared":false,"url":"/fletcher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/090/8b777383ddc3ab23063609c8beb1cb1f689a75c1_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2245228,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-12-24T20:20:02.013Z","updated_at":"2017-12-24T20:20:02.013Z","actor":{"username":"fletcher","cleared":false,"url":"/fletcher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/090/8b777383ddc3ab23063609c8beb1cb1f689a75c1_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uber","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}