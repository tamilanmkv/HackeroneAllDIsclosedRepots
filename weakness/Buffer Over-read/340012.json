{"id":340012,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDAwMTI=","url":"https://hackerone.com/reports/340012","title":"Buffer out of bound read in miniupnpc xml parser ","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-04-18T09:32:51.100Z","submitted_at":"2018-04-18T09:32:51.100Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yukichen","url":"/yukichen","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7731,"url":"https://hackerone.com/monero","handle":"monero","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Monero","twitter_handle":"monero","website":"https://getmonero.org","about":" Monero: the secure, private, untraceable cryptocurrency"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-25T05:49:15.662Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-04-25T05:27:06.891Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nThis is a buffer oob read vulnerability in miniupnpc when parsing xml response. This vulnerability could result in denial of service attack in monero client to in local area Network.\n\n**Description:** \n\nIn miniupnpc, file \"Minixml.c\":\n\nThe funnction parseelt:\n\nstatic void parseelt(struct xmlparser * p)\n{\n...\n\t\t\t\tif(memcmp(p-\u003exml, \"\u003c![CDATA[\", 9) == 0)\t\t// (1)  Failed to do bound check prior to \"memcmp\" here\n\t\t\t\t{\n\t\t\t\t\t/* CDATA handling */\n\t\t\t\t\tp-\u003exml += 9;\n\t\t\t\t\tdata = p-\u003exml;\n\t\t\t\t\ti = 0;\n\t\t\t\t\twhile(memcmp(p-\u003exml, \"]]\u003e\", 3) != 0)\n...\n}\n\nHere it tries to match the CDATA section in the xml file using memcmp. However, it does not check whether it has already reached the end of the xml buffer. By sending a specially crafted xml response, we can make it read out of bounds of the xml buffer, which may crash the client.\n\n\n## Releases Affected:\n\nIt affects all monero clients which use miniupnpc.\n\nI have tested with the Windows, 64-bit (Command-Line Tools Only), version 0.12.0.0 Lithium Luna, downloaded from:   https://getmonero.org/downloads/\n\nThe environment I used to test was Windows 10 64-bits.\n\n\n## Steps To Reproduce:\n\nStep  1. Enable page heap for monerod.exe:\n\nThe page heap on windows helps to crash the program at the first place when memory corruption issue (buffer overrun, uaf...) happens, similar to tools like valgrind, ASAN. \n\nSee:\nhttps://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags-and-pageheap\n\n\n1.1 Install WinDbg to get gflags\nInstall the Debugging tools for windows, which contains the gflags.exe tool.\n\n1.2 Enable page heap for monerod.exe\nExecute the following command:\n\"c:\\Program Files\\Debugging Tools for Windows (x64)\\gflags.exe\" /i monerod.exe +hpa\n\n\nStep 2. Start the malicious upnp server:\n\npython poc.py --listen 127.0.0.1:65000 --target havoc\n\n\nStep3. Start monerod:\n\nmonerod.exe --test-drop-download\n\n\nStep 4. Wait for monerod crash\n\nThe crash stack trace:\n\n\n(5c10.56c0): Access violation - code c0000005 (!!! second chance !!!)\n*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\Users\\test\\Desktop\\monero\\monero-win-x64-v0.12.0.0\\monero-v0.12.0.0\\monerod.exe - \nmonerod+0x448737:\n00000000`01768737 4c3908          cmp     qword ptr [rax],r9 ds:00000000`200b0fff=????????????????\n0:000\u003e k\nChild-SP          RetAddr           Call Site\n00000000`0294d5f0 00000000`01767edb monerod+0x448737\n00000000`0294d660 00000000`01970b5b monerod+0x447edb\n00000000`0294d7a0 00000000`019792ff monerod!ZN5boost7archive6detail11oserializerINS0_24portable_binary_oarchiveEN8nodetool26anchor_peerlist_entry_baseIN4epee9net_utils15network_addressEEEEC2Ev+0x1addb\n00000000`0294e6b0 00000000`01987503 monerod!ZN5boost7archive6detail11oserializerINS0_24portable_binary_oarchiveEN8nodetool26anchor_peerlist_entry_baseIN4epee9net_utils15network_addressEEEEC2Ev+0x2357f\n00000000`0294e960 00000000`01986aa2 monerod!ZN5boost7archive6detail11oserializerINS0_24portable_binary_oarchiveEN8nodetool26anchor_peerlist_entry_baseIN4epee9net_utils15network_addressEEEEC2Ev+0x31783\n00000000`0294ead0 00000000`01331c96 monerod!ZN5boost7archive6detail11oserializerINS0_24portable_binary_oarchiveEN8nodetool26anchor_peerlist_entry_baseIN4epee9net_utils15network_addressEEEEC2Ev+0x30d22\n00000000`0294eca0 00000000`01336735 monerod+0x11c96\n00000000`0294ede0 00000000`017fdb73 monerod+0x16735\n00000000`0294ee70 00000000`01ab0f0b monerod+0x4ddb73\n00000000`0294f000 00000000`013213c7 monerod!ZNK5boost7archive6detail11oserializerINS0_24portable_binary_oarchiveEN8nodetool26anchor_peerlist_entry_baseIN4epee9net_utils15network_addressEEEE16save_object_dataERNS1_14basic_oarchiveEPKv+0x112c1b\n00000000`0294f860 00000000`013214fb monerod+0x13c7\n00000000`0294f930 00007ffa`6b921fe4 monerod+0x14fb\n00000000`0294f960 00007ffa`6d7bf061 KERNEL32!BaseThreadInitThunk+0x14\n00000000`0294f990 00000000`00000000 ntdll!RtlUserThreadStart+0x21\n\n\n\n## Supporting Material/References:\n\n  * List any additional material (e.g. screenshots, logs, etc.)\n\n## Impact\n\nA malicious attacker may crash the monero clients within the same local network area.","weakness":{"id":9,"name":"Buffer Over-read"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":288194,"file_name":"monerod_crash.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/288/194/e2864bdd5576623ec39b263e76e17b6311ccb7e0/monerod_crash.png?response-content-disposition=attachment%3B%20filename%3D%22monerod_crash.png%22%3B%20filename%2A%3DUTF-8%27%27monerod_crash.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144751Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f5b91b16d649441dc551511412af18122f886ee99bab79b43a5ec3ce6cffa796","file_size":398079,"type":"image/png"},{"id":288195,"file_name":"poc.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/288/195/0e68d8d4c216219130ffd30c1a242ad982b1db54/poc.py?response-content-disposition=attachment%3B%20filename%3D%22poc.py%22%3B%20filename%2A%3DUTF-8%27%27poc.py\u0026response-content-type=text%2Fx-python\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144751Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=5b48fd219961738aae1f7f706d3adac3034987af896a319202b7c0f29d9521f6","file_size":11869,"type":"text/x-python"}],"allow_singular_disclosure_at":"2018-05-25T05:27:06.981Z","allow_singular_disclosure_after":-106737644.74737282,"singular_disclosure_allowed":true,"vote_count":13,"voters":["spam404","mik317","ali","geeknik","eveeez","r3y","apapedulimu","japz","test0401","297724804","and 3 more..."],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2630759,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @yukichen, thank you for the report.\n\nMonero is using the latest release of miniupnp. The issue you are describing is 100% an upstream issue, not a monero code issue, and was resolved in https://github.com/miniupnp/miniupnp/commit/a0573e251817ec090a8c9f9f41b56d720c835a6c. I don't know why miniupnp hasn't done a point release as a result.\n\nWe can remedy this issue trivially by proceeding as planned: submodule'ing miniupnp. This was meant to be done sooner than later but there are only so many hands on deck. We will have to pull against their master branch to get the patch (which is less than ideal - but c'est la vie).\n\nIf you would like to receive bounty, paste an XMR address into this ticket. The address can be one-time/temporary address if needed.","automated_response":false,"created_at":"2018-04-18T23:21:20.071Z","updated_at":"2018-04-18T23:21:20.071Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2633613,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @anonimal ,\n\nThank you for pointing out this miniunpc patch.\n\nI did not notice that patch, I just checkout their latest code and found this bug, it's wired the patch was not merged into the latest code...\n\nMy monero wallet address is:\n43tvvwbyVKJ3roqAZjVNW8NtnF1yd9QdxL6NGDsN1oC2KLc9biBgTBuJRiaQ5tDuZfPYgeRJYrU7APcoa8ZUkcz13Z1UCeo\n\nAlso one more question, if I have other miniupnp bugs, are they still qualified for this bounty program?\n\n","automated_response":false,"created_at":"2018-04-19T03:06:19.369Z","updated_at":"2018-04-19T03:06:19.369Z","actor":{"username":"yukichen","cleared":false,"url":"/yukichen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2635383,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003eAlso one more question, if I have other miniupnp bugs, are they still qualified for this bounty program?\n\nFirst, check if the miniupnp repo has already patched the bugs. Secondly, check if they have a bug bounty program or a responsible disclosure process in place - and then proceed through them as appropriate. Unfortunately, no: miniupnp bugs do not qualify for the Monero Project bounty program.\n\nWe'll send bounty for this issue (#340012) soon.","automated_response":false,"created_at":"2018-04-19T05:20:37.476Z","updated_at":"2018-04-19T05:20:37.476Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2662059,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sent 3 XMR: \u003c52f4b7ba5ad05d8ff37a4edd6a99dfed1978524158168ebf56c7365a9d5ae086\u003e","automated_response":false,"created_at":"2018-04-25T02:24:57.877Z","updated_at":"2018-04-25T02:24:57.877Z","actor":{"username":"luigi1111w","cleared":false,"url":"/luigi1111w","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2662158,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","automated_response":false,"created_at":"2018-04-25T05:24:36.775Z","updated_at":"2018-04-25T05:24:36.775Z","actor":{"url":"/monero","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Monero"}},"reporter":{"username":"yukichen","url":"/yukichen"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2662159,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"https://github.com/monero-project/monero/pull/3668\nhttps://github.com/monero-project/monero/pull/3670\nhttps://github.com/monero-project/monero/pull/3692","automated_response":false,"created_at":"2018-04-25T05:26:55.496Z","updated_at":"2018-04-25T05:26:55.496Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"yukichen","url":"/yukichen"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2662160,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-04-25T05:27:06.926Z","updated_at":"2018-04-25T05:27:06.926Z","first_to_agree":true,"actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2662187,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2018-04-25T05:49:15.596Z","updated_at":"2018-04-25T05:49:15.596Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2665890,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty reward  :)","automated_response":false,"created_at":"2018-04-26T04:35:24.719Z","updated_at":"2018-04-26T04:35:24.719Z","actor":{"username":"yukichen","cleared":false,"url":"/yukichen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}