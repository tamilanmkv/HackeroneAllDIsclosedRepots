{"id":1352429,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzUyNDI5","url":"https://hackerone.com/reports/1352429","title":"CVE-2021-3711: SM2 decrypt  buffer overflow ","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2021-09-27T13:47:10.778Z","submitted_at":"2021-09-27T13:47:10.842Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ouyang","url":"/ouyang","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":54349,"url":"https://hackerone.com/ibb","handle":"ibb","profile_picture_urls":{"small":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJF6VFL6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T133902Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCID1So1KYRjOmBFJqLsqO1j9SSUCF9kJ%2FHqahOyDLmrnJAiAr2q5Z8bAgCyaCmyDSz7xwtmUTDOoz04myJOluBHRCeyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMvFUMWX6P00RsVarQKtcDflFFNScU3coA1YbnKy4lPXtwGDNsJcqhfcCTaePuAuK6nWvl5xRbjzjOBPvBHaTAnb2Iw%2B6Jdj2uyjmRMn%2F5%2F5AzD5di2wWOcC0am9iLaFmORG4VIVXTc8aAiiwqjNAu7dH2hTUNL9bwPzYUBq3%2FjwvNZUM%2FmpdXfugOwAP%2FP3w9e9PqozA16XzrwGIunimlg58HKZfOM0xp%2FESLFXRHAssX6DaYqQQyV5%2F0triAQeOx328GOBUjfGTiAl1aoS1J0%2FqN%2BmywXW%2FqqkEfAQ2n2f18dX2dkbwMnyQ4F47zR6jJw3CdBkeCPRDbbhcu8YGu2%2F%2BzzM9B4uguhR76M3KYB3dr919eRp%2F%2BcOfUxc8TC3gXMmp1jh0ywwC27sBrzUgZdh%2B2g4artPxRaRZPHbQvC%2F1OZ0MxZYsQmEItbUc65WqfO6PSdLbymEFDMyN5ona14j%2BaQHfp1MWNaO02I2WPYO5mZIsPuHjCO5MYUldcsrZMP7pydKVo87gkO2fPB2orxw1RGazxVwGy5R2PDIV7HsKH4KSOqhGLTTYcSjZvxzmTWIy013yrXhU3CEdFUoB7QifSN1bUli2cMIaUe7sr75onhlaNnQxqLv%2By7jqQ9RiOHvcMM4XIMInwkIsGOqYBzgDHFUI%2FtkToYUBHsGsXyI9vGkS81IUV4PSjgSfvCFIGR%2BPjro3EYi30Oc%2FQZijhik3H1oI82Vno5zo%2BVnueR7%2BkGCloKvMkJAe%2F77e%2BPPRDClquvRG9ERm7ELsd6WvljYOJTmuP4pWPW%2B2d%2BQu26lThNein0I5abJKiu%2FYvnXDmBeYAgLMwbyg9Lq3qT5qMKsr3i1aOgHcGHtYldnzNcLqwaNJYhw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4abbd16574549f8d2d5b61e858958bf71e3d788522bc78bc60d94fe7dc071feb","medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJF6VFL6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T133902Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCID1So1KYRjOmBFJqLsqO1j9SSUCF9kJ%2FHqahOyDLmrnJAiAr2q5Z8bAgCyaCmyDSz7xwtmUTDOoz04myJOluBHRCeyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMvFUMWX6P00RsVarQKtcDflFFNScU3coA1YbnKy4lPXtwGDNsJcqhfcCTaePuAuK6nWvl5xRbjzjOBPvBHaTAnb2Iw%2B6Jdj2uyjmRMn%2F5%2F5AzD5di2wWOcC0am9iLaFmORG4VIVXTc8aAiiwqjNAu7dH2hTUNL9bwPzYUBq3%2FjwvNZUM%2FmpdXfugOwAP%2FP3w9e9PqozA16XzrwGIunimlg58HKZfOM0xp%2FESLFXRHAssX6DaYqQQyV5%2F0triAQeOx328GOBUjfGTiAl1aoS1J0%2FqN%2BmywXW%2FqqkEfAQ2n2f18dX2dkbwMnyQ4F47zR6jJw3CdBkeCPRDbbhcu8YGu2%2F%2BzzM9B4uguhR76M3KYB3dr919eRp%2F%2BcOfUxc8TC3gXMmp1jh0ywwC27sBrzUgZdh%2B2g4artPxRaRZPHbQvC%2F1OZ0MxZYsQmEItbUc65WqfO6PSdLbymEFDMyN5ona14j%2BaQHfp1MWNaO02I2WPYO5mZIsPuHjCO5MYUldcsrZMP7pydKVo87gkO2fPB2orxw1RGazxVwGy5R2PDIV7HsKH4KSOqhGLTTYcSjZvxzmTWIy013yrXhU3CEdFUoB7QifSN1bUli2cMIaUe7sr75onhlaNnQxqLv%2By7jqQ9RiOHvcMM4XIMInwkIsGOqYBzgDHFUI%2FtkToYUBHsGsXyI9vGkS81IUV4PSjgSfvCFIGR%2BPjro3EYi30Oc%2FQZijhik3H1oI82Vno5zo%2BVnueR7%2BkGCloKvMkJAe%2F77e%2BPPRDClquvRG9ERm7ELsd6WvljYOJTmuP4pWPW%2B2d%2BQu26lThNein0I5abJKiu%2FYvnXDmBeYAgLMwbyg9Lq3qT5qMKsr3i1aOgHcGHtYldnzNcLqwaNJYhw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=052d843208e95905bec23545b60f1f95c6f1c536f1e9d000bef126734d30e314"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Internet Bug Bounty","twitter_handle":"","website":"https://www.hackerone.com/internet-bug-bounty","about":"The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-3711"],"singular_disclosure_disabled":false,"disclosed_at":"2021-09-27T18:19:33.623Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-09-27T18:19:14.286Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"CVE-2021-3711\nIn order to decrypt SM2 encrypted data an application is expected to call the API function EVP_PKEY_decrypt(). Typically an application will call this function twice. The first time, on entry, the \"out\" parameter can be NULL and, on exit, the \"outlen\" parameter is populated with the buffer size required to hold the decrypted plaintext. The application can then allocate a sufficiently sized buffer and call EVP_PKEY_decrypt() again, but this time passing a non-NULL value for the \"out\" parameter. A bug in the implementation of the SM2 decryption code means that the calculation of the buffer size required to hold the plaintext returned by the first call to EVP_PKEY_decrypt() can be smaller than the actual size required by the second call. This can lead to a buffer overflow when EVP_PKEY_decrypt() is called by the application a second time with a buffer that is too small. \n\n\nReproduce step:\n\nExamples of data that triggered the vulnerability\n1. SM2 ciphertext data\nExamples of ciphertext data are as follows:\n\n3072022070DAD60CDA7C30D64CF4F278A849003581223F5324BFEC9BB329229BFFAD21A6021F18AFAB2B35459D2643243B242BE4EA80C6FA5071D2D847340CC57EB9309E5D04200B772E4DB664B2601E3B85E39E4DB664B2601E3B85E39C4AA308BE13588C301308E3588C01308E3588E3308E4\n\n2. Parse SM2 ciphertext\nThe length of this ciphertext is 116 bytes. Parse this group of ciphertexts according to the ASN.1 format:\n\n3072 //30 indicates the SEQUENCE type, 72 indicates that the total length of the subsequent data is 114 bytes\n\n0220 //02 means INTEGER type, 20 means the length of the integer is 32 bytes\n\n70DAD60CDA7C30D64CF4F278A849003581223F5324BFEC9BB329229BFFAD21A6 //32-byte XCoordinate\n\n021F //02 means INTEGER type, 1F means the length of the integer is 31 bytes\n\n18AFAB2B35459D2643243B242BE4EA80C6FA5071D2D847340CC57EB9309E5D //31-byte YCoordinate\n\n0420 //04 means OCTETSTRING type, 20 means the length of the string is 32 bytes\n\n0B772E4DB664B2601E3B85E39C4AA8C2C1910308BE13B331E009C5A9258C29FD //32-byte HASH\n\n040B //04 means OCTETSTRING type, 0B means the length of the string is 11 bytes\n\n6D588BE9260A94DA18E0E6 //11-byte ciphertext\n\nAfter verification, the above-mentioned XCoordinate and YCoordinate satisfy the SM2 elliptic curve equation.\n\n3. Trigger heap overflow\nWhen pkey_sm2_decrypt is called for the first time, the pointer out is NULL and msg_len is equal to 116. The sm2_plaintext_size function returns 10 (msg_len-overhead = 116-106).\n\n10 bytes of memory are allocated through OPENSSL_malloc, and out points to this memory.\n\nThe second call to pkey_sm2_decrypt, since the ciphertext has 11 bytes, the decryption result is also 11 bytes.\n\nThe memory pointed to by out is 10 bytes, and the decrypted result is 11 bytes, resulting in 1 byte being written out of bounds.\n\n## Impact\n\nA malicious attacker who is able present SM2 content for decryption to an application could cause attacker chosen data to overflow the buffer by up to a maximum of 62 bytes altering the contents of other data held after the buffer, possibly changing application behaviour or causing the application to crash. The location of the buffer is application dependent but is typically heap allocated. \n\nOpenSSL versions 1.1.1k and below are affected by this issue. Users of these versions should upgrade to OpenSSL 1.1.1l.\n\nOpenSSL 1.0.2 is not impacted by this issue.\n\nOpenSSL 3.0 alpha/beta releases are also affected but this issue will be addressed before the final release.","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":3,"name":"Classic Buffer Overflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-10-27T18:19:14.417Z","allow_singular_disclosure_after":1399211.966084245,"singular_disclosure_allowed":false,"vote_count":13,"voters":["holybugx","brumens","cryptographer","rashi_zoya","zulfi0","superceed","root_null","vitorsouza","meispi","its_me_krish","and 3 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":80989,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/openssl/openssl","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":13651802,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2021-09-27T18:10:28.191Z","updated_at":"2021-09-27T18:10:28.191Z","cve_ids":["CVE-2021-3711"],"actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651811,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"Updating to match OpenSSL assigned severity.","automated_response":false,"created_at":"2021-09-27T18:11:07.844Z","updated_at":"2021-09-27T18:11:07.844Z","additional_data":{"old_severity":"Critical (9.8)","new_severity":"High","old_severity_id":1246913,"new_severity_id":1247506},"actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651842,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank you for your contribution to making the Internet safer! \n\nThis bounty was awarded with a 80/20% split. An additional $500 will be paid to the project.","automated_response":false,"created_at":"2021-09-27T18:17:30.192Z","updated_at":"2021-09-27T18:17:30.192Z","actor":{"url":"/ibb","ibb":false,"profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJF6VFL6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T133902Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCID1So1KYRjOmBFJqLsqO1j9SSUCF9kJ%2FHqahOyDLmrnJAiAr2q5Z8bAgCyaCmyDSz7xwtmUTDOoz04myJOluBHRCeyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMvFUMWX6P00RsVarQKtcDflFFNScU3coA1YbnKy4lPXtwGDNsJcqhfcCTaePuAuK6nWvl5xRbjzjOBPvBHaTAnb2Iw%2B6Jdj2uyjmRMn%2F5%2F5AzD5di2wWOcC0am9iLaFmORG4VIVXTc8aAiiwqjNAu7dH2hTUNL9bwPzYUBq3%2FjwvNZUM%2FmpdXfugOwAP%2FP3w9e9PqozA16XzrwGIunimlg58HKZfOM0xp%2FESLFXRHAssX6DaYqQQyV5%2F0triAQeOx328GOBUjfGTiAl1aoS1J0%2FqN%2BmywXW%2FqqkEfAQ2n2f18dX2dkbwMnyQ4F47zR6jJw3CdBkeCPRDbbhcu8YGu2%2F%2BzzM9B4uguhR76M3KYB3dr919eRp%2F%2BcOfUxc8TC3gXMmp1jh0ywwC27sBrzUgZdh%2B2g4artPxRaRZPHbQvC%2F1OZ0MxZYsQmEItbUc65WqfO6PSdLbymEFDMyN5ona14j%2BaQHfp1MWNaO02I2WPYO5mZIsPuHjCO5MYUldcsrZMP7pydKVo87gkO2fPB2orxw1RGazxVwGy5R2PDIV7HsKH4KSOqhGLTTYcSjZvxzmTWIy013yrXhU3CEdFUoB7QifSN1bUli2cMIaUe7sr75onhlaNnQxqLv%2By7jqQ9RiOHvcMM4XIMInwkIsGOqYBzgDHFUI%2FtkToYUBHsGsXyI9vGkS81IUV4PSjgSfvCFIGR%2BPjro3EYi30Oc%2FQZijhik3H1oI82Vno5zo%2BVnueR7%2BkGCloKvMkJAe%2F77e%2BPPRDClquvRG9ERm7ELsd6WvljYOJTmuP4pWPW%2B2d%2BQu26lThNein0I5abJKiu%2FYvnXDmBeYAgLMwbyg9Lq3qT5qMKsr3i1aOgHcGHtYldnzNcLqwaNJYhw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=052d843208e95905bec23545b60f1f95c6f1c536f1e9d000bef126734d30e314"},"profile":{"name":"Internet Bug Bounty"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"ibb","collaborator":{"username":"ouyang","url":"/ouyang"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651849,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2021-09-27T18:18:42.977Z","updated_at":"2021-09-27T18:18:42.977Z","additional_data":{"added_weaknesses":[{"id":3,"name":"Classic Buffer Overflow"}],"removed_weaknesses":[]},"actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651850,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2021-09-27T18:18:48.992Z","updated_at":"2021-09-27T18:18:48.992Z","actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"ouyang","url":"/ouyang"},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651858,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-09-27T18:19:14.314Z","updated_at":"2021-09-27T18:19:14.314Z","first_to_agree":true,"actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13651860,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2021-09-27T18:19:33.545Z","updated_at":"2021-09-27T18:19:33.545Z","actor":{"username":"kunderkoffler","cleared":false,"url":"/kunderkoffler","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":93827,"category":"team","content":"OpenSSL Advisory: https://www.openssl.org/news/secadv/20210824.txt","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":904892,"username":"kunderkoffler","name":"Kayla Underkoffler","bio":null,"cleared":false,"website":null,"location":null,"created_at":"2020-01-13T19:26:22.339Z","url":"https://hackerone.com/kunderkoffler","anc_triager":false,"hackerone_triager":false,"hackerone_employee":true,"user_type":"company","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","xtralarge":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}