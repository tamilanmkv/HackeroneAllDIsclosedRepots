{"id":885031,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84ODUwMzE=","url":"https://hackerone.com/reports/885031","title":"[commit-msg] RCE via insecure command formatting","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-05-28T19:08:57.534Z","submitted_at":"2020-05-28T19:08:57.534Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mik317","url":"/mik317","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/235/168/b1978368a15e57488f15b4f8aff454d3e3e98184_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23949,"url":"https://hackerone.com/nodejs-ecosystem","handle":"nodejs-ecosystem","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Node.js third-party modules","twitter_handle":"","website":"https://nodejs.org/en/security/","about":"This program is used to handle vulnerabilities in the Node.js ecosystem."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-09-24T19:25:32.402Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-08-25T19:25:13.878Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I would like to report a `RCE` issue in the `commit-msg` module.\nIt allows to execute `arbitrary commands remotely inside the victim's PC`\n\n# Module\n**module name:** `commit-msg`\n**version:** `0.2.3`\n**npm page:** `https://www.npmjs.com/package/commit-msg`\n\n## Module Description\n\u003e commit-msg is a customizable git commit message parser and validator written in Node.js. It validates a given string based on best practices and can be used as a git hook, command line tool and/or directly through the API.\n\n## Module Stats\n[103] downloads in the last week\n\n## Vulnerability Description\nThe issue occurs because a `user input` is formatted inside a `command` that will be executed without any check. The issue arises here: https://github.com/clns/node-commit-msg/blob/master/bin/validate#L128\n\n## Steps To Reproduce:\n1. Check there aren't files called `HACKED` \n1. Execute the following commands in another terminal:\n\n```bash\nnpm i commit-msg -g # Install affected module\ngit init # Init the current dir as *git*\necho \"test||reboot\" | commit-msg stdin # Your machine will be rebooted because `reboot` command is injected\nnode poc.js #  Run the PoC\n```\n1. Recheck the files: now `HACKED` has been created :)\n\n## Patch\n\u003e Don't format `commands` using insecure `user's inputs` :)\n\n## Supporting Material/References:\n- [OPERATING SYSTEM VERSION]: Kali Linux\n- [NODEJS VERSION]: v12.16.1\n- [NPM VERSION]: 6.13.4\n\n# Wrap up\n- I contacted the maintainer to let them know: [N] \n- I opened an issue in the related repository: [N]\n\n## Impact\n\n`RCE` via command formatting on `commit-msg`","vulnerability_information_html":"\u003cp\u003eI would like to report a \u003ccode\u003eRCE\u003c/code\u003e issue in the \u003ccode\u003ecommit-msg\u003c/code\u003e module.\u003cbr\u003e\nIt allows to execute \u003ccode\u003earbitrary commands remotely inside the victim\u0026#39;s PC\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1 id=\"module\"\u003eModule\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003emodule name:\u003c/strong\u003e \u003ccode\u003ecommit-msg\u003c/code\u003e\u003cbr\u003e\n\u003cstrong\u003eversion:\u003c/strong\u003e \u003ccode\u003e0.2.3\u003c/code\u003e\u003cbr\u003e\n\u003cstrong\u003enpm page:\u003c/strong\u003e \u003ccode\u003ehttps://www.npmjs.com/package/commit-msg\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2 id=\"module-description\"\u003eModule Description\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003ecommit-msg is a customizable git commit message parser and validator written in Node.js. It validates a given string based on best practices and can be used as a git hook, command line tool and/or directly through the API.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"module-stats\"\u003eModule Stats\u003c/h2\u003e\n\n\u003cp\u003e[103] downloads in the last week\u003c/p\u003e\n\n\u003ch2 id=\"vulnerability-description\"\u003eVulnerability Description\u003c/h2\u003e\n\n\u003cp\u003eThe issue occurs because a \u003ccode\u003euser input\u003c/code\u003e is formatted inside a \u003ccode\u003ecommand\u003c/code\u003e that will be executed without any check. The issue arises here: \u003ca title=\"https://github.com/clns/node-commit-msg/blob/master/bin/validate#L128\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fclns%2Fnode-commit-msg%2Fblob%2Fmaster%2Fbin%2Fvalidate%23L128\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/clns/node-commit-msg/blob/master/bin/validate#L128\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eCheck there aren\u0026#39;t files called \u003ccode\u003eHACKED\u003c/code\u003e \u003c/li\u003e\n\u003cli\u003eExecute the following commands in another terminal:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003enpm i commit-msg \u003cspan class=\"nt\"\u003e-g\u003c/span\u003e \u003cspan class=\"c\"\u003e# Install affected module\u003c/span\u003e\ngit init \u003cspan class=\"c\"\u003e# Init the current dir as *git*\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;test||reboot\u0026quot;\u003c/span\u003e | commit-msg stdin \u003cspan class=\"c\"\u003e# Your machine will be rebooted because `reboot` command is injected\u003c/span\u003e\nnode poc.js \u003cspan class=\"c\"\u003e#  Run the PoC\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eRecheck the files: now \u003ccode\u003eHACKED\u003c/code\u003e has been created :)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"patch\"\u003ePatch\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDon\u0026#39;t format \u003ccode\u003ecommands\u003c/code\u003e using insecure \u003ccode\u003euser\u0026#39;s inputs\u003c/code\u003e :)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e[OPERATING SYSTEM VERSION]: Kali Linux\u003c/li\u003e\n\u003cli\u003e[NODEJS VERSION]: v12.16.1\u003c/li\u003e\n\u003cli\u003e[NPM VERSION]: 6.13.4\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"wrap-up\"\u003eWrap up\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eI contacted the maintainer to let them know: [N] \u003c/li\u003e\n\u003cli\u003eI opened an issue in the related repository: [N]\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eRCE\u003c/code\u003e via command formatting on \u003ccode\u003ecommit-msg\u003c/code\u003e\u003c/p\u003e\n","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-09-24T19:25:14.276Z","allow_singular_disclosure_after":-8250034.485587736,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"severity":{"rating":"medium","score":6.4,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":2986,"asset_type":"SOURCE_CODE","asset_identifier":"Other module","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8144082,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi @mik317,\n\nAssuming a user has this module installed, how would an attacker craft the input so that `commit-msg` is ran with the attacker's input. While there may be an RCE possible, it's unclear how this can be achieved when a website is involved. \n\nShouldn't the website developer be responsible to escape any characters that are being sent to a shell command?\n\nI might be missing something here, so please let me know if you disagree and please don't hesitate to leave as many details as possible :)\n\nThanks, \n@ktistai","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mik317\"\u003e@mik317\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eAssuming a user has this module installed, how would an attacker craft the input so that \u003ccode\u003ecommit-msg\u003c/code\u003e is ran with the attacker\u0026#39;s input. While there may be an RCE possible, it\u0026#39;s unclear how this can be achieved when a website is involved. \u003c/p\u003e\n\n\u003cp\u003eShouldn\u0026#39;t the website developer be responsible to escape any characters that are being sent to a shell command?\u003c/p\u003e\n\n\u003cp\u003eI might be missing something here, so please let me know if you disagree and please don\u0026#39;t hesitate to leave as many details as possible :)\u003c/p\u003e\n\n\u003cp\u003eThanks, \u003cbr\u003e\n\u003ca href=\"/ktistai\"\u003e@ktistai\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-29T11:38:47.548Z","updated_at":"2020-05-29T11:38:47.548Z","actor":{"username":"ktistai","cleared":false,"url":"/ktistai","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/322/520/01cd21dce301646646276fd9125cffd448fbffd6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8144685,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @ktistai :),\nI know it's a bit confusing, however other issues like this have been previously accepted, like #846953 and #843632.\n\nThis is my view (let me know what you think about it, I'm always happy to see different views :)):\n\n* the node modules aren't used only for web, which means it could be really different the implementation logic (that's the interesting thing of modules: they're implementation indipendent)\n\n* the module it-self should avoid concatenating user supplied inputs, and instead opt for the safe usage of `execFile` function, which could delete every risk. Before being a security risk, it's also a bad pattern of programming software and could lead to unexcepted behaviors (like the RCE I shown). In my opinion, also the website/program developer should validate every input, however the module creator should avoid mistake which could lead to RCE (the malicious behavior is due to the creator of the module, not by developer who's using it: \nnot check input wouldn't anyway lead to RCE if it was used another module).\n\n* Note also the malicious program is inside the `/bin` directory of the module. This means this piece of code could be used in different places/ways and be implemented without be modified, leading to RCE without being called inside a specific tool/program.\n\nLet me know if you need any other info :)\n\nBest, \nMik","markdown_message":"\u003cp\u003eHi \u003ca href=\"/ktistai\"\u003e@ktistai\u003c/a\u003e :),\u003cbr\u003e\nI know it\u0026#39;s a bit confusing, however other issues like this have been previously accepted, like \u003ca href=\"/reports/846953\"\u003e#846953\u003c/a\u003e and \u003ca href=\"/reports/843632\"\u003e#843632\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis is my view (let me know what you think about it, I\u0026#39;m always happy to see different views :)):\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003ethe node modules aren\u0026#39;t used only for web, which means it could be really different the implementation logic (that\u0026#39;s the interesting thing of modules: they\u0026#39;re implementation indipendent)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003ethe module it-self should avoid concatenating user supplied inputs, and instead opt for the safe usage of \u003ccode\u003eexecFile\u003c/code\u003e function, which could delete every risk. Before being a security risk, it\u0026#39;s also a bad pattern of programming software and could lead to unexcepted behaviors (like the RCE I shown). In my opinion, also the website/program developer should validate every input, however the module creator should avoid mistake which could lead to RCE (the malicious behavior is due to the creator of the module, not by developer who\u0026#39;s using it: \u003cbr\u003e\nnot check input wouldn\u0026#39;t anyway lead to RCE if it was used another module).\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eNote also the malicious program is inside the \u003ccode\u003e/bin\u003c/code\u003e directory of the module. This means this piece of code could be used in different places/ways and be implemented without be modified, leading to RCE without being called inside a specific tool/program.\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eLet me know if you need any other info :)\u003c/p\u003e\n\n\u003cp\u003eBest, \u003cbr\u003e\nMik\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-29T12:29:50.339Z","updated_at":"2020-05-29T12:29:50.339Z","actor":{"username":"mik317","cleared":false,"url":"/mik317","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/235/168/b1978368a15e57488f15b4f8aff454d3e3e98184_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8179293,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @mik317,\n\nThank you for your submission! We were able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nRegards,\n@ktistai","markdown_message":"\u003cp\u003eHello \u003ca href=\"/mik317\"\u003e@mik317\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your submission! We were able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/ktistai\"\u003e@ktistai\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-02T13:48:37.967Z","updated_at":"2020-06-02T13:48:37.967Z","actor":{"username":"ktistai","cleared":false,"url":"/ktistai","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/322/520/01cd21dce301646646276fd9125cffd448fbffd6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8179328,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-02T13:50:41.602Z","updated_at":"2020-06-02T13:50:41.602Z","additional_data":{"old_severity":"Critical","new_severity":"Medium (6.4)","old_severity_id":734783,"new_severity_id":738914},"actor":{"username":"ktistai","cleared":false,"url":"/ktistai","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/322/520/01cd21dce301646646276fd9125cffd448fbffd6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8179363,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you so much :)\n\nBest, Mik","markdown_message":"\u003cp\u003eThank you so much :)\u003c/p\u003e\n\n\u003cp\u003eBest, Mik\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-02T13:53:55.378Z","updated_at":"2020-06-02T13:53:55.378Z","actor":{"username":"mik317","cleared":false,"url":"/mik317","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/235/168/b1978368a15e57488f15b4f8aff454d3e3e98184_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9037485,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"So far the invitation to join this report was not accepted by the maintainer, Going to request the disclosure.","markdown_message":"\u003cp\u003eSo far the invitation to join this report was not accepted by the maintainer, Going to request the disclosure.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-25T19:25:03.871Z","updated_at":"2020-08-25T19:25:03.871Z","actor":{"username":"danielruf","cleared":false,"url":"/danielruf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JjaMiHpqpLG3vx6VJMAA9KbK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mik317","url":"/mik317"},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9037491,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-25T19:25:13.909Z","updated_at":"2020-08-25T19:25:13.909Z","first_to_agree":true,"actor":{"username":"danielruf","cleared":false,"url":"/danielruf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JjaMiHpqpLG3vx6VJMAA9KbK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9322389,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-09-24T19:25:34.636Z","updated_at":"2020-09-24T19:25:34.636Z","actor":{"url":"/nodejs-ecosystem","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Node.js third-party modules"}},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}