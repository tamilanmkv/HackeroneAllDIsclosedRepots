{"id":103787,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDM3ODc=","url":"https://hackerone.com/reports/103787","title":"CSRF possible when SOP Bypass/UXSS is available ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-12-06T12:56:10.665Z","submitted_at":"2015-12-06T12:56:10.665Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"avlidienbrunn","url":"/avlidienbrunn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2015-3115"],"singular_disclosure_disabled":false,"disclosed_at":"2015-12-30T15:23:41.230Z","bug_reporter_agreed_on_going_public_at":"2015-12-30T15:23:40.751Z","team_member_agreed_on_going_public_at":"2015-12-25T19:09:45.368Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Description**\nIf an attacker could extract content from https://hackerone.com, they could perform CSRF attacks due to the fact that:\n1. Some pages prints the token in the HTML response (edit user form at https://hackerone.com/settings/profile/edit)\n2. Tokens aren't bound per action\n3. PATCH/DELETE can be sent via _method\n\nAttacker being allowed to read content but not execute JS could happen if:\n1. SOP Bypass in plugin (http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3115)\n2. SOP Bypass in application design (https://miki.it/blog/2014/7/8/abusing-jsonp-with-rosetta-flash/)\n3. UXSS (https://blog.innerht.ml/ie-uxss/)\n\nCurrently, some mitigations are in place. _method isn't allowed in GET and the Origin header is checked. This isn't enough since FireFox and IE doesn't send Origin header when submitting forms.\n\n**Attack scenario**\nThe most recent (to my knowledge) SOP bypass was the re-implementation of the IE UXSS bug (https://blog.innerht.ml/ie-uxss/). This was working November 28th 2015. However, the bug required framing at least one resource, and HackerOne sends X-Frame-Options on all resources. Sadly, HackerOne uses CloudFlare so the URL https://hackerone.com/cdn-cgi/trace could be used (doesn't send X-Frame-Options).\n\nSo to sum up:\n1. Logged in user visits attackers page in IE (vulnerable to UXSS)\n2. UXSS runs script on framed \"https://hackerone.com/cdn-cgi/trace\" to extract CSRF token on https://hackerone.com/settings/profile/edit (via AJAX)\n3. User is attacked with the extracted CSRF token\n\n**Fix**\nThis could be mitigated by storing the token in JavaScript and adding the token to the form after the page is loaded.","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":64654,"file_name":"example.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/064/654/f1e83a7c511c8be1cdb155adc93b52736676ef97/example.png?response-content-disposition=attachment%3B%20filename%3D%22example.png%22%3B%20filename%2A%3DUTF-8%27%27example.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQX7PP7FPW%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T131823Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJIMEYCIQDDiuCfL%2BS4tiROXxowy5DzDboXKbhLJjNSYDgcPA0uRgIhAPQkAiMjIMcghJw46wmnpU80BJ6z0yX2OoV8Y5qn9%2BwwKoMECO3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxG5NxL7lMgzmgqulcq1wOYYZGTKbqSHePVneJErq%2BKSnwqrI8FtMRYF4RBWIbTXuyxQW9BC1J2aa%2Fr48esAta07A%2BRttyAZhYD52uIs0f82%2BFlSPwM%2F%2FfhHhnRZ7FRg3KVU6Rb5bh7cQzp5ds9ga9VT1WPQJEAkZoESeJXD0aMzb%2BaD4oWcl6M2wKyqT8FV%2Bf%2F4R2O6Vo8xRc12X%2FqIBAoKelaOeOOgwoHTahfxPS%2BqY5cyGIZwFskhU%2BWgW%2FkJfTd2DOwwIFsTgHFffSbW7knB4H2llAtQ2G81NDPB82a1p0mX2jRMoNtdHGKkMW4aIzx8HTm7O60d68j8DcWd1Lro3G9lnDQIG8JHZPaAQmW6G3lxW5Y0dfzM0xU8JNnhtOISpodOYeAt%2F%2FaDO%2Ftif%2BjhWGsbMvPfp2R7hCT02rUG3naq4FDNfeOtJOLA4IAxtEldSPkxump0Nz%2FfmJnSR%2FDWbKVJesFmMLMlnrh89nGNLZRUk3lTrMEcLl8Cmw72na35nIOChAWBxNkLUQ1JJEPZPovticqfZlYVVZ4%2Bwlsp%2BzjYQhEV61EnAqNuTOcJIJEPD2BKCAvtCRiYds5gB4fHYIYaRRNZV4UdbH00xg%2FMe8FykjYPkbHvugxuG36iFT%2Fzods9gswx9WQiwY6pAHK5s%2BlXbm2Q8%2FRAQ6fJP8b5jq3CYkFtqnbh%2BXXLJ2xsyO06X4Z8QF7eArWutwuzbFGHy1DPWJvxhvRS85mYfxYa5W5esmf9kR5eG3DxQB15u89jhJSnD8S6wRMBWxwaO1u79UFUNwv%2FHgPC8TflOR1N4MYeRMdwxjFdYYfYujS4zD8LiiYuDVt0nxAyng5mdWU40Sg4lyC95iDjomBUKLF75WlTQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=04ce2afc00b7861cae637162776b88442aaff6b8ddb793818a0dc3f428501a9f","file_size":136447,"type":"image/png"}],"allow_singular_disclosure_at":"2016-01-24T19:09:45.902Z","allow_singular_disclosure_after":-180295717.5425988,"singular_disclosure_allowed":true,"vote_count":10,"voters":["michiel","powerjacobb1","an0nym0us","ak1t4","osama-hamad","silv3rpoision","666reda","spetr0x","safisec","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":711134,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @avlidienbrunn,\n\nThanks for your report, we will look into this.\n\nBest regards,\nJens","automated_response":false,"created_at":"2015-12-07T10:12:03.676Z","updated_at":"2015-12-07T10:12:03.676Z","actor":{"username":"jens","cleared":false,"url":"/jens","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/053/9c23f98571002dd0db70919126ae92746a6af99a_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":712876,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have reported this (missing X-Frame-Options on /cdn-cgi resources) to CloudFlare (as #104122).","automated_response":false,"created_at":"2015-12-08T15:44:10.004Z","updated_at":"2015-12-08T15:44:10.004Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":712877,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"A fix has been deployed. Can you verify it? Thanks!","automated_response":false,"created_at":"2015-12-08T15:44:12.033Z","updated_at":"2015-12-08T15:44:12.033Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":712885,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks fixed!","automated_response":false,"created_at":"2015-12-08T15:54:02.694Z","updated_at":"2015-12-08T15:54:02.694Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":712913,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks! We'll get back to you soon about the bounty.","automated_response":false,"created_at":"2015-12-08T16:35:37.894Z","updated_at":"2015-12-08T16:35:37.894Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"avlidienbrunn","url":"/avlidienbrunn"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":712919,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can I have a hoodie instead?","automated_response":false,"created_at":"2015-12-08T16:37:54.171Z","updated_at":"2015-12-08T16:37:54.171Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":712928,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"Sure, we'll get you one!","automated_response":false,"created_at":"2015-12-08T16:40:34.954Z","updated_at":"2015-12-08T16:40:34.954Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"reporter":{"username":"avlidienbrunn","url":"/avlidienbrunn"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":712932,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks!","automated_response":false,"created_at":"2015-12-08T16:42:09.726Z","updated_at":"2015-12-08T16:42:09.726Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":729020,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Besides the swag, we would like to award a bounty as well for this great find. Even though this is really a CloudFlare and/or IE issue, you could still use this technique to get a valid CSRF token, which could be used to add a malicious team member or external user in order to access reports. We welcome great reports like this one that we can use as defense-in-depth for protecting our platform for all our users (including those who use IE).\n\nWe continue to work with CloudFlare to get the /cdn-cgi/ issue resolved on their end, and we hope that IE will fix the UXSS issue as well.","automated_response":false,"created_at":"2015-12-22T04:46:29.205Z","updated_at":"2015-12-22T04:46:29.205Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"bounty_amount":"2500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"avlidienbrunn","url":"/avlidienbrunn"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":732360,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"CloudFlare has pushed a change that adds the `X-Frame-Options: SAMEORIGIN` header to all their `/cdn-cgi/` endpoints. Can you confirm that now prevents your IE UXSS issue from working?","automated_response":false,"created_at":"2015-12-25T08:54:23.692Z","updated_at":"2015-12-25T08:54:23.692Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":732396,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yep, it's fixed (the UXSS too since a while back, but since it's been \"revived\" a few times who knows when it will work again :)). Thanks for the bounty!","automated_response":false,"created_at":"2015-12-25T11:06:13.513Z","updated_at":"2015-12-25T11:06:13.513Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":732578,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-12-25T19:09:45.411Z","updated_at":"2015-12-25T19:09:45.411Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":734569,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@avlidienbrunn, can you agree to disclosure? :)","automated_response":false,"created_at":"2015-12-28T21:19:32.777Z","updated_at":"2015-12-28T21:19:32.777Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":736331,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Done!","automated_response":false,"created_at":"2015-12-30T15:23:36.177Z","updated_at":"2015-12-30T15:23:36.177Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":736332,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-12-30T15:23:40.787Z","updated_at":"2015-12-30T15:23:40.787Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":736333,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-12-30T15:23:41.277Z","updated_at":"2015-12-30T15:23:41.277Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":736805,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, https://github.com/rails/rails/pull/22275 would be a great help here by making CSRF tokens unique per form. I hope that the @rails team will review and accept the PR.","automated_response":false,"created_at":"2015-12-30T22:46:17.818Z","updated_at":"2015-12-30T22:46:17.818Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":766851,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@reed et.al. may I also suggest that you add the \"referrer\" directive to CSP? Without it, form-action directive can be bypassed in Firefox (if there's any forms containing tokens). Not sure how related that is to this report, but I don't think it's big enough to issue another report.","automated_response":false,"created_at":"2016-01-21T15:57:23.644Z","updated_at":"2016-01-21T15:58:41.525Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}