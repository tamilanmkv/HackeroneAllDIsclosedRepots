{"id":1085336,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDg1MzM2","url":"https://hackerone.com/reports/1085336","title":"CSRF when unlocking lenses leads to lenses being forcefully installed without user interaction","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2021-01-23T14:19:13.358Z","submitted_at":"2021-01-23T14:19:13.410Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sdushantha","url":"/sdushantha","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":513,"url":"https://hackerone.com/snapchat","handle":"snapchat","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Snapchat","twitter_handle":"","website":"https://www.snapchat.com/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-07-29T22:33:23.649Z","bug_reporter_agreed_on_going_public_at":"2021-07-27T05:49:50.628Z","team_member_agreed_on_going_public_at":"2021-07-29T22:33:23.499Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nThe url below allows a user to unlock a particular lens. Once they have opened the URL on their phone, Snapchat opens up and prompts the user to unlock this lens.\n```\nhttps://www.snapchat.com/unlock/?type=SNAPCODE\u0026uuid=6ff5a565fca249a1948b1963ee2881b4\u0026metadata=01\n```\n\nBy changing the value of  `type` in the URL above, from `SNAPCODE` to `SNAPCODE_NO_PROMPT`, we can bypass the prompt mentioned earlier, and instead forcefully unlock the lens and make them use it, hence why this is a CSRF:\n```\nhttps://www.snapchat.com/unlock/?type=SNAPCODE_NO_PROMPT\u0026uuid=6ff5a565fca249a1948b1963ee2881b4\u0026metadata=01\n```\n\nThis issue also happens to Snapchat's deeplink on Android:\n```\nsnapchat://unlock/?type=SNAPCODE_NO_PROMPT\u0026uuid=6ff5a565fca249a1948b1963ee2881b4\u0026metadata=01\n```\n\n\nI do not have an iOS device but I am certain that this issue also occurs on the iOS version of Snapchat.\n\n## Impact\n\nA Snapchat lens developer can abuse this bug and increase the number of people who use their lens by making people opening the URL to the lens and replacing `SNAPCODE` with `SNAPCODE_NO_PROMPT`.  This can cause false popularity for that lens as it is being unlocked without the user wanting to do so. This would then lead to the user having to manually delete the lense that was automatically added.","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":12,"voters":["obsesif","tolga","ali","nipe","dastan_9408","h4x0r_dz","z1r343l","darkcyber_knight","afficialatb","kiddah","and 2 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":{"databaseId":11817,"asset_type":"GOOGLE_PLAY_APP_ID","asset_identifier":"com.snapchat.android","max_severity":"high"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10460054,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2021-01-23T14:19:38.916Z","updated_at":"2021-01-23T14:19:38.916Z","additional_data":{"old_title":"CSRF when unlocking lenses leds to lenses being forcefully installed without user interaction","new_title":"CSRF when unlocking lenses leads to lenses being forcefully installed without user interaction"},"actor":{"username":"sdushantha","cleared":false,"url":"/sdushantha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10477968,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report.\n\nWe were able to reproduce this behavior, but we're a bit unclear on the security impact this presents to Snapchat users. More specifically, when we accessed the `snapchat://unlock/?type=SNAPCODE_NO_PROMPT\u0026uuid=6ff5a565fca249a1948b1963ee2881b4\u0026metadata=01` link in the Snapchat app, the lens was opened on our device, but it looks like a user can simply exit out of the lens and opt to not take a photo using the lens. Thus, this behavior doesn't seem to pose a security risk, since the user is sent to the screen containing the lens and exit out, rather than an action being performed on their behalf as a result of accessing the link. Can you confirm if you encountered this in your tests? Is there anything we are misunderstanding about your report?\n\nThanks, and good luck with your future bug hunting.","automated_response":false,"created_at":"2021-01-25T23:05:48.826Z","updated_at":"2021-01-25T23:05:48.826Z","actor":{"username":"bugtriage-ryan","cleared":false,"url":"/bugtriage-ryan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10482603,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @bugtriage-ryan,\n\n\u003e it looks like a user can simply exit out of the lens and opt to not take a photo using the lens\n\nCorrect\n\n\u003e Thus, this behavior doesn't seem to pose a security risk, since the user is sent to the screen containing the lens and exit out, **rather than an action being performed on their behalf as a result of accessing the link.**\n\nI would have to disagree with you about your statement that I have bolded. \nAn action is being performed on the user's behalf as a result of accessing the link. This action is the adding of the lens. I do agree that the user is able to exit out of the lens and opt not to take a photo, but the lens is still getting \"installed\". The lens stays on their account for a set amount of time such as 48 hours, unless the user manually removes the lens by going into the information section which is the small 'i' that appears on the top left corner, while the lens is active.\n\nAs stated in my initial report, a lens creator could use this CSRF vulnerability to increase the number of people who have installed their lens because the user does not get to choose to unlock the lens or not.\n\nI am very sure that users would find it very annoying if they had many unwanted lenses installed which they never purpofully unlocked.\n\nI believe this is a valid report because this behavior is almost the same as the report on Periscope where the CSRF led to users automatically following someone without user interaction: https://hackerone.com/reports/805073","automated_response":false,"created_at":"2021-01-26T12:05:33.570Z","updated_at":"2021-01-26T12:05:33.570Z","actor":{"username":"sdushantha","cleared":false,"url":"/sdushantha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10497134,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your response.\n\nWe're looking into this, and we'll keep you updated when we have additional information.","automated_response":false,"created_at":"2021-01-27T15:25:39.061Z","updated_at":"2021-01-27T15:25:39.061Z","actor":{"username":"bugtriage-ryan","cleared":false,"url":"/bugtriage-ryan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10499650,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2021-01-27T20:30:39.248Z","updated_at":"2021-01-27T20:30:39.248Z","additional_data":{"old_severity":"Medium (6.1)","new_severity":"Low","old_severity_id":965168,"new_severity_id":969280},"actor":{"username":"sfrisk","cleared":false,"url":"/sfrisk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10499671,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2021-01-27T20:33:20.871Z","updated_at":"2021-01-27T20:33:20.871Z","actor":{"username":"sfrisk","cleared":false,"url":"/sfrisk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10567747,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! The panel has decided to award you $250 for your bug report. We appreciate your efforts - thanks, and good luck on your future bug hunting!","automated_response":false,"created_at":"2021-02-03T22:25:09.503Z","updated_at":"2021-02-03T22:25:09.503Z","actor":{"url":"/snapchat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/513/87067c5c4ed63c2c07a522ca3198d2310e2a14c6_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Snapchat"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"snapchat","collaborator":{"username":"sdushantha","url":"/sdushantha"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10569232,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you so much for the bounty!","automated_response":false,"created_at":"2021-02-04T05:30:34.458Z","updated_at":"2021-02-04T05:30:34.458Z","actor":{"username":"sdushantha","cleared":false,"url":"/sdushantha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10764678,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates on this issue of getting resolved?\n\nThanks,\n@sdushantha","automated_response":false,"created_at":"2021-02-24T08:46:38.609Z","updated_at":"2021-02-24T08:46:38.609Z","actor":{"username":"sdushantha","cleared":false,"url":"/sdushantha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11650115,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, thanks for your patience. A fix for android has been put in place but the iOS fix is still pending.","automated_response":false,"created_at":"2021-05-07T00:20:26.526Z","updated_at":"2021-05-07T00:20:26.526Z","actor":{"username":"sfrisk","cleared":false,"url":"/sfrisk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12686125,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @sdushantha, this should now be resolved. Thank you for your report and good luck on your future bug hunting!","automated_response":false,"created_at":"2021-07-26T23:14:19.001Z","updated_at":"2021-07-26T23:14:19.001Z","actor":{"username":"quanyang-sc","cleared":false,"url":"/quanyang-sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sdushantha","url":"/sdushantha"},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12687894,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"@quanyang-sc  Thank you. May we please disclose this report?","automated_response":false,"created_at":"2021-07-27T05:49:50.649Z","updated_at":"2021-07-27T05:49:50.649Z","first_to_agree":true,"actor":{"username":"sdushantha","cleared":false,"url":"/sdushantha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/135/666/e86acdab340fe947a4f9c8eee2e0193c99c0bac1_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12742742,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-07-29T22:33:23.536Z","updated_at":"2021-07-29T22:33:23.536Z","actor":{"username":"quanyang-sc","cleared":false,"url":"/quanyang-sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12742743,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-07-29T22:33:23.704Z","updated_at":"2021-07-29T22:33:23.704Z","actor":{"username":"quanyang-sc","cleared":false,"url":"/quanyang-sc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"snapchat","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":72711,"category":"team","content":"By sending a message containing a specially crafted link using the `SNAPCHAT_NO_PROMPT` type, a CSRF attack can be performed, causing the victim to unlock a Lens for their snapchat account without the prompt appearing.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":634581,"username":"quanyang-sc","name":"Quan Yang Yeo","bio":"","cleared":false,"website":null,"location":"","created_at":"2019-06-03T22:00:45.066Z","url":"https://hackerone.com/quanyang-sc","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"company","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","xtralarge":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}