{"id":100565,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDA1NjU=","url":"https://hackerone.com/reports/100565","title":"Executing scripts on slack-files.com using SVG","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-11-19T21:31:28.524Z","submitted_at":"2015-11-19T21:31:28.524Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kamil_hism","url":"/kamil_hism","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-02-18T21:02:48.459Z","bug_reporter_agreed_on_going_public_at":"2016-01-19T21:02:46.955Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Impact\n\nAlthough `slack-files.com` is a sandbox domain, there are many ways to gain the victim's trust during phishing attack. For example, an attacker might render a fake log-in form with \"You need to sign in to see this file\" message and trick users into handing out their passwords.\n\n\n## Steps to reproduce\n\n1) Download attached to report or use the following code snippet to create SVG file:\n\n```js\n\u003csvg width=\"100%\" height=\"100%\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" onload=\"alert('script')\"\u003e\n  \u003cscript type=\"text/javascript\"\u003e\u003c![CDATA[\n  // some exploit code here\n  ]]\u003e\u003c/script\u003e\n\n  \u003ccircle cx=\"50\" cy=\"50\" r=\"50\" fill=\"green\" /\u003e\n\u003c/svg\u003e\n```\n\nA SVG script and other DOM elements is equivalent to the elements in HTML, so in the example above `alert('script')` will be executed on svg load event.\n\n2) Upload constructed SVG file to some channel or dm in Slack.\n\n3) Click on message with just uploaded file.\n\n\n## Observed\nClicking on message opens a new tab and navigates user to `slack-files.com`. Once SVG loaded the `alert('script')` is executing.\n\nAlso this file can be shared via public link. In this case victim should click on image preview to start script execute.\n\n\n## Expected\nUsers expect that after clicking on message with file they will see this file or file will be downloaded.\n\n\n## Possible fix\nThere are three ways:\n* If you want to continue render SVG files directly in users browsers, you should refuse executing inline scripts by serving attachments with `Content-Security-Policy: default-src 'none';` header. For example GitHub uses this way (open dev console to observe CSP errors for SVG above: https://camo.githubusercontent.com/ce86214c84dcc6c0d85fc268c1c0b1a122fb37a0/687474703a2f2f6b616d696c2e6869736d2e72752f696d672f6578706c6f697461626c652e737667) But you need to be sure that users do not use deprecated browsers (see http://caniuse.com/#feat=contentsecuritypolicy)\n\n* Do not use `image/svg+xml` Content-Type when serving files. Use `text/plain`, so users will see just a raw inner of SVG file.\n\n* Serve SVG files with `Content-Disposition: attachment;` header. So browsers will start downloading attachment instead of render it in the browser.","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":62499,"file_name":"exploitable.svg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/062/499/fe2abc8a231826baf63c5dbd4a4faf0067f6f47f/exploitable.svg?response-content-disposition=attachment%3B%20filename%3D%22exploitable.svg%22%3B%20filename%2A%3DUTF-8%27%27exploitable.svg\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVJI3TZP5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T131608Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHQaCXVzLXdlc3QtMiJHMEUCIDDOenL7uY4or83Q1QkoD3xFl3uQkVICTxz%2FSDsIuWn2AiEA6%2FBWebe5fWUS9x04VtqSrFyJrrJX9Wzed2z5QiFgezgqgwQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDH%2Fcd6CfZMtsGgbHGSrXAymgqTqfvaCT83Vkk5pwapbWccEe%2BTtGThweNvSHf8FWkbmUnw2%2BMW8gqDcDNfGz7tEqv52qONc53GYs0r8D4W05T9cQ0uJtgIqBt4OmGkISCOluU2WykgPIXNEjqYkmh5zHooyqwoU4aWAvfbkbpMVL9O0nweFS83%2BqHqg3OXHtztd3WIO7FAtaIQ%2BDUZpyi%2B0a6zYS63Ic2i25q%2F413QAdfE21IQe9RLjfzNve6b8NLPdujPpkD5MvBg8opZAcnhH3rst0f02RrXBCwMAlbK6eiAdI%2FzxadkB6vJ9FtNU65o45iqF45d%2BYmfZJlOFMAVeS2pbeBJdGI7Fl7Z2hiMv0eHtvGwtxj3crYZJWjN69sMxNPs09KcOtApNPAFwGOGCcmDvm1areMVntxdnNYOlBWv0Aq3wyIXZsHHz8lX9tMjmv61dmZYvcByrfDvKW9exhQBN91h%2F%2BbxVbw80KEhIU5ipL2I5om6%2B6BoUggVA6Zd8rRJTc%2Fnn4LxgieuXFRKE4YsS3SCif0QZM6U80f0hPAJ0yiZeJUwXPDeGE0VCDJ5xmoacd5KWtjrjLbalrb5cz74c83ZZVOwv00icAbZKCzCMp4PLt5n7snHsnET8g6Tc7A6HNeDDY0ZCLBjqlARSrOasljqaSB8W9wmwFFWOUexc%2FyrrCODPiZEQKPd3A4ujWW2tnvxuhmbVhX2LLKdYUWL%2BqV7PXCjSBr8z9e13VbLgHltUO2EekXZyt0zUO0YHMr%2B%2B3y2ykh6QETPea4u6xBc1fOLSy9BKwigrMcXLVPZQgcLcQ07YofmFon1WVZYXr3Y0Iu6F%2Fi5W2fPKhu6dNiq1Z9eaTAlzThXI9e%2BPtktaqIg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=84e9a9660120b0893eb430d37babc84540e618ebd7cc46ec49fc469993132960","file_size":258,"type":"text/html"}],"allow_singular_disclosure_at":"2016-02-18T21:02:47.428Z","allow_singular_disclosure_after":-178128801.23939592,"singular_disclosure_allowed":true,"vote_count":3,"voters":["test0x00","sameerphad72","kamil_hism"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":692217,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Seems like HackerOne changed attachment extension from `.svg` to `.html`. Correct format of POC SVG file is `.svg`","automated_response":false,"created_at":"2015-11-19T21:37:15.381Z","updated_at":"2015-11-19T21:37:15.381Z","actor":{"username":"kamil_hism","cleared":false,"url":"/kamil_hism","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":692466,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Thanks for your report.\n\nAs you mentioned, slack-files.com is a site specifically setup as a sandbox domain for file hosting.  Remember that XSS doesn't just mean 'executing JavaScript' (which you have here) but 'executing JavaScript in the target's origin' (which in this case would be *.slack.com -- an entirely different domain protected from this XSS by the Same-Origin Policy). At this time, Slack isn't accepting reports concerning XSS on slack-files.com and as such we will be closing this report.\n\nThanks and good luck with future bug hunting.","automated_response":false,"created_at":"2015-11-20T01:27:27.934Z","updated_at":"2015-11-20T01:27:27.934Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":692976,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, you are right, but actually I did not name it as XSS. Lack of secure headers on SVG files being served from `slack-files.com` -- is legitimate **security issue**.\n\nPlease just check this video out:\n\nhttps://youtu.be/PzL2JBcCojo\n\nUser clicks on **attachment** (not on **external** link to some website) and expects that file will be shown or downloaded. So probability that user will type his password in this fake login modal is very high, don't you think so?\n\nI am saying all of this not for bounty (though you awarded for similar issue: https://hackerone.com/reports/2617), I just want you take the threat seriously and mitigate this issue.\n","automated_response":false,"created_at":"2015-11-20T14:27:54.615Z","updated_at":"2015-11-20T14:27:54.615Z","actor":{"username":"kamil_hism","cleared":false,"url":"/kamil_hism","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":695296,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@bugtriage, please confirm that despite a proof of concept that leverages absence of security headers, you won't fix this issue and do not admit it is a valid security issue. Just wanna publicly disclose this vulnerability in this week in blog post.","automated_response":false,"created_at":"2015-11-23T12:43:49.773Z","updated_at":"2015-11-23T12:43:49.773Z","actor":{"username":"kamil_hism","cleared":false,"url":"/kamil_hism","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":763609,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As I can see now, you chose and implemented 3rd solution from provided `Possible fixes` paragraph. Good job!\n\nNevertheless, you took this vulnerability seriously, fixed it and made product more secure against phishing attacks. I wish we could make this report public to show your BB program not so bad as everybody say ;)","automated_response":false,"created_at":"2016-01-19T15:37:58.522Z","updated_at":"2016-01-19T15:43:54.672Z","actor":{"username":"kamil_hism","cleared":false,"url":"/kamil_hism","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":763827,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","automated_response":false,"created_at":"2016-01-19T17:48:03.063Z","updated_at":"2016-01-19T17:48:03.063Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":763828,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello kamil_hism,\n\nWe changed the logic here since there was a much more direct attack utilizing this weakness highlighted by another report, however I will mark this report as resolved as the root cause for your issue was mitigated by our changes.\n\nCheers,\nSlack","automated_response":false,"created_at":"2016-01-19T17:48:12.983Z","updated_at":"2016-01-19T17:48:12.983Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"kamil_hism","url":"/kamil_hism"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":764236,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"But that \"much more direct attack\" wouldn't be possible if you'd simply fixed this \"weakness\" after I reported it, don't you think so? :) I thought the main purpose of BB programs is mitigation of _any_ security risk, not waiting while it'll start escalating.\n\nThanks. Accept public disclosure request please.","automated_response":false,"created_at":"2016-01-19T21:02:46.977Z","updated_at":"2016-01-19T21:02:46.977Z","first_to_agree":true,"actor":{"username":"kamil_hism","cleared":false,"url":"/kamil_hism","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/311/834a58ff0f4a82db11ee6fe0e38772150ea735f7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":803398,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-02-18T21:02:48.541Z","updated_at":"2016-02-18T21:02:48.541Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4642373,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"We're going back through our old bounties and clearing out the history - we're updating this to reflect the past decision. Thank you for your understanding!","automated_response":false,"created_at":"2019-04-25T15:34:19.947Z","updated_at":"2019-04-25T15:34:19.947Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}