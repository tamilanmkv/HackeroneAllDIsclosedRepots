{"id":12815,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjgxNQ==","url":"https://hackerone.com/reports/12815","title":"Improper filtering of classes used in codeblocks in Markdown","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-05-22T13:55:53.964Z","submitted_at":"2014-05-22T13:55:53.964Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"markijbema","url":"/markijbema","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-07-08T10:00:25.793Z","bug_reporter_agreed_on_going_public_at":"2014-06-02T09:18:04.493Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Redcarpet just uses the name of the language as the classname of the element. So if the classnames are of significance to the site, one can break the site using this. For instance, this report disables the topbar, and can trigger the user into opening a popup. Proof of concept:\r\n\r\n```js-topbar\r\ni eat the topbar\r\n```\r\n```js-share-link\r\ni open a popup\r\n```\r\n\r\n","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-06-29T11:42:14.959Z","allow_singular_disclosure_after":-229917262.41741562,"singular_disclosure_allowed":true,"vote_count":1,"voters":["dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":55719,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks, we'll get this fixed. Any suggestions for a proper fix? Maintain a whitelist of allowed code highlighting class names?","automated_response":false,"created_at":"2014-05-23T15:26:15.504Z","updated_at":"2014-05-23T15:26:15.504Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":57101,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think that would be a possible solution. Another solution would be to namespace languages, if it's 'language-ruby' instead of 'ruby' you won't have this problem. The latter would be a change your markdown parser couldn't do without breaking for all its users. It could add an option to prefix the language though (but don't know how this would work with your syntax highlighting code)","automated_response":false,"created_at":"2014-05-26T06:07:14.938Z","updated_at":"2014-05-26T06:07:14.938Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":61943,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This bug has now been resolved. Thanks again, @markijbema!","automated_response":false,"created_at":"2014-05-30T11:42:14.987Z","updated_at":"2014-05-30T11:42:14.987Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"markijbema","url":"/markijbema"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":61946,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2014-05-30T11:44:41.515Z","updated_at":"2014-05-30T11:44:41.515Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":63456,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2014-06-02T09:18:04.509Z","updated_at":"2014-06-02T09:18:04.509Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":63457,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@markijbema Did you/do you need to notify upstream projects of this issue?","automated_response":false,"created_at":"2014-06-02T09:19:51.511Z","updated_at":"2014-06-02T09:19:51.511Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":63458,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah yes, you're right, I'll contact RedCarpet. Is it okay if I invite them to this issue?","automated_response":false,"created_at":"2014-06-02T09:21:07.402Z","updated_at":"2014-06-02T09:21:07.402Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":63462,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes no problem.","automated_response":false,"created_at":"2014-06-02T09:23:09.180Z","updated_at":"2014-06-02T09:23:09.180Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":65013,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2014-06-03T14:17:53.301Z","updated_at":"2014-06-03T14:17:53.301Z","actor":{"username":"mattr-","cleared":false,"url":"/mattr-","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":66025,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mattr and robin, to see the vulnerability, please choose 'show raw' on my original report. We fixed this both by prepending the language with 'language-', and by whitelisting the allowed languages.\n\nI'm not sure what the best solution for RedCarpet itself is. A good middle ground might be an optional prefix, and accepting only word characters for languages.\n\nBut there seems to be an explicit option to allow spaces, which seems strange to me (when it is then converted to classnames, where spaces are seperators), so I don't know if there's some use of the language which I'm not aware of.","automated_response":false,"created_at":"2014-06-04T04:47:42.221Z","updated_at":"2014-06-04T04:47:42.221Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":69871,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2014-06-09T10:08:56.886Z","updated_at":"2014-06-09T10:08:56.886Z","actor":{"username":"robin850","cleared":false,"url":"/robin850","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/158/f68958f599d6303854a39d92e3786d097f4a024e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":69881,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi everyone!\n\nSorry for the time it took to give you an answer. This is an interesting problem. I don't know what'd be the best solution.\n\nWe can't create a white-list of allowed languages or simply allow words as this can't met all possibilities plus people are relying on things like `html+erb` or `erb?parent=html` with Rouge.\n\nMaybe we should just remove this class by default as we can override the `block_code` callback easily and people often override it to parse the code with Rouge or Pygments but I'm wondering if this would be a breaking change. I don't want to provide any new option though.\n\n@mattr- : What do you think ?\n\n\u003e But there seems to be an explicit option to allow spaces\n\nAbout which option are you talking please ? Normally if the first line contains a space, it is considered as code and not any language.\n\nThanks for getting in touch with us guys!","automated_response":false,"created_at":"2014-06-09T10:31:14.494Z","updated_at":"2014-06-09T10:31:14.494Z","actor":{"username":"robin850","cleared":false,"url":"/robin850","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/158/f68958f599d6303854a39d92e3786d097f4a024e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":69962,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mark is on vacation, so he probably won't respond, but I think he meant `decision` instead of `option`. \n\nHe's probably wondering if you made an explicit decision to support spaces and what's the use case.","automated_response":false,"created_at":"2014-06-09T13:17:52.473Z","updated_at":"2014-06-09T13:17:52.473Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":81829,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah exactly. If spaces wouldn't be supported the problem would be way smaller. But I think making the default smaller, and suggesting an override is the sanest solution. Our solution was also to override the block_code, and make it stricter.","automated_response":false,"created_at":"2014-06-30T09:46:29.389Z","updated_at":"2014-06-30T09:46:29.389Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":81830,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, please note that since I requested public disclosure, this bug will automatically be disclosed within a few days.","automated_response":false,"created_at":"2014-06-30T09:47:10.708Z","updated_at":"2014-06-30T09:47:10.708Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":85032,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry for so being long to answer here!\n\n\u003e If spaces wouldn't be supported the problem would be way smaller\n\nI'm not sure to understand where do you use spaces. As I said earlier, when creating a code block, if what should be the language contains a space, this is considered as plain code. Could you show me an example please ?\n\nTo mitigate the problem, a good solution here could be to write a kind of \"security guide\" to give the most common caveats and gotchas.\n\nWe already have several security issues that are open and we have to choose between the \"full-feature\" path and \"security\" one but we need to be backward compatible as well. Maybe we will be secure by default in 4.0 but for now, we will need to stick with this behavior I think.\n\nFeel free to give your thoughts ; thanks for bringing this discussion here guys!","automated_response":false,"created_at":"2014-07-06T15:21:40.974Z","updated_at":"2014-07-06T15:21:40.974Z","actor":{"username":"robin850","cleared":false,"url":"/robin850","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/158/f68958f599d6303854a39d92e3786d097f4a024e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":85227,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think having some guide would be a good solution. I think you might want to have a generic \"I want to use this with user input\". Of course, not all your users have this problem (if it's only used for blogposts for instance). Maybe it would be even better to have a safe default, though I'm not sure if that should be considered your responsibility.","automated_response":false,"created_at":"2014-07-07T10:19:36.004Z","updated_at":"2014-07-07T10:19:36.004Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":85316,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the quick feedback!\n\n\u003e Maybe it would be even better to have a safe default, though I'm not sure if that should be considered your responsibility.\n\nThis may be the case in Redcarpet 4.0 but for now, turning certain options to true by default\nwould be a breaking change between point releases.\n\nCould you point me to an example with code blocks and spaces please ? :-)","automated_response":false,"created_at":"2014-07-07T13:11:56.010Z","updated_at":"2014-07-07T13:11:56.010Z","actor":{"username":"robin850","cleared":false,"url":"/robin850","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/158/f68958f599d6303854a39d92e3786d097f4a024e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":85904,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2014-07-08T10:00:25.804Z","updated_at":"2014-07-08T10:00:25.804Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":87086,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Like this for instance\n```\n```{js-foo js-remove-report ruby}\nputs 'hello world'```\n```\n\n(bit hard to escape markdown in markdown ;)","automated_response":false,"created_at":"2014-07-10T14:19:20.099Z","updated_at":"2014-07-10T14:19:20.099Z","actor":{"username":"markijbema","cleared":false,"url":"/markijbema","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/704/902185099ec49b8635411a783a27eedc6a52cd05_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}