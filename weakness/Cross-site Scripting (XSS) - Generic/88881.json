{"id":88881,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84ODg4MQ==","url":"https://hackerone.com/reports/88881","title":"XSS: https://light.mail.ru/compose, https://m.mail.ru/compose/[id]/reply при ответе на специальным образом сформированное письмо","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-09-14T20:26:33.476Z","submitted_at":"2015-09-14T20:26:33.476Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"aesteral","url":"/aesteral","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-11-16T13:22:40.987Z","bug_reporter_agreed_on_going_public_at":"2015-10-30T15:50:32.866Z","team_member_agreed_on_going_public_at":"2015-11-16T13:22:40.056Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Здравствуйте!\r\n\r\nhttps://light.mail.ru/compose и https://m.mail.ru/compose[id]/reply подвержены второму вектору XSS похожему на #88492. Вторая уязвимость существует из-за недостаточной фильтрации текста сообщения, на которое хочет ответить пользователь, при его выводе в \u003ctextarea\u003e - поле ответа - в качестве цитаты.\r\n\r\nДля того, чтобы выполнить произвольный JavaScript, следует выполнить следующее:\r\n\r\n* Злоумышленник направляет жертве, пользующейся m.mail.ru или light.mail.ru письмо, содержащее вредоносный код, например:\r\n\r\n`\u003c/textarea\u003e\u003cscript\u003ealert(123)\u003c/script\u003e\r\n\r\n* При просмотре такого письма в интерфейсе как m., так и light., очевидно, ничего не происходит. Однако, код будет выполнен при попытке ответить на это письмо одним из следующих способов:\r\n\r\nЖертва должна воспользоваться либо функцией \"ответить всем\" на это сообщение в интерфейсе light., либо функцией \"ответить\" в интерфейсе m. Оба таких действия приведут к открытию страницы с полем ввода текста письма с уже введенной цитатой вредоносного письма. При этом, HTML-код в такой цитате никак не будет фильтроваться. Это приведет к выполнению указанного злоумышленником кода.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-11-29T15:50:33.133Z","allow_singular_disclosure_after":-185154477.0439988,"singular_disclosure_allowed":true,"vote_count":1,"voters":["aesteral"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":587974,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Привет,\nскорее всего, это дубликат #88492 с другим вектором атаки. Если закрытие этой уязвимости потребует дополнительной доработки фикса, то будем считать отдельной уязвимостью, если нет - то объединим с #88492, но повысим критичность.\n","automated_response":false,"created_at":"2015-09-14T20:48:25.000Z","updated_at":"2015-09-14T20:48:25.000Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":587976,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Тоже так думаю, но не записать было бы неправильно, а дописывать все в комментарии в #88492 - тоже неправильно. Плюс, #88492 не упоминал light.mail.ru","automated_response":false,"created_at":"2015-09-14T20:49:24.659Z","updated_at":"2015-09-14T20:49:24.659Z","actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":588009,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"И тут, кстати, есть больший риск эксплоитации. Поскольку message_id (число вида 14421705000000000000) довольно легко предсказать с большой точностью для письма, отправленного с mail.ru на mail.ru, возможен такой вектор атаки уже на аккаунт сразу жертвы, а не в рамках подставного аккаунта злоумышленника:\n\n* Злоумышленник отправляет жертве письмо с вредоносным кодом из своего аккаунта mail.ru и обращает внимание на message_id в его аккаунте (sent_id = 14421705000000000123)\n\n* В подавляющем большинстве случаев message_id сообщения в аккаунте принимающей стороны - жертвы - будет совпадать с sent_id за исключением последних трех цифр - received_id = 14421705000000000[XYZ]. \n\n* Таким образом, чтобы узнать received_id, злоумышленнику надо угадать число от 000 до 999 (исключая 123). \n\n* В случае, если злоумышленник угадает такой received_id, он может перенаправить жертву на https://light.mail.ru/compose/[received_id]/replyall/?charset=\u0026adding=\u0026folder=0 и выполнить вредносный JS в аккаунте жертвы.\n\n* То есть, для такой атаки злоумышленник может создать HTML-страницу, которая будет для конкретной жертвы перебирать значения received_id в новой вкладке (из-за X-Frame-Options), Поскольку необходимо перебрать всего-лишь 999 значений, это можно сделать довольно быстро, до того, как пользователь успеет закрыть все вкладки.","automated_response":false,"created_at":"2015-09-14T21:11:15.702Z","updated_at":"2015-09-14T21:11:15.702Z","actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":588882,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Здравствуйте! \n\nСделал PoC - https://5.39.94.114:90/mailru-xss.html\n\nPoC входит в аккаунт myvictimhorse@mail.ru, в который уже заранее прислано вредоносное письмо и, используя только известные атакующему параметры (message_id в \"отправленных\" атакующего) находит message_id во \"входящих\" жертвы и генерирует ссылку на XSS. Сейчас перебор ID идёт в один поток, но их легко можно параллелить между несколькими тегами \u003cimg\u003e","automated_response":false,"created_at":"2015-09-15T17:16:00.730Z","updated_at":"2015-09-15T17:16:00.730Z","actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":611348,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Привет, бага закрыта.\nПожалуйста, подтвердите, что проблема больше не воспроизводится. \n\nМы примем решение о размере полагающегося вам вознаграждения и обязательно сообщим об этом чуть позже.","automated_response":false,"created_at":"2015-10-06T16:13:53.223Z","updated_at":"2015-10-06T16:13:53.223Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"aesteral","url":"/aesteral"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":611375,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Здравствуйте!\n\nПроблема больше не воспроизводится.","automated_response":false,"created_at":"2015-10-06T16:45:09.347Z","updated_at":"2015-10-06T16:45:09.347Z","actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":638319,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Привет, вознаграждение за найденную уязвимость начислено на твой аккаунт. На странице https://hackerone.com/settings/bounties можно выбрать желаемый метод выплаты. \n\nСпасибо и ждем от тебя новых багрепортов!","automated_response":false,"created_at":"2015-10-30T13:09:18.856Z","updated_at":"2015-10-30T13:09:18.856Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Mail.ru"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"aesteral","url":"/aesteral"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":638410,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Здравствуйте! Большое спасибо! Просьба разрешить дисклоуз.","automated_response":false,"created_at":"2015-10-30T14:42:09.501Z","updated_at":"2015-10-30T14:42:09.501Z","actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":638531,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет, дисклоз можно запросить http://clip.corp.mail.ru/clip/m0/1446220122-clip-7kb-dM9Gbrure7Ok.png","automated_response":false,"created_at":"2015-10-30T15:49:11.735Z","updated_at":"2015-10-30T15:49:11.735Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":638535,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Запросил. Спасибо!","automated_response":false,"created_at":"2015-10-30T15:50:32.895Z","updated_at":"2015-10-30T15:50:43.777Z","first_to_agree":true,"actor":{"username":"aesteral","cleared":false,"url":"/aesteral","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/049/af64482266c0d55553a4be28706e5396a489ddf3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":659421,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-11-16T13:22:40.783Z","updated_at":"2015-11-16T13:22:40.783Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":659422,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-11-16T13:22:41.011Z","updated_at":"2015-11-16T13:22:41.011Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}