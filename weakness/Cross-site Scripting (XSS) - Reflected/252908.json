{"id":252908,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNTI5MDg=","url":"https://hackerone.com/reports/252908","title":"Reflected XSS on https://www.starbucks.co.uk/shop/paymentmethod/ (bypass for 227486)","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-07-24T08:14:25.062Z","submitted_at":"2017-07-24T08:14:25.062Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bayotop","url":"/bayotop","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-06-16T21:19:02.783Z","bug_reporter_agreed_on_going_public_at":"2020-05-22T13:41:13.275Z","team_member_agreed_on_going_public_at":"2020-06-16T21:19:02.682Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi guys,\n\nI am now able to prove my concerns from #227486 (see my last comment). `\"`s are still not correctly encoded when rendered into the page in the `\u003clink rel=\"canonical\" href=\"current_full_url\" /\u003e` element on almost any https://starbucks.co.uk/ page.\n\nThe WAF is bypassed by encoding `\"`s as `%2522` in the URL path. This won't work when the payload is part of the query string.\n\n**Description**\n\nTake a look on the source code of https://www.starbucks.co.uk/shop/card/egift/anthing%2522. You can see a quote is injected to break the `href` attribute context.\n\n```html\n\u003clink rel=\"canonical\" href=\"https://www.starbucks.co.uk/shop/card/egift/anthing\"\" /\u003e\n```\n\n**Exploitation**\n\nUsing the same tricks as described in #227486 this injection can be leveraged to achieve arbitrary JS execution on `/shop/paymentmethod/`. Also note that this is just **one** example and more ways may exist to achieve JS execution. Steps to reproduce (use **Firefox**):\n\n1. Login at https://www.starbucks.co.uk and add a card into basket on https://www.starbucks.co.uk/shop/card/egift/birthday\n2. Visit https://www.starbucks.co.uk/shop/paymentmethod/hkjhk%2522onclick=%2522confirm(/-/g+this.ownerDocument.domain)%2522id=%2522checkoutButton\n3. Click somewhere around the Checkout header. \n4. An alert showing the current domain pops up.\n\n**Recommendation**\n\nAgain, correctly encode the URL before reflecting it back in the response. \n\nIn #227486 the fix was blocking requests containing `%u0022` in the query string. This was shown to be bypassable so fixing this issue by blocking `%2522` in URL paths could be bypassed again in future. \n\n","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-06-21T13:41:13.357Z","allow_singular_disclosure_after":-41215782.476883285,"singular_disclosure_allowed":true,"vote_count":11,"voters":["brahim_boufakri01","ali","0xelkomy","woofy","komic_sans","omeroon","s0ulr1pp3r","n0bug","williampatton","rlucendo","and 1 more..."],"severity":{"rating":"medium","score":4.2,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":13017,"asset_type":"URL","asset_identifier":"www.starbucks.co.uk","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1862011,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for reporting. We're looking into this and will get back to you shortly.","automated_response":false,"created_at":"2017-07-24T10:22:05.371Z","updated_at":"2017-07-24T10:22:05.371Z","actor":{"username":"asuka","cleared":false,"url":"/asuka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/923/28e02b13f94679bbda8c7d3b7390776d8977f1b6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1864706,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-07-25T00:54:43.176Z","updated_at":"2017-07-25T00:54:43.176Z","additional_data":{"old_severity":"High","new_severity":"Medium (5.4)","old_severity_id":61654,"new_severity_id":61908},"actor":{"username":"overice","cleared":false,"url":"/overice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/018/993b2d44b7dea7bd979efa3030b9456f04690408_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1864725,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-07-25T01:05:59.265Z","updated_at":"2017-07-25T01:05:59.265Z","actor":{"username":"overice","cleared":false,"url":"/overice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/018/993b2d44b7dea7bd979efa3030b9456f04690408_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1864727,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-07-25T01:06:52.189Z","updated_at":"2017-07-25T01:06:52.189Z","additional_data":{"old_severity":"Medium (5.4)","new_severity":"Medium (4.2)","old_severity_id":61908,"new_severity_id":61909},"actor":{"username":"overice","cleared":false,"url":"/overice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/018/993b2d44b7dea7bd979efa3030b9456f04690408_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1864728,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-07-25T01:06:59.081Z","updated_at":"2017-07-25T01:06:59.081Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"starbucks","collaborator":{"username":"bayotop","url":"/bayotop"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1968187,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, it feels that this one takes a bit longer then it should. Are there any updates you could share? Thanks!","automated_response":false,"created_at":"2017-08-31T08:47:44.620Z","updated_at":"2017-08-31T08:47:44.620Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1968812,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@bayotop - Thanks for checking in. We don't have any information to share right this moment, but once we do I'll be sure to update you on the status of this report. Thanks again for your patience and thinking of our security! \n","automated_response":false,"created_at":"2017-08-31T14:23:57.668Z","updated_at":"2017-08-31T14:23:57.668Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2168773,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, since it's been 3 additional months, is there any progress you could share? Thanks. ","automated_response":false,"created_at":"2017-11-19T18:57:45.018Z","updated_at":"2017-11-19T18:57:45.018Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2276267,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @bayotop - \n\nOur apologies for the delay in getting back to you. We are still working with the appropriate team in getting this resolved and will be in touch once I have an update!\n\nThanks, \n@overice\n","automated_response":false,"created_at":"2018-01-11T00:19:59.601Z","updated_at":"2018-01-11T00:19:59.601Z","actor":{"username":"overice","cleared":false,"url":"/overice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/018/993b2d44b7dea7bd979efa3030b9456f04690408_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3371188,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @bayotop , Thank you for your patience! The bug fix work is in our internal team's backlog. We will follow up with the team for a fix and we will get back once we receive an update. Once again, Thank you for your patience!\n\n@ristretto\n","automated_response":false,"created_at":"2018-09-21T21:48:38.142Z","updated_at":"2018-09-21T21:48:38.142Z","actor":{"username":"ristretto","cleared":false,"url":"/ristretto","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3371190,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2018-09-21T21:48:54.082Z","updated_at":"2018-09-21T21:48:54.082Z","actor":{"username":"ristretto","cleared":false,"url":"/ristretto","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"www.starbucks.co.uk","genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4915392,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @ristretto,\n\nThis seems now to be resolved as per #396493.","automated_response":false,"created_at":"2019-05-24T07:03:38.234Z","updated_at":"2019-05-24T07:03:38.234Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5723692,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @bayotop,\n\nThank you for your patience! We received notification from the team that they were indeed able to apply the same fix that was used to resolve #396493. I retested and confirmed that I'm no longer able to reproduce the issue. If you observe otherwise, please let us know and we'll revisit.\n\nThanks again for the report!\n\n@shadegrown ","automated_response":false,"created_at":"2019-09-03T23:07:19.637Z","updated_at":"2019-09-03T23:07:19.637Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"bayotop","url":"/bayotop"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8079937,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-05-22T13:41:13.303Z","updated_at":"2020-05-22T13:41:13.303Z","first_to_agree":true,"actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8312493,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-06-16T21:16:38.127Z","updated_at":"2020-06-16T21:16:38.127Z","additional_data":{"old_title":"Reflected XSS on https://www.starbucks.co.uk/shop/paymentmethod/ (bypass fix in #227486)","new_title":"Reflected XSS on https://www.starbucks.co.uk/shop/paymentmethod/ (bypass for 227486)"},"actor":{"username":"agedsumatra","cleared":false,"url":"/agedsumatra","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8312533,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-16T21:19:02.704Z","updated_at":"2020-06-16T21:19:02.704Z","actor":{"username":"agedsumatra","cleared":false,"url":"/agedsumatra","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8312534,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-06-16T21:19:02.819Z","updated_at":"2020-06-16T21:19:02.819Z","actor":{"username":"agedsumatra","cleared":false,"url":"/agedsumatra","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":23024,"category":"team","content":"bayotop discovered a reflected XSS on www.starbucks.co.uk due to lack of encoding that was a bypass for report #227486.\n@bayotop — thank you for reporting this vulnerability and for confirming the resolution.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":706273,"username":"agedsumatra","name":"agedSumatra","bio":"","cleared":false,"website":null,"location":"","created_at":"2019-08-12T17:50:49.926Z","url":"https://hackerone.com/agedsumatra","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/yjUg6PZmutR2o3qPxEP2MT1J/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}