{"id":373950,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzM5NTA=","url":"https://hackerone.com/reports/373950","title":"Reflected Cross-Site Scripting in Serendipity (serendipity.SetCookie)","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-06-29T16:09:17.875Z","submitted_at":"2018-06-29T16:09:17.875Z","is_member_of_team?":false,"reporter":{"disabled":true,"username":"bb9866f3f743d6bf69b6836","url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30278,"url":"https://hackerone.com/hannob","handle":"hannob","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Hanno's projects","twitter_handle":"hanno","website":"https://hboeck.de/","about":"Personal web projects from Hanno Böck."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-09T14:44:43.029Z","bug_reporter_agreed_on_going_public_at":"2018-11-09T14:44:42.968Z","team_member_agreed_on_going_public_at":"2018-11-09T14:36:35.628Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\n\nThe *Smarty* template responsible of creating *JavaScript* snippets assigning cookies to users is during sorting of entries in the administration interface is affected by a reflected cross-site scripting.\n\n## Description\n\nIn `templates/2k11/admin/entries.inc.tpl`, the following code is dynamically creating a *JavaScript* snippet consisting of calls to `serendipity.SetCookie()`:\n\n```html\n    \u003cscript\u003e\n        $(document).ready(function() {\n    {foreach $filter_import AS $f_import}\n        serendipity.SetCookie(\"entrylist_filter_{$f_import}\", \"{$get_filter_{$f_import}}\" )\n    {/foreach}\n    {foreach $sort_import AS $s_import}\n        serendipity.SetCookie(\"entrylist_sort_{$s_import}\", \"{$get_sort_{$s_import}}\" )\n    {/foreach}\n        });\n    \u003c/script\u003e\n```\n\nHowever, *Smarty* is not aware of the context is is not told to escape it as `javascript` (https://www.smarty.net/docsv2/en/language.modifier.escape) and no prior encoding is performed on data injected in the template (see `include/admin/entries.inc.php:216`):\n\n```php\n\u003c?php\n// [...]\ncase 'editSelect':\n        $data['switched_output'] = false;\n        $filter_import = array('author', 'category', 'isdraft');\n        $sort_import   = array('perPage', 'ordermode', 'order');\n\n        foreach($filter_import AS $f_import) {\n            serendipity_restoreVar($serendipity['COOKIE']['entrylist_filter_' . $f_import], $serendipity['GET']['filter'][$f_import]);\n            $data[\"get_filter_$f_import\"] = $serendipity['GET']['filter'][$f_import];\n        }\n\n        foreach($sort_import AS $s_import) {\n            serendipity_restoreVar($serendipity['COOKIE']['entrylist_sort_' . $s_import], $serendipity['GET']['sort'][$s_import]);\n            $data[\"get_sort_$s_import\"] = $serendipity['GET']['sort'][$s_import];\n        }\n```\n\nFor the record, the function `serendipity_JSsetCookie` is also vulnerable, but it's not in use in this version:\n```php\n\u003c?php\n// [...]\nfunction serendipity_JSsetCookie($name, $value) {\n    $name  = serendipity_entities($name);\n    $value = urlencode($value);\n\n    echo '\u003cscript type=\"text/javascript\"\u003eserendipity.SetCookie(\"' . $name . '\", unescape(\"' . $value . '\"))\u003c/script\u003e' . \"\\n\";\n}\n```\n\n## Steps To Reproduce\n\n  1. Access https://blog.fuzzing-project.org/serendipity_admin.php?serendipity[action]=admin\u0026serendipity[adminModule]=entries\u0026serendipity[adminAction]=editSelect\u0026serendipity[filter][author]=1xx\");alert(document.domain);// while being authenticated;\n  1. Notice the execution of `alert(document.domain)` within the context of  `blog.fuzzing-project.org`.\n\n## Impact\n\nBy accessing a link specially crafted by an attacker and exploiting this vulnerability, an authenticated victim could be forced to perform actions on its behalf on the domain blog.fuzzing-project.org. If the victim is authenticated as administrator, it could be used to compromise the website or the underlying server (through the installation of `serendipity_plugin_externalphp`).","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-12-09T14:36:35.696Z","allow_singular_disclosure_after":-89597746.56220393,"singular_disclosure_allowed":true,"vote_count":3,"voters":["geeknik","eveeez","billal5625"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":11140,"asset_type":"URL","asset_identifier":"*.fuzzing-project.org","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2968279,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I can confirm this, I'm forwarding this to the serendipity developers.\n\nI'm unsure about serendipity_JSsetCookie, from what I can see this is problematic if the first parameter is unescaped. I found a use of that function in the staticpage plugin, but the first param is a fixed string, so it looks harmless.","automated_response":false,"created_at":"2018-07-01T10:02:32.338Z","updated_at":"2018-07-01T10:02:32.338Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2968321,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Preliminary patch, also sent to s9y devs. I believe it's likely that similar issues exist, but a review of the templates would be a lot of work.","automated_response":false,"created_at":"2018-07-01T10:35:30.387Z","updated_at":"2018-07-01T10:35:30.387Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":314223,"filename":"H1S9Y-XSS-1.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/314/223/a7b95cbfe9cb3c041d967b082aa40ac39d5d5387/H1S9Y-XSS-1.diff?response-content-disposition=attachment%3B%20filename%3D%22H1S9Y-XSS-1.diff%22%3B%20filename%2A%3DUTF-8%27%27H1S9Y-XSS-1.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145222Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=dd86e57c3d5028ac3e98ea2d4709d7107bdbc041f20114f8185069a5f32425fd"}],"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3063065,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is now fixed with a patch I got from s9y's dev (as should be all other open issues).\nI'd appreciate if you could check that and also look for further issues, s9y will soon release a security update.","automated_response":false,"created_at":"2018-07-18T17:37:14.559Z","updated_at":"2018-07-18T17:37:14.559Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3063179,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fix (https://github.com/s9y/Serendipity/commit/19513cdf143ef5659f8afbfb3b16df921060d550#diff-dc826483a3a52ca69c83cec2fb97ce8e) looks good to me.","automated_response":false,"created_at":"2018-07-18T17:59:36.619Z","updated_at":"2018-07-18T17:59:36.619Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3203958,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Fix released:\nhttp://blog.s9y.org/archives/278-Serendipity-2.1.3-released.html\n\nFix is not mentioned in release notes, but it got committed.","automated_response":false,"created_at":"2018-08-16T13:33:49.622Z","updated_at":"2018-08-16T13:33:49.622Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bb9866f3f743d6bf69b6836","url":"/bb9866f3f743d6bf69b6836"},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617244,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-09T14:36:35.663Z","updated_at":"2018-11-09T14:36:35.663Z","first_to_agree":true,"actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617262,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-09T14:44:42.995Z","updated_at":"2018-11-09T14:44:42.995Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3617263,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-11-09T14:44:43.050Z","updated_at":"2018-11-09T14:44:43.050Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}