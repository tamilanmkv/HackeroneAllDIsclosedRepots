{"id":1087061,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDg3MDYx","url":"https://hackerone.com/reports/1087061","title":"Stored-XSS on wiki pages","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2021-01-25T21:21:47.323Z","submitted_at":"2021-01-25T21:21:47.404Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yvvdwf","url":"/yvvdwf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-07-13T08:35:54.633Z","bug_reporter_agreed_on_going_public_at":"2021-07-13T08:35:54.540Z","team_member_agreed_on_going_public_at":"2021-07-12T22:54:00.703Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nA Stored-XSS is existing on Wiki pages. It is caused by recent change in [show.html.haml#L10](https://gitlab.com/gitlab-org/gitlab/blob/3e543192b1179c79e0a44ae6f32648fa7155c10e/app/views/shared/wikis/show.html.haml#L10)\n\n```ruby\n       ... \"\u003ca href='#{@page.last_version.author_url}'\u003e\".html_safe ...\n```\n\n`author_url` is defined by committed email in [wiki_page_version.rb](https://gitlab.com/gitlab-org/gitlab/blob/3e543192b1179c79e0a44ae6f32648fa7155c10e/lib/gitlab/git/wiki_page_version.rb):\n\n```ruby\n     delegate :message, :sha, :id, :author_name, :author_email, :authored_date, to: :commit\n\n      def author_url\n        user = ::User.find_by_any_email(author_email)\n        user.nil? ? \"mailto:#{author_email}\" : Gitlab::UrlBuilder.build(user)\n      end\n```\n\nSince the `author_url`is considered as `safe`, attackers may inject any DOM attributes of `\u003ca\u003e` tag. \n\n\n### Steps to reproduce\n\n1. Clone wiki repository of an existing project or a new one, for example: `git clone git@gl.local:root/test.wiki.git`\n2. Go to inside `test.wiki` directory, then add the 3 following lines at then end of  `.git/config` file (if there exists `[user]` section in `.git/config`, then replace its section by the following lines):\n\n```\n[user]\n\tname = anyname\n\temail = \"#' style=animation-name:blinking-dot onanimationstart=alert(document.domain) other\"\n```\n\n3.  Modify/create any wiki page, for example: `echo \"Hi\" \u003e\u003e home.md`\n4. Commit the modification and push it into gitlab server\n5. Open the wiki page in Web browser,  http://gl.local/hi/test/-/wikis/home, you should see the alert\n\n### Impact\n\nXSS may allows attackers to perform any actions on behalf of victims at client side.\n\n\n### What is the current *bug* behavior?\n\n`author_url` is not sanitized\n\n### What is the expected *correct* behavior?\n\n`author_url`  should be sanitized\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n(For installations with omnibus-gitlab package run and paste the output of:\n`sudo gitlab-rake gitlab:env:info`)\n\n```\nSystem:\t\tUbuntu 18.04\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.7.2p137\nGem Version:\t3.1.4\nBundler Version:2.1.4\nRake Version:\t13.0.3\nRedis Version:\t5.0.9\nGit Version:\t2.29.0\nSidekiq Version:5.2.9\nGo Version:\tunknown\n\nGitLab information\nVersion:\t13.8.0-ee\nRevision:\t1ae10d09692\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t12.4\nURL:\t\thttp://gl.local\nHTTP Clone URL:\thttp://gl.local/some-group/some-project.git\nSSH Clone URL:\tgit@gl.local:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers: \n\nGitLab Shell\nVersion:\t13.15.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nXSS may allows attackers to perform any actions on behalf of victims at client side.","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":53,"voters":["xenx","pyrrhon","obsesif","run_win","fqdn","ali","imranhudaa","realtess","khizer47","xpl0ited1","and 43 more..."],"severity":{"rating":"medium","score":5.4,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"changed","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":39022,"asset_type":"OTHER","asset_identifier":"Your Own GitLab Instance","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10477735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yvvdwf,\n\nThank you for submitting this report! We will investigate the issue as soon as\npossible, and should get back within a week.\n\nPlease do not submit your report or ask about its status through additional\nchannels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2021-01-25T22:19:26.283Z","updated_at":"2021-01-25T22:19:26.283Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10485247,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @yvvdwf,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/299143.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-01-26T16:41:36.042Z","updated_at":"2021-01-26T16:41:36.042Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10485254,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-01-26T16:41:57.573Z","updated_at":"2021-01-26T16:41:57.573Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"yvvdwf","url":"/yvvdwf"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10490874,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @yvvdwf,\n\nThe issue you reported is currently scheduled to be fixed by 2021-03-31.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2021-01-27T04:19:40.553Z","updated_at":"2021-01-27T04:19:40.553Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10760862,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @yvvdwf,\n\nSorry for asking about this so late after the initial report, but were you able to bypass CSP on gitlab.com? I'm aware of a few bypasses that exist but I don't think any of them work without being able to break out of the tag. Let me know if you have something!\n\nThanks,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-02-23T23:10:35.970Z","updated_at":"2021-02-23T23:10:35.970Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10763901,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture,\n\n\u003e Sorry for asking about this so late after the initial report, but were you able to bypass CSP on gitlab.com?\n\nAs far as I know (, via my reports on XSS with CSP bypass), gitlab does not consider the CSP bypass in severity of report (thus its bounty ;-) ). Thus I didn't try to find a way to bypass CSP on gitlab.com since it may take more time than finding XSS itself :-( .\n\n\u003e I'm aware of a few bypasses that exist but I don't think any of them work without being able to break out of the tag. Let me know if you have something!\n\nYou are right. All CSP bypass on gitlab.com I've seen need some extra tags.\n\nRegards,\n\n","automated_response":false,"created_at":"2021-02-24T08:20:43.663Z","updated_at":"2021-02-24T08:21:10.466Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10767925,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yvvdwf,\n\nWe do take CSP into consideration for assessing impact. Thanks for following up!\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-02-24T13:33:22.776Z","updated_at":"2021-02-24T13:33:22.776Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11097317,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2021-03-23T20:33:12.576Z","updated_at":"2021-03-23T20:33:12.576Z","additional_data":{"old_severity":"High","new_severity":"Medium (5.4)","old_severity_id":967053,"new_severity_id":1020290},"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11097327,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @yvvdwf,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.9.2 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-03-23T20:34:58.144Z","updated_at":"2021-03-23T20:34:58.144Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"yvvdwf","url":"/yvvdwf"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11097339,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-03-23T20:35:18.310Z","updated_at":"2021-03-23T20:35:18.310Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"yvvdwf","url":"/yvvdwf"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12460771,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-07-12T22:54:00.738Z","updated_at":"2021-07-12T22:54:00.738Z","first_to_agree":true,"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12465708,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-07-13T08:35:54.571Z","updated_at":"2021-07-13T08:35:54.571Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12465709,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-07-13T08:35:54.691Z","updated_at":"2021-07-13T08:35:54.691Z","actor":{"username":"yvvdwf","cleared":false,"url":"/yvvdwf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yQ79x7V8gqtK3SUH9zj881MY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}