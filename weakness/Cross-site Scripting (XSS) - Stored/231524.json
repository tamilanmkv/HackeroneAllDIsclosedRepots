{"id":231524,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzE1MjQ=","url":"https://hackerone.com/reports/231524","title":"HTML injection and limited XSS via logo image upload - Nextcloud 12.0.0","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-05-24T19:29:29.963Z","submitted_at":"2017-05-24T19:29:29.963Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"icewater","url":"/icewater","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-01-31T16:17:31.465Z","bug_reporter_agreed_on_going_public_at":"2020-01-31T16:17:31.397Z","team_member_agreed_on_going_public_at":"2020-01-31T14:05:38.512Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\nThe logo image upload function in Nextcloud Server v12.0.0 does not validate the uploaded file, leading to XSS in certain circumstances.\n\n## Vulnerable URL(s)\nReplace [server] with the IP address or hostname of your Nextcloud server.\nFile upload - http://[server]/nextcloud/index.php/apps/theming/ajax/updateLogo\nXSS endpoint - http://[server]/nextcloud/index.php/apps/theming/logo\n\n## Description\nA Nextcloud user with administrator rights has the option to upload a new site logo image file. However, the Nextcloud server does not verify that the uploaded file is actually an image file and accepts any file. An HTML file can be uploaded as the logo and accessed at the XSS endpoint URL: http://[server]/nextcloud/index.php/apps/theming/logo.\n\nIf a user visits the XSS endpoint URL (through a phishing link for example; since the URL is located on the valid Nextcloud server this shouldn't be too difficult) the victim's browser renders the contents of the file like any HTML page. An attacker can also include Javascript in the HTML file but it will be blocked by most major browsers through Nextcloud's Content Security Policy. However, I found 2 Javascript vectors that appear to bypass CSP and result in successful Javascript execution under Internet Explorer 11 (see Reproduction section).\n\n## Reproduction\nCreate an HTML file with the following content and upload it as the Nextcloud site's logo. Alternatively, upload the HTML file provided with this report.\n\n\u003c!DOCTYPE html\u003e\n\u003chead\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003ch1\u003eThe logo!\u003c/h1\u003e\n\n\u003cp\u003eThis HTML page was uploaded instead of a logo image.\u003c/p\u003e\n\u003cp\u003eContent Security Policy (CSP) prevents Javascript from executing as far as I can tell - except in Internet Explorer 11. View this page in IE 11 and you should see a pair of Javascript alert dialogs demonstrating code execution.\u003c/p\u003e\n\u003c!-- Following both bypass CSP in IE --\u003e\n\n\u003c!-- For some reason if spaces appear in the alert text this one won't work --\u003e\n\u003csvg/onload=alert('SVG\n\n\u003cimg/id=\"alert\u0026lpar;'image XSS')\"/alt=\"/\"src=\"/\"onerror=eval(id)\u003e'\"\u003e\n\n\u003c/body\u003e\n\u003c/html\u003e\n\nOnce uploaded, visit http://[server]/nextcloud/index.php/apps/theming/logo in any web browser. The browser should display rendered HTML content. Javascript execution is blocked by Nextcloud's CSP in most browsers; however, if you visit the page in IE 11, a pair of Javascript alert boxes should appear. The use of the onload attribute in an SVG tag and an IMG onerror attribute both appear to execute Javascript in IE 11:\n\n\u003csvg/onload=alert('SVG')\u003e\n\u003cimg/id=\"alert\u0026lpar;'image XSS')\"/alt=\"/\"src=\"/\"onerror=eval(id)\u003e'\"\u003e\n\nDuring testing, IE 11 on Windows 7, 10 and IE on Windows Phone 8.1 update 2 executed the Javascript. Firefox, Chrome, Edge, Opera Mini, and Safari IOS all rendered the HTML page but did not execute the Javascript.\n\n## Impact/Notes\nOnly users who are members of the Admin group have permission to change the logo. The Nextcloud Threat Model (https://nextcloud.com/security/threat-model/) indicates that Nextcloud admins are trusted. Therefore, if this vulnerability is considered an acceptable risk I understand; I thought it best to report it just in case.\n\nOne potential attack could involve one user who has admin rights uploading a malicious HTML file and tricking another admin or regular user into visiting the logo page. If the victim is using IE 11, the attacker can execute Javascript code under the victim user's session and potentially bypass CSRF protections. If an admin user has access to the underlying server OS/insfrastucture, he/she already has the power to modify another user's settings, files, etc; however, not all admin users necessarily have permission to the underlying Nextcloud server OS or infrastructure. For example, in deployments with many people several users may be given admin permissions in the web interface but that does not mean they all have access to the underlying file system; they should not be able to modify or view another user's data even though they are web admins. This vulnerability could allow for that to happen if the victim uses IE 11. I only tested with IE 11; I don't know if other IE versions behave the same.\n\n## Mitigation\nTo mitigate this vulnerability, consider restricting the logo file to image files only (png, jpg, etc.) and reject non-image files.","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":187810,"file_name":"logo.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/187/810/7aecfe6083a9d14f666ff25727a052bac73b28c2/logo.html?response-content-disposition=attachment%3B%20filename%3D%22logo.html%22%3B%20filename%2A%3DUTF-8%27%27logo.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSZC7DXM7%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T141037Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQC%2BDPA%2BSA%2BpuJvH4UEzvWiP4UFbtskzj7xfN6rqlPo4hwIhAOElSqCIqXNISLvxjY33BSsqOOcMi8dDWLDb%2FHD9us3YKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwLzMOGCwg6RS74p74q1wP3%2BrYZeAM77Rmdm64%2BCSKI7bN93GsX7JZ2tRccS6J5LGMRJTs%2By2W6iZRVDq3XbBt0e6p3WHVjfBqyc9ME6wkTlY9d%2Fv3J1DB8BCqWSb%2BRKzvSiDC8qrGE542%2FrwTG4%2F%2F%2B2GZboS%2Bwx6a4S2dscyeGXoZ%2FpJf5Uq70DiwjHjChb4otA36pPHn6Cbuljknt8dm165HwajfM%2FYT9DsRnV1w0OsaZyXvEEhwGsPTVDhkOXnM85nNGqSZ3QDaL%2FFoqr9dtCpsUJbXrXwy5kt3x0oz1dJ01X%2BzIddVtQMPL2ptVZ7U9zvXOF0wODPRFZiOr31TkuvFOSwxvOXUum3Wvfo9vzLL2sp7049bpk2pDp0SX1ErSpZmBqjAE1Syh%2Bgl%2BQXOk5uGw1WkZ%2Bi%2BVM0miZCx%2Fzk0YwCnQVNh8OZjtqzLjisdsfijlbUNbtSb%2F2rqQk5byOsnNd8EOB%2Fk4YSlr9Ml9Z%2FBjM39hyAylCG6PZXUBPl4i%2FIRvue2kJRbtUIpgVYXpDngioq0oVUItMzpWv1Dpeb3i%2BGYq1GpN7Q2SSm%2FKrlHtq%2FAe%2FUyoxvBMaLL9j8sY6VSMaDAw3WBbjN8GeRsrk6lj%2FvPn7De7XtYE3zRUmOhj70LaDvgw%2FfCQiwY6pAEB7X%2FT8tdYZNLCr%2BSBWKV0iIWafrBI43qKIrIcnQBlJSwVNOZ8Gcvl0OoNDa0QYgNpFyVQok8yJDR3W7a4ZqF2ZSs2yTdzPkNqbsgUkg9RTuuVzr%2BJ0IWfPqfOclYjbyvg8xSLdadzgsszfk0wXK8O0D9utoO42Qj4fAyRHUrDx8JxY18uWRPyFpidRfVqDlD%2FMzGvphFE58fBjncDPhIagYIJNw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d7339459b483b29ccc5b8ec14f171cf80b77ea1a715dca4aea065283e95defa6","file_size":590,"type":"text/html"}],"allow_singular_disclosure_at":"2020-03-01T14:05:38.590Z","allow_singular_disclosure_after":-50889898.71285455,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","0x08","hackingmaching101","rodmartin","umerkakar"],"severity":{"rating":"low","score":2.4,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1698732,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2017-05-24T19:29:30.142Z","updated_at":"2017-05-24T19:29:30.142Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1698736,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Feel free to let me know if I can provide any further information. Thanks!","automated_response":false,"created_at":"2017-05-24T19:30:09.656Z","updated_at":"2017-05-24T19:30:09.656Z","actor":{"username":"icewater","cleared":true,"url":"/icewater","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1702683,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report :-)\n\nI'm a little bit torn apart here because it only affects administrators which can also elevate their privileges using other ways. However, I think adding a `Content-Disposition: attachment` won't hurt here and may be considered best-practise. Thus we're happy to adjust this as a change towards best practice. \n\nI'll check back with the team if we can limit the uploaded mimetype here to `image/*` further.","automated_response":false,"created_at":"2017-05-26T03:46:50.041Z","updated_at":"2017-05-26T03:46:50.041Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1702684,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-05-26T03:49:01.720Z","updated_at":"2017-05-26T03:49:01.720Z","additional_data":{"old_severity":"Low","new_severity":"Low (2.4)","old_severity_id":44646,"new_severity_id":45140},"actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1702685,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"While this one won't meet the bar for a monetary reward we'd be happy to award you some swag as a small thank you.","automated_response":false,"created_at":"2017-05-26T03:49:37.653Z","updated_at":"2017-05-26T03:49:37.653Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"reporter":{"username":"icewater","url":"/icewater"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1702686,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","automated_response":false,"created_at":"2017-05-26T03:49:47.834Z","updated_at":"2017-05-26T03:49:47.834Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1703630,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Agreed, since it's only exploitable by an admin user it's not a major issue or anything. Thank you for the swag, that is very nice of you! :)","automated_response":false,"created_at":"2017-05-26T15:24:27.034Z","updated_at":"2017-05-26T15:24:27.034Z","actor":{"username":"icewater","cleared":true,"url":"/icewater","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2833679,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @icewater,\n\nTo give a quick update.\n\nWe added additional checks in our current master to solve this.\nThis will be released with Nextcloud 14.\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-06-02T20:27:04.862Z","updated_at":"2018-06-02T20:27:04.862Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2838645,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This will be resovled in Nextcloud 14.","automated_response":false,"created_at":"2018-06-04T12:28:00.604Z","updated_at":"2018-06-04T12:28:00.604Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"icewater","url":"/icewater"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6932728,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-31T14:05:38.532Z","updated_at":"2020-01-31T14:05:38.532Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6933663,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-31T16:17:31.420Z","updated_at":"2020-01-31T16:17:31.420Z","actor":{"username":"icewater","cleared":true,"url":"/icewater","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6933664,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-01-31T16:17:31.479Z","updated_at":"2020-01-31T16:17:31.479Z","actor":{"username":"icewater","cleared":true,"url":"/icewater","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}