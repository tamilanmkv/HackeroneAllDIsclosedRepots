{"id":244902,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDQ5MDI=","url":"https://hackerone.com/reports/244902","title":"XSS through document projects","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-06-30T23:10:37.540Z","submitted_at":"2017-06-30T23:10:37.540Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ethanluismcdonough","url":"/ethanluismcdonough","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":134,"url":"https://hackerone.com/khanacademy","handle":"khanacademy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Khan Academy","twitter_handle":"","website":"https://www.khanacademy.org/","about":"Start learning now. Completely free, forever."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-03-30T22:55:10.407Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-02-28T22:54:56.146Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello, I'm Ethan Luis McDonough ([@elmt2](https://www.khanacademy.org/profile/elmt2/) on Khan Academy), and I found a way to inject scripts into document projects.  Since KA document projects output HTML, I can edit the PUT request that updates projects (https://www.khanacademy.org/api/internal/scratchpads/ID) and inject JavaScript code inside an `\u003cimg\u003e` tag's `onload` attribute.  Here's a demo that completely redirects a learner from KA to another site: https://www.khanacademy.org/physics/woah/4740384569491456.  \n\n**Note**: the stored script does not run in Firefox because document projects don't seem to be working on that browser (at least on my machine).","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-30T22:54:56.229Z","allow_singular_disclosure_after":-111512049.22955222,"singular_disclosure_allowed":true,"vote_count":7,"voters":["bugdiscloseguys","eveeez","apapedulimu","t4ym","japz","caturipah","ethanluismcdonough"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1795591,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I would like to note that this script is not executed within a sandboxed iframe, rather on the actual site.","automated_response":false,"created_at":"2017-07-01T00:08:53.070Z","updated_at":"2017-07-01T00:08:53.070Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1796182,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I've done some further testing and have been able to manipulate the DOM of the web page.  Since I have access to `document.cookie`, I've been also able to make authenticated API calls on the user's behalf (I would like to thank [@MatthiasSaihttam](https://www.khanacademy.org/profile/MatthiasSaihttam/) for indirectly explaining to me how `fkey` works).  \n\n Here's a demo I made on an alt (to keep the program hidden): https://www.khanacademy.org/physics/test-for-hackerone/6231641170968576.  This demo doesn't do anything harmful, it just makes a T\u0026T on the program that says \"This tip and thanks was posted without my permission\" if you're logged in.  You can see the JS it injects [here](https://rawgit.com/EthanLuisMcDonough/8d8809cf75d7f3bf144cdf2087d8ab25/raw/5f5999851d8c78ca91ab67530c747eebfa257e45/post.js) and the code behind the program [here](http://www.khanacademy.org/api/labs/scratchpads/6231641170968576).","automated_response":false,"created_at":"2017-07-01T07:28:32.829Z","updated_at":"2017-07-01T07:28:32.829Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1796198,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"**NOTE**: I deleted the redirection demo (the very first example I posted) and moved it to my alt: https://www.khanacademy.org/physics/elmt2s-redirect-xss-test/6613395044106240.  I have faith that this information will be much safer in my alt account than in my main account.","automated_response":false,"created_at":"2017-07-01T08:00:08.031Z","updated_at":"2017-07-01T08:00:08.031Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1796201,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"*than it will be in my main account","automated_response":false,"created_at":"2017-07-01T08:02:08.350Z","updated_at":"2017-07-01T08:02:08.350Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1796202,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"*would","automated_response":false,"created_at":"2017-07-01T08:02:13.157Z","updated_at":"2017-07-01T08:02:13.157Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1796793,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I am also able to access information about the user through `KAdefine.require(\"./javascript/shared-package/ka.js\")`.  Here's a demo I made on my alt: https://www.khanacademy.org/physics/email-xss-test-for-reporting-to-the-ka-team/6079712205799424.  Combined with the automatic API calls, this could be very dangerous.","automated_response":false,"created_at":"2017-07-01T19:25:51.333Z","updated_at":"2017-07-01T19:25:51.333Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1809431,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Ethan, thanks for your report on our site's prospective vulnerability. My name is Ragini and I went through your ticket.\nI was although unable to look at the demo https://www.khanacademy.org/physics/elmt2s-redirect-xss-test/6613395044106240 as it redirects to the MDN website automatically. Can you share that again?","automated_response":false,"created_at":"2017-07-06T00:21:18.526Z","updated_at":"2017-07-06T00:21:18.526Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1809542,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Ragini, thanks for responding.  The document project at https://www.khanacademy.org/physics/elmt2s-redirect-xss-test/6613395044106240 is redirecting you to MDN because that's what I told it to do.  The JS that I injected into this project was `window.location.href='https://developer.mozilla.org/en-US/';`.  You can what's happening behind the scenes here: http://www.khanacademy.org/api/labs/scratchpads/6613395044106240.  This example doesn't work with cookies or make authenticated API calls like my other demos do, but it does showcase some functionality that could be harmful.","automated_response":false,"created_at":"2017-07-06T01:49:52.922Z","updated_at":"2017-07-06T01:49:52.922Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1812276,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This sounds very helpful. Thanks for pointing this out to us.\nI will triage this and create an internal ticket to solve this bug. Will we update you as it goes along.","automated_response":false,"created_at":"2017-07-06T19:04:23.283Z","updated_at":"2017-07-06T19:04:23.283Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1812279,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-07-06T19:05:40.639Z","updated_at":"2017-07-06T19:05:40.639Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1812530,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","automated_response":false,"created_at":"2017-07-06T20:31:30.781Z","updated_at":"2017-07-06T20:31:30.781Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978098,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any progress?","automated_response":false,"created_at":"2017-09-05T19:45:48.003Z","updated_at":"2017-09-05T19:45:48.003Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The team is still discussing this and working on finding a solution for this based on it's security vulnerabilities. Will update you when something comes up. Thanks.","automated_response":false,"created_at":"2017-09-05T21:38:01.621Z","updated_at":"2017-09-05T21:38:01.621Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2266582,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates?","automated_response":false,"created_at":"2018-01-06T01:21:29.827Z","updated_at":"2018-01-06T01:21:29.827Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2270408,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Ethan, the team had talked about it. I have asked for the current status of this report and will get back to you when I hear from the team.","automated_response":false,"created_at":"2018-01-08T17:41:11.380Z","updated_at":"2018-01-08T17:41:11.380Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2354529,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Have you heard back yet? ","automated_response":false,"created_at":"2018-02-06T05:34:04.490Z","updated_at":"2018-02-06T05:34:04.490Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2356109,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Ethan! My name is Ian and I'm a developer at Khan Academy. We were able to identify and disable the XSS exploit you described and it should now be impossible to inject Javascript — or indeed any unexpected markup — into the body of a document scratchpad. We'd appreciate it if you can confirm that this is no longer possible for you so we can close the ticket. Thanks once more for identifying this serious vulnerability!","automated_response":false,"created_at":"2018-02-06T17:14:42.348Z","updated_at":"2018-02-06T17:14:42.348Z","actor":{"username":"idreyn","cleared":false,"url":"/idreyn","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2357331,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I ran a few tests, and I think the issue is fixed.  Thanks.","automated_response":false,"created_at":"2018-02-07T02:57:44.811Z","updated_at":"2018-02-07T02:57:44.811Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360776,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"If you send me your Khan Academy account email or username I'd be happy to give you our [Friendly Hacker](https://www.khanacademy.org/badges/friendly-hacker) badge.","automated_response":false,"created_at":"2018-02-08T00:05:50.421Z","updated_at":"2018-02-08T00:05:50.421Z","actor":{"username":"ragini123","cleared":false,"url":"/ragini123","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ethanluismcdonough","url":"/ethanluismcdonough"},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360786,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, but I was already awarded that badge.","automated_response":false,"created_at":"2018-02-08T00:13:12.807Z","updated_at":"2018-02-08T00:13:12.807Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2444262,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can we disclose this?","automated_response":false,"created_at":"2018-02-28T22:26:30.604Z","updated_at":"2018-02-28T22:26:30.604Z","actor":{"username":"ethanluismcdonough","cleared":false,"url":"/ethanluismcdonough","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/216/d82f84d70fbda243db97bb102cf223771fcea748_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2444348,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-02-28T22:54:56.174Z","updated_at":"2018-02-28T22:54:56.174Z","first_to_agree":true,"actor":{"username":"benkraftka","cleared":false,"url":"/benkraftka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/044/789/4822709cf4ea46d7303ac6bb829a3cfb083ab085_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2548652,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-03-30T22:55:10.444Z","updated_at":"2018-03-30T22:55:10.444Z","actor":{"url":"/khanacademy","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Khan Academy"}},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}