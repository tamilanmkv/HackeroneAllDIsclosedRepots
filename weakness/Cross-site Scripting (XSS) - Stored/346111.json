{"id":346111,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDYxMTE=","url":"https://hackerone.com/reports/346111","title":"XSS (Persistent) - Selecting role(s) for protected branches","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-05-01T16:49:28.441Z","submitted_at":"2018-05-01T16:49:28.441Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"phillycheeze","url":"/phillycheeze","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2018-10379"],"singular_disclosure_disabled":true,"disclosed_at":"2018-07-16T17:17:14.335Z","bug_reporter_agreed_on_going_public_at":"2018-06-26T20:55:40.155Z","team_member_agreed_on_going_public_at":"2018-07-16T17:17:14.188Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** \nWhen using the dropdown that selects the groups or users that are allowed to push or merge to a protected branch within a project, it is possible to trigger a XSS with a malicious user name string. \n\n**Description:**\nThis vulnerability is similar to the recently announced CVE-2018-10379. The username input string where an attacker is able to inject a payload is in the same location, but the XSS that renders is in a different location. Since the remediation needs to be applied at the presentation layer, this is indeed a separate vulnerability and needs to be fixed separately (although Gitlab could start whitelisting characters allowed in usernames, similar to how Gitlab whitelists characters for Group or Project names).\n\nThe steps to reproduce are fairly simple but there are some restrictions:\n  *  Only members of a project with Master access are able to become victims of the XSS\n  *  Only groups/members with a subscription level of Starter or higher are able to perform the XSS, since this requires the ability to restrict merge/push permissions of a branch to a specific user. This is a premium feature only allowed at Starter or higher. (https://gitlab.com/help/user/project/protected_branches#restricting-push-and-merge-access-to-certain-users-starter)\n\n## Steps To Reproduce:\n  1. Set your own username as \"\u003cimg src=x onerror=alert(document.domain)\u003e foo / bar\"\n  1. Make yourself have at least Master access to a project\n  1. In this project, ensure at least one branch is in the project and that branch is a \"Protected Branch\"\n  1. Under Project Settings -\u003e Repository -\u003e Protected Branches, select the dropdown under the \"Ability to Merge\" section\n  1. Notice that the onerror attribute from the username renders.\n\n## Supporting Material/References:\nMore information can be provided upon request. \n\nYou'll notice the payload above is the same as the payload used in a test file (inside the ce source code repo) for the CVE I attached. I only found this vulnerability since I was testing the previous CVE on our own internal instance of Gitlab, left my username saved as that malicious string, and later found the alert() dialog popup in another area of the site even after patching to 10.7.2.\n\n## Suggested Remediation\nI believe this is the offending Line: https://gitlab.com/gitlab-org/gitlab-ee/blob/master/ee/app/assets/javascripts/projects/settings/access_dropdown.js#L461\n\n^There could also be other XSS vulnerabilities in this JS file. Everywhere else in the app uses the underscore method  `_.escape()`to escape user input, but this file doesn't.\n\n## Impact\n\nThe security impact is the same as any typical persistent xss.\n\nThe hacker selected the **Cross-site Scripting (XSS) - Stored** weakness. This vulnerability type requires contextual information from the hacker. They provided the following answers:\n\n**URL**\nhttps://gitlab.com/group/project/settings/repository\n\n**Verified**\nYes\n\n","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-07-26T20:55:40.227Z","allow_singular_disclosure_after":-101325183.80915,"singular_disclosure_allowed":true,"vote_count":8,"voters":["phillycheeze","muon4","eveeez","an0nym0us","khizer47","grampae","cryptographer","yyyyyyyy"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2693518,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @phillycheeze ,\n\nI've validated that this is a Persistent XSS issue and have categorized it as High severity. We are working internally on resolving the issue at https://gitlab.com/gitlab-org/gitlab-ce/issues/45994. The issue will be made public 30 days after a patch has been released. We will keep you updated on our progress via HackerOne.\n\nFeel free to contact us at anytime if you need an update.\n\nThank you,\nJames\n","automated_response":false,"created_at":"2018-05-03T00:12:31.738Z","updated_at":"2018-05-03T00:12:31.738Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2693521,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-05-03T00:12:50.483Z","updated_at":"2018-05-03T00:12:50.483Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2818859,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @phillycheeze ,\n\nThanks again for reporting this issue! The fix was just released at https://about.gitlab.com/2018/05/29/security-release-gitlab-10-dot-8-dot-2-released/.\n\nBest regards,\nJames","automated_response":false,"created_at":"2018-05-30T16:45:47.424Z","updated_at":"2018-05-30T16:45:47.424Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2818861,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Closing as resolved.","automated_response":false,"created_at":"2018-05-30T16:46:00.917Z","updated_at":"2018-05-30T16:46:00.917Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"phillycheeze","url":"/phillycheeze"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2938129,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-06-26T20:55:40.186Z","updated_at":"2018-06-26T20:55:40.186Z","first_to_agree":true,"actor":{"username":"phillycheeze","cleared":false,"url":"/phillycheeze","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3040994,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Pinging again to have the reports disclosed. I'll be writing them up on Medium soon, since they were disclosed on Gitlab over two weeks ago.\n\nAdditionally, another report comment mentioned a bounty but I don't see anything listed anywhere. Does Gitlab award bounties?","automated_response":false,"created_at":"2018-07-13T14:10:29.818Z","updated_at":"2018-07-13T14:10:29.818Z","actor":{"username":"phillycheeze","cleared":false,"url":"/phillycheeze","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3052756,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@phillycheeze ,\n\nI've reached out to member of our team to get you some swag. What's your email so they can send you the code? (I should be able to redact it before making the report public)\n\nBest regards,\nJames","automated_response":false,"created_at":"2018-07-16T17:08:37.420Z","updated_at":"2018-07-16T17:08:37.420Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3052777,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"My email is █████████, thanks!","automated_response":false,"created_at":"2018-07-16T17:12:28.388Z","updated_at":"2018-07-16T17:16:48.121Z","actor":{"username":"phillycheeze","cleared":false,"url":"/phillycheeze","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3052788,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Setting to public","automated_response":false,"created_at":"2018-07-16T17:17:14.257Z","updated_at":"2018-07-16T17:17:14.257Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3052789,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-07-16T17:17:14.372Z","updated_at":"2018-07-16T17:17:14.372Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}