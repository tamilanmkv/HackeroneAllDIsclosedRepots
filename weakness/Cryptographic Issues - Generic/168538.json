{"id":168538,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjg1Mzg=","url":"https://hackerone.com/reports/168538","title":"Twitter iOS fails to validate server certificate and sends oauth token","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-09-15T08:58:11.908Z","submitted_at":"2016-09-15T08:58:11.908Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"floyd","url":"/floyd","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2016-10511"],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-23T14:34:45.368Z","bug_reporter_agreed_on_going_public_at":"2016-11-23T14:34:32.267Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Twitter on iOS newest two versions (6.62 and 6.62.1) are affected, other versions not tested. Tested independently on two different iPhone 6 with iOS version 9.3.3 and 9.3.5 without Jailbreak. The iPhone were without any mobileconfig profiles installed - *no* we did not install any CA certificate in the CA store of the device. Really stock iPhones. The Twitter app does not check the SSL/TLS certificate of https://api.twitter.com . A transparent proxy setup (eg. burp suite in transparent mode) is sufficient to exploit. Steps to reproduce:\n1. Start Burp or other Proxy software in transparent mode. Setting \"Generate CA-signed per-host certificates\", which means the CA cert of Burp is used, which is *not* trusted on the iPhones.\n2. Start rogue Wifi access point (eg. on the same machine as burp)\n3. Redirect all incoming HTTPS traffic on the rogue Wifi access point to the transparent proxy. We simply used on Linux:\niptable -t nat -A PREROUTING -i wlan0 -p tcp --dport 443 -j DNAT --to $BURP_IP:8080\niptable -t nat -A PREROUTING -i wlan0 -p tcp --dport 443 -j REDIRECT --to-port 8080\n4. Connect with the iOS device to the Wifi access point\n5. Open Twitter app on iOS\n6. In burp only the calls to api.twitter.com are visible and include sensitive authentication information etc.\n\nThis is the information we saw for two different accounts in burp which includes the oauth token etc.:\n\nGET /1.1/help/settings.json?include_zero_rate=true\u0026settings_version=8910e1e75c037c3c6b59c64b477b0741 HTTP/1.1\nHost: api.twitter.com\n█████████\nX-Twitter-Client-Version: 6.62\nX-Twitter-Polling: true\nX-Client-UUID: D8AB1681-1618-48BA-9EB0-F3628DF1660B\nX-Twitter-Client-Language: de\nX-B3-TraceId: cc8ac1aea2ba5628\nx-spdy-bypass: 1\nAccept: */*\nAccept-Language: de\nAccept-Encoding: gzip, deflate\nX-Twitter-Client-DeviceID: 68715C92-258F-4C59-A0B4-B98AF8B976BC\nUser-Agent: Twitter-iPhone/6.62 iOS/9.3.3 (Apple;iPhone8,1;;;;;1)\nConnection: close\nX-Twitter-API-Version: 5\nX-Twitter-Client-Limit-Ad-Tracking: 1\nX-Twitter-Client: Twitter-iPhone\n\n\n\nHTTP/1.1 304 Not Modified\ncache-control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0\nconnection: close\ncontent-length: 0\ncontent-security-policy: default-src 'self'; connect-src 'self'; font-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com data:; frame-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; img-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com data:; media-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; object-src 'none'; script-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; style-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; report-uri https://twitter.com/i/csp_report?a=NVQWGYLXFVRWY2LFNZ2C2Y3PNZTGSZY%3D\u0026ro=false;\ncontent-type: text/html;charset=utf-8\ndate: Thu, 15 Sep 2016 08:33:18 GMT\nexpires: Tue, 31 Mar 1981 05:00:00 GMT\nlast-modified: Thu, 15 Sep 2016 08:33:18 GMT\npragma: no-cache\nserver: tsa_b\nset-cookie: guest_id=v1%3A147392839826657964; Domain=.twitter.com; Path=/; Expires=Sat, 15-Sep-2018 08:33:18 UTC\nstatus: 304 Not Modified\nstrict-transport-security: max-age=631138519\nx-access-level: read-write\nx-client-event-enabled: true\nx-connection-hash: 40e91f874332181942e1454b13ccaa6a\nx-content-type-options: nosniff\nx-frame-options: SAMEORIGIN\nx-rate-limit-limit: 15\nx-rate-limit-remaining: 12\nx-rate-limit-reset: 1473929244\nx-response-time: 29\nx-transaction: cc8ac1aea2ba5628\nx-twitter-response-tags: BouncerExempt\nx-twitter-response-tags: BouncerCompliant\nx-xss-protection: 1; mode=block\n\n\n\nGET /1.1/help/settings.json?include_zero_rate=true\u0026settings_version=8910e1e75c037c3c6b59c64b477b0741 HTTP/1.1\nHost: api.twitter.com\n█████████\nX-Twitter-Client-Version: 6.62\nX-Twitter-Polling: true\nX-Client-UUID: D8AB1681-1618-48BA-9EB0-F3628DF1660B\nX-Twitter-Client-Language: de\nX-B3-TraceId: 796651628eef7eed\nx-spdy-bypass: 1\nAccept: */*\nAccept-Language: de\nAccept-Encoding: gzip, deflate\nX-Twitter-Client-DeviceID: 68715C92-258F-4C59-A0B4-B98AF8B976BC\nUser-Agent: Twitter-iPhone/6.62 iOS/9.3.3 (Apple;iPhone8,1;;;;;1)\nConnection: close\nX-Twitter-API-Version: 5\nX-Twitter-Client-Limit-Ad-Tracking: 1\nX-Twitter-Client: Twitter-iPhone\n\n\n\nHTTP/1.1 304 Not Modified\ncache-control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0\nconnection: close\ncontent-length: 0\ncontent-security-policy: default-src 'self'; connect-src 'self'; font-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com data:; frame-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; img-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com data:; media-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; object-src 'none'; script-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; style-src 'self' https://*.twimg.com https://twitter.com https://ton.twitter.com; report-uri https://twitter.com/i/csp_report?a=NVQWGYLXFVRWY2LFNZ2C2Y3PNZTGSZY%3D\u0026ro=false;\ncontent-type: text/html;charset=utf-8\ndate: Thu, 15 Sep 2016 08:34:36 GMT\nexpires: Tue, 31 Mar 1981 05:00:00 GMT\nlast-modified: Thu, 15 Sep 2016 08:34:36 GMT\npragma: no-cache\nserver: tsa_b\nset-cookie: guest_id=v1%3A147392847623972314; Domain=.twitter.com; Path=/; Expires=Sat, 15-Sep-2018 08:34:36 UTC\nstatus: 304 Not Modified\nstrict-transport-security: max-age=631138519\nx-access-level: read-write\nx-client-event-enabled: true\nx-connection-hash: e980abd0bd35e3bf0b8c693e8a12f636\nx-content-type-options: nosniff\nx-frame-options: SAMEORIGIN\nx-rate-limit-limit: 15\nx-rate-limit-remaining: 11\nx-rate-limit-reset: 1473929244\nx-response-time: 44\nx-transaction: 796651628eef7eed\nx-twitter-response-tags: BouncerExempt\nx-twitter-response-tags: BouncerCompliant\nx-xss-protection: 1; mode=block\n","bounty_amount":"2100.0","formatted_bounty":"$2,100","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-12-23T14:34:32.320Z","allow_singular_disclosure_after":-151456572.04246166,"singular_disclosure_allowed":true,"vote_count":34,"voters":["hunter","bogdantcaciuc","spam404","dmatrix","kasser","floyd","mpz","madrobot","eveeez","0x4141","and 24 more..."],"severity":{"rating":"high","score":8.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1198842,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Thank you for the report. We are already aware of the issue and are working to fix it.\n\nThank you for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-15T19:07:20.291Z","updated_at":"2016-09-15T19:07:20.291Z","original_report_id":29589,"actor":{"username":"bugtriage-alex","cleared":false,"url":"/bugtriage-alex","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1201587,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Oops, sorry about that. It appears we misunderstood your report. What you're describing is about certificate validation.\n\nWe tested this using a pristine iOS device (non-rooted, no extra CAs added, latest Twitter app version (6.62.1), etc). When proxying traffic from this device, HTTP browser traffic is intercepted but HTTPS browser traffic is not. This is expected behavior, so far. When we then launch the Twitter app, Burp displays errors indicating that an SSL/TLS connection could not be established and the Twitter app does not function normally. (Note: The Twitter app does launch and appear to work, superficially, but requests like sending a tweet or similar fail.) This indicates that validation is being performed. If it was not, this SSL/TLS traffic would succeed (or we would need to install the Burp CA on the device in order for it to succeed). \n\nIs there any further information you can supply that would help us reproduce the behavior that you are seeing? We are not sure what the next step is, given that all of the behavior we are seeing on our end is normal and expected.\n\nThank you for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-16T23:47:55.838Z","updated_at":"2016-09-16T23:47:55.838Z","actor":{"username":"bugtriage-jason","cleared":false,"url":"/bugtriage-jason","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202072,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Jason!\n\nDo you have a transparent setup? We are not setting Burp as a proxy in the iOS device but rather have the Wifi-Router redirect the traffic to Burp (and Burp is in transparent mode). I was as surprised as you when I saw this behavior.\n\nLet me do the setup again and if it works again I'll try to make screenshots and/or video of what is going on. I have to setup the iPhone again as I had to jailbreak it for a Pentest in the meantime (I work as a pentester).\n\nI'll get back to you.\n\nBest regards,\nfloyd","automated_response":false,"created_at":"2016-09-17T15:31:16.041Z","updated_at":"2016-09-17T15:31:16.041Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202144,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there,\n\nSo I tested it again and I can still exploit it. Two preconditions:\n1. You have Burp setup in transparent setup\n2. You close the Twitter app and reopen it on the iOS device\n\nTo proof as much as I can I made a video that explains step by step. The video can be found here (keep the link private):\nhttp://floyd.li/unpredictable-yqAK5A8mpoKNwBioWPK6ejPjqAzFUh/video-demonstration.mov\n\nIf you have issues watching it in the browser directly, download it with wget and watch it in VLC or another player.\n\nThe transparent proxy setup is really a standard setup with iptables, let me know if you need help with that. Any transparent proxy setup should work.\n\nIf I had a custom CA certificate installed on my iPhone, I would have a menu item \"Profile\" as shown in the following example screenshot: http://media.idownloadblog.com/wp-content/uploads/2016/01/iOS-9-how-to-delete-configuration-profile-iPhone-screenshot-003-593x347.png . Do you agree? But you will see in the Video that's not the case.\n\nSo by now I'm 98% sure this is a bug in the Twitter iOS app (as https://www.hackerone.com did not open and the Apple App Store app also didn't work correctly), the other 2% probability is an Apple bug :)\n\nEvery attacker who is able to do a transparent proxy setup can gain access to the OAuth cookie. As a precondition the user has to (re-) open the app (however, if the app was already open and it doesnt work correctly because of interception it is very likely the user will try to close and reopen the app).\n\nI hope that helps to reproduce, otherwise let me know.\n\nBest regards,\nfloyd","automated_response":false,"created_at":"2016-09-17T18:08:10.888Z","updated_at":"2016-09-17T18:08:10.888Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202628,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you would prefer to ask me directly, you can also call me on ████(I don't know if this is allowed according to Hackerone rules). Additionally, I just confirmed that the Android version of the app is not affected.","automated_response":false,"created_at":"2016-09-18T11:12:49.767Z","updated_at":"2016-12-08T17:37:37.507Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202724,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wow, this bug is crazy. Something really weird must be going on on the SSL/TLS layer in the Twitter iOS app. Are you using the standard iOS provided libraries or something customized? Here's the thing: When I wanted to try the Twitter Android app (just to see if it has similar issues), Android had issues doing DHCP-client and didn't get an IP from the laptop. As I'm using dnsmasq on the laptop (see video) to do DHCP-server and DNS-server, I thought I'll just enable the DHCP-server part of the mikrotik router and add a default route on the mikrotik that points to the laptop. That worked fine and I tested several Android apps and the Android browser, the HTTP requests showed up in burp and the HTTPS showed certificate warnings, so far so good. The Twitter Android app was not vulnerable in this setup. But then just out of curiosity I tried to exploit the Twitter iOS app again in this setup (expecting it to be exploitable), but it did not work! Twitter iOS did *not* send the HTTP content to burp as the certificate was rejected. Because I couldn't believe my eyes I switched everything back to dnsmasq as a DHCP-Server on the laptop and the Twitter iOS app was exploitable again! So at this point my best bet is that there is some horrible quirk/race condition making the Twitter iOS app send the HTTP request to burp even when the certificate can not be validated against a known CA certificate. I don't know what's best to reproduce this issue, but as a first step I took wireshark pcaps (filter ip.addr==199.16.156.0/24) in both setups. I took them with wireshark on the laptop and used the incoming ethernet interface from the mikrotik for capturing. I'm unsure if this will help you to hunt the issue down, but for me it looks like packet number 92 in the successful attack in api.twitter.com-successful-interception-floyd.pcapng is Application Data in TLSv1.2 and could be the HTTPS request I see in burp (the request in burp is 997 bytes, the application data in the TLS packet is 1056 bytes, which sounds very plausible as I guess the difference is padding). There is no such Application Data packet in the unsuccessful case (api.twitter.com-unsuccessful-interception-floyd.pcapng). Additionally I attached the mikrotik.sh I use on the laptop to do the transparent proxy setup. Let me know your thoughts.","automated_response":false,"created_at":"2016-09-18T14:02:31.755Z","updated_at":"2016-09-18T14:02:31.755Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":121178,"filename":"mikrotik.sh","type":"text/x-shellscript","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/121/178/f8f81a6941f80a9ab5ed881264af70e93e8cc099/mikrotik.sh?response-content-disposition=attachment%3B%20filename%3D%22mikrotik.sh%22%3B%20filename%2A%3DUTF-8%27%27mikrotik.sh\u0026response-content-type=text%2Fx-shellscript\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4d629e375ff8c651f483588cc26bd9a20ef3caea7baed15ef9a9d180ebbdf848"}],"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1202735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As this is really strange I just wanted to add: it can not be an issue of my setup, as I tested this with two independent iPhones and was able to exploit it for both.","automated_response":false,"created_at":"2016-09-18T14:14:11.800Z","updated_at":"2016-09-18T14:14:11.800Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1203434,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok, I figured it out from looking at the successful wireshark packets: The Twitter iOS app opens multiple TLS connections. It seems the TLS implementation of the Twitter app is that a full TLS handshake is finished even when the server certificate can not be validate. This means that Twitter iOS is not sending an Encrypted Alert TLS message right after the Server Hello was received, but after the entire handshake is completed. Although this behavior is questionable in general, it is implemented in practice for many clients (eg. in Chrome but not in Firefox, Firefox will close after the certificate in the Server Hello). As long as no payload (in this case HTTP) is sent over this TLS connection this is not a problem (eg. should be correct in Chrome), but it is important to trash the session in the case the certificate is incorrect. After the handshake the Twitter app sends a TCP FIN message, the server reacting with TLS Encrypted Alert and a TCP FIN and then the Twitter app sends TCP RST. One such full TLS handshake can be seen when following the TCP stream of the Server Hello packet 18. In that packet 18 you also see that the server sends the TLS session id 57de7f8b[...] then the fake Twitter server (burp) sends a TLS Encrypted Alert in packet 41 and the connection is closed. Imporant: TLS Encrypted Alert do not mean that anything went wrong (certificate verification or anything), but can simply mean that the server or client is finished with transmitting (it's the equivalent of TCP FIN). However, when you now follow the TCP stream in the client hello packet 58, you can see that the TLS Client Hello is doing a session resumption with TLS session id 57de7f8b[...] ! This is the bug we are looking for, as the client is not supposed to reuse that session, because the certificate was not validated correctly! As Burp is fine with resuming that session, the TLS handshake will be successful. When doing TLS session resumption there is no need for a server (burp in this case) to send a TLS server certificate in the TLS Server Hello (you can see that in in packet 69) and therefore no certificate validation can/will take place, as this is just the old TLS session that was already established.  \n\nOr in other words: The Twitter app is not correctly removing TLS sessions from the connection pool when the server certificate could not be validated, therefore sending data to a rogue server when the TLS session is reused!\n\nPlease let me know if you use standard Apple TLS or another library, as this problem could be much bigger than just Twitter!\n\nAlso let me know if you would like me to do some function hooking with FRIDA http://www.frida.re on a jailbroken iPhone so you can see the corresponding calls or such...","automated_response":false,"created_at":"2016-09-19T08:59:00.214Z","updated_at":"2016-09-19T08:59:00.214Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1206155,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Does Twitter work together with ██████████? Or is someone of the Hackerone administrators at ██████? Somebody from █████████ accessed the video I linked here twice (Firefox, then Safari) and that IP belongs to ███. Could someone explain please? Also it might help to know who I am talking to, @bugtriage-jason and @bugtriage-alex can you identify yourselves? Your profiles are completely empty, you just signed up this year for Hackerone and I don't even know if you are part of the Hackerone or Twitter team.","automated_response":false,"created_at":"2016-09-20T07:55:11.103Z","updated_at":"2017-01-06T20:45:00.224Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1207266,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, the bugtriage accounts are operated by our triage service (████). The activity you've seen to your video is from our triage team as part of their investigation into your report. We will let you know as soon as we have confirmed your report or require additional information. Thanks for your patience.\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-20T17:56:52.353Z","updated_at":"2017-01-06T20:45:00.212Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1207632,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2016-09-20T20:31:46.042Z","updated_at":"2016-09-20T20:31:46.042Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1207780,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We're currently looking into this issue. To assist with our investigation, could you please let us know if you were you able to intercept requests to resources other than ```GET/1.1/help/settings.json```?\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-20T21:26:53.460Z","updated_at":"2016-09-20T21:26:53.460Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1208366,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for clarification. I can imagine you will need some time to find the root cause, from my investigation the condition that the TLS session is reused is not always given. I was only able to intercept that GET request to `/1.1/help/settings.json` (and the corresponding 304 server response). Although untested I can imagine that the TLS session reuse could also cleverly be triggered by first passing through an amount of TLS connections and then starting to intercept again (just a guess).","automated_response":false,"created_at":"2016-09-21T06:59:41.496Z","updated_at":"2016-09-21T06:59:41.496Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1209971,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for following up. At this time we have only been able to intercept requests to the ```/1.1/help/settings.json``` endpoint. If you are able to intercept requests to other endpoints please let us know, as that may adjust our impact analysis. We'll let you know when we consider this issue to be resolved.\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-21T23:59:14.745Z","updated_at":"2016-09-21T23:59:14.745Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1211087,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Andrew\n\nI'll explain how I see the impact on security from my point of view:\n\n1. The cookies are exposed to an attacker, especially the oauth_token, but also the oauth_nonce, oauth_signature, oauth_timestamp, oauth_consumer_key, Twitter-Client version, X-Client-UUID, X-Twitter-Client-DeviceID and User-Agent. The used HMAC-SHA1 is still considered secure and I didn't analyze your oauth schema in detail.\n\n2. Arbitrary redirects are possible. As an example I simply responded with a 301 Moved Permanently message [0] and redirected the Twitter iOS app to http://www.floyd.ch. Burp is then seeing that this ressource is actually requested by the twitter app, the request looks like [1]. This results in third-party content landing in the memory of the Twitter iOS app. Additionally if the cookie store of the library in Twitter iOS doing the request includes any other (non-secure-flag) cookies (eg. for www.twitter.com or any other website) an attacker would be able to force the app to reveil that cookie. However, I did not find any other cookie during my investigation. Are there any?\n\n3. The arbitrary redirect can be abused to force the Twitter iOS app [2] to use non-TLS connections. The Twitter iOS app itself does not enforce HTTPS to Twitter Server itself afterwards, but sends a non-encrypted request to http://api.twitter.com (non-TLS) [3]. This can actually be seens as an issue by itself: Your Twitter iOS app doesn't honor the Strict-Transport-Security header between sessions/when reopening the Twitter app. Therefore the Strict-Transport-Security header is pretty useless for the Twitter iOS app. Should I opened a separate bug for that?\n\n4. Reading the entire settings.json [4]. I had the issue that the server always responded with a HTTP 304 message, but by changing the User-Agent to Android in the request I suddenly got the full response as a HTTP 200 message. I'm unsure if Twitter considers the information in there confidential.\n\n5. When injecting a malicious settings.json as a response (my first test was to send \"con'fig\" instead of \"config\" in the json response) I couldn't see any modifications in the app and for some reason I haven't figured out yet the Twitter iOS app doesn't send the request anymore for quiet a while afterwards (I guess the Twitter app is cashing the settings.json). I'd like to check if modifications in settings.json might lead to XSS or any other content modification inside the Twitter app. But that has to wait until next week.\n\n6. Depending on what kind of parsing/usage of the response, other attack are possible that I didn't investigate yet.\n\nBy the way if you see CSP violation reports on https://twitter.com/i/csp_report let me know as those might be my tests by manipulating the server response.\n\nI guess you don't want to share what kind of TLS library is used in the Twitter iOS app? Is the Twitter app using crashlytics? I see a lot of crash reports going out, but I don't know if they are coming from the Twitter app.\n\nBest regards,\nfloyd\n\n[0] see 0.txt\n[1] see 1.txt\n[2] see 2.txt\n[3] The request in attachement 3.txt is actually sent over a non-TLS (plain HTTP) connection as triggered in 2.txt.\n[4] see settings.txt","automated_response":false,"created_at":"2016-09-22T16:20:30.470Z","updated_at":"2016-09-22T16:20:30.470Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":122247,"filename":"settings.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/122/247/7fb549c106c9c3a1c2aa8a674158b5e9033c04df/settings.txt?response-content-disposition=attachment%3B%20filename%3D%22settings.txt%22%3B%20filename%2A%3DUTF-8%27%27settings.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=1e71860526ca885fadacde3f3d1ed7d5666076e98b4d3c7be598f75895c8494c"},{"id":122243,"filename":"1.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/122/243/c3f3075f61f71be076ec98a1efb17a55b670ed5b/1.txt?response-content-disposition=attachment%3B%20filename%3D%221.txt%22%3B%20filename%2A%3DUTF-8%27%271.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=9f0002c702a7d39a811005bbd30834899c6235fc5beb76e0e746e593e935df87"},{"id":122244,"filename":"0.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/122/244/11d86e6055def2fa7eb02b696fa166ef36f3b9cb/0.txt?response-content-disposition=attachment%3B%20filename%3D%220.txt%22%3B%20filename%2A%3DUTF-8%27%270.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=fe3e0e92db2dce42a8e0d8182eec01575d32f7926c5da7b52aef00b90daabe57"},{"id":122245,"filename":"2.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/122/245/9bddb66fa8ccc4a835fdb1360c72c7bc0463d676/2.txt?response-content-disposition=attachment%3B%20filename%3D%222.txt%22%3B%20filename%2A%3DUTF-8%27%272.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=660484f8a5e789404834f5c3033878d4d1e09c16f022386eb471442d2dd0dd6c"},{"id":122246,"filename":"3.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/122/246/817e22a3f572e87418d02e0a643a89a1519a09c4/3.txt?response-content-disposition=attachment%3B%20filename%3D%223.txt%22%3B%20filename%2A%3DUTF-8%27%273.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZQXPADTK%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135044Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIEnMr4DVhYYTqMb%2BOP2PKHfYpSv9D5BBEJnMqEhFTzeKAiAeXkKMs80U9YQDe4ttV6IqDuQKfy6G4rgQ5lLDs%2FynrSqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMbhflm22iYJYqUsxzKtcDB8Pgwi96hJiplV7WKaw0AR0k%2BEXDFBW%2BG%2BYdpHb62oEWGe8HSRbQaU3Q3Fj%2BSvKqS093fZuQDsCdV4M3iqQIqCtv1Q6GPf9rTsY3aeauyx8etG%2BURaJibQVQc9PwZaDx1L%2BryPnwfQFfT9ayiFdqA9fZYBYVBAdVfr6WiMFuX0XdRnwM7tzE6J0AXxB37N69wBbU2Xb3tKIicAQDLneqa8aoUR3YUFtvOFZAz2Qc931NT%2Br%2FigpMQjz0syuVR2poADAistQGXHWk3I6xFISQymYX7MTDVeyWJZRkAoG5czInm6nDg9jipQu%2BenzxOmQOqUNZ%2FDC76AwjY5aAAvtd6r6JT2V72trR11DROBIsJO%2FIShH7q9JoESyB%2F1o6Q5%2BiuwomCPFU4tVEemlEc5lNYIZamrFJsAH5GaSMDFA6YpipFDWfpviI7f2MiBQlxPJAB5X1QzT5WIXx2PazxnrBI3G29KeYynTTVHHJidcczfgLkVHwxGbuhtijOBi4s%2Fgk0dWW44Ywe3A1G%2BRX8Yj0NVuvt8Pt%2B0N5CI3EdAFGY1U6SFNz7egYzaePbVDnsQZghACy4h1g%2BARgHKr4cJvS8EZ5xhXkVVfycQcZfNVbW3SIBSo%2B4HEJMLbjkIsGOqYB2jUwpV9YeKKeYEkCjUFt285lWr0XRj6ae48f32wMeam4CFHiyCcH0MCoNenFvDHFJCBn4H%2B3DfwYTcQjZpttvBz8T5sl3abGg2MBvdgbzRrwVgocNPq%2FJOcEyipSDakoglRRfC5s4w5bFejabZEOQFOdoE5KginzyfxwFFH009lEzVJiGfKTDbqdNnetBVWk6JyUphW6lwfF1hGZK9Z27qAkF0weOw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ab2515378fb76e97b85d261e964606325eb21e0738b2cdadf4cf5c6c0cef3f8a"}],"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1213258,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the detailed impact statement. We're still looking into this on our end, so we'll be deferring payout on this issue until we have a better understanding of the issue. We appreciate your patience. A few notes:\n\n1. Thanks for the details on redirecting HTTPs to HTTP through the API. Regarding the use of Strict-Transport-Policy, I don't believe iOS applications rely on the header but rather the use of [ATS](https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html). We'll track investigation / remediation of this as a part of this report.\n1. The information presented in settings.json is used to manage application settings as new features are tested. We consider any issues associated with the modification of these options to be secondary – if you find issues with the default configuration please file a separate report, so that we can appropriately reward you. We will consider the impact of changing these options as part of our reward.\n1. We're still determining the root cause of the issue and have not ruled out the potential for this being a vulnerability in iOS or the native TLS libraries. We ask that you keep the details of this report private until we are able to fully investigate the issue.\n1. While we've been able to reproduce this behavior on iOS 9.3.5, we have yet to reproduce this issue on iOS 10.0.1. Have you been able to reproduce this behavior on iOS 10?\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-09-23T19:39:47.519Z","updated_at":"2016-09-23T19:39:47.519Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1215923,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Andrew,\n\nSure, take your time. Regarding your link: Yes, but I guess setting NSAllowsArbitraryLoads to NO in the NSAppTransportSecurity plist file for the entire Twitter app is not an option as you usually load third party URLs (possibly non-TLS) from tweets inside a webview in the Twitter app, right? The problem is that it seems you can only specify to generally allow HTTP for all domains, but then it seems to me you can not specify to strictly use HTTPS for specific domains. It would be nice to know if that works, but that needs testing. It's a pity that Apple doesn't just implement standard HSTS.\n\nI couldn't find an issue with the default settings.json during my limited tests. But I'm curious what happens if an attacker changes the included URLs. What I tried for example is globally replace in the HTTP response:\n\nhttps://\n\nwith\n\nhttps://www.floyd.ch/\n\nwhich means in settings.json in the HTTP response the URLs look like this:\n\n        \"ad_formats_ads_info_link\": {\n            \"value\": \"https://www.floyd.ch/business.twitter.com/help/how-twitter-ads-work\"\n        [...]\n        \"ad_formats_app_redeem_redemption_link_format\": {\n            \"value\": \"https://www.floyd.ch/buy.itunes.apple.com/WebObjects/MZFinance.woa/wa/redeemLandingPage?mt=%@\u0026code=%@\"\n        },\n\nHowever, I didn't see any request to www.floyd.ch the last time I tested. However, as long as I'm not doing any function hooking I can't tell what's going on inside the Twitter app. Are these URLs used to retrieve content?\n\nSure I'll keep this private.\n\nAs I don't have an iOS 10 device I didn't test it yet.\n\nI'm planning to do some function hooking with FRIDA for the app and check the issue myself. However, I'll have to do this blackbox style whereas you can look at the code. Currently I don't have access to the WiFi setup but I'll let you know as soon as I'm doing more work on this issue.\n\ncheers,\nfloyd","automated_response":false,"created_at":"2016-09-26T10:53:04.890Z","updated_at":"2016-09-26T10:53:47.557Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1226355,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","automated_response":false,"created_at":"2016-09-30T18:23:08.094Z","updated_at":"2016-09-30T18:23:08.094Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Twitter"}},"bounty_amount":"2100.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"floyd","url":"/floyd"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1229874,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the bounty! Is the amount of the bounty final? I'll keep the details private. ","automated_response":false,"created_at":"2016-10-03T19:49:03.838Z","updated_at":"2016-10-03T19:49:03.838Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1231292,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm more and more convinced this is a race condition. Although it is not as reliably exploitable as on the Twitter iOS 6.62.1 with iOS 9.3.5 (where I see the settings.json *every* time I reopen the app), I was able to close then reopen Twitter iOS 6.63.1 with iOS 9.3.1 multiple times (about 30 times) to also trigger the race condition. Btw. this is the third independent iPhone I'm confirming the issue (although this third device is jailbroken, it doesn't matter really as long as I'm not interfering with the TLS layer). But just because it seems to be a race condition under normal circumstances, it doesn't mean an attacker can't exploit the issue reliably by using a custom TLS server.\n\nI was also able to replace Burp with a Python script that uses Python Twisted (twisted.protocols.portforward with ssl) and by using an OpenSSL-generated CA certificate that signs a OpenSSL-generated server certificate for api.twitter.com. So this means at least it's nothing very specific to how Burp does things that makes the issue trigger.","automated_response":false,"created_at":"2016-10-04T14:05:59.928Z","updated_at":"2016-10-04T14:05:59.928Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1231540,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Unless there are further corrections to the report, this is the final bounty. We are currently working on a fix for this issue and will let you know once it is published and ready for testing.\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-10-04T15:57:50.242Z","updated_at":"2016-10-04T15:57:50.242Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1232754,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok, so can you confirm that this is a Twitter app issue and not a Apple iOS issue? Could you elaborate a little bit on what the root cause is? I would be very interested in any details, as that would also allow me to confirm that the fix works.","automated_response":false,"created_at":"2016-10-05T07:10:35.422Z","updated_at":"2016-10-05T07:10:35.422Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1237996,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The issue is a combination of a Twitter application issue and *potentially* an issue in iOS, although likely low in severity. We'll let you know once we know more.\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-10-07T21:12:25.190Z","updated_at":"2016-10-07T21:12:25.190Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1238005,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2016-10-07T21:15:32.333Z","updated_at":"2016-10-07T21:15:32.333Z","additional_data":{"old_severity":null,"new_severity":"High (8.1)","old_severity_id":null,"new_severity_id":847},"actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1242672,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed with the release of version 6.44 (Settings -\u003e About Twitter). Can you please confirm?\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2016-10-11T18:46:07.504Z","updated_at":"2016-10-11T18:46:07.504Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"floyd","url":"/floyd"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1245732,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Andrew,\n\nWhat I did was see the issue again with the old version of Twitter, then I updated the Twitter app to 6.64 (while disabling interception) and tried again. Now I can't see any TLS traffic anymore, so the Twitter app is doing something differently and the issue seems fixed.\n\nHowever, without you providing me any more information on how it was resolved, what the bug was in iOS, etc. I'm completely blind here. Did you notify Apple about a bug and can I access that bug report?\n\nAs I'll be on holiday soon, if you want to release this to the public, please do the following first:\n - Remove HTTP details in original report (those are my live oauth tokens)\n - Remove my telephone number I posted on Sep 18th\n\nThanks and best regards,\nfloyd","automated_response":false,"created_at":"2016-10-13T12:21:43.054Z","updated_at":"2016-10-13T12:21:43.054Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1299979,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@andrewsorensen can we disclose this one? What's the current status?","automated_response":false,"created_at":"2016-11-15T08:57:41.041Z","updated_at":"2016-11-15T08:57:41.041Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1315174,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-11-23T14:34:32.291Z","updated_at":"2016-11-23T14:34:32.291Z","first_to_agree":true,"actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1344825,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just a quick update - we believe the issue is related to the use of Apple's networking staff in a manner that is not thread safe. We can make this report pubic but was going to ask HackerOne to redact your phone number first - any concerns from your side?\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2016-12-06T18:32:27.359Z","updated_at":"2016-12-06T18:32:27.359Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1346780,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Andrew, thanks for the response. Indeed I think that its possible that it is an Apple bug. I can't reproduce it anymore and I didn't take the time to look into it in more detail with hooking. I tried to  make a mini example iOS app but couldn't reproduce either. So I'm fine with releasing this information. \n\nYes, please ask them to remove my phone number and the oauth parameter values in the Authorization HTTP headers. No other concerns from my side. ","automated_response":false,"created_at":"2016-12-07T08:42:11.271Z","updated_at":"2016-12-07T08:42:11.271Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1351574,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We've redacted the information you requested along with the pcap attachments since they might contain sensitive information. ","automated_response":false,"created_at":"2016-12-08T18:59:05.088Z","updated_at":"2016-12-08T18:59:05.088Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1376307,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for redacting, from my side I'm good to go public","automated_response":false,"created_at":"2016-12-20T09:11:00.131Z","updated_at":"2016-12-20T09:11:00.131Z","actor":{"username":"floyd","cleared":false,"url":"/floyd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/469/c180556a9581571521f1f7fad2da4776fc9fa9c6_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1383480,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-12-23T14:34:45.426Z","updated_at":"2016-12-23T14:34:45.426Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Twitter"}},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}