{"id":251572,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNTE1NzI=","url":"https://hackerone.com/reports/251572","title":"Length extension attack leading to HTML injection","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-07-20T10:22:27.318Z","submitted_at":"2017-07-20T10:22:27.318Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"b1t","url":"/b1t","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2943,"url":"https://hackerone.com/zomato","handle":"zomato","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Zomato","twitter_handle":"Zomato","website":"https://www.zomato.com","about":"The fastest way to search for great places to eat at and order from around you. Serving 24 countries worldwide."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-01T14:02:50.489Z","bug_reporter_agreed_on_going_public_at":"2017-08-02T14:02:48.206Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"At the profile setting page where I can set my personal website I found this url:\n*https://www.zomato.com/redirect?u=xxx\u0026t=yyy*\nWhere `xxx` is the `url` that we can control and `yyy` is the `hash`. Through out blackbox testing I find out that if md5(`somescret` + `url`) == t then the redirect is allowed. This is vulnable to \u003chttps://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks\u003e. With this vulnerability I can append what ever I want into the `url` in `u` variable.  \u003chttps://www.zomato.com/redirect?u=http%3A//a.c%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%E8%00%00%00%00%00%00%00%3Cstyle%3Ebody%7Bbackground-color%3A%20black%3B%7D%3C/style%3E%3Cmarquee%20bgcolor%3D%23000000%3E%3Cfont%20color%3D%2300FF00%3Eb1t%20%3D%2C%3D%3C/font%3E%3C/marquee%3E\u0026t=cb3efc9cbeb3d7b84dfc5cb2bef5a3c4\u003e. As a result I can inject arbitrary HTML content into your page because of the `Redirecting you to...` message and there is no escaping on this page. At first I was aiming at an `XSS` but your `WAF` blocks all my attemps, a more skilled attacker may be able to bypass it. Because the nullbyte in `url` breaks your `Refresh` header the page won't redirect anymore and display my injected content. Visit the `poc` above and look at the request and response you will have a clearer view of what happened. A correct fix for this would be using a `correct ``HMAC` implementation not just simple `md5(secret+message)`. There is an attachment script below which I used to exploit the vulnerability. You have get \u003chttps://github.com/iagox86/hash_extender\u003e to be able to use the script.","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":204786,"file_name":"exploit.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/204/786/478f187e450497106eb18ee6ab299ebadb0d6f84/exploit.py?response-content-disposition=attachment%3B%20filename%3D%22exploit.py%22%3B%20filename%2A%3DUTF-8%27%27exploit.py\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143043Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c72124484f70a30cd82d20eabaf85d6e7970e51e0fd3f280026ef1291de65cb5","file_size":1868,"type":"text/html"}],"allow_singular_disclosure_at":"2017-09-01T14:02:48.276Z","allow_singular_disclosure_after":-129688075.54595834,"singular_disclosure_allowed":true,"vote_count":20,"voters":["flamezzz","jensec","sp1d3rs","bogdantcaciuc","sameerphad72","grouptherapy","gerben_javado","thisishrsh","fa1rlight","mysterican","and 10 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1853125,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@b1t \n\nThanks for your submission. We will review it and get back to you.","automated_response":false,"created_at":"2017-07-20T13:46:55.891Z","updated_at":"2017-07-20T13:46:55.891Z","actor":{"username":"glassofbeer","cleared":false,"url":"/glassofbeer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/997/bf60ed9bb749786ae3f68f25703bf0528699cda7_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1855902,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I was able to bypass your `WAF` through double `urlencode` and successfully landing an XSS on your page :). I think the severity should be `HIGH`. Here is the poc \u003chttps://www.zomato.com/redirect?u=http%253A//a.c%2580%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%25E8%2500%2500%2500%2500%2500%2500%2500%253Cimg%2520src%253D%2522%2522%2520alt%253D%2522%2522%2520%2520onerror%253Dalert%2528document.domain%2529%2520%2520%253E\u0026t=22da21f1eb04da905a200ed3580d4846\u003e","automated_response":false,"created_at":"2017-07-21T08:30:46.208Z","updated_at":"2017-07-21T08:30:46.208Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1856718,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@b1t\n\nThanks! I was able to validate the XSS. I will escalate this to the internal team for evaluation. We will get back to you when we have updates.","automated_response":false,"created_at":"2017-07-21T15:13:34.787Z","updated_at":"2017-07-21T15:13:34.787Z","actor":{"username":"glassofbeer","cleared":false,"url":"/glassofbeer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/997/bf60ed9bb749786ae3f68f25703bf0528699cda7_original.JPG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1884976,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @b1t \nThis should be fixed now. Marking this as resolved.\n\nThanks for reporting!","automated_response":false,"created_at":"2017-08-02T11:51:34.424Z","updated_at":"2017-08-02T11:51:34.424Z","actor":{"username":"shreysinha","cleared":false,"url":"/shreysinha","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"b1t","url":"/b1t"},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1885168,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm that the bug is fixed.","automated_response":false,"created_at":"2017-08-02T13:54:35.370Z","updated_at":"2017-08-02T13:54:35.370Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1885191,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-02T14:02:48.243Z","updated_at":"2017-08-02T14:02:48.243Z","first_to_agree":true,"actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1889082,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@shreysinha Does this bug eligible for bounty ? Here is the reason why I think this bug's severity is high:\n- zomato is a social network. An attacker only need to trick other users to click on the link to perform the attack. He\\She can send the link directly to victim or post it in the comment. Performing the attack is easy and can be done in large scale.\n- With an XSS an attacker can do phising, sending any request on behalf of the victim. Which means a malicious attacker can delete victim's account, post comment, update and leak personal info including *payment info* and so on.\n- This bug affects a large number of users. It triggers on firefox by default, on chrome the attacker need to bypass XSS auditor \nwhich is very much possible.\n- This bug demonstrates a way to completely bypass your *WAF* help making it better.\n- This bug is weird, hard and taking some work to find.\nConclusion, an XSS may don't have much impact on a static page which only show content, news, etc but can be really dangerous on a dynamic web application where alot of interaction between users/users and users/application happens.\n\n","automated_response":false,"created_at":"2017-08-03T15:17:47.235Z","updated_at":"2017-08-03T15:17:47.235Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1889877,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Similar cases:\nhttps://hackerone.com/reports/231053\nhttps://hackerone.com/reports/222040\nhttps://hackerone.com/reports/242905\nhttps://hackerone.com/reports/232174\n\n","automated_response":false,"created_at":"2017-08-03T16:19:59.238Z","updated_at":"2017-08-03T16:19:59.238Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1915578,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-08-09T05:27:36.311Z","updated_at":"2017-08-09T05:27:36.311Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Zomato"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"zomato","collaborator":{"username":"b1t","url":"/b1t"},"actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1915724,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks  for the bounty.","automated_response":false,"created_at":"2017-08-09T07:32:42.527Z","updated_at":"2017-08-09T07:32:42.527Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1915941,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"public disclose it please !","automated_response":false,"created_at":"2017-08-09T10:06:34.192Z","updated_at":"2017-08-09T10:06:34.192Z","actor":{"username":"b1t","cleared":false,"url":"/b1t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/067/251bbde5b7ce109e4074be00cc6ddedb56478ff2_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1970932,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-09-01T14:02:50.520Z","updated_at":"2017-09-01T14:02:50.520Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Zomato"}},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}