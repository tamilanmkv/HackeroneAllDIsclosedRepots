{"id":496326,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80OTYzMjY=","url":"https://hackerone.com/reports/496326","title":"█████████ - Insecure download cookie generation allows bypass of CAC authentication, access to deleted and locked files","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-02-15T01:56:00.274Z","submitted_at":"2019-02-15T01:56:00.274Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cablej_dds","url":"/cablej_dds","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/297/403/7f80f45b8c434ad0da25b685ea053058c6d0a1ce_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://bit.ly/2Rt5QhM","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-05-11T16:47:33.285Z","bug_reporter_agreed_on_going_public_at":"2019-12-07T21:14:06.953Z","team_member_agreed_on_going_public_at":"2020-05-11T16:47:33.207Z","comments_closed?":true,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nTo download a file, ████ directs users to `/██████████/Download.aspx` and sets a cookie authenticating the download. The cookie looks like this:\n\n```\npickup=Subject=\u0026PackageID=MTU4NDgzMTU=███\n```\n\nIf an attacker can generate this cookie, this allows downloading a file. As it turns out, the generation of the cookie is fairly straightforward and requires no server-side key, only a file ID and its associated password. The components are:\n\n1. The file ID, base 64 encoded, followed by a dash\n2. The SHA512 hash of the plaintext file ID, base 64 encoded\n3. The secret key of the package (as sent in the email), base 64 encoded, followed by a dash\n4. The SHA2512 hash of the secret key, base 64 encoded\n\nBy generating a cookie using this format, an attacker can accomplish the following:\n\n1. Bypass CAC-enforced files.\n2. Bypass deleted files (tested when a user deletes their package). Untested if this allows accessing historical files.\n3. Bypass \"locked\" files that have already been downloaded.\n\nFor instance, after attempting to download a deleted package on █████, █████ displays the following error:\n\n\u003e The package Is no longer available For download. The file(s) has been permanently deleted from ███████. You will have To contact the sender And ask them To upload the file(s) again. \n\nHowever, this is not true. By making a crafted request to `/█████████/Download.aspx` given the above cookies, a user can still download deleted files. This may also apply to past files, meaning that all previous uploaded files may not be deleted. I will test this when files I have submitted expire.\n\n## Impact\n\nSignificant bypasses to █████████ security controls, including:\n\n- Bypass CAC protections\n- Download files that ███ says have been deleted from the file system\n- Download locked files that have already been downloaded\n\nIt is unclear at the moment if this also applies to files that have expired after a set period of time. I will retest when files I have uploaded have expired.\n\n## Step-by-step Reproduction Instructions\n\n1. Visit https://███████/██████/pickupfiles.aspx?id=15849581, a file I uploaded and deleted.\n2. Try the password `█████████`. Observe that an error is displayed that the file is deleted.\n3. As described above, generate the following cookie, based on the file ID and password.\n\n```\npickup=Subject=\u0026PackageID=MTU4NDk1ODE=█████████\n```\n\n4. Make the following GET request with the cookie:\n\n```\nGET /████████/Download.aspx?PackageID=15849581\u0026FileName=dog.jpg HTTP/1.1\nHost: ███████\nConnection: close\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nReferer: https://█████/██████████/pickupfiles.aspx?id=15849581\nAccept-Language: en-US,en;q=0.9\nCookie:  pickup=Subject=\u0026PackageID=MTU4NDk1ODE=████\n\n```\n\n5. Observe that the file is returned, demonstrating that it has not been deleted.\n\nThis also has been tested with CAC-enforced files and files that are \"locked\" due to already having been downloaded.\n\n## Impact\n\n.","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["macasun","sa1tama0","krame"],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4152772,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","automated_response":true,"created_at":"2019-02-15T01:56:00.456Z","updated_at":"2019-02-15T01:56:00.456Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4152773,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-02-15T01:56:23.661Z","updated_at":"2020-05-11T16:04:47.516Z","additional_data":{"old_title":"███ - Insecure MAC generation allows bypass of CAC authentication, access to deleted and locked files","new_title":"██████████ - Insecure download cookie generation allows bypass of CAC authentication, access to deleted and locked files"},"actor":{"username":"cablej_dds","cleared":false,"url":"/cablej_dds","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/297/403/7f80f45b8c434ad0da25b685ea053058c6d0a1ce_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4154755,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-02-15T13:10:44.794Z","updated_at":"2019-02-15T13:10:44.794Z","additional_data":{"old_severity":null,"new_severity":"Critical","old_severity_id":null,"new_severity_id":297847},"actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4154756,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2019-02-15T13:10:45.709Z","updated_at":"2019-02-15T13:10:45.709Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4210060,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey ███, system owner is claiming they have remediated this report as well as report #496219.  When you have a free moment can you verify that they have indeed applied a fix?  I'll drop the other report in \"needs more info\" as well.\n\nThanks","automated_response":false,"created_at":"2019-02-25T18:52:52.160Z","updated_at":"2020-05-11T16:06:36.777Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4212128,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @ag3nt-j1 ,\n\nThe patch it seems █████ took is twofold:\n\n1. Replacing SHA256 with SHA512 in signing pickup cookie.\n2. Preventing the same pickup cookie from being used to download a file twice.\n\nThe first change is worrisome. In particular, the necessary change here would be to protect the integrity of these cookies by signing the messages with a server-side key. SHA512 provides zero additional protection compared to SHA256, and it is concerning that the developers implemented this change as a security measure.\n\nThe second change does prevent a user from downloading a file twice with the same key, which counters the second two described bypasses (the first is no longer a security control so cannot be bypassed). With that being said, I am still concerned by how █████ handles encryption on the backend based on this response, and that cannot be fixed without proper source code review.\n\nThanks,\n███","automated_response":false,"created_at":"2019-02-26T00:37:13.384Z","updated_at":"2020-05-11T16:46:37.663Z","actor":{"username":"cablej_dds","cleared":false,"url":"/cablej_dds","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/297/403/7f80f45b8c434ad0da25b685ea053058c6d0a1ce_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4225299,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm going to take a look at FIPS 140-2 and some of the STIG/SRG requirements regarding approved hashing and encryption and see if they are in violation of anything.","automated_response":false,"created_at":"2019-02-27T18:13:22.236Z","updated_at":"2019-02-27T18:13:22.236Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4225770,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Going to put this in \"needs more info\" for a few days while I review requirements.  Hopefully I can pin something on the SHA512 and kick it back.  I","automated_response":false,"created_at":"2019-02-27T19:18:23.993Z","updated_at":"2019-02-27T19:18:23.993Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4424186,"is_internal":false,"editable":false,"type":"Activities::BugInactive","message":"","automated_response":true,"created_at":"2019-03-30T03:05:14.130Z","updated_at":"2019-03-30T03:05:14.130Z","actor":{"username":"hackbot","cleared":false,"url":"/hackbot","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/889/e44ea8512baf3f953a240f75e14deb4e8a5bb6ab_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4433109,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","automated_response":false,"created_at":"2019-04-01T12:47:44.759Z","updated_at":"2019-04-01T12:47:44.759Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4433110,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2019-04-01T12:47:49.163Z","updated_at":"2019-04-01T12:47:49.163Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4944274,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nClosing as resolved, system owner claims fix action is complete and I can't find any restrictions on the use of SHA512...DoD requirements regarding it's use is very much dated. \n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2019-05-28T21:30:46.569Z","updated_at":"2019-05-28T21:30:46.569Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"cablej_dds","url":"/cablej_dds"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6491584,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-07T21:14:06.969Z","updated_at":"2019-12-07T21:14:06.969Z","first_to_agree":true,"actor":{"username":"cablej_dds","cleared":false,"url":"/cablej_dds","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/297/403/7f80f45b8c434ad0da25b685ea053058c6d0a1ce_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6506800,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We will put it in the queue for disclosure.","automated_response":false,"created_at":"2019-12-09T21:12:49.171Z","updated_at":"2019-12-09T21:12:49.171Z","actor":{"username":"agent-r5","cleared":false,"url":"/agent-r5","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7965076,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-05-11T16:47:33.221Z","updated_at":"2020-05-11T16:47:33.221Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7965077,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-05-11T16:47:33.302Z","updated_at":"2020-05-11T16:47:33.302Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7965078,"is_internal":false,"editable":false,"type":"Activities::CommentsClosed","message":"","automated_response":false,"created_at":"2020-05-11T16:47:38.511Z","updated_at":"2020-05-11T16:47:38.511Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}