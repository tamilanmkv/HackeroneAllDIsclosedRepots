{"id":953219,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NTMyMTk=","url":"https://hackerone.com/reports/953219","title":"SMTP interaction theft via MITM","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-08-07T11:29:14.964Z","submitted_at":"2020-08-07T11:29:15.026Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"duesee","url":"/duesee","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15252,"url":"https://hackerone.com/portswigger","handle":"portswigger","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"PortSwigger Web Security","twitter_handle":"Burp_Suite","website":"https://portswigger.net","about":"Burp Suite is the leading software for web security testing"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2011-0411"],"singular_disclosure_disabled":false,"disclosed_at":"2020-11-04T11:31:07.614Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-11-04T10:32:23.350Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"See http://www.postfix.org/CVE-2011-0411.html for adetailled description.\n\n## Impact\n\nMitM could obtain user credentials.","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":939671,"file_name":"buftest.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/4FFsYRUs6nVJXR8FAVpqLmP8?response-content-disposition=attachment%3B%20filename%3D%22buftest.py%22%3B%20filename%2A%3DUTF-8%27%27buftest.py\u0026response-content-type=text%2Fx-python\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ5B5ZLR7W%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154454Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDznwDn3DlLBhpUQR2HsgV%2FXq95UR4rgunTAtaALtJfOwIhAPs6S1Tcddn1VigtqMJZu1ze7EJhUESTAidgv9nNGvTkKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgwZmyQg19q82eNvWTYq1wPVa9iL33aSnxoe9uhB7r2aVM0UjDJv7L7h4wpacx0zTD7Cg8zZaNStfUkAQ4PRdT1iVaYXFqr3oEtcRoGLKhag7I7AYV4CfabHIx%2FljtUdbse7EzqrV%2BLQvKbTG6z1i6zNoig4BjAmqV%2BbJNhSJroBCOPElku0SEqEghibUoxjbjpR4CBXjTIJwAUpnCgLLy91sSgp9KNeTgb1AkQk9PEiYIt%2BjjRn7YHGTo0lsLEhUWc0hsx6VLMRCiSyU6pMLzMGyTS6q7VECFtTn5Z0xG6cXCTKHB3pYQ1zLLYN8ml68bLOIBj9DG3soHxXVeXkifKnxu13VQyp3%2Fs7gxFDt1C7HjJ71usGGrh%2BfYBJJFBMGndfS1DoK%2Bopk8YhA2hlX3szEJmyZfm0KUVaG%2FoWbCJlR3fqXIBJ1cKXRlMooUSiLaTSXt07k2ZqF9w0HUl1IdVQzbNbJBH%2BnkPxpioMdR%2BthDqTyEJ4NZO1WuIxKWGZYyMyXsZaWNopcb1ntUTbg6h9jL8PBR4KRpM%2FHAsw70cht3GV%2BEt83AJHQMRTRifsEIkEWjFR47llnjXkbbepxcng%2ByfEEKZRp237bvaIzCz%2FOBASo1zhQretKmelA0U4%2BEADJwrI3hIwr4yRiwY6pAEjctaIC5qKHFIiVu1bdWXuftBXGyVKZyt2TIP%2B2%2FEEDUKSn7h674C0WnV7bDgpkWP3Jm2QA8%2B4oAW2qew892kEhCJxDwZz%2BXR81EJw6%2FG5A5FZJ8bUl63WLiuBkwA0Dx%2Bf%2FkeTcR6awW4gpgHN5q2%2B02FvrdW8HWnLO9b%2FdddTJiHpMjGB2dteCQWg1L0LIQ%2FyL7kCQpQu%2F5PLB76pfiUetgXbFQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=55f11ad0bcc817a5be57e1e3a810d1fb783771157562a52a0667c95f4b4fb0b9","file_size":11105,"type":"text/x-python"}],"allow_singular_disclosure_at":"2020-12-04T10:32:23.566Z","allow_singular_disclosure_after":-26889150.644820392,"singular_disclosure_allowed":true,"vote_count":73,"voters":["bibekshah","ali","0xelkomy","aryan2808","rahulkadavil_","realtess","yusuf_furkan","3x3s","ro_","f_m","and 63 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":196,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"Burp Collaborator","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8874886,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thanks for your report. An MITM can't obtain user credentials as the collaborator server doesn't require credentials - all it does is receive emails destined to burpcollaborator.net. Also, STARTTLS is useless against an active MITM, so as I understand it this attack doesn't achieve anything that isn't already possible. Can you elaborate on the impact of this issue? ","automated_response":false,"created_at":"2020-08-07T12:35:49.322Z","updated_at":"2020-08-07T12:36:06.419Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8875287,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Sorry for being so unspecific. I do not use Burp Collaborator and have not tested it in detail. I just noted that a bunch of \"Burp Collaborator\" Strings showed up in an Internet-wide scan and wanted to notify you.\n\nSTARTTLS is not useless against active MitM. When STARTTLS is used for submission or for message access, it MUST be enforced, such that STARTTLS stripping does not work. For email relaying this is different and depends on the usage of DANE or MTA-STS.\n\nSo, without knowing what Burp Collaborator is doing, I would still recommend to fix this, as this can be used to bypass STARTTLS security even in the case, where STARTTLS is used in a strict fashion.","automated_response":false,"created_at":"2020-08-07T13:23:01.496Z","updated_at":"2020-08-07T13:23:01.496Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8877010,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the info. We'll need to do a little research to confirm this behavior and identify whether preventing MITM on SMTP interactions is a worthwhile target.","automated_response":false,"created_at":"2020-08-07T16:00:48.839Z","updated_at":"2020-08-07T16:00:48.839Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8986903,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-08-20T09:57:06.605Z","updated_at":"2020-08-20T09:57:06.605Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":811883,"new_severity_id":823700},"actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8986908,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-08-20T09:57:42.797Z","updated_at":"2020-08-20T09:57:42.797Z","additional_data":{"old_title":"SMTP Command Injection via STARTTLS buffering issues","new_title":"SMTP interaction theft via MITM"},"actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8987070,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I've confirmed this behaviour using swaks. The Collaborator has to balance mitigating MITM attacks \n with supporting poorly configured interaction sources, but this one is worth fixing.","automated_response":false,"created_at":"2020-08-20T10:17:09.348Z","updated_at":"2020-08-20T10:17:09.348Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8987237,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Nice to hear! If you are concerned about interoperability: a client doing this violates the protocol. Many SMTP servers might even terminate the connection, so I doubt a fix will cause interoperability issues. It should be enough to clear any remaining data after the TLS transition has finished, e.g. call `buffer.clear()` right after the transition to TLS.","automated_response":false,"created_at":"2020-08-20T10:41:34.015Z","updated_at":"2020-08-20T10:41:34.015Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9246735,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for your report! Based on this, we identified that an active MITM on a collaborator server could potentially obtain the plaintext of STARTTLS encrypted emails sent to it. We have developed a fix and hope to release it shortly, pending some internal testing.","automated_response":false,"created_at":"2020-09-17T14:30:19.295Z","updated_at":"2020-09-17T14:30:19.295Z","actor":{"url":"/portswigger","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"PortSwigger Web Security"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"portswigger","collaborator":{"username":"duesee","url":"/duesee"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9282522,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for the bounty!","automated_response":false,"created_at":"2020-09-21T19:28:13.149Z","updated_at":"2020-09-21T19:28:13.149Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9399944,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We've just released a fix: https://portswigger.net/burp/releases/professional-community-2020-9-2\n\nPlease note that due to the way we patched it, your scanner will probably still flag it as vulnerable.","automated_response":false,"created_at":"2020-10-02T14:57:36.217Z","updated_at":"2020-10-02T14:57:36.217Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"duesee","url":"/duesee"},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9416743,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oh, that is interesting, because the tool should not have false positives. It just looks if a command send via plaintext is answered encryped. So, when your server does not respond to injected commands anymore, it should not be flagged. Can you elaborate?","automated_response":false,"created_at":"2020-10-05T07:47:54.675Z","updated_at":"2020-10-05T07:47:54.675Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9417012,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure. The SMTP implementation is largely 'fake' and designed purely for receiving emails. Previously an attack was possible by injecting a kind of retrieval-key into the plaintext conversation, letting the attacker retrieve the entire conversation. Now, any keys observed prior to the encrypted channel being opened are ignored.","automated_response":false,"created_at":"2020-10-05T08:17:15.900Z","updated_at":"2020-10-05T08:17:15.900Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9417752,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Okay. But still, Burp is answering some plaintext command with TLS-encrypted data, right? I am asking this, because some developers of security scanning tools will incorporate this test, too. Thus, it might be that Burp will show up as vulnerable in these tools in the future, too.","automated_response":false,"created_at":"2020-10-05T09:04:41.170Z","updated_at":"2020-10-05T09:04:41.170Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9722610,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Are you happy for us to disclose this?","automated_response":false,"created_at":"2020-11-04T10:32:23.497Z","updated_at":"2020-11-04T10:32:23.497Z","first_to_agree":true,"actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9723022,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Feel free to disclose this at any time.","automated_response":false,"created_at":"2020-11-04T11:16:46.480Z","updated_at":"2020-11-04T11:16:46.480Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9723090,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah... I didn't saw the \"report's drop-down menu.\" Should I click on disclose now?","automated_response":false,"created_at":"2020-11-04T11:23:53.619Z","updated_at":"2020-11-04T11:24:21.684Z","actor":{"username":"duesee","cleared":false,"url":"/duesee","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9723144,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"It's fine I can do it.","automated_response":false,"created_at":"2020-11-04T11:31:07.526Z","updated_at":"2020-11-04T11:31:07.526Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"portswigger","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":25266,"category":"team","content":"@duesee found it was possible for an active MITM to inject a plaintext collaborator ID and use that to steal collaborator SMTP interactions We patched this in the following release: https://portswigger.net/burp/releases/professional-community-2020-9-2 \n\nThis issue is closely related to CVE-2011-0411, and due to our non-standard SMTP implementation, some vulnerability scanners incorrectly flag the patched server as being vulnerable.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":56414,"username":"albinowax","name":"James Kettle","bio":"@albinowax","cleared":true,"website":"https://skeletonscribe.net/","location":"United Kingdom","created_at":"2016-02-15T11:34:15.992Z","url":"https://hackerone.com/albinowax","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"hacker_resume_enabled":true,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}