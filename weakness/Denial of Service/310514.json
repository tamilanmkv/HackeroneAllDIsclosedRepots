{"id":310514,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTA1MTQ=","url":"https://hackerone.com/reports/310514","title":"Prototype pollution attack (defaults-deep)","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-01-30T15:14:22.664Z","submitted_at":"2018-01-30T15:14:22.664Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"holyvier","url":"/holyvier","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23949,"url":"https://hackerone.com/nodejs-ecosystem","handle":"nodejs-ecosystem","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Node.js third-party modules","twitter_handle":"","website":"https://nodejs.org/en/security/","about":"This program is used to handle vulnerabilities in the Node.js ecosystem."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2018-3723"],"singular_disclosure_disabled":false,"disclosed_at":"2018-02-15T19:26:35.249Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-02-11T17:56:49.034Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"As discussed in #309391, here's the separate report for each of the library. This one is the information for the defaults-deep library.\n\n**Module:**\n\n[https://www.npmjs.com/package/defaults-deep](defaults-deep)\n\n**Summary:**\n\nUtilities function in all the listed modules can be tricked into modifying the prototype of \"Object\" when the attacker control part of the structure passed to these function. This can let an attacker add or modify existing property that will exist on all object.\n\n**Description:**\n\n## Steps To Reproduce:\n\nThe simplest test case to reproduce the issue is the following code snippet. In the code snippet, \"malicious_payload\" would come from an endpoint which accepts JSON data. \n\n\u003e var defaults-deep = require('defaults-deep');\n\u003e var malicious_payload = '{\"\\_\\_proto\\_\\_\":{\"oops\":\"It works !\"}}';\n\u003e \n\u003e var a = {};\n\u003e console.log(\"Before : \" + a.oops);\n\u003e defaults-deep({}, JSON.parse(malicious_payload));\n\u003e console.log(\"After : \" + a.oops);\n\nThis shows that an attacker can add attributes to all existing object on the server. Additional attribute can be used to change the execution code flow or cause error on every subsequent request by replacing \"toString\" or \"valueOf\".\n\n## Impact\n\nThis vulnerability is garanteed to at least obtain denial of service as all the library allow the property \"toString\" and \"valueOf\" to be replaced by a \"String\". This breaks the express module and forces the server to either crash or return a 500 to every subsequent request.\n\nMore complex payload can be crafted to gain remote code execution (see PoC in #309391).\n\n## Supporting Material/References:\n\nIf extra information is needed don't hesitate to ask.\n\n## Impact\n\nVariable. Server crash or the server becoming unable to respond to all request is guaranteed, but more significant impact like remote code execution can be achieved in some cases.","vulnerability_information_html":"\u003cp\u003eAs discussed in \u003ca href=\"/reports/309391\"\u003e#309391\u003c/a\u003e, here\u0026#39;s the separate report for each of the library. This one is the information for the defaults-deep library.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eModule:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e[\u003ca title=\"https://www.npmjs.com/package/defaults-deep%5D(defaults-deep)\" href=\"/redirect?url=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdefaults-deep%255D%28defaults-deep%29\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.npmjs.com/package/defaults-deep%5D(defaults-deep)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eUtilities function in all the listed modules can be tricked into modifying the prototype of \u0026quot;Object\u0026quot; when the attacker control part of the structure passed to these function. This can let an attacker add or modify existing property that will exist on all object.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003eThe simplest test case to reproduce the issue is the following code snippet. In the code snippet, \u0026quot;malicious_payload\u0026quot; would come from an endpoint which accepts JSON data. \u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003evar defaults-deep = require(\u0026#39;defaults-deep\u0026#39;);\u003cbr\u003e\nvar malicious_payload = \u0026#39;{\u0026quot;__proto__\u0026quot;:{\u0026quot;oops\u0026quot;:\u0026quot;It works !\u0026quot;}}\u0026#39;;\u003c/p\u003e\n\n\u003cp\u003evar a = {};\u003cbr\u003e\nconsole.log(\u0026quot;Before : \u0026quot; + a.oops);\u003cbr\u003e\ndefaults-deep({}, JSON.parse(malicious_payload));\u003cbr\u003e\nconsole.log(\u0026quot;After : \u0026quot; + a.oops);\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThis shows that an attacker can add attributes to all existing object on the server. Additional attribute can be used to change the execution code flow or cause error on every subsequent request by replacing \u0026quot;toString\u0026quot; or \u0026quot;valueOf\u0026quot;.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis vulnerability is garanteed to at least obtain denial of service as all the library allow the property \u0026quot;toString\u0026quot; and \u0026quot;valueOf\u0026quot; to be replaced by a \u0026quot;String\u0026quot;. This breaks the express module and forces the server to either crash or return a 500 to every subsequent request.\u003c/p\u003e\n\n\u003cp\u003eMore complex payload can be crafted to gain remote code execution (see PoC in \u003ca href=\"/reports/309391\"\u003e#309391\u003c/a\u003e).\u003c/p\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003eIf extra information is needed don\u0026#39;t hesitate to ask.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eVariable. Server crash or the server becoming unable to respond to all request is guaranteed, but more significant impact like remote code execution can be achieved in some cases.\u003c/p\u003e\n","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-13T17:56:49.100Z","allow_singular_disclosure_after":-88256088.7438989,"singular_disclosure_allowed":true,"vote_count":3,"voters":["bl4de","eveeez","apapedulimu"],"severity":{"rating":"low","score":1.8,"author_type":"Team","metrics":{"attack_vector":"local","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"low"}},"structured_scope":{"databaseId":6067,"asset_type":"SOURCE_CODE","asset_identifier":"defaults-deep","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2331718,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I was able to reproduce the issue (with a change in the variable name). Have you tried to contact the maintainer yet @holyvier ? ","markdown_message":"\u003cp\u003eI was able to reproduce the issue (with a change in the variable name). Have you tried to contact the maintainer yet \u003ca href=\"/holyvier\"\u003e@holyvier\u003c/a\u003e ? \u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-30T19:34:30.395Z","updated_at":"2018-01-30T19:34:30.395Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2348646,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I haven't contacted maintainer for this one.","markdown_message":"\u003cp\u003eI haven\u0026#39;t contacted maintainer for this one.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-04T04:30:26.921Z","updated_at":"2018-02-04T04:30:26.921Z","actor":{"username":"holyvier","cleared":false,"url":"/holyvier","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2359281,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You can add these two the issue (I'm not sure I can do that myself). They told me there's a patch coming. \n\nhttps://www.npmjs.com/~doowb\nhttps://www.npmjs.com/~jonschlinkert","markdown_message":"\u003cp\u003eYou can add these two the issue (I\u0026#39;m not sure I can do that myself). They told me there\u0026#39;s a patch coming. \u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.npmjs.com/~doowb\" href=\"/redirect?url=https%3A%2F%2Fwww.npmjs.com%2F~doowb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.npmjs.com/~doowb\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://www.npmjs.com/~jonschlinkert\" href=\"/redirect?url=https%3A%2F%2Fwww.npmjs.com%2F~jonschlinkert\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.npmjs.com/~jonschlinkert\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T17:04:34.051Z","updated_at":"2018-02-07T17:04:34.051Z","actor":{"username":"holyvier","cleared":false,"url":"/holyvier","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360160,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@holyvier thanks! I just invited them.","markdown_message":"\u003cp\u003e\u003ca href=\"/holyvier\"\u003e@holyvier\u003c/a\u003e thanks! I just invited them.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T19:43:27.729Z","updated_at":"2018-02-07T19:43:27.729Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360227,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T20:04:53.469Z","updated_at":"2018-02-07T20:04:53.469Z","actor":{"username":"doowb","cleared":false,"url":"/doowb","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The patch for this module has been published as 0.2.4.","markdown_message":"\u003cp\u003eThe patch for this module has been published as 0.2.4.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T20:05:16.110Z","updated_at":"2018-02-07T20:05:16.110Z","actor":{"username":"doowb","cleared":false,"url":"/doowb","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360250,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @doowb . I will request a CVE and will publish this report ASAP.","markdown_message":"\u003cp\u003eThanks \u003ca href=\"/doowb\"\u003e@doowb\u003c/a\u003e . I will request a CVE and will publish this report ASAP.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T20:11:09.835Z","updated_at":"2018-02-07T20:11:09.835Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2372999,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"I have requested a CVE for this report. If everyone agree; I'd like to disclose it fully after the CVE is available.","markdown_message":"\u003cp\u003eI have requested a CVE for this report. If everyone agree; I\u0026#39;d like to disclose it fully after the CVE is available.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-11T17:56:35.930Z","updated_at":"2018-02-11T17:56:35.930Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"holyvier","url":"/holyvier"},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373000,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-11T17:56:49.058Z","updated_at":"2018-02-11T17:56:49.058Z","first_to_agree":true,"actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373002,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-11T17:57:34.930Z","updated_at":"2018-02-11T17:57:34.930Z","additional_data":{"added_weaknesses":[{"id":48,"name":"Denial of Service"}],"removed_weaknesses":[]},"actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373004,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-11T17:57:53.231Z","updated_at":"2018-02-11T17:57:53.231Z","additional_data":{"old_severity":null,"new_severity":"Low (1.8)","old_severity_id":null,"new_severity_id":117960},"actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373019,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-11T18:01:33.100Z","updated_at":"2018-02-11T18:01:33.100Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"Other module","new_scope":"defaults-deep","genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373194,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-11T21:36:14.163Z","updated_at":"2018-02-11T21:36:14.163Z","cve_ids":["CVE-2018-3723"],"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2387601,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-15T19:26:35.166Z","updated_at":"2018-02-15T19:26:35.166Z","actor":{"username":"vdeturckheim","cleared":false,"url":"/vdeturckheim","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs-ecosystem","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}