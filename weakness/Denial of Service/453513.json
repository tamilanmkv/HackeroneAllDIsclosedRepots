{"id":453513,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NTM1MTM=","url":"https://hackerone.com/reports/453513","title":"Fix for CVE-2018-12122 can be bypassed via keep-alive requests","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-12-01T10:03:22.018Z","submitted_at":"2018-12-01T10:03:22.018Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mpracucci","url":"/mpracucci","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/423/250/91003a6c4f9278f33f3f9de12379857b8e417389_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22984,"url":"https://hackerone.com/nodejs","handle":"nodejs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Node.js","twitter_handle":"nodejs","website":"https://nodejs.org","about":"The Node.js JavaScript Runtime"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2018-12122"],"singular_disclosure_disabled":false,"disclosed_at":"2020-02-13T23:57:13.092Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-01-14T23:57:12.703Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** Fix for CVE-2018-12122 can be bypassed via keep-alive requests\n\n**Description:**\n\nI'm not a security expert, neither I'm familiar with Node.js core, so please forgive me if this report is inaccurate (and in that case, sorry for your time).\n\nWhile investigating the issue [#515](https://github.com/nodejs/node/issues/24760)I checked out the fix to Fix for CVE-2018-12122 in node 8.14.0 and - according to my tests - the fix can be bypassed using a keep-alive connection.\n\nThe core of the fix is to introduce `headersTimeout`, which is a timeout that destroy the socket if all headers are not received within that timeout. As far as I can see from [this changeset](https://github.com/nodejs/node/commit/696f063c5e), the `parser.parsingHeadersStart` timestamp is set on `connectionListenerInternal()`, reset to zero once the full request headers are received (this is used as a short circuit in `onParserExecute()`) , but it's never set againt to a timestamp once a subsequent request on the same keep-alive connection is received.\n\n## Steps To Reproduce\n\n1. Run an HTTP server and lower `headersTimeout` to 10s for simplicity (faster to test)\n\n```\nconst http = require(\"http\");\n\nconst server = http.createServer((req, res) =\u003e {\n    res.writeHead(200);\n    res.end();\n});\n\nserver.headersTimeout   = 10000;\nserver.keepAliveTimeout = 60000;\n\nserver.listen(4050);\n```\n\n2. Connect with `telnet localhost 4050`\n\n3. Send the first request, typing...\n\n```\nGET / HTTP/1.1\nConnection: keep-alive\n\n```\n\n4. Then, once the server response is received, send only the first line of the subsequent request on the same connection:\n\n```\nGET / HTTP/1.1\n```\n\n5. Wait longer than the headersTimeout and send a second header\n\n```\nHost: localhost\n```\n\n6. Wait more time, if you want send further headers, and finally a newline to signal the end of the headers request. The server will **not** destroy the socket / close the connection after 10s (or whatever `headersTimeout` is set to), but will successfully reply.\n\n## Impact\n\nTo my understanding, it has the same impact of `CVE-2018-12122`, but I may also be terribly wrong.\n\n## Supporting Material/References:\n\nN/A\n\n## Impact\n\nIt may DoS a Node.js application.","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-02-13T23:57:12.795Z","allow_singular_disclosure_after":-52326277.569110185,"singular_disclosure_allowed":true,"vote_count":3,"voters":["zude","mechboy","officialaimm"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":666,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/nodejs/node","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3743844,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report @mpracuci, I'll get some internal discussion happening about this and figure out what, if anything, needs to be done. Will report back here when we have some news.","automated_response":false,"created_at":"2018-12-01T11:06:01.280Z","updated_at":"2018-12-01T11:06:01.280Z","actor":{"username":"rvagg","cleared":false,"url":"/rvagg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3744230,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I can confirm this is happening. I'm working on a fix.","automated_response":false,"created_at":"2018-12-01T15:30:33.932Z","updated_at":"2018-12-01T15:30:33.932Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3896251,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Is there any progress on this? Is the issue still confirmed?","automated_response":false,"created_at":"2018-12-27T13:29:25.079Z","updated_at":"2018-12-27T13:29:25.079Z","actor":{"username":"mpracucci","cleared":false,"url":"/mpracucci","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/423/250/91003a6c4f9278f33f3f9de12379857b8e417389_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3913563,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The issue is confirmed and we have a fix in the works, it'll be part of the next security release.","automated_response":false,"created_at":"2019-01-02T08:04:38.271Z","updated_at":"2019-01-02T08:04:38.271Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4185859,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We are going to issue a CVE soon for this, and it will be part of the security release of next week (soon to be announced.\nHow would you like this to be attributed to you?\n\nSee https://nodejs.org/en/blog/vulnerability/november-2018-security-releases/#hostname-spoofing-in-url-parser-for-javascript-protocol-cve-2018-12123 for an Example.","automated_response":false,"created_at":"2019-02-21T11:09:34.165Z","updated_at":"2019-02-21T11:09:34.165Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4185879,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You can simply write:\nReported by [Marco Pracucci](https://twitter.com/pracucci) ([Voxnest](https://voxnest.com))\n\nThanks for asking.","automated_response":false,"created_at":"2019-02-21T11:17:34.102Z","updated_at":"2019-02-21T11:17:34.102Z","actor":{"username":"mpracucci","cleared":false,"url":"/mpracucci","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/423/250/91003a6c4f9278f33f3f9de12379857b8e417389_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4189317,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Thanks for reporting this vulnerability. Per our current policy this report does not qualify for the bug bounty program, more specifically it is not related to remote code execution.\n\nYour hard work is both appreciated and valued, thank you once again for reporting your findings!","automated_response":false,"created_at":"2019-02-21T23:27:29.212Z","updated_at":"2019-02-21T23:27:29.212Z","actor":{"url":"/nodejs","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Node.js"}},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4307980,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This was fixed in https://nodejs.org/en/blog/vulnerability/february-2019-security-releases/ with CVE-2019-5739.","automated_response":false,"created_at":"2019-03-12T14:01:03.483Z","updated_at":"2019-03-12T14:01:03.483Z","actor":{"username":"mcollina","cleared":false,"url":"/mcollina","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mpracucci","url":"/mpracucci"},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6772420,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-01-14T23:57:12.723Z","updated_at":"2020-01-14T23:57:12.723Z","first_to_agree":true,"actor":{"username":"octetcloud","cleared":false,"url":"/octetcloud","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/210/672/27b2c0c2193cfb366f7889374e7ce71077431f74_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7048921,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-02-13T23:57:13.110Z","updated_at":"2020-02-13T23:57:13.110Z","actor":{"url":"/nodejs","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Node.js"}},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}