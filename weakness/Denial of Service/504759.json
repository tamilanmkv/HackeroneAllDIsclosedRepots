{"id":504759,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDQ3NTk=","url":"https://hackerone.com/reports/504759","title":"Uploading large avatar images cause excessive CPU usage","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2019-03-04T12:10:45.551Z","submitted_at":"2019-03-04T12:10:45.551Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"fancycode","url":"/fancycode","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/523/796/58fc2402b9899410fe2ae4931bd5c1d98d357712_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-06-27T10:34:14.302Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-06-27T10:32:56.744Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"How to reproduce:\n- Create an account on any server running Nextcloud 13 or 14.\n- Open the personal settings.\n- Upload a large image as avatar (tested with a 4032x3024 PNG image of about 14.5 MB).\n- Keep the selected area in the popup and save the avatar.\n- Notice that the avatar area shows the spinner and doesn't show the avatar.\n- One of your php-fpm processes on the server runs with 100% CPU.\n- Reload the browser and the avatar is visible - the php-fpm process is still at 100% CPU.\n- Repeat uploading the image as avatar until all php-fpm processes are at 100% CPU or the server is completely overloaded.\n- This doesn't resolve itself even after a couple of minutes.\n\nThis applies to Nextcloud 13 and 14. The issue is fixed in Nextcloud 15 and the fix should be backported to all supported versions of Nextcloud.\n\nThe cause for the issue is the 3rdparty VCard code that splits the property values at 75 characters, the fix for Nextcloud 15 is here:\nhttps://github.com/nextcloud/3rdparty/commit/085494c2ad5c3757f9f1c11945f786d63fb2d40f#diff-0d23de9452f6235135a046b1011b5c30\n\n## Impact\n\nAn attacker could completely overload a server, cause it to stop responding to any more requests.","vulnerability_information_html":"\u003cp\u003eHow to reproduce:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCreate an account on any server running Nextcloud 13 or 14.\u003c/li\u003e\n\u003cli\u003eOpen the personal settings.\u003c/li\u003e\n\u003cli\u003eUpload a large image as avatar (tested with a 4032x3024 PNG image of about 14.5 MB).\u003c/li\u003e\n\u003cli\u003eKeep the selected area in the popup and save the avatar.\u003c/li\u003e\n\u003cli\u003eNotice that the avatar area shows the spinner and doesn\u0026#39;t show the avatar.\u003c/li\u003e\n\u003cli\u003eOne of your php-fpm processes on the server runs with 100% CPU.\u003c/li\u003e\n\u003cli\u003eReload the browser and the avatar is visible - the php-fpm process is still at 100% CPU.\u003c/li\u003e\n\u003cli\u003eRepeat uploading the image as avatar until all php-fpm processes are at 100% CPU or the server is completely overloaded.\u003c/li\u003e\n\u003cli\u003eThis doesn\u0026#39;t resolve itself even after a couple of minutes.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis applies to Nextcloud 13 and 14. The issue is fixed in Nextcloud 15 and the fix should be backported to all supported versions of Nextcloud.\u003c/p\u003e\n\n\u003cp\u003eThe cause for the issue is the 3rdparty VCard code that splits the property values at 75 characters, the fix for Nextcloud 15 is here:\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/3rdparty/commit/085494c2ad5c3757f9f1c11945f786d63fb2d40f#diff-0d23de9452f6235135a046b1011b5c30\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2F3rdparty%2Fcommit%2F085494c2ad5c3757f9f1c11945f786d63fb2d40f%23diff-0d23de9452f6235135a046b1011b5c30\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/3rdparty/commit/085494c2ad5c3757f9f1c11945f786d63fb2d40f#diff-0d23de9452f6235135a046b1011b5c30\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker could completely overload a server, cause it to stop responding to any more requests.\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-07-27T10:32:56.935Z","allow_singular_disclosure_after":-44998654.35175154,"singular_disclosure_allowed":true,"vote_count":8,"voters":["mygf","cr4xerbik4sh","tems","cryptographer","armansameer","reformedaccountant","rookiemaster","lnm3000"],"structured_scope":{"databaseId":61,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/3rdparty","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4252208,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2019-03-04T12:10:45.905Z","updated_at":"2019-03-04T12:10:45.905Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4252315,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Maybe we should backport https://github.com/nextcloud/3rdparty/pull/176 to stable14?","markdown_message":"\u003cp\u003eMaybe we should backport \u003ca title=\"https://github.com/nextcloud/3rdparty/pull/176\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2F3rdparty%2Fpull%2F176\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/3rdparty/pull/176\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to stable14?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-03-04T12:42:28.094Z","updated_at":"2019-03-04T12:42:28.094Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4252318,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-03-04T12:42:43.484Z","updated_at":"2019-03-04T12:42:43.484Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4485704,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update on this?","markdown_message":"\u003cp\u003eAny update on this?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-05T08:04:39.914Z","updated_at":"2019-04-05T08:04:39.914Z","actor":{"username":"fancycode","cleared":false,"url":"/fancycode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/523/796/58fc2402b9899410fe2ae4931bd5c1d98d357712_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4542256,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nSorry for the delay here.\nThe PR that should (tm) fix it is in https://github.com/nextcloud/server/pull/15070 \n\nCheers,\n--Roeland","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eSorry for the delay here.\u003cbr\u003e\nThe PR that should (tm) fix it is in \u003ca title=\"https://github.com/nextcloud/server/pull/15070\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fserver%2Fpull%2F15070\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/server/pull/15070\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\n--Roeland\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-11T18:54:34.280Z","updated_at":"2019-04-11T18:54:34.280Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5205085,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again.","markdown_message":"\u003cp\u003eThanks a lot for your report again.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-27T10:30:52.665Z","updated_at":"2019-06-27T10:30:52.665Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"fancycode","url":"/fancycode"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5205092,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T10:32:48.139Z","updated_at":"2019-06-27T10:32:48.139Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"fancycode","url":"/fancycode"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5205094,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T10:32:56.820Z","updated_at":"2019-06-27T10:32:56.820Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5205098,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T10:34:14.235Z","updated_at":"2019-06-27T10:34:14.235Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}