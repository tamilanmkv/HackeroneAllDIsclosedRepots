{"id":1010835,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDEwODM1","url":"https://hackerone.com/reports/1010835","title":"Low Privileged Staff Member Can Export Billing Charges","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-10-18T03:35:59.056Z","submitted_at":"2020-10-18T03:35:59.203Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ash_nz","url":"/ash_nz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-11-26T20:23:41.366Z","bug_reporter_agreed_on_going_public_at":"2020-11-26T20:23:41.316Z","team_member_agreed_on_going_public_at":"2020-11-19T19:15:37.579Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Details\nI'm not 100% sure about this because i don't have billing transactions on my account. However, from my experience on how Shopify backend respond, i think this is a valid finding just need confirmation from Shopify's security team.\nA GraphQL mutation `billingChargesExport` can be used by a staff member with no permissions to export billing charges. The following is a sample request.\n\n```http\nPOST /admin/internal/web/graphql/core HTTP/1.1\nCookie: [REDACTED]\naccept: application/json\nX-CSRF-Token: [REDACTED]\nContent-Type: application/json\nUser-Agent: PostmanRuntime/7.26.5\nHost: [YOUR-SHOP].myshopify.com\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 303\n\n{\"query\":\"\\r\\n        \\r\\nmutation BillingChargesExport($id:ID!,$exportFormat:ExportFormat){billingChargesExport(id:$id,exportFormat:$exportFormat){message userErrors{field message __typename}__typename}}\\r\\n\",\"variables\":{\n\"id\": \"gid://shopify/BillingInvoice/58138130\",\n\"exportFormat\":\"EXCEL_CSV\"\n}}\n```\nThe response i've got is the following.\n\n```json\n\n{\n    \"data\": {\n        \"billingChargesExport\": {\n            \"__typename\": \"BillingChargesExportPayload\", \n            \"message\": null, \n            \"userErrors\": [\n                {\n                    \"__typename\": \"UserError\", \n                    \"message\": \"Not found\", \n                    \"field\": null\n                }\n            ]\n        }\n    }, \n    \"extensions\": {\n        \"cost\": {\n            \"requestedQueryCost\": 10, \n            \"throttleStatus\": {\n                \"restoreRate\": 250.0, \n                \"currentlyAvailable\": 4990, \n                \"maximumAvailable\": 5000.0\n            }, \n            \"actualQueryCost\": 10\n        }\n    }\n}\n```\n\nI usually get `access denied` or something that indicates a privilege issue. However in this case i'm getting `Not found` which indicate that the resolver searched for the given `BillingInvoice` but could not find it. I can't confirm this from my side, hence reporting this.\n\n## Impact\n\nLow Privileged Staff Member Can Export Billing Charges","bounty_amount":"1900.0","formatted_bounty":"$1,900","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":19,"voters":["xploiterr","drsniper","mattberg","kunal94","brdoors3","h4x0r_dz","h13-","rutvik7745","j3mm4","sachidos","and 9 more..."],"severity":{"rating":"medium","score":4.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9596151,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi team, just checking if there is an update on this one.","automated_response":false,"created_at":"2020-10-21T19:42:03.358Z","updated_at":"2020-10-21T19:42:03.358Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9614931,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report! We were able to reproduce the issue and our engineering team is working on a fix.","automated_response":false,"created_at":"2020-10-23T15:48:13.107Z","updated_at":"2020-10-23T15:48:13.107Z","actor":{"username":"abdulwahaab_ahmed","cleared":false,"url":"/abdulwahaab_ahmed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/726/fa53e0dd37718653edc8e2abea4724f3d0af03e9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9616062,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I always test if I can view other shops resources. In this case, check if I can export other shops billing charges. But I could not because I don’t have any billing charges for any of my accounts.\nWas it possible to do that when investigating this finding? ","automated_response":false,"created_at":"2020-10-23T16:29:05.062Z","updated_at":"2020-10-23T16:29:05.062Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9649764,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @ash_nz,\n\nThank you for your report. Our engineering team recently deployed a fix for this issue and it should no longer be reproducible. For this reason, we are closing the report as resolved. We’ll be in touch soon regarding a bounty decision.\n\nThanks again for your time and effort.","automated_response":false,"created_at":"2020-10-27T15:44:47.021Z","updated_at":"2020-10-27T15:44:47.021Z","actor":{"username":"abdulwahaab_ahmed","cleared":false,"url":"/abdulwahaab_ahmed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/726/fa53e0dd37718653edc8e2abea4724f3d0af03e9_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ash_nz","url":"/ash_nz"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9651074,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @ash_nz,\n\nThanks again for your report! During our investigation, we found that this query could be used to export shop billing information. For this reason, we’re awarding a $1900 bounty for this issue. Please find below our rationale generated using our [CVSS calculator](https://shopify.github.io/appsec/cvss_calculator/).\n\n## Base Score CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N 4.3\n## Environment: Core\n\n#### Attack Complexity: L\n* Specific conditions to exploit?: No\n\n#### Privileges Required: L\n* Requires privileged account (not self-registered)?: Yes\n* Does the attacker need extensive permissions?: No\n\n#### User Interaction: N\n* Requires victim to perform some action during exploit?: No\n\n#### Scope: U\n* Can the attacker impact a separate service?: No\n\n#### Confidentiality: L\n* How much data could be accessed?: Some\n* How much of Shopify is impacted?: Most or All\n\n#### Integrity: N\n* How much data could be changed?: None\n\n#### Availability: N\n* Level of disruption to network service?: None\n","automated_response":false,"created_at":"2020-10-27T17:39:02.378Z","updated_at":"2020-10-27T17:39:02.378Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"1900.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"ash_nz","url":"/ash_nz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9871568,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-19T19:15:37.602Z","updated_at":"2020-11-19T19:15:37.602Z","first_to_agree":true,"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9937500,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-26T20:23:41.335Z","updated_at":"2020-11-26T20:23:41.335Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9937501,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-26T20:23:41.389Z","updated_at":"2020-11-26T20:23:41.389Z","actor":{"username":"ash_nz","cleared":false,"url":"/ash_nz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QkvsUwLu3hoeUg5dKxPjdSei/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":25522,"category":"team","content":"@ash_nz reported an issue where a staff member without explicit permissions on a shop would be able to export a limited summary of charges made to that shop's billing account by Shopify and Shopify apps. ","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":164342,"username":"jack_mccracken","name":"Jack McCracken","bio":"","cleared":false,"website":null,"location":"","created_at":"2017-05-01T15:33:44.372Z","url":"https://hackerone.com/jack_mccracken","anc_triager":false,"hackerone_triager":false,"hackerone_employee":null,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}