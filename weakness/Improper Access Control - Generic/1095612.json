{"id":1095612,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDk1NjEy","url":"https://hackerone.com/reports/1095612","title":"Node Validation Admission does not observe all oldObject fields","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2021-02-04T16:40:22.095Z","submitted_at":"2021-02-04T16:40:22.115Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ariellima","url":"/ariellima","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":39386,"url":"https://hackerone.com/kubernetes","handle":"kubernetes","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kubernetes","twitter_handle":"kubernetesio","website":"https://kubernetes.io/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":true,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-09-05T23:17:03.481Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-08-06T23:16:50.516Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nThe Validating Admission webhook for Node Objects is passing oldObject fields incorrectly on AdmissionReview.Request. It was identified initially in metadata.labels, but a list of impacted fields follows below:\n \noldNode.Spec.PodCIDRs\noldNode.Spec.ProviderID\noldNode.Spec.ConfigSource\noldNode.Status.Config\noldNode.ObjectMeta\noldNode.Status.Capacity\noldNode.Spec.Unschedulable\noldNode.Status\noldNode.Spec.Taints\n\nThose fields are being set with the same values as the new node object, potentially allowing users to bypass validating admission to update node labels, taints, and others.\n\n## Kubernetes Version:\nv1.19.x\n\n## Component Version:\nValidation Webhook for Nodes\n\n## Steps To Reproduce:\n\n1. Create a Validating Webhook Configuration for Node updates\n2. Create an admission Webhook that outputs the content of oldNode and newNode from the admissionReview obejct\n3. Run a patch that changes one of the fields mentioned above.\n4. Look at the log output and compare the old and newObject CRs -- you will notice that the patch you just made appears on the new AND oldObject CRs logged.\n\n## Supporting Material/References:\nValidating Webhook we created -\u003e https://github.com/ArielLima/managed-cluster-validating-webhooks/blob/nodelabels-webhook/pkg/webhooks/node/node.go#L145-L179\n\nDummy Validating Webhook -\u003e https://github.com/openshift/generic-admission-server/pull/40/files#diff-ce34cccb3b86fc2740015cfa93de7e314262e3db76d54708d5e1c302e6986436R39\n\nPotential issue location -\u003e https://github.com/kubernetes/kubernetes/blob/c970a46bc1bcc100bbbfabd5c12bd4c5d87f8aea/pkg/apis/core/validation/validation.go#L4792-L4794\n\n## Impact\n\nEven though a validating admission webhook thinks that it is restricting actors from mutating certain fields like taints, labels, and schedulability it is not.  \nSome examples of actions you could perform:\n1. change labels to steer workloads\n2. change labels to prevent scheduling any workload\n3. change taints to push pods off a node","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-09-05T23:16:50.647Z","allow_singular_disclosure_after":-3074847.192983316,"singular_disclosure_allowed":true,"vote_count":11,"voters":["ali","demonia","khizer47","akashhamal0x01","cryptographer","meispi","z4yn1","maharanirach","iankit","kybernetes","and 1 more..."],"severity":{"rating":"medium","score":6.5,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":32503,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/kubernetes/apiserver","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":10578486,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorInvited","message":null,"automated_response":false,"created_at":"2021-02-04T16:42:26.559Z","updated_at":"2021-02-04T16:42:26.559Z","actor":{"username":"ariellima","cleared":false,"url":"/ariellima","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"email":"ro************om","genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10578550,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorJoined","message":"","automated_response":false,"created_at":"2021-02-04T16:48:37.277Z","updated_at":"2021-02-04T16:48:37.277Z","actor":{"username":"rogbas","cleared":false,"url":"/rogbas","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10578581,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2021-02-04T16:52:27.699Z","updated_at":"2021-02-04T16:52:27.699Z","additional_data":{"old_severity":null,"new_severity":"Medium (6.5)","old_severity_id":null,"new_severity_id":977121},"actor":{"username":"tallclair","cleared":false,"url":"/tallclair","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/418/594/6bbb78252759e1d1c1d67be48b7d7470926730de_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10583631,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @ariellima and thanks for your report,\n\nKubernetes has already validated the report and it is handling it internally.\n\nBest regards,\n@turtle_shell","automated_response":false,"created_at":"2021-02-05T08:39:21.705Z","updated_at":"2021-02-05T08:39:21.705Z","actor":{"username":"turtle_shell","cleared":false,"url":"/turtle_shell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/UEHxCfDVKTBNymNpNGb7qwy6/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":11214778,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-04-01T17:54:36.907Z","updated_at":"2021-04-01T17:54:36.907Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"bounty_amount":"333.33","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kubernetes","collaborator":{"username":"rogbas","url":"/rogbas"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11214779,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-04-01T17:54:37.169Z","updated_at":"2021-04-01T17:54:37.169Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"bounty_amount":"666.67","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kubernetes","collaborator":{"username":"ariellima","url":"/ariellima"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12866007,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This was resolved as CVE-2021-25735.","automated_response":false,"created_at":"2021-08-06T23:16:27.273Z","updated_at":"2021-08-06T23:16:27.273Z","actor":{"username":"tallclair","cleared":false,"url":"/tallclair","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/418/594/6bbb78252759e1d1c1d67be48b7d7470926730de_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ariellima","url":"/ariellima"},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12866010,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-06T23:16:50.542Z","updated_at":"2021-08-06T23:16:50.542Z","first_to_agree":true,"actor":{"username":"tallclair","cleared":false,"url":"/tallclair","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/418/594/6bbb78252759e1d1c1d67be48b7d7470926730de_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":13327622,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-09-05T23:17:03.538Z","updated_at":"2021-09-05T23:17:03.538Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}