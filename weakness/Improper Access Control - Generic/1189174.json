{"id":1189174,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTg5MTc0","url":"https://hackerone.com/reports/1189174","title":"End to end encryption folder locking is not properly protected","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2021-05-08T19:53:39.481Z","submitted_at":"2021-05-08T19:53:39.586Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rtod","url":"/rtod","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2021-22906"],"singular_disclosure_disabled":false,"disclosed_at":"2021-06-10T11:45:03.623Z","bug_reporter_agreed_on_going_public_at":"2021-05-11T11:44:56.435Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I do not see the end_to_end_encryption app listed here. But since you advertise it big on your website and in communication. And the clients (that also support it are covered) I assume this is part of the program as well.\n\n1. userA has end to end encryption setup\n2. userB wants to annoy userA\n3. userB starts to send curl request like\n\n```bash\ncurl -u user1:user -X POST https://SERVER/ocs/v2.php/apps/end_to_end_encryption/api/v1/lock/332 -X POST  -H 'OCS-APIREQUEST: true' -H 'user-agent: Mozilla/5.0 (Android) Nextcloud-android/3.13.1'\n```\n\nHere 332 is a fileid. But it can be any fileid.\n\n4. If userB just keeps looping they can just lock all fileids. Limiting any other user from interacting with their encrypted folders.\n\n## Impact\n\nuserB in this case can avoid userA from interacting with their encrypted data. Effectively locking them out of adding new data.\n\nNow admitted they do not know which file id the encrypted folder of userA is. But a small script can lock a lot of ids very quickly. And the job to fix this only runs once an hour and clears max 25. So I'm relatively sure that userB has a big advantage here.\n\nRecommendations:\n\n1. While locking there should also be checks (like with unlocking) if the user has access\n2. There should be throttling on those endpoints esp if users try to lock things they have no access to","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-06-10T11:44:56.506Z","allow_singular_disclosure_after":-10633555.534662982,"singular_disclosure_allowed":true,"vote_count":6,"voters":["wi11","ali","sandip5x05","meispi","kavinmano","ekgaribadmi"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":70612,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/end_to_end_encryption","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11672138,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2021-05-08T19:53:40.047Z","updated_at":"2021-05-08T19:53:40.047Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11678760,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the report.\nAlso here an issue is filled and we'll get back to you once we have more information.","automated_response":false,"created_at":"2021-05-10T06:51:17.500Z","updated_at":"2021-05-10T06:51:17.500Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11680959,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We could verify the issue.\nA fix got merged in https://github.com/nextcloud/end_to_end_encryption/pull/237 and backported as well.\nWe are preparing new releases for this.","automated_response":false,"created_at":"2021-05-10T10:02:19.779Z","updated_at":"2021-05-10T10:02:19.779Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11683153,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Congratulations! We have determined this to be eligible for a reward of $250.\n\nThanks a lot for making the internet a safer place and keep hacking. Please do not share this information with any third-parties yet until the advisories are out.","automated_response":false,"created_at":"2021-05-10T12:35:47.210Z","updated_at":"2021-05-10T12:35:47.210Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"rtod","url":"/rtod"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11683162,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in the latest app releases and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","automated_response":false,"created_at":"2021-05-10T12:36:27.683Z","updated_at":"2021-05-10T12:36:27.683Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"rtod","url":"/rtod"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11683199,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks again for the bounty!\nQuick fix and seems to do the trick.\n\nCrediting again:\n\nName: rtod\nEmail: robottod@protonmail.com","automated_response":false,"created_at":"2021-05-10T12:40:17.831Z","updated_at":"2021-05-10T12:40:17.831Z","actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11686997,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2021-05-10T15:22:01.601Z","updated_at":"2021-05-10T15:22:01.601Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"nextcloud/server","new_scope":"nextcloud/end_to_end_encryption","genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11687042,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2021-05-10T15:24:29.753Z","updated_at":"2021-05-10T15:24:29.753Z","cve_ids":["CVE-2021-22906"],"actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11697361,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-11T11:44:56.465Z","updated_at":"2021-05-11T11:44:56.465Z","first_to_agree":true,"actor":{"username":"rtod","cleared":false,"url":"/rtod","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11950841,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Advisory at https://github.com/nextcloud/security-advisories/security/advisories/GHSA-3829-45wm-ww36","automated_response":false,"created_at":"2021-06-01T18:09:38.498Z","updated_at":"2021-06-01T18:09:38.498Z","actor":{"username":"lukasreschkenc","cleared":false,"url":"/lukasreschkenc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12050962,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-06-10T11:45:03.676Z","updated_at":"2021-06-10T11:45:03.676Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}