{"id":1218680,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjE4Njgw","url":"https://hackerone.com/reports/1218680","title":"Improper authorization on `/api/as/v1/credentials/` for  Dev Role User with Limited Engine Access","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2021-06-06T19:56:04.176Z","submitted_at":"2021-06-06T19:56:04.315Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"superman85","url":"/superman85","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23607,"url":"https://hackerone.com/elastic","handle":"elastic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Elastic","twitter_handle":null,"website":"https://www.elastic.co/","about":null}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":true,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-08-03T17:12:41.321Z","bug_reporter_agreed_on_going_public_at":"2021-08-03T15:05:20.241Z","team_member_agreed_on_going_public_at":"2021-08-03T17:12:41.112Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nDear Team,\n\nSince  #1168528 was resolved. I have checking again for other roles. At Dev Role with Limited Engine Access, an user still can access API endpoint \n`/api/as/v1/credentials/` to get all API keys (private-key, search-key ... )\n\n## Steps To Reproduce:\n\n1 - Log in Kibana with the admin (elastic) user and go to the Stack Management \u003e Users page (/app/management/security/users/)\n2 - Choose an username , password and role for this user. For example you can choose username: **dev**\n3 - Log in App Search with the admin (elastic) user and go to the Users \u0026 roles page (/as#/role-mappings/)\n4 - Click Add mapping\n5 - External Attribute choose **username** , in the Attribute value field enter **dev**\n6 - In the Role box select Dev\n7 - In Engine Access select Limited Engine Access, no need to select any engine\n8 - Login to App Search with user **dev**\n9 - Go to endpoint https://your_app_search_instance/api/as/v1/credentials/\n10 - You still can get all api keys \n\nI have attached video PoC\n█████████\n\n## Impact\n\nPrivilege escalation. The default App Search install has a Private API Key with read/write access to all engines. If a Private Admin Key has been created before. the attacker can use it to create new API keys or delete existing ones.\n\nWith Limited Engine Acess, an user should create and managed their own api keys","bounty_amount":"3800.0","formatted_bounty":"$3,800","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-09-02T15:05:20.363Z","allow_singular_disclosure_after":-3364059.756308614,"singular_disclosure_allowed":true,"vote_count":10,"voters":["run_win","drsniper","haxor31337","akashhamal0x01","anuj_manav","2001806","rajat_s","ajit10","merlin_sec01","thisisan"],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":4424,"asset_type":"URL","asset_identifier":"cloud.elastic.co","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":12000166,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorInvited","message":null,"automated_response":false,"created_at":"2021-06-06T20:00:41.063Z","updated_at":"2021-06-06T20:00:41.063Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"email":"dee-see","genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12000167,"is_internal":false,"editable":false,"type":"Activities::ReportCollaboratorJoined","message":"","automated_response":false,"created_at":"2021-06-06T20:01:49.497Z","updated_at":"2021-06-06T20:01:49.497Z","actor":{"username":"dee-see","cleared":true,"url":"/dee-see","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/220/115/9a655d51cb400a5743966e9856918ed02ee8d042_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12008731,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Additional Impact: \n-------------------\nAPI keys with full read/write access to all engines, Dev role user with limited access engine can create Meta Engine via API \nhttps://www.elastic.co/guide/en/app-search/current/meta-engines-guide.html\n```\nCreating Meta Engines in the UI\nYou must have the \"Admin\" or \"Owner\" role to create a Meta Engine.\n```","automated_response":false,"created_at":"2021-06-07T14:17:49.884Z","updated_at":"2021-06-07T14:17:49.884Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12025434,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks @superman85 \u0026 @dee-see !\n\nDiscussing the severity internally and I should be able to get back to you shortly","automated_response":false,"created_at":"2021-06-08T17:07:19.429Z","updated_at":"2021-06-08T17:07:19.429Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12025438,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @superman85,\n\nThank you for your submission. I hope you are well. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nHave a great day! \n\nKind regards,\n@orangeband","automated_response":false,"created_at":"2021-06-08T17:07:27.560Z","updated_at":"2021-06-08T17:07:27.560Z","actor":{"username":"orangeband","cleared":false,"url":"/orangeband","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/390/540/b55c564a8a6f8099d28ea9afa41d197ad0031fc3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":12086158,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@douglas_day Any updates on this case and #1218685\n\nThanks","automated_response":false,"created_at":"2021-06-14T09:52:01.852Z","updated_at":"2021-06-14T09:52:01.852Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12094280,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks @superman85 !","automated_response":false,"created_at":"2021-06-14T18:13:29.039Z","updated_at":"2021-06-14T18:13:29.039Z","actor":{"url":"/elastic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Elastic"}},"bounty_amount":"2800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"elastic","collaborator":{"username":"superman85","url":"/superman85"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12094281,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks @superman85 !","automated_response":false,"created_at":"2021-06-14T18:13:29.329Z","updated_at":"2021-06-14T18:13:29.329Z","actor":{"url":"/elastic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Elastic"}},"bounty_amount":"700.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"elastic","collaborator":{"username":"dee-see","url":"/dee-see"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12096439,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you so much for the bounty! It will helped me a lot!","automated_response":false,"created_at":"2021-06-14T23:01:37.733Z","updated_at":"2021-06-14T23:01:37.733Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12147916,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @superman85 !\n\nSomething we like to do at Elastic is use neat bugs from our Bug bounty program as training material for our developers. If you are able to make a short video presentation about your bug, I'd love to award you a couple hundred dollars as a bonus :) I would just need a 5-10 minute video where you talk about:\n\n- Who you are\n- How you like to hack on Elastic\n- What your bug is\n- How you found the bug\n- How developers can avoid making similar bugs in the future\n\nIs this something you think you could do for us? :) ","automated_response":false,"created_at":"2021-06-16T22:12:31.497Z","updated_at":"2021-06-16T22:12:31.497Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12148518,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @douglas_day Thank you for your proposal. I will try to create video when I came back home today. I hope it will not terrible hehe","automated_response":false,"created_at":"2021-06-17T00:46:35.641Z","updated_at":"2021-06-17T00:46:35.641Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12158960,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@douglas_day I need to prepare some things before making a video. I will update information soon, sorry for the delay!","automated_response":false,"created_at":"2021-06-17T17:37:27.140Z","updated_at":"2021-06-17T17:37:27.140Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12165500,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @douglas_day I have finished record a 5 minutes talk  \n██████\nPlease take a look and let me know :)","automated_response":false,"created_at":"2021-06-18T11:47:11.367Z","updated_at":"2021-08-03T17:11:58.914Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12167761,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is perfect @superman85 !\n\nThan you for helping us out :) \n\nBefore I award you the bonus, I wanted to see if you wanted to change the bounty splitting with @dee-see so that you get the whole bonus.\n\nOnce you are ready, let me know and I'll award you your bonus!","automated_response":false,"created_at":"2021-06-18T15:48:38.301Z","updated_at":"2021-06-18T15:48:58.179Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12167821,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@douglas_day I have adjusted the bounty splitting. Thank you for the bonus!\n@dee-see Sorry I can not set bounty weight to 0, so you will get a small money","automated_response":false,"created_at":"2021-06-18T15:55:47.306Z","updated_at":"2021-06-18T15:55:47.306Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12167973,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping our training program @superman85 !","automated_response":false,"created_at":"2021-06-18T16:14:51.367Z","updated_at":"2021-06-18T16:14:51.367Z","actor":{"url":"/elastic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Elastic"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"297.0","genius_execution_id":null,"team_handle":"elastic","collaborator":{"username":"superman85","url":"/superman85"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12167974,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping our training program @superman85 !","automated_response":false,"created_at":"2021-06-18T16:14:51.663Z","updated_at":"2021-06-18T16:14:51.663Z","actor":{"url":"/elastic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Elastic"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"3.0","genius_execution_id":null,"team_handle":"elastic","collaborator":{"username":"dee-see","url":"/dee-see"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12457381,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is fixed in 7.14","automated_response":false,"created_at":"2021-07-12T18:10:28.110Z","updated_at":"2021-07-12T18:10:28.110Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"superman85","url":"/superman85"},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12805695,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Since the report was resolved. Lets disclose it, please redact my video training. Thanks","automated_response":false,"created_at":"2021-08-03T15:05:01.109Z","updated_at":"2021-08-03T15:05:01.109Z","actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12805699,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-08-03T15:05:20.288Z","updated_at":"2021-08-03T15:05:20.288Z","first_to_agree":true,"actor":{"username":"superman85","cleared":true,"url":"/superman85","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/195/266/689df0e92434c83759c57b6e0e68e7530d986c15_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":12808715,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I've made your video Internal Only - so only you and the Elastic team can view it.","automated_response":false,"created_at":"2021-08-03T17:12:41.146Z","updated_at":"2021-08-03T17:12:41.146Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":12808716,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-08-03T17:12:41.382Z","updated_at":"2021-08-03T17:12:41.382Z","actor":{"username":"douglas_day","cleared":false,"url":"/douglas_day","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1ALNLRqrFXt23SDSBvAqPZAH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"elastic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}