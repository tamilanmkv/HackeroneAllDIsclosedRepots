{"id":708820,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MDg4MjA=","url":"https://hackerone.com/reports/708820","title":"Group search with Elastic search enable leaks unrelated data","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-10-07T09:11:08.570Z","submitted_at":"2019-10-07T09:11:08.570Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rpadovani","url":"/rpadovani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-14T11:25:39.733Z","bug_reporter_agreed_on_going_public_at":"2019-12-14T11:25:39.656Z","team_member_agreed_on_going_public_at":"2019-12-13T13:52:50.298Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nPerforming a group search when Elastic Search is enabled provides access to unrelated merge requests, issues activity, leaking the existence of private groups, plus their activity and MRs.\nThis happens both on the GUI and with the APIs \n\n### Steps to reproduce\n\nLet's take this search on the Gitlab group: https://gitlab.com/search?utf8=%E2%9C%93\u0026snippets=\u0026scope=merge_requests\u0026repository_ref=\u0026search=%21435\u0026group_id=9970\n\nIf you go at the end of the page, you see 5 MRs from other groups that should be private - I have no idea what are those projects - I have no relation to them, and I have no access to the group they belong to! (See attached screenshot).\n\nA lot more data can be retrieved through the APIs, now revealing existence of groups/projects I shouldn't know they exist!\n\nI haven't fully understand the logic of the issue, but basically every combination of ! followed by numbers (I had hits with !709, !999) leaks MRs from other groups.\n\nWhile on the UI doesn't show much info, the APIs retrieve a lot of data.\n\nIt also leaks private activity on public issues.\n\nIf you search for `nextbit`, [link](https://gitlab.com/search?utf8=%E2%9C%93\u0026snippets=\u0026scope=notes\u0026repository_ref=\u0026search=nextbit\u0026group_id=9970), you see that my main account has linked a private issue to a public issue. The activity should be private, and indeed it is not reported inside the issue itself, but it is reported in the search.\n\n### Impact\n\nLeaking existence of private groups, private issues activity, private MRs, with lot of metadata\n\n## Impact\n\nLeak of private MRs with metadata, activity of private issues, leak existence of private groups","bounty_amount":"7000.0","formatted_bounty":"$7,000","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":601330,"file_name":"Screenshot_2019-10-04__435___Search.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/JoNm2TytLg7AxrZoKNViyfUw?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2019-10-04__435___Search.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2019-10-04__435___Search.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXEQ3VCGF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151918Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCNbr25hK1JC2i73IX5uE08m1agZwA%2BCyxTPtXmxpZHFAIgA9v21iU9rOtKWjxfMHo7kqQOL4Y8ABbAnucRVLpaC9cqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDOyim%2FBwzSkIWBPCWirXA1TUfPlTIAz6iDfoaiiMP8hivTDD8uDyRJ%2FoAF5UW%2F6cSrWHj2Mtt%2Fx8tKTYSGoQiyhUdi%2BFdxLY35ZRGqE5k10GcpBa5q9ivBUHzTLtIbzvkVLjo0GDs33RjPyv8lT8%2BIT3cR1GpHz5sKugzk1wJHpaXHIGV7TsNZTez5PsxRWLAbodD46%2Bv0aY9dXICvo8Bld1OIiDoUsI3sX2R7SAEjL0B45opfmY7Hh4KKVF9KyCf7etmcGEL0U%2Bjij5TfmuHRxoVJXFKR4WbBKoHXN3cL5AQhAkGBE5bmE6cTsvfhMkCltMfmR1OmQtt1QK7fs2YWSyJhNNnjgzseVzroJk8qcktNvGQQNtmAz%2F0hi%2BbLDdR3r35MBTZtRPxGxwfYKfk%2Blyikhar%2F%2FfPxr6sJoQhbcKSjiziR8cFwFPC97f3qfgH6sVJVvH5AClhLDj9FMqequ01uI1FMQI%2BQ1BJ1t%2Bl3dX7D09OZCMRrk3HvidiN7al4fmx5e0pKMz7tbb23gSzvgiMJbXeHgATiARA8dz6JIoLosFubesB7ZLWq9owsMVaP42CuihB%2Br9J9vu1HkgY4lcWvgRt8bqCjXjWDPBzlNcnc9D32bMJUDfp2BWdJ0BCnpEi4XjrDCyiJGLBjqlAbw%2BQzzkBo5pgpwg2B9K3Kb9khz80zQhxWTR4UFlyZpApeXe135MxtRrVWf1VeEC8qBZynSiicNEE5qSEPmd%2FKNSihzfYJ9PmbUkfZN9yFsrIArapjiCpWMywbnOVNeLSHMFFv8xtfh0sOTI4VetTtHS5BxyHny%2BvnXM6Hjudg5tfOAvbwkv9j%2BTfq0Y0YGFWvyUNrCeX3Y3zQ5t8ked%2FqOvxUSYeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cdbf78e03e63295c72c47dc6806ee0d823fb4c6d7ae0b392b221134cd12718d5","file_size":195686,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":95,"voters":["cyber_humans","sameerphad72","spam404","prophet","mik317","stealthy","hemantsolo","aryan2808","tulswani","sc0","and 85 more..."],"severity":{"rating":"high","score":8.6,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5974603,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @rpadovani,\n\nThank you for submitting this extra report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress https://gitlab.com/gitlab-org/gitlab/issues/33547.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-10-07T09:26:23.949Z","updated_at":"2019-10-07T09:26:23.949Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5977449,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Fixed in critical security release 12.3.5","automated_response":false,"created_at":"2019-10-07T14:37:31.107Z","updated_at":"2019-10-07T14:37:31.107Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5983328,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hello @rpadovani ,\n\nThank you again for the extra report! Your finding has been patched in GitLab version 12.3.5 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch still does not mitigate your finding (we will soon be activating back Elastichsearch integration on GitLab.com). Your report will be published in 30 days in GitLab's issue tracker.\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-10-08T07:54:14.350Z","updated_at":"2019-10-08T07:54:14.350Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"7000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"rpadovani","url":"/rpadovani"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5983340,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2019-10-08T07:55:49.417Z","updated_at":"2019-10-08T07:55:49.417Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rpadovani","url":"/rpadovani"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5988341,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"For your information, Elasticsearch integration has been reactivated in GitLab.com\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-10-08T17:41:23.254Z","updated_at":"2019-10-08T17:41:23.254Z","actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5988448,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmatos_bgtvf,\n\nThanks for the bounty!\n\nThe comments search seems to still leaks data about private issues.\n\nGo, as an anonymous user, to https://gitlab.com/search?group_id=9970\u0026repository_ref=\u0026scope=notes\u0026search=nextbit\u0026snippets= (see screenshot).\n\nYou will see a comment on a private issue, of a private project, of a private group.\n\nTherefore, the search is leaking existence of private projects, private groups, and existence of issues.\n\nIf you open the returned issue, the information is properly hidden.\n\nIs the same bug or should I open a new report?\nBasically, the `notes` scope search is not properly cleared from private information. I suppose it is the same with notes from MRs or other components, but I don't want to blindly look for private projects.\n\nPlease note that the name of projects could reveal the name of customers (in our case, `nextbit` is the company I work for, but the name of the project should be confidential)\n \nYou can reproduce it also through APIs:\n\n```\n➜ curl \"https://gitlab.com/api/v4/projects/278964/search?scope=notes\u0026search=nextbit\" --header \"PRIVATE-TOKEN: secret\" | jq\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   520  100   520    0     0    508      0  0:00:01  0:00:01 --:--:--   508\n[\n  {\n    \"id\": 215547575,\n    \"type\": null,\n    \"body\": \"mentioned in issue nextbit/VirtualCore/gui#109\",\n    \"attachment\": null,\n    \"author\": {\n      \"id\": 16048,\n      \"name\": \"Riccardo Padovani\",\n      \"username\": \"rpadovani\",\n      \"state\": \"active\",\n      \"avatar_url\": \"https://secure.gravatar.com/avatar/9d89d4072afb4457b0c49131d8d258f5?s=80\u0026d=identicon\",\n      \"web_url\": \"https://gitlab.com/rpadovani\"\n    },\n    \"created_at\": \"2019-02-19T12:54:23.670Z\",\n    \"updated_at\": \"2019-02-19T12:54:23.670Z\",\n    \"system\": true,\n    \"noteable_id\": 24685040,\n    \"noteable_type\": \"Issue\",\n    \"resolvable\": false,\n    \"noteable_iid\": 25362\n  }\n]\n```\n\n\n","automated_response":false,"created_at":"2019-10-08T17:49:09.188Z","updated_at":"2019-10-08T17:59:39.702Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":602670,"filename":"Screenshot_2019-10-08_nextbit___Search.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/b9buFr8J4ZK2r2QU6n7TehNj?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2019-10-08_nextbit___Search.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2019-10-08_nextbit___Search.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXEQ3VCGF%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151918Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCNbr25hK1JC2i73IX5uE08m1agZwA%2BCyxTPtXmxpZHFAIgA9v21iU9rOtKWjxfMHo7kqQOL4Y8ABbAnucRVLpaC9cqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDOyim%2FBwzSkIWBPCWirXA1TUfPlTIAz6iDfoaiiMP8hivTDD8uDyRJ%2FoAF5UW%2F6cSrWHj2Mtt%2Fx8tKTYSGoQiyhUdi%2BFdxLY35ZRGqE5k10GcpBa5q9ivBUHzTLtIbzvkVLjo0GDs33RjPyv8lT8%2BIT3cR1GpHz5sKugzk1wJHpaXHIGV7TsNZTez5PsxRWLAbodD46%2Bv0aY9dXICvo8Bld1OIiDoUsI3sX2R7SAEjL0B45opfmY7Hh4KKVF9KyCf7etmcGEL0U%2Bjij5TfmuHRxoVJXFKR4WbBKoHXN3cL5AQhAkGBE5bmE6cTsvfhMkCltMfmR1OmQtt1QK7fs2YWSyJhNNnjgzseVzroJk8qcktNvGQQNtmAz%2F0hi%2BbLDdR3r35MBTZtRPxGxwfYKfk%2Blyikhar%2F%2FfPxr6sJoQhbcKSjiziR8cFwFPC97f3qfgH6sVJVvH5AClhLDj9FMqequ01uI1FMQI%2BQ1BJ1t%2Bl3dX7D09OZCMRrk3HvidiN7al4fmx5e0pKMz7tbb23gSzvgiMJbXeHgATiARA8dz6JIoLosFubesB7ZLWq9owsMVaP42CuihB%2Br9J9vu1HkgY4lcWvgRt8bqCjXjWDPBzlNcnc9D32bMJUDfp2BWdJ0BCnpEi4XjrDCyiJGLBjqlAbw%2BQzzkBo5pgpwg2B9K3Kb9khz80zQhxWTR4UFlyZpApeXe135MxtRrVWf1VeEC8qBZynSiicNEE5qSEPmd%2FKNSihzfYJ9PmbUkfZN9yFsrIArapjiCpWMywbnOVNeLSHMFFv8xtfh0sOTI4VetTtHS5BxyHny%2BvnXM6Hjudg5tfOAvbwkv9j%2BTfq0Y0YGFWvyUNrCeX3Y3zQ5t8ked%2FqOvxUSYeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=38c1a5dd23e2ce52aace5a99f13174041f50036ec9d5d3f54ab37f92b39c023f"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5989258,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello again @rpadovani,\n\nThank you for providing us with that information. Our engineering team is aware of the issue and believes it is a new, separate issue. Would you mind submitting a new HackerOne report with the details of your new finding?\n\nThanks again for collaborating with us to make GitLab more secure. Your time and effort is very much appreciated!\n\nHave a great day,\nAndrew\nSecurity Team | GitLab","automated_response":false,"created_at":"2019-10-08T19:48:06.059Z","updated_at":"2019-10-08T19:48:06.059Z","actor":{"username":"akelly","cleared":false,"url":"/akelly","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5990005,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @akelly,\nthanks for your fast reply, and the transparency in managing these issues! Kudos!\n\nI followed up with #710006.\n\nThanks again :-)\n\nP.S.: Totally unrelated, you should probably update the description of the program here on HackerOne, linking to the new mono repo, instead of the old `-ce` and `-ee`  ","automated_response":false,"created_at":"2019-10-08T21:48:18.419Z","updated_at":"2019-10-08T21:48:18.419Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6541885,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-12-13T13:52:50.319Z","updated_at":"2019-12-13T13:52:50.319Z","first_to_agree":true,"actor":{"username":"jmatos_bgtvf","cleared":false,"url":"/jmatos_bgtvf","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6547482,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks again for your work on this, happy to disclose :-)","automated_response":false,"created_at":"2019-12-14T11:25:39.674Z","updated_at":"2019-12-14T11:25:39.674Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6547483,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-12-14T11:25:39.750Z","updated_at":"2019-12-14T11:25:39.750Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}