{"id":129873,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjk4NzM=","url":"https://hackerone.com/reports/129873","title":"Bypassing Digits origin validation which leads to account takeover","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-11T17:02:26.419Z","submitted_at":"2016-04-11T17:02:26.419Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-06-24T17:55:18.018Z","bug_reporter_agreed_on_going_public_at":"2020-06-22T16:15:29.585Z","team_member_agreed_on_going_public_at":"2020-06-24T17:55:17.912Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI would like to report an important issue that affects websites that has integrated \"Signin with Digits\" , leading to potential account takeover.\n\n#Detail\nIn Digits architecture, the data communication channel between Digits and customer's site relies on *postMessage()*. In order to prevent malicious websites prevent themselves to be the legit Digits website and send arbitrary commands to the customer's websites, an origin validation is in place in the SDK. Specifically, the code that's responsible to perform the validation is as follow:\n\n**File: https://cdn.digits.com/1/sdk.js**\n```javascript\ne.exports = {\n    sdk_host: \"https://www.digits.com\",\n[..]\nonReceiveMessage: function(t) {\n    this.config \u0026\u0026 -1 !== this.config.get(\"sdk_host\").search(t.origin) \u0026\u0026 this.resolve(t.data)\n},\n```\nIn short, the event origin is checked against Digits' origin in this line:`-1 !== this.config.get(\"sdk_host\").search(t.origin)`, which is the same as `-1 !== \"https://www.digits.com\".search(t.origin)`. In essence, it looks for the occurrence of Digit's origin from sender's origin.\n\nThe way the validation is done is however flawed. According to the [docs of String.prototype.search()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search), the method takes a regular repression object instead of a string. If anything other than regexp is passed, it will get implicitly converted into a regexp. In this case, `t.origin` which is a string is converted into a regexp.\n\nIn regular expression, a dot (.) is treated as a wildcard. In other words, any character of Digits' origin can be replaced with a dot. An attacker can take advantage of it and use a special domain instead of the official one to bypass the validation, such as `www.d.gits.co`\n\nAn example of comparing such a special domain looks like this: \n`www.d.gits.co`\n`www.digits.com`\nNotice that `www.d.gits.co` is now a subset of `www.digits.com`, thus it effective bypasses the validation.\n\n#Impact\nIt affects websites that have integrated Digits signin feature, leading to potential account takeover issue on those websites. Twitter official applications like Fabric is also affected.\n\n#PoC\nTo provide a concrete example of how this vulnerability can lead to account takeover, a Proof of Concept against Fabric is presented.\n\n1. Make sure you have logged in Fabric.io\n2. Go to https://www.d.gits.co/fabric.html\n3. Click the button\n4. You will see a phone number is automatically associated with your account\n5. Now, attacker can use the reset password with Digits feature to takeover the account\n\nNotice the attack can be done silently without user interaction and awareness.\n\nA video demo: https://vimeo.com/162397716 (password: origin)\n\n#Fix\nIn my opinion, a simple string comparison is enough for validation. Therefore I recommend changing it to use either `indexOf` or `===`.","bounty_amount":"5040.0","formatted_bounty":"$5,040","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-07-22T16:15:29.641Z","allow_singular_disclosure_after":-38524909.05606269,"singular_disclosure_allowed":true,"vote_count":578,"voters":["totz_sec","4n_curze","rootsploit","xdms","thiezn","whoareme","mr-medi","nrockhouse","samengmg","stefanofinding","and 568 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":899759,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Forgot to include this:\nAfter the attacker bypasses the validation, he/she can then send a fake sign in command to the customer's site with his/her own tokens. Customer's site then accepts it and associates victim's account with attacker's phone number.","automated_response":false,"created_at":"2016-04-11T17:09:48.777Z","updated_at":"2016-04-11T17:09:48.777Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":902496,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2016-04-12T22:52:32.451Z","updated_at":"2016-04-12T22:52:32.451Z","actor":{"username":"mfinifter","cleared":false,"url":"/mfinifter","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":908441,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned weâ€™ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","automated_response":false,"created_at":"2016-04-15T18:51:57.388Z","updated_at":"2016-04-15T18:51:57.388Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Twitter"}},"bounty_amount":"5040.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1007349,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2016-06-09T22:44:10.369Z","updated_at":"2016-06-09T22:44:10.369Z","actor":{"username":"apinter","cleared":false,"url":"/apinter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/688/53801559ec10573f82935ef2c1682b2ce25f2d38_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1009152,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm the issue is fixed!","automated_response":false,"created_at":"2016-06-11T10:04:47.371Z","updated_at":"2016-06-11T10:04:47.371Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8373622,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-22T16:15:29.607Z","updated_at":"2020-06-22T16:15:29.607Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8397608,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-24T17:55:17.943Z","updated_at":"2020-06-24T17:55:17.943Z","actor":{"username":"yongjink","cleared":false,"url":"/yongjink","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8397609,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-06-24T17:55:18.041Z","updated_at":"2020-06-24T17:55:18.041Z","actor":{"username":"yongjink","cleared":false,"url":"/yongjink","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}