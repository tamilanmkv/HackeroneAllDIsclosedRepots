{"id":184698,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODQ2OTg=","url":"https://hackerone.com/reports/184698","title":"Eavesdropping on private Slack calls","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-24T02:57:14.816Z","submitted_at":"2016-11-24T02:57:14.816Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"michiel","url":"/michiel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-02-08T21:14:04.833Z","bug_reporter_agreed_on_going_public_at":"2017-01-09T21:13:58.149Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"A vulnerability exists in Slack's call functionality that allows a team member to eavesdrop on private ongoing Slack calls by inviting themselves into the conversation without the permission from either participant. By doing so they can eavesdrop on co-workers' private conversations as well as taking part in these conversations. To make the attack less obvious, the attacker could re-use Slackbot's avatar and choose a username that is similar to Slackbot. Another scenario would be to pick the avatar of the person you want to impersonate and choose a username that is similar to theirs. \n\n## Setup\nBefore trying to reproduce the vulnerability, make sure you have the following:\n- Slack Calls should be enabled in your Slack instance.\n- Have at least two accounts you control. One we will call the Main Account, the other one we will call the Eavesdropper Account.\n- Have at least two accounts you do not control on the same Slack instance. They will be used to mock the situation of two co-workers having a private Slack call.\n- For easy reproduction, it is advised to initiate the call from a web browser rather than a native app.\n- Make sure to have some type of intercepting proxy running that allows you to record HTTP requests and replay them easily.\n\n## Steps to Reproduce\n### Obtaining the vulnerable request\nFirst off, we are going to obtain the exact request to the endpoint that contains the vulnerability (`/api/screenhero.rooms.invite`). This will be needed to later on modify and add Eavesdropper Account to the private call. \n\nSet up a call and invite someone to the call. Make sure to capture the request to `/api/screenhero.rooms.invite` and save it so you can replay it easily later. The request should look something like:\n\n```\nPOST /api/screenhero.rooms.invite?_x_id=91700980-1479951838.521 HTTP/1.1\nHost: hackerone.slack.com\nOrigin: https://hackerone.slack.com\nX-Slack-Version-Ts: 1479949022\n[...]\n\nis_video_call=false\u0026responder=U0254GYNR\u0026room=R36L2K8P6\u0026set_active=true\u0026should_share=true\u0026token=\u003csnip\u003e\n```\n\n### Staging the attack environment\nStart by setting up a 1:1 call between two users (both accounts you don't necessarily have control over). This is to mock a situation where two co-workers are on a private 1:1 Slack call. \n\nNote the Screenhero room ID of the call. You will need this later. In this scenario, I am going to assume the attacker is already in possession of the room ID. The room ID can be recognized by the ID after `/call/` in https://hackerone.slack.com/call/R36L2K8P6 (an example).\n\n### Pulling off the attack\nTake the request you saved earlier, and now modify the request as follows:\n- change the value of the `room` parameter to the room ID you noted from the previous step\n- change the value of the `responder` to the user ID of Eavesdropper Account. The reason why this can't be your own user ID (Main Account) is that you're not allowed to invite `self`. \n\nAfter these changes, forward the request and wait for a call on Eavesdropper Account. When you accept this call, you will be placed into the private conversation the two victims were having. \n\nLet me know if there's anything else you need to validate this issue.\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-02-08T21:13:58.184Z","allow_singular_disclosure_after":-147372118.51070338,"singular_disclosure_allowed":true,"vote_count":66,"voters":["arneswinnen","tomdev","derision","ziot","mashoud1122","jobert","tk0","bogdantcaciuc","dawgyg","teuvokas","and 56 more..."],"severity":{"rating":"high","score":7.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1316858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"While I was researching this further, I noticed that you can also eliminate the requirement for a second account (Eavesdropper Account) and handle everything from Main Account. You can do so by exploiting a similar endpoint that shares out the private call to a channel (using the privileges of Main Account, who is not a part of this private call). Specifically, the endpoint is `/api/screenhero.rooms.share`.\n\nHere's the request to do it:\n\n```\nPOST /api/screenhero.rooms.share?_x_id=8e49d942-1479956683.974 HTTP/1.1\nHost: hackerone.slack.com\nOrigin: https://hackerone.slack.com\nX-Slack-Version-Ts: 1479953760\n[...]\n\nchannel=C076H6VUY\u0026room=R36LPPX9T\u0026set_active=true\u0026token=\u003csnip\u003e\n```\n\nThis will share out the private call between two co-workers (or a private channel) to channel with ID `C076H6VUY`. Join that channel, and click the call link to join! :)\n","automated_response":false,"created_at":"2016-11-24T03:45:23.131Z","updated_at":"2016-11-24T03:45:23.131Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1324370,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report.\n\nI'm having some difficulty reproducing the behavior you described in your report.  When I attempt to invite a unauthorized user to a private call between two users, I receive the following error message on accepting the call: \n\n\"Unfortunately, you don't have access to the required channel or conversation for this call\"\n\nMy setup is as follows:\n\n1. User 1 calls User 2 via clicking the phone icon while in a private channel attended by only User 1 and User 2.  The call is accepted by User 2 and in progress\n2. User 3 calls User 4 in a private channel the two of them are both in but User 3 intercepts the request, and changes the room number to match that of the [User1-User2] call in progress.\n3. User 4 accepts the invite - User 4 receives the error message above.  \n\nAre you not seeing this error message?  Can you clarify how my setup different from yours?\n\nThanks, and good luck with your future bug hunting.","automated_response":false,"created_at":"2016-11-28T21:10:06.751Z","updated_at":"2016-11-28T21:10:06.751Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1324574,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @bugtriage-josh - in your step 2, it looks like you are re-purposing the call request rather than an invite request. That indeed doesn't work.\n\nPlease make sure the request you are intercepting and modifying is to the `/api/screenhero.rooms.invite` endpoint. \n\nAnyway, I simplified my PoC a bit by instead using the `/api/screenhero.rooms.share` endpoint since it contains the same vulnerability:\n\n1. Create a channel (public or private) with only yourself in it. Start a call in this channel, don't invite anyone. Simply go to the share icon in the top left corner and share the call to the channel you created. Grab this request and save it for later.\n2. Now your two victims, User 1 and User 2 set up a call between them. In my PoC I started the call from a DM conversation, not a channel. *Note the room ID.*\n3. Now repeat the request you grabbed from step 1 and replace the room ID with the one from your two victims. The request should look like this:\n\n```\nPOST /api/screenhero.rooms.share?_x_id=a8694c39-1480371978.203 HTTP/1.1\nHost: hackerone.slack.com\n[...]\n\nchannel=C076H6VUY\u0026room=R37T38N3V\u0026set_active=true\u0026token=\u003csnip\u003e\n```\n\n^-- of course make sure that your own token is inserted here (`xoxs-....`), otherwise it will fail. \n\nAfter you repeat this request, the call that was going on between your two victims (User 1 and User 2) is shared to the channel you created. Just click the message posted there and you can join the call. \n\n*Note that the user where I am performing this attack from is a Slack Admin user.* \n\n","automated_response":false,"created_at":"2016-11-28T22:38:48.795Z","updated_at":"2016-11-29T01:15:49.131Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1327951,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your additional information.\n\nAh, OK, I'm able to reproduce it now, thanks.  \nWe're looking into this and will keep you updated when we have additional information.","automated_response":false,"created_at":"2016-11-29T22:29:23.895Z","updated_at":"2016-11-29T22:29:23.895Z","actor":{"username":"bugtriage-josh","cleared":false,"url":"/bugtriage-josh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1331491,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks @michiel! We've triaged this!","automated_response":false,"created_at":"2016-11-30T21:38:48.816Z","updated_at":"2016-11-30T21:38:48.816Z","actor":{"username":"maxfeldman","cleared":false,"url":"/maxfeldman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/613/37b54dbac5da0a42db471713959c8bf2de89a12d_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1398341,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Since we're about a month in, I did a quick retest of this issue. It looks like it is still working. Do you already have a fix in the pipeline somewhere? ","automated_response":false,"created_at":"2017-01-04T10:45:26.714Z","updated_at":"2017-01-04T10:45:26.714Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1398472,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey michiel,\n\nWe've triaged this issue with the team and we're working on a complete fix here.  We'll have an update for you soon.\n\nCheers,\nSlack","automated_response":false,"created_at":"2017-01-04T13:00:45.609Z","updated_at":"2017-01-04T13:00:45.609Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1404783,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @michiel,\n\nWe've deployed a change here.  Can you verify that it is fixed on your end?\n\nCheers,\nSlack","automated_response":false,"created_at":"2017-01-06T18:56:21.518Z","updated_at":"2017-01-06T18:56:21.518Z","actor":{"username":"slacka","cleared":false,"url":"/slacka","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1404928,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, I can confirm this issue is now fixed!\n\nThe technique using the `/api/screenhero.rooms.share` now returns the following error when you share out a call you aren't participating in or invited to:\n\n```\n{\"ok\":false,\"error\":\"rooms_unauthorized_room\",\"msg\":\"User is not authorized to access room: R3P1VFRNJ\"}\n```\n\nThe `/api/screenhero.rooms.invite` endpoint still rings the other user, but then when joining you are greeted with the following error message:\n\n\u003e Unfortunately, you don't have access to the required channel or conversation for this call.\n\n(see attachment `slack-error.png`)\n\n","automated_response":false,"created_at":"2017-01-06T19:36:57.686Z","updated_at":"2017-01-06T19:36:57.686Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"attachments":[{"id":149888,"filename":"slack-error.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/149/888/b3e8884a98ebc587710c6b8bf3d762e4d55c1603/slack-error.png?response-content-disposition=attachment%3B%20filename%3D%22slack-error.png%22%3B%20filename%2A%3DUTF-8%27%27slack-error.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T135556Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2ca1ef4a06ec820b9f6d140be869fe328b5db4e97f6055ed7549ef8da64a22df"}],"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1404935,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey @michiel,\n\nThanks for verifying and working with us through the holidays.  We've resolved this issue, and are going to issue you a bounty!  Thanks for your report, and happy bug hunting in the future!  \n\nCheers,\nSlack","automated_response":false,"created_at":"2017-01-06T19:42:02.541Z","updated_at":"2017-01-06T19:42:02.541Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"michiel","url":"/michiel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1409584,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks @michiel!","automated_response":false,"created_at":"2017-01-09T21:10:32.576Z","updated_at":"2017-01-09T21:10:32.576Z","actor":{"username":"maxfeldman","cleared":false,"url":"/maxfeldman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/613/37b54dbac5da0a42db471713959c8bf2de89a12d_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"michiel","url":"/michiel"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1409590,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Awesome, thanks folks!","automated_response":false,"created_at":"2017-01-09T21:13:58.166Z","updated_at":"2017-01-09T21:13:58.166Z","first_to_agree":true,"actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1472762,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-02-08T21:14:04.858Z","updated_at":"2017-02-08T21:14:04.858Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}