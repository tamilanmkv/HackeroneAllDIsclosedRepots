{"id":206650,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDY2NTA=","url":"https://hackerone.com/reports/206650","title":"Broken Authentication - Security token gets captured via man in the middle attack","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-02-15T15:12:23.399Z","submitted_at":"2017-02-15T15:12:23.399Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dermeister","url":"/dermeister","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":111,"url":"https://hackerone.com/automattic","handle":"automattic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Automattic","twitter_handle":"","website":"https://automattic.com","about":"WordPress.com, VaultPress, Akismet, Gravatar, WooCommerce, Polldaddy, Tumblr and more!"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-06-22T14:15:50.376Z","bug_reporter_agreed_on_going_public_at":"2019-05-23T14:15:49.445Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Product / URL**\n\n`http://en.instagram-brand.com/register/reset/\u003cthe security token here\u003e?email=\u003cemail address here\u003e`\n\n\n**Description and Impact**\n\nThe password reset links issues by Instagram Brand gets delivered to users inbox with a http scheme and NOT https scheme.\n\nThis causes an attacker stealing those links and performing mass account takeovers and security compromises.\n\nThe link that gets delivered in inbox is:\n`http://mandrillapp.com/track/click/30956340/instagram-brand.com?p=\u003cthe very long security token here\u003e`\n\nOn requesting the above link in browser, it sends back the password reset token in clear text: `http://en.instagram-brand.com/register/reset/\u003cthe security token here\u003e?email=\u003cthe email of user here\u003e`\n\n**Solution:**\nThis issues has a very easy solution. I have myself performed this and it worked !!.\nWhenever the code responsible for sending password reset link makes those links, just add https as scheme instead of http. And you will observe that now all the accounts are safe and data cannot be stolen.\n\n\n**Reproduction Instructions / Proof of Concept**\n\n1. Request for you password reset link.\n2. Go to inbox.\n3. Right click that link and paste it on notepad and observe the scheme.\n4. You can also start Wireshark to capture the traffic and observe that security token can be compromised.\n\nI have attached the screenshot of Wireshark as a proof of concept. F161119","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eProduct / URL\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ehttp://en.instagram-brand.com/register/reset/\u0026lt;the security token here\u0026gt;?email=\u0026lt;email address here\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription and Impact\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThe password reset links issues by Instagram Brand gets delivered to users inbox with a http scheme and NOT https scheme.\u003c/p\u003e\n\n\u003cp\u003eThis causes an attacker stealing those links and performing mass account takeovers and security compromises.\u003c/p\u003e\n\n\u003cp\u003eThe link that gets delivered in inbox is:\u003cbr\u003e\n\u003ccode\u003ehttp://mandrillapp.com/track/click/30956340/instagram-brand.com?p=\u0026lt;the very long security token here\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eOn requesting the above link in browser, it sends back the password reset token in clear text: \u003ccode\u003ehttp://en.instagram-brand.com/register/reset/\u0026lt;the security token here\u0026gt;?email=\u0026lt;the email of user here\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSolution:\u003c/strong\u003e\u003cbr\u003e\nThis issues has a very easy solution. I have myself performed this and it worked !!.\u003cbr\u003e\nWhenever the code responsible for sending password reset link makes those links, just add https as scheme instead of http. And you will observe that now all the accounts are safe and data cannot be stolen.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eReproduction Instructions / Proof of Concept\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eRequest for you password reset link.\u003c/li\u003e\n\u003cli\u003eGo to inbox.\u003c/li\u003e\n\u003cli\u003eRight click that link and paste it on notepad and observe the scheme.\u003c/li\u003e\n\u003cli\u003eYou can also start Wireshark to capture the traffic and observe that security token can be compromised.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI have attached the screenshot of Wireshark as a proof of concept. \u003ca class=\"markdown-attachment-link markdown-attachment-reference\" data-attachment-filename=\"InstagramBrandMITM.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/119/96b01c02da3a68edc2c863c92063eea72585a5e5/InstagramBrandMITM.png?response-content-disposition=attachment%3B%20filename%3D%22InstagramBrandMITM.png%22%3B%20filename%2A%3DUTF-8%27%27InstagramBrandMITM.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T045520Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026amp;X-Amz-Signature=f88e3de946ae8a21559038b20235d1e9e2dcb7f2c7681ffdf2d19956b178e603\" data-attachment-type=\"image/png\"\u003eInstagramBrandMITM.png (F161119)\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":161119,"file_name":"InstagramBrandMITM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/119/96b01c02da3a68edc2c863c92063eea72585a5e5/InstagramBrandMITM.png?response-content-disposition=attachment%3B%20filename%3D%22InstagramBrandMITM.png%22%3B%20filename%2A%3DUTF-8%27%27InstagramBrandMITM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045520Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026X-Amz-Signature=f88e3de946ae8a21559038b20235d1e9e2dcb7f2c7681ffdf2d19956b178e603","file_size":147100,"type":"image/png"},{"id":161120,"file_name":"InstagramBrandMITM.pcapng","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/120/82b596893da84ea4945940cc9d18200236483fc2/InstagramBrandMITM.pcapng?response-content-disposition=attachment%3B%20filename%3D%22InstagramBrandMITM.pcapng%22%3B%20filename%2A%3DUTF-8%27%27InstagramBrandMITM.pcapng\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045520Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026X-Amz-Signature=2420f00bc24315075947fcf9fa27ed4c7c8972c0a3f2dcb4d869b5e2d8db9d78","file_size":1439244,"type":"application/octet-stream"}],"allow_singular_disclosure_at":"2019-06-22T14:15:49.567Z","allow_singular_disclosure_after":-48004770.56473956,"singular_disclosure_allowed":true,"vote_count":56,"voters":["megaknight","base_64","schneidersec","mygf","mike-litt","nu11sec","an0nym0us","nessun00x","khizer47","exception","and 46 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1487970,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey @dermeister,\n\nI'm having some trouble reproducing this issue - when I request the mandrillapp.com link, I always get redirected to an HTTPS instagram-brand.com url:\n\n```\ncurl -I -s http://mandrillapp.com/track/click/30956340/instagram-brand.com?p=\u003cREDACTED\u003e | grep Location\nLocation: https://instagram-brand.com/register/signin/\u003cREDACTED\u003e\n```\n\nFollowing that redirect, I get redirected once more to `https://en.instagram-brand.com/register/signin/\u003cREDACTED\u003e`.\n\nCan you help me reproduce?\n\nA mitigating factor here is that this is a one-time use code that simply verifies an email address...so even if it were intercepted by MiTM, it's of little value to an attacker as it can't really do anything.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/dermeister\"\u003e@dermeister\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m having some trouble reproducing this issue - when I request the mandrillapp.com link, I always get redirected to an HTTPS instagram-brand.com url:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecurl -I -s http://mandrillapp.com/track/click/30956340/instagram-brand.com?p=\u0026lt;REDACTED\u0026gt; | grep Location\nLocation: https://instagram-brand.com/register/signin/\u0026lt;REDACTED\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFollowing that redirect, I get redirected once more to \u003ccode\u003ehttps://en.instagram-brand.com/register/signin/\u0026lt;REDACTED\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eCan you help me reproduce?\u003c/p\u003e\n\n\u003cp\u003eA mitigating factor here is that this is a one-time use code that simply verifies an email address...so even if it were intercepted by MiTM, it\u0026#39;s of little value to an attacker as it can\u0026#39;t really do anything.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-15T19:52:30.661Z","updated_at":"2017-02-15T19:52:30.661Z","actor":{"username":"nickdaugherty","cleared":false,"url":"/nickdaugherty","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/778/73bab647e605318906a1a3197d4e578d5dd6de30_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1488563,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @nickdaugherty,\n\nYou are seeing this on a UI level. Please follow the steps in order to find the exact point at which HTTP is seen.\n\n1. Request for password reset using https://en.instagram-brand.com/register/signin\n2. Go to your inbox\n3. Right click on that hyperlink and copy and paste it in notepad. (HTTP scheme is seen here)\n4. Now Attach a local proxy tool to your browser.\n5. Request the copied link in that browser and keep on intercepting.\n6. The first request goes in HTTP like this: \n\n`GET /track/click/30956340/instagram-brand.com?p=\u003ctoken here\u003e HTTP/1.1\nHost: mandrillapp.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1`\n\n7.The response to that request is:\n\n`HTTP/1.1 302 Moved Temporarily\nServer: nginx/1.6.3\nDate: Thu, 16 Feb 2017 02:58:53 GMT\nContent-Type: text/html; charset=utf-8\nSet-Cookie: PHPSESSID=dc43ed4a78f737e1cff9ecf05ede3680; expires=Thu, 16-Feb-2017 12:58:01 GMT; path=/; secure; HttpOnly\nExpires: Thu, 19 Nov 1981 08:52:00 GMT\nCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\nPragma: no-cache\nSet-Cookie: PHPSESSID=dc43ed4a78f737e1cff9ecf05ede3680; expires=Thu, 16-Feb-2017 12:58:01 GMT; path=/; secure; httponly\nLocation: https://instagram-brand.com/register/reset/\u003cnew token\u003e?email=\u003cyour email\u003e\nVary: Accept-Encoding\nContent-Length: 0`\n\n8.Then the next request is:\n\n`GET /register/reset/\u003ctoken\u003e?email=\u003cemail\u003e HTTP/1.1\nHost: instagram-brand.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nCookie: pll_language=en; _ga=GA1.2.1670792457.1487004320; _gat=1\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1`\n\n9.The response is:\n\n`HTTP/1.1 302 Found\nServer: nginx\nDate: Thu, 16 Feb 2017 03:00:30 GMT\nContent-Type: text/html; charset=utf-8\nContent-Length: 0\nConnection: keep-alive\nLocation: https://en.instagram-brand.com/register/reset/\u003ctoken\u003e?email=\u003cemail\u003e\nX-rq: lhr2 102 131 3129\nAge: 0\nX-Cache: miss`\n\n10.The final request is:\n\n`GET /register/reset/\u003ctoken\u003e?email=\u003cemail\u003e HTTP/1.1\nHost: en.instagram-brand.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nCookie: pll_language=en; _ga=GA1.2.1670792457.1487004320; _gat=1\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1`\n\n11.The final response is:\n\n`HTTP/1.1 404 Not Found\nServer: nginx\nDate: Thu, 16 Feb 2017 03:01:58 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: keep-alive\nX-Frame-Options: deny\nX-hacker: If you're reading this, you should visit automattic.com/jobs and apply to join the fun, mention this header.\nLink: \u003chttps://instagram-brand.com/wp-json/\u003e; rel=\"https://api.w.org/\"\nX-rq: lhr1 102 131 3129\nAge: 0\nX-Cache: miss\nVary: Accept-Encoding\nContent-Length: 28183`\n\n\nIn the above steps, I am talking about token on plain HTTP in step 6 and 7. While you are seeing the token in HTTPS because you are referring to steps 8 onward.\n\nSo, an attack can capture the security token before and then the victim will see the final link in his/her browser i.e. this link: `https://en.instagram-brand.com/register/reset/\u003ctoken\u003e?email=\u003cemail\u003e`\n\nHere the attacker can smartly write an exploit that auto requests that links and changes the victim's password. After this the victim will request that link in UI and will find that that link is expired, but what is actually happening is that the attacker has used that link.\n\nRegards","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nickdaugherty\"\u003e@nickdaugherty\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eYou are seeing this on a UI level. Please follow the steps in order to find the exact point at which HTTP is seen.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eRequest for password reset using \u003ca title=\"https://en.instagram-brand.com/register/signin\" href=\"/redirect?url=https%3A%2F%2Fen.instagram-brand.com%2Fregister%2Fsignin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://en.instagram-brand.com/register/signin\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to your inbox\u003c/li\u003e\n\u003cli\u003eRight click on that hyperlink and copy and paste it in notepad. (HTTP scheme is seen here)\u003c/li\u003e\n\u003cli\u003eNow Attach a local proxy tool to your browser.\u003c/li\u003e\n\u003cli\u003eRequest the copied link in that browser and keep on intercepting.\u003c/li\u003e\n\u003cli\u003eThe first request goes in HTTP like this: \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ccode\u003eGET /track/click/30956340/instagram-brand.com?p=\u0026lt;token here\u0026gt; HTTP/1.1\u003cbr\u003e\nHost: mandrillapp.com\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\u003cbr\u003e\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nAccept-Encoding: gzip, deflate\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e7.The response to that request is:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eHTTP/1.1 302 Moved Temporarily\u003cbr\u003e\nServer: nginx/1.6.3\u003cbr\u003e\nDate: Thu, 16 Feb 2017 02:58:53 GMT\u003cbr\u003e\nContent-Type: text/html; charset=utf-8\u003cbr\u003e\nSet-Cookie: PHPSESSID=dc43ed4a78f737e1cff9ecf05ede3680; expires=Thu, 16-Feb-2017 12:58:01 GMT; path=/; secure; HttpOnly\u003cbr\u003e\nExpires: Thu, 19 Nov 1981 08:52:00 GMT\u003cbr\u003e\nCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\u003cbr\u003e\nPragma: no-cache\u003cbr\u003e\nSet-Cookie: PHPSESSID=dc43ed4a78f737e1cff9ecf05ede3680; expires=Thu, 16-Feb-2017 12:58:01 GMT; path=/; secure; httponly\u003cbr\u003e\nLocation: https://instagram-brand.com/register/reset/\u0026lt;new token\u0026gt;?email=\u0026lt;your email\u0026gt;\u003cbr\u003e\nVary: Accept-Encoding\u003cbr\u003e\nContent-Length: 0\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e8.Then the next request is:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eGET /register/reset/\u0026lt;token\u0026gt;?email=\u0026lt;email\u0026gt; HTTP/1.1\u003cbr\u003e\nHost: instagram-brand.com\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\u003cbr\u003e\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nAccept-Encoding: gzip, deflate, br\u003cbr\u003e\nCookie: pll_language=en; _ga=GA1.2.1670792457.1487004320; _gat=1\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e9.The response is:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eHTTP/1.1 302 Found\u003cbr\u003e\nServer: nginx\u003cbr\u003e\nDate: Thu, 16 Feb 2017 03:00:30 GMT\u003cbr\u003e\nContent-Type: text/html; charset=utf-8\u003cbr\u003e\nContent-Length: 0\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nLocation: https://en.instagram-brand.com/register/reset/\u0026lt;token\u0026gt;?email=\u0026lt;email\u0026gt;\u003cbr\u003e\nX-rq: lhr2 102 131 3129\u003cbr\u003e\nAge: 0\u003cbr\u003e\nX-Cache: miss\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e10.The final request is:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eGET /register/reset/\u0026lt;token\u0026gt;?email=\u0026lt;email\u0026gt; HTTP/1.1\u003cbr\u003e\nHost: en.instagram-brand.com\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\u003cbr\u003e\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nAccept-Encoding: gzip, deflate, br\u003cbr\u003e\nCookie: pll_language=en; _ga=GA1.2.1670792457.1487004320; _gat=1\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e11.The final response is:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eHTTP/1.1 404 Not Found\u003cbr\u003e\nServer: nginx\u003cbr\u003e\nDate: Thu, 16 Feb 2017 03:01:58 GMT\u003cbr\u003e\nContent-Type: text/html; charset=UTF-8\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nX-Frame-Options: deny\u003cbr\u003e\nX-hacker: If you\u0026#39;re reading this, you should visit automattic.com/jobs and apply to join the fun, mention this header.\u003cbr\u003e\nLink: \u0026lt;https://instagram-brand.com/wp-json/\u0026gt;; rel=\u0026quot;https://api.w.org/\u0026quot;\u003cbr\u003e\nX-rq: lhr1 102 131 3129\u003cbr\u003e\nAge: 0\u003cbr\u003e\nX-Cache: miss\u003cbr\u003e\nVary: Accept-Encoding\u003cbr\u003e\nContent-Length: 28183\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eIn the above steps, I am talking about token on plain HTTP in step 6 and 7. While you are seeing the token in HTTPS because you are referring to steps 8 onward.\u003c/p\u003e\n\n\u003cp\u003eSo, an attack can capture the security token before and then the victim will see the final link in his/her browser i.e. this link: \u003ccode\u003ehttps://en.instagram-brand.com/register/reset/\u0026lt;token\u0026gt;?email=\u0026lt;email\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eHere the attacker can smartly write an exploit that auto requests that links and changes the victim\u0026#39;s password. After this the victim will request that link in UI and will find that that link is expired, but what is actually happening is that the attacker has used that link.\u003c/p\u003e\n\n\u003cp\u003eRegards\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-16T03:08:11.395Z","updated_at":"2017-02-16T03:08:11.395Z","actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1489895,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the additional info - so it's the initial mandrillapp.com link that is using http, rather than the url on en.instagram-brand.com. Is it possible to get an `http://` version of the instagram-brand.com url (as in the initial report)?\n\nI believe this would be reasonably hard to successfully exploit, because if a user clicks on the http mandrill link and follows it through (exposing it to the MiTM attack in this scenario), they'll land on an https url on instagram-brand with a single-use token that will be invalidated upon password reset.\n\nAn attacker would need to capture that mandrill url, then follow the link and update the password themselves before the user did - which _would_ be possible for a bot to do.\n\nAnother consideration here is that the link is sent in an email, which is common practice. Emails generally aren't super secure and can themselves be susceptible to MiTM attacks - which no amount of HTTPS can fix.\n\nI do agree though that it would be better to have HTTPS on the entire chain - I'm passing this along to the client and will keep you updated.","markdown_message":"\u003cp\u003eThanks for the additional info - so it\u0026#39;s the initial mandrillapp.com link that is using http, rather than the url on en.instagram-brand.com. Is it possible to get an \u003ccode\u003ehttp://\u003c/code\u003e version of the instagram-brand.com url (as in the initial report)?\u003c/p\u003e\n\n\u003cp\u003eI believe this would be reasonably hard to successfully exploit, because if a user clicks on the http mandrill link and follows it through (exposing it to the MiTM attack in this scenario), they\u0026#39;ll land on an https url on instagram-brand with a single-use token that will be invalidated upon password reset.\u003c/p\u003e\n\n\u003cp\u003eAn attacker would need to capture that mandrill url, then follow the link and update the password themselves before the user did - which \u003cu\u003ewould\u003c/u\u003e be possible for a bot to do.\u003c/p\u003e\n\n\u003cp\u003eAnother consideration here is that the link is sent in an email, which is common practice. Emails generally aren\u0026#39;t super secure and can themselves be susceptible to MiTM attacks - which no amount of HTTPS can fix.\u003c/p\u003e\n\n\u003cp\u003eI do agree though that it would be better to have HTTPS on the entire chain - I\u0026#39;m passing this along to the client and will keep you updated.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-16T19:22:01.694Z","updated_at":"2017-02-16T19:22:01.694Z","actor":{"username":"nickdaugherty","cleared":false,"url":"/nickdaugherty","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/778/73bab647e605318906a1a3197d4e578d5dd6de30_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1491902,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-17T19:37:31.884Z","updated_at":"2017-02-17T19:37:31.884Z","actor":{"username":"vortfu","cleared":false,"url":"/vortfu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/982/1ef285fb263d30f189dc6a8038e1d5c46086e9d9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1502310,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dermeister - the client has implemented a fix - removing mandrill altogether and using direct HTTPS links instead - can you test again and let us know if you consider this fixed?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/dermeister\"\u003e@dermeister\u003c/a\u003e - the client has implemented a fix - removing mandrill altogether and using direct HTTPS links instead - can you test again and let us know if you consider this fixed?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-23T22:20:28.459Z","updated_at":"2017-02-23T22:20:28.459Z","actor":{"username":"nickdaugherty","cleared":false,"url":"/nickdaugherty","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/778/73bab647e605318906a1a3197d4e578d5dd6de30_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1502783,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickdaugherty  - This is fixed.\n\nRegards,\nDerMeister","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nickdaugherty\"\u003e@nickdaugherty\u003c/a\u003e  - This is fixed.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nDerMeister\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-24T06:51:56.730Z","updated_at":"2017-02-24T06:51:56.730Z","actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1503959,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for confirming. Closing this out, and we'll follow up with a bounty decision.","markdown_message":"\u003cp\u003eThanks for confirming. Closing this out, and we\u0026#39;ll follow up with a bounty decision.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-24T17:54:13.827Z","updated_at":"2017-02-24T17:54:13.827Z","actor":{"username":"nickdaugherty","cleared":false,"url":"/nickdaugherty","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/778/73bab647e605318906a1a3197d4e578d5dd6de30_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dermeister","url":"/dermeister"},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1504942,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cheers !","markdown_message":"\u003cp\u003eCheers !\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-25T02:43:02.216Z","updated_at":"2017-02-25T02:43:02.216Z","actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1522084,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Is this eligible for a bounty?","markdown_message":"\u003cp\u003eIs this eligible for a bounty?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-06T15:57:08.016Z","updated_at":"2017-03-06T15:57:08.016Z","actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1522499,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-06T18:35:22.816Z","updated_at":"2017-03-06T18:35:22.816Z","actor":{"url":"/automattic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Automattic"}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"automattic","collaborator":{"username":"dermeister","url":"/dermeister"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4910504,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hello Team,\n\nWould you mind a public disclosure of this bug. I want to share security testing knowledge in the community.\n\nThanks,\nSaurabh","markdown_message":"\u003cp\u003eHello Team,\u003c/p\u003e\n\n\u003cp\u003eWould you mind a public disclosure of this bug. I want to share security testing knowledge in the community.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nSaurabh\u003c/p\u003e\n","automated_response":false,"created_at":"2019-05-23T14:15:49.511Z","updated_at":"2019-05-23T14:15:49.511Z","first_to_agree":true,"actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5168552,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-22T14:15:50.406Z","updated_at":"2019-06-22T14:15:50.406Z","actor":{"url":"/automattic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Automattic"}},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5211099,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot.","markdown_message":"\u003cp\u003eThanks a lot.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-28T04:07:28.412Z","updated_at":"2019-06-28T04:07:28.412Z","actor":{"username":"dermeister","cleared":false,"url":"/dermeister","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/065/085/b14379cd81c972748951b6dd4d78f6f1dd3987d1_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}