{"id":2224,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjI0","url":"https://hackerone.com/reports/2224","title":"Bypass auth.email-domains","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-02-23T16:08:39.974Z","submitted_at":"2014-02-23T16:08:39.974Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tomvg","url":"/tomvg","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/088/bcadc0a4a87f5627226b724ae0dcacbee32cc3e7_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-03-25T18:23:30.689Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-02-24T00:59:20.472Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Email addresses are stored as `VARCHAR(128)`. However, Phabricator does not verify the length of an email address upon registration. This allows attackers to bypass the allowed email-domains defined in `auth.email-domains`.\r\n\r\nExploiting this is rather straightforward: get an email address of 128 characters long ([This StackOverflow answer](http://stackoverflow.com/a/574698/2425609) indicates that the maximum length of an email address is 254 characters). Now register with your 128 character email address with `@allowed-domain.com` appended to it. The `@allowed-domain.com` part will be truncated because MySQL can’t store it, and you will receive a verification email on your 128 character email address.\r\n\r\nThis is especially easy if you’re using a Gmail address: if you own `attacker@gmail.com`, you’ll also receive any mails sent to `attacker+aaaaaaaaaaa…aaa@gmail.com`.","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-03-25T18:23:15.928Z","allow_singular_disclosure_after":-238189457.7031593,"singular_disclosure_allowed":true,"vote_count":6,"voters":["sw33tlie","0nlymohammed","rudra_2000","fantam1","cryptographer","smither"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8982,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report, I'm confirming this now...","automated_response":false,"created_at":"2014-02-23T17:02:05.480Z","updated_at":"2014-02-23T17:02:05.480Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8997,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Yep, this reproduced easily -- working on a fix.","automated_response":false,"created_at":"2014-02-23T17:18:48.074Z","updated_at":"2014-02-23T17:18:48.074Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wow, that was fast! Great job :-)","automated_response":false,"created_at":"2014-02-23T17:23:51.956Z","updated_at":"2014-02-23T17:23:51.956Z","actor":{"username":"tomvg","cleared":false,"url":"/tomvg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/088/bcadc0a4a87f5627226b724ae0dcacbee32cc3e7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9004,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think this fixes the immediate issue:\n\nhttps://secure.phabricator.com/D8308\n\nI'm also going to add a setup warning to encourage administrators to enable STRICT_ALL_TABLES, which should blunt all truncation-based attacks of this class. Working on that now.","automated_response":false,"created_at":"2014-02-23T17:44:25.740Z","updated_at":"2014-02-23T17:44:25.740Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9008,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This changes the STRICT_ALL_TABLES setup warning to be enabled for all installs (recommending enabling it) instead of just development installs:\n\nhttps://secure.phabricator.com/D8309","automated_response":false,"created_at":"2014-02-23T18:08:55.333Z","updated_at":"2014-02-23T18:08:55.333Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9010,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have a bug-report very closely related to this one, should I make a new issue or should I just write it here?\n\n**Edit:** Given this one is closed, I'll submit new report.","automated_response":false,"created_at":"2014-02-23T18:21:31.387Z","updated_at":"2014-02-23T18:24:18.275Z","actor":{"username":"tomvg","cleared":false,"url":"/tomvg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/088/bcadc0a4a87f5627226b724ae0dcacbee32cc3e7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9011,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"D8308 is now in HEAD (https://secure.phabricator.com/rP7cf0358dda11daa9a1c75abdd2f7a254fa9ab0eb).","automated_response":false,"created_at":"2014-02-23T18:23:16.053Z","updated_at":"2014-02-23T18:23:16.053Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"tomvg","url":"/tomvg"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9013,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"The severity of this issue is mitigated somewhat by the registration approval queue, which is enabled by default. An attacker could make it into the queue, but would still require administrative approval by a human if the queue has not been disabled. Making it into the queue is bad, but not particularly severe, as it requires additional human error to escalate into access.\n\nThis also does not affect installs which exclusively use LDAP or other internal authentication sources, as many of the largest installs do, as an attacker would require credentials on the identity provider in order to make it to registration.","automated_response":false,"created_at":"2014-02-23T18:42:22.167Z","updated_at":"2014-02-23T18:42:22.167Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Phabricator"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"tomvg","url":"/tomvg"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9015,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I want to wait for D8309 to make it to HEAD before disclosing this, since I think getting installs on STRICT_ALL_TABLES is really the right solution for preventing this class of attack, but we're good to announce/disclose once that's in.\n\nAnd separate report is fine for the related issue. Thanks!","automated_response":false,"created_at":"2014-02-23T18:46:08.750Z","updated_at":"2014-02-23T18:46:08.750Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9016,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great job on getting this issue fixed so fast!","automated_response":false,"created_at":"2014-02-23T18:49:27.418Z","updated_at":"2014-02-23T18:49:27.418Z","actor":{"username":"tomvg","cleared":false,"url":"/tomvg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/088/bcadc0a4a87f5627226b724ae0dcacbee32cc3e7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9018,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"D8309 is going to land in a second, but we should wait for #2233 to resolve before announcing now since it's pretty much the same thing.","automated_response":false,"created_at":"2014-02-23T18:59:35.669Z","updated_at":"2014-02-23T18:59:35.669Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9052,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"We've disclosed this on channels we control, so it can be disclosed here at any time.","automated_response":false,"created_at":"2014-02-24T00:59:20.484Z","updated_at":"2014-02-24T00:59:20.484Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":19670,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2014-03-25T18:23:30.828Z","updated_at":"2014-03-25T18:23:30.828Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}