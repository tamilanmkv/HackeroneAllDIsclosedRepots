{"id":3370,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzcw","url":"https://hackerone.com/reports/3370","title":"Directory traversal attack in view resolver","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-03-06T11:13:20.634Z","submitted_at":"2014-03-06T11:13:20.634Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"lautis","url":"/lautis","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2014-0130"],"singular_disclosure_disabled":false,"disclosed_at":"2015-07-09T19:15:27.083Z","bug_reporter_agreed_on_going_public_at":"2015-07-09T19:15:26.661Z","team_member_agreed_on_going_public_at":"2015-06-16T19:07:55.100Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"There seems to be two cases that allow directory traversal when using wildcard URL segments that allow rendering view outside view paths.\r\n\r\nFor example, let say there is a route\r\n\r\n\tget '/help/(*action)’, controller: ‘help’\r\n\r\nand a matching controller\r\n\r\n\tclass HelpController \u003c ApplicationController\r\n\tend\r\n\r\nThis renders all views that are in 'app/views/help’ (assuming default view paths) even when matching action method is not defined.\r\n\r\nIf an attacker made a request `GET /help/../../../Gemfile`, ActionView::FileSystemResolver returns Gemfile from project root as the matching view. This simple case can be prevented using Rack::Protection::PathTraversal middleware, but it is not enabled by default in Rails. Also, there could be other mechanisms that may result in rendering views that are outside view path. Not sure if that’s the expected behaviour, but this surprised me.\r\n\r\nHowever, Rack::Protection::PathTraversal can be bypassed using backslashes: `GET /help/%5c../%5c../%5c../Gemfile`. The resolver uses Dir.glob, which escapes backslashes unless File::FNM_NOESCAPE flag is used. Rack::Protection::PathTraversal won’t intercept `'\\../'` and the resolver treats `'\\../`' as `'../'`.\r\n\r\nAttached are fixes for the mentioned vulnerabilities with test cases.","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":4047,"file_name":"0001-Do-not-escape-backslashes-in-view-paths.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/004/047/60fee926e77c2f23eeeda55cf16bdba7d7a44a0c/0001-Do-not-escape-backslashes-in-view-paths.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Do-not-escape-backslashes-in-view-paths.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Do-not-escape-backslashes-in-view-paths.patch\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=57eef5ec015dc154667e1f66a5c0bd68e82801c225a0a75f0a4b4d28a4a9b4fd","file_size":1918,"type":"text/x-c++"},{"id":4048,"file_name":"0002-Ensure-that-templates-are-within-view-paths.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/004/048/98f951bb9438a0a229b807d445c35f950ddc4cdd/0002-Ensure-that-templates-are-within-view-paths.patch?response-content-disposition=attachment%3B%20filename%3D%220002-Ensure-that-templates-are-within-view-paths.patch%22%3B%20filename%2A%3DUTF-8%27%270002-Ensure-that-templates-are-within-view-paths.patch\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3de1e8c9dbbdf3ed77bfeb40cddd17470b50023dfa11fa8dae5b4fbed7d5e018","file_size":2424,"type":"text/x-c++"}],"allow_singular_disclosure_at":"2015-07-16T19:07:55.419Z","allow_singular_disclosure_after":-196889982.21038386,"singular_disclosure_allowed":true,"vote_count":4,"voters":["trazer","cryptographer","spetr0x","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":14033,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"As discussed via email, we're going to be doing the full security release process with this one. Awaiting CVE from redhat","automated_response":false,"created_at":"2014-03-07T02:08:43.746Z","updated_at":"2014-03-07T02:09:15.217Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":14387,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"CERT has assigned the CVE identifier CVE-2014-0130 for this bug, I'll be in touch in a few days with a draft advisory","automated_response":false,"created_at":"2014-03-08T00:01:11.117Z","updated_at":"2014-03-08T00:01:11.117Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":14388,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2014-03-08T00:02:56.899Z","updated_at":"2014-03-08T00:02:56.899Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":26351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates on this? It has been a while and I haven't heard anything. If you'd like me to improve the submitted patches somehow, let me know. I'd be happy to do the work.","automated_response":false,"created_at":"2014-04-08T09:14:07.466Z","updated_at":"2014-04-08T09:14:07.466Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":27274,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nzkoz had an advisory and patches ready to go, but he went and got sick or some such :)  I'll nag him. Apologies for the delay!","automated_response":false,"created_at":"2014-04-09T13:27:19.088Z","updated_at":"2014-04-09T13:27:19.088Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":27665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @lautis, sorry for the delay, as jeremy mentioned I got sick, then so did my pregnant wife.  Should be back on deck now.\n\nI've got a few questions.  Firstly, when I apply your patch, it introduces two test failures (in master) regarding some behaviour we want to support:\n\n```ruby\n  render file: '../something'\n```\n\nSo I can't really apply a patch like that, however I thought perhaps a more aggressive approach might be justified, specifically:\n\n```ruby\ndef process(action, *args)\n  if !_valid_action_name?(action)\n    raise \"HAX\"\n  end\n```\n\nSomething like that (patch attached) would presumably solve the issue too?  Failing that, we could put similar behaviour in ImplicitRender instead of globally?","automated_response":false,"created_at":"2014-04-10T03:31:07.361Z","updated_at":"2014-04-10T03:31:07.361Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":6090,"filename":"AggressiveRejection.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/006/090/699afd040d74f56a933faa84319f9e2afee571b0/AggressiveRejection.diff?response-content-disposition=attachment%3B%20filename%3D%22AggressiveRejection.diff%22%3B%20filename%2A%3DUTF-8%27%27AggressiveRejection.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=52932692a870386aac83daad2c79878ddb9df7360e1593575c216c6727c5bd5f"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":27822,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, filtering actions should do the trick. Although \"../something\" could be a name method name and filtering would prevent dispatching that method, this doesn't sound like a reasonable use case. If '..' in method names needs to be allowed, the valid action check could be done in ImplicitRender as you suggested.\n\nAssuming that `File::FNM_NOESCAPE`is used when looking up templates, the following logic should prevent path traversal outside controller path:\n\n```ruby\n!Pathname.new(action_name.to_s).cleanpath.to_s.start_with?('..')\n```\n\nAttached is a patch that would implement that by adding the condition to `available_action?`.","automated_response":false,"created_at":"2014-04-10T14:03:24.305Z","updated_at":"2014-04-10T14:03:24.305Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":6121,"filename":"0002-Prevent-path-traversal-for-implicit-render.patch","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/006/121/4e689072fe9efa572c2e2fc69440fd16d2a1abac/0002-Prevent-path-traversal-for-implicit-render.patch?response-content-disposition=attachment%3B%20filename%3D%220002-Prevent-path-traversal-for-implicit-render.patch%22%3B%20filename%2A%3DUTF-8%27%270002-Prevent-path-traversal-for-implicit-render.patch\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c434cf0753931975322f3e6395d6c678ffbd76309a34ba212bc0e0d31f221667"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":30586,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @lautis.\n\nI just tested your patches and seems your last one still allow traversal lookup. `available_action?` is not used in our code and I believe we should check the action name on `process`. I tried to reproduce the issue on our test suite but I still don't have success.\n\nI also agree with @nzkoz and believe we should not allow `.` or `File::SEPARATOR` on action names. Do you have any example where they are  desired?\n\nI attached a version of your patch that fixes the issue but takes the same aggressive path than @nzkoz's patch.\n\n Let me know what you think. I'll continue to try to get a failing test.\n\n","automated_response":false,"created_at":"2014-04-15T02:22:44.487Z","updated_at":"2014-04-15T02:22:44.487Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":6534,"filename":"file_separator_rejection.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/006/534/567cef2c4f72d460d8c509664a1dc0dccdeed312/file_separator_rejection.diff?response-content-disposition=attachment%3B%20filename%3D%22file_separator_rejection.diff%22%3B%20filename%2A%3DUTF-8%27%27file_separator_rejection.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=1be8e6705f86e7b201e65532124dc82c265b708e917a3c3b955bf2cdbae35da7"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":30603,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Attached is the test case for this issue. It is failing with your last path and it is passing with my patch.","automated_response":false,"created_at":"2014-04-15T03:04:05.037Z","updated_at":"2014-04-15T03:04:05.037Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":6536,"filename":"test_case.diff","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/006/536/1d7e384d12e2afbe7ae9fb67926d317c794048a6/test_case.diff?response-content-disposition=attachment%3B%20filename%3D%22test_case.diff%22%3B%20filename%2A%3DUTF-8%27%27test_case.diff\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4958e8afdbc53cf96298a3874098c1b5838c5987f52105472bdf135a993fb4da"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":31295,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Not allowing file separators seems reasonable. I can't figure out a case where that would be wanted either as file extensions won't affect the `action_name`. \n\nApplying your patch also fixes the original app where the issue was original found, so looks good to me.","automated_response":false,"created_at":"2014-04-16T14:28:54.959Z","updated_at":"2014-04-16T14:28:54.959Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":31304,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"On a second thought, I think my patch may be too aggressive. What if users want to allow `help/my_valid_folder/my_valid_file.html`? I believe it will not work anymore.\n\nI'll do more tests later this week but I think this is a valid use case that may not work after my patch.","automated_response":false,"created_at":"2014-04-16T14:52:01.581Z","updated_at":"2014-04-16T14:52:01.581Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":31314,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That particular case works. Only `my_valid_file` is used as action name, html would be assigned to request.format (IIRC) and used in template lookup. Multiple dots probably won't work, e.g. `help/my_valid_folder/my_valid_file.js.html`. Also, directories like `help/foo.bar/my_valid_file` wouldn't work.","automated_response":false,"created_at":"2014-04-16T15:13:00.440Z","updated_at":"2014-04-16T15:13:21.863Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":31539,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Personally, I'd rather we broke the `help/my_valid_folder/my_valid_file.html` case.\n\nIf people really need that functionality they can call the parameter something else, then pass the argument to `render file: params[:crazyperson]` ?","automated_response":false,"created_at":"2014-04-16T21:37:48.290Z","updated_at":"2014-04-16T21:37:48.290Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":32041,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes. I think we can broke it.\n\nSo I improved the patch a little.","automated_response":false,"created_at":"2014-04-17T20:00:58.638Z","updated_at":"2014-04-17T20:00:58.638Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":6735,"filename":"0001-Only-accept-actions-without-File-SEPARATOR-in-the-na.patch","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/006/735/f9fa95d95a793378be44bad404e95109061254a3/0001-Only-accept-actions-without-File-SEPARATOR-in-the-na.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Only-accept-actions-without-File-SEPARATOR-in-the-na.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Only-accept-actions-without-File-SEPARATOR-in-the-na.patch\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c9e8b4c2fdc4039912ce3a25a0cfcb604b234460328db156558b6999409061f0"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":33718,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ropping path traversal with implicit rendering does indeed sound better than having a inplementation full of caveats. That said, dropping the feature in a patch release – even if its existence was an accident – is seems like a bit of a dick move to me.  If you're OK with the approach, it might just be me worrying needlessly.\n\nI can work on the Pathname approach if you think that path traversal with implicit rendering is worth supporting in the near future releases.","automated_response":false,"created_at":"2014-04-21T05:19:59.548Z","updated_at":"2014-04-21T05:19:59.548Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":35082,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Would the render file: params[:something_else] case work in your app?  If restoring the functionality is as simple as an explicit render call and a param change, I wouldn't be too worried about breaking this.\n\nWe frequently have to break things people 'want' when doing security fixes, so long as there's a way to get the old behaviour back (sort of an inverted work-around) then it's not a huge deal.","automated_response":false,"created_at":"2014-04-21T21:01:13.937Z","updated_at":"2014-04-21T21:01:13.937Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":35125,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure, it can be implemented with a ~4 LoC controller action (i.e. do the file separator rejection / resolve path). Not a big deal.\n\nI understand that security fixes sometimes must break things. E.g. to fix CVE-2011-0447, the CSRF handling had to be changed quite a bit for end-user. However, in this particular case, changing existing behaviour doesn't seem necessary, although I can see that it is desirable at least in the long run. ","automated_response":false,"created_at":"2014-04-21T21:13:41.544Z","updated_at":"2014-04-21T21:13:41.544Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":36017,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, after applying these patches, the directory traversal seems to be fixed in my app. The side-effects for existing apps are minimised and the fix is only applied to ImplicitRendering. File and directory names with dots should still work.","automated_response":false,"created_at":"2014-04-22T14:06:54.820Z","updated_at":"2014-04-22T14:06:54.820Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":7240,"filename":"0001-Do-not-escape-backslashes-in-view-paths.patch","type":"text/x-c++","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/007/240/40ca74052e78fbde3ba2d2f34210b04226f5038b/0001-Do-not-escape-backslashes-in-view-paths.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Do-not-escape-backslashes-in-view-paths.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Do-not-escape-backslashes-in-view-paths.patch\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=16dd696539acb8a66424c8422b2f7c3915492bad25a076f72007fab822475d10"},{"id":7241,"filename":"0002-Prevent-path-traversal-for-implicit-render.patch","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/007/241/97b943bc9f8bcd4bed2984c85cdcdb468d0f827b/0002-Prevent-path-traversal-for-implicit-render.patch?response-content-disposition=attachment%3B%20filename%3D%220002-Prevent-path-traversal-for-implicit-render.patch%22%3B%20filename%2A%3DUTF-8%27%270002-Prevent-path-traversal-for-implicit-render.patch\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=9a10bdddf1b7888bc2dc243c0853fd567fc1e03dd5b3d76c61fa21dce444be9e"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":36756,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"OK, I'll amend the advisory to include information about what it breaks an post a new draft here today.\n\nI'm still not sure why we need the `FNM_NOESCAPE` change though?  ","automated_response":false,"created_at":"2014-04-22T21:52:39.092Z","updated_at":"2014-04-22T21:52:39.092Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":36777,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I believe we should not patch `method_for_action`. This method is override on subclasses and we don't have guarantee people is calling `super` on these subclasses. This is why I added a new private method and called it on the expected places. But maybe I'm over cautious. What do you guys think?\n\nAlso, the new patch is missing the test that actually asserts this issue will not regret. I think we should include it. ","automated_response":false,"created_at":"2014-04-22T22:11:10.896Z","updated_at":"2014-04-22T22:11:10.896Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":36818,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nzkoz, `Dir.glob(\"..\")` and `Dir.glob(\".\\\\.\")` are equivalent unless `FNM_NOESCAPE` flag is set. By using backslashes, you could circumvent filters from behaving properly. In this case,  `GET /help/%5c../%5c../%5c../Gemfile` would again allow directory traversal, but also some other views/templates might get unexpectedly rendered in other situations.\n\n@rafaelfranca, I tried to limit the patch to only deal with implicit rendering. I find your approach of adding new method to ActionController::Base reasonable, too. The gist is that if `_valid_action_name?` was implemented as\n\n```ruby\ndef _valid_action_name?(action_name)\n  !Pathname.new(action_name.to_s).cleanpath.to_s.start_with?(\"..\")\nend \n```\n\nonly directory traversal would be prevented, but otherwise current behaviour would not change. `FNM_NOESCAPE` must be used in this case to prevent circumventing the filter.","automated_response":false,"created_at":"2014-04-22T23:44:14.564Z","updated_at":"2014-04-22T23:44:14.564Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":36822,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It might be worth mentioning that [Rack::Protection::PathTraversal](https://github.com/rkh/rack-protection/blob/master/lib/rack/protection/path_traversal.rb) approaches this by sanitising method names so that path traversal is removed. However, it doesn't account for backslashed being ignored in `Dir.glob` and hence isn't enough to protect against directory traversal unless `FNM_NOESCAPE` is used.\n\nThat gem/middleware would provide reasonable protection should support for globbed routes with implicit rendering be removed.","automated_response":false,"created_at":"2014-04-22T23:54:17.486Z","updated_at":"2014-04-22T23:54:17.486Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":36858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That's why I prefer @rafaelfranca's approach:\n\n```ruby\n     def _valid_action_name?(action_name)\n       action_name.to_s !~ Regexp.new(File::SEPARATOR)\n     end\n```\n\nIn that scenario, we don't need to worry about `FNM_NOESCAPE` right?","automated_response":false,"created_at":"2014-04-23T03:46:02.410Z","updated_at":"2014-04-23T03:46:02.410Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":37094,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Implicit rendering should be safe. However, when you implement the wildcard rendering yourself, you'd need to know that backslashes are ignored when filtering allowed actions/templates.\n\nLet's say you have action that accepts globbed route parameter `template`:\n\n```ruby\n def show_page\n   render sanitize(params[:template] || \"index\")\n end\n```\n\nWhen implementing the `sanitize` method, you not only need to be able to prevent input such as `\"../../config/secrets.yml\"`, but also `\".\\\\./\\\\../config/secrets.yml\"`, The approach used in Rack::Protection::PathTraversal or Pathname won't work unless either `FNM_NOESCAPE` is used in `PathResolver` or you remove the backslashes from the input. It's very easy to leave your application vulnerable to path traversal attacks if you aren't aware of this implementation detail in PathResolver.\n","automated_response":false,"created_at":"2014-04-23T12:25:44.769Z","updated_at":"2014-04-23T12:25:44.769Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":39902,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's an amended advisory which shows what you should do if you're relying on that functionality.  Is it clear, have I made any errors?","automated_response":false,"created_at":"2014-04-28T00:04:28.670Z","updated_at":"2014-04-28T00:04:28.670Z","actor":{"username":"nzkoz","cleared":false,"url":"/nzkoz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/317/11e8edc22329e340906e362e4f8d431cd6797787_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":7768,"filename":"advisory.txt","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/007/768/55236b7b92b8a67346583669c97cb4b37903353e/advisory.txt?response-content-disposition=attachment%3B%20filename%3D%22advisory.txt%22%3B%20filename%2A%3DUTF-8%27%27advisory.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144737Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3eac4ef9768853414bb1df6e94374f4341aaf5963a51df64eb28e790399e66c7"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":40536,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It is clear and I couldn't find any errors. `.index('.')` is very simple workaround, :+1:.","automated_response":false,"created_at":"2014-04-28T18:16:27.228Z","updated_at":"2014-04-28T18:16:27.228Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":49932,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Issue was already made public at https://groups.google.com/d/msg/rubyonrails-security/NkKc7vTW70o/NxW_PDBSG3AJ and all the supported versions were released with the fix.","automated_response":false,"created_at":"2014-05-13T14:33:41.291Z","updated_at":"2014-05-13T14:35:16.111Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"lautis","url":"/lautis"},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":78981,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2014-06-25T18:01:59.365Z","updated_at":"2014-06-25T18:01:59.365Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Ruby on Rails"}},"bounty_amount":"1500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"rails","collaborator":{"username":"lautis","url":"/lautis"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":474485,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-06-16T19:07:55.173Z","updated_at":"2015-06-16T19:07:55.173Z","first_to_agree":true,"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":504084,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2015-07-09T19:15:26.775Z","updated_at":"2015-07-09T19:15:26.775Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":504085,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-07-09T19:15:36.748Z","updated_at":"2015-07-09T19:15:36.748Z","actor":{"username":"lautis","cleared":false,"url":"/lautis","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}