{"id":348443,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDg0NDM=","url":"https://hackerone.com/reports/348443","title":"Snippet JS template allows attacker to read a user's private snippets","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-05-08T03:09:57.685Z","submitted_at":"2018-05-08T03:09:57.685Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-03-03T03:03:14.355Z","bug_reporter_agreed_on_going_public_at":"2019-02-01T03:03:12.980Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"These days snippets can be embedded in a site other than the GitLab instance. An embed link is only generated for public snippets, as can be seen in the `app/views/shared/snippets/_header.html.haml`:\n\n```haml\n  - if public_snippet?\n    .embed-snippet\n      .input-group\n        .input-group-btn\n          %button.btn.embed-toggle{ 'data-toggle': 'dropdown', type: 'button' }\n            %span.js-embed-action= _(\"Embed\")\n            = sprite_icon('angle-down', size: 12)\n          %ul.dropdown-menu.dropdown-menu-selectable.embed-toggle-list\n```\n\nWhen visiting a public snippet, the embed link is shown at the top of the page, as such:\n\n{F294865}\n\nAs you can see, there's no entropy other than the snippet ID, which is an auto incrementing ID. It turns out that the controller itself doesn't limit the user to generate a JS template for a private snippet though. When appending `.js` to a private snippet, it'll return the JavaScript template, which contains the contents of a private snippet. This can be used to access a private snippet the attacker doesn't have access to from a 3rd party website.\n\nTo reproduce, sign in on gitlab.com and create a private snippet. For the sake of the PoC, let's create global snippet (not one that is tied to a project). It also works with a project, but in that case the attacker has to know the namespace and project path. Here's a PoC that'll call the `alert` function with the first line of a private snippet:\n\n```html\n\u003chtml\u003e\n\u003chead\u003e\n\u003cstyle\u003e\n.gitlab-embed-snippets {\n  display: none;\n}\n\u003c/style\u003e\n\u003cscript src=\"https://gitlab.com/snippets/1714319.js\"\u003e\u003c/script\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cscript\u003e\n    alert(document.getElementById('LC1').innerHTML);\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\nSimply replace the snippet ID in the `script` tag with whichever snippet ID the private snippet has. Save the HTML and load it from any other location, e.g. localhost or some domain. You'll notice that it'll alert the first line of the contents:\n\n{F294866}\n\n## Impact\n\nAn attacker could enumerate IDs and inject multiple `script` tags to try to determine the contents of private snippets. Not knowing which snippet IDs belong to a user increases the attack complexity, which lowers the overall severity of the vulnerability. Private snippets may contain sensitive information that is not supposed to be viewable to anyone outside of the creator itself.","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":294865,"file_name":"Screen_Shot_2018-05-07_at_8.01.10_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/294/865/def9787308ff6216542c698a74c4ac7ed1c97f0a/Screen_Shot_2018-05-07_at_8.01.10_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-05-07_at_8.01.10_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-05-07_at_8.01.10_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144903Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=0ed96669c072339048d2c7bddeadd9dd263838ed9ac998bf1cdaa6766d8ef8db","file_size":89829,"type":"image/png"},{"id":294866,"file_name":"Screen_Shot_2018-05-07_at_8.05.10_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/294/866/6c9b2b114e2b4c501e553d632815d1a9edb03329/Screen_Shot_2018-05-07_at_8.05.10_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-05-07_at_8.05.10_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-05-07_at_8.05.10_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZ6XJQAFX%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144903Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCICOXvTwruabcCgvIvFwMLdD63I7wJU77da1qgiZ0fcgxAiEA2iE07eZZp56fgfdC8AqwOSxwRZmRPTllfbb0Tbxm9MYqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDDj8b5u85%2FF%2BsdTPzirXA4Q26F09GEsezqo%2FDgU%2BN1ov6Z0mJp8NxapcqVf3Oua4oSgb5aQpGLsAXhdiEaUoWsXCtHv4ujnK6mqk7E9O2WKXNjLPpfRYiEQ71CFLUQhpz1VlTUi8AaLKGm2tOz7W6Dg1b3xxjZfihfmfR6OPDce2Z600EmMbP%2BHpciOGhSEuGzpexDOGRgw4ix10R9155b0anW3PU4UD8Ge2PEqMj3%2FF8sUIZw7AbQUjqw1Ce9mhpbUZZfOQoy0pJ2t8c2T4BgwOhgN1b3fN5pnsElvfIuzUPOy6b490pAv%2BCqmrijPnhfxCFLh0JKO8JRVj8XuMyTl5hv6jZDQVsJsMAcXPrqar7TkmvMjkI%2BN4yDBkbH5NrA1VDNa0of9Y0Ob501UWmq3Ap93egI9bfOc0SJJuPizy58SnDrtHr6nSjyefAjpNL04P0FK2SzeJsSTTwhywI6YMiTBjKrFeC2gfVf8aFUGCIZ5qqWFJVDfVcx%2Fn8CXnNOSFJ4E0AOZCD2bzMOr0zl8cL%2FhRzxRrehVzw%2FTkoxOt0l7KmRzdTPKmnS8oozD2Cyle0v45%2B7sfTk9r6klH%2F2VLwfVaCQMt2wCz6DqzbD4MYWDvCaIbvvrbK5sZIedyaPkbcLAvRDDCjpGLBjqlAU9SRSSUKO2aO0kQO%2BnmnceQh7DtfcGkOUk0CXICIwNK0fD%2BqaMjTEwcyVBBW5oqUBOFZj7aKeXh%2FN47wB%2B%2BNyAlnunaZYfVUOsQGCMywCeVElq5cKhikJpo4VRBfaWxpOo%2Fjfp%2BVIoSdni5MQ6uLsqSIiA%2Fcm2GDHTprLxSZr5sstp5PxiiN53WteMJJW5bqZgjokn7B89wleOrzCJV84UVJ4OV7g%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=d80d504273ea7782365273e0dfdf4dfe23fc6212f51453f8b300c7bf9ecacce3","file_size":220949,"type":"image/png"}],"allow_singular_disclosure_at":"2019-03-03T03:03:13.076Z","allow_singular_disclosure_after":-82381550.58552028,"singular_disclosure_allowed":true,"vote_count":163,"voters":["8ayac","mashoud1122","bl4de","sameerphad72","mahatmacrond","mik317","dhakal_ananda","verichains","ali","amad3u6","and 153 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2726440,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jobert  ,\n\nThank you for submitting this report. We are currently investigating the issue. Due to our current workload, we will get back with you within the next week with an update.\n\nBest regards,\nJames","automated_response":false,"created_at":"2018-05-10T20:32:58.247Z","updated_at":"2018-05-10T20:32:58.247Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2798491,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi @jobert,\n\nWere you able to do this in a browser window that was not logged in as the owner of the snippet?  I was unable to reproduce the results by using a new private browser window.  Directly requesting the \"/snippet/xxxxx.js\" using wget failed with an authentication error as well.\n\nRegards,\nAntony","automated_response":false,"created_at":"2018-05-25T22:51:35.442Z","updated_at":"2018-05-25T22:51:35.442Z","actor":{"username":"asaba","cleared":false,"url":"/asaba","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/261/798/9526c5243e43f554dd0a5b900547c1f5ea6751ea_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2885704,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @asaba - no, it only works if an attacker were to have a victim click on a link. It could then execute the payload and download the victim's private snippets. This isn't an IDOR vulnerability. Sorry for the delay by the way, I was out traveling. Let me know if you need any additional information.","automated_response":false,"created_at":"2018-06-14T20:26:33.502Z","updated_at":"2018-06-14T20:26:33.502Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2917385,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2018-06-21T19:27:07.946Z","updated_at":"2018-06-21T19:27:07.946Z","additional_data":{"old_severity":"Medium (5.3)","new_severity":"Low","old_severity_id":150417,"new_severity_id":171470},"actor":{"username":"asaba","cleared":false,"url":"/asaba","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/261/798/9526c5243e43f554dd0a5b900547c1f5ea6751ea_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2917526,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jobert ,\n\nWe have classified this as low since it primarily relies on permissions the owning user already has, but violates best practices around using autoincrementing IDs.\n\nWe are tracking progress internally here: https://gitlab.com/gitlab-org/gitlab-ce/issues/48259.  We will disclose this report 30 days after the patch is released.\n\nRegards,\nGitLab Security Team","automated_response":false,"created_at":"2018-06-21T19:55:39.927Z","updated_at":"2018-06-21T19:55:39.927Z","actor":{"username":"asaba","cleared":false,"url":"/asaba","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/261/798/9526c5243e43f554dd0a5b900547c1f5ea6751ea_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2917528,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-06-21T19:56:24.167Z","updated_at":"2018-06-21T19:56:24.167Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"300.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"jobert","url":"/jobert"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2919735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"👍","automated_response":false,"created_at":"2018-06-22T06:01:00.128Z","updated_at":"2018-06-22T06:01:00.128Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2923426,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-06-22T19:24:42.810Z","updated_at":"2018-06-22T19:24:42.810Z","actor":{"username":"asaba","cleared":false,"url":"/asaba","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/261/798/9526c5243e43f554dd0a5b900547c1f5ea6751ea_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3633890,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2018-11-13T12:30:56.225Z","updated_at":"2018-11-13T12:30:56.225Z","additional_data":{"duplicate_report_id":438878},"actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4074228,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThank you again for the report! Your finding has been patched in GitLab version 11.6.1.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-01-31T23:32:32.644Z","updated_at":"2019-01-31T23:32:32.644Z","actor":{"username":"asaba","cleared":false,"url":"/asaba","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/261/798/9526c5243e43f554dd0a5b900547c1f5ea6751ea_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4075683,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks @asaba!","automated_response":false,"created_at":"2019-02-01T03:03:13.007Z","updated_at":"2019-02-01T03:03:13.007Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4245410,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-03-03T03:03:14.384Z","updated_at":"2019-03-03T03:03:14.384Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}