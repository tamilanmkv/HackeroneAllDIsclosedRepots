{"id":88395,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84ODM5NQ==","url":"https://hackerone.com/reports/88395","title":"Information leakage through Graphviz blocks","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-09-11T01:18:57.641Z","submitted_at":"2015-09-11T01:18:57.641Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jbeta","url":"/jbeta","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/121/4bec56bea4aee1feb6535cb0727421420ab1e874_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-09-13T19:55:14.805Z","bug_reporter_agreed_on_going_public_at":"2015-09-13T19:55:14.657Z","team_member_agreed_on_going_public_at":"2015-09-13T19:52:48.153Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"(This report amounts to *Unsandboxed Command Execution Considered Harmful*, which you already suspected: https://secure.phabricator.com/T7785)\r\n\r\nGraphviz blocks can be used to view a render of any image file readable by the webserver, through the `image` and `shapefile` graph node attributes. This alone leaks some information (for example, installed software packages), and may help bypass access restrictions on Phabricator image files (if local disk file storage is used and the path is somehow known to the attacker).\r\n\r\nCombined with a strategically-placed syntax error in the graph specification to get to the `dot` error output, these attributes can more generally be used by an attacker to test for existence and readability of any file in the server.\r\n\r\nSteps to reproduce\r\n================\r\n* Install Graphviz along with Phabricator\r\n* Paste the attached snippet in a Remarkup field\r\n* Experience slight feelings of unease and discomfort\r\n\r\nImpact\r\n======\r\nNormally, just the limited information disclosure described above. In (what I imagine to be) a typical Phabricator installation, not even that: it is probably fully defused by the fact that `dot` is not present. However, some users may have installed Graphviz for purposes unrelated to Phabricator, unaware of the security implications.\r\n\r\nIn general, `dot` is much more complex than `cowsay` and running it unsandboxed increases your attack surface in a significant way. Besides Graphviz bugs, you will also have to worry about any libraries that Graphviz plugins use, especially for complex image formats such as PostScript and SVG.\r\n\r\n(In fact, current `dot` **will** happily tell GhostScript to run a PS file that may contain arbitrary commands. This requires a specific *\"dot with gs support + old gs\"* setup not found in any current distro AFAIK.)","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":53457,"file_name":"phab-graphviz-poc.remarkup","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/053/457/a4398e1dddb1e8feb0eae018b1d9130dcef8ec91/phab-graphviz-poc.remarkup?response-content-disposition=attachment%3B%20filename%3D%22phab-graphviz-poc.remarkup%22%3B%20filename%2A%3DUTF-8%27%27phab-graphviz-poc.remarkup\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYC7ZV3WT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153753Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIDrMLp4%2BWn0RnMngqqBOAomCU8GWEnyzbfeWXMTkRqdkAiEAmbCt%2FtYvzimCcqsBY5T%2BAP6C1koJvsZIEr7pm24tsEAqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDHO5iuzPFsJ4aK7KmSrXA43fG9ZExUYtmldfJFAHkWRlov9q%2FHMMPiqI7JWoul8iB2lnCe0Z8UD9oM5cfjZfhntNLx94myZGJfeT24YbqZ%2BCsOqn%2BPXRlK7VWqoq1AV8zdBtboSY1qGlF1yW0h8xQvR1G807ShHTgDzCxdIUl0y2PUXdt%2BRNIlHckLFzjBfbJBmGFikh%2B68wwr3qhH%2BRekBJT8dRJqkMmVmJIoL4rn3y%2FCM010RJxL86Xuoat%2BrN046smSjkfceh4bPaJkOADf33dP%2FBliSDcBjoMG74ZFHPAmgnqoN439xdfqhUpIPqNFrcRU1WpQhc12VYut5tMZcbmJchXopaXhvm%2B4orW3DihHvyn7HD%2BiT1cpN9baXaycQzr%2B68J9MyG01Zce8VNQxPm5eRp7v9dtdfEQ9sF3yuOsWzUwY%2BTHCD7SIcVsQFrS5Z2L5Ux3CncTXxkqQVlNCyHTcJODpncVKfD7b6uHxsAmVawhDDZJgLpATJPpVIaGa0em09aEDUcT%2FuazJtx1N1gOr8ZYZSsD6LmJlT7xfEsyzeZ%2BC%2FQQSJKyYRebEtRjLR%2BsYz4MKD2jlXjj62sVdjHko29e6c4eso%2Fx8%2Bjrkj%2BYuyD88VzMWxszti4qHccB7%2Fr3%2BsDzDViZGLBjqlAc5vcHGjagoOTjMDz6VCxHAyKKMhBY%2F4ksl1iKt3Mkg6KIb8dD7WB3B5bRwalHdLpA6q%2F0HyHwVC3k8nRLkVacoHC%2BTnF8IsDYgQMa3VWvq9UB5BqCGPwIE9Smv%2FlQf6eGWyrcOO%2Brsi6UGSaKxoz3eFt2y8zMnz71sdDkZshTNAZoB15M%2BSMQApjyeteOn3dhbojlsBvMBhOE%2FWaBGY2zXmhSJaSA%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=41172388783f137ddf0e846456a9b10704ed943d255467446aff177644eff097","file_size":635,"type":"text/plain"}],"allow_singular_disclosure_at":"2015-10-13T19:52:48.320Z","allow_singular_disclosure_after":-189200704.86916623,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":584595,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report! Yeah, this is approximately the kind of thing that I imagined might exist.\n\nI think the way forward is probably just to remove these commands from the core, since the approach is unsafe and expecting end users to configure sandbox environments in a safe way is impractical. Building these rules in the first place was likely an error in judgement on my part.\n\nI think we can write safe PHP implementations of `cowsay` and `figlet` in a few hours since they're fluff, but there's probably not much to be done for `dot`. We can throw it up on \"Community Resources\" and stamp it with a bunch of \"inherently insecure\" warnings for installs that use it and don't care about the security implications. At some point, we can find or build some similar feature with a more appropriate trust model.\n\nThis week's release has a lot of stuff happening already, and these attacks are not particularly severe, and removing these features will require some documentation/guidance for installs. Consequently, I'm not planning to address this in the next 24 hours, but can likely sort it out on Saturday if nothing catches on fire (that is, I anticipate fixing this within about 48 hours).","automated_response":false,"created_at":"2015-09-11T01:42:49.599Z","updated_at":"2015-09-11T01:42:49.599Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":586586,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just a quick update: a lot of unrelated stuff came up today so I think I won't actually get to this until tomorrow.","automated_response":false,"created_at":"2015-09-12T22:58:15.322Z","updated_at":"2015-09-12T22:58:15.322Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":586640,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oh there's no rush.\n\nI expect a *very* low bodycount due to this bug.","automated_response":false,"created_at":"2015-09-13T03:34:36.067Z","updated_at":"2015-09-13T03:34:36.067Z","actor":{"username":"jbeta","cleared":false,"url":"/jbeta","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/121/4bec56bea4aee1feb6535cb0727421420ab1e874_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":586986,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"I believe this is now defused in the upstream. Guidance for installs is here:\n\nhttps://secure.phabricator.com/T9408\n\nBriefly: `cowsay` and `figlet` now have pure PHP implementations. `dot` has been removed as I see no way to make it safe and or write an alternate renderer in a reasonable amount of time.","automated_response":false,"created_at":"2015-09-13T19:37:12.745Z","updated_at":"2015-09-13T19:37:12.745Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jbeta","url":"/jbeta"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":586990,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"In assessing an award amount, I am primarily considering the relatively low severity of the attack (usually, minor information disclosure about system state), the moderate complexity in executing it (usually, the attacker must have an account and the administrator must have installed `dot`), and the upstream's suspicions that attacks in this vein were likely to exist.","automated_response":false,"created_at":"2015-09-13T19:51:36.673Z","updated_at":"2015-09-13T19:51:36.673Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Phabricator"}},"bounty_amount":"300.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"jbeta","url":"/jbeta"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":586991,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"The fixes for this issue and guidance for installs are now publicly available, so it can be disclosed at any time.\n\nThanks again!","automated_response":false,"created_at":"2015-09-13T19:52:48.186Z","updated_at":"2015-09-13T19:52:48.186Z","first_to_agree":true,"actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":586992,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the bounty!\n\nAs always: a pleasure reporting to you guys.","automated_response":false,"created_at":"2015-09-13T19:55:14.696Z","updated_at":"2015-09-13T19:55:14.696Z","actor":{"username":"jbeta","cleared":false,"url":"/jbeta","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/121/4bec56bea4aee1feb6535cb0727421420ab1e874_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":586993,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2015-09-13T19:55:14.831Z","updated_at":"2015-09-13T19:55:14.831Z","actor":{"username":"jbeta","cleared":false,"url":"/jbeta","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/121/4bec56bea4aee1feb6535cb0727421420ab1e874_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}