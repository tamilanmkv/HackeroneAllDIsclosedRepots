{"id":674195,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NzQxOTU=","url":"https://hackerone.com/reports/674195","title":"Stealing data from customers.gitlab.com without user interaction","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-08-15T00:14:09.831Z","submitted_at":"2019-08-15T00:14:09.831Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rpadovani","url":"/rpadovani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-26T14:02:00.620Z","bug_reporter_agreed_on_going_public_at":"2019-10-22T10:54:16.347Z","team_member_agreed_on_going_public_at":"2020-08-26T14:02:00.417Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nAn attacker can link her own customers.gitlab.com account to the one of the victim, and these give access to 3 different vulnerabilities:\n- destroying subscriptions of the victim\n- buying new subscriptions using victim credit card for its own groups\n- some (minor) information disclosure about what is over Gitlab.com\n\n### Steps to reproduce\n\nThe attacker registers herself on customers.gitlab.com, logging in using her Gitlab.com account. \nAfter that, she updates her customers.gitlab.com account and link it to the victim's Gitlab account through the victim's account userId (they are sequential and they are not secret, so no problem retrieving it).\n\nThis update is quite easy, attacker needs only to copy how \"Update Account\" HTTP request, and change the `customer%5Buid%5D` field, like this:\n\n```\nawait fetch(\"https://customers.gitlab.com/customers\", {\n    \"credentials\": \"include\",\n    \"referrer\": \"https://customers.gitlab.com/customers/edit\",\n    \"body\": \"utf8=%E2%9C%93\u0026_method=patch\u0026authenticity_token=YOquJGc9evhkHMfLOZljuw9OcDn0gtJw8AHPb0yVhyml9q1TISGHa%2FK57DAlg8jB%2BEqvJYYob26BRgx4sZbRzg%3D%3D\u0026customer%5Bfirst_name%5D=Riccardo\u0026customer%5Blast_name%5D=Padovani\u0026customer%5Baddress_1%5D=\u0026customer%5Baddress_2%5D=\u0026customer%5Bcity%5D=Munich\u0026customer%5Bzip_code%5D=81479\u0026customer%5Bcountry%5D=DEU\u0026customer%5Bstate%5D=BY\u0026customer%5Bvat_code%5D=\u0026customer%5Bcompany%5D=Riccardo+Padovani\u0026customer%5Bemail%5D=hackerone1%40rpadovani.com\u0026customer%5Bprovider%5D=gitlab\u0026customer%5Buid%5D=VICTIM_ID\",\n    \"method\": \"POST\",\n    \"mode\": \"cors\"\n});\n```\n\nThe backend will validate the input, and now the two accounts are somehow linked.\n\n### Impact\n\n- When the victim will login again, all his subscriptions will be lost\n- If the victim updates his data after the attack, the attacker account will be updated with the same data, INCLUDING CREDIT CARD. The attacker can now purchase plans using victim's credit card\n- Attacker has also a list of teams victim is owner, when she purchases a new plan.\n\nIf attacker wants to purchase a plan for her own group, she can nominate victim owner, so now attacker's group will be in the dropdown, buy the plan, remove the victim.\n\n### Examples\n\nI attached a video with all these attacks, sorry but it is a bit messy.\nOn the left there is victim's browser, on the right attacker's browser. When it appears a console, is for the attacker's browser. The attacker's is in a private session, so it is completely separated from the victim.\n\n0:00-0:10: we see victim has a subscription, and attacker no. They also have different data\n0:10-0:40: attacker does a first attack, changing both uid and email, and it doesn't work\n0:40-1:10: attacker does a proper attack, changing only uid. Notice how bottom right the Gitlab.com account changes\n1:10-1:30: nothing else has changed\n1:30-1:50: victim does log out and login again and ALL DATA AND SUBSCRIPTIONS ARE GONE\n\nYou can skip to\n2:30-2:40: victim updates his data, also attacker's data are updated accordingly\n2:40-4:30: victim buys a new subscription \n4:30-5:00: attackers can use victim's credit card\n\n### What is the current *bug* behavior?\n\ncustomers.gitlab.com user can update its link to Gitlab.com without any verification\n\n### End notes:\n\nI'd like you also reset my customers.gitlab.com accounts, now they are all a bit a mess.\n\nAlso, while testing I think I associated my customers.gitlab.com account with Gitlab's account with UID 1 due an error in copy-paste. I removed immediately the link, but maybe you should check if the link is indeed being delete, and say sorry on my behalf to Sid!\n\nI noticed that in the video it appears my CC data - so please do not disclose the issue, also on the Gitlab.com issue tracker, without removing the video first, please!\n\n## Impact\n\nAttackers can steal victim's data, including last 4 numbers of CC, and use victim's CC to buy subscriptions","bounty_amount":"3500.0","formatted_bounty":"$3,500","weakness":{"id":55,"name":"Insecure Direct Object Reference (IDOR)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":20,"voters":["sky003","ali","9529","abdilahrf_","sa1tama0","cryptographer","modx21","awsx123","tholu","blu3b3ard","and 10 more..."],"severity":{"rating":"high","score":8.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"high"}},"structured_scope":{"databaseId":18134,"asset_type":"URL","asset_identifier":"customers.gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":5580318,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rpadovani,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 7 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2019-08-15T00:20:13.197Z","updated_at":"2019-08-15T00:20:13.197Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5611590,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2019-08-19T22:30:05.795Z","updated_at":"2019-08-19T22:30:05.795Z","additional_data":{"old_severity":"Critical (9.8)","new_severity":"High (8.1)","old_severity_id":493381,"new_severity_id":496454},"actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5619798,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-08-20T18:05:23.034Z","updated_at":"2019-08-20T18:05:23.034Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5619802,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @rpadovani ,\n\nThank you again for the report! Your finding has been reviewed and we are awarding a bounty prior the release of a patch. \n\nAlthough this is not the first report for this issue, it has demonstrated the full impact of the problem. The reward will be of High severity and split between both reports due to https://hackerone.com/reports/507321 being the original and this one demonstrating a more severe impact.\n\nCongratulations!\n\nWe will continue to keep you updated via HackerOne as a fix is scheduled.\n\nBest regards,\nSecurity Team | GitLab Inc.\n","automated_response":false,"created_at":"2019-08-20T18:06:28.175Z","updated_at":"2019-08-20T18:06:28.175Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"3500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"rpadovani","url":"/rpadovani"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5693087,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @rpadovani ,\n\nThank you again for the report! Your finding has been patched. Please let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.","automated_response":false,"created_at":"2019-08-29T18:17:13.537Z","updated_at":"2019-08-29T18:17:13.537Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rpadovani","url":"/rpadovani"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5693089,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2019-08-29T18:17:37.394Z","updated_at":"2019-08-29T18:17:37.394Z","additional_data":{"added_weaknesses":[{"id":55,"name":"Insecure Direct Object Reference (IDOR)"}],"removed_weaknesses":[{"id":27,"name":"Improper Authentication - Generic"}]},"actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5699093,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jritchey \nthanks so much for your fast fix and the bounty! I confirm I am not able to reproduce the issue anymore.\n\nJust to be sure: have you removed the video from the linked issue on Gitlab? It contains personal data, so I'd prefer it stays private.\n\nThank you!\nRiccardo ","automated_response":false,"created_at":"2019-08-30T15:29:21.055Z","updated_at":"2019-08-30T15:29:21.055Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5699233,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rpadovani,\n\nYes, the video from linked issue on Gitlab was removed.\n\nBest regards,\nCostel","automated_response":false,"created_at":"2019-08-30T15:46:33.202Z","updated_at":"2019-08-30T15:46:33.202Z","actor":{"username":"gitlab_cmaxim","cleared":false,"url":"/gitlab_cmaxim","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/vmc7q2peqzpyt965jezuwkm4ravx/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22cyber.png%22%3B%20filename%2A%3DUTF-8%27%27cyber.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2T6DG5UU%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T151646Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQCyGt%2F6wKTb7WdhbTEehok3geSSNypgF1jy9glhzjfqmQIhAN%2FZ96OUsxT3l%2FcNh%2BJaiqKBQp%2B0XefuAf%2BhfC%2FmhMZBKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxZblqGtDqM2dUzvNgq1wMBRL4HwjcRdARKHRTYG1WTOwsUnNm5pyWIDl6UX7cxu3S9pxhLAGamITa%2Bry536DE0dNafGhdIyPeponbLp8FxjTVDEDmVrSlc3vq07ilX%2FsvaFMPbfLwUFwN8DcJVAZSLYZA6zDdeKNCgrZ1ISy%2BuSl%2F8sa9Nj%2FKFffdAxrEzWdcbmnUnTxt6PFvOqigHySvKHcRU1WUlzR%2BJNQhShWoYk3WMwt3lGEOyDeyEBa1PjWzXfwU5hwfOCygWSHeqe3rws%2Fy%2FAjcJ4Igs3dp7VWi2gpey9dMnBlv29eq43WYKyQ6K0q%2FC9l73EFZqlsoZAnNWCF%2BaMWp%2FSNCQCoi6LiyTT3H7xbPsVAE%2F%2B6%2B%2Fmd5o4HWlwOrPWTPapPHw%2BSF0OGtEIdy9BSNcjjpsTprmH3CxZWrOiVUBzDRDrImWT3QqtKWRETxE5UkMEesELPvS1Vr78fUKmIPG33W64ks49siCJg%2BYlvii52MslCAhwi8OBai4EvmsepnSL4Y7WjbGc31Zh7uWP1tOMXaSXgoK4ZXpbX9aNZgfinEq%2FEdjmz1acLqkVL8LTALuORrCaSQNzbL1VsrMHnDQY5Ip6UHG9W3WhTLOB2rMmAx%2FYtqF%2F2HrLRQRuA5lXPow%2F4aRiwY6pAFiuHIrJ99Gk48YedhIWLylCmpLudXTrjRTQ5%2BPJgz8sHy%2FJL%2BbYgchWh7RyeRvXCGWkecfBiAUWkHftxJlLxZP3R4oliu1hG1pnP80N0SBXLpKCFAQqqhncEnNPuXaqUaPMjKqpRRMw76WlTCCpu34SiacreJDZDO6dLymqMm3OX1OpD5Y13L2IbUTLcllZFway4EkA3FPk2PKaxAARwJYsWedpQ%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cb2e70d0ec7c0e48bd59318c22a231d0375031184fade150f1de20ecf37cbd7d"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6105028,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi! \n\nCan we disclose this?\n\nUsually you disclose the Gitlab issue as well, but as far as I can tell, this wasn't disclosed. Do you see any obstacle in doing so?\n\nThanks!","automated_response":false,"created_at":"2019-10-22T10:54:16.370Z","updated_at":"2019-10-22T10:54:16.370Z","first_to_agree":true,"actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9045339,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hello @rpadovani,\n\nI was reviewing disclosure requests this morning and saw that this one apparently fell through the cracks. Disclosing now!\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-08-26T14:02:00.448Z","updated_at":"2020-08-26T14:02:00.448Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9045340,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-26T14:02:00.652Z","updated_at":"2020-08-26T14:02:00.652Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9046867,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dcouture \nthanks for disclosing this! May I ask you to remove the video from the disclosure, please? It contains some private data.\n\nThanks!","automated_response":false,"created_at":"2020-08-26T16:55:35.116Z","updated_at":"2020-08-26T16:55:35.116Z","actor":{"username":"rpadovani","cleared":false,"url":"/rpadovani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/236/751/01f4c6286f531a1d26559ab1bd2f61a34d74792f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9046891,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rpadovani,\n\nDone! Thanks for flagging this.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2020-08-26T16:58:30.174Z","updated_at":"2020-08-26T16:58:30.174Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}