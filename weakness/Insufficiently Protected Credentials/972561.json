{"id":972561,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NzI1NjE=","url":"https://hackerone.com/reports/972561","title":"kubeadm logs tokens before deleting them","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2020-09-01T23:15:55.815Z","submitted_at":"2020-09-01T23:15:55.868Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mlevesquedion","url":"/mlevesquedion","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":39386,"url":"https://hackerone.com/kubernetes","handle":"kubernetes","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kubernetes","twitter_handle":"kubernetesio","website":"https://kubernetes.io/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-11-21T18:04:06.009Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-10-22T18:03:51.596Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Report Submission Form\n\n## Summary:\n`kubeabdm`'s `delete` command takes as input either a bootstrap token ID, or a full token. Before determining whether the input is just an id or a full token, `kubeadm` logs the input using `klog`. If the deletion fails, the token would remain valid. An attacker who has access to the logs could use it to perform actions that require a bootstrap token, such as creating a cluster or joining nodes to an existing cluster.\n\n## Kubernetes Version:\nThe vulnerable code is present in kubernetes 1.19. The specific line that contains the call to `klog` was last edited on 2019-03-24.\n\n## Steps To Reproduce:\nThe vulnerable code is in the `github.com/kubernetes` repository, under `kubernetes/cmd/kubeadm/app/cmd/token.go`, at line `423`. Here is the whole function:\n```go\n// RunDeleteTokens removes a bootstrap tokens from the server.\nfunc RunDeleteTokens(out io.Writer, client clientset.Interface, tokenIDsOrTokens []string) error {\n\tfor _, tokenIDOrToken := range tokenIDsOrTokens {\n\t\t// Assume this is a token id and try to parse it\n\t\ttokenID := tokenIDOrToken\n\t\tklog.V(1).Infof(\"[token] parsing token %q\", tokenIDOrToken) // POTENTIAL LEAK HERE\n\t\tif !bootstraputil.IsValidBootstrapTokenID(tokenIDOrToken) {\n\t\t\t// Okay, the full token with both id and secret was probably passed. Parse it and extract the ID only\n\t\t\tbts, err := kubeadmapiv1beta2.NewBootstrapTokenString(tokenIDOrToken)\n\t\t\tif err != nil {\n\t\t\t\treturn errors.Errorf(\"given token %q didn't match pattern %q or %q\",\n\t\t\t\t\ttokenIDOrToken, bootstrapapi.BootstrapTokenIDPattern, bootstrapapi.BootstrapTokenIDPattern)\n\t\t\t}\n\t\t\ttokenID = bts.ID\n\t\t}\n\n\t\ttokenSecretName := bootstraputil.BootstrapTokenSecretName(tokenID)\n\t\tklog.V(1).Infof(\"[token] deleting token %q\", tokenID)\n\t\tif err := client.CoreV1().Secrets(metav1.NamespaceSystem).Delete(context.TODO(), tokenSecretName, metav1.DeleteOptions{}); err != nil {\n\t\t\treturn errors.Wrapf(err, \"failed to delete bootstrap token %q\", tokenID)\n\t\t}\n\t\tfmt.Fprintf(out, \"bootstrap token %q deleted\\n\", tokenID)\n\t}\n\treturn nil\n}\n```\n\nAnd here's the definition of the kubeadm command that calls that function:\n```go\n\tdeleteCmd := \u0026cobra.Command{\n\t\tUse:                   \"delete [token-value] ...\",\n\t\tDisableFlagsInUseLine: true,\n\t\tShort:                 \"Delete bootstrap tokens on the server\",\n\t\tLong: dedent.Dedent(`\n\t\t\tThis command will delete a list of bootstrap tokens for you.\n\n\t\t\tThe [token-value] is the full Token of the form \"[a-z0-9]{6}.[a-z0-9]{16}\" or the\n\t\t\tToken ID of the form \"[a-z0-9]{6}\" to delete.\n\t\t`),\n\t\tRunE: func(tokenCmd *cobra.Command, args []string) error {\n\t\t\tif len(args) \u003c 1 {\n\t\t\t\treturn errors.Errorf(\"missing subcommand; 'token delete' is missing token of form %q\", bootstrapapi.BootstrapTokenIDPattern)\n\t\t\t}\n\t\t\tkubeConfigFile = cmdutil.GetKubeConfigPath(kubeConfigFile)\n\t\t\tclient, err := getClientset(kubeConfigFile, dryRun)\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\treturn RunDeleteTokens(out, client, args)\n\t\t},\n\t}\n```\n\n## Supporting Material/References:\nNone.\n\n## Impact\n\nAn attacker who obtains a bootstrap token from the logs could use it to authenticate with `kubeadm` and create a new cluster or join nodes to an existing cluster, e.g. to use computing resources. An attacker could also perform other actions using `kubeadm`, e.g. listing or deleting other tokens.","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":87,"name":"Insufficiently Protected Credentials"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-21T18:03:51.695Z","allow_singular_disclosure_after":-27985393.96771949,"singular_disclosure_allowed":true,"vote_count":6,"voters":["mik317","h4x0r_dz","cryptographer","rover404","voyageur","mlevesquedion"],"severity":{"rating":"low","score":3.4,"author_type":"Team","metrics":{"attack_vector":"local","attack_complexity":"high","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":32543,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/kubernetes/kubeadm","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9109392,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlevesquedion,\n\nThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@beagle","automated_response":false,"created_at":"2020-09-02T11:18:18.313Z","updated_at":"2020-09-02T11:18:18.313Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9111700,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-02T15:30:08.626Z","updated_at":"2020-09-02T15:30:08.626Z","additional_data":{"old_severity":"Medium (5.7)","new_severity":"Medium (4.1)","old_severity_id":835222,"new_severity_id":835996},"actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9111736,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I was able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nKind regards,\n@beagle ","automated_response":false,"created_at":"2020-09-02T15:36:10.099Z","updated_at":"2020-09-02T15:36:10.099Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9111767,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sounds good, thank you very much!\n\nI would be interested in implementing the fix myself if that is a possibility.\n\nBest,\n\nMichael","automated_response":false,"created_at":"2020-09-02T15:41:52.015Z","updated_at":"2020-09-02T15:41:52.015Z","actor":{"username":"mlevesquedion","cleared":false,"url":"/mlevesquedion","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9162974,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-08T17:48:05.103Z","updated_at":"2020-09-08T17:48:05.103Z","additional_data":{"old_severity":"Medium (4.1)","new_severity":"Low (3.4)","old_severity_id":835996,"new_severity_id":840541},"actor":{"username":"jk1joel","cleared":false,"url":"/jk1joel","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9193254,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi Michael! thank you for your report. Based on the high attack complexity and low severity, we think this can be reported and fixed publicly. \n\nPlease open an issue (feel free to copy/paste your report here) in GitHub https://github.com/kubernetes/kubeadm. \n\nIf you are interested in implementing the fix as well, that is fantastic and will be very much appreciated by the team! \n\nThank you again for your report!","automated_response":false,"created_at":"2020-09-11T14:28:05.834Z","updated_at":"2020-09-11T14:28:05.834Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kubernetes","collaborator":{"username":"mlevesquedion","url":"/mlevesquedion"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9196655,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Very nice, thank you very much!\n\nI have filed an issue [here](https://github.com/kubernetes/kubeadm/issues/2287) and opened a PR [here](https://github.com/kubernetes/kubernetes/pull/94727).\n\nI look forward to contributing to this program again in the future.\n\nBest,\n\nMichael","automated_response":false,"created_at":"2020-09-11T17:45:38.911Z","updated_at":"2020-09-11T17:45:38.911Z","actor":{"username":"mlevesquedion","cleared":false,"url":"/mlevesquedion","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9259128,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The PR has been merged: https://github.com/kubernetes/kubernetes/pull/94727","automated_response":false,"created_at":"2020-09-18T16:13:47.313Z","updated_at":"2020-09-18T16:13:47.313Z","actor":{"username":"mlevesquedion","cleared":false,"url":"/mlevesquedion","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9605631,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-10-22T18:02:35.889Z","updated_at":"2020-10-22T18:02:35.889Z","actor":{"username":"cjcullen","cleared":false,"url":"/cjcullen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mlevesquedion","url":"/mlevesquedion"},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9605637,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-10-22T18:03:51.619Z","updated_at":"2020-10-22T18:03:51.619Z","first_to_agree":true,"actor":{"username":"cjcullen","cleared":false,"url":"/cjcullen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9888002,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-11-21T18:04:06.046Z","updated_at":"2020-11-21T18:04:06.046Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10041409,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @Kubernetes,\n\nSince this vulnerability was discovered as part of my work, I must ask that the bounty be donated to charity. I have not yet cashed out the bounty. Let me know if you need me to do anything.\n\nBest,\n\nMichael","automated_response":false,"created_at":"2020-12-08T14:56:02.347Z","updated_at":"2020-12-08T14:56:02.347Z","actor":{"username":"mlevesquedion","cleared":false,"url":"/mlevesquedion","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}