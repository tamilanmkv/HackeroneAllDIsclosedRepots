{"id":461780,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NjE3ODA=","url":"https://hackerone.com/reports/461780","title":"Web protection component in Anti-Virus products family ignores HSTS security policy","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-12-13T11:10:31.336Z","submitted_at":"2018-12-13T11:10:31.336Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"palant","url":"/palant","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2379,"url":"https://hackerone.com/kaspersky","handle":"kaspersky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kaspersky","twitter_handle":"kaspersky","website":"http://www.kaspersky.com","about":"Kaspersky is the worldâ€™s largest privately-held vendor of endpoint protection and cybersecurity solutions for business and consumers."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-09-05T07:30:47.781Z","bug_reporter_agreed_on_going_public_at":"2019-08-06T07:30:36.321Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary**\nKaspersky Internet Security seems to ignore the Strict-Transport-Security HTTP header. This allows Man-in-the-Middle attacks on websites that would normally be immune to them. The only requirement is the user confirming the certificate override, something that can be achieved by social engineering.\n\n**Description**\nWhen a browser encounters an SSL certificate error, it will usually allow users to override it and continue to the site. This is meant mostly for intranet devices that use self-signed SSL certificates. However, for websites using Strict-Transport-Security HTTP header there is no such override possibility - these websites declared that they will always have a valid certificate, so a certificate error is a certain sign of a Man-in-the-Middle attack. It is known that users will often disregard warnings (see \u003chttps://adrifelt.github.io/sslinterstitial-chi.pdf\u003e for example), so the decision isn't left to the user here. Browsers (at least Chrome 71 and Firefox 63) just don't give users a choice, proceeding to the site isn't possible.\n\nKaspersky Internet Security breaks up HTTPS connections in order to scan them. This means in particular that it takes over certificate validation and overrides. There seems to be no special handling of websites on Google's HSTS preload list (\u003chttps://hstspreload.org/\u003e) or websites sending Strict-Transport-Security HTTP header. Overriding a certificate error is always possible with merely two clicks. This puts users at risk in case of Man-in-the-Middle attacks.\n\n**Environment**\n- Scope: Application\n- Product name: Kaspersky Internet Security\n- Product version: 19.0.0.1088\n- OS name and version (incl SP): Windows 10.0.17134\n- Attack type: MitM\n- Maximum user privileges needed to reproduce your issue: no privileges\n\n**Steps to reproduce**\n1. Open your browser (I tested in Firefox 63) and go to https://www.google.com/. The regular Google Search page appears.\n2. Edit the file %WINDIR%\\sysnative\\drivers\\etc\\hosts as administrator and add the following line: `93.184.216.34 www.google.com` (that's the IP address of example.com to simulate a MitM attack).\n3. Reload www.google.com in the browser.\n\nWhile Kaspersky Internet Security will warn you about a wrong SSL certificate, users can still click \"I understand the risks\" to ignore the error. That's despite www.google.com being on the HSTS preload list and despite Kaspersky Internet Security seeing it send Strict-Transport-Security HTTP header before. The MitM protection is considerably weakened compared to the security level provided by the browsers.\n\nNote that the presence of Kaspersky Internet Security is easy to detect, so attackers might decide to execute this attack only if it is present.\n\n## Impact\n\nAttackers on public WiFi networks might redirect SSL-encrypted traffic of Kaspersky users to their server in a bet that users will override the certificate warning - which they often will. State-level attackers could do the same when targeting dissidents. They will even be able to attack high-profile websites such as Google which are normally immune to MitM due to their use of HSTS.","weakness":{"id":30,"name":"Man-in-the-Middle"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-09-05T07:30:36.408Z","allow_singular_disclosure_after":-66295915.34440232,"singular_disclosure_allowed":true,"vote_count":41,"voters":["foobar7","mashoud1122","mik317","chizome","zeroxyele","0xatul","0-1","xiaoyinl","what_web","khizer47","and 31 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3818855,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Wladimir.\n\nThx for your new report. We'll look to this issue and let you know.","automated_response":false,"created_at":"2018-12-13T11:41:01.297Z","updated_at":"2018-12-13T11:41:01.297Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3818856,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-12-13T11:41:09.225Z","updated_at":"2018-12-13T11:41:09.225Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3870575,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your report about this security risk. We understand the concern here related to the behavior of our product. However, we have our own security measures that protect user from visiting Strict HTTPS (hsts) resources with an untrusted certificate. In particular, we warn user twice about visiting such resources and one the alerts is displayed in a special secure desktop window. The secure desktop technology is widely used in our products to notify users about their actions that can lead to security risks.\n\nThe bug bounty for reporting such risk is not awarded. However, we will do our best to take into account the information you provided when working on the next product releases. Thank you for your help in making our products secure.\n","automated_response":false,"created_at":"2018-12-20T11:29:58.430Z","updated_at":"2018-12-20T11:29:58.430Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3870615,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As I have demonstrated in https://hackerone.com/reports/463695 and https://hackerone.com/reports/469372, this isn't merely a theoretical risk. By making it possible to override certificates for such websites, you expose these sites to attack. Whether it's a user making a wrong decision (users do this all the time) or an issue with your UI (like those I've demonstrated), this is an attack vector that wouldn't exist if Kaspersky weren't installed and browsers were handling SSL errors.","automated_response":false,"created_at":"2018-12-20T11:42:19.422Z","updated_at":"2018-12-20T11:42:19.422Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3871759,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Do I see this correctly that, if this isn't considered a vulnerability, there is no reason why I cannot write about it?","automated_response":false,"created_at":"2018-12-20T15:41:41.135Z","updated_at":"2018-12-20T15:41:41.135Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3871863,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wladimir, we support responsible disclosure, please give us some time to think how we can resolve this situation in our common interests.","automated_response":false,"created_at":"2018-12-20T16:12:03.892Z","updated_at":"2018-12-20T16:12:03.892Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3876694,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Dear Wladimir. Thanks again for your efforts to make our products secure. We have always had helpful cooperation with you and now we really appreciate information that you provided. We take seriously issues you posted before (like #435618, #463915) and regard them in scope of our program. We cannot award Bug Bounty for your report according to our BB program, because it refers to a low probability security risk, not a vulnerability in our product.","automated_response":false,"created_at":"2018-12-21T15:10:03.428Z","updated_at":"2018-12-21T15:10:03.428Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3877004,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"So what's the answer to:\n\n\u003e Do I see this correctly that, if this isn't considered a vulnerability, there is no reason why I cannot write about it?","automated_response":false,"created_at":"2018-12-21T16:23:00.960Z","updated_at":"2018-12-21T16:23:00.960Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3886681,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can you please show to us a draft of your blog post about this report before publication (if you are going to publish it).","automated_response":false,"created_at":"2018-12-24T15:05:27.408Z","updated_at":"2018-12-24T15:05:27.408Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3887271,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I cannot write about it without writing about https://hackerone.com/reports/463695. I hope the fix there will happen sometime soon...","automated_response":false,"created_at":"2018-12-24T19:05:11.540Z","updated_at":"2018-12-24T19:05:11.540Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4659421,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"A fix was released as part of our major KIS 19 product update (Patch E). To check it out you need to update installed KIS 19 product to the latest version.","automated_response":false,"created_at":"2019-04-29T08:23:52.442Z","updated_at":"2019-04-29T08:23:52.442Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"palant","url":"/palant"},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4660255,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm that certificate errors can no longer be overridden on HSTS-protected websites.","automated_response":false,"created_at":"2019-04-29T09:31:26.331Z","updated_at":"2019-04-29T09:31:26.331Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5455824,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-07-29T17:54:38.852Z","updated_at":"2019-07-29T17:54:38.852Z","first_to_agree":true,"actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5498160,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"Hi man.\n\nYou've requested too many tickets for disclosure at the same time.","automated_response":false,"created_at":"2019-08-04T16:26:59.284Z","updated_at":"2019-08-04T16:26:59.284Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5508963,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-08-06T07:30:36.355Z","updated_at":"2019-08-06T07:30:36.355Z","first_to_agree":true,"actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5554311,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just making sure you know: as discussed in #470547, I plan to publish a blog article on this issue next Monday (2019-08-19).","automated_response":false,"created_at":"2019-08-12T09:36:27.628Z","updated_at":"2019-08-12T09:36:27.628Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5603537,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"FYI: https://palant.de/2019/08/19/kaspersky-in-the-middle-what-could-possibly-go-wrong/","automated_response":false,"created_at":"2019-08-19T08:17:55.987Z","updated_at":"2019-08-19T08:17:55.987Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5735004,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-09-05T07:30:47.795Z","updated_at":"2019-09-05T07:30:47.795Z","actor":{"url":"/kaspersky","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kaspersky"}},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6438520,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-11-30T17:26:04.538Z","updated_at":"2019-11-30T17:26:04.538Z","additional_data":{"old_title":"MitM attacks on HSTS-protected hosts are possible","new_title":"Web protection component in Anti-Virus products family ignores HSTS security policy"},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}