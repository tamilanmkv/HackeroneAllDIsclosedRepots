{"id":217610,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTc2MTA=","url":"https://hackerone.com/reports/217610","title":"kh_put_iv SEGFAULT - mruby 1.2.0","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-04-01T07:14:38.590Z","submitted_at":"2017-04-01T07:14:38.590Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ilsani","url":"/ilsani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-04-13T22:45:37.586Z","bug_reporter_agreed_on_going_public_at":"2017-04-13T22:45:37.555Z","team_member_agreed_on_going_public_at":"2017-04-13T21:27:25.939Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"mruby v. 1.2.0 crashes in `kh_put_iv` function in `variable.c` file with a crafted input. I'm examining the bug in order to better understand the root cause of the issue.\n\nTest platform:\nLinux 4.2.0-1 SMP Debian 4.2.3-2 x86_64\n\nStacktrace:\n```\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n292     KHASH_DEFINE(iv, mrb_sym, mrb_value, TRUE, kh_int_hash_func, kh_int_hash_equal)\n(gdb) backtrace \n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n#1  0x0000000000459117 in iv_put (mrb=0x2744c10, t=0x2f2f3a7370747468, sym=671, val=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:310\n#2  mrb_mod_cv_set (mrb=\u003coptimized out\u003e, c=\u003coptimized out\u003e, sym=\u003coptimized out\u003e, v=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:838\n#3  0x000000000050e1e1 in mrb_vm_exec (mrb=\u003coptimized out\u003e, proc=\u003coptimized out\u003e, pc=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:979\n#4  0x000000000051f5bb in mrb_vm_run (proc=0x2746ef0, self=..., stack_keep=8, mrb=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:823\n#5  mrb_top_run (mrb=0x2744c10, proc=0x2746ef0, self=..., stack_keep=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:2614\n#6  0x00000000004d4f93 in mrb_load_exec (mrb=0x2744c10, p=\u003coptimized out\u003e, c=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/mrbgems/mruby-compiler/core/parse.y:5760\n#7  0x0000000000400c85 in main () at runtest.c:23\n(gdb) exploitable \n__main__:99: UserWarning: GDB v7.11 may not support required Python API\nDescription: Possible stack corruption\nShort description: PossibleStackCorruption (7/22)\nHash: 5696db2f9fc8b1e9b330173ee7ddc787.2627e5d3f14472e2e24f2d46a9038356\nExploitability Classification: EXPLOITABLE\nExplanation: GDB generated an error while unwinding the stack and/or the stack contained return addresses that were not mapped in the inferior's process address space and/or the stack pointer is pointing to a location outside the default stack region. These conditions likely indicate stack corruption, which is generally considered exploitable.\nOther tags: AccessViolation (21/22)\n\n```\n\nAttachment [1] is the crafted input.","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":172696,"file_name":"input.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/172/696/921460591414a3e09c204cab6df709aa0445c15f/input.txt?response-content-disposition=attachment%3B%20filename%3D%22input.txt%22%3B%20filename%2A%3DUTF-8%27%27input.txt\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140554Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=e47cb679f80051104d69894067e52ce2ee13777b7e9040e321af92b473aa75af","file_size":301,"type":"text/x-c++"}],"allow_singular_disclosure_at":"2017-05-13T21:27:25.981Z","allow_singular_disclosure_after":-139250308.6648831,"singular_disclosure_allowed":true,"vote_count":3,"voters":["eveeez","t4ym","spetr0x"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1577155,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!","automated_response":true,"created_at":"2017-04-01T07:14:38.778Z","updated_at":"2017-04-01T07:14:38.778Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1582790,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the crash and opened an issue upstream: https://github.com/mruby/mruby/issues/3587","automated_response":false,"created_at":"2017-04-04T13:09:38.607Z","updated_at":"2017-04-04T13:09:38.607Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1602571,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue was fixed upstream in https://github.com/mruby/mruby/commit/9094415acfff11b4590f156eb44cf24483a6fb00.\n\nOur next round of bounty decisions will take place in approximately one week, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-04-10T15:48:06.140Z","updated_at":"2017-04-10T15:48:06.140Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ilsani","url":"/ilsani"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1606057,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","automated_response":false,"created_at":"2017-04-11T22:37:00.097Z","updated_at":"2017-04-11T22:37:00.097Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"ilsani","url":"/ilsani"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610609,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-04-13T21:27:25.959Z","updated_at":"2017-04-13T21:27:25.959Z","first_to_agree":true,"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610807,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-04-13T22:45:37.569Z","updated_at":"2017-04-13T22:45:37.569Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1610808,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-04-13T22:45:37.601Z","updated_at":"2017-04-13T22:45:37.601Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}