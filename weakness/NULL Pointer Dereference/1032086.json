{"id":1032086,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDMyMDg2","url":"https://hackerone.com/reports/1032086","title":"csi-snapshot-controller crashes when processing VolumeSnapshot with non-existing PVC","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-11-12T07:20:20.713Z","submitted_at":"2020-11-12T07:20:20.753Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"piqin","url":"/piqin","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":39386,"url":"https://hackerone.com/kubernetes","handle":"kubernetes","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Kubernetes","twitter_handle":"kubernetesio","website":"https://kubernetes.io/","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8569"],"singular_disclosure_disabled":false,"disclosed_at":"2020-12-03T01:31:59.488Z","bug_reporter_agreed_on_going_public_at":"2020-12-03T01:31:59.390Z","team_member_agreed_on_going_public_at":"2020-12-02T21:23:14.050Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Report Submission Form\n\nI was asked by Kubernetes Product Security and H1 Employee @turtle_shell to open a new report with the same details as report #995699.\n\n# Summary:\ncsi-snapshot-controller crashes when processing VolumeSnapshot with non-existing PVC\n\n# Kubernetes Version:\n1.19\n\n# Component Version:\nsnapshot-controller from external-snapshotter repo ver 3.0.0\nhttps://github.com/kubernetes-csi/external-snapshotter/releases/tag/v3.0.0\n\n# Steps To Reproduce:\n1.   Install Kubernetes 1.19 with snapshot-controller v3.0.0\n2.   Create VolumeSnapshot object with empty spec.volumeSnapshotClass and spec.source.persistentVolumeClaimName = \u003cnon-existing PVC name \n\n    ```\n    apiVersion: snapshot.storage.k8s.io/v1beta1\n    kind: VolumeSnapshot\n    metadata:\n      name: new-snapshot\n    spec:\n      source:\n        persistentVolumeClaimName: blabla\n    ```\n3.   watch snapshot-controller die\n\n# Supporting Material/References:\n[list any additional material (e.g. screenshots, logs, etc.)]\n\nsnapshot-controller log:\n\n    E0929 06:42:38.147021       1 snapshot_controller_base.go:338] checkAndUpdateSnapshotClass failed to setDefaultClass the snapshot source PVC name is not specified\n    E0929 06:42:38.147118       1 runtime.go:78] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\n    goroutine 161 [running]:\n    k8s.io/apimachinery/pkg/util/runtime.logPanic(0x1446fc0, 0x201e670)\n            /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:74 +0xa6\n    k8s.io/apimachinery/pkg/util/runtime.HandleCrash(0x0, 0x0, 0x0)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:48 +0x89\n    panic(0x1446fcit sh0, 0x201e670)\n        /usr/lib/golang/src/runtime/panic.go:969 +0x175\n    github.com/kubernetes-csi/external-snapshotter/v3/pkg/common-controller.(*csiSnapshotCommonController).syncSnapshotByKey(0xc0001f8e00, 0xc0006a6ae0, 0x19, 0x0, 0xbc)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/pkg/common-controller/snapshot_controller_base.go:215 +0x9d7\n    github.com/kubernetes-csi/external-snapshotter/v3/pkg/common-controller.(*csiSnapshotCommonController).snapshotWorker(0xc0001f8e00)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/pkg/common-controller/snapshot_controller_base.go:188 +0xed\n    k8s.io/apimachinery/pkg/util/wait.BackoffUntil.func1(0xc0006ba8b0)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:155 +0x5f\n    k8s.io/apimachinery/pkg/util/wait.BackoffUntil(0xc0006ba8b0, 0x1774260, 0xc0001f0030, 0x1, 0xc00002a1e0)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:156 +0xad\n    k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc0006ba8b0, 0x0, 0x0, 0x1, 0xc00002a1e0)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:133 +0x98\n    k8s.io/apimachinery/pkg/util/wait.Until(0xc0006ba8b0, 0x0, 0xc00002a1e0)\n        /go/src/github.com/kubernetes-csi/external-snapshotter/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:90 +0x4d\n    created by it shgithub.com/kubernetes-csi/external-snapshotter/v3/pkg/common-controller.(*csiSnapshotCommonController).Run\n        /go/src/github.com/kubernetes-csi/external-snapshotter/pkg/common-controller/snapshot_controller_base.go:139 +0x2ae\n    panic: runtime error: invalid memory address or nil pointer dereference [recovered]\n            panic: runtime error: invalid memory address or nil pointer dereference\n    [signal SIGSEGV: segmentation violation code=0x1 addr=0xa0 pc=0x12b1d97]\n\n## Impact\n\nDoS of snapshot-controller. It's restarted by Kubernetes, but it dies processing the same VolumeSnapshot again and again.\n\n* Users can't create snapshots of their volumes.\n* Kubernetes (snapshot-controller) does not clean up VolumeSnapshotContent objects when user deletes a VolumeSnapshot and its Retain policy is Delete.\n\nAll other Kubernetes functionality is not impacted.","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":51,"name":"NULL Pointer Dereference"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-01-01T21:23:14.136Z","allow_singular_disclosure_after":-24422089.18980989,"singular_disclosure_allowed":true,"vote_count":15,"voters":["sw33tlie","prophet","h4x0r_dz","cryptographer","vijay5647","7005indian-bs","phxt","itsmekriss","imtiaz0x","n1cotheh4cker","and 5 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":34432,"asset_type":"SOURCE_CODE","asset_identifier":"github.com/kubernetes-csi","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9803588,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @piqin - Thanks for the submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.","automated_response":false,"created_at":"2020-11-12T15:50:05.546Z","updated_at":"2020-11-12T15:50:05.546Z","actor":{"username":"tuxedo","cleared":false,"url":"/tuxedo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/9G6pgB95of3ikt3prqQunAfD/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9806842,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","automated_response":false,"created_at":"2020-11-12T20:22:09.843Z","updated_at":"2020-11-12T20:22:09.843Z","cve_ids":["CVE-2020-8569"],"actor":{"username":"jk1joel","cleared":false,"url":"/jk1joel","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9806864,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We asked @piqin to open this report so we could award the bounty to her as she originally discovered the issue reported in report #995699.","automated_response":false,"created_at":"2020-11-12T20:26:36.597Z","updated_at":"2020-11-12T20:26:36.597Z","actor":{"username":"jk1joel","cleared":false,"url":"/jk1joel","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9916523,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2020-11-24T19:59:53.192Z","updated_at":"2020-11-24T19:59:53.192Z","actor":{"url":"/kubernetes","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Kubernetes"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kubernetes","collaborator":{"username":"piqin","url":"/piqin"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9989118,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Public announcement: https://groups.google.com/g/kubernetes-security-announce/c/1EzCr1qUxxU","automated_response":false,"created_at":"2020-12-02T21:23:05.880Z","updated_at":"2020-12-02T21:23:05.880Z","actor":{"username":"tallclair","cleared":false,"url":"/tallclair","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/418/594/6bbb78252759e1d1c1d67be48b7d7470926730de_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"piqin","url":"/piqin"},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9989119,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-12-02T21:23:14.071Z","updated_at":"2020-12-02T21:23:14.071Z","first_to_agree":true,"actor":{"username":"tallclair","cleared":false,"url":"/tallclair","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/418/594/6bbb78252759e1d1c1d67be48b7d7470926730de_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9990041,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-12-03T01:31:59.419Z","updated_at":"2020-12-03T01:31:59.419Z","actor":{"username":"piqin","cleared":false,"url":"/piqin","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9990042,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-12-03T01:31:59.517Z","updated_at":"2020-12-03T01:31:59.517Z","actor":{"username":"piqin","cleared":false,"url":"/piqin","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kubernetes","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}