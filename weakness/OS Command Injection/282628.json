{"id":282628,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yODI2Mjg=","url":"https://hackerone.com/reports/282628","title":"OS Command Execution on User's PC via CSV Injection","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2017-10-24T21:25:20.992Z","submitted_at":"2017-10-24T21:25:20.992Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cornerpirate","url":"/cornerpirate","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-11-02T23:55:51.672Z","bug_reporter_agreed_on_going_public_at":"2017-10-31T17:29:29.000Z","team_member_agreed_on_going_public_at":"2017-11-02T23:55:51.596Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** Twitter is vulnerable to CSV Injection. If an attacker can successfully exploit this, then they will compromise the PC of the user. The injection point is via a tweet (on the main twitter.com site) while the retrieval point is via the “Export Data” option on the analytics site.\n\n**Description:** No user would ever tweet their own payload surely? Well I have found an issue also with the “Share this article” intent (specifically the “text” parameter). It handles URL encoded newline characters “%0A”. The default behaviours on some web browsers show the bottom line of text in the tweet only. Therefore, it is possible for an attacker to entice a user to tweet a malicious payload. \n\nIf that victim then exports their analytics, opens the “csv” file in Excel and accepts a warning then their computer would be compromised. \n\nThis is Dynamic Data Injection (DDE) into a formula which is evaluated in Excel. \n\n## Steps To Reproduce:\n\nTo verify the injection point safely simply:\n\n  1. Tweet a benign payload: =1+55 \n  2. Goto the analytics page and ensure that tweet is within the date range before clicking \"export data\"\n  3. Open the exported CSV file within Excel\n\nThe most recent tweet should be at the top. Your first row will say 56 which is proof the addition worked.\n\nModifying the payload can convert this from an arithmetic formula to triggering Dynamic Data Exchange (DDE).\n\n  1. Modify the payload to: =cmd|' /C calc'!A0\n  2. Repeat the export and opening process.\n  3. This time Excel will warn users about the DDE. Accepting these warnings will trigger calc.exe to open.\n\nThese error messages are Microsoft's response to DDE code execution. It has been established that users do not necessarily understand these warnings and that they instead rely on their implicit trust of the service which generated the file.\n\nSo far how to replicate the injection has been shown. The second part of this is how to influence a user to post a tweet which would harm themselves? I located a flaw in the \"Share this article\" intent through the \"text\" parameter. The URL for this is:\n\nhttps://twitter.com/intent/tweet?text=[value]\n\nThe value allows URL encoded control characters such as: %0A\n\nThis is interpreted as a newline character and can be used to obfuscate the payload. The following URL includes a payload which can be used to replicate the issue:\n\nhttps://twitter.com/intent/tweet?text=%3DSUM(1%2B1)*cmd%7C%27%20%2FC%20calc%27!A0%0A%0D%0A%0D%0A%0D%0A%0Dbbb\n\nEssentially it begins with a DDE payload, injects several newlines and then writes “bbb” which could be the string the victim believes they are posting. By default FireFox (at least on Windows) was found to scroll down to the bottom of the text field meaning it displayed the string \"bbb\". There were over 100 characters remaining in which to replace that string with a reasonable message to entice the victim.\n\n## Impact: This matters if you want to ensure your users can invest their trust in Twitter. \n\nThe impact for Twitter is indirect. It is most likely going to affect trust in the service.\nThe impact for affected users is likely the full compromise of their computers. \n\nThe attack requires multiple (but trivial) steps. If an attacker controlled a website and was able to make an article on that site \"go viral\". Then they could exploit users via the \"Share this article\" feature. While the payload would be delivered instantly it is at a later date most likely when the victim would export their data to complete the attack. An attacker would require patience. For this reason I would say there is a high impact, low difficulty of exploitation, but a degree of patience is required on the attackers part. \n\nI would say the CVSS rating is honestly way too high given the hoops to jump through but using that calculator can be a mixed bag. Gimmie a choice I'd say \"high impact if exploited on the user side\", but \"probably not going to affect that many people\" so average out and finger in the air at \"medium\" risk. If I was consulting for Twitter I would raise it for discussion and even if it winds up as \"low\" on your risk criteria point out the universality and simplicity of the remediation.\n\nThe following shows how a list of modern web browsers (on Windows) behaved:\n\nFirefox 56.0.1\tYes - Vulnerable\nChrome 62.0.3202.62\tNo – less vulnerable\nInternet Explorer 11.674.15063.0\tNo – less vulnerable\nEdge 40.15063.674.0\tNo – less vulnerable\nOpera  48.0.2685.50\tNo – less vulnerable\n\nFireFox was the only one which scrolled the user to the bottom of the text field. All others are less vulnerable to exploitation.\n\n## Remediation\n\nModify the “Export Data” function on the analytics host to prefix:=, +, - and @ symbols with a '. The single quote escapes the dangerous characters and prevents code execution client side.\n\nSounds cheap to me? A 5 minute code change to fix a potentially interesting issue. What else can you get done in 5 minutes?\n\n## Supporting Material/References:\n\nI have uploaded the following PDF which includes the same discussion and has screenshots etc for more confirmation:\n\n  * F232489: Tweet_DDE_to_Me .pdf\n\n","weakness":{"id":59,"name":"OS Command Injection"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":232489,"file_name":"Tweet_DDE_to_Me_.pdf","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/232/489/0d83e0aaa36d4e05f67e379c850fa5d370817699/Tweet_DDE_to_Me_.pdf?response-content-disposition=attachment%3B%20filename%3D%22Tweet_DDE_to_Me_.pdf%22%3B%20filename%2A%3DUTF-8%27%27Tweet_DDE_to_Me_.pdf\u0026response-content-type=application%2Fpdf\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143744Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=78f32b67a045e8fb5195f1cd82ef305998c06e8c5d4e853fc822ae0ba0887370","file_size":664091,"type":"application/pdf"}],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["kapytein","lanepowell98"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":1062,"asset_type":"URL","asset_identifier":"*.twitter.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2100403,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thank you for your report.\n\nWe do not consider this issue to pose enough of a security risk to warrant a priority fix at this time. We believe that the client software (e.g. Microsoft Excel) should be responsible for properly handling any data in a CSV file.\n\nThank you for thinking of Twitter security.","automated_response":false,"created_at":"2017-10-24T21:55:18.530Z","updated_at":"2017-10-24T21:55:18.530Z","actor":{"username":"bugtriage-nicky","cleared":false,"url":"/bugtriage-nicky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2101195,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Nicky,\n\nThanks for the response.\n\nAt this point DDE is all over the Internet as a goto exploit technique. If you feel that there is no risk I am free to blog about this then? It is an interesting case at least in my view.\n\nMicrosoft are not going to patch this as they have a long standing response that basically the warning messages are enough. That IS there response to this. Even with DDE via field codes in word making macroless payloads a goto phishing technique at the moment they are not going to resolve it.\n\nGiven the quickness and universality of the solution I would recommend addressing it even if not seen as a priority. \n\n","automated_response":false,"created_at":"2017-10-25T07:20:29.391Z","updated_at":"2017-10-25T07:20:29.391Z","actor":{"username":"cornerpirate","cleared":false,"url":"/cornerpirate","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2107591,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nI am waiting on approval to be able to talk through this publicly as I have a blog post pending on DDE at the moment.\n\nRegards","automated_response":false,"created_at":"2017-10-27T06:54:22.988Z","updated_at":"2017-10-27T06:54:22.988Z","actor":{"username":"cornerpirate","cleared":false,"url":"/cornerpirate","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2113792,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@cornerpirate  - Please request formal disclosure of the report and we will review, redact as necessary, and then approve disclosure.","automated_response":false,"created_at":"2017-10-30T16:46:41.948Z","updated_at":"2017-10-30T16:46:41.948Z","actor":{"username":"petrilli","cleared":false,"url":"/petrilli","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/270/e17bf41da2f7dc28ecbf5c996c5a98efd95bd67c_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2118200,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Sorry as someone who doesn't use hackerone I thought asking in a comment would be enough.","automated_response":false,"created_at":"2017-10-31T17:29:29.040Z","updated_at":"2017-10-31T17:29:29.040Z","first_to_agree":true,"actor":{"username":"cornerpirate","cleared":false,"url":"/cornerpirate","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2130134,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-11-02T23:55:51.630Z","updated_at":"2017-11-02T23:55:51.630Z","actor":{"username":"petrilli","cleared":false,"url":"/petrilli","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/270/e17bf41da2f7dc28ecbf5c996c5a98efd95bd67c_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2130135,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-11-02T23:55:51.719Z","updated_at":"2017-11-02T23:55:51.719Z","actor":{"username":"petrilli","cleared":false,"url":"/petrilli","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/270/e17bf41da2f7dc28ecbf5c996c5a98efd95bd67c_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}