{"id":1132378,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTMyMzc4","url":"https://hackerone.com/reports/1132378","title":"Arbitrary file read during project import","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2021-03-22T15:23:30.025Z","submitted_at":"2021-03-22T15:23:30.056Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"saltyyolk","url":"/saltyyolk","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-05-24T08:51:03.967Z","bug_reporter_agreed_on_going_public_at":"2021-05-24T08:51:03.850Z","team_member_agreed_on_going_public_at":"2021-05-21T19:51:53.295Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"\u003e NOTE! Thanks for submitting a report! Please replace *all* the (parenthesized) sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to triage and respond quickly, so be sure to take your time filling out the report!\n\n### Summary\nA mis-usage of json schema validator could be used by an attacker to read any file in GitLab server. The issue allows the attacker to leak ~250 bytes of data of any file.\nAt the same time, as the root cause of the issue here is 'open-uri'. It's an SSRF issue at the same time.\n\n### Steps to reproduce\n1. Use the import feature of gitlab.com to import the attached import.tar.gz as 'GitLab export' ███████\n2. Wait the import process to finish\n3. Access URL: https://gitlab.com/api/v4/projects/PROJECT_ID/import where PROJECT_ID is the id of the imported project, which could be found in the home page of the project.\n4. The connection information of gitlab's production database is in the output, as attached.\n\n### Impact\nFor GitLab.com, this issue could be used to leak some critical credentials. I went through the charts in `https://gitlab.com/gitlab-org/charts/gitlab/-/tree/master/charts/gitlab/charts/sidekiq/templates`. It seems that there're a bunch of  juicy credentials could be leaked with this method, including Rails secret_key_base, database credentials and GitLab's smtp credentials. The object storage service account credential is limitedly accessed because of the 250 bytes limitation.\n\nFor self-hosted GitLab instances, this issue could cause more severe problems since most of self-hosted GitLab instances has sidekiq running with gitlab-rails \u0026 gitlab-shell. So .gitlab_shell_token could be easily downloaded and be used to access internal APIs such as '/api/v4/internal/personal_access_token', which could issue an private access token of an admin of someone else.\n\n### Relevant logs and/or screenshots\n███\n███████\n\n### Output of checks\nThis bug happens on GitLab.com\n\n## Impact\n\nFor GitLab.com, this issue could be used to leak some critical credentials. I went through the charts in `https://gitlab.com/gitlab-org/charts/gitlab/-/tree/master/charts/gitlab/charts/sidekiq/templates`. It seems that there're a bunch of  juicy credentials could be leaked with this method, including Rails secret_key_base, database credentials and GitLab's smtp credentials. The object storage service account credential is limitedly accessed because of the 250 bytes limitation.\n\nFor self-hosted GitLab instances, this issue could cause more severe problems since most of self-hosted GitLab instances has sidekiq running with gitlab-rails \u0026 gitlab-shell. So .gitlab_shell_token could be easily downloaded and be used to access internal APIs such as '/api/v4/internal/personal_access_token', which could issue an private access token of an admin of someone else.","bounty_amount":"16000.0","formatted_bounty":"$16,000","weakness":{"id":19,"name":"Path Traversal"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":168,"voters":["mass0ma","wapiflapi","honoki","cilsn","drvivanco","n1m0","battle_angel","wh0ru","w31rd0","organdonor","and 158 more..."],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":11079121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"About the SSRF part, I'm not going to test it deeper, as it doesn't make too much difference to any other (or previously reported) SSRF issues. It could be used to access metadata services like `http://metadata.google.internal/computeMetadata/v1beta1` like it was done before. I believe you the security team knows much more than me about the infrastructure part, so I should leave the impact assessment to you.\n\nFor credentials leaked in GitLab.com, I believe you might need to rotate the secret key base and database password of sidekiq. I did try to read credentials of the service account named gitlab-production from '/etc/gitlab/objectstorage/lfs' but was terminated right after private_key_id, so the secret is still safe. There was nothing else of the leakage attempts worthy to be mentioned afaik, if you have, just let me know.","automated_response":false,"created_at":"2021-03-22T15:36:13.834Z","updated_at":"2021-03-22T15:36:13.834Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11079274,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"automated_response":false,"created_at":"2021-03-22T15:52:00.440Z","updated_at":"2021-03-22T15:52:00.440Z","additional_data":{"old_severity":null,"new_severity":"Critical","old_severity_id":null,"new_severity_id":1019154},"actor":{"username":"estrike","cleared":false,"url":"/estrike","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11079484,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @saltyyolk,\n\nThank you for submitting this report! We will investigate the issue as soon as\npossible, and should get back within a week.\n\nPlease do not submit your report or ask about its status through additional\nchannels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2021-03-22T16:09:09.352Z","updated_at":"2021-03-22T16:09:09.352Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":11080879,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @saltyyolk,\n\nThank you for submitting this report. Surprising behavior from the schema validator to say the least!\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at \u003cissue link\u003e.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations!\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-03-22T17:33:34.590Z","updated_at":"2021-03-22T17:33:34.590Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11080890,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-03-22T17:34:21.475Z","updated_at":"2021-03-22T17:34:21.475Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"saltyyolk","url":"/saltyyolk"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11192504,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @saltyyolk,\n\nThe issue you reported is currently scheduled to be fixed by 2021-04-30.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","automated_response":true,"created_at":"2021-03-31T04:08:41.303Z","updated_at":"2021-03-31T04:08:41.303Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":11267368,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @saltyyolk,\n\nWe have resolved this report in 13.10.1, but we are still in the process of discussing the bounty amount, please bear with us. And feel free to ping me if you don't hear back by early next week.\n\nThanks,\nRon\nGitLab Security Team","automated_response":false,"created_at":"2021-04-05T23:07:25.371Z","updated_at":"2021-04-05T23:07:25.371Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11289462,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2021-04-06T21:54:44.944Z","updated_at":"2021-04-06T21:54:44.944Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"7000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"saltyyolk","url":"/saltyyolk"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11289506,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @saltyyolk,\n\nThank you again for the report! Your finding has been patched in GitLab version 13.10.1, 13.9.5, and 13.8.7. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nNote: The bounty amount is 50% of the usual amount because we found this bug was in a third-party dependency, so we reduced the amount according to our bug bounty program policy.\n\nWe look forward to your next report!\n\n\nBest regards,\nRon\nGitLab Security Team","automated_response":false,"created_at":"2021-04-06T22:00:03.477Z","updated_at":"2021-04-06T22:00:03.477Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"saltyyolk","url":"/saltyyolk"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11701867,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @saltyyolk,\n\nWe are rolling back our policy of awarding 50% bounty for vulnerabilities found in third-party dependencies (a policy update will follow soon) and are retroactively awarding the rest of the bounty for this report.\n\nBest regards,\nDominic\nGitLab Security Team","automated_response":false,"created_at":"2021-05-11T14:10:15.356Z","updated_at":"2021-05-11T14:10:15.356Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"GitLab"}},"bounty_amount":"8000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"saltyyolk","url":"/saltyyolk"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11841857,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-21T19:51:53.335Z","updated_at":"2021-05-21T19:51:53.335Z","first_to_agree":true,"actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11856409,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-05-24T08:51:03.888Z","updated_at":"2021-05-24T08:51:03.888Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11856410,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-05-24T08:51:04.006Z","updated_at":"2021-05-24T08:51:04.006Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}