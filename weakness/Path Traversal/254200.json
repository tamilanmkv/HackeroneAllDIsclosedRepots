{"id":254200,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNTQyMDA=","url":"https://hackerone.com/reports/254200","title":"Escaping images directory in S3 bucket when saving new avatar, using Path Traversal in filename","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-07-28T10:25:17.111Z","submitted_at":"2017-07-28T10:25:17.111Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sp1d3rs","url":"/sp1d3rs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2672,"url":"https://hackerone.com/unikrn","handle":"unikrn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Unikrn","twitter_handle":"unikrnco","website":"https://unikrn.com","about":"Win prizes, bet safely and legally on esports and get the best multi-title coverage for fans and fanatics alike!"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-23T12:12:46.141Z","bug_reporter_agreed_on_going_public_at":"2017-08-23T12:12:46.071Z","team_member_agreed_on_going_public_at":"2017-08-23T12:11:25.677Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":19,"name":"Path Traversal"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-22T12:11:25.723Z","allow_singular_disclosure_after":-127880384.53799902,"singular_disclosure_allowed":true,"vote_count":25,"voters":["jensec","preben","spam404","trudya","skansing","cuso4","eveeez","r3y","its_afolic","vulnh0lic","and 15 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":453,"asset_type":"URL","asset_identifier":"unikrn.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1872791,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-07-28T10:27:38.606Z","updated_at":"2017-07-28T10:27:38.606Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1872973,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2017-07-28T11:58:34.314Z","updated_at":"2017-07-28T11:58:34.314Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1872978,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2017-07-28T12:01:54.241Z","updated_at":"2017-07-28T12:01:54.241Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"sp1d3rs","url":"/sp1d3rs"},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1872979,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-07-28T12:02:07.852Z","updated_at":"2017-07-28T12:02:07.852Z","actor":{"url":"/unikrn","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/672/c6c2b32746235b372285a9047457642b7b9bc6a1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Unikrn"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"unikrn","collaborator":{"username":"sp1d3rs","url":"/sp1d3rs"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1947363,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2017-08-22T22:56:06.617Z","updated_at":"2017-08-22T22:56:06.617Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1948103,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2017-08-23T06:08:15.322Z","updated_at":"2017-08-23T06:08:15.322Z","actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1948674,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","automated_response":false,"created_at":"2017-08-23T11:35:59.835Z","updated_at":"2017-08-23T11:35:59.835Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1948727,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-23T12:11:25.702Z","updated_at":"2017-08-23T12:11:25.702Z","first_to_agree":true,"actor":{"username":"decrypted","cleared":false,"url":"/decrypted","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1948729,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-23T12:12:46.109Z","updated_at":"2017-08-23T12:12:46.109Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1948730,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-08-23T12:12:46.175Z","updated_at":"2017-08-23T12:12:46.175Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"unikrn","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":5153,"category":"team","content":"Thanks again @sp1d3rs, also for the summary. Nothing to add from our side except maybe for the wish for more reports having this quality.\n\nFinal comment: nothing from that bucket was ever exposed to any user except the uploader, also nothing in the bucket is there for real archiving purposes.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":35819,"username":"decrypted","name":"Daniel Rudolph","bio":"","cleared":false,"website":null,"location":"","created_at":"2015-07-01T06:33:55.367Z","url":"https://hackerone.com/decrypted","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"company","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/035/819/849ab6e942d0608e17e1c98244b240363a4ad9b7_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"id":5144,"category":"researcher","content":"I was able to escape from the unique directory (where the user's avatar is stored after uploading -`https://unikrn-files.s3-eu-west-1.amazonaws.com/users/\u003cuserid\u003e/\u003cdate\u003e/\u003cfilename+params\u003e`) in the S3 bucket using `../` characters in the filename (for example, `test../../../../../../test.jpg`) on the `https://unikrn.com/apiv2/user/upload` endpoint. It was possible to upload arbitrary files to the any other directory, and also overwrite existing files (which could belong to other users) and resources.\n\n##Reproduction steps\n\n1) Login to your profile on https://unikrn.com/profile\n2) Start the Web Debugger\n3) Upload any image as avatar and intercept the request to the https://unikrn.com/apiv2/user/upload\n4) Change the filename in the request to the\n```\n{\n    \"filename\": \"test2../../../../../../test2.jpg\",\n    \"type\": \"image/jpeg\",\n    \"reason\": \"image/*\",\n    \"session_id\": \"\u003csession\u003e\"\n}\n```\n5) Execute the request.\n6) You now have test2.jpg in the root of your bucket.\n\nUsually arbitrary file upload in the S3 bucket does not pose much risk, but not in the case when the attacker with no permissions is able to escape from the isolated directory, and affect/overwrite other files, which supposed to be not accessible for him.\n\nThe issue was fixed using filename sanitization, and i didn't find the way to bypass it.\nThanks to the Unikrn team for the fast response, fix, and the bounty!","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":79690,"username":"sp1d3rs","name":"Dr. Jones","bio":"Human. Possibly","cleared":true,"website":"https://xp.ht","location":"Xen","created_at":"2016-05-23T03:07:23.595Z","url":"https://hackerone.com/sp1d3rs","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"hacker_resume_enabled":true,"user_type":"hacker","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}}]}