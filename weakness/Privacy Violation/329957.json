{"id":329957,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMjk5NTc=","url":"https://hackerone.com/reports/329957","title":"Tracking of users on third-party websites using the Twitter cookie, due to a flaw in authenticating image requests","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-03-26T11:18:08.158Z","submitted_at":"2018-03-26T11:18:08.158Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cris-staicu","url":"/cris-staicu","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-02-08T23:01:40.893Z","bug_reporter_agreed_on_going_public_at":"2019-01-29T16:20:39.738Z","team_member_agreed_on_going_public_at":"2019-02-08T23:01:40.796Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** \nAs part of our ([SoftwareLab@TU Darmstadt](https://www.sola.tu-darmstadt.de/de/software-lab/)) latest research project, we discovered a privacy-related vulnerability in multiple high-profile websites, including Twitter. An attacker exploiting this vulnerability can identify a user of your website while the user visits an attacker-controlled website, using the cookie you set in his or her browser. We call this vulnerability LeakyImages and below we describe the threat model, the exploit vector and the actual steps that need to be followed on your website to setup a LeakyImage between the attacker and the victim.\n\n**Description:** \n*Threat model*: The attacker knows the victim’s ID/username on your website and she aims at identifying the user when visiting one of the websites she controls, such as a blog or a news website. Another flavor of this goal: the attacker wants to identify a user out of a group of potential target users. Moreover, she would like to link together user accounts created by the victim on different vulnerable websites. For example she would like to know that the visitor of the website has the email address john.doe@gmail.com and the facebook account facebook.com/johndoe1973. \n\n*Exploit*: The main insight of our exploit is that the attacker can use your platform to share an image “http://yoursite.com/myCuteCatImage.png” with the victim, so that the image is only accessible by the attacker and the victim. It is important that there is a cookie-based access control mechanism that enforces this former constraint. Since images are exempted from the same origin policy, when the victim visits an attacker-controlled website, the attacker instructs the victim’s browser to request this image. By checking whether the image gets loaded, the attacker can precisely identify whether the victim is the current visitor. In a sense, the attacker is able to setup a tracking pixel using your website and the reachability of this pixel leaks the identity of the user.\n\n## Steps To Reproduce:\n\n  1. The attacker writes a private message to the victim which contains the image.\n  2. Right click on the image + copy image address\n  3. This URL is a cookie-based authenticated URL which only allow access to the image for the two participants in the conversation. For example the URL https://ton.twitter.com/1.1/ton/data/dm/971042231900622855/971042220110426113/dsxFPPP0.jpg:large can only be accessed by the users CrisStaicu and johndoevici1988.\n\n## Impact: \nThe attacker can include the LeakyImage in a page he controls. If the image is correctly loaded, the Twitter identity of the current visitor is leaked. \n\n## Closing Remarks:\nWe believe that the described attack is a serious threat to the privacy of your users. We are looking forward to hearing from you and we would like to share further details if needed to aid in fixing the reported problem. We plan to publish a description of the vulnerability at an academic security conference and notify you as part of a responsible disclosure process. We will be happy to coordinate any public release of this information with you, and in turn, would be happy to receive feedback on whether and when you plan to address the problem.\n\n## Impact\n\nAn attacker exploiting this vulnerability can identify a user of your website while the user visits an attacker-controlled website, using the cookie you set in his or her browser.","bounty_amount":"1120.0","formatted_bounty":"$1,120","weakness":{"id":46,"name":"Privacy Violation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-02-28T16:20:39.901Z","allow_singular_disclosure_after":-82592757.47238667,"singular_disclosure_allowed":true,"vote_count":49,"voters":["base_64","sameerphad72","spam404","logicmap","mik317","dhakal_ananda","ali","johndoe1492","aryan2808","asad0x01_","and 39 more..."],"severity":{"rating":"medium","score":6.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":1062,"asset_type":"URL","asset_identifier":"*.twitter.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2540744,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2018-03-28T15:48:03.298Z","updated_at":"2018-03-28T15:48:03.298Z","actor":{"username":"asayler","cleared":false,"url":"/asayler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/395/70da753edd29b342a463a7ef9c2e75cb22ce35d8_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2540768,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@cris-staicu, thank you for this report. We're looking into it on our end. In the meantime, do you have a preprint of your paper or additional information on this that you'd be willing to share so I can pass it along to the teams involved?","automated_response":false,"created_at":"2018-03-28T15:53:19.064Z","updated_at":"2018-03-28T15:53:19.064Z","actor":{"username":"asayler","cleared":false,"url":"/asayler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/395/70da753edd29b342a463a7ef9c2e75cb22ce35d8_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2540813,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Happy to hear that. No, we don't have a draft yet. Nevertheless, I would be happy to help with answering any specific question that may arise. ","automated_response":false,"created_at":"2018-03-28T16:01:41.900Z","updated_at":"2018-03-28T16:01:41.900Z","actor":{"username":"cris-staicu","cleared":false,"url":"/cris-staicu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2540883,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @cris-staicu. In particular, does yoru team have specific recommendations for how best to mitigate this class of vulnerability in general? ","automated_response":false,"created_at":"2018-03-28T16:18:00.296Z","updated_at":"2018-03-28T16:18:00.296Z","actor":{"username":"asayler","cleared":false,"url":"/asayler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/395/70da753edd29b342a463a7ef9c2e75cb22ce35d8_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2543595,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"From our experience in looking for this type of vulnerabilities, there are two techniques applied in other websites that prevented us from mounting the attack: \na) when sharing the image, do not authenticate the  image request itself by using cookies. This seem counter-intuitive,  but Facebook uses mostly this strategy. Check out this discussion for details: https://news.ycombinator.com/item?id=13204283. Sometimes less is more. :) Of course this approach has its drawbacks and you should perform a rigorous threat analysis before deciding to deploy it in your case. \nb) when accessing the image the request is authenticated, but each party has its own access URL. Dropbox, Gmail and Yahoo Mail tend to do this. For example, userA can access the image at twitter.com/myImg?token=2342 and userB at twitter.com/myImg?token=4232. The token can be something like Enc_PK(cookie_ID). In this way, when authenticated the request you check not only that userA has access to myImg but also that Dec_PK(token) === cookie_ID. If userB tries to access this link, he will get an authentication error. In some sense this technique is very similar to the CSRF protection. \n\nI hope this helps!","automated_response":false,"created_at":"2018-03-29T09:42:48.423Z","updated_at":"2018-03-29T09:42:48.423Z","actor":{"username":"cris-staicu","cleared":false,"url":"/cris-staicu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2547824,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, @cris-staicu. Twitter often pays out bounties for reports made via H1. We're not sure if we'll be paying this one out yet, but if we do, are you or your team able to accept a payment? If not, HackerOne can generally donate the bounty to a charity of your choosing, or if that's an issue, we can just opt to not pay this out at all.","automated_response":false,"created_at":"2018-03-30T16:59:09.825Z","updated_at":"2018-03-30T16:59:09.825Z","actor":{"username":"asayler","cleared":false,"url":"/asayler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/395/70da753edd29b342a463a7ef9c2e75cb22ce35d8_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2559429,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, we do accept bounty payments done through hackerone. Hopefully you will consider this one worth paying for! :) Moreover, we will probably report the bounty amount in the paper, if that is fine with you, in order to show the severity of the attack/vulnerability and the fact that it has real world implications on users' privacy. Please keep in mind that we reported similar issues to several other high-profile websites and most of them also proceeded to mitigate the issue. Please keep us posted with the progress on your side.","automated_response":false,"created_at":"2018-04-03T15:22:45.532Z","updated_at":"2018-04-03T15:36:09.069Z","actor":{"username":"cris-staicu","cleared":false,"url":"/cris-staicu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2648755,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","automated_response":false,"created_at":"2018-04-20T19:07:22.030Z","updated_at":"2018-04-20T19:07:22.030Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Twitter"}},"bounty_amount":"1120.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"cris-staicu","url":"/cris-staicu"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3324971,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2018-09-12T00:08:35.837Z","updated_at":"2018-09-12T00:08:35.837Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"cris-staicu","url":"/cris-staicu"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3490146,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @cris-staicu,\n\nSimilar to our recent report about [Silhouette](https://blog.twitter.com/engineering/en_us/topics/insights/2018/twitter_silhouette.html), we're interested in describing this issue more broadly. Do you have a preprint of your paper and have you been able to get it accepted into a conference? Also, were you able to confirm our fix of the issue? You can see some of the details of the fix on a recent [blog post on our developer website](https://twittercommunity.com/t/direct-message-api-change-to-how-apps-can-access-images-sent-in-direct-messages/112722).\n\nThank you for helping keep Twitter secure!","automated_response":false,"created_at":"2018-10-16T21:16:11.050Z","updated_at":"2018-10-16T21:16:11.050Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4015829,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Dear all, \n\nI am sorry to follow up on this so late, but as you probably guessed our disclosure/publication timeline is highly dependent on the reviews we get from academic conferences. The work describing this attack was conditionally accepted at USENIX Security 2019, a top tier academic conference. The paper will hopefully be presented in August this year in Santa Clara, CA.\n\nI can help with the coordinated disclosure if that is still part of your priorities.  I would be very happy to share a draft of the paper with you (please give me an email address where I can send it) and hear your thoughts on the fixes we propose and maybe help us draft a paragraph about the one you implemented. \n\nThank you in advance, \nCris","automated_response":false,"created_at":"2019-01-22T10:23:54.841Z","updated_at":"2019-01-22T10:23:54.841Z","actor":{"username":"cris-staicu","cleared":false,"url":"/cris-staicu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4034042,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@cris-staicu, thanks for the update. I think we're happy to disclose this report prior to your paper publication. Please go ahead and request disclosure in HackerOne and we can go through that process. Since this has been fixed and tweeted about (https://twitter.com/TwitterAPI/status/1039631353141112832) I don't think we need to coordinate much here beyond going ahead and disclosing this report.\n\nWe'd also be happy to read a draft of the paper. Feel free to send that along to ████████ or attach it here.","automated_response":false,"created_at":"2019-01-24T21:50:02.933Z","updated_at":"2019-02-07T22:35:50.567Z","actor":{"username":"asayler","cleared":false,"url":"/asayler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/157/395/70da753edd29b342a463a7ef9c2e75cb22ce35d8_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4059566,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-01-29T16:20:39.841Z","updated_at":"2019-01-29T16:20:39.841Z","first_to_agree":true,"actor":{"username":"cris-staicu","cleared":false,"url":"/cris-staicu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/473/5618aeedd3c065802f56615df04846fe9c9692e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4117897,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-02-08T23:01:40.835Z","updated_at":"2019-02-08T23:01:40.835Z","actor":{"username":"jknguyen","cleared":false,"url":"/jknguyen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4117898,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-02-08T23:01:40.923Z","updated_at":"2019-02-08T23:01:40.923Z","actor":{"username":"jknguyen","cleared":false,"url":"/jknguyen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}