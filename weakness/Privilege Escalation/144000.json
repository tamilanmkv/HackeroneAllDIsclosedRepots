{"id":144000,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDQwMDA=","url":"https://hackerone.com/reports/144000","title":"Authorization Bypass in Delivery Chat Logs","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-06-10T06:49:22.462Z","submitted_at":"2016-06-10T06:49:22.462Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"michiel","url":"/michiel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":555,"url":"https://hackerone.com/instacart","handle":"instacart","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Instacart","twitter_handle":"instacart","website":"https://www.instacart.com/","about":"Same-day grocery delivery"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-11-03T23:02:35.514Z","bug_reporter_agreed_on_going_public_at":"2016-11-01T17:37:58.799Z","team_member_agreed_on_going_public_at":"2016-11-03T23:02:35.475Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"An authorization issue in the mobile app API allows any Instacart user to gain access to other users' order delivery chat logs. The `/api/v2/order_deliveries/:order_delivery_id/order_change_logs` endpoint does not sufficiently check if the user has permissions to access that particular order's chat logs. \n\n# Steps to Reproduce\nI used Burp Suite to intercept the traffic between my iPhone and the Instacart API. When I found the \"View \nChat Logs\" button on one of my past orders, I noticed it triggered the following API request:\n\n```\nGET /api/v2/order_deliveries/261932226/order_change_logs HTTP/1.1\nHost: www.instacart.com\nAccept: */*\n[...]\n```\n\nThis request is answered by the API with a JSON blob that contains chat messages that were exchanged between the buyer and the shopper. As well as a few other details like when the order was placed and if any changes were made to the order due to out of stock items. \n\nHowever, if you change the ID in the URL to something else, you will notice the API actually responds with the chat log and order data, regardless of who made the order. I tried with `261972220` and you can confirm this delivery does not belong to the user with account ███, but for instance `261972226` does.\n\n# Risk\nThis vulnerability leaks private messages exchanged between shopper, driver, and customer. It may also include product names that were on the order if something had to be changed about the order. \n\nHere is an example:\n{F98768}\n\nThis could lead to greater compromise, since the API returns the Firebase tokens for a few objects as well. So far I have not been able to do anything interesting with the Firebase tokens, but I'm not a Firebase expert. \n\nHere is an example (id: 261972220):\n\n```\nmichiel@msp ~ $ curl https://instacart.firebaseio.com/order_deliveries/xy8TcFsDZiKm1JwnqqFp.json\n{\"46671792\":\"\",\"46671794\":\"\",\"46671795\":\"\",\"46671802\":\"\",\"46671804\":\"\",\"46872067\":\"\",\"46872104\":\"\",\"46872195\":\"\",\"46872357\":\"\"}%\n```\n\n# Mitigation\nImplement an authorization check that makes sure only a users' own orders can be accessed.","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":98768,"file_name":"IMG_0008.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/098/768/db18da79ba21e187fbd2272590e837fab77a4017/IMG_0008.PNG?response-content-disposition=attachment%3B%20filename%3D%22IMG_0008.PNG%22%3B%20filename%2A%3DUTF-8%27%27IMG_0008.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRCOM766B%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T134152Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQC2plSLprTu8RjGD8JYtZWBPt0cszlQG9FE345fmJX2hAIhALFlvJYKDzrEhN7%2FvlACW3w%2FuqitMoDByli%2BB32UD4xHKoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5Igydotw%2BzjeVoEUzifsq1wO17iYJRnZ0fDCk2qA3GFkCAi2TACWamwiykehERisJcA6JAf5%2BKDXCSCA9Z5sJN1RS6yYikkzrd1g0%2FNHQvlKNEb%2F0bkFdpBo983pYtuPm%2FjZwdUmgycUkQTsKElvIdrra2ORU8syHUfTSsU0jkhKy1nTU1EUbOyVSpNZUO9kXRRe3ohujd32sjmj8LzGUv8aTvRQduIzkPVeEQOKzFH7EgJMvdNR3vaK2TDhSXjMkBaQKBFqnh6PEMyOLZDUpbrlIy%2BoEq2r%2B%2F10hoGkdsLCXXLTZ6FqEIiLpzSb0Iu7CYkr0MdHXUykD4DOTntKsy9rifi4r4BROm%2BFSV7DvWqgt3W4BdQyDDpqk1mezBTFX0MzxjgcpwKW8P9MAJbLCDmqfTTPFk4Q3hwN161Se85vO9XLNOyRVtPGBxj7OBbf9ALPJ5O3JeDoWAJMilj8zwYEUZ8HB%2BwxjDJ9XD8WIvUhkGyonPTYta41EE5Apa%2BuA9mDzlzHtztW9QWk0A9Sy6yWDe5RV1BvTfuQDIENmCujUYeHBAI1LctTr5dAfQfpbR25kBWiGSGkGj66CsyM%2Fv4WpFwB06OZt5%2FWKkqDvm8EJ4nRBeXyQEZgKwI6%2BBfR8uHZJrNaXh7ww%2FuiQiwY6pAG6PxCWeEgmj5NWNLAASGSJOsH%2B4v2Ym%2BQKqlIQLRYFFWUC%2FZOjX8OosfCA%2F2VoFSUqa9gE9u1ak8ebfBQMrD4qWG%2BNBuWtrVAT0zNhYQeLm7qYZBf6nK1%2F4Q%2FfiKY5Hwm5q1KG1XzDtwU7hRI5PfdeIVO1imHecmyw8jlgyE%2Bpn%2Bt6DW7WJdNcVKLCb%2BX4TDKDa3Lt%2FOx7FpCltN7n4hWkIyVpiw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=7fd4a349716ccd37e709c4dd61d4d9a72654040c2ad25305ba23712b7f0f2f87","file_size":153227,"type":"image/png"}],"allow_singular_disclosure_at":"2016-12-01T17:37:58.863Z","allow_singular_disclosure_after":-153345833.2843875,"singular_disclosure_allowed":true,"vote_count":33,"voters":["k0z3r0","jobert","michiel","bogdantcaciuc","yaworsk","nahamsec","sumlac","0xsyndr0me","dilawer01","mdv","and 23 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1008226,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks @michiel! This should be fixed now.","automated_response":false,"created_at":"2016-06-10T16:27:42.737Z","updated_at":"2016-06-10T16:27:42.737Z","actor":{"username":"mikeinstacart","cleared":false,"url":"/mikeinstacart","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"michiel","url":"/michiel"},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1008227,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2016-06-10T16:27:56.339Z","updated_at":"2016-06-10T16:27:56.339Z","actor":{"url":"/instacart","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Instacart"}},"bounty_amount":"100.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"instacart","collaborator":{"username":"michiel","url":"/michiel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1008270,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Wow - that's a quick turnaround! :) I can confirm the bug is fixed, and thank you for the bounty.","automated_response":false,"created_at":"2016-06-10T17:04:17.718Z","updated_at":"2016-06-10T17:04:17.718Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1278871,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Wanted to disclose this bug to show the crazy fast response you guys had on this report. Lmk if that is alright or if anything has to be blacked out first. ","automated_response":false,"created_at":"2016-11-01T17:37:58.822Z","updated_at":"2016-11-01T17:37:58.822Z","first_to_agree":true,"actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1283563,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-11-03T23:02:35.492Z","updated_at":"2016-11-03T23:02:35.492Z","actor":{"username":"anf","cleared":false,"url":"/anf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/569/6f3c5a7f7e76bc75a837f2b4ce698afe4e88d5e6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1283564,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-11-03T23:02:35.530Z","updated_at":"2016-11-03T23:02:35.530Z","actor":{"username":"anf","cleared":false,"url":"/anf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/569/6f3c5a7f7e76bc75a837f2b4ce698afe4e88d5e6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}