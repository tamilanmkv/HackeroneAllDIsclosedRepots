{"id":945122,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NDUxMjI=","url":"https://hackerone.com/reports/945122","title":"Arbitrary file creation via symlink attack on syncagentsrv (Acronis Sync Agent Service)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-07-28T13:49:59.664Z","submitted_at":"2020-07-28T13:49:59.664Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"adr","url":"/adr","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/tz82pUkLYHa2wb4pGnrdCbRb/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13428,"url":"https://hackerone.com/acronis","handle":"acronis","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/e54TDdWdgLKsH3h1oFpK26bq/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/e54TDdWdgLKsH3h1oFpK26bq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Acronis","twitter_handle":"Acronis","website":"https://www.acronis.com","about":"Acronis sets the standard for cyber protection through its backup, anti-ransomware and cyber infrastructure"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2021-03-16T09:45:40.740Z","bug_reporter_agreed_on_going_public_at":"2021-02-19T11:27:55.881Z","team_member_agreed_on_going_public_at":"2021-03-16T09:45:40.557Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Issue class description\nArbitrary file creation is a vulnerability that allows attacker to create file in arbitrary location within filesystem. This includes protected directories, such as C:\\Windows, C:\\windows\\system32 and \"C:\\Program Files\". If in addition, attacker has control over the file content, it is possible to create DLL file which will be loaded by known operating system components and will result in Privilege Elevation to Local System (the highest level of privileges on local Windows system).\n\nThere are many known paths for this attacks, e.g. every desktop version of Windows will periodically run \"schedule\" service. The service will try to load non-existing library named WptsExtensions.dll. If attacker manages to plant custom version of this library, the code will be executed with highest privileges and can be used to add new administrative user or start reverse shell. The issue can be force by triggering system reboot as well. More details can be found here: https://itm4n.github.io/windows-dll-hijacking-clarified/\n\nTo perform this attack, typically we need privileged process that blindly follows symlinks (reparse points), without verifying destination. NTFS symlinks require extra privileges, but attacker can use other kind of symlinks: directory junctions mixed with object directory symlinks. The ready to use solution is hosted on Google's Project Zero's github: https://github.com/googleprojectzero/symboliclink-testing-tools\n\nCreateSymlink.exe binary used in this attack originates from this source and can be downloaded to reproduce the attack.\n\n# Affected software\nFollowing True Image installer was used:\n{F926995}\n\nThe vulnerable service is syncagentsrv (\"C:\\Program Files (x86)\\Common Files\\Acronis\\SyncAgent\\syncagentsrv.exe\")\n\nWhen service is running, it logs information into C:\\ProgramData\\Acronis\\SyncAgent\\logs\\syncagent.log file. The file is not exclusively opened, nor protected, and can be deleted at any time. The C:\\ProgramData\\Acronis\\SyncAgent\\logs\\ directory remains empty, thus can be transformed into directoy junction and symlink.\n\nOnce new entry is added to the log, the write operation will follow the symlink and write into arbitrary location. Attacker also controls the name of resulting file. The resulting file grants full control to EVERYONE, hence it is trivial to replace its content with custom code. \n\n{F927005}\n\nThe attack has been confirmed on my local system (when proper libraries were targeted) and I was able to elevate privileges.\n\n# Steps to reproduce\n1. Delete C:\\ProgramData\\Acronis\\SyncAgent\\logs\\syncagent.log file. Make sure that directory is now empty.\n2. Use following command to create symlink: `CreateSymlink.exe C:\\ProgramData\\Acronis\\SyncAgent\\logs\\syncagent.log C:\\Windows\\system32\\WptsExtensions.dll`\n3. Wait for data to be written into the log or force it by triggering system reboot. After the reboot verify successful file creation.\n4. Replace new file content (C:\\Windows\\system32\\WptsExtensions.dll) with custom DLL functionality - e.g. adding administrative user or spawning remote shell connection.\n5. Reboot again to trigger Windows Scheduler loading new dll.\n\n## Impact\n\nLow privileged user can overwrite any file in the system (this could lead to DoS) or create arbitrary files anywhere on the system. By creating arbitrary DLL, then replacing its content with custom code, user can elevate privileges up to Local System (the highest Windows privilege).","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":926995,"file_name":"TrueImage.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/pT547inJoTbSHjmHf5ADeDgZ?response-content-disposition=attachment%3B%20filename%3D%22TrueImage.png%22%3B%20filename%2A%3DUTF-8%27%27TrueImage.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154355Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=78e46fe58db391eba9e0588afc0c445fe953555f9f0cba72a0cb2b781c92cdcb","file_size":14987,"type":"image/png"},{"id":927005,"file_name":"dll.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/wJSfS2QSrqgu2MWG1hDXWFBi?response-content-disposition=attachment%3B%20filename%3D%22dll.png%22%3B%20filename%2A%3DUTF-8%27%27dll.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTXACUYF6%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T154355Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJIMEYCIQDZ4o5FgQbPOV7cUhasXsMpsRhfie%2BaT3j2%2FpT4vRtXrQIhANTpo%2FcLyZWkchHfmQUF52JZTNkTQv76yqIpKiufRkzIKoMECO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgxBFvChFQcfy0iFfX8q1wNyqcNfKQ7lbPM93GK7zsCVuFEl%2FVm4iCcIyQUbJFWfH2jiZwLWzXyXOGtPdAFg6jZ27A3JiIMI2cRQ0ZjefpX23ew4f2EgNrAjI%2BtoD%2F5QRlfpZWkH6iJZQB6Tl2elKHpLsozAmLMg2ZCF27az6tPlE5SwA3JPC5KKlDjsViNs2UljZCi3H9uSwsukoU%2FvdCWTH%2Fn50kTwo3bwe%2FH3PWsruJkAQ7DX1%2Fj9brsxUqDkLoqtLrdoJjkKc0QIPiVbiif2roLjf%2B%2BMNUUjLjPZ27VJBWMgYN3p%2FXN%2Fc2BT1VqWpZMMYQ84FXmc9pAGYMt40reW%2BOqOJwy98WVa3ZnRts3MNHsi7yiH6arhodeoIERCyyc0BhhJEItkxN5Wzyg1DrlhRUS1Y71%2FbjrEz4uBhQSkdwrt3ERf6rlWOARG2SfQdqloTHaxYeaKlkA1gYk2lr8P8v4Z2wcf76dl0kv5neqxZuEP1QXm7QMG6m4bxy4%2BSeNKsdU%2FVA5yixjEwa92C8A1VyBQrxcJgjfs7VfF2qV2iBmnh%2FB2iQg07zl1YJd0cPNun9USqJb8Uqe%2B27IwrOZbWtmOWnBh1TcvDRMDsM%2FPcb7c4FlLVjUX8TDrhUH4Hz0mpfpQPYswtoqRiwY6pAGpulV8rT1rLL2zo7CLXj%2FCsA9YXTe8QLCuwj5BAVEq1XkBbMgCpFE7wCWHjGb7zRvhVV%2BN69FRCvvxudtZT7OkdQfTd7cCnr7vVLgwdFxyTBTiSFdPhCB%2F%2BGa%2FZGSO8Tzmn%2F5kYwNrvNcaCO%2FfxLRKT5QyWFtCeJZaDCV4pXJgLvMY0o61KPcMitqxyN7tABkO5sZ5lEaE04FUiiZgi%2BMqeSxyhg%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=55062558d4730f1825c28a0647b2c63f6ab7023d3a1675d5314aab1fef7e5870","file_size":108398,"type":"image/png"}],"allow_singular_disclosure_at":"2021-03-21T11:27:55.953Z","allow_singular_disclosure_after":-17640959.950067908,"singular_disclosure_allowed":true,"vote_count":37,"voters":["mr-medi","foobar7","ali","realtess","3x3s","demonia","f_m","h4x0r_dz","sa1tama0","deviner","and 27 more..."],"severity":{"rating":"high","score":8.7,"author_type":"Team","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":50772,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"Acronis Cyber Protect Home Office (formerly Acronis True Image)","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":8796769,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, @adr. Thanks for your report!\nWe will review it and come back to you asap","automated_response":false,"created_at":"2020-07-29T16:24:49.853Z","updated_at":"2020-07-29T16:25:01.616Z","actor":{"username":"stushieva","cleared":false,"url":"/stushieva","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/j7zANdAVudZqo6vWUahsdFKG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8818837,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-07-31T20:25:52.984Z","updated_at":"2020-07-31T20:25:52.984Z","additional_data":{"old_severity":"Critical (9.3)","new_severity":"High (8.7)","old_severity_id":802551,"new_severity_id":806663},"actor":{"username":"stushieva","cleared":false,"url":"/stushieva","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/j7zANdAVudZqo6vWUahsdFKG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8818844,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for reporting issue to the Acronis bug bounty program! Your report passed initial review. \nWe will be back to you soon.","automated_response":false,"created_at":"2020-07-31T20:27:37.914Z","updated_at":"2020-07-31T20:27:37.914Z","actor":{"username":"stushieva","cleared":false,"url":"/stushieva","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/j7zANdAVudZqo6vWUahsdFKG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8937069,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for participating in Acronis bug bounty program! Bounty is transferred to your account.\nHappy bug hunting and we are waiting for new reports from you.","automated_response":false,"created_at":"2020-08-14T11:23:28.087Z","updated_at":"2020-08-14T11:23:28.087Z","actor":{"url":"/acronis","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/e54TDdWdgLKsH3h1oFpK26bq/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Acronis"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"acronis","collaborator":{"username":"adr","url":"/adr"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8946496,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2020-08-15T16:25:56.336Z","updated_at":"2020-08-15T16:25:56.336Z","additional_data":{"duplicate_report_id":959480},"actor":{"username":"vanitas","cleared":false,"url":"/vanitas","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9095913,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2020-09-01T07:06:20.236Z","updated_at":"2020-09-01T07:06:20.236Z","additional_data":{"duplicate_report_id":971573},"actor":{"username":"mmg","cleared":false,"url":"/mmg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/222/119/30b5386d5cc0fd351927b57fa02a7cf7c81a7a2b_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10711040,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for catching this bug!\n\nWe have fixed it, please confirm that you are no longer able to reproduce the issue.\n","automated_response":false,"created_at":"2021-02-18T16:04:34.480Z","updated_at":"2021-02-18T16:04:34.480Z","actor":{"username":"security-bot","cleared":false,"url":"/security-bot","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/u1v6ebFa8hVxpyhbpJYAM4YY/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"adr","url":"/adr"},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10718550,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-02-19T11:27:55.911Z","updated_at":"2021-02-19T11:27:55.911Z","first_to_agree":true,"actor":{"username":"adr","cleared":false,"url":"/adr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/tz82pUkLYHa2wb4pGnrdCbRb/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":11008105,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-03-16T09:45:40.595Z","updated_at":"2021-03-16T09:45:40.595Z","actor":{"username":"stushieva","cleared":false,"url":"/stushieva","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/j7zANdAVudZqo6vWUahsdFKG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":11008106,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-03-16T09:45:40.801Z","updated_at":"2021-03-16T09:45:40.801Z","actor":{"username":"stushieva","cleared":false,"url":"/stushieva","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/j7zANdAVudZqo6vWUahsdFKG/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"acronis","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}