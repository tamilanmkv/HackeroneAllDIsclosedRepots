{"id":374748,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzQ3NDg=","url":"https://hackerone.com/reports/374748","title":"SQL injection in Serendipity (serendipity_fetchComments)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-06-30T15:34:42.642Z","submitted_at":"2018-06-30T15:34:42.642Z","is_member_of_team?":false,"reporter":{"disabled":true,"username":"bb9866f3f743d6bf69b6836","url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30278,"url":"https://hackerone.com/hannob","handle":"hannob","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Hanno's projects","twitter_handle":"hanno","website":"https://hboeck.de/","about":"Personal web projects from Hanno Böck."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-09T14:44:05.375Z","bug_reporter_agreed_on_going_public_at":"2018-11-09T14:44:05.320Z","team_member_agreed_on_going_public_at":"2018-11-09T14:37:41.862Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"##Summary\n\nAn authenticated administrator can alter *Entries to display on frontpage* and *Entries to display in Feeds* in a way to perform a SQL injection and extract database records or access files on the underlying system.\n\n##Description\n\nThe function `serendipity_fetchComments` (implemented in `functions_comments.inc.php`) allows to obtain an array of comments related to a specific entry id. It accepts six parameters that will impact the query:\n- `$id`: casted as integer and then used in the query;\n- `$limit`: used unescaped in the query;\n- `$order `: used unescaped in the query;\n- `$showAll`: adds a fixed condition to the query;\n- `$type`: used unescaped in the query;\n- `$where`: used unescaped in the query.\n\nThus, any use of `serendipity_fetchComments` where either `$limit`, `$order`, `$type` or `$where` are user-controlled will result in a SQL injection. Two vulnerable calls were discovered.\n\nThe first one can be found in `rss.php`. The value of `$serendipity['RSSfetchLimit']` comes from website's configuration (*Entries to display in Feeds*) and is used as second argument of `serendipity_fetchComments`:\n\n```php\n\u003c?php\n// [...]\nswitch ($_GET['type']) {\n    case 'comments_and_trackbacks':\n    case 'trackbacks':\n    case 'comments':\n        $entries     = serendipity_fetchComments(isset($_GET['cid']) ? $_GET['cid'] : null, $serendipity['RSSfetchLimit'], 'co.id desc', false, $_GET['type']);\n```\n\nThe same way, `serendipity_printCommentsByAuthor` (implemented in `functions_comments.inc.php`) uses `$serendipity['fetchLimit']` as second argument. The value of `$serendipity['fetchLimit']` also comes from website's configuration (*Entries to display on frontpage*):\n\n```php\n\u003c?php\n// [...]\n    $sql_limit = $serendipity['fetchLimit'] * ($serendipity['GET']['page']-1) . ',' . $serendipity['fetchLimit'];\n    $c = serendipity_fetchComments(null, $sql_limit, 'co.entry_id DESC, co.id ASC', false, $type, $sql_where);\n```\n## Steps To Reproduce\n\n  1. Access https://blog.fuzzing-project.org/serendipity_admin.php?serendipity[adminModule]=configuration as authenticated administrator.\n  1. Alter either *Entries to display on frontpage* or *Entries to display in Feeds* (under *Appearance and Options*) by adding any non-numeric character in one of these fields.\n  1. Access https://blog.fuzzing-project.org/rss.php?type=comment if you edited *Entries to display in Feeds*, or the homepage is you edited *Entries to display on frontpage*. The character \nbroke the correctness of the query and an error message will be displayed.\n\nI don't have any test environment at the moment but let me know if you need a real payload to show it's possible to extract arbitrary database records.\n\n## Impact\n\nAn authenticated administrator can extract database records, including password hashes of other users of the instance. Depending on database user privileges, it could also allow to access other bases or files on the underlying server.","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-12-09T14:37:41.921Z","allow_singular_disclosure_after":-89597686.3172908,"singular_disclosure_allowed":true,"vote_count":3,"voters":["geeknik","eveeez","wphackedhelp"],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":11140,"asset_type":"URL","asset_identifier":"*.fuzzing-project.org","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3048154,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @hannob, any update regarding this one? Should I report it directly to upstream?","automated_response":false,"created_at":"2018-07-15T12:47:20.916Z","updated_at":"2018-07-15T12:47:20.916Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3061889,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Reported to serendipity.\nGarvin (s9y dev) thinks this is a low impact issue, as it requires a logged in admin. But he'll fix it, likely with a proper cast.","automated_response":false,"created_at":"2018-07-18T14:07:16.141Z","updated_at":"2018-07-18T14:07:16.141Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3063067,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is now fixed with a patch I got from s9y's dev (as should be all other open issues).\nI'd appreciate if you could check that and also look for further issues, s9y will soon release a security update.","automated_response":false,"created_at":"2018-07-18T17:38:17.473Z","updated_at":"2018-07-18T17:38:17.473Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3063168,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Garvin (s9y dev) thinks this is a low impact issue, as it requires a logged in admin. \n\nI agree, even if it could still be exploited by chaining with #373950. \n\n\u003e I'd appreciate if you could check that and also look for further issues, s9y will soon release a security update.\n\nThe fix (https://github.com/s9y/Serendipity/commit/1afc4d929d96e5bf63cafd4cb8155ca2fb4e8f5f#diff-2168c9599f249d04a7bda43923c908f2R104) looks good to me. I would also add a cast to https://github.com/s9y/Serendipity/blob/1afc4d929d96e5bf63cafd4cb8155ca2fb4e8f5f/include/functions_comments.inc.php#L471, just to be sure.","automated_response":false,"created_at":"2018-07-18T17:57:39.424Z","updated_at":"2018-07-18T17:57:39.424Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3073292,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Suggestion implemented in https://github.com/s9y/Serendipity/commit/005a86da1cacdfb579001d4ff9f85df16b4b5316#diff-e9913ab11efe99f0e30efb4d2f6fd2b9R471.","automated_response":false,"created_at":"2018-07-20T09:11:53.005Z","updated_at":"2018-07-20T09:11:53.005Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3203944,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This was fixed with the release of Serendipity 2.1.3:\nhttp://blog.s9y.org/archives/278-Serendipity-2.1.3-released.html","automated_response":false,"created_at":"2018-08-16T13:31:51.569Z","updated_at":"2018-08-16T13:31:51.569Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bb9866f3f743d6bf69b6836","url":"/bb9866f3f743d6bf69b6836"},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617247,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-09T14:37:41.884Z","updated_at":"2018-11-09T14:37:41.884Z","first_to_agree":true,"actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617257,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-11-09T14:44:05.345Z","updated_at":"2018-11-09T14:44:05.345Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3617258,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2018-11-09T14:44:05.395Z","updated_at":"2018-11-09T14:44:05.395Z","actor":{"username":"bb9866f3f743d6bf69b6836","cleared":false,"url":"/bb9866f3f743d6bf69b6836","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":9817,"category":"team","content":"Bug in upstream Serendipity software, got fixed in version 2.1.3.\n\nThe impact is limited, as it requires a backend login. Still it's a great finding and many thanks to the reporter.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":20918,"username":"hanno","name":"Hanno Böck","bio":"","cleared":false,"website":"https://hboeck.de/","location":"","created_at":"2015-04-21T23:34:53.960Z","url":"https://hackerone.com/hanno","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"hacker_resume_enabled":true,"user_type":"legacy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c","xtralarge":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/c11036e2d3f8b05af4b5da5984ccdec6f786b763c8abceb4e68042e10dcdae85"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}