{"id":531051,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MzEwNTE=","url":"https://hackerone.com/reports/531051","title":"SQL Injection Extracts Starbucks Enterprise Accounting, Financial, Payroll Database","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-04-08T10:38:35.130Z","submitted_at":"2019-04-08T10:38:35.130Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"spaceraccoon","url":"/spaceraccoon","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-06T05:51:52.800Z","bug_reporter_agreed_on_going_public_at":"2019-07-13T02:52:44.659Z","team_member_agreed_on_going_public_at":"2019-08-06T05:51:52.686Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"4000.0","formatted_bounty":"$4,000","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-08-12T02:52:44.773Z","allow_singular_disclosure_after":-43644164.29869165,"singular_disclosure_allowed":true,"vote_count":706,"voters":["v3ntur4x","physuru","totori","ness","ri0-","lyinq","nohats","xypex","hexpwn","mirchr","and 696 more..."],"severity":{"rating":"critical","score":9.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":13008,"asset_type":"OTHER","asset_identifier":"Other non domain specific items","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4506260,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T10:38:52.349Z","updated_at":"2019-04-08T10:38:52.349Z","additional_data":{},"actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4506265,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T10:40:35.879Z","updated_at":"2019-04-08T10:40:35.879Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4506411,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T11:25:36.591Z","updated_at":"2019-04-08T11:25:36.591Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4514102,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T22:30:20.484Z","updated_at":"2019-04-08T22:30:20.484Z","actor":{"username":"glassofbeer","cleared":false,"url":"/glassofbeer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/997/bf60ed9bb749786ae3f68f25703bf0528699cda7_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4514173,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T22:50:11.139Z","updated_at":"2019-04-08T22:50:11.139Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4514583,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T23:50:11.423Z","updated_at":"2019-04-08T23:50:11.423Z","additional_data":{},"actor":{"username":"glassofbeer","cleared":false,"url":"/glassofbeer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/997/bf60ed9bb749786ae3f68f25703bf0528699cda7_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4514586,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T23:50:26.932Z","updated_at":"2019-04-08T23:50:26.932Z","additional_data":{},"actor":{"username":"glassofbeer","cleared":false,"url":"/glassofbeer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/997/bf60ed9bb749786ae3f68f25703bf0528699cda7_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4514600,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-08T23:57:17.254Z","updated_at":"2019-04-08T23:58:58.658Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4514716,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-09T00:37:13.921Z","updated_at":"2019-04-09T00:37:13.921Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4520649,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-09T18:11:10.850Z","updated_at":"2019-04-09T18:11:10.850Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"Other assets","new_scope":"Other non domain specific items","genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4520658,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-09T18:12:59.453Z","updated_at":"2019-04-09T18:12:59.453Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4525665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-10T02:36:52.239Z","updated_at":"2019-04-10T02:37:09.460Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4542047,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-11T18:12:52.655Z","updated_at":"2019-04-11T18:12:52.655Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4542049,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-11T18:13:19.224Z","updated_at":"2019-04-11T18:13:19.224Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Starbucks"}},"bounty_amount":"4000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"starbucks","collaborator":{"username":"spaceraccoon","url":"/spaceraccoon"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4542182,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-11T18:36:11.684Z","updated_at":"2019-04-11T18:36:11.684Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4566029,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-15T16:40:04.981Z","updated_at":"2019-04-15T16:40:04.981Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"spaceraccoon","url":"/spaceraccoon"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4567257,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-15T20:39:08.334Z","updated_at":"2019-04-15T20:39:08.334Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4568433,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-16T00:59:10.487Z","updated_at":"2019-04-16T00:59:10.487Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4568501,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-16T01:21:42.531Z","updated_at":"2019-04-16T01:21:42.531Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5312960,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-13T02:52:44.699Z","updated_at":"2019-07-13T02:52:44.699Z","first_to_agree":true,"actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5499141,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-05T04:02:21.371Z","updated_at":"2019-08-05T04:02:21.371Z","actor":{"username":"spaceraccoon","cleared":true,"url":"/spaceraccoon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5508670,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-06T05:51:52.723Z","updated_at":"2019-08-06T05:51:52.723Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5508671,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-06T05:51:52.823Z","updated_at":"2019-08-06T05:51:52.823Z","actor":{"username":"shadegrown","cleared":false,"url":"/shadegrown","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":17666,"category":"team","content":"As described in the Hacker Summary, @spaceraccoon discovered a SQL Injection vulnerability in a web service backed by Microsoft Dynamics AX. @spaceraccoon demonstrated that the flaw was exploitable via XML-formatted HTTP payload requests to the server. We appreciate @spaceraccoon's clear and thorough report, which helped us quickly and effectively triage the report and remediate the vulnerability.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eAs described in the Hacker Summary, \u003ca href=\"/spaceraccoon\"\u003e@spaceraccoon\u003c/a\u003e discovered a SQL Injection vulnerability in a web service backed by Microsoft Dynamics AX. \u003ca href=\"/spaceraccoon\"\u003e@spaceraccoon\u003c/a\u003e demonstrated that the flaw was exploitable via XML-formatted HTTP payload requests to the server. We appreciate \u003ca href=\"/spaceraccoon\"\u003e@spaceraccoon\u003c/a\u003e\u0026#39;s clear and thorough report, which helped us quickly and effectively triage the report and remediate the vulnerability.\u003c/p\u003e\n"},{"id":17199,"category":"researcher","content":"## False Starts\n\nI first came across the endpoint via typical subdomain enumeration. On the surface, it looked like an extremely promising target: a simple HTML file upload form. I began by testing for unrestricted file uploads with PHP shells and such, but it quickly became clear from the verbose error messages that while the files were being sent to the server, they were being processed as XML files and were not saved on the server.\n\nFortunately, the error messages helped me craft a properly-formatted XML file that was accepted by the server. It appeared to be some kind of accounting database entry as it expected nodes like `MainAccount`, `Credit`, `Debit`, `Invoice` and so on. Moreover, the error messages included references to [Microsoft Dynamics AX](https://dynamics.microsoft.com/en-sg/ax-overview/?cdn=disable), an enterprise financial/accounting software platform. At this point, I started testing for XXE attacks. However, it appeared that external entities were blocked and despite multiple attempts at bypasses, I could only achieve a \"Billion Laughs\" attack that would result in denial of service. This wasn't good enough, so after several more days of trying, I eventually moved on to other targets.\n\n## The Lightbulb Moment\n\nMore than a month later, I revisited the target. Fortunately, it was still online. This time, I suspected that if the XML input was being entered into a database, I should test for SQL injections. In particular, the `MainAccount` looked promising because it accepted a numerical ID like `\u003cMainAccount\u003e123456\u003c/MainAccount\u003e` and was perhaps used in a `WHERE` SQL query.\n\nHowever, it appeared that the apostrophe `'` was being properly escaped. After a bit of testing, I realized my mistake: the XML format prohibits some characters, including the apostrophe. To include them, you have to enter apostrophes as escaped entities. Instead of `\u003cMainAccount\u003e123456'\u003c/MainAccount\u003e`, I had to use `\u003cMainAccount\u003e123456\u0026apos;\u003c/MainAccount\u003e`. The server immediately returned a `database error` message - I was on the right path!\n\nWith a bit more manual testing, I realized it was possible to craft a time-based SQL injection. I then switched to `sqlmap` with the `--tamper htmlencode` flag to automate my attack. After a few minutes of anxious waiting, `sqlmap` confirmed the exploit and returned the database  version: `Microsoft SQL Server 2012`. I was in!\n\n## Assessing Impact\n\nSo I had an SQL injection - but what if the database was unused or negligible? I decided to test for three things: the type of data in the database, the amount of data, and the recency of data. However, I quickly met a roadblock: as an enterprise database, Microsoft Dynamics AX was massive: a quick check revealed that the database had thousands of tables. I had to find and focus on the main table, but where should I begin?\n\nFortunately, Microsoft provides documentation online about Dynamics AX. After a bit of research, I found the default main table and the relevant columns. A few minutes later, the answers came in. There were almost a million entries up till the previous year that included real accounting information. Zaheck!! I immediately stopped testing and wrote my report.\n\n## Takeaways\n\n1. Don't get tunnel vision. Just because it's a file upload, don't focus solely on uploading a reverse shell. Just because it accepts XML files, don't focus solely on XXE.\n2. Take notes and revisit old targets. Many of my best bugs were from vulnerabilities I found after revisiting an old endpoint. Taking time off can reveal new attack paths.\n3. Assess impact after the initial exploit, but don't go too far.\n\nThank you Starbucks team and Hackerone triagers for responding quickly and communicating so well!","can_view?":true,"can_edit?":false,"content_html":"\u003ch2 id=\"false-starts\"\u003eFalse Starts\u003c/h2\u003e\n\n\u003cp\u003eI first came across the endpoint via typical subdomain enumeration. On the surface, it looked like an extremely promising target: a simple HTML file upload form. I began by testing for unrestricted file uploads with PHP shells and such, but it quickly became clear from the verbose error messages that while the files were being sent to the server, they were being processed as XML files and were not saved on the server.\u003c/p\u003e\n\n\u003cp\u003eFortunately, the error messages helped me craft a properly-formatted XML file that was accepted by the server. It appeared to be some kind of accounting database entry as it expected nodes like \u003ccode\u003eMainAccount\u003c/code\u003e, \u003ccode\u003eCredit\u003c/code\u003e, \u003ccode\u003eDebit\u003c/code\u003e, \u003ccode\u003eInvoice\u003c/code\u003e and so on. Moreover, the error messages included references to \u003ca href=\"/redirect?url=https%3A%2F%2Fdynamics.microsoft.com%2Fen-sg%2Fax-overview%2F%3Fcdn%3Ddisable\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eMicrosoft Dynamics AX\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, an enterprise financial/accounting software platform. At this point, I started testing for XXE attacks. However, it appeared that external entities were blocked and despite multiple attempts at bypasses, I could only achieve a \u0026quot;Billion Laughs\u0026quot; attack that would result in denial of service. This wasn\u0026#39;t good enough, so after several more days of trying, I eventually moved on to other targets.\u003c/p\u003e\n\n\u003ch2 id=\"the-lightbulb-moment\"\u003eThe Lightbulb Moment\u003c/h2\u003e\n\n\u003cp\u003eMore than a month later, I revisited the target. Fortunately, it was still online. This time, I suspected that if the XML input was being entered into a database, I should test for SQL injections. In particular, the \u003ccode\u003eMainAccount\u003c/code\u003e looked promising because it accepted a numerical ID like \u003ccode\u003e\u0026lt;MainAccount\u0026gt;123456\u0026lt;/MainAccount\u0026gt;\u003c/code\u003e and was perhaps used in a \u003ccode\u003eWHERE\u003c/code\u003e SQL query.\u003c/p\u003e\n\n\u003cp\u003eHowever, it appeared that the apostrophe \u003ccode\u003e\u0026#39;\u003c/code\u003e was being properly escaped. After a bit of testing, I realized my mistake: the XML format prohibits some characters, including the apostrophe. To include them, you have to enter apostrophes as escaped entities. Instead of \u003ccode\u003e\u0026lt;MainAccount\u0026gt;123456\u0026#39;\u0026lt;/MainAccount\u0026gt;\u003c/code\u003e, I had to use \u003ccode\u003e\u0026lt;MainAccount\u0026gt;123456\u0026amp;apos;\u0026lt;/MainAccount\u0026gt;\u003c/code\u003e. The server immediately returned a \u003ccode\u003edatabase error\u003c/code\u003e message - I was on the right path!\u003c/p\u003e\n\n\u003cp\u003eWith a bit more manual testing, I realized it was possible to craft a time-based SQL injection. I then switched to \u003ccode\u003esqlmap\u003c/code\u003e with the \u003ccode\u003e--tamper htmlencode\u003c/code\u003e flag to automate my attack. After a few minutes of anxious waiting, \u003ccode\u003esqlmap\u003c/code\u003e confirmed the exploit and returned the database  version: \u003ccode\u003eMicrosoft SQL Server 2012\u003c/code\u003e. I was in!\u003c/p\u003e\n\n\u003ch2 id=\"assessing-impact\"\u003eAssessing Impact\u003c/h2\u003e\n\n\u003cp\u003eSo I had an SQL injection - but what if the database was unused or negligible? I decided to test for three things: the type of data in the database, the amount of data, and the recency of data. However, I quickly met a roadblock: as an enterprise database, Microsoft Dynamics AX was massive: a quick check revealed that the database had thousands of tables. I had to find and focus on the main table, but where should I begin?\u003c/p\u003e\n\n\u003cp\u003eFortunately, Microsoft provides documentation online about Dynamics AX. After a bit of research, I found the default main table and the relevant columns. A few minutes later, the answers came in. There were almost a million entries up till the previous year that included real accounting information. Zaheck!! I immediately stopped testing and wrote my report.\u003c/p\u003e\n\n\u003ch2 id=\"takeaways\"\u003eTakeaways\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eDon\u0026#39;t get tunnel vision. Just because it\u0026#39;s a file upload, don\u0026#39;t focus solely on uploading a reverse shell. Just because it accepts XML files, don\u0026#39;t focus solely on XXE.\u003c/li\u003e\n\u003cli\u003eTake notes and revisit old targets. Many of my best bugs were from vulnerabilities I found after revisiting an old endpoint. Taking time off can reveal new attack paths.\u003c/li\u003e\n\u003cli\u003eAssess impact after the initial exploit, but don\u0026#39;t go too far.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThank you Starbucks team and Hackerone triagers for responding quickly and communicating so well!\u003c/p\u003e\n"}]}