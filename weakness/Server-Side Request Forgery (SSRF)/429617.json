{"id":429617,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80Mjk2MTc=","url":"https://hackerone.com/reports/429617","title":"Reverse Proxy misroute leading to steal X-Shopify-Access-Token header","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-10-27T10:16:39.287Z","submitted_at":"2018-10-27T10:16:39.287Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"chaosbolt","url":"/chaosbolt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-03-14T10:50:35.082Z","bug_reporter_agreed_on_going_public_at":"2019-03-14T10:50:34.949Z","team_member_agreed_on_going_public_at":"2018-12-06T15:23:42.927Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello Shopify team! I found out that on /admin/api/graphql endpoint server fetches content of Host header value (${HTTP_Host} + /admin/api/graphql). If my own host was sent to server, request comes from ██████████or ██████████ (your google cloud cluster). Also I can grab all reverse proxy headers including X-Shopify-Access-Token.\n\nexample of such request in base64:\n\n```\n███\n```\n\n\nAlso it returns response your server got on ${HTTP_Host} + /admin/api/graphql address\n\n\nHow to reproduce:\n1. POST /admin/api/graphql with Host pointing to external website\n2. As external website owner grab incoming headers.\n\n## Impact\n\nSSRF, X-Shopify-Access-Token leakage","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":367003,"file_name":"responseleakage.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/367/003/1967fde0fb8d6eb8e2e8d78fe933b08c8e148710/responseleakage.png?response-content-disposition=attachment%3B%20filename%3D%22responseleakage.png%22%3B%20filename%2A%3DUTF-8%27%27responseleakage.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTQR22CE2%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T145935Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIHylhpFJOF4pRe7XlaDX6z3BLEup%2BswnNkaACr%2Fwjwr8AiASjuyeD0TYwrZA5sOldf5eC6UQrO8hSHC9jNR%2BVNumhyqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMfK%2BofD1wJOHYcOUJKtcDnC3f8Y3jglGs7z8YlxF9bdYkYlsSrPxEkx9hDqtH%2BQ3u1daZrwyM6F3WHlk0a%2BWNezGk%2FnRxFWuvgXlXXAEBaCUWEe1UXv97gs6KKr%2F4fZ92%2FH3VXeVMioYLi220Z8qDdmiwSK2Z%2FPfK0nlRhO3v9Ee3r3C7BMq5B4DRnfxp0cJyzU%2FHbMNzQNjyO%2BlGzreHCzcyKBe%2FoFAr2W6xbLokCINrIUxMnvI9Mxs7SraD%2FF2sZw8Ln4uZ6aJweQoOPwsnYKkrRjb370Lt%2FREkrEj9pcgae0C9R5BTZegZaqNN6CzMkZfNHB7RmNrhJFg6j7%2BfPYLcWFNxzvJV9dbVJdocqrM5Jmi3hE47KOBrMSGuFrCha2vRk9P64hqfhM1GdDtMLFZZn5VqOJgdyVWZ8bTrZpmlBP%2FJ6YiHIaMTH8G%2FRndaRrVRAR8iOSqWok%2FikWajxMvcVA29H%2F5RznwCFPkLrSbv34tOiWcwVp50Yy3HjkGq4LnY67LMRRRIwThQ9vc%2BM3G9xlb7TwO6%2F3vE5U6azDCH6hDFQ3Xi8ZJVYrTOOWINnf%2BC3BIhvL8Uql%2FhI1vUmbQiAR01xN%2FdEQ9ReTSo0pfJ3SDSXhBXiwUW0IRKspJO189rJyI3MImNkYsGOqYBwdOGh60JXyl1FPj8jwEbnfg6var6H0hyaUwn%2B%2FnamMWODqDwoSJI6f0Q6RJHnQJo2gfc6OFgj1W2B%2FGcJDL4gMvwPBD8bBDDMSaZ3x1nqw%2FhzMwsaQP%2BTnUJEKAVQSe3o5Yvwzg%2FSvpNP%2By981FbIZs9aWoGNPHY48ZIUNdNLCWPS2PxNm9xHrAxEcqn8ib1XLvQQS%2FALl2CG36%2BewUP2tPIf%2BIPmw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=290b6f3d25ff2de4238242217e7a7189ff80324fd9b75cc14322d2a7d502172d","file_size":226084,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":82,"voters":["drsniper","secator","michiel","base_64","bogdantcaciuc","danila","teuvokas","sameerphad72","logicmap","leetboi","and 72 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":3563592,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank your for your report! We have reproduced this, and our engineering team is investigating this issue.","automated_response":false,"created_at":"2018-10-31T14:21:56.110Z","updated_at":"2018-10-31T14:21:56.110Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3565670,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report! We have recently deployed a fix for this issue. A recent change removed our host validation when proxying to the graphql endpoint. These protections are now back in place.\nOur next round of bounty decisions will take place within the next few days, so we'll be in touch with you again soon.","automated_response":false,"created_at":"2018-10-31T18:12:01.731Z","updated_at":"2018-10-31T18:12:01.731Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"chaosbolt","url":"/chaosbolt"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3571540,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2018-11-01T18:50:11.327Z","updated_at":"2018-11-01T18:50:11.327Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"chaosbolt","url":"/chaosbolt"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3775861,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2018-12-06T15:23:42.953Z","updated_at":"2018-12-06T15:23:42.953Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4322199,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2019-03-14T10:50:35.010Z","updated_at":"2019-03-14T10:50:35.010Z","actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4322200,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2019-03-14T10:50:35.102Z","updated_at":"2019-03-14T10:50:35.102Z","actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":11386,"category":"team","content":"@ruvlol discovered that the `/admin/api/graphql` endpoint in Shopify admin was missing host validation, and would proxy to arbitrary hosts when the host header was modified. This could have allowed making POST requests with that path to internal services, or exposing the X-Shopify-Access token for the current user (which the client does not typically have access to). However, this token has the same access level as interacting normally with the graphql endpoint in admin for that session.","can_view?":true,"can_create?":false,"attachments":[],"user":{"id":75410,"username":"jenn-shopify","name":"jenn","bio":"","cleared":false,"website":null,"location":"","created_at":"2016-05-09T18:26:09.949Z","url":"https://hackerone.com/jenn-shopify","anc_triager":false,"hackerone_triager":false,"hackerone_employee":false,"user_type":"company","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png","xtralarge":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"}}},{"category":"researcher","can_view?":true,"can_create?":false}]}