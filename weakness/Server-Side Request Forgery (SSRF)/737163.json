{"id":737163,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MzcxNjM=","url":"https://hackerone.com/reports/737163","title":"SSRF - Image Sources in HTML Snippets - 727234 bypass","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-11-14T02:33:45.493Z","submitted_at":"2019-11-14T02:33:45.493Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zhutyra","url":"/zhutyra","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-02-20T10:46:55.948Z","bug_reporter_agreed_on_going_public_at":"2020-02-20T10:46:55.870Z","team_member_agreed_on_going_public_at":"2020-02-19T13:41:53.341Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This is about incomplete fix for my recent bug #727234.\n\nIn short, the **/ajax/snippet?action=import** endpoint allows to create HTML snippets. URLs of images are extracted from HTML and their content is fetched and attached to created snippet. For more details please see #727234.\n\nWith the fix applied, the URL is validated before accessed. However only *initial* address is checked. If this initially valid location redirects to another location, this *replacement* location isn't checked and still can be any internal address, effectively bypassing the validation.\n```\nhttp://attacker.com/looks/safe --\u003e http://internal/insecure\n```\n\nAgain a demo program is attached and should produce output like this:\n```\nhttp://localhost:22/\nno error\nhttp://localhost:23/\nAn I/O error occurred: Connection refused (Connection refused)\nhttp://localhost:443/\nInvalid or harmful image data detected.\nhttp://localhost:444/\nAn I/O error occurred: Connection refused (Connection refused)\n```\n\n## Impact\n\nAn attacker can trigger requests to internal resources and observer results.","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":633866,"file_name":"ox-snippets-redir.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/cSkmKdDD1Ddm7CjYJh7WXdtP?response-content-disposition=attachment%3B%20filename%3D%22ox-snippets-redir.py%22%3B%20filename%2A%3DUTF-8%27%27ox-snippets-redir.py\u0026response-content-type=text%2Fx-python\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY53K44OC%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T152201Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJHMEUCIQCU8ZTbZzS6KdrG%2BJrTZNy82bTqU%2FWXOWwT7y6tP8B6KAIgQozKTGEEU%2F70E9jK8ee9qFehhPTHAyr6tKNPFg0ipagqgwQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgwwMTM2MTkyNzQ4NDkiDF24qMO4iM3lRhiKeSrXA3AD62arZ%2FR73I3OwVYKSQCLgGLmSdy1oHr3484T3%2BZNdRf9jASNKtWoD4ND1FsQM%2BH%2FxYbuyUfVW1RfHyrPNSyl31UWmh7%2FQLuSlKjidHFofUO6MlDrn8WL5H8Dklkc%2FODNXnwWhhBS4P4ETpaL0O2W1uk1mywZuHYi%2FHdUzHz3D04j6CIFX8koOXulelg3aywpppZ%2BEQtc5UJl3%2FFtSaZhFImaUXkZ%2BzfEI%2BbQZR9YL2QECzdM3wSFAU88f993HARvk3jnLnZu%2FeEflruySV3ucsnDUFOGStl4Z92w7SWYAu4eDkreiVsqtuAq5AUa5%2BxAlO8ntiuuW%2F1ub33RDrVP%2F1fK0GljO09wOd0GggTt7eJg%2FThXb0E0vNvuwPp1jdadEeVnZq2BNBCkROzc7bkLv3NE%2FYGkeq2tXA2h%2FEIK8ch9Mnp6UiGfyxWGAmVSXsYjBfrEAhj%2FOjyT96V663zm4TqRAN1sBiDSBG2V62BD69wu%2BKoIKDUGczZoq%2FV0i7T2Z94gjXG54fv8Q9pYpQYidhIS8cWbi1UAeyC7clfpue5hvais0Jt95MyKeSs9D4lwBmMR0UyOP2rP66bKUJXZxm09UaueyC8QE1RefPMEnNlod%2FEZhzCfjpGLBjqlAXGztZxISzkOSBi8ODZQNabZwzSDol%2BJUpM4q3e6PNJ%2FgMEC3ZQgjfp1kkwqPmzwlsAYYdaiUyY63ZSo5cIUxwTYMNXkbtuqxJrWDNMFnO8tISB8THjfP1XKNdJ7hpjx0Bx9mhmB9FifH5ih2c0AvGKyBC0fFcEdB0xLEnh5UcS8oUuRyx81oqTUXuBHWiT8%2B9GXMeEJa92HZXoXratnwKl2tc9yww%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c087e4798b6d40630464cbf51b096a498c0ba61d1e1b621ac65b0dd9cc2f6407","file_size":1504,"type":"text/x-python"}],"allow_singular_disclosure_at":null,"vote_count":41,"voters":["a_d_a_m","cutoffurmind","ali","enixium","an0nym0us","domssilva","khizer47","cryptographer","jaimin","millenniumx","and 31 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":551,"asset_type":"URL","asset_identifier":"sandbox.open-xchange.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6302032,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2019-11-14T02:38:06.740Z","updated_at":"2019-11-14T02:38:06.740Z","additional_data":{"old_title":"SSRF - Image Sources in HTML Attachments - 727234 bypass","new_title":"SSRF - Image Sources in HTML Snippets - 727234 bypass"},"actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6302843,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hi, the fix for #727234 is not deployed to sandbox.open-xchange.com yet.","automated_response":false,"created_at":"2019-11-14T07:04:31.412Z","updated_at":"2019-11-14T07:04:31.412Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6305518,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nit was fixed in this commit [81d9652d7a4675bed3d7bf6a7403de23f424ca16](https://gitlab.open-xchange.com/middleware/core/commit/81d9652d7a4675bed3d7bf6a7403de23f424ca16)\n*Fix for bug 67931: Only allow URLs for certain protocols and deny for localhost/loopback address*\n\nWhich was soon after my bug report and without further activity since then, presumably considered complete.\n\nVersion on sandbox is `7.10.3 Rev0 (2019-11-04)` which indeed does contain this fix and is bypassable as I described here.","automated_response":false,"created_at":"2019-11-14T14:25:54.258Z","updated_at":"2019-11-14T14:25:54.258Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6313329,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm sorry, indeed someone has updated sandbox with development code.","automated_response":false,"created_at":"2019-11-15T09:09:57.199Z","updated_at":"2019-11-15T09:09:57.199Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6313334,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","automated_response":false,"created_at":"2019-11-15T09:10:02.273Z","updated_at":"2019-11-15T09:10:02.273Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6313535,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2019-11-15T09:25:49.545Z","updated_at":"2019-11-15T09:25:49.545Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6353558,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We solved this vulnerability internally and will provide a backport to in-production releases during the next weeks.\n\nWe're in the process of transferring funds to H1 to provide your compensation, please stand by.","automated_response":false,"created_at":"2019-11-20T07:34:03.773Z","updated_at":"2019-11-20T07:34:03.773Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zhutyra","url":"/zhutyra"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6419953,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Sorry you had to wait for the bounty!","automated_response":false,"created_at":"2019-11-27T11:31:09.318Z","updated_at":"2019-11-27T11:31:09.318Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"400.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"zhutyra","url":"/zhutyra"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6423123,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty.","automated_response":false,"created_at":"2019-11-27T16:51:46.845Z","updated_at":"2019-11-27T16:51:46.845Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7090510,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-02-19T13:41:53.360Z","updated_at":"2020-02-19T13:41:53.360Z","first_to_agree":true,"actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7099007,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-02-20T10:46:55.898Z","updated_at":"2020-02-20T10:46:55.898Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7099008,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-02-20T10:46:55.969Z","updated_at":"2020-02-20T10:46:55.969Z","actor":{"username":"zhutyra","cleared":false,"url":"/zhutyra","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}