{"id":229170,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjkxNzA=","url":"https://hackerone.com/reports/229170","title":"RTLO character allowed in shared files","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2017-05-17T12:40:08.108Z","submitted_at":"2017-05-17T12:40:08.108Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"inhibitor181","url":"/inhibitor181","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-17T08:34:47.122Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-08-17T08:34:40.510Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"SUMMARY\n-------------\nHello, I have notices that you do not properly strip the RTLO (right to left override) character __in the sharing page of the file__, thus allowing someone to mask the real extension of a file and if the user downloads, then opens the file something may be executed on his machine.\n\nVery important : This char is handles correctly in file lists, but incorrectly if you get the share link of that file.\n\nPOC\n------------\nFirst of all, create a file with a fake extension by utilizing the RTLO character. I usually do it like this (my example is to fake a .html as a .txt) :\n1. Create a file called : testtxt.lmth\n2. Go to Chrome, open the JS console and write copy(\"\\u202e\");\n3. Go to your file, try to rename it, place the cursor between the . and the l from the extension and CTRL+V to paste the copied RTLO char. The name should be now `testtxt.html`\n\nNow, back to nextcloud. I used https://demo.nextcloud.com for my test\n\n1. Upload the file\n2. You will notice that the name is correctly written in file file manager (you see the .html extension, not .txt)\n3. Share the file (I also added a password, but it shouldn't matter)\n4. With another account / user go to that file\n5. The name you will see is `testtxt.html`. But, if you download this file and open it the html will be executed in your browser\n\n__Video POC attached__ (I cannot attach the RTLO file because h1 strips the char out, as it should)\n\nADVICE\n-----------\nNormally you should strip this char out along with more unicode chars. I have reported this / seen this behaviour and stripping the unicodes out fixes it, __and I recommend it__. Also in some other programs, the user cannot even download the file (after he downloads the file, it cannot be opened as it is not found on the disk anymore - the name is replaced again by the system).\n\nBut, the behaviour from nextcloud should be patched.\n\nAlso, the txt \u003c-\u003e html faking is trivial, but faking .exe / .bat / .cmd etc can have other consequences as the user knows he should have downloaded a .txt file from nextcloud.\n","weakness":{"id":74,"name":"UI Redressing (Clickjacking)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["mashoud1122","sa1tama0","mr0bart"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1679915,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","automated_response":true,"created_at":"2017-05-17T12:40:08.272Z","updated_at":"2017-05-17T12:40:08.272Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1681303,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks. I'll discuss this internally and get back with our considerations on this point.","automated_response":false,"created_at":"2017-05-17T18:04:00.033Z","updated_at":"2017-05-17T18:04:00.033Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1786822,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @lukasreschke . Any updates here ? ","automated_response":false,"created_at":"2017-06-28T07:57:11.898Z","updated_at":"2017-06-28T07:57:11.898Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1790106,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can not reproduce this behaviour, for me the downloaded file is named:\nChromium: `testtxt.%E2%80%AElmth`\nFirefox: `testtxt._lmth`\n\nSo not sure what you did different?!","automated_response":false,"created_at":"2017-06-29T08:46:33.242Z","updated_at":"2017-06-29T08:46:33.242Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1790344,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen.\n\nThis only happens if you share the link, please check again the steps / video. Downloading directly form the app works correctly. I have reproduced this again now on Chromium ( Version 58.0.3029.110 Built on Ubuntu , running on Ubuntu 14.04 (64-bit) )\n\nSo, the steps are :\n1. Upload the malicious file\n2. Share the file and get the shared link\n3. Open the shared link in another incognito tab\n4. You will see the extension of the file is .txt, but after you download it it will be .html and if you open it form the downloads tab it will trigger in your browser.","automated_response":false,"created_at":"2017-06-29T09:13:27.068Z","updated_at":"2017-06-29T09:13:27.068Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1790347,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nickvergessen. If you check it now, maybe the link will not dissapear : https://demo.nextcloud.com/jaefeib8/s/WHU3ftup7GrKIZo","automated_response":false,"created_at":"2017-06-29T09:14:04.789Z","updated_at":"2017-06-29T09:14:04.789Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2942266,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @inhibitor181,\n\nSorry for taking so long.\n\nI was missing some steps (just like @nickvergessen) in your original post.\n\nWhat I did\n\n1. upload a file 'testtxt.html'\n2. put the cursor between 'test' and 'txt'\n3. paste the RTLO char\n\nThen the file looks as being a txt file while being a html file.\n\nThen it does show up as wrong to me indeed.\n\nI'll prepare a patch to at least filter out this specific char.\nAs we can't completely filter out unicode (some of our customers depend on it) do you have a list of 'dangerous' chars at hand?\n\nCheers,\n--Roeland\n\n","automated_response":false,"created_at":"2018-06-27T20:29:54.785Z","updated_at":"2018-06-27T20:29:54.785Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2942376,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nA quick fix for the RTLO char is in https://github.com/nextcloud/server/pull/10030\n\nCheers,\n--Roeland","automated_response":false,"created_at":"2018-06-27T21:09:07.574Z","updated_at":"2018-06-27T21:09:07.574Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2943784,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rullzer,\n\nThis does indeed handle that character. I do not know of any other chars like that one to cause similar issues except the ones that look almost identical with their real counterparts.\n\nAs a more general fix, I would write a regex where I say what chars are allowed and then would replace anything else with a - or something. Of course I do not know if that is backwords compatible or if you have a more loose policy for file names.","automated_response":false,"created_at":"2018-06-28T06:09:36.244Z","updated_at":"2018-06-28T06:09:36.244Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2943791,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nOk than we just filter out the RTLO for now.\nI'll see that it makes it way into NC14 and will be backported to our maintenance releases.\n\nThnx,\n--Roeland","automated_response":false,"created_at":"2018-06-28T06:13:18.326Z","updated_at":"2018-06-28T06:13:18.326Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4219283,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@rullzer Hey, would you mind closing this, as in your last reply you said it will be fixed","automated_response":false,"created_at":"2019-02-26T21:28:57.085Z","updated_at":"2019-02-26T21:28:57.085Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5204826,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The solution we had in mind was a bit too aggressive and was therefor not merged.\nWe are currently discussing other options with RTL writing people and will close or resolve this issue soon.","automated_response":false,"created_at":"2019-06-27T09:32:36.421Z","updated_at":"2019-06-27T09:32:36.421Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6287765,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"After some more discussion especially with RTL native people we decided to not fix this issue for now.","automated_response":false,"created_at":"2019-11-12T13:10:00.695Z","updated_at":"2019-11-12T13:10:00.695Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8451267,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-06-30T06:33:26.321Z","updated_at":"2020-06-30T06:33:26.321Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8451562,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"No need to disclose this. Old, informative and nothing interesting","automated_response":false,"created_at":"2020-06-30T07:18:58.717Z","updated_at":"2020-06-30T07:18:58.717Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8452627,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'd like to disclose this as we are getting duplicates from time to time and linking to a non-published report always raises questions.","automated_response":false,"created_at":"2020-06-30T08:40:19.317Z","updated_at":"2020-06-30T08:40:19.317Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8953935,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2020-08-17T08:34:40.525Z","updated_at":"2020-08-17T08:34:40.525Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8953936,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","automated_response":false,"created_at":"2020-08-17T08:34:47.054Z","updated_at":"2020-08-17T08:34:47.054Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}