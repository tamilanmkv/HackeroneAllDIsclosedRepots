{"id":149598,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDk1OTg=","url":"https://hackerone.com/reports/149598","title":"Insecure 2FA/authentication implementation creates a brute force vulnerability","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-06T17:42:07.460Z","submitted_at":"2016-07-06T17:42:07.460Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yaworsk","url":"/yaworsk","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-10-28T15:22:28.163Z","bug_reporter_agreed_on_going_public_at":"2016-10-28T15:21:34.174Z","team_member_agreed_on_going_public_at":"2016-10-28T15:22:28.113Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi All,\nI believe I've found a vulnerability with regards to your user authentication and 2FA implementation but wasn't sure you'd be interested given the reference to \"rate limiting\" being out of scope so please bare with me. I also took a quick look at https://gitlab.com/gitlab-org/gitlab-ce/issues?utf8=%E2%9C%93\u0026issue_search=two+factor and noticed there is no reference to this coming up.\n\n#Background Setup\nI've configured my own GitLab server on an AWS EC2 small instance. I'm not overly familiar with your platform so all my settings are default.\n\n#Description\n###2FA\nIn short, testing out your 2FA implementation, I noticed that there is limited protection against brute forcing. It appears the only protection is rate limiting and a time limited token from the Google authenticator app. With the time drift, a token is valid for 60 seconds.\n\nNow, that said, if an attacker knows a users password (I address guessing it below), they are able to begin a brute force attack to guess the token (please continue to bare with me). The reason I'm reporting in system design, specifically:\n\n- It appears that initially, an attacker can submit anywhere from 10 - 19 requests to validate a 2FA before rate limiting kicks in. This then stops the attacker for, what appears to be, 30 - 40 seconds (in some tests it was less). Then an attacker can submit the username and password and submit another 9 requests before rate limiting stops them again. While these numbers may be off slightly, for arguments sake, **let's say they can submit 20 request per valid token.**\n\n- Since tokens are 6 digits long, we have a 20 in 1,000,000 chance of being right (or 0.00002). So, on that note, if we made 5,000 attempts (of 20 guesses per minute) at the token, **we'd have a 9.5% chance of finding the right one at least once in 3.5 days (5,000 attempts = 5,000 minutes = 83.3 hours = 3.47 days).** 10,000 attempts would take approximately 7 days and yield an 18% chance (I used this calculator http://stattrek.com/online-calculator/binomial.aspx)\n\n- Compounding the issue, during the attacker, **a victim and admin get no notification / impact on service.** The victim can still log in and use their account while the attacker is guessing a valid token, no email is generated to indicate someone is attempting to compromise their account (at least in the 5 or 6 times I ran the test) and I couldn't find anything in the web based logs for the admin account. That said, because I'm not overly familiar with the platform and didn't run this for the full day, maybe I'm missing some notification system. If so, I apologize.\n\n###Password Guessing\nIn addition to the above, I noticed that there is also limited protection against guessing a password. After X number of attempts at guessing a password incorrectly, an account does become locked, an email sent to the victim and the attacker is never notified.\n\nBut, while the account is locked, if an attacker guesses a correct password, they are still redirected to the 2FA screen to confirm a token rather than being stopped. **So, while the account is locked, an attacker still is able to confirm a victim's password.**\n\n#Vulnerability\nI'm reporting because 2FA is the second line of defense for victims, especially in light of all the recent password compromises and continued password reuse by users. While this attack would take time, it is likely that once an attacker knows a victim's password, they will be able to bypass GitLab's 2FA implementation within days.\n\nBased on other systems I've tested, potential mitigations include:\n\n###2FA\n- Only allow 3 attempts at a token\n- After 3 different attempts at 3 different tokens, lock the user account and email the victim\n\n###Password Brute Forcing\n- Once an account is locked, do not validate the password of a user\n\nI hope this helps. Please let me know if you have any questions.\nPete","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-11-27T15:21:34.245Z","allow_singular_disclosure_after":-153699753.6054396,"singular_disclosure_allowed":true,"vote_count":30,"voters":["delimitry","michiel","ebrietas","johndoe1492","mdv","bugdiscloseguys","karel_origin","xsam","madrobot","supernatural","and 20 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1067652,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@yaworsk Thank you for the detailed report. I've opened a confidential issue to discuss this with our team internally, and I'll keep you updated here on its status.","automated_response":false,"created_at":"2016-07-13T20:34:51.635Z","updated_at":"2016-07-13T20:34:51.635Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1067678,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for letting me @rspeicher. I know 2FA is a tough piece to get 100% right so please let me know if I can help in any way.  Hoping your team agrees with the potential here.","automated_response":false,"created_at":"2016-07-13T20:48:56.068Z","updated_at":"2016-07-13T20:48:56.068Z","actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1091660,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rspeicher,\nhope you don't mind me checking in - just wondering what the team's preliminary thoughts were on this one, if any?\n\nthanks\npete","automated_response":false,"created_at":"2016-07-27T20:03:07.485Z","updated_at":"2016-07-27T20:03:07.485Z","actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1216055,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yaworsk. Just as an update, a fix for this issue is currently undergoing review and will likely be included in an upcoming patch release for the 8.12 version.","automated_response":false,"created_at":"2016-09-26T12:08:14.336Z","updated_at":"2016-09-26T12:08:14.336Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1216178,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @rspeicher, I appreciate the heads up. Glad I could help.\nPete","automated_response":false,"created_at":"2016-09-26T13:41:50.660Z","updated_at":"2016-09-26T13:41:50.660Z","actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1231459,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@yaworsk A fix for this was merged today and will be included in the next 8.12 patch release.\n\nPlease let me know how you'd like to be mentioned on the blog post and [vulnerability acknowledgements](https://about.gitlab.com/vulnerability-acknowledgements/), including your preferred name and an optional link.\n\nThanks again!","automated_response":false,"created_at":"2016-10-04T15:15:14.790Z","updated_at":"2016-10-04T15:15:14.790Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1231594,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks for letting me know @rspeicher. Thanks for the offer to be mentioned, you can include me as Pete Yaworski and link to my twitter profile if that works for you https://twitter.com/yaworsk\n\nThanks!\nPete","automated_response":false,"created_at":"2016-10-04T16:34:55.455Z","updated_at":"2016-10-04T16:34:55.455Z","actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1272911,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @rspeicher -- did this get merged/released? Don't see it in the change log anywhere https://gitlab.com/gitlab-org/gitlab-ce/blob/master/CHANGELOG.md?","automated_response":false,"created_at":"2016-10-28T14:44:36.292Z","updated_at":"2016-10-28T14:44:36.292Z","actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1272979,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@yaworsk Thank you so much for bringing this up!\n\nThe fix was in the changelog at https://gitlab.com/gitlab-org/gitlab-ce/commit/9264816a34c45fb36c0117fe95bdf9e9af3287c8, but there was a communication breakdown and we failed to mention the issue and fix in the blog post. I just pushed https://gitlab.com/gitlab-com/www-gitlab-com/commit/7f77e70 to correct that.\n\nThank you again for your report and continued patience. Feel free to request a public disclosure.","automated_response":false,"created_at":"2016-10-28T15:20:08.364Z","updated_at":"2016-10-28T15:20:08.364Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"yaworsk","url":"/yaworsk"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1272980,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Awesome! Thanks - again, glad to help :)","automated_response":false,"created_at":"2016-10-28T15:21:34.222Z","updated_at":"2016-10-28T15:21:34.222Z","first_to_agree":true,"actor":{"username":"yaworsk","cleared":true,"url":"/yaworsk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/046/435/8321e52445321287eea5b5b3f4c9f6ea69e92bb5_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1272982,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2016-10-28T15:22:28.135Z","updated_at":"2016-10-28T15:22:28.135Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1272983,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2016-10-28T15:22:28.187Z","updated_at":"2016-10-28T15:22:28.187Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}