{"id":210875,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTA4NzU=","url":"https://hackerone.com/reports/210875","title":"use of unsafe host header leads to open redirect","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-03-05T15:05:05.461Z","submitted_at":"2017-03-05T15:05:05.461Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"exception","url":"/exception","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/100/852/b1f7d559f94f85152099c4a3426ec92010ceba40_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2143,"url":"https://hackerone.com/rockstargames","handle":"rockstargames","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Rockstar Games","twitter_handle":"RockstarGames","website":"http://www.rockstargames.com/","about":"Publishers of such popular games as Grand Theft Auto, Max Payne, Red Dead Redemption, L.A. Noire, Bully \u0026 more."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-05-01T14:20:41.291Z","bug_reporter_agreed_on_going_public_at":"2017-04-01T14:20:27.223Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi guys\n\nI noticed you are using unsafe host header in generating short links.\n\n#Details \nFirst i navigated to my account \n`https://socialclub.rockstargames.com/member/xerojuzto`\n\nThen i created a new message , and i clicked on share button which shortens the url for example \n\nFrom `https://socialclub.rockstargames.com/member/xerojuzto/feed/3073813190982488067` \nto `http://rsg.ms/517ae7c`\n\nI fetched the http requests to find the end-point which is used to shorten urls.\n`https://socialclub.rockstargames.com/some_dirs/share/Person/getcontent?_=1488723542848`\n\nthe end-point is taking all the url parts before `/Share/Person` and creates a short link corresponding to this cut url.\n\nI Guess the code looks like \n```\n\u003c?php\n$actual_link = \"https://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]\";\n$trimed_link=explode($actual_link,\"/Share\");\n\n$short=DB_Create_short_link($trimed_link);\necho $short;\n?\u003e\n```\nDid you notice the usage of `HTTP_HOST` which  is variable and could be changed by sending different host header values , this will result in creating malicious urls.\n\nThe following request \n```\nGET /feed/102126489/activity/3073813190982488067/share/Person/getcontent?_=1488723542848 HTTP/1.1\nHost: socialclub.rockstargames.com\n```\nIs meant to shorten `/feed/102126489/activity/3073813190982488067` to `http://rsg.ms/517ae7c`   but due to not sharing my wall , it will create another redirect to my profile `https://socialclub.rockstargames.com/member/xerojuzto`\n\n#Exploiting\nI tried to manipulate the host header to force it to redirect the client  to my domain\n\n```\nGET /feed/102126489/activity/2960911889698885091/share/Person/getcontent?_=1488725310707 HTTP/1.1\nHost: socialclub.rockstargames.com.this.is.my.domain.evil.net\n```\n\nand it resulted in creating `http://rsg.ms/5350b75` if you visited it , you would be redirected to \n\n`https://socialclub.rockstargames.com.this.is.my.domain.evil.net/member/xerojuzto/feed/2960911889698885091` \nWhich is not your domain.\n\n#Consequences\n1- Phishing attacks\n2- Open redirects\n3- Cache poisoning and password reset leakage (Limited)\n\n#Steps to reproduce\n1- Log into your account at socialclub\n2- Navigate to your profile\n3- Post a new message\n4- Set up a proxy server (i used burp)\n5- Configure your browser(firefox in my case) to work with the proxy server\n6- Click on share button \n7- Intercept the request\n8- Manipulate the host header and copy the generated shorten url (ex: rsg.ms/5350b75)\n9- Visit it and you will see a redirect to the injected domain.\n\nyou can visit `http://rsg.ms/5350b75` , if you need a video just shout me .\n\n\n#Fix\n- If you are shortening urls from only `socialclub` , then you should correctly validate the host header \n-If you are using many domains \n   you should create a white list for them before constructing urls.\n\n\n#Ref \nhttp://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html\n\n\n\nBest regards\nYasser\n\n\n\n\n\n\n\n\n\n\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":166441,"file_name":"RSG_Request.http","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/166/441/8fbf9a23b0e6e72f6ff469a5df3d6519ad1b7616/RSG_Request.http?response-content-disposition=attachment%3B%20filename%3D%22RSG_Request.http%22%3B%20filename%2A%3DUTF-8%27%27RSG_Request.http\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY5I5ZOTN%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140403Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQCqf43kV8RTzzmWR1TXeEdpx%2Fd5zGOFNpfZDgSM2xJuCQIhAMLYAxjZR7PGO9btJ9wGFbOqf%2FTbE2pC%2FdkQgyPDWZD8KoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgzmKazqBIClFAMqc2Iq1wNPV39BSW59qP%2ByHsmBjxY6m%2Fb7a6U5448PKOSe8dVf6ZB9c%2BLac%2F0Gz8ADXdDYKsvWZv%2FAmBj5%2FhHzWjVphb45t9jx%2BhpJI0AITzRmRN5aq7TLFOZDfehY6xr7qR34eKZAu9XJrbi4QdAu%2BNSUgERhmM4muMj19K4msZk8sFVbAKLF%2BU6gGnywSDktUJmbSxfnY6ZesCS5elWm1qPvYsKCbrl5y57ovXEaa7NAn6XfLDrVTRtpY8qRzPQbURfe%2FnNfBCEGQCwCuB8zQszv%2B2O4z6L6fFCLSm2gccXmLLJqlgBN7EwqRjH0XLKpn1vWKBfmNtQJMcfcBOgesSBjohFRDqs9VtzSm8Ar%2FZ3tQRyj3E5FFBVh7SFXfbH0zIPhcJnR7J%2Ft20n0T0BoFfeC4Lh04EDdGi1xF35UayBRbz0euxaVcKV0UA%2BktOyHmbRzgaonWDeZCOaJtjFZCGnWooRLI6KrYUmAIMrnyQoKS2q8DQKxvweDK7%2FuWfo1ovNRy%2BMy3v8N%2B%2B6q1M2DXNkYeXZoalrKF%2BzGC2C%2FRVd1z2LoHJiVHopIG7T4Lyax%2BX9LY1Z9oVqxPxTo9SgiI1kD69%2Bl5MKWzogETScQuH%2Bvi36SPh1QbdmYvwgw5O6QiwY6pAEabkl2EyHSmga%2FQVBclzYljmd0Pvwag9ITi%2BNlOViZyzeqV8k%2F8Q8ny0OOVtCp3iCSdWDf1LHd%2BqKtTjKS7CIODHKRsg4m3sx7QNZBHT5H00n5U2ZVgN4N9m3YxiNqVHw1I0Jv0KF1%2BS2XFhkFHuxBokXIzihowuz57pmo5yGw3bX16HVqCrlEZdpJDLSrVWPAr55aHcggcNaCjNyYlZGc9VtWCw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cdc04329e8a1e19a04207bbfe4e1ba7ec677052ca1aaf319bfb49c2eb6b360b1","file_size":1382,"type":"text/plain"},{"id":166443,"file_name":"RS_req_resp.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/166/443/b9e7c9827927936755a6168e029b0a0276cbdd16/RS_req_resp.png?response-content-disposition=attachment%3B%20filename%3D%22RS_req_resp.png%22%3B%20filename%2A%3DUTF-8%27%27RS_req_resp.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY5I5ZOTN%2F20211011%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20211011T140403Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHUaCXVzLXdlc3QtMiJIMEYCIQCqf43kV8RTzzmWR1TXeEdpx%2Fd5zGOFNpfZDgSM2xJuCQIhAMLYAxjZR7PGO9btJ9wGFbOqf%2FTbE2pC%2FdkQgyPDWZD8KoMECO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAhoMMDEzNjE5Mjc0ODQ5IgzmKazqBIClFAMqc2Iq1wNPV39BSW59qP%2ByHsmBjxY6m%2Fb7a6U5448PKOSe8dVf6ZB9c%2BLac%2F0Gz8ADXdDYKsvWZv%2FAmBj5%2FhHzWjVphb45t9jx%2BhpJI0AITzRmRN5aq7TLFOZDfehY6xr7qR34eKZAu9XJrbi4QdAu%2BNSUgERhmM4muMj19K4msZk8sFVbAKLF%2BU6gGnywSDktUJmbSxfnY6ZesCS5elWm1qPvYsKCbrl5y57ovXEaa7NAn6XfLDrVTRtpY8qRzPQbURfe%2FnNfBCEGQCwCuB8zQszv%2B2O4z6L6fFCLSm2gccXmLLJqlgBN7EwqRjH0XLKpn1vWKBfmNtQJMcfcBOgesSBjohFRDqs9VtzSm8Ar%2FZ3tQRyj3E5FFBVh7SFXfbH0zIPhcJnR7J%2Ft20n0T0BoFfeC4Lh04EDdGi1xF35UayBRbz0euxaVcKV0UA%2BktOyHmbRzgaonWDeZCOaJtjFZCGnWooRLI6KrYUmAIMrnyQoKS2q8DQKxvweDK7%2FuWfo1ovNRy%2BMy3v8N%2B%2B6q1M2DXNkYeXZoalrKF%2BzGC2C%2FRVd1z2LoHJiVHopIG7T4Lyax%2BX9LY1Z9oVqxPxTo9SgiI1kD69%2Bl5MKWzogETScQuH%2Bvi36SPh1QbdmYvwgw5O6QiwY6pAEabkl2EyHSmga%2FQVBclzYljmd0Pvwag9ITi%2BNlOViZyzeqV8k%2F8Q8ny0OOVtCp3iCSdWDf1LHd%2BqKtTjKS7CIODHKRsg4m3sx7QNZBHT5H00n5U2ZVgN4N9m3YxiNqVHw1I0Jv0KF1%2BS2XFhkFHuxBokXIzihowuz57pmo5yGw3bX16HVqCrlEZdpJDLSrVWPAr55aHcggcNaCjNyYlZGc9VtWCw%3D%3D\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=383e6e1bb65ccaca390d753c8eb8ec155e786b1283b99f125184be775ebbc75a","file_size":87855,"type":"image/png"}],"allow_singular_disclosure_at":"2017-05-01T14:20:27.268Z","allow_singular_disclosure_after":-140312616.07772288,"singular_disclosure_allowed":true,"vote_count":20,"voters":["adn","zombiehelp54","brodie_codie","supernatural","geeknik","eveeez","malcolmx","mahmoud0x00","m16","its_afolic","and 10 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":{"databaseId":430,"asset_type":"URL","asset_identifier":"socialclub.rockstargames.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":1523517,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@exception, thanks for the report.  We are looking into this now.  We'll let you know when we have an update.","automated_response":false,"created_at":"2017-03-07T04:24:31.822Z","updated_at":"2017-03-07T04:24:31.822Z","actor":{"username":"0xffe4","cleared":false,"url":"/0xffe4","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1533407,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @exception ,\n\nWe have successfully reproduced this and notified our developers of the issue. We'll let you know as soon as we have any updates on this matter. Thanks again!","automated_response":false,"created_at":"2017-03-10T21:14:01.764Z","updated_at":"2017-03-10T21:14:01.764Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1546208,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","automated_response":false,"created_at":"2017-03-16T19:04:17.129Z","updated_at":"2017-03-16T19:04:17.129Z","actor":{"url":"/rockstargames","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Rockstar Games"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"rockstargames","collaborator":{"username":"exception","url":"/exception"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1574107,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @exception ,\n\nWe have pushed out the fix for this issue to Production. Attempting to modify the Host header at this endpoint will now result in the server responding with an error message. If you can find a way to bypass this, please let us know. Otherwise, thanks again!\n\nRockstar Games Security","automated_response":false,"created_at":"2017-03-30T21:19:20.558Z","updated_at":"2017-03-30T21:19:20.558Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"exception","url":"/exception"},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1577437,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":" ","automated_response":false,"created_at":"2017-04-01T14:20:27.243Z","updated_at":"2017-04-01T14:20:27.243Z","first_to_agree":true,"actor":{"username":"exception","cleared":true,"url":"/exception","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/100/852/b1f7d559f94f85152099c4a3426ec92010ceba40_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1614269,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can i write about this if we can not disclose ?","automated_response":false,"created_at":"2017-04-16T22:52:57.021Z","updated_at":"2017-04-16T22:52:57.021Z","actor":{"username":"exception","cleared":true,"url":"/exception","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/100/852/b1f7d559f94f85152099c4a3426ec92010ceba40_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1646469,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2017-05-01T14:20:41.322Z","updated_at":"2017-05-01T14:20:41.322Z","actor":{"url":"/rockstargames","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Rockstar Games"}},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6350605,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","automated_response":false,"created_at":"2019-11-19T21:12:38.794Z","updated_at":"2019-11-19T21:12:38.794Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"old_scope":"None","new_scope":"socialclub.rockstargames.com","genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8409791,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-06-25T17:55:48.004Z","updated_at":"2020-06-25T17:55:48.004Z","additional_data":{"old_severity":null,"new_severity":"Low","old_severity_id":null,"new_severity_id":761122},"actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}