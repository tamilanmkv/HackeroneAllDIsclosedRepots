{"id":981824,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODE4MjQ=","url":"https://hackerone.com/reports/981824","title":"DNS Setup allows sending mail on behalf of other customers","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-09-14T16:41:04.167Z","submitted_at":"2020-09-14T16:41:04.206Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"aisforarray","url":"/aisforarray","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/EbDBUh47Jn78TjXkoVjy7Rkg/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":67,"url":"https://hackerone.com/basecamp","handle":"basecamp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/43e4513b9104ea0d68c9c096cea374ba8440dde3e027af5465c8771e8839a67c","medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"pentest_feature_enabled?":false,"profile":{"name":"Basecamp","twitter_handle":"basecamp","website":"https://basecamp.com/about/policies/security/response","about":"Basecamp is the leading online project manager and the birthplace of Ruby on Rails. Creators of the HEY email service."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"has_collaborators":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2021-02-21T16:02:32.495Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2021-01-22T16:02:25.128Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Sent on your behalf\n\nI knew basecamp themselves had used helpscout for support, so I was\ncurious to see if hey was doing the same.  A quick DNS lookup gave me the answer\nI was looking for:\n\n```\ndig hey.com txt                     \n\n; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e hey.com txt\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NOERROR, id: 48297\n;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;hey.com.\t\t\tIN\tTXT\n\n;; ANSWER SECTION:\nhey.com.\t\t60\tIN\tTXT\t\"cyssd1dn8z15bmffrprj1hzycw436gzh\"\nhey.com.\t\t60\tIN\tTXT\t\"google-site-verification=k7w8RY2bLljThqEsIGQOoQlclHp19HawwdiHTq2nJpw\"\nhey.com.\t\t60\tIN\tTXT\t\"google-site-verification=VH8KKQzQ7gWsKxSsibqBexLteqs254PwGFS37Hf22MQ\"\nhey.com.\t\t60\tIN\tTXT\t\"v=spf1 include:_spf.hey.com include:helpscoutemail.com -all\"\n\n;; Query time: 39 msec\n;; SERVER: 192.168.42.1#53(192.168.42.1)\n;; WHEN: Fri Jun 26 17:20:34 PDT 2020\n;; MSG SIZE  rcvd: 315\n```\n\nOk.  That's interesting.  helpscoutemail.com has permissions to send email on\nbehalf of hey.com.  For completeness let's look at helpscoutmail.com spf\nrecords:\n\n```\ndig helpscoutemail.com txt\n\n; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e helpscoutemail.com txt\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NOERROR, id: 47004\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;helpscoutemail.com.\t\tIN\tTXT\n\n;; ANSWER SECTION:\nhelpscoutemail.com.\t300\tIN\tTXT\t\"v=spf1 ip4:54.173.229.38 ip4:52.0.20.102 ip4:54.174.116.32 ip4:52.2.238.96 ip4:52.20.146.34 ip4:34.198.122.65 ~all\"\n\n;; Query time: 42 msec\n;; SERVER: 192.168.42.1#53(192.168.42.1)\n;; WHEN: Fri Jun 26 17:32:45 PDT 2020\n;; MSG SIZE  rcvd: 174\n```\n\n### How can we exploit this?\n\nFirst, let's go ahead and create an account over at helpscout.  It can be\nanything.  Let's setup an inbox.  Again, it can be anything, doesn't really\nmatter.  What **does** matter is that we setup a custom address for the inbox.\nOf course, helpscout makes sure we have access to the email address we're\nacting as.  \n\nSo let's go ahead and setup an email as dhhracing@hey.com.  First, we sign up\nfor a trial on hey.com with that email.  All good.  Now, let's enter that into\nhelpscout.  Once we get the verification email in hey, we enter the verification\nin helpscout.  But... generally there is another step.  Helpscout needs to have\npermission to send on our behalf.  How do they do that?  With DNS records for\nSPF, DKIM and DMARC.  But... hey.com has already done that as they themselves\nare helpscout customers.\n\nNow here is where the trouble comes in.  hey.com has a recycle policy.  If you\ncreate a trial but never pay, or as for a refund, then after 30 days the email\naddress becomes available again.  So let's go ahead and cancel our\ndhhracing@hey.com account (in hey, not in sendgrid).  Now we wait 30 days.  Now,\nDHH realizes he needs an address for his racing.  So he goes to hey.com and\ncreates an account under dhhracing@hey.com.  And what do you know, it's\navailable!\n\nBut now, not only can DHH send email from dhhracing@hey.com, but SO CAN I.  From\nmy helpscout account.  Of course, I won't receive mail from that account, but I\ncould always just send out mail and CC another address that I own and hope for a\nreply-all.  But really, the options for scamming are limitless.\n\nI've suggested a few options to hey.com:\n\n1. Don't use the primary domain on helpscout.  Setup heysupport.com or\n   something similar.\n2. Don't ever recycle accounts.  I can only ever see this causing issues.\n3. Get helpscout to treat hey.com as a mail provider and don't allow sending\n   from their domain.\n\n## Impact\n\nAn attacker could spoof any hey.com email address that they had originally created an address for (and had been recycled).  This could allow them to appear to be a high-profile individual or company.  By CCing an address that they currently own they could receive replies from the correspondence as well.","bounty_amount":"700.0","formatted_bounty":"$700","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-02-21T16:02:25.220Z","allow_singular_disclosure_after":-20043947.638387714,"singular_disclosure_allowed":true,"vote_count":56,"voters":["arw9234","mr-medi","obsesif","ltidi","fqdn","najeh_halawani","kickino","badcracker","ali","mattberg","and 46 more..."],"severity":{"rating":"medium","score":6.8,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"none","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":53959,"asset_type":"URL","asset_identifier":"*.hey.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"activities":[{"id":9217344,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have communicated with the team at basecamp and was instructed that this was a security issue and to submit as specified in my description of the issue.\n\nIt is reproducible, has high impact and is within scope.","automated_response":false,"created_at":"2020-09-14T16:43:34.641Z","updated_at":"2020-09-14T16:43:34.641Z","actor":{"username":"aisforarray","cleared":false,"url":"/aisforarray","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/EbDBUh47Jn78TjXkoVjy7Rkg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9219579,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","automated_response":false,"created_at":"2020-09-14T18:34:30.034Z","updated_at":"2020-09-14T18:34:30.034Z","actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9219850,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","automated_response":false,"created_at":"2020-09-14T18:59:28.591Z","updated_at":"2020-09-14T18:59:28.591Z","additional_data":{"old_severity":"Critical","new_severity":"Medium (6.8)","old_severity_id":845683,"new_severity_id":846017},"actor":{"username":"rosa","cleared":false,"url":"/rosa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/154/237/a07aeeba083a8f178942d326a68f6427c699e0f1_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9220040,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"This falls in our _Medium_ tier ($250 to $1,000) due to the complexity of the attack, as it requires having registered a specific address, letting it lapse, then wait after the trial period is over plus ~60 days until the address is free again, and then expect the victim to sign up with that specific address. Awarding a bounty on the higher side of that tier as the impact is high. \n\nAlso, thank you very much for the great report!","automated_response":false,"created_at":"2020-09-14T19:22:15.519Z","updated_at":"2020-09-14T19:22:15.519Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"bounty_amount":"700.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"basecamp","collaborator":{"username":"aisforarray","url":"/aisforarray"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9220230,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for that.  I am curious on what the fix was there.  Did helpscout fix it on their side?  Also, in my email I had asked if I could publish it on my blog after a fix was deployed.  Is that still ok?","automated_response":false,"created_at":"2020-09-14T19:48:37.282Z","updated_at":"2020-09-14T19:48:37.282Z","actor":{"username":"aisforarray","cleared":false,"url":"/aisforarray","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/EbDBUh47Jn78TjXkoVjy7Rkg/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9228597,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @aisforarray,\n\nUnfortunately, we haven’t fixed this yet, just awarded your bounty. Sorry about that! We’ll update here when we have.","automated_response":false,"created_at":"2020-09-15T15:55:35.387Z","updated_at":"2020-09-15T15:55:35.387Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10451113,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for the report! Our HelpScout account now delivers through our outbound mail relays via SASL, allowing us to remove HelpScout from our SPF policy. Feel free to publish this on your blog.","automated_response":false,"created_at":"2021-01-22T16:02:07.606Z","updated_at":"2021-01-22T16:02:07.606Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"aisforarray","url":"/aisforarray"},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10451118,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","automated_response":false,"created_at":"2021-01-22T16:02:25.153Z","updated_at":"2021-01-22T16:02:25.153Z","first_to_agree":true,"actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":10734375,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","automated_response":false,"created_at":"2021-02-21T16:02:32.520Z","updated_at":"2021-02-21T16:02:32.520Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/fd4ecbe1e3e98c343c7717114485ace2f830f9253103d3cfa7502059868c516c"},"profile":{"name":"Basecamp"}},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}